[{"content":"å¹¶å‘ä¸æ€§èƒ½ä¼˜åŒ– 1. å¤§æ–‡ä»¶ä¸Šä¼ å¦‚ä½•å¤„ç†ï¼Ÿåˆ†ç‰‡ä¸Šä¼  ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson001\n1.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†ç‰‡ä¸Šä¼ ? å¤§æ–‡ä»¶åœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ï¼Œè€—è´¹çš„æ—¶é—´æ¯”è¾ƒé•¿ã€‚å¦‚æœç½‘ç»œä¸ç¨³å®šï¼Œå¾ˆå¯èƒ½å¯¼è‡´ä¸Šä¼ å¤±è´¥ï¼Œéœ€è¦é‡æ–°ä¸Šä¼ ã€‚åˆ†ç‰‡ä¸Šä¼ ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nåˆ†ç‰‡ä¸Šä¼ å®šä¹‰ï¼šå°†å¤§æ–‡ä»¶æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶å—ï¼Œé€å—è¿›è¡Œä¸Šä¼ \n1.2 å¦‚ä½•å®ç°åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ 1.2.1 å¦‚ä½•å­˜å‚¨åˆ†ç‰‡ä¿¡æ¯ åˆ†ç‰‡ä¸Šä¼ éœ€è¦è®°å½•æ–‡ä»¶çš„å±æ€§ (md5ã€å¤§å°ã€åç§°)ã€åˆ†ç‰‡æ•°é‡ã€æ–‡ä»¶å­˜å‚¨çš„å®Œæ•´è·¯å¾„ (æœ¬åœ°è·¯å¾„)ï¼Œè¿˜éœ€è¦è®°å½•æ¯ä¸ªåˆ†å—çš„ä¸Šä¼ æƒ…å†µ (åˆ†å—å¤§å°ã€åˆ†å—é¡ºåºã€åˆ†å—ä»»åŠ¡id)ã€‚å¯ä»¥ç”¨ åˆ†å—ä¸Šä¼ ä»»åŠ¡è¡¨ å’Œ åˆ†å—æ–‡ä»¶è¡¨ æ¥è®°å½•ã€‚\nåˆ†å—ä»»åŠ¡è¡¨ (t_shard_upload)\ncreate table if not exists t_shard_upload( id varchar(32) primary key, file_name varchar(256) not null comment \u0026#39;æ–‡ä»¶åç§°\u0026#39;, part_num int not null comment \u0026#39;åˆ†ç‰‡æ•°é‡\u0026#39;, md5 varchar(128) comment \u0026#39;æ–‡ä»¶md5å€¼\u0026#39;, file_full_path varchar(512) comment \u0026#39;æ–‡ä»¶å®Œæ•´è·¯å¾„\u0026#39; ) comment = \u0026#39;åˆ†ç‰‡ä¸Šä¼ ä»»åŠ¡è¡¨\u0026#39;; åˆ†å—æ–‡ä»¶è¡¨ (t_shard_upload_partï¼‰\ncreate table if not exists t_shard_upload_part( id varchar(32) primary key, shard_upload_id varchar(32) not null comment \u0026#39;åˆ†ç‰‡ä»»åŠ¡idï¼ˆt_shard_upload.idï¼‰\u0026#39;, part_order int not null comment \u0026#39;ç¬¬å‡ ä¸ªåˆ†ç‰‡ï¼Œä»1å¼€å§‹\u0026#39;, file_full_path varchar(512) comment \u0026#39;æ–‡ä»¶å®Œæ•´è·¯å¾„\u0026#39;, UNIQUE KEY `uq_part_order` (`shard_upload_id`,`part_order`) ) comment = \u0026#39;åˆ†ç‰‡æ–‡ä»¶è¡¨ï¼Œæ¯ä¸ªåˆ†ç‰‡æ–‡ä»¶å¯¹åº”ä¸€æ¡è®°å½•\u0026#39;; åˆ†å—æ–‡ä»¶è¡¨å’Œåˆ†å—ä¸Šä¼ è¡¨æ˜¯ 1 to M çš„å…³ç³»ï¼Œå‡å¦‚å½“å‰æ–‡ä»¶åˆ†ä¸º10å—ã€‚åˆ™ä¼šå‡ºç°1ä¸ªåˆ†ç‰‡ä¸Šä¼ ä»»åŠ¡ï¼Œå’Œ10ä¸ªåˆ†ç‰‡æ–‡ä»¶è®°å½•ã€‚\n1.2.2 å¦‚ä½•å®šä¹‰åˆ†å—ä¸Šä¼ æ¥å£ åˆ†å—ä¸Šä¼ å¯ä»¥åˆ†ä¸ºä¸‹é¢ 5 ä¸ªæ¥å£\n**åˆ›å»ºåˆ†ç‰‡ä¸Šä¼ ä»»åŠ¡æ¥å£ ** (/shardUpload/init) å…¥å‚ï¼šæ–‡ä»¶åç§°ã€æ–‡ä»¶å¤§å°ã€æ–‡ä»¶md5 å‡ºå‚ï¼šä»»åŠ¡idã€åˆ†ç‰‡æ•°é‡ å®ç°ï¼šè®¡ç®—åˆ†ç‰‡æ•°é‡ï¼Œåˆ›å»ºåˆ†ç‰‡ä»»åŠ¡ ä¸Šä¼ åˆ†ç‰‡æ–‡ä»¶ (/shardUpload/uploadPart) å…¥å‚ï¼šMultiPartFile æ–‡ä»¶ å‡ºå‚ ï¼šåˆ†ç‰‡æ–‡ä»¶è®°å½•idã€ä»»åŠ¡id å®ç°ï¼šå­˜å…¥æ–‡ä»¶åˆ°ç£ç›˜è‡ªåŠ¨ä½ç½®ï¼Œåˆ›å»ºåˆ†ç‰‡æ–‡ä»¶è®°å½• åˆå¹¶åˆ†ç‰‡ã€å®Œæˆä¸Šä¼  (/shardUpload/complete) å…¥å‚ï¼šä»»åŠ¡id å‡ºå‚ï¼šå¸ƒå°”å€¼ å®ç°ï¼šæŒ‰ç…§é¡ºåºåˆå¹¶æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ è·å–åˆ†ç‰‡ä»»åŠ¡è¯¦ç»†ä¿¡æ¯(/shardUpload/detail) å…¥å‚ï¼šä»»åŠ¡id ã€æ–‡ä»¶md5 (äºŒé€‰ä¸€) å‡ºå‚ï¼šä»»åŠ¡è¿›åº¦ã€æ–‡ä»¶åç§°ã€æ–‡ä»¶md5 å®ç°ï¼šè¯»å–åˆ†ç‰‡æ–‡ä»¶è¡¨æŸ¥çœ‹ä¸Šä¼ æƒ…å†µ åŠŸèƒ½ï¼šè·å–åˆ†ç‰‡ä»»åŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚åˆ†ç‰‡ä»»åŠ¡æ˜¯å¦ä¸Šä¼ å®Œæ¯•ï¼Œå“ªäº›åˆ†ç‰‡å·²ä¸Šä¼ ç­‰ä¿¡æ¯ï¼Œç½‘ç»œå‡ºç°æ•…éšœï¼Œå¯ä»¥å€ŸåŠ©æ­¤æ¥å£æ¢å¤ä¸Šä¼  1.3 å¦‚æœä¸Šä¼ è¿‡ç¨‹ä¸­ï¼Œå‡ºç°æ•…éšœå¦‚ä½•å¤„ç†ï¼Ÿ æƒ…å†µ1ï¼šæµè§ˆå™¨æ— æ³•è¯»å–åˆšæ‰ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶äº† æ­¤æ—¶éœ€è¦ç”¨æˆ·é‡æ–°é€‰æ‹©æ–‡ä»¶ï¼Œé‡æ–°ä¸Šä¼ ã€‚è¿™ä¸ªåœ°æ–¹ä¹Ÿå¯ä»¥ç»™å¤§å®¶æä¾›å¦å¤–ä¸€ç§æ€è·¯ï¼Œç¬¬1ä¸ªæ¥å£åˆ›å»ºåˆ†ç‰‡ä»»åŠ¡çš„æ—¶å€™ä¼ å…¥äº†æ–‡ä»¶çš„md5ï¼ŒæŒ‰è¯´è¿™ä¸ªå€¼æ˜¯å…·æœ‰å”¯ä¸€æ€§çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼æ‰¾åˆ°åˆšæ‰çš„ä»»åŠ¡ï¼ŒæŒ‰ç…§è¿™ç§æ€è·¯ï¼Œå°±éœ€è¦åç«¯æä¾›ä¸€ä¸ªæ–°çš„æ¥å£ï¼šé€šè¿‡æ–‡ä»¶çš„md5å€¼æ‰¾åˆ°åˆšæ‰å¤±è´¥çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åç»§ç»­ä¸Šä¼ æœªä¸Šä¼ çš„åˆ†ç‰‡ã€‚\næƒ…å†µ2ï¼šæµè§ˆå™¨å¯ä»¥ç»§ç»­è¯»å–åˆšæ‰ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ è¿™ç§æƒ…å†µï¼Œå¯ä»¥å…ˆè°ƒç”¨ç¬¬4ä¸ªæ¥å£ï¼Œé€šè¿‡æ­¤æ¥å£å¯ä»¥çŸ¥é“é‚£äº›åˆ†ç‰‡è¿˜æœªä¸Šä¼ ï¼Œç„¶åç»§ç»­ä¸Šä¼ è¿™äº›åˆ†ç‰‡å°±å¯ä»¥äº†ã€‚\n2. å¤šçº¿ç¨‹ä»»åŠ¡æ‰¹å¤„ç†é€šç”¨å·¥å…·ç±» ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson002\nä½¿ç”¨çº¿ç¨‹æ± æ‰¹é‡å‘é€çŸ­ä¿¡ï¼Œå½“çŸ­ä¿¡å‘é€å®Œæ¯•ä¹‹åï¼Œè®°å½•è€—æ—¶æƒ…å†µ ã€ä¸»è¦çŸ¥è¯†ç‚¹ã€‘\nCountDownLatchï¼šå¦‚æœæƒ³è¦ç­‰å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œå†ç»§ç»­å›åˆ°åŸæ–¹æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨CountDownLatch Executorsï¼šç”¨äºåˆ›å»ºçº¿ç¨‹æ± ï¼Œé‡å†™ executor.execute ä¸­çš„ Runnable æ–¹æ³•ï¼Œå¯å®ç°å¼‚æ­¥æ‰§è¡Œçº¿ç¨‹ public class TaskDisposeUtils { /** * ä½¿ç”¨çº¿ç¨‹æ± æ‰¹å¤„ç†æ–‡ä»¶ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•åæ‰ä¼šè¿”å› * * @param taskList ä»»åŠ¡åˆ—è¡¨ * @param consumer å¤„ç†ä»»åŠ¡çš„æ–¹æ³• * @param executor çº¿ç¨‹æ±  * @param \u0026lt;T\u0026gt; * @throws InterruptedException */ public static \u0026lt;T\u0026gt; void dispose(List\u0026lt;T\u0026gt; taskList, Consumer\u0026lt;? super T\u0026gt; consumer, Executor executor) throws InterruptedException { if (taskList == null || taskList.isEmpty() || consumer == null) return; CountDownLatch latch = new CountDownLatch(taskList.size()); for (T item : taskList) { executor.execute(() -\u0026gt; { try { consumer.accept(item); } finally { latch.countDown(); } }); } latch.await(); } public static void main(String[] args) throws InterruptedException { long startTime = System.currentTimeMillis(); List\u0026lt;String\u0026gt; taskList = List.of(\u0026#34;çŸ­ä¿¡-1\u0026#34;, \u0026#34;çŸ­ä¿¡-2\u0026#34;, \u0026#34;çŸ­ä¿¡-3\u0026#34;); ExecutorService executor = Executors.newFixedThreadPool(10); dispose(taskList, TaskDisposeUtils::doTask, executor); System.out.println(\u0026#34;ä»»åŠ¡å¤„ç†å®Œæ¯•,è€—æ—¶(ms):\u0026#34; + (System.currentTimeMillis() - startTime)); executor.shutdown(); } public static void doTask(String task) { System.out.println(task + \u0026#34;å‘é€æˆåŠŸ\u0026#34;); try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } } } 3. æ¥å£æ€§èƒ½å‹åŠ›æµ‹è¯•å·¥å…· ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson003\n3.1 å¸¸ç”¨å‹æµ‹å·¥å…·ç±» Jemeter ã€LoadRunnerã€ApiFox - è‡ªåŠ¨åŒ–æµ‹è¯•\nã€æ³¨æ„ã€‘LoadRunner åªæœ‰windowå¯ä»¥ç”¨\n3.2 æ‰‹å†™å‹æµ‹å·¥å…·ç±» ã€ä¸»è¦çŸ¥è¯†ç‚¹ã€‘\nä¸ºä»€ä¹ˆ updateFastestTime æ–¹æ³•éœ€è¦ä½¿ç”¨å¾ªç¯è€Œä¸æ˜¯ç›´æ¥ compareAndSet ï¼šå› ä¸ºç›´æ¥ä½¿ç”¨ compareAndSet ä¼šå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œæ¯”å¦‚ä¸‹é¢çš„æƒ…å†µ\n// é”™è¯¯çš„åšæ³•ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ int current = fastestCostTime.get(); // çº¿ç¨‹Aè¯»å–åˆ°å€¼100 if (current \u0026gt; costTime) { // çº¿ç¨‹Aåˆ¤æ–­100 \u0026gt; 30ï¼Œå‡†å¤‡æ›´æ–° // æ­¤æ—¶çº¿ç¨‹Bä¹Ÿè¯»å–åˆ°100ï¼Œä¹Ÿåˆ¤æ–­100 \u0026gt; 50ï¼Œä¹Ÿå‡†å¤‡æ›´æ–° fastestCostTime.set(costTime); // çº¿ç¨‹Aè®¾ç½®ä¸º30 // çº¿ç¨‹Bè®¾ç½®ä¸º50ï¼Œè¦†ç›–äº†çº¿ç¨‹Açš„ç»“æœ (æœ€å°æ—¶é—´åº”è¯¥æ˜¯30s) } // ä½¿ç”¨whileå¾ªç¯ä¿è¯çº¿ç¨‹å®‰å…¨ ï¼ˆå…¶å®å°±æ˜¯CASï¼‰ while (true){ int fsCostTime = fastestCostTime.get(); // çº¿ç¨‹Aè¯»å–åˆ°100 // çº¿ç¨‹Bæ­¤æ—¶å°†å€¼æ”¹ä¸º90 if (fastestCostTime.compareAndSet(fsCostTime, costTime)) { // çº¿ç¨‹Aå°è¯•å°†100æ”¹ä¸º50 // å¤±è´¥ï¼å› ä¸ºå½“å‰å€¼å·²ç»æ˜¯90ï¼Œä¸ç­‰äºé¢„æœŸçš„100 break; } // ç»§ç»­å¾ªç¯ï¼Œé‡æ–°è·å–æœ€æ–°å€¼90ï¼Œå†æ¬¡å°è¯• } çº¿ç¨‹æ± å‚æ•°ï¼šæ•°ä¾æ¬¡ä¸º coolPoolSize ã€maxPoolSizeã€keepAliveTimeã€TimeUnitã€waitQueue ç­‰å¾…é˜Ÿåˆ—\nä¸ºä»€ä¹ˆçº¿ç¨‹éœ€è¦é¢„çƒ­ï¼šé¢„çƒ­æ˜¯ä¸ºäº†é¿å…çº¿ç¨‹åˆ›å»ºæ—¶å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œå¦‚æœä¸é¢„çƒ­ï¼Œå¾ˆå¯èƒ½å‰ 100 ä¸ªæ ¸å¿ƒçº¿ç¨‹éœ€è¦å¤šæ¶ˆè€— 10~50 ms æ¥åˆ›å»ºçº¿ç¨‹\nAtomicIntegerï¼šé˜²æ­¢å¤šçº¿ç¨‹ä¿®æ”¹åŒä¸€æ•°æ®æ—¶ï¼Œå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µ\n// æ™®é€šIntegerçš„é—®é¢˜ int value = counter; // 1. è¯»å– value = value + 1; // 2. ä¿®æ”¹ counter = value; // 3. å†™å…¥ // è¿™ä¸‰æ­¥ä¸æ˜¯åŸå­çš„ï¼Œå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ // AtomicIntegeré‡‡ç”¨CAS + volatile ä¿è¯åŸå­æ€§ atomicCounter.incrementAndGet(); // åŸå­æ“ä½œ volatile å…³é”®å­—åœ¨AtomicIntegerä½œç”¨ï¼švolatile å°±åƒæ˜¯ç»™å˜é‡è´´äº†ä¸ª\u0026quot;å®æ—¶æ›´æ–°\u0026quot;çš„æ ‡ç­¾ã€‚é€šè¿‡å†…å­˜å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºæ¥ä¿è¯å®æ—¶æ›´æ–°\n// æ²¡æœ‰volatileçš„æƒ…å†µ int count = 0; // çº¿ç¨‹Aä¿®æ”¹äº†count = 100 // çº¿ç¨‹Bå¯èƒ½è¿˜æ˜¯çœ‹åˆ°count = 0ï¼ˆå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ï¼‰ æ‰€ä»¥ï¼Œå¦‚æœ æ²¡æœ‰volatile å…³é”®å­—ï¼Œ æ²¡æœ‰çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„\u0026quot;å°æœ¬æœ¬\u0026quot;ï¼ˆCPUç¼“å­˜ï¼Œçº¿ç¨‹ç§æœ‰ï¼‰ï¼Œå¯èƒ½è®°å½•çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„ã€‚\npublic class LoadRunnerUtils { public static class LoadRunnerResult { private int requests; // è¯·æ±‚æ€»æ•° private int concurrency; // å¹¶å‘é‡ private int successRequests; // æˆåŠŸè¯·æ±‚æ•° private int failRequests; // å¤±è´¥è¯·æ±‚æ•° private int timeTakenForTests; // è¯·æ±‚æ€»è€—æ—¶(ms) private float requestsPerSecond; // æ¯ç§’è¯·æ±‚æ•°ï¼ˆååé‡ï¼‰ private float timePerRequest; // æ¯ä¸ªè¯·æ±‚å¹³å‡è€—æ—¶(ms) private float fastestCostTime; // æœ€å¿«çš„è¯·æ±‚è€—æ—¶(ms) private float slowestCostTime; // æœ€æ…¢çš„è¯·æ±‚è€—æ—¶(ms) } /** * æ‰§è¡Œå¹¶å‘å‹åŠ›æµ‹è¯• * @param requests æ€»è¯·æ±‚æ•° * @param concurrency å¹¶å‘æ•°é‡ * @param command è¢«æµ‹è¯•çš„ä»£ç  * @return å‹æµ‹ç»“æœ */ public static LoadRunnerResult run(int requests, int concurrency, Runnable command) throws InterruptedException { log.info(\u0026#34;å‹æµ‹å¼€å§‹......\u0026#34;); // åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œé¢„çƒ­æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ ThreadPoolExecutor executor = createThreadPool(concurrency); // ç”¨äºç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆçš„åŒæ­¥å™¨ CountDownLatch latch = new CountDownLatch(requests); // ç»Ÿè®¡æ•°æ®ï¼ˆä½¿ç”¨åŸå­ç±»ä¿è¯çº¿ç¨‹å®‰å…¨ï¼‰ AtomicInteger successCount = new AtomicInteger(0); AtomicInteger fastestTime = new AtomicInteger(Integer.MAX_VALUE); AtomicInteger slowestTime = new AtomicInteger(Integer.MIN_VALUE); long startTime = System.currentTimeMillis(); // æäº¤æ‰€æœ‰å‹æµ‹ä»»åŠ¡ for (int i = 0; i \u0026lt; requests; i++) { executor.execute(() -\u0026gt; executeRequest(command, successCount, fastestTime, slowestTime, latch)); } // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ latch.await(); executor.shutdown(); long endTime = System.currentTimeMillis(); log.info(\u0026#34;å‹æµ‹ç»“æŸï¼Œæ€»è€—æ—¶(ms):{}\u0026#34;, (endTime - startTime)); // è¿”å›å‹æµ‹ç»“æœ } /** * åˆ›å»ºçº¿ç¨‹æ± å¹¶é¢„çƒ­æ ¸å¿ƒçº¿ç¨‹ */ private static ThreadPoolExecutor createThreadPool(int concurrency) { // å‚æ•°ä¾æ¬¡ä¸º coolPoolSizeã€maxPoolSizeã€keepAliveTimeã€TimeUnitã€ç­‰å¾…é˜Ÿåˆ— ThreadPoolExecutor executor = new ThreadPoolExecutor(concurrency, concurrency, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;\u0026gt;()); executor.prestartAllCoreThreads(); return executor; } /** * æ‰§è¡Œå•ä¸ªè¯·æ±‚å¹¶ç»Ÿè®¡ç»“æœ */ private static void executeRequest(Runnable command, AtomicInteger successCount, AtomicInteger fastestTime, AtomicInteger slowestTime, CountDownLatch latch) { try { long requestStart = System.currentTimeMillis(); command.run(); // æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³• int costTime = (int)(System.currentTimeMillis() - requestStart); // æ›´æ–°ç»Ÿè®¡æ•°æ® updateFastestTime(fastestTime, costTime); updateSlowestTime(slowestTime, costTime); successCount.incrementAndGet(); } catch (Exception e) { log.error(\u0026#34;è¯·æ±‚æ‰§è¡Œå¤±è´¥: {}\u0026#34;, e.getMessage()); } finally { latch.countDown(); // æ ‡è®°å½“å‰è¯·æ±‚å®Œæˆ } } /** * åŸå­æ›´æ–°æœ€å¿«è€—æ—¶ */ private static void updateFastestTime(AtomicInteger fastestTime, int costTime) { while (true) { int current = fastestTime.get(); if (current \u0026lt;= costTime || fastestTime.compareAndSet(current, costTime)) { break; } } } } 4. Semaphoreå®ç°æ¥å£é™æµ å¦‚æœåç«¯æœåŠ¡æ˜¯å•ä½“æœåŠ¡ï¼Œä¸”åªéƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥é‡‡ç”¨ Semaphore ä¿¡å·é‡çš„æ–¹å¼å®ç°ç®€å•çš„æ¥å£é™æµæœºåˆ¶\nç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson005\nSemaphore : JUCå½“ä¸­å¯¹ä¿¡å·é‡çš„å®ç°ï¼Œç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\npublic class TestController { /** * Jucä¸­çš„Semaphoreå¯ä»¥å®ç°é™æµåŠŸèƒ½ï¼Œå¯ä»¥å°† Semaphore æƒ³è±¡æˆåœè½¦åœºå…¥å£çš„å¤§çˆ·ï¼Œ * å¤§çˆ·æ‰‹é‡Œé¢æ‹¥æœ‰ä¸€å®šæ•°é‡çš„åœè½¦å¡ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯ä»¤ç‰Œï¼‰ï¼Œå¡çš„æ•°é‡æ˜¯å¤šå°‘å‘¢ï¼Ÿå°±æ˜¯Semaphoreæ„é€ æ–¹æ³•ä¸­æŒ‡å®šçš„ï¼Œå¦‚ä¸‹å°±æ˜¯50ä¸ªå¡ï¼Œ * è½¦ä¸»æƒ³è¿›å»åœè½¦ï¼Œå…ˆè¦ä»å¤§çˆ·æ‰‹ä¸­æ‹¿åˆ°ä¸€å¼ å¡ï¼Œå‡ºæ¥çš„æ—¶å€™ï¼Œéœ€è¦è¿˜ç»™å¤§çˆ·ï¼Œå¦‚æœæ‹¿ä¸åˆ°å¡ï¼Œå°±ä¸èƒ½è¿›å»åœè½¦ã€‚ * semaphore å†…éƒ¨æä¾›äº†è·å–ä»¤ç‰Œï¼Œå’Œè¿˜ä»¤ç‰Œçš„ä¸€äº›æ–¹æ³• */ private Semaphore semaphore = new Semaphore(50); /** * æ¥ä¸ªæ¡ˆä¾‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¸‹å•çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€å¤šåªå…è®¸ 50 ä¸ªå¹¶å‘ï¼Œè‹¥è¶…è¿‡50ä¸ªå¹¶å‘ï¼Œåˆ™è¿›æ¥çš„è¯·æ±‚ï¼Œæœ€å¤šç­‰å¾…1ç§’ï¼Œå¦‚æœæ— æ³•è·å–åˆ°ä»¤ç‰Œï¼Œåˆ™å¿«é€Ÿè¿”å›å¤±è´¥ï¼Œè¯·é‡è¯• * @return */ @GetMapping(\u0026#34;/placeOrder\u0026#34;) public String placeOrder() throws InterruptedException { /** * semaphore åœ¨ä¸Šé¢å®šä¹‰çš„ï¼Œé‡Œé¢æœ‰50ä¸ªä»¤ç‰Œï¼Œä¹Ÿå°±æ˜¯åŒæ—¶å¯ä»¥æ”¯æŒ50ä¸ªå¹¶å‘è¯·æ±‚ * ä¸‹é¢çš„ä»£ç ï¼Œå°è¯•æœ€å¤šç­‰å¾…1ç§’å»è·å–ä»¤ç‰Œï¼Œè·å–æˆåŠŸï¼Œåˆ™è¿›å…¥ä¸‹å•é€»è¾‘ï¼Œè·å–å¤±è´¥ï¼Œåˆ™è¿”å›ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯• */ boolean flag = this.semaphore.tryAcquire(1, 1L, TimeUnit.SECONDS); // è·å–åˆ°ä»¤ç‰Œï¼Œåˆ™è¿›å…¥ä¸‹å•é€»è¾‘ if (flag) { try { //è¿™é‡Œä¼‘çœ 2ç§’ï¼Œæ¨¡æ‹Ÿä¸‹å•çš„æ“ä½œ TimeUnit.SECONDS.sleep(2); return \u0026#34;ä¸‹å•æˆåŠŸ\u0026#34;; } finally { //è¿™é‡Œä¸€å®šä¸è¦æ¼æ‰äº†ï¼Œä»¤ç‰Œç”¨å®Œäº†ï¼Œè¦è¿˜å›å» this.semaphore.release(); } } else { return \u0026#34;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•\u0026#34;; } } } 5. å¹¶è¡ŒæŸ¥è¯¢ - æäº¤æ¥å£å“åº”é€Ÿåº¦ éœ€æ±‚åˆ†æï¼šå½“å‰æ¥å£éœ€è¦å®ç°ä¸‹é¢çš„åŠŸèƒ½\næ¥æ”¶ä¸€ä¸ªå•†å“idï¼Œéœ€è¦è¿”å›å•†å“ä¸‹é¢è¿™äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½åœ¨ä¸åŒçš„è¡¨ä¸­ï¼Œé€šè¿‡å•†å“idå°±å¯ä»¥æŸ¥åˆ°\nå•†å“åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚å•†å“åç§°ã€ä»·æ ¼ç­‰åŸºæœ¬ä¿¡æ¯) å•†å“æè¿°ä¿¡æ¯ï¼ˆå¯èƒ½æ˜¯å¯Œæ–‡æœ¬ï¼Œæ”¾åœ¨å•ç‹¬çš„è¡¨ä¸­ï¼‰ å•†å“æ”¶è—é‡ å•†å“è¯„è®ºé‡ ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson006\n5.1 å¸¸è§„åšæ³• æŒ‰ç…§å•†å“ id åˆ†åˆ«æŸ¥è¯¢ä¸åŒçš„æ•°æ®åº“ï¼Œåœ¨JVMå†…å­˜ä¸­å¯¹ç»“æœè¿›è¡Œç»„è£…ã€‚\npublic class GoodsController { /** * æ ¹æ®å•†å“idè·å–å•†å“ä¿¡æ¯(åŸºæœ¬ä¿¡æ¯ã€æè¿°ä¿¡æ¯ã€è¯„è®ºé‡ï¼Œæ”¶è—é‡) * * @param goodsId å•†å“id * @return * @throws InterruptedException */ @GetMapping(\u0026#34;/getGoodsDetail\u0026#34;) public GoodsDetailResponse getGoodsDetail(@RequestParam(\u0026#34;goodsId\u0026#34;) String goodsId) { long st = System.currentTimeMillis(); GoodsDetailResponse goodsDetailResponse = new GoodsDetailResponse(); // 1ã€è·å–å•†å“åŸºæœ¬ä¿¡æ¯ï¼Œè€—æ—¶100ms goodsDetailResponse.setGoodsInfo(this.getGoodsInfo(goodsId)); //2ã€è·å–å•†å“æè¿°ä¿¡æ¯ï¼Œè€—æ—¶100ms goodsDetailResponse.setGoodsDescription(this.getGoodsDescription(goodsId)); //3ã€è·å–å•†å“è¯„è®ºé‡ï¼Œè€—æ—¶100ms goodsDetailResponse.setCommentCount(this.getGoodsCommentCount(goodsId)); //4ã€è·å–å•†å“æ”¶è—é‡ï¼Œè€—æ—¶100ms goodsDetailResponse.setFavoriteCount(this.getGoodsFavoriteCount(goodsId)); // æ€»è€—æ—¶ä¸º500mså·¦å³ LOGGER.info(\u0026#34;è·å–å•†å“ä¿¡æ¯ï¼Œæ™®é€šç‰ˆè€—æ—¶ï¼š{} ms\u0026#34;, (System.currentTimeMillis() - st)); } // ä½¿ç”¨sleepæ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢çš„å»¶è¿Ÿ private int getGoodsFavoriteCount(String goodsId) { try { log.info(\u0026#34;è·å–å•†å“æ”¶è—é‡\u0026#34;); TimeUnit.MILLISECONDS.sleep(100); } catch (InterruptedException e) { Thread.currentThread().interrupt(); throw new RuntimeException(e); } return 10000; } 5.2 ä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡ŒæŸ¥è¯¢å•†å“ä¿¡æ¯ åˆ†æï¼šä¸Šæ–¹çš„4ä¸ªå•†å“ä¿¡æ¯æŸ¥è¯¢ä¹‹é—´å¹¶æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œè¿™äº›æ²¡æœ‰ä¾èµ–çš„æŸ¥è¯¢å…¶å®æ˜¯å¯ä»¥å¹¶è¡ŒæŸ¥è¯¢çš„ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± åŒæ—¶å»æ‹¿è¿™4ä¸ªç»“æœï¼Œç„¶ååœ¨JVMå†…å­˜ä¸­è¿›è¡Œç»„è£…\nã€ä¸»è¦çŸ¥è¯†ç‚¹ã€‘\nCompletableFuture (CF)ï¼šä¸»è¦ç”¨äºå¼‚æ­¥æ‰§è¡Œå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„ä»»åŠ¡ ï¼ˆé€‚åˆå¼‚æ­¥ä»»åŠ¡ç¼–æ’ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç»„åˆå’Œè½¬æ¢ä»»åŠ¡ç»“æœï¼‰\nCountDownLatch (CDL): ä¸»è¦ç”¨äºçº¿ç¨‹åè°ƒï¼Œç­‰å¾…ä¸€ç»„çº¿ç¨‹å®Œæˆ ï¼ˆä¸€èˆ¬å°±æ˜¯ç”¨æ¥ç­‰å¾…ä¸€æ‰¹çº¿ç¨‹æ‰§è¡Œå®Œï¼‰\nCF å’Œ CDL åŒºåˆ«\nCountDownLatch ğŸ‘‰ è¿åŠ¨ä¼šèµ·è·‘ è£åˆ¤ï¼ˆä¸»çº¿ç¨‹ï¼‰ç­‰å¾…æ‰€æœ‰è¿åŠ¨å‘˜ï¼ˆå­çº¿ç¨‹ï¼‰å°±ä½ï¼ˆcountDownï¼‰ï¼Œæªå“ï¼ˆè®¡æ•°å™¨å½’é›¶ï¼‰åç»Ÿä¸€å¼€è·‘ã€‚ CompletableFuture ğŸ‘‰ å¤–å–è®¢å•æµç¨‹ ä¸‹å•ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰â†’ åˆ¶ä½œï¼ˆthenApply åŠ å·¥ï¼‰â†’ é…é€ï¼ˆthenAccept äº¤ä»˜ï¼‰ï¼Œæ¯ä¸ªç¯èŠ‚è‡ªåŠ¨è§¦å‘ä¸‹ä¸€æ­¥ï¼Œæ— éœ€é˜»å¡ å¯¹æ¯”ç»´åº¦ CountDownLatch CompletableFuture æ ¸å¿ƒç”¨é€” çº¿ç¨‹ç­‰å¾…æœºåˆ¶ï¼ˆé˜»å¡çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰ å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼ˆéé˜»å¡é“¾å¼ä»»åŠ¡å¤„ç†ï¼‰ å·¥ä½œæ–¹å¼ é€šè¿‡è®¡æ•°å™¨é€’å‡ï¼ˆcountDown()ï¼‰è§¦å‘é‡Šæ”¾ é€šè¿‡å›è°ƒé“¾ï¼ˆthenApply()/thenAccept()ï¼‰ä¼ é€’ç»“æœ çº¿ç¨‹é˜»å¡ è°ƒç”¨çº¿ç¨‹ä¸»åŠ¨é˜»å¡ï¼ˆawait()ï¼‰ è°ƒç”¨çº¿ç¨‹ä¸é˜»å¡ï¼Œé€šè¿‡å›è°ƒå¤„ç†ç»“æœ ç»“æœä¼ é€’ âŒ ä¸æ”¯æŒä»»åŠ¡ç»“æœä¼ é€’ âœ… æ”¯æŒä»»åŠ¡ç»“æœä¼ é€’å’Œè½¬æ¢ å¼‚å¸¸å¤„ç† âŒ éœ€æ‰‹åŠ¨æ•è·å¼‚å¸¸ âœ… å†…ç½®å¼‚å¸¸å¤„ç†ï¼ˆexceptionally()/handle()ï¼‰ ä»»åŠ¡ç»„åˆ âŒ ä»…æ”¯æŒå•æ¬¡è®¡æ•° âœ… æ”¯æŒå¤šä»»åŠ¡ç»„åˆï¼ˆallOf()/anyOf()ï¼‰ å¤ç”¨æ€§ âŒ è®¡æ•°å™¨å½’é›¶åä¸å¯é‡ç”¨ âœ… å¯é‡å¤ç»„åˆæ–°ä»»åŠ¡ å…¸å‹åœºæ™¯ å¯åŠ¨å‰ç­‰å¾…èµ„æºåˆå§‹åŒ–ã€æ‰¹é‡ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ å¼‚æ­¥APIè°ƒç”¨ã€æµæ°´çº¿å¼æ•°æ®å¤„ç†ã€å¾®æœåŠ¡ç¼–æ’ ä¸‹é¢çœ‹ä¸€ç»„CFå’ŒCDLçš„ä»£ç å¯¹æ¯”ï¼š\npublic class AsyncDemo { // æ¨¡æ‹Ÿçº¿ç¨‹æ±  private static final ExecutorService executor = Executors.newFixedThreadPool(3); /** * CompletableFutureæ–¹å¼ - æ”¯æŒä»»åŠ¡ç¼–æ’å’Œç»“æœå¤„ç† */ public GoodsInfo getGoodsInfoWithCF(String goodsId) { GoodsInfo result = new GoodsInfo(); // 1. åˆ›å»ºå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ CompletableFuture\u0026lt;String\u0026gt; basicInfoFuture = CompletableFuture .supplyAsync(() -\u0026gt; queryBasicInfo(goodsId), executor); CompletableFuture\u0026lt;Integer\u0026gt; priceFuture = CompletableFuture .supplyAsync(() -\u0026gt; queryPrice(goodsId), executor); // 2. å¯¹ç»“æœè¿›è¡Œå¤„ç†è½¬æ¢ CompletableFuture\u0026lt;String\u0026gt; processedInfo = basicInfoFuture .thenApply(info -\u0026gt; \u0026#34;å¤„ç†åçš„å•†å“ä¿¡æ¯: \u0026#34; + info) .exceptionally(ex -\u0026gt; \u0026#34;è·å–å•†å“ä¿¡æ¯å¤±è´¥\u0026#34;); // 3. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆå¹¶ç»„è£…ç»“æœ CompletableFuture.allOf(processedInfo, priceFuture).join(); result.setInfo(processedInfo.join()); result.setPrice(priceFuture.join()); return result; } /** * CountDownLatchæ–¹å¼ - ä»…æ”¯æŒç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆ */ public GoodsInfo getGoodsInfoWithCDL(String goodsId) throws InterruptedException { GoodsInfo result = new GoodsInfo(); CountDownLatch latch = new CountDownLatch(2); // 1. éœ€è¦æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ executor.submit(() -\u0026gt; { try { result.setInfo(queryBasicInfo(goodsId)); } finally { latch.countDown(); } }); executor.submit(() -\u0026gt; { try { result.setPrice(queryPrice(goodsId)); } finally { latch.countDown(); } }); // 2. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ latch.await(); return result; } å¦‚æœéœ€è¦å¼‚æ­¥å¹¶è¡Œ + ä»»åŠ¡ç¼–æ’ï¼Œå°±ç”¨ CompletableFuture ï¼›å¦‚æœåªæ˜¯ç”¨äºç­‰å¾…ä¸€æ‰¹å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå°±ç”¨ CountDownLaunch\npublic class GoodsController { /** * ä¼˜åŒ–åçš„æ–¹æ³•ï¼Œæ ¹æ®å•†å“idè·å–å•†å“ä¿¡æ¯(åŸºæœ¬ä¿¡æ¯ã€æè¿°ä¿¡æ¯ã€è¯„è®ºé‡ï¼Œæ”¶è—é‡) * * @param goodsId å•†å“id * @return * @throws InterruptedException */ @GetMapping(\u0026#34;/getGoodsDetailNew\u0026#34;) public GoodsDetailResponse getGoodsDetailNew(@RequestParam(\u0026#34;goodsId\u0026#34;) String goodsId) { long st = System.currentTimeMillis(); GoodsDetailResponse goodsDetailResponse = new GoodsDetailResponse(); // 1ã€è·å–å•†å“åŸºæœ¬ä¿¡æ¯ï¼Œè€—æ—¶100ms CompletableFuture\u0026lt;Void\u0026gt; goodsInfoCf = CompletableFuture.runAsync(() -\u0026gt; goodsDetailResponse.setGoodsInfo(this.getGoodsInfo(goodsId)), this.goodsThreadPool); //2ã€è·å–å•†å“æè¿°ä¿¡æ¯ï¼Œè€—æ—¶100ms CompletableFuture\u0026lt;Void\u0026gt; goodsDescriptionCf = CompletableFuture.runAsync(() -\u0026gt; goodsDetailResponse.setGoodsDescription(this.getGoodsDescription(goodsId)), this.goodsThreadPool); //3ã€è·å–å•†å“è¯„è®ºé‡ï¼Œè€—æ—¶100ms CompletableFuture\u0026lt;Void\u0026gt; goodsCommentCountCf = CompletableFuture.runAsync(() -\u0026gt; goodsDetailResponse.setCommentCount(this.getGoodsCommentCount(goodsId)), this.goodsThreadPool); //4ã€è·å–å•†å“æ”¶è—é‡ï¼Œè€—æ—¶100ms CompletableFuture\u0026lt;Void\u0026gt; goodsFavoriteCountCf = CompletableFuture.runAsync(() -\u0026gt; goodsDetailResponse.setFavoriteCount(this.getGoodsFavoriteCount(goodsId)), this.goodsThreadPool); //ç­‰å¾…ä¸Šé¢æ‰§è¡Œç»“æŸ CompletableFuture.allOf(goodsInfoCf, goodsDescriptionCf, goodsCommentCountCf, goodsFavoriteCountCf).join(); // æ€»è€—æ—¶å¤§çº¦åœ¨100mså·¦å³ LOGGER.info(\u0026#34;è·å–å•†å“ä¿¡æ¯ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡ŒæŸ¥è¯¢è€—æ—¶ï¼š{} ms\u0026#34;, (System.currentTimeMillis() - st)); return goodsDetailResponse; } } 6. å¹¶è¡ŒæŸ¥è¯¢å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson006\n6.1 å¹¶è¡ŒæŸ¥è¯¢ä¸­å­˜åœ¨çš„é—®é¢˜ å¹¶è¡ŒæŸ¥è¯¢æ‰€ç”¨åˆ°çš„çº¿ç¨‹æ± é…ç½®æ˜¯éå¸¸å…³é”®ä¸”é‡è¦çš„é…ç½®ï¼Œå¦‚æœè®¾ç½®ä¸å½“å¯èƒ½å‡ºç°ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚\næ¯”å¦‚å°†æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸ºäº† 1 ï¼Œè€Œé˜Ÿåˆ—å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯·æ±‚éƒ½å˜æˆä¸²è¡Œäº†ï¼Œä¼šå¯¼è‡´è¯·æ±‚å“åº”éå¸¸æ…¢ã€‚å¦å¤–ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± å’Œé˜Ÿåˆ—å¤§å°çš„ä¸Šé™ä¹Ÿåº”è¯¥åŒ¹é…ã€‚å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ± è®¾ç½®ä¸º 10 ï¼Œè€Œé˜Ÿåˆ—å¤§å°æ²¡æœ‰è®¾ç½®ä¸Šé™ã€‚è¯¥çº¿ç¨‹æ± åŒæ—¶åªå¯æ”¯æŒ 10 ä¸ªä»»åŠ¡å¹¶è¡Œï¼Œå…¶ä»–çš„è¯·æ±‚éƒ½ä¼šå˜æˆä¸²è¡Œæ‰§è¡Œäº†ï¼Œè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œä»è€Œå¯¼è‡´æ¥å£å“åº”ç‰¹åˆ«æ…¢ã€‚\n6.2 å¦‚ä½•è§£å†³å¹¶è¡ŒæŸ¥è¯¢çš„é—®é¢˜ è§£å†³å¹¶è¡ŒæŸ¥è¯¢é—®é¢˜çš„æ ¸å¿ƒï¼šä¸è¦è®©ä»»åŠ¡æ’é˜Ÿæˆ–è€…æ’é˜Ÿæ—¶é—´ä¸è¦å¤ªé•¿\nä¸‹é¢ä»çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹å…¥æ‰‹ï¼Œä¼˜åŒ–å¹¶è¡ŒæŸ¥è¯¢é—®é¢˜\nã€è§£å†³æ–¹æ¡ˆã€‘\nå¢å¤§çº¿ç¨‹æ•°ï¼šå¯ä»¥å°†æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°è°ƒå¤§ï¼Œä½†ä¸èƒ½è°ƒåˆ°è¶…è¿‡CPUçš„æœ€å¤§è´Ÿè½½ï¼Œä¸ç„¶å¯èƒ½ä¼šé™ä½ç³»ç»Ÿæ€§èƒ½åˆ†ã€‚è¯¥å‚æ•°åº”è¯¥æ ¹æ®ä¸šåŠ¡çš„æŒ‡æ ‡è¿›è¡Œå‹æµ‹å¾—åˆ°ä¸€ä¸ªåˆç†çš„å€¼\nå‡å°‘é˜Ÿåˆ—æ•°ï¼š\nå°†é˜Ÿåˆ—å¤§å°è®¾ç½®çš„æ¯”è¾ƒå°ï¼Œè¿™æ ·æ’é˜Ÿçš„æ—¶é—´å¤§æ¦‚ç‡ä¼šæ¯”è¾ƒçŸ­ï¼Œæˆ–è€…æ’é˜Ÿå¤±è´¥ï¼Œç›´æ¥åé¢çš„æµç¨‹\nâš ï¸ ä¹‹å‰ç†è§£å­˜åœ¨è¯¯åŒºï¼šåº”è¯¥æ˜¯æ ¸å¿ƒçº¿ç¨‹æ£€æŸ¥å®Œäº†ï¼Œå°±æ£€æŸ¥èƒ½å¦æ”¾å…¥é˜Ÿåˆ—ï¼Œå†æ£€æŸ¥æœ€å¤§çº¿ç¨‹æ•°ã€‚è€Œä¸æ˜¯æ ¸å¿ƒçº¿ç¨‹æ£€æŸ¥å®Œï¼Œå°±å»æ£€æŸ¥æœ€å¤§çº¿ç¨‹æ•°ã€‚\nå‡å°‘é˜Ÿåˆ—æ•°è‡³ 0ï¼šè¿™æ ·ä»»åŠ¡å°±ä¸ä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œè€Œç›´æ¥åˆ›å»ºæ–°çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œæˆ–è€…èµ°æ‹’ç»ç­–ç•¥\nLinkedBlockingQueueã€ArrayBlockingQueue å®¹é‡æ˜¯ä¸å…è®¸ä¸º0çš„ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°å®¹é‡ä¸º0çš„é˜Ÿåˆ—ï¼Œåˆ™éœ€è¦ä½¿ç”¨åŒæ­¥é˜»å¡é˜Ÿåˆ— SynchronousQueue\næ‹’ç»ç­–ç•¥ï¼šå¯ä»¥ä½¿ç”¨ CallerRunsPolicyï¼Œè¿™ä¸ªç­–ç•¥æ˜¯ç›´æ¥åœ¨è°ƒç”¨çº¿ç¨‹çš„å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¯¥ç­–ç•¥å¯ä»¥ä¿è¯ä»»åŠ¡èƒ½å¿«é€Ÿè¢«å¤„ç†ï¼Œä¸ä¼šä¸€ç›´å¤„äºé˜»å¡æ€\nç­–ç•¥åç§° è¡Œä¸ºæè¿° é€‚ç”¨åœºæ™¯ ç”Ÿæ´»å®ä¾‹ç±»æ¯” AbortPolicy ç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸ éœ€è¦ä¸¥æ ¼ä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±çš„åœºæ™¯ é¤å…æ»¡å‘˜æ—¶ç›´æ¥æ‹’ç»æ–°é¡¾å®¢ CallerRunsPolicy è®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±æ‰§è¡Œè¯¥ä»»åŠ¡ éœ€è¦é™ä½ä»»åŠ¡æäº¤é€Ÿåº¦çš„åœºæ™¯ ç»ç†äº²è‡ªå¤„ç†æ— æ³•åˆ†é…çš„ä»»åŠ¡ DiscardPolicy é™é»˜ä¸¢å¼ƒæ–°ä»»åŠ¡ï¼Œä¸æŠ›å¼‚å¸¸ä¹Ÿä¸æ‰§è¡Œ å…è®¸ä¸¢å¼ƒéå…³é”®ä»»åŠ¡çš„åœºæ™¯ å¿«é€’çˆ†ä»“æ—¶ç›´æ¥ä¸¢å¼ƒæ–°åŒ…è£¹ DiscardOldestPolicy ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤å½“å‰ä»»åŠ¡ ä¼˜å…ˆå¤„ç†æ–°ä»»åŠ¡çš„åœºæ™¯ è¶…å¸‚æ’é˜Ÿæ—¶è®©ç­‰å¾…æœ€ä¹…çš„é¡¾å®¢ç¦»å¼€ çº¿ç¨‹æ± éš”ç¦»ï¼šä¸åŒçš„ä¸šåŠ¡æœ€å¥½ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œäº’ä¸å½±å“ï¼Œå¼ºçƒˆå»ºè®®æ ¸å¿ƒä¸šåŠ¡ä¸€å®šè¦ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ± ã€‚\nã€ä¼˜åŒ–åçš„çº¿ç¨‹æ± é…ç½®ã€‘\n@Bean public ThreadPoolTaskExecutor goodsThreadPool() { ThreadPoolTaskExecutor threadPoolTaskExecutor = new ThreadPoolTaskExecutor(); threadPoolTaskExecutor.setThreadNamePrefix(\u0026#34;ThreadPool-Goods-\u0026#34;); // æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºcpuæ ¸æ•° * 4ï¼Œæœ€å¤§çº¿ç¨‹æ•°æ®ä¸ºcpuæ ¸æ•° * 8 threadPoolTaskExecutor.setCorePoolSize(Runtime.getRuntime().availableProcessors() * 4); threadPoolTaskExecutor.setMaxPoolSize(Runtime.getRuntime().availableProcessors() * 8); // é˜Ÿåˆ—å®¹é‡ä¸º0ï¼Œåˆ™ä»»åŠ¡å°±ä¸ä¼šè¿›å…¥é˜Ÿåˆ— threadPoolTaskExecutor.setQueueCapacity(0); // æ‹’ç»ç­–ç•¥ä½¿ç”¨CallerRunsPolicyï¼Œè®©å½“å‰çº¿ç¨‹å»å…œåº•å»æ‰§è¡Œä»»åŠ¡ threadPoolTaskExecutor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); return threadPoolTaskExecutor; } 7. æ¥å£æ€§èƒ½è°ƒä¼˜ä¹‹å¤§ (é•¿) äº‹åŠ¡ä¼˜åŒ– æ—¥å¸¸ç¼–ç¨‹ä¸­ï¼Œå®¹æ˜“é‡åˆ°äº‹åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æƒ…å†µã€‚å¦‚æœè¯¥äº‹åŠ¡çš„å¯¹åº”çš„æ¥å£ï¼Œè¯·æ±‚é‡æš´å¢ï¼Œç”±äºæ•°æ®åº“è¿æ¥æ± çš„é™åˆ¶ï¼Œå¤§éƒ¨åˆ†è¯·æ±‚å¯èƒ½ä¼šå¤±è´¥ã€‚\nç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson009\n7.1 å¤§(é•¿)äº‹åŠ¡æ‰€å¸¦æ¥çš„é—®é¢˜ ä¸‹é¢çš„ä»£ç å¸¦æœ‰ @Transcational æ³¨è§£ï¼Œ è¯´æ˜è¯¥æ–¹æ³•ä¼šäº¤ç»™ Spring æ¥ç®¡ç†è¯¥æ–¹æ³•çš„äº‹åŠ¡ã€‚å…·ä½“æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š\n1ã€Springå»æ•°æ®åº“è¿æ¥æ± æ‹¿åˆ°ä¸€ä¸ªæ•°æ®åº“è¿æ¥ 2ã€å¼€å¯äº‹åŠ¡ 3ã€æ‰§è¡ŒbigTransaction()ä¸­çš„ä»£ç  4ã€æäº¤äº‹åŠ¡ 5ã€å°†æ•°æ®åº“è¿æ¥è¿˜ç»™æ•°æ®åº“è¿æ¥æ± ä¸­ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“è¿æ¥ä¼šä¸€ç›´è¢«å ç”¨ã€‚å› ä¸ºæ•°æ®åº“è¿æ¥æ—¶æœ‰é™çš„ï¼Œå¹¶ä¸”æ˜¯éå¸¸ç¨€ç¼ºçš„èµ„ã€‚å¦‚æœé•¿æ—¶é—´è¢«å ç”¨ï¼Œå¹¶ä¸”æ•°æ®åº“è¿æ¥æ± ä¸­çš„å¯ç”¨è¿æ¥éƒ½è¢«å ç”¨äº†ï¼Œåˆ™å…¶ä»–è¯·æ±‚æ— æ³•è¿æ¥æ•°æ®åº“ã€‚å®ƒä¼šå¯¼è‡´è¿æ¥è¶…æ—¶ï¼Œæ‰§è¡Œæ–¹æ³•å¤±è´¥ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ–¹æ³•ä¸­ this.getData() æ–¹æ³•ä¼šå ç”¨ 5s çš„æ—¶é—´ã€‚å¦‚æœ 5s å†…æœ‰ 100 æ¡è¯·æ±‚å¹¶å‘æ‰§è¡Œï¼Œä¸”æ•°æ®åº“è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ä¸º 20ï¼Œè¶…æ—¶æ—¶é—´ä¸º3sã€‚ åˆ™å‰©ä½™çš„ 80 æ¡è¯·æ±‚ï¼Œéƒ½ä¼šå‡ºç°è¿æ¥å¤±è´¥çš„ç°è±¡ã€‚\n@Transactional public void bigTransaction() throws InterruptedException { // 1ã€getData()æ–¹æ³•æ¨¡æ‹Ÿä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„è·å–æ•°æ®çš„æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨ä¼šä¼‘çœ 5ç§’ String data = this.getData(); //2ã€å°†ä¸Šé¢è·å–åˆ°çš„æ•°æ®å†™å…¥åˆ°dbä¸­ Lesson007PO po = new Lesson007PO(); po.setId(UUID.randomUUID().toString()); po.setData(data); this.lesson007Mapper.insert(po); } public String getData() throws InterruptedException { //ä¼‘çœ 5ç§’ TimeUnit.SECONDS.sleep(5); return UUID.randomUUID().toString(); } 7.2 å¦‚ä½•è§£å†³å¤§ (é•¿) äº‹åŠ¡çš„é—®é¢˜ (æ‹†åˆ†ä¸ºå°äº‹åŠ¡) ä¼˜åŒ–æ–¹æ³•ï¼šå°†å¤§(é•¿)äº‹åŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå°†æ— éœ€æ•°æ®åº“è¿æ¥çš„éƒ¨åˆ†æ‹†å‡ºæ¥ï¼Œå°†äº‹åŠ¡æœ€å°åŒ–ã€‚ ä¾‹å¦‚ï¼Œä¸Šæ–¹çš„ä»£ç ä¸­ï¼Œthis.getData() æ–¹æ³•æ˜¯ä¸éœ€è¦æ“ä½œæ•°æ®åº“çš„ï¼Œåªæœ‰æœ€åçš„ insert æ–¹æ³•æ‰éœ€è¦è¿æ¥æ•°æ®åº“ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°†äº‹åŠ¡çš„ç²’åº¦æ§åˆ¶åœ¨ insert æ–¹æ³•ä¸­ã€‚\nTranscationTemplateï¼šSpringä¸­çš„ TranscationTemplate å·¥å…·ç±»èƒ½å¤Ÿé‡‡ç”¨ç¼–ç¨‹å¼çš„æ–¹æ¡ˆï¼Œçµæ´»æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ã€‚\n/** * ä½¿ç”¨ TransactionTemplate ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œå¯ä»¥çµæ´»çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ * * @throws InterruptedException */ public void smallTransaction() throws InterruptedException { // 1ã€è°ƒç”¨getData()æ–¹æ³•ï¼Œè®²è·å–çš„æ•°æ®å†™åˆ°dbä¸­ï¼Œå‡è®¾ getDataæ–¹æ³•æ¯”è¾ƒè€—æ—¶ï¼Œæ¯”å¦‚è€—æ—¶ 5ç§’ String data = this.getData(); //2ã€å°†ä¸Šé¢è·å–åˆ°çš„æ•°æ®å†™å…¥åˆ°dbä¸­ Lesson007PO po = new Lesson007PO(); po.setId(UUID.randomUUID().toString()); po.setData(data); // this.transactionTemplate.executeWithoutResultå¯ä»¥ä¼ å…¥ä¸€ä¸ªConsumerï¼Œè¿™ä¸ªConsumerè¡¨è¿°éœ€è¦åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œçš„ä¸šåŠ¡æ“ä½œ this.transactionTemplate.executeWithoutResult(action -\u0026gt; { this.lesson007Mapper.insert(po); }); } ã€æ€»ç»“ã€‘\næ§åˆ¶äº‹åŠ¡ç²’åº¦ ï¼šä½¿ç”¨ TransactionTemplate ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œç²¾å‡†æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ï¼Œå°½é‡è®©äº‹åŠ¡å°å‹åŒ– éæ•°æ®åº“ç›¸å…³ä»£ç ï¼Œé¿å…å‡ºç°åœ¨äº‹åŠ¡ä¸­ï¼šå°½é‡é¿å…å°†æ²¡æœ‰äº‹åŠ¡çš„è€—æ—¶æ“ä½œæ”¾åˆ°äº‹åŠ¡ä»£ç ä¸­ï¼›é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œè¿œç¨‹æ“ä½œï¼Œè¿œç¨‹æ“ä½œæ˜¯ä¸éœ€è¦ç”¨åˆ°æœ¬åœ°äº‹åŠ¡çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦æ”¾åœ¨äº‹åŠ¡ä¸­ äº‹åŠ¡é›†ä¸­åŒ–ï¼šå°½é‡è®©äº‹åŠ¡çš„æ“ä½œé›†ä¸­åœ¨ä¸€èµ·æ‰§è¡Œï¼Œæ¯”å¦‚éƒ½æ”¾åˆ°æ–¹æ³•æœ€åï¼Œä½¿ç”¨ TransactionTemplate æ‰§è¡Œï¼Œè¿™æ ·å¯ä½¿äº‹åŠ¡æœ€å°åŒ– 8. åŠ¨æ€çº¿ç¨‹æ±  ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson009\n8.1 ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€çº¿ç¨‹æ±  å¹³æ—¶æˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œåˆ›å»ºäº†ä¸å°‘çº¿ç¨‹æ± ï¼Œè¿™äº›çº¿ç¨‹æ± éƒ½å¤„äºæ¸¸ç¦»çŠ¶æ€ï¼Œä¸æ–¹ä¾¿ç®¡ç†å’Œç›‘æ§ã€‚æ— æ³•çŸ¥é“ç›®å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›çº¿ç¨‹æ± ã€ä»¥åŠæ¯ä¸ªçº¿ç¨‹æ± å½“å‰çš„ä¸€ä¸ªçŠ¶æ€ï¼Œè´Ÿè½½æƒ…å†µç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼€å‘ä¸€ä¸ªçº¿ç¨‹æ± ç®¡ç†å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n8.2 çº¿ç¨‹æ± ç®¡ç†å™¨ ç»Ÿç®¡ç³»ç»Ÿä¸­æ‰€æœ‰çº¿ç¨‹æ± ï¼Œè´Ÿè´£æ‰€æœ‰çº¿ç¨‹æ± çš„åˆ›å»ºã€ç›‘æ§ç­‰æ“ä½œã€‚\npublic class ThreadPoolManager { /** çº¿ç¨‹æ± Map */ private static Map\u0026lt;String, ThreadPoolTaskExecutor\u0026gt; threadPoolMap = new ConcurrentHashMap\u0026lt;String, ThreadPoolTaskExecutor\u0026gt;(16); /** * åˆ›å»ºæ–°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± å·²ç»åˆ›å»ºï¼Œè¿”å›å·²ç»åˆ›å»ºçš„çº¿ç¨‹æ±  * * @param name çº¿ç¨‹æ± åç§° * @param corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•° * @param maxPoolSize æœ€å¤§çº¿ç¨‹æ•° * @param queueCapacity é˜Ÿåˆ—å¤§å° * @param keepAliveSeconds çº¿ç¨‹æ± å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰ * @param threadFactory çº¿ç¨‹å·¥å‚ * @param rejectedExecutionHandler æ‹’ç»ç­–ç•¥ * @return */ public static ThreadPoolTaskExecutor newThreadPool(String name, int corePoolSize, int maxPoolSize, int queueCapacity, int keepAliveSeconds, ThreadFactory threadFactory, RejectedExecutionHandler rejectedExecutionHandler) { return threadPoolMap.computeIfAbsent(name, threadGroupName -\u0026gt; { ThreadPoolTaskExecutor threadPoolExecutor = new ThreadPoolTaskExecutor() { private boolean initialized = false; // åˆå§‹åŒ–æ ‡è®° @Override protected BlockingQueue\u0026lt;Runnable\u0026gt; createQueue(int queueCapacity) { if (queueCapacity \u0026gt; 0) { // ä½¿ç”¨è‡ªå®šä¹‰çš„ ResizeLinkedBlockingQueue æ›¿ä»£é»˜è®¤é˜Ÿåˆ—ï¼Œä¿è¯èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´é˜Ÿåˆ—å¤§å° return new ResizeLinkedBlockingQueue\u0026lt;\u0026gt;(queueCapacity); } else { // å½“é˜Ÿåˆ—å®¹é‡è®¾ç½®ä¸º0æ—¶ï¼Œä½¿ç”¨ SynchronousQueueã€‚è¡¨ç¤ºä»»åŠ¡å¿…é¡»ç«‹å³è¢«çº¿ç¨‹å¤„ç†ï¼Œå¦åˆ™å°±ä¼šè¢«æ‹’ç» return new SynchronousQueue\u0026lt;\u0026gt;(); } } @Override public void setQueueCapacity(int queueCapacity) { // ç¡®ä¿çº¿ç¨‹æ± å·²åˆå§‹åŒ–ä¸”é˜Ÿåˆ—ç±»å‹æ­£ç¡®æ—¶æ‰è°ƒæ•´å®¹é‡ if (this.initialized \u0026amp;\u0026amp; this.getThreadPoolExecutor() != null \u0026amp;\u0026amp; this.getThreadPoolExecutor().getQueue() != null \u0026amp;\u0026amp; this.getThreadPoolExecutor().getQueue() instanceof ResizeLinkedBlockingQueue) { ((ResizeLinkedBlockingQueue) this.getThreadPoolExecutor().getQueue()).setCapacity(queueCapacity); } super.setQueueCapacity(queueCapacity); } @Override public void afterPropertiesSet() { // ä½¿ç”¨ initialized æ ‡è®°ç¡®ä¿çº¿ç¨‹æ± åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ if (initialized) { return; } super.afterPropertiesSet(); this.initialized = true; } }; // è®¾ç½®å‚æ•° threadPoolExecutor.setCorePoolSize(corePoolSize); ... if (threadFactory != null) { // ThreadFactoryç›¸å½“äºçº¿ç¨‹æ± çš„ä¸€äº›è§„å®š (æ‹›è˜æ ‡å‡†) threadPoolExecutor.setThreadFactory(threadFactory); } if (rejectedExecutionHandler != null) { // æ‹’ç»æ‰§è¡Œçš„ç­–ç•¥ï¼Œä¸Šæ–¹æåˆ°çš„å››ç§æ‹’ç»ç­–ç•¥ threadPoolExecutor.setRejectedExecutionHandler(rejectedExecutionHandler); } threadPoolExecutor.afterPropertiesSet(); return threadPoolExecutor; }); } /** è·å–æ‰€æœ‰çº¿ç¨‹æ± ä¿¡æ¯ */ public static List\u0026lt;ThreadPoolInfo\u0026gt; threadPoolInfoList() { return threadPoolMap .entrySet() .stream() .map(entry -\u0026gt; threadPoolInfo(entry.getKey(), entry.getValue())) .collect(Collectors.toList()); } } 8.3 åŠ¨æ€çº¿ç¨‹æ±  åŠ¨æ€çº¿ç¨‹æ± ï¼šæ— éœ€é‡å¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹çº¿ç¨‹æ± è¿›è¡Œæ‰©ç¼©å®¹ï¼Œæ¯”å¦‚æ”¹å˜çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€æœ€å¤§çº¿ç¨‹æ•°é‡ã€é˜Ÿåˆ—å®¹é‡ç­‰ã€‚\n8.3.1 å¸¸ç”¨åŠ¨æ€çº¿ç¨‹æ±  dynamic-tpï¼šhttps://github.com/dromara/dynamic-tp\n8.3.2 æ‰‹åŠ¨å®ç°åŠ¨æ€çº¿ç¨‹æ±  çº¿ç¨‹æ± ä¸­ä¼šç”¨åˆ°Javaä¸­çš„é˜»å¡é˜Ÿåˆ— java.util.concurrent.BlockingQueueï¼Œç›®å‰ jdkä¸­è‡ªå¸¦å‡ ä¸ªé˜»å¡é˜Ÿåˆ—éƒ½ä¸æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚ æ¯”å¦‚ java.util.concurrent.LinkedBlockingQueueï¼Œå®ƒçš„ capacity æ˜¯ final ä¿®é¥°çš„ï¼Œä¸æ”¯æŒä¿®æ”¹ã€‚\nåŠ¨æ€è°ƒæ•´å¤§å°çš„å‰æï¼šåŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å¤§å°éœ€è¦é˜Ÿåˆ—å®¹é‡èƒ½å¤Ÿæ”¯æŒè°ƒæ•´ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¯æ‰©å®¹çš„é˜»å¡é˜Ÿåˆ— ResizeLinkedBlockingQueueã€‚ä»£ç æ˜¯ä»LinkedBlockingQueue ä¸­æ‹·è´è¿‡æ¥çš„ï¼Œå¢åŠ å¯ä¿®æ”¹å®¹é‡ çš„setCapacity æ–¹æ³•ã€‚ç„¶ååˆ›å»ºçº¿ç¨‹æ± çš„æ—¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„é˜»å¡é˜Ÿåˆ—ä¾¿å¯ä»¥å®ç°çº¿ç¨‹æ± çš„åŠ¨æ€æ‰©å®¹ã€‚\n/** * è®¾ç½®å®¹é‡ * @param capacity */ public void setCapacity(int capacity) { if (capacity \u0026lt;= 0) throw new IllegalArgumentException(); final ReentrantLock putLock = this.putLock; putLock.lock(); try { if (count.get() \u0026gt; capacity) { throw new IllegalArgumentException(); } this.capacity = capacity; } finally { putLock.unlock(); } } åŠ¨æ€æ›´æ”¹çº¿ç¨‹æ± å¤§å°çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class ThreadPoolManager { /** * åŠ¨æ€å˜æ›´çº¿ç¨‹æ± ï¼ˆå¦‚ï¼šæ‰©ç¼©å®¹ã€æ‰©ç¼©é˜Ÿåˆ—å¤§å°ï¼‰ * @param threadPoolChange å˜æ›´çº¿ç¨‹æ± ä¿¡æ¯ */ public static void changeThreadPool(ThreadPoolChange threadPoolChange) { ThreadPoolTaskExecutor threadPoolTaskExecutor = threadPoolMap.get(threadPoolChange.getName()); if (threadPoolTaskExecutor == null) { throw new IllegalArgumentException(); } if (threadPoolChange.getCorePoolSize() \u0026gt; threadPoolChange.getMaxPoolSize()) { throw new IllegalArgumentException(); } synchronized (ThreadPoolManager.class) { // å¢åŠ çº¿ç¨‹æƒ…å†µï¼šéœ€è¦ä¿®æ”¹çš„æœ€å¤§çº¿ç¨‹å¤§äºå½“å‰æ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™è®¾ç½®å½“å‰æ ¸å¿ƒçº¿ç¨‹ä¸ºä¿®æ”¹åçš„æœ€å¤§çº¿ç¨‹ if (threadPoolChange.getMaxPoolSize() \u0026gt; threadPoolTaskExecutor.getCorePoolSize()) { // å…ˆè°ƒæ•´æœ€å¤§çº¿ç¨‹æ•°ï¼Œå†è°ƒæ•´æ ¸å¿ƒæ•° ï¼ˆå…ˆæ‰©å¤§æ€»é‡ï¼Œå†æ‰©å¤§å±€éƒ¨ï¼‰ threadPoolTaskExecutor.setMaxPoolSize(threadPoolChange.getMaxPoolSize()); threadPoolTaskExecutor.setCorePoolSize(threadPoolChange.getCorePoolSize()); threadPoolTaskExecutor.setQueueCapacity(threadPoolChange.getQueueCapacity()); } else { // å…ˆå‡å°‘å±€éƒ¨ï¼Œå†å‡å°‘æ€»é‡ threadPoolTaskExecutor.setCorePoolSize(threadPoolChange.getCorePoolSize()); threadPoolTaskExecutor.setMaxPoolSize(threadPoolChange.getMaxPoolSize()); threadPoolTaskExecutor.setQueueCapacity(threadPoolChange.getQueueCapacity()); } } } } åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡ 1. SpringBootå®ç°åŠ¨æ€Jobçš„å®æˆ˜ ç›¸å…³ä»£ç ï¼šhttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson011\n1.1 Jobè¡¨ - è¡¨ç»“æ„ å­—æ®µå ç±»å‹ å¯ç©º é»˜è®¤ å¤‡æ³¨ id varchar(50) å¦ - idï¼Œä¸»é”® name varchar(100) å¦ - jobåç§°ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§° cron varchar(50) å¦ - jobçš„æ‰§è¡Œå‘¨æœŸï¼Œcronè¡¨è¾¾å¼ bean_name varchar(100) å¦ - jobéœ€è¦æ‰§è¡Œé‚£ä¸ªbeanï¼Œå¯¹åº”springä¸­beançš„åç§° bean_method varchar(100) å¦ - jobæ‰§è¡Œçš„beançš„æ–¹æ³• status smallint å¦ 0 jobçš„çŠ¶æ€,0ï¼šåœæ­¢ï¼Œ1ï¼šæ‰§è¡Œä¸­ 1.2 Jobæ‰§è¡Œç®¡ç†å™¨ @Component public class SpringJobRunManager implements CommandLineRunner { // applicationContext ä¸»è¦ç”¨äºåœ¨ä»»åŠ¡æ‰§è¡Œæ—¶åŠ¨æ€è·å–å’Œè°ƒç”¨æŒ‡å®šçš„ Bean å’Œæ–¹æ³•ï¼Œå®ç°çµæ´»çš„ä»»åŠ¡è°ƒåº¦ã€‚ // å¯ä»¥æŠŠå®ƒç†è§£ä¸ºâ€œSpring ç®¡ç†çš„å¯¹è±¡å·¥å‚å’ŒæœåŠ¡æ€»çº¿â€ @Autowired private ApplicationContext applicationContext; // threadPoolTaskScheduler æ˜¯ Spring æä¾›çš„çº¿ç¨‹æ± å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼Œä¸»è¦ç”¨äºåœ¨åº”ç”¨ä¸­ä»¥å¤šçº¿ç¨‹æ–¹å¼æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å®šæ—¶æ‰§è¡Œã€Cronè¡¨è¾¾å¼è°ƒåº¦ç­‰ï¼‰ @Autowired private ThreadPoolTaskScheduler threadPoolTaskScheduler; // jobè¡¨ç›¸å…³æœåŠ¡ @Autowired private JobService jobService; /** * ç³»ç»Ÿé‡æ­£åœ¨è¿è¡Œä¸­çš„jobåˆ—è¡¨ */ private Map\u0026lt;String, SpringJobTask\u0026gt; runningJobMap = new ConcurrentHashMap\u0026lt;\u0026gt;(); /** * springbootåº”ç”¨å¯åŠ¨åä¼šå›è°ƒ * * @param args incoming main method arguments * @throws Exception */ @Override public void run(String... args) throws Exception { //1ã€å¯åŠ¨job this.startAllJob(); //2ã€ç›‘æ§dbä¸­jobçš„å˜åŒ–ï¼ˆjobå¢ã€åˆ ã€æ”¹ï¼‰ï¼Œç„¶ååŒæ­¥ç»™jobæ‰§è¡Œå™¨å»æ‰§è¡Œ this.monitorDbJobChange(); } } Springbootåº”ç”¨å¯åŠ¨ä¹‹åä¼šå›è°ƒ CommandLineRunner ä¸­çš„ run æ–¹æ³•ï¼Œä¾æ¬¡å¯åŠ¨jobï¼Œå¹¶ç›‘æ§jobä¸­çš„å˜åŒ–ã€‚\n1.2.1 å¯åŠ¨job å¯åŠ¨jobçš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä»æ•°æ®åº“ä¸­æ‰¾å‡ºæ‰€æœ‰éœ€è¦å¯åŠ¨çš„jobï¼ˆçŠ¶æ€ä¸ºstartï¼‰ï¼Œç„¶åå¾ªç¯å¯åŠ¨ã€‚\nå¯åŠ¨jobå…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š\nprivate void startAllJob() { List\u0026lt;Job\u0026gt; jobList = this.jobService.getStartJobList(); for (Job job : jobList) { this.startJob(job); } } /** * å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆjobï¼‰ * * @param job éœ€è¦å¯åŠ¨çš„ä»»åŠ¡å¯¹è±¡ */ private void startJob(Job job) { // 1. åˆ›å»ºä»»åŠ¡æ‰§è¡Œä½“ï¼Œæ³¨å…¥Springä¸Šä¸‹æ–‡ï¼Œä¾¿äºä»»åŠ¡å†…è·å–Beanå¯¹è±¡ SpringJobTask springJobTask = new SpringJobTask(job, this.applicationContext); // 2. æ ¹æ®jobçš„cronè¡¨è¾¾å¼åˆ›å»ºè°ƒåº¦è§¦å‘å™¨ CronTrigger trigger = new CronTrigger(job.getCron()); // 3. ä½¿ç”¨çº¿ç¨‹æ± è°ƒåº¦å™¨æ³¨å†Œä»»åŠ¡ï¼Œè¿”å›è°ƒåº¦å¥æŸ„ ScheduledFuture\u0026lt;?\u0026gt; scheduledFuture = this.threadPoolTaskScheduler.schedule(springJobTask, trigger); // 4. è®°å½•è°ƒåº¦å¥æŸ„åˆ°ä»»åŠ¡å¯¹è±¡ï¼Œä¾¿äºåç»­å–æ¶ˆ -\u0026gt; springJobTask.setScheduledFuture(scheduledFuture); // 5. å°†ä»»åŠ¡æ”¾å…¥è¿è¡Œä¸­çš„ä»»åŠ¡Mapï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ runningJobMap.put(job.getId(), springJobTask); // 6. è®°å½•æ—¥å¿—ï¼Œæ–¹ä¾¿è¿½è¸ª logger.info(\u0026#34;å¯åŠ¨ job æˆåŠŸ:{}\u0026#34;, JSONUtil.toJsonStr(job)); } /** * åˆ é™¤ï¼ˆåœæ­¢ï¼‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ * @param job éœ€è¦åˆ é™¤çš„ä»»åŠ¡å¯¹è±¡ */ private void deleteJob(Job job) { if (job == null) { return; } // 1. ä»è¿è¡Œä¸­çš„ä»»åŠ¡Mapè·å–ä»»åŠ¡ SpringJobTask springJobTask = this.runningJobMap.get(job.getId()); if (springJobTask == null) { return;} // 2. å–æ¶ˆä»»åŠ¡è°ƒåº¦ï¼ˆåœæ­¢å®šæ—¶æ‰§è¡Œï¼‰ springJobTask.getScheduledFuture().cancel(false); // 3. ä»Mapä¸­ç§»é™¤è¯¥ä»»åŠ¡ runningJobMap.remove(job.getId()); // 4. è®°å½•æ—¥å¿— logger.info(\u0026#34;ç§»é™¤ job æˆåŠŸ:{}\u0026#34;, JSONUtil.toJsonStr(job)); } /** * æ›´æ–°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆå…ˆåˆ é™¤å†å¯åŠ¨ï¼‰ * @param job éœ€è¦æ›´æ–°çš„ä»»åŠ¡å¯¹è±¡ */ public void updateJob(Job job) { // 1. å…ˆåˆ é™¤æ—§çš„ä»»åŠ¡ this.deleteJob(job); // 2. å†å¯åŠ¨æ–°çš„ä»»åŠ¡ this.startJob(job); // 3. è®°å½•æ—¥å¿— logger.info(\u0026#34;æ›´æ–° job æˆåŠŸ:{}\u0026#34;, JSONUtil.toJsonStr(job)); } 1.2.2 åŠ¨æ€ç›‘æ§DBä¸­jobçš„å˜åŒ– /** * ç›‘æ§dbä¸­jobçš„å˜åŒ–ï¼Œæ¯5ç§’ç›‘æ§ä¸€æ¬¡ï¼Œè¿™ä¸ªé¢‘ç‡å¤§å®¶ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç¨å¾®è°ƒå¤§ç‚¹ */ private void monitorDbJobChange() { this.threadPoolTaskScheduler.scheduleWithFixedDelay(this::jobChangeDispose, Duration.ofSeconds(5)); } // ä»»åŠ¡å˜åŒ–å¤„ç† private void jobChangeDispose() { //1ã€ä»dbä¸­æ‹¿åˆ°æ‰€æœ‰jobï¼Œå’Œç›®å‰å†…å­˜ä¸­æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰jobå¯¹æ¯”ï¼Œå¯å¾—åˆ°æœ¬æ¬¡æ–°å¢çš„jobã€åˆ é™¤çš„jobã€æ›´æ–°çš„job JobChange jobChange = this.getJobChange(); //2ã€å¤„ç†æ–°å¢çš„job for (Job job : jobChange.getAddJobList()) { this.startJob(job);} //3ã€å¤„ç†åˆ é™¤çš„job for (Job job : jobChange.getDeleteJobList()) { this.deleteJob(job);} //4ã€å¤„ç†å˜åŒ–çš„job for (Job job : jobChange.getUpdateJobList()) { this.updateJob(job);} } private JobChange getJobChange() { //æ–°å¢çš„job List\u0026lt;Job\u0026gt; addJobList = new ArrayList\u0026lt;\u0026gt;(); //åˆ é™¤çš„job List\u0026lt;Job\u0026gt; deleteJobList = new ArrayList\u0026lt;\u0026gt;(); //æ›´æ–°çš„job List\u0026lt;Job\u0026gt; updateJobList = new ArrayList\u0026lt;\u0026gt;(); //ä»dbä¸­æ‹¿åˆ°æ‰€æœ‰jobï¼Œå’Œç›®å‰å†…å­˜ä¸­æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰jobå¯¹æ¯”ï¼Œå¯å¾—åˆ°æœ¬æ¬¡æ–°å¢çš„jobã€åˆ é™¤çš„jobã€æ›´æ–°çš„job List\u0026lt;Job\u0026gt; startJobList = this.jobService.getStartJobList(); for (Job job : startJobList) { SpringJobTask springJobTask = runningJobMap.get(job.getId()); if (springJobTask == null) { addJobList.add(job); } else { //jobçš„æ‰§è¡Œè§„åˆ™å˜äº† if (jobIsChange(job, springJobTask.getJob())) { updateJobList.add(job); } } } //è·å–è¢«åˆ é™¤çš„jobï¼ŒspringJobTaskMapä¸­å­˜åœ¨çš„ï¼Œè€ŒstartJobListä¸å­˜åœ¨çš„ï¼Œåˆ™æ˜¯éœ€è¦ä»å½“å‰è¿è¡Œåˆ—è¡¨ä¸­åœæ­¢ç§»é™¤çš„ Set\u0026lt;String\u0026gt; startJobIdList = CollUtils.convertSet(startJobList, Job::getId); for (Map.Entry\u0026lt;String, SpringJobTask\u0026gt; springJobTaskEntry : runningJobMap.entrySet()) { if (!startJobIdList.contains(springJobTaskEntry.getKey())) { deleteJobList.add(springJobTaskEntry.getValue().getJob()); } } //è¿”å›jobå˜æ›´ç»“æœ return new JobChange(addJobList, updateJobList, deleteJobList); } /** * æ£€æµ‹ä¸¤ä¸ªjobæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œï¼ˆcronã€beanNameã€beanMethodï¼‰ä¸­æœ‰ä»»æ„ä¸€é¡¹å˜åŠ¨äº†ï¼Œåˆ™è¿”å›true * * @param job1 * @param job2 * @return */ private boolean jobIsChange(Job job1, Job job2) { return !(Objects.equals(job1.getCron(), job2.getCron()) \u0026amp;\u0026amp; Objects.equals(job1.getBeanName(), job2.getBeanName()) \u0026amp;\u0026amp; Objects.equals(job1.getBeanMethod(), job2.getBeanMethod())); } ","permalink":"https://swimmingliu.cn/posts/job/java-scene-quiz-100/","summary":"\u003ch1 id=\"å¹¶å‘ä¸æ€§èƒ½ä¼˜åŒ–\"\u003eå¹¶å‘ä¸æ€§èƒ½ä¼˜åŒ–\u003c/h1\u003e\n\u003ch2 id=\"1-å¤§æ–‡ä»¶ä¸Šä¼ å¦‚ä½•å¤„ç†åˆ†ç‰‡ä¸Šä¼ \"\u003e1. å¤§æ–‡ä»¶ä¸Šä¼ å¦‚ä½•å¤„ç†ï¼Ÿåˆ†ç‰‡ä¸Šä¼ \u003c/h2\u003e\n\u003cp\u003eç›¸å…³ä»£ç ï¼š\u003ca href=\"https://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson001\"\u003ehttps://github.com/SwimmingLiu/JavaSceneQuiz100/tree/main/lesson001\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"11-ä¸ºä»€ä¹ˆéœ€è¦åˆ†ç‰‡ä¸Šä¼ \"\u003e1.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†ç‰‡ä¸Šä¼ ?\u003c/h3\u003e\n\u003cp\u003eå¤§æ–‡ä»¶åœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ï¼Œè€—è´¹çš„æ—¶é—´æ¯”è¾ƒé•¿ã€‚å¦‚æœç½‘ç»œä¸ç¨³å®šï¼Œå¾ˆå¯èƒ½å¯¼è‡´ä¸Šä¼ å¤±è´¥ï¼Œéœ€è¦é‡æ–°ä¸Šä¼ ã€‚åˆ†ç‰‡ä¸Šä¼ ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eåˆ†ç‰‡ä¸Šä¼ å®šä¹‰\u003c/strong\u003eï¼šå°†å¤§æ–‡ä»¶æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶å—ï¼Œé€å—è¿›è¡Œä¸Šä¼ \u003c/p\u003e\n\u003ch3 id=\"12-å¦‚ä½•å®ç°åˆ†ç‰‡ä¸Šä¼ \"\u003e1.2 å¦‚ä½•å®ç°åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ\u003c/h3\u003e\n\u003ch4 id=\"121-å¦‚ä½•å­˜å‚¨åˆ†ç‰‡ä¿¡æ¯\"\u003e1.2.1 å¦‚ä½•å­˜å‚¨åˆ†ç‰‡ä¿¡æ¯\u003c/h4\u003e\n\u003cp\u003eåˆ†ç‰‡ä¸Šä¼ éœ€è¦è®°å½•æ–‡ä»¶çš„å±æ€§ (md5ã€å¤§å°ã€åç§°)ã€åˆ†ç‰‡æ•°é‡ã€æ–‡ä»¶å­˜å‚¨çš„å®Œæ•´è·¯å¾„ (æœ¬åœ°è·¯å¾„)ï¼Œè¿˜éœ€è¦è®°å½•æ¯ä¸ªåˆ†å—çš„ä¸Šä¼ æƒ…å†µ (åˆ†å—å¤§å°ã€åˆ†å—é¡ºåºã€åˆ†å—ä»»åŠ¡id)ã€‚å¯ä»¥ç”¨ \u003cstrong\u003eåˆ†å—ä¸Šä¼ ä»»åŠ¡è¡¨\u003c/strong\u003e å’Œ \u003cstrong\u003eåˆ†å—æ–‡ä»¶è¡¨\u003c/strong\u003e æ¥è®°å½•ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eåˆ†å—ä»»åŠ¡è¡¨ (t_shard_upload)\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecreate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003etable\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eexists\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003et_shard_upload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eprimary\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003efile_name\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;æ–‡ä»¶åç§°\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003epart_num\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;åˆ†ç‰‡æ•°é‡\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003emd5\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;æ–‡ä»¶md5å€¼\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003efile_full_path\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;æ–‡ä»¶å®Œæ•´è·¯å¾„\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;åˆ†ç‰‡ä¸Šä¼ ä»»åŠ¡è¡¨\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eåˆ†å—æ–‡ä»¶è¡¨ (t_shard_upload_partï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecreate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003etable\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eexists\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"n\"\u003et_shard_upload_part\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eprimary\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eshard_upload_id\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;åˆ†ç‰‡ä»»åŠ¡idï¼ˆt_shard_upload.idï¼‰\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003epart_order\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ç¬¬å‡ ä¸ªåˆ†ç‰‡ï¼Œä»1å¼€å§‹\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003efile_full_path\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;æ–‡ä»¶å®Œæ•´è·¯å¾„\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eUNIQUE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003euq_part_order\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eshard_upload_id\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003epart_order\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecomment\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;åˆ†ç‰‡æ–‡ä»¶è¡¨ï¼Œæ¯ä¸ªåˆ†ç‰‡æ–‡ä»¶å¯¹åº”ä¸€æ¡è®°å½•\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eåˆ†å—æ–‡ä»¶è¡¨å’Œåˆ†å—ä¸Šä¼ è¡¨æ˜¯ \u003cstrong\u003e1 to M\u003c/strong\u003e çš„å…³ç³»ï¼Œå‡å¦‚å½“å‰æ–‡ä»¶åˆ†ä¸º\u003cstrong\u003e10\u003c/strong\u003eå—ã€‚åˆ™ä¼šå‡ºç°\u003cstrong\u003e1\u003c/strong\u003eä¸ªåˆ†ç‰‡ä¸Šä¼ ä»»åŠ¡ï¼Œå’Œ\u003cstrong\u003e10\u003c/strong\u003eä¸ªåˆ†ç‰‡æ–‡ä»¶è®°å½•ã€‚\u003c/p\u003e","title":"Javaåœºæ™¯100é¢˜"},{"content":"å…«è‚¡é¢˜ Java åŸºç¡€ + é›†åˆ é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«ï¼Ÿ é¢å‘å¯¹è±¡ï¼šå°†æ•°æ®å’Œæ–¹æ³•å°è£…æˆå¯¹è±¡ï¼Œä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒæ¥ç»„ç»‡ä»£ç ï¼ŒåŒ…å«å°è£…ã€ç»§æ‰¿ã€å¤šæ€ä¸‰å¤§ç‰¹æ€§ï¼Œæ–¹ä¾¿ä»£ç å¤ç”¨å’Œçµæ´»æ€§ã€‚\né¢å‘è¿‡ç¨‹ï¼šä»¥è¿‡ç¨‹åšä¸ºåŸºæœ¬å•å…ƒæ¥ç»„ç»‡ä»£ç ï¼Œè¿‡ç¨‹å¯¹åº”åˆ°ä»£ç ä¸­å°±æ˜¯å‡½æ•°ï¼Œå°†å‡½æ•°å’Œæ•°æ®åˆ†ç¦»ï¼Œæ¯”è¾ƒå…³æ³¨æ­¥éª¤å’Œæµç¨‹ã€‚å…¶å®å°±æ˜¯ä¸€æ¡è·¯èµ°åˆ°åº•çš„æ€æƒ³ï¼Œå…³æ³¨å¦‚ä½•è®¾è®¡ä¸€ç³»åˆ—é¡ºåºæ‰§è¡Œçš„è¿‡ç¨‹å®ç°ã€‚\nå°è£…ã€ç»§æ‰¿ã€å¤šæ€? å°è£…ï¼ˆEncapsulationï¼‰ï¼šé€šè¿‡å°†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ç»“åˆä¸ºç‹¬ç«‹å•å…ƒï¼Œå¹¶åˆ©ç”¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚privateï¼‰éšè—å†…éƒ¨ç»†èŠ‚ï¼Œä»…é€šè¿‡å…¬å…±æ¥å£ï¼ˆå¦‚getter/setterï¼‰æ§åˆ¶è®¿é—®ï¼Œä»è€Œæå‡å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§\nç»§æ‰¿ï¼ˆInheritanceï¼‰ï¼šå…è®¸å­ç±»åŸºäºçˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ‰©å±•ï¼Œå®ç°ä»£ç å¤ç”¨ï¼ŒJavaé‡‡ç”¨å•ç»§æ‰¿æœºåˆ¶ï¼ˆä»…æ”¯æŒä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼‰ï¼Œä½†å¯é€šè¿‡æ¥å£å®ç°å¤šé‡ç»§æ‰¿çš„æ•ˆæœ\nå¤šæ€ï¼ˆPolymorphismï¼‰ï¼šåŒä¸€æ–¹æ³•è°ƒç”¨å› å¯¹è±¡å®é™…ç±»å‹ä¸åŒè€Œäº§ç”Ÿä¸åŒè¡Œä¸ºï¼Œé€šå¸¸é€šè¿‡çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡åŠæ–¹æ³•é‡å†™å®ç°ï¼Œä¾èµ–è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šæœºåˆ¶å†³å®šå…·ä½“æ‰§è¡Œé€»è¾‘ã€‚ï¼ˆé‡å†™å’Œé‡è½½ï¼‰\nå¸¸è§æ’åºç®—æ³•ï¼Ÿæ—¶é—´å¤æ‚åº¦ï¼Ÿ ç›´æ¥æ’å…¥æ’åºï¼šo(n^2)\nå†’æ³¡æ’åºï¼šo(n^2)\nå¿«é€Ÿæ’åº: o(nlogn)\nå †æ’åºï¼šo(nlogn)\nå½’å¹¶æ’åºï¼šo(nlogn)\nç®—æ³• å¹³å‡æ—¶é—´å¤æ‚åº¦ æœ€åæ—¶é—´å¤æ‚åº¦ ç©ºé—´å¤æ‚åº¦ ç¨³å®šæ€§ é€‚ç”¨åœºæ™¯ æ’å…¥æ’åº O(nÂ²) O(nÂ²) O(1) ç¨³å®š éƒ¨åˆ†æœ‰åºæ•°æ® å†’æ³¡æ’åº O(nÂ²) O(nÂ²) O(1) ç¨³å®š æ•™å­¦ç¤ºä¾‹ã€å°æ•°æ® å¿«é€Ÿæ’åº O(n log n) O(nÂ²) O(log n) ä¸ç¨³å®š å¤§è§„æ¨¡éšæœºæ•°æ® å½’å¹¶æ’åº O(n log n) O(n log n) O(n) ç¨³å®š å¤§æ•°æ®ã€å¤–éƒ¨æ’åº å †æ’åº O(n log n) O(n log n) O(1) ä¸ç¨³å®š å®æ—¶ç³»ç»Ÿã€å†…å­˜å—é™åœºæ™¯ ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ ArrayListï¼šåº•å±‚æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæœ‰æ‰©å®¹æœºåˆ¶ï¼Œå†…å­˜è¿ç»­ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚ LinkedListï¼šåº•å±‚æ˜¯åŒå‘é“¾è¡¨ï¼Œå†…å­˜ä¸è¿ç»­ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å¿«ã€‚ ã€æ³¨æ„ã€‘ å®é™…è¿‡ç¨‹ä¸­ï¼ŒArrayList çš„å¢åˆ æ“ä½œæ¯” LinkedList å¿«äº†è¿›ç™¾å€ã€‚\néšç€é›†åˆå®¹é‡çš„å¢åŠ ï¼ŒLinkedList addç´¯è®¡è€—æ—¶ç›´çº¿ä¸Šå‡ï¼ŒArrayList addç´¯è®¡è€—æ—¶ä¸Šå‡å¾ˆæ…¢ï¼›LinkedList æ…¢çš„åŸå› åº”è¯¥æ˜¯æ¯æ¬¡addä¸€ä¸ªå€¼éƒ½éœ€è¦å°è£…æˆNodeç„¶åè¿½åŠ åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œæ¯æ¬¡å°è£…Nodeï¼ˆå®ä¾‹åŒ–Nodeå¯¹è±¡ï¼‰çš„è€—æ—¶ä¸å®¹å°è§‘ï¼›ArrayList add ä¸éœ€è¦å°è£…ï¼Œå½±å“è€—æ—¶çš„åªæœ‰æ‰©å®¹ï¼Œè€Œæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯è°ƒç”¨åº•å±‚System.arraycopy æ•°ç»„æ‹·è´ï¼Œè¿™ä¸ªæ‹·è´å‡½æ•°å†…å­˜å¤åˆ¶æ‰§è¡Œå¾ˆå¿«ï¼Œè€Œä¸”æ¯æ¬¡æ‰©å®¹int newCapacity = oldCapacity + (oldCapacity \u0026gt;\u0026gt; 1); ä¸ºåŸå®¹é‡çš„1.5å€ï¼Œæ‰€ä»¥éšç€å®¹é‡å¢åŠ å…¶å®æ‰©å®¹ä¸äº†å‡ æ¬¡ï¼Œè¿™ä¹Ÿæ˜¯ArrayList addé€Ÿåº¦å¿«çš„åŸå› ã€‚\nJavaçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ Stringåˆ›å»ºå¯¹è±¡æ—¶å¦‚ä½•åˆ›å»ºï¼Œåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Œç”¨newå’Œä¸ç”¨çš„åŒºåˆ«ï¼Ÿ Stringåˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šåˆ›å»º1ä¸ªæˆ–è€…2ä¸ªå¯¹è±¡ã€‚\nå¦‚æœä¸ä½¿ç”¨ new\nç¬¬ä¸€æ¬¡éœ€è¦åˆ›å»ºå­—ç¬¦ä¸²å­—é¢é‡å­˜å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼ŒString s1 = \u0026quot;SwimmingLiu\u0026quot;ï¼Œå¼•ç”¨è¯¥å­—ç¬¦ä¸²å­—é¢é‡ ç¬¬äºŒæ¬¡å¦‚æœéœ€è¦ç›¸åŒçš„å­—ç¬¦ä¸²ï¼ŒString s2 = \u0026quot;SwimmingLiu\u0026quot;ï¼Œå¼•ç”¨è¯¥å­—ç¬¦ä¸²å­—é¢é‡ä¸”ä¸ä¼šåˆ›å»ºä»»ä½•å¯¹è±¡ å¦‚æœä½¿ç”¨new ï¼šæ¯æ¬¡åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡éƒ½ä¼šåœ¨å †å†…å­˜ä¸­å­˜æ”¾ä¸€ä¸ªæ–°çš„å¯¹è±¡\nå¦‚æœå­—ç¬¦ä¸²å­—é¢é‡ä¸åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼ˆå †å†…å­˜å¯¹è±¡ + å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼‰ï¼ŒString s3 = new String(\u0026quot;SwimmingLiu\u0026quot;) å¦‚æœå­—ç¬¦ä¸²å­—é¢é‡å·²ç»åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆå †å†…å­˜å¯¹è±¡ï¼‰ï¼ŒString s4 = new String(\u0026quot;SwimmingLiu\u0026quot;) å­—ç¬¦ä¸²æ“ä½œæœ‰å“ªäº›ç±»ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Stringã€StringBuilderã€StringBuffer\nçº¿ç¨‹å®‰å…¨ï¼šString ã€StringBuffer Stringï¼šString æ˜¯ä¸å¯å˜é‡ï¼Œåº•å±‚ç”¨ final ä¿®é¥°ï¼Œæ¯æ¬¡å¯¹Stringä¿®æ”¹éƒ½ä¼šäº§ç”Ÿæ–°çš„å‰¯æœ¬ï¼Œä»è€Œå ç”¨æ›´å¤šçš„èµ„æºï¼Œé¢‘ç¹å¤§é‡çš„ä¿®æ”¹ä¼šé€ æˆèµ„æºçš„æµªè´¹ StringBufferï¼šStringBuffer æ˜¯ä¸ºäº†è§£å†³String å¯èƒ½é€ æˆèµ„æºæµªè´¹çš„é—®é¢˜ï¼Œåº•å±‚ç”¨ char[] æ•°ç»„ï¼Œæ‰€æœ‰ä¿®æ”¹æ–¹æ³•é‡‡ç”¨ synchronized é”ï¼Œ æ‰€ä»¥çº¿ç¨‹å®‰å…¨ çº¿ç¨‹ä¸å®‰å…¨ï¼šStringBuilder StringBuilderï¼šStringBuilder åœ¨ StringBuffer çš„åŸºç¡€ä¸ŠæŠŠ synchronized é”å»æ‰äº†ï¼Œèˆå¼ƒäº†çº¿ç¨‹å®‰å…¨å•æ€§èƒ½æ›´é«˜ å¦‚ä½•é€šè¿‡Streamæµè¿›è¡Œè¿‡æ»¤ã€é›†åˆå’Œæ˜ å°„çš„æ“ä½œï¼Ÿ JUC å¹¶å‘ Javaçš„é”æœ‰å“ªäº›ï¼Ÿ å†…ç½®é”ï¼ˆsynchronizedï¼‰ï¼šJavaè¯­è¨€å±‚é¢æä¾›çš„å…³é”®å­—ï¼Œéšå¼åŠ é”ï¼Œä½¿ç”¨ç®€å•ã€‚ æ˜¾ç¤ºé”ï¼ˆLockæ¥å£åŠå…¶å®ç°ï¼‰ï¼šæ¯”å¦‚ ReentrantLockã€ReentrantReadWriteLockï¼ˆè¯»å†™é”ï¼‰ã€StampedLock ç­‰ï¼Œæä¾›æ›´çµæ´»çš„é”æ“ä½œï¼Œå¦‚å¯ä¸­æ–­ã€å…¬å¹³æ€§ç­‰ã€‚ ã€ä¸åŒé”çš„åŒºåˆ«ã€‘\nsynchronizedï¼šå†…ç½®é”ï¼ˆMonitor Lockï¼‰ï¼Œå¯ä»¥ç”¨äºæ–¹æ³•æˆ–ä»£ç å—ï¼Œæä¾›äº’æ–¥è®¿é—®ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ synchronized æ–¹æ³•æˆ–å—æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è·å–å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹åˆ™éœ€ç­‰å¾…é”é‡Šæ”¾åæ‰èƒ½è¿›å…¥ã€‚ synchronized æ˜¯ä¸€ç§éå…¬å¹³ï¼Œæ‚²è§‚ï¼Œç‹¬äº«ï¼Œäº’æ–¥ï¼Œå¯é‡å…¥çš„é‡é‡çº§é”ã€‚\nReentrantLockï¼šæ˜¯ä¸€ä¸ªé‡å…¥é”ï¼Œæ˜¯ java.util.concurrent.locks åŒ…ä¸­çš„æ¥å£ Lock çš„å®ç°ï¼Œæä¾›äº†æ¯” synchronized æ›´çµæ´»çš„é”æ“ä½œï¼Œå¦‚å°è¯•è·å–é”ã€å¯ä¸­æ–­çš„è·å–é”ã€è¶…æ—¶è·å–é”ç­‰ã€‚å®ƒä¹Ÿæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ç­–ç•¥ã€‚ ReentrantLock æ˜¯ä¸€ç§é»˜è®¤éå…¬å¹³ä½†å¯å®ç°å…¬å¹³çš„ï¼Œæ‚²è§‚ï¼Œç‹¬äº«ï¼Œäº’æ–¥ï¼Œå¯é‡å…¥ï¼Œé‡é‡çº§é”ã€‚\nReentrantReadWriteLockï¼ˆè¯»å†™é”ï¼‰ï¼šä¹Ÿæ˜¯ java.util.concurrent.locks åŒ…ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸åŒæ—¶æœ‰å¤šä¸ªè¯»å–è€…ï¼Œä½†åªå…è®¸ä¸€ä¸ªå†™å…¥è€…ã€‚å®ƒåˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œè¯»é”ä¸å†™é”äº’æ–¥ï¼Œå†™é”ä¹‹é—´ä¹Ÿäº’æ–¥ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚\nReentrantReadWriteLock æ˜¯ä¸€ç§ é»˜è®¤éå…¬å¹³ä½†å¯å®ç°å…¬å¹³çš„ï¼Œæ‚²è§‚ï¼Œå†™ç‹¬äº«ï¼Œè¯»å…±äº«ï¼Œè¯»å†™ï¼Œå¯é‡å…¥ï¼Œé‡é‡çº§é”ã€‚\nStampedLockï¼ˆJava 8 å¼•å…¥ï¼‰ï¼šæä¾›äº†ä¸‰ç§é”æ¨¡å¼ï¼šè¯»é”ã€å†™é”å’Œä¹è§‚è¯»é”ã€‚ç›¸è¾ƒäº ReentrantReadWriteLock ï¼ŒStampedLock æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ”¯æŒä¹è§‚è¯»å–æ“ä½œï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚\nå¯ä»¥ç»™æˆ‘ç®€è¿°ä¸€ä¸‹ä½ éƒ½æœ‰ä»€ä¹ˆå¹¶å‘ç»éªŒå— ï¼ˆJUCå½“ä¸­ç”¨åˆ°äº†å“ªäº›åŠŸèƒ½ï¼‰ï¼Ÿå¹³æ—¶é¡¹ç›®ä¸­æœ‰å“ªäº›åœ°æ–¹ç”¨åˆ°äº†é”ï¼Ÿé¡¹ç›®ä¸­å“ªäº›éƒ¨åˆ†è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Ÿæ€ä¹ˆç”¨çš„ï¼Ÿ é¢è¯•å®˜æ‚¨å¥½ï¼Œæˆ‘å¹³æ—¶åœ¨é¡¹ç›®ä¸­å¤§éƒ¨åˆ†ç”¨åˆ°çš„éƒ½æ˜¯åˆ†å¸ƒå¼é”ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…é¡¹ç›®æœåŠ¡å®•æœºå’Œé”å¸¦æ¥çš„å†…å­˜å‹åŠ›ã€‚ä¸è¿‡ï¼Œæˆ‘ä¹‹å‰åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯æ•´ä¸ªæ–¹æ³•åŒº/ä»£ç å—è¿™ç§ç²’åº¦æ¯”è¾ƒå¤§çš„åœ°æ–¹ï¼Œæ¶‰åŠåˆ°å¤šä¸ªçº¿ç¨‹åŠŸèƒ½è®¿é—®æ“ä½œã€‚æˆ‘å¯èƒ½ä¼šé€‰ç”¨ sychronized ã€‚å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„æ˜¾ç¤ºæ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è®©æ‰€æœ‰çº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œï¼Œæˆ‘ä¼šé‡‡ç”¨ReentantLock ã€‚\nSynchronizedå¯ä»¥ç”¨åœ¨å“ªé‡Œï¼ŸSynchronizedé”å‡çº§çš„æœºåˆ¶ï¼Ÿ sychronized ä¸€èˆ¬ç”¨äºéœ€è¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä»£ç å—/æ–¹æ³•åŒºï¼Œä¸Šé”éœ€è¦ä¸€ä¸ªé”å¯¹è±¡ã€‚\nsychronized é”å‡çº§æœºåˆ¶ä¸»è¦æ˜¯ä¸‰ç§çŠ¶æ€ï¼Œä»åå‘é”(ä¸€ä¸ªçº¿ç¨‹) -\u0026gt; è½»é‡çº§é” (å¤šä¸ªçº¿ç¨‹) -\u0026gt; é‡é‡çº§é” (å¤šä¸ªçº¿ç¨‹ç«äº‰æ¿€çƒˆ)\nåå‘é”ï¼šæœ€å¼€å§‹æœ‰ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”çš„æ—¶å€™ï¼ŒJVM ä¼šè®°å½•ä¿®æ”¹é”å¯¹è±¡çš„å¯¹è±¡å¤´ï¼Œæ ‡è®°ä¸ºåå‘çŠ¶æ€ã€‚å¯¹è±¡å¤´é‡Œé¢ä¼šè®°å½•çº¿ç¨‹ id å’Œ å¯¹åº”çš„ epoch åå‘é”ç‰ˆæœ¬ã€‚åç»­è¯¥çº¿ç¨‹å†è·å–è¿™ä¸ªé”ï¼ŒåŸºæœ¬æ²¡å•¥å¼€é”€ã€‚ è½»é‡çº§é”ï¼šå½“æœ‰å¦å¤–çš„çº¿ç¨‹å°è¯•å»è·å–å·²ç»è¢«åå‘çš„é”æ—¶ï¼Œé”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼ŒJVM ä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªé”è®°å½• LockRecord ï¼Œå½“é”è®°å½•æŒ‡å‘é”å¯¹è±¡ã€‚ç„¶åç”¨ CAS æ›¿æ¢é”å¯¹è±¡çš„æ ‡è®°å­— Mark Wordï¼Œ å¹¶å°† Mark Word çš„å€¼å­˜å…¥é”è®°å½•ã€‚å¦‚æœæ›¿æ¢æˆåŠŸï¼Œé”å¯¹è±¡çš„ Mark Word å°±å˜æˆå½“å‰çº¿ç¨‹çš„æ‰€é”è®°å½•ã€‚ä½¿ç”¨ CAS æ“ä½œçš„ç›®çš„æ˜¯å‡å°‘é”ç«äº‰çš„å¼€é”€ã€‚ é‡é‡çº§é”ï¼šå½“ CAS å¤±è´¥æ— æ³•è·å–é”çš„æ—¶å€™ï¼ŒJVMåˆ¤å®šå…¶ä¸ºå¤šä¸ªçº¿ç¨‹ç«äº‰é”æ¿€çƒˆï¼Œé”ä¼šå‡çº§æˆä¸ºé‡é‡é”ã€‚ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ Mutex æ¥å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’ã€‚å¦‚æœè·å–é”æˆåŠŸï¼Œçº¿ç¨‹ä¼šè¢«æ”¾å…¥Monitorçš„ owner å½“ä¸­ Javaå†…å­˜æ¨¡å‹ï¼ˆJMM), jdk8ä¸­æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ JMM æ˜¯ç”¨æ¥è§£å†³ç”±ç¡¬ä»¶é€Ÿåº¦å·®å¼‚å¼•èµ·çš„å¹¶å‘ç¼–ç¨‹é—®é¢˜ã€‚CPUã€å†…å­˜ã€I/Oè®¾å¤‡ä¹‹é—´çš„é€Ÿåº¦å·®å¼‚å›å½±å“ç¨‹åºæ€§èƒ½ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé‡‡ç”¨äº†ç¼“å­˜ã€å¤šä»»åŠ¡å¤„ç†å’ŒæŒ‡ä»¤é‡æ’åºç­‰æŠ€æœ¯ï¼Œä½†æ˜¯è¿™ä¹Ÿå¯¼è‡´äº†å¹¶å‘ç¨‹åºå½“ä¸­çš„å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§é—®é¢˜ã€‚JMM å°±å®šä¹‰äº†ä¸€ç³»åˆ—å…³é”®å­— volatile ã€synchronized ã€final ç¡®ä¿ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¿˜å®šä¹‰äº†Happens-Before è§„åˆ™æ¥æ˜ç¡®æ“ä½œä¹‹é—´çš„é¡ºåºå…³ç³»ã€‚ ã€JDK8 å˜åŒ–ã€‘\nJDK 8é€šè¿‡å…ƒç©ºé—´æ›¿ä»£æ°¸ä¹…ä»£ã€é”æœºåˆ¶ä¼˜åŒ–åŠå†…å­˜å±éšœæŒ‡ä»¤å¢å¼ºï¼ŒJDK 8é€šè¿‡å…ƒç©ºé—´æ›¿ä»£æ°¸ä¹…ä»£ã€é”æœºåˆ¶ä¼˜åŒ–åŠå†…å­˜å±éšœæŒ‡ä»¤å¢å¼º\nJVM è™šæ‹Ÿæœº JVMçš„åƒåœ¾å›æ”¶æœºåˆ¶å’ŒJVMæ€§èƒ½è°ƒä¼˜äº†è§£ï¼Ÿ åƒåœ¾å›æ”¶ä¸€èˆ¬éƒ½æ˜¯å‘ç”Ÿåœ¨å †å†…å­˜é‡Œé¢ï¼Œæ‰€ä»¥ä¸‹é¢æ‰€æœ‰åƒåœ¾å›æ”¶æ“ä½œçš„å¯¹è±¡åŸºæœ¬éƒ½æ˜¯åœ¨å †å†…å­˜é‡Œé¢\nã€JVMåƒåœ¾å›æ”¶æœºåˆ¶ã€‘\nJVMåƒåœ¾å›æ”¶æœºåˆ¶æœ‰ä¸‰ç§ï¼Œæ ‡è®°-æ¸…é™¤ (CMS) ã€**æ ‡è®°-æ•´ç† (G1) **ã€æ ‡è®°-å¤åˆ¶\næ ‡è®°-æ¸…é™¤ï¼šä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®° å’Œ æ¸…é™¤ æ ‡è®°ï¼šä» GC Roots å¼€å§‹ï¼Œé€šè¿‡ DFS æˆ–è€… BFS éå†æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡çš„å¤´éƒ¨ Header æ ‡è®°ä¸ºå­˜æ´» ï¼ˆæ ‡è®°çš„éƒ½æ˜¯ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡-å­˜æ´»å¯¹è±¡ï¼‰ã€‚GC Roots çš„å¯¹è±¡åŒ…æ‹¬ JVM ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ï¼‰ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼ˆå…¨å±€å˜é‡ï¼‰ã€æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡ æ¸…é™¤ï¼šéå†å †ä¸­çš„å¯¹è±¡ï¼Œå°†æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ï¼Œä¸ä¼šç§»åŠ¨å’Œæ•´ç†å†…å­˜ç©ºé—´ã€‚ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç©ºé—²é“¾è¡¨ï¼ˆåŒå‘é“¾è¡¨ï¼‰æ¥æ ‡è®°è¢«åƒåœ¾å›æ”¶çš„åŒºåŸŸï¼Œå†…å­˜æ˜¯ç©ºé—²å¯ç”¨çš„ã€‚æ‰€ä»¥è¿™ç§ç®—æ³•ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ç¢ç‰‡çš„äº§ç”Ÿ æ ‡è®°-å¤åˆ¶ï¼šä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®° å’Œ å¤åˆ¶ï¼Œæ ‡è®°éƒ¨åˆ†å’Œä¸Šé¢ä¸€æ · å¤åˆ¶ï¼šè¯¥ç®—æ³•ä¼šæŠŠå †åˆ†æˆä¸¤å— (From åŒºå’Œ To åŒº)ï¼Œæ‰€æœ‰å¯¹è±¡åˆ›å»ºçš„æ—¶å€™éƒ½åœ¨ From åŒºé‡Œé¢ï¼ˆæ ‡è®°çš„å¯¹è±¡ä¹Ÿéƒ½åœ¨ From åŒºï¼‰ã€‚å‘ç”Ÿ GC åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä¼šå°†æ ‡è®°çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰ä» From åŒº å¤åˆ¶åˆ° To åŒºï¼Œç„¶åæ•´ä½“å›æ”¶ From åŒºã€‚ç„¶åå†ä» To åŒºä¸­ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶å› From åŒº æ ‡è®°-æ•´ç†ï¼šä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®° å’Œ æ•´ç†ï¼Œæ ‡è®°éƒ¨åˆ†å’Œä¸Šé¢ä¸€æ · æ•´ç†ï¼šå°†è¢«æ ‡è®°çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰å¾€è¾¹ç•Œä¸Šæ•´ç†ï¼Œå¯¹å…¶ä»–çš„éƒ¨åˆ†è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿä¸éœ€è¦åƒå¤åˆ¶ç®—æ³•é‚£æ ·è…¾å‡ºä¸€åŠçš„ç©ºé—´ï¼Œæ‰€ä»¥å†…å­˜åˆ©ç”¨ç‡ä¹ŸæŒºé«˜çš„ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯éœ€è¦å¯¹å †å†…å­˜è¿›è¡Œå¤šæ¬¡æœç´¢ï¼Œå› ä¸ºéœ€è¦åœ¨åŒä¸€ä¸ªç©ºé—´é‡Œé¢ï¼Œå®Œæˆæ ‡è®°å’Œæ•´ç†ï¼ˆç§»åŠ¨ï¼‰çš„æ“ä½œã€‚ ã€JVMæ€§èƒ½è°ƒä¼˜ã€‘\nGC åƒåœ¾å›æ”¶å™¨è°ƒä¼˜çš„æ ¸å¿ƒåŸç†å°±æ˜¯å°½å¯èƒ½åœ¨å¹´è½»ä»£ Young GC å›æ”¶å¯¹è±¡ ï¼ˆå¹´è½»ä»£åŒ…å« Eden åŒº å’Œ ä¸¤ä¸ª Survivor åŒºï¼‰ã€‚\nå…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š\né€‰æ‹©åˆé€‚çš„GCï¼šCMS (å®æ—¶WebæœåŠ¡ã€ç”µå•†ç§’æ€ç­‰å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„åœºæ™¯)ã€G1 (å¹³è¡¡ååä¸å»¶è¿Ÿï¼Œå¦‚å¾®æœåŠ¡é›†ç¾¤ã€åˆ†å¸ƒå¼ç¼“å­˜) è°ƒæ•´å †å’Œæ–°ç”Ÿä»£å¤§å°ï¼šå†…å­˜è®¾ç½®åˆç†å¯ä»¥å‡å°‘ GC é¢‘ç‡ï¼Œé€šè¿‡è®¾ç½® -Xms å’Œ -Xmx è°ƒæ•´å †å†…å­˜åˆå§‹/æœ€å¤§å€¼ï¼Œç»“åˆ -Xmn æˆ– -XX:NewRatio æ§åˆ¶æ–°ç”Ÿä»£å æ¯”ï¼Œå¹¶é€šè¿‡ -XX:SurvivorRatio è°ƒèŠ‚ Eden ä¸ Survivor åŒºæ¯”ä¾‹ï¼Œæ ¹æ®åº”ç”¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œ GC ç›‘æ§åŠ¨æ€ä¼˜åŒ–ã€‚ å¯ç”¨GCæ—¥å¿—æ£€æµ‹ï¼šç›‘æ§å’Œåˆ†æGCçš„è¡Œä¸ºï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ è°ƒæ•´GCçº¿ç¨‹ï¼šæé«˜å¹¶è¡ŒGCæ€§èƒ½ ã€CMS å’Œ G1å¯¹æ¯”ã€‘\nç»´åº¦ CMS G1 ç®—æ³• æ ‡è®°-æ¸…é™¤ï¼ˆå†…å­˜ç¢ç‰‡ï¼‰ æ ‡è®°-æ•´ç†ï¼ˆå‡å°‘ç¢ç‰‡ï¼‰ åœé¡¿æ—¶é—´ çŸ­ï¼ˆä½†å¯èƒ½å› ç¢ç‰‡è§¦å‘Full GCï¼‰ å¯é¢„æµ‹ï¼ˆé»˜è®¤200msï¼Œå¯è°ƒï¼‰ å †å†…å­˜èŒƒå›´ ä¸­å°å †ï¼ˆ\u0026lt;32GBï¼‰ å¤§å †ï¼ˆ4GB~32GB+ï¼‰ CPUå ç”¨ é«˜ï¼ˆå¹¶å‘é˜¶æ®µå ç”¨25% CPUï¼‰ è¾ƒä½ï¼ˆå¹¶å‘çº¿ç¨‹è‡ªé€‚åº”ï¼‰ JVM è¿è¡Œæ—¶å†…å­˜æƒ…å†µï¼Œæ¯ä¸ªåœ°æ–¹å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆJVMå†…å­˜åŒºåŸŸå¦‚ä½•åˆ’åˆ†ï¼Ÿï¼‰ å †å†…å­˜ã€æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ã€ç›´æ¥å†…å­˜ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨\nçº¿ç¨‹çš„å…±äº«åŒºåŸŸä»¥åŠéå…±äº«ï¼Ÿ å…±äº«åŒºåŸŸï¼šå †å†…å­˜ã€ç›´æ¥å†…å­˜ã€æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ ç§æœ‰åŒºåŸŸï¼šè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ MySQL ä¸€æ¡SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ æ£€æŸ¥è¿æ¥ï¼š æ ¡éªŒè´¦å·å¯†ç ï¼Œç¡®å®šç”¨æˆ·çš„è¿æ¥æƒé™ ç¼“å­˜æŸ¥è¯¢ï¼šå¦‚æœå­˜åœ¨ç¼“å­˜ï¼Œç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœã€‚(MySQL 8.0ä¹‹ååºŸå¼ƒ) è¯­æ³•åˆ†æï¼šé€šè¿‡è¯­æ³•æ ‘åˆ†æSQLè¯­å¥çš„è¯­æ³•æ˜¯å¦æ­£ç¡® æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–ï¼šä¼˜åŒ– where è¯­å¥ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚è”åˆç´¢å¼•æ‹¼æ¥ç­‰ç­‰ æ‰§è¡ŒSQLè¯­å¥ï¼šæ‰§è¡Œå™¨æ‰§è¡ŒSQLè¯­å¥ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœ è¯´ä¸€ä¸‹MySQLç´¢å¼•ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ åˆ’åˆ†æ–¹å‘ ç´¢å¼•ç±»å‹ æ•°æ®ç»“æ„ B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€å€’æ’ç´¢å¼• (å…¨æ–‡ç´¢å¼•)ã€R-æ ‘ç´¢å¼• (å¤šç»´ç©ºé—´æ ‘)ã€ä½å›¾ç´¢å¼•(Bitmap) ç‰©ç†å­˜å‚¨ èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼• å­—æ®µç‰¹æ€§ ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•(äºŒçº§ç´¢å¼•ã€è¾…åŠ©ç´¢å¼•)ã€å‰ç¼€ç´¢å¼• å­—æ®µä¸ªæ•° å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼• ä¼˜ç‚¹ï¼šç´¢å¼•å¯ä»¥åŠ é€ŸSQLè¯­å¥æ¡ä»¶æŸ¥è¯¢çš„æ£€ç´¢è¿‡ç¨‹ï¼Œå¿«é€Ÿå®šä½åˆ°å…³é”®è¡Œ\nä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸æ¯ä¸€åˆ—æ•°æ®éƒ½åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Ÿç´¢å¼•è¿‡å¤šçš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå¦‚æœåˆ›å»ºçš„ç´¢å¼•è¿‡å¤šï¼Œå› ä¸ºæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦ç»´æŠ¤ç´¢å¼•æ•°æ®ï¼Œä¼šæ¶ˆè€—èµ„æºå’Œå¯¼è‡´æŸ¥è¯¢æ—¶é—´å¢é•¿ã€‚\n**ã€æ—¶é—´å¼€é”€ã€‘**è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿå¿…é¡»æ›´æ–°ã€‚ç´¢å¼•è¶Šå¤šï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±è¶Šå¤šï¼Œæ—¶é—´å¼€é”€å¤§ã€‚B+æ ‘å¯èƒ½ä¼šå‡ºç°é¡µåˆ†è£‚ã€åˆå¹¶ç­‰æ“ä½œï¼Œæ—¶é—´å¼€é”€æ›´å¤§ã€‚\nã€ç©ºé—´å¼€é”€ã€‘ å»ºç«‹äºŒçº§ç´¢å¼•ï¼Œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ªB+æ ‘ï¼Œæ¯ä¸ªæ•°æ®é¡µé¢éƒ½æ˜¯16KBã€‚å¦‚æœæ•°æ®å¤§ï¼Œç´¢å¼•åˆå¤šï¼Œå ç”¨çš„ç©ºé—´ä¸å°ã€‚\nä»€ä¹ˆæƒ…å†µä¼šå‡ºå…ˆç´¢å¼•å¤±æ•ˆï¼Ÿç®€å•è¯´ä¸‰ç§è®©ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Ÿ è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ è”åˆç´¢å¼•çš„é¦–åˆ—ä½¿ç”¨ \u0026gt; æˆ–è€… \u0026lt; (å•åˆ—ç´¢å¼•ä¸ä¼šå¤±æ•ˆ) å¯¹ç´¢å¼•åˆ—ä½¿ç”¨è¿ç®— where id + 8 = 16ã€å‡½æ•° count()ã€distinct() ã€like '%xx%' ç­‰æ“ä½œ å¯¹ç´¢å¼•åˆ—ä½¿ç”¨ä¸åŒçš„æ•°æ®ç±»å‹è¿›è¡Œæ¡ä»¶ç­›é€‰ ï¼ˆå¼ºåˆ¶è½¬æ¢ -\u0026gt; å‡½æ•°ï¼‰ å¯¹ç´¢å¼•åˆ—å’Œéç´¢å¼•åˆ—ä½¿ç”¨ or æ“ä½œ (where name = \u0026quot;swimmingliu\u0026quot; or age = 34) æ€ä¹ˆåˆ¤æ–­æŸ¥è¯¢æ˜¯èµ°ç´¢å¼•è¿˜æ˜¯èµ°å…¨è¡¨ ï¼Ÿ ä½¿ç”¨ EXPLAIN å¯¹æŒ‡å®šçš„SQLè¯­å¥è¿›è¡Œåˆ†æï¼ŒEXPLAIN åˆ†æç»“æœ çš„ type è¡¨ç¤ºæŸ¥è¯¢çš„è®¿é—®ç±»å‹ï¼Œå½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚å¸¸è§çš„å€¼ï¼š\nref: ä½¿ç”¨ç´¢å¼•ï¼ŒæŸ¥æ‰¾åŒ¹é…æŸä¸ªå•ä¸€åˆ—çš„å€¼ï¼ˆæ¯”å¦‚é€šè¿‡å¤–é”®æŸ¥æ‰¾ï¼‰ã€‚æ¯” range æ›´é«˜æ•ˆã€‚ range: ä½¿ç”¨ç´¢å¼•æ‰«ææŸä¸ªèŒƒå›´å†…çš„å€¼ï¼Œé€‚ç”¨äº BETWEENã€\u0026gt; \u0026lt; ç­‰æ¡ä»¶ã€‚ index: å…¨ç´¢å¼•æ‰«æï¼Œæ‰«ææ•´ä¸ªç´¢å¼•ç»“æ„ï¼Œä¸è¯»è¡¨æ•°æ®ï¼Œé€šå¸¸æ•ˆç‡æ¯”å…¨è¡¨æ‰«æå¥½ã€‚ all: å…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼• æ€»ç»“ï¼šref \u0026gt; range \u0026gt; index \u0026gt; allã€‚\näº†è§£åˆ†é¡µæŸ¥è¯¢å—ï¼Ÿç¬¬ä¸€é¡µæŸ¥è¯¢å’Œæœ€åä¸€é¡µæŸ¥è¯¢å“ªä¸€ä¸ªå¿«ï¼Ÿ ç¬¬ä¸€é¡µæŸ¥è¯¢é€šå¸¸æ¯”æœ€åä¸€é¡µå¿«ã€‚ ä½¿ç”¨ LIMIT å’Œ OFFSET è¿›è¡Œåˆ†é¡µæ—¶ï¼Œæ•°æ®åº“å¿…é¡»è·³è¿‡å‰é¢çš„è®°å½•ã€‚ä¾‹å¦‚ï¼ŒLIMIT 10 OFFSET 0ï¼ˆç¬¬ä¸€é¡µï¼‰åªéœ€è¯»å–å‰10æ¡è®°å½•ï¼Œè€Œ LIMIT 10 OFFSET 99990ï¼ˆæœ€åä¸€é¡µï¼‰åˆ™éœ€è¦è·³è¿‡99990æ¡è®°å½•åå†è¯»å–10æ¡ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚\nä¸ºæé«˜æ€§èƒ½ï¼Œå»ºè®®ä½¿ç”¨ â€œé”®é›†åˆ†é¡µâ€ï¼ˆKeyset Paginationï¼‰ï¼Œå³åŸºäºå”¯ä¸€å­—æ®µï¼ˆå¦‚è‡ªå¢IDï¼‰è¿›è¡Œåˆ†é¡µï¼š\nSELECT * FROM table WHERE id \u0026gt; ? ORDER BY id ASC LIMIT 10; MySQLç´¢å¼•æ€ä¹ˆå®ç° ï¼ˆåŸç†ï¼‰? MySQL ç´¢å¼•ä¸»è¦é€šè¿‡ B+ æ ‘å®ç°ï¼Œå…¶åŸç†æ˜¯å°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ä»…å­˜å‚¨ç´¢å¼•é”®ã€‚è¿™ç§ç»“æ„ä½¿å¾—æ ‘çš„é«˜åº¦è¾ƒä½ï¼Œå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤å¤–ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’Œé¡ºåºè®¿é—®ã€‚ç”±äºéå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨å®é™…æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å®¹çº³æ›´å¤šçš„ç´¢å¼•é”®ï¼Œä»è€Œè¿›ä¸€æ­¥é™ä½æ ‘çš„é«˜åº¦ã€‚è¿™ç§è®¾è®¡å……åˆ†åˆ©ç”¨ç£ç›˜é¢„è¯»ç‰¹æ€§ï¼Œé€‚åˆå­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å¤§è§„æ¨¡æ•°æ®ï¼Œæé«˜äº†æŸ¥è¯¢æ€§èƒ½ã€‚\næ€ä¹ˆä¼˜åŒ–SQLè¯­å¥æŸ¥è¯¢æ•ˆç‡ï¼Ÿ å¯ä»¥åˆ†ä¸ºé¢„é˜²å’Œè§£å†³æ…¢æŸ¥è¯¢ä¸¤ç§æ–¹æ¡ˆã€‚\nã€é¢„é˜²ã€‘\nåˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼šå¯¹éœ€è¦é¢‘ç¹æŸ¥è¯¢ã€æ•°æ®åˆ†å¸ƒä¸€è‡´æ€§ä½ã€ group by åˆ†ç»„ã€order by æ’åºçš„åˆ—å»ºç«‹å•åˆ—ç´¢å¼•æˆ–è€…è”åˆç´¢å¼•ã€‚ é¿å…ç´¢å¼•å¤±æ•ˆï¼šè”åˆç´¢å¼•æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€å•åˆ—ç´¢å¼•é¿å…ä½¿ç”¨å‡½æ•°ã€è®¡ç®—ã€like %xx% ç­‰ å‡å°‘å›è¡¨å’ŒI/Oæ¬¡æ•°ï¼šé¿å… select * æ“ä½œã€‚å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œéƒ¨åˆ†å­—æ®µæ˜¯æ²¡æœ‰äºŒæ¬¡ç´¢å¼•çš„ï¼Œå®ƒä¼šç”¨ä¸»é”®idæˆ–è€…rowid è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„I/Oã€‚ ã€è§£å†³æ…¢æŸ¥è¯¢ã€‘\nå¼€å¯æ…¢SQLæ—¥å¿—è®°å½•åŠŸèƒ½ï¼šä½¿ç”¨set global slow_query_log = \u0026quot;ON\u0026quot;ï¼Œ é»˜è®¤æ˜¯å…³é—­çš„ã€‚è®¾ç½®ä¸€ä¸ªæŸ¥è¯¢å»¶è¿Ÿçš„é˜ˆå€¼ï¼ŒæŠŠè¶…è¿‡è§„å®šæ—¶é—´çš„SQLæŸ¥è¯¢æ‰¾å‡ºæ¥ã€‚ åˆ†ææ…¢SQLï¼šåˆ©ç”¨explainå…³é”®å­—åˆ†ææ…¢SQLçš„åŸå› ï¼Œæ¯”å¦‚çœ‹çœ‹æ˜¯å¦æœ‰ç´¢å¼•å¤±æ•ˆã€select *ç­‰æƒ…å†µ MySQLç”¨äº†å“ªäº›ä¼˜åŒ–æ–¹å¼ï¼Ÿ å­˜å‚¨å¼•æ“ä¼˜åŒ–ï¼šé»˜è®¤ä½¿ç”¨ InnoDBï¼Œæ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”å’Œå´©æºƒæ¢å¤ã€‚ ç´¢å¼•ä¼˜åŒ–ï¼šä½¿ç”¨ B+ æ ‘ç´¢å¼•ï¼Œæ”¯æŒå¤åˆç´¢å¼•å’Œè¦†ç›–ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚ æŸ¥è¯¢ä¼˜åŒ–ï¼šåˆ©ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³æ‰§è¡Œè®¡åˆ’ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚ ç¼“å­˜æœºåˆ¶ï¼šé€šè¿‡è°ƒæ•´ innodb_buffer_pool_size ç­‰å‚æ•°ï¼Œæé«˜æ•°æ®å’Œç´¢å¼•çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚ è¿æ¥ç®¡ç†ï¼šä½¿ç”¨è¿æ¥æ± å‡å°‘è¿æ¥å¼€é”€ï¼Œæå‡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ é…ç½®è°ƒæ•´ï¼šæ ¹æ®è´Ÿè½½è°ƒæ•´å‚æ•°ï¼Œå¦‚ max_connectionsã€query_cache_size ç­‰ï¼Œä¼˜åŒ–èµ„æºä½¿ç”¨ã€‚ åˆ†åº“åˆ†è¡¨ï¼šå¯¹å¤§æ•°æ®é‡è¿›è¡Œæ°´å¹³æˆ–å‚ç›´æ‹†åˆ†ï¼Œå‡å°å•è¡¨å‹åŠ›ã€‚ è¯»å†™åˆ†ç¦»ï¼šä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œä¸»åº“è´Ÿè´£å†™æ“ä½œï¼Œä»åº“è´Ÿè´£è¯»æ“ä½œï¼Œæå‡æ•´ä½“æ€§èƒ½ã€‚ MySQLæ˜¯å·¦ä¼˜å…ˆè¿˜æ˜¯å³ä¼˜å…ˆï¼Ÿ MySQL ä½¿ç”¨ â€œæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™â€ï¼Œå³ç´¢å¼•åŒ¹é…ä»æœ€å·¦åˆ—å¼€å§‹ï¼Œå¿…é¡»è¿ç»­åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè”åˆç´¢å¼• (a, b, c) ä¸­ï¼ŒæŸ¥è¯¢æ¡ä»¶å¿…é¡»åŒ…å« aï¼Œæ‰èƒ½åˆ©ç”¨ç´¢å¼•ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ b=1 æˆ– c=1ï¼Œç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œé‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ \u0026gt;ã€\u0026lt;ã€BETWEENã€LIKEï¼‰æ—¶ï¼ŒåŒ¹é…ä¼šåœæ­¢ï¼Œåç»­åˆ—æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå°è¯•é‡æ’æ¡ä»¶é¡ºåºï¼Œä½†å¿…é¡»åŒ…å«æœ€å·¦åˆ—æ‰èƒ½å‘½ä¸­ç´¢å¼•ã€‚\nèŠä¸€ä¸‹MySQLéš”ç¦»çº§åˆ« ï¼Ÿ MySQLçš„éš”ç¦»çº§åˆ«æœ‰å››ç§ï¼šè¯»æœªæäº¤ RUã€è¯»å·²æäº¤ RCã€å¯é‡å¤è¯» RRã€ä¸²è¡ŒåŒ– MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸º å¯é‡å¤åº¦ RR\néš”ç¦»æ€§ è¯»æœªæäº¤ RU è¯»å·²æäº¤ RC å¯é‡å¤è¯» RR ä¸²è¡Œè¯» è„è¯» âŒ âœ… âœ… âœ… ä¸å¯é‡å¤è¯» âŒ âŒ âœ… âœ… å¹»è¯» âŒ âŒ âŒ âœ… è„è¯»ï¼šäº‹åŠ¡Aå¼€å¯äº‹åŠ¡å‡†å¤‡æŸ¥è¯¢ name = SwimmingLiu çš„å­¦ç”Ÿä¿¡æ¯ (æ•°æ®åº“å½“ä¸­ age = 23 )ï¼Œç½‘ç»œå»¶è¿Ÿè¿˜æ²¡å¼€å§‹æ‰§è¡Œã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡Bä¿®æ”¹ name = SwimmingLiu çš„ age = 99ï¼Œ ç„¶ååŒºæ‰§è¡Œå…¶ä»–çš„æ“ä½œï¼Œè¿˜æ²¡æäº¤äº‹åŠ¡ã€‚äº‹åŠ¡Aè¯»å–åˆ°çš„æ•°æ®ä¸º age = 99ï¼Œ ä½†æ˜¯æ­¤æ—¶æ•°æ®åº“ä¸­çš„æ•°æ®ä¸º age = 23ï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡Aå¼€å¯äº‹åŠ¡å‡†å¤‡æŸ¥è¯¢ name = SwimmingLiu çš„å­¦ç”Ÿä¿¡æ¯ age = 23 ï¼Œç„¶åå»æ‰§è¡Œå…¶ä»–çš„äº‹åŠ¡ã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡Bä¿®æ”¹ name = SwimmingLiu çš„ age = 99ï¼Œæäº¤äº‹åŠ¡ã€‚äº‹åŠ¡A ç¬¬äºŒæ¬¡é‡æ–°å»è¯»å– name = SwimmingLiu çš„å­¦ç”Ÿä¿¡æ¯ (age = 99)ï¼Œ ç¬¬äºŒæ¬¡è¯»å–çš„æ•°æ®å’Œç¬¬ä¸€æ¬¡è¯»å–çš„æ•°æ®å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ å¹»è¯»ï¼šäº‹åŠ¡Aæœ€å¼€å§‹æŸ¥è¯¢ age = 23 çš„å­¦ç”Ÿäººæ•°ï¼Œå‘ç°æœ‰ 10 ä¸ªäººï¼Œç„¶åå»æ‰§è¡Œå…¶ä»–çš„æ“ä½œã€‚äº‹åŠ¡B æ–°å¢äº†ä¸€æ¡age = 23 çš„å­¦ç”Ÿä¿¡æ¯æ•°æ®ï¼Œæäº¤äº‹åŠ¡ã€‚äº‹åŠ¡Aç¬¬äºŒæ¬¡å»æŸ¥è¯¢ age = 23 çš„å­¦ç”Ÿäººæ•°çš„æ—¶å€™ï¼Œå‘ç°å­¦ç”Ÿäººæ•°å˜æˆäº† 11 ä¸ªäººï¼Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„æ•°æ®æ€»é‡ç›¸æ¯”ä¸ä¸€æ ·ã€‚ MySQLçš„ä¹è§‚é”ï¼Œæ‚²è§‚é” ï¼Ÿ æ‚²è§‚é”ï¼šå‡è®¾ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œæ“ä½œå‰åŠ é”ã€‚\n-- æ‚²è§‚é”ï¼Œä½¿ç”¨SELECT ... FOR UPDATE START TRANSACTION; -- å¼€å¯äº‹åŠ¡ SELECT * FROM products WHERE id = 1 FOR UPDATE; -- ä¸Šé”ï¼ˆæ’ä»–é”ï¼‰ UPDATE products SET stock = stock - 1 WHERE id = 1; COMMIT; ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå†²çªï¼Œæ›´æ–°æ—¶æ ¡éªŒç‰ˆæœ¬å·ã€‚\n-- è¡¨ç»“æ„æ·»åŠ versionå­—æ®µ ALTER TABLE products ADD COLUMN version INT DEFAULT 0; -- æŸ¥è¯¢å½“å‰ç‰ˆæœ¬ SELECT id, stock, version FROM products WHERE id = 1; -- ä¹è§‚é”æ›´æ–°ï¼Œæ¡ä»¶ä¸­åŒ…å«ç‰ˆæœ¬å· UPDATE products SET stock = stock - 1, version = version + 1 WHERE id = 1 AND version = å½“å‰ç‰ˆæœ¬å·; Redis èŠä¸€ä¸‹Redisçš„åº”ç”¨åœºæ™¯ ï¼Ÿ æ•°æ®ç¼“å­˜ï¼šæ¶ˆæ¯ç¼“å­˜ã€å•†å“ç¼“å­˜é¢„è§ˆ åˆ†å¸ƒå¼é”ï¼šæ“ä½œä¸´ç•Œèµ„æºçš„æ—¶å€™ï¼Œä½¿ç”¨åˆ†å¸ƒå¼é”è¿›è¡Œä¸Šé”ã€‚ è®¡æ•°å™¨ï¼ˆCounterï¼‰ï¼šé€‚ç”¨äºå®ç°è®¿é—®é‡ç»Ÿè®¡ã€ç‚¹èµæ•°ç­‰åŠŸèƒ½ï¼Œæ”¯æŒé«˜å¹¶å‘ä¸‹çš„åŸå­è‡ªå¢æ“ä½œã€‚ æ’è¡Œæ¦œï¼ˆLeaderboardï¼‰ï¼šé€šè¿‡æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å®ç°å®æ—¶æ’ååŠŸèƒ½ï¼Œå¦‚æ¸¸æˆç§¯åˆ†æ¦œç­‰ã€‚ ä½å›¾ï¼ˆBitmapï¼‰ï¼šç”¨äºå®ç°ç­¾åˆ°ã€æ´»è·ƒç”¨æˆ·ç»Ÿè®¡ç­‰åŠŸèƒ½ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ å…¨å±€å”¯ä¸€ ID ç”Ÿæˆï¼ˆUnique ID Generationï¼‰ï¼šé€šè¿‡è‡ªå¢é”®ç”Ÿæˆå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œé€‚ç”¨äºè®¢å•å·ç­‰åœºæ™¯ã€‚ ç¼“å­˜ä¸‰ä»¶å¥—å’Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Ÿ ç©¿é€ï¼šå®¢æˆ·ç«¯æŸ¥è¯¢çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å¯¹æ•°æ®åº“æŸ¥è¯¢ä¸åˆ°çš„æ•°æ®ï¼ŒåŒæ ·å­˜å…¥Rediså½“ä¸­ï¼Œå€¼è®¾ç½®ä¸º nullã€‚å¦å¤–ä¸€ç§æ–¹æ¡ˆæ˜¯é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„ç­–ç•¥ï¼Œè¿‡æ»¤æ‰éƒ¨åˆ†æ•°æ®ä¸å­˜åœ¨çš„è¯·æ±‚ã€‚ é›ªå´©ï¼šRediså½“ä¸­å¤§é‡çš„keyåŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´å¤§éƒ¨åˆ†è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šã€‚è§£å†³æ–¹æ³•æ˜¯è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ TTL ï¼Œé˜²æ­¢å¤§é‡keyåŒæ—¶è¿‡æœŸã€‚ å‡»ç©¿ï¼šRediså½“ä¸­æŸä¸ªçƒ­ç‚¹Keyçªç„¶è¿‡æœŸï¼Œå¤§é‡çš„æµé‡åŒä¸€æ—¶é—´å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ä¸Šã€‚å¯ä»¥é‡‡ç”¨äº’æ–¥é”ã€é€»è¾‘è¿‡æœŸä¸¤ç§æ–¹æ¡ˆã€‚å¦‚æœå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œå¯ä»¥é‡‡ç”¨äº’æ–¥é”ã€‚å¦‚æœè¦æ±‚ä¸é«˜ï¼Œå¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸçš„æ–¹æ¡ˆï¼Œå¯èƒ½è¿”å›çš„ç¼“å­˜æ•°æ®å’Œæ•°æ®åº“ä¸ä¸€è‡´ã€‚ å¦å¤–ï¼Œé›ªå´©å’Œå‡»ç©¿éƒ½å¯ä»¥é‡‡ç”¨é™æµ+ç†”æ–­çš„æœºåˆ¶ï¼Œæš‚åœæœåŠ¡å¯¹äºç¼“å­˜æœåŠ¡çš„è®¿é—®ï¼Œç›´æ¥è¿”å›é”™è¯¯ã€‚æˆ–è€…å¯ç”¨é™æµè§„åˆ™ï¼Œåªå…è®¸å•†å®¶æˆ–æŒ‡å®šç±»å‹çš„ç”¨æˆ·è¯·æ±‚å‘é€æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œè¿‡å¤šçš„è¯·æ±‚å°±ä¼šæ‹’æ¥ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨ Hystrix æˆ–è€… Sentinel å®ç°ç†”æ–­æˆ–è€…é™æµã€‚\nä¸ºä»€ä¹ˆè¦ç”¨Redisè¿›è¡Œç¼“å­˜ï¼Ÿ å› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ¯”MySQLæ•°æ®åº“çš„é€Ÿåº¦è¦å¿«å¾ˆå¤šå€ã€‚ç”¨Redisè¿›è¡Œç¼“å­˜ï¼Œå¯ä»¥åŠ é€ŸæŸ¥è¯¢æ“ä½œã€‚\nRedisæŒä¹…åŒ–æœºåˆ¶æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ Redisçš„æŒä¹…åŒ–æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼šRDB å’Œ AOF\nRDB: Redisåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œç”Ÿæˆæ•°æ®åº“çš„å¿«ç…§å¹¶å°†å…¶ä¿å­˜ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆdump.rdbï¼‰ã€‚\nä¼˜ç‚¹ï¼š\næ€§èƒ½é«˜ï¼šRDBæ˜¯é€šè¿‡ç”Ÿæˆå¿«ç…§çš„æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸ä¼šé˜»å¡å®¢æˆ·ç«¯æ“ä½œã€‚ å¤‡ä»½æ–¹ä¾¿ï¼šå¯ä»¥é€šè¿‡RDBæ–‡ä»¶è¿›è¡Œæ•°æ®å¤‡ä»½ï¼Œä¸”RDBæ–‡ä»¶è¾ƒå°ã€‚ æ¢å¤é€Ÿåº¦å¿«ï¼šRedisé‡å¯æ—¶ï¼ŒåŠ è½½RDBæ–‡ä»¶æ¯”AOFæ¢å¤é€Ÿåº¦è¦å¿«ã€‚ ç¼ºç‚¹ï¼š\næ•°æ®ä¸¢å¤±ï¼šå¦‚æœRedisåœ¨å¿«ç…§ä¿å­˜æœŸé—´å®•æœºï¼Œä¼šä¸¢å¤±æœªæŒä¹…åŒ–çš„æ•°æ®ã€‚ æŒä¹…åŒ–é¢‘ç‡ä¸çµæ´»ï¼šéœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ‰‹åŠ¨è®¾ç½®æŒä¹…åŒ–çš„é—´éš”ã€‚ **AOF: **Rediså°†æ¯æ¬¡å†™æ“ä½œè¿½åŠ åˆ°AOFæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¿å­˜æ‰€æœ‰å†™å‘½ä»¤ã€‚\nä¼˜ç‚¹ï¼š\næ•°æ®æŒä¹…æ€§é«˜ï¼šAOFä¿è¯äº†æ‰€æœ‰å†™æ“ä½œéƒ½ä¼šè¢«è®°å½•ï¼Œå¯ä»¥åšåˆ°è¾ƒé«˜çš„æ•°æ®å¯é æ€§ã€‚ çµæ´»çš„æŒä¹…åŒ–é¢‘ç‡ï¼šAOFæœ‰ä¸‰ç§åŒæ­¥ç­–ç•¥ï¼š æ¯æ¬¡å†™å…¥ååŒæ­¥ï¼šæœ€å®‰å…¨ï¼Œä½†æ€§èƒ½æœ€å·®ã€‚ æ¯ç§’åŒæ­¥ï¼šå®‰å…¨ä¸æ€§èƒ½çš„æŠ˜è¡·ã€‚ ä»ä¸åŒæ­¥ï¼šæ€§èƒ½æœ€ä½³ï¼Œä½†æœ€å®¹æ˜“ä¸¢å¤±æ•°æ®ã€‚ ç¼ºç‚¹ï¼š\næ€§èƒ½å¼€é”€å¤§ï¼šé¢‘ç¹çš„æ–‡ä»¶è¿½åŠ å’ŒåŒæ­¥å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚ æ¢å¤é€Ÿåº¦æ…¢ï¼šAOFæ–‡ä»¶è¾ƒå¤§ï¼Œæ¢å¤æ—¶éœ€è¦é‡æ–°æ‰§è¡Œæ‰€æœ‰å†™å‘½ä»¤ã€‚ æ–‡ä»¶å¤§å°ï¼šAOFæ–‡ä»¶ç›¸è¾ƒäºRDBæ–‡ä»¶è¦å¤§ï¼Œä¸”éšç€æ“ä½œå¢å¤šï¼ŒAOFæ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ã€‚ ä½ åˆšåˆšè¯´åˆ°çš„RDBå’ŒAOFï¼Œæ˜¯æ€ä¹ˆå¼€å¯çš„å‘¢ï¼Ÿä½ æœ‰ä¿®æ”¹è¿‡Redisçš„é…ç½®æ–‡ä»¶å—ï¼Ÿå¼€å¯çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ RDBï¼š\nredis.confä¿ç•™/æ·»åŠ  save 900 1, save 300 10, save 60 10000 ç­‰è¡Œå³å¯ï¼ˆé»˜è®¤å·²å¯ç”¨ RDBï¼‰ã€‚\nsave 900 1 # 15åˆ†é’Ÿè‡³å°‘1æ¬¡ä¿®æ”¹è§¦å‘ save 60 10000 # 1åˆ†é’Ÿè‡³å°‘10000æ¬¡ä¿®æ”¹è§¦å‘ rdbcompression yes # å¯ç”¨å‹ç¼©å‡å°‘ç£ç›˜å ç”¨ åœ¨çº¿å¼€å¯ï¼šCONFIG SET save \u0026quot;900 1 300 10 60 10000\u0026quot;ï¼Œéšå CONFIG REWRITE å†™å›æ–‡ä»¶ã€‚\nAOF\nredis.conf è®¾ç½® appendonly yesï¼Œé€šå¸¸é…ç½® appendfsync everysecã€‚ åœ¨çº¿å¼€å¯ï¼šCONFIG SET appendonly yesï¼ŒRedis ä¼šè‡ªåŠ¨è§¦å‘ AOF é‡å†™ï¼›å®Œæˆåæ‰§è¡Œ CONFIG REWRITE ã€‚ AOF æ–‡ä»¶åé»˜è®¤ appendonly.aofï¼Œå¯ç”¨ appendfilename è‡ªå®šä¹‰ã€‚ èŠä¸€ä¸‹Redisé›†ç¾¤ ï¼Ÿ Redisé›†ç¾¤æœ‰ä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯ä¸»ä»èŠ‚ç‚¹+ å“¨å…µæœºåˆ¶ Sential æ¨¡å¼ï¼Œå¦å¤–ä¸€ç§æ˜¯ Redis Cluster æ¨¡å¼ Cluster é›†ç¾¤å½“ä¸­åŒ…å«å¤šä¸ª å“¨å…µæœºåˆ¶ Sential æ¨¡å¼çš„ä¸»ä»èŠ‚ç‚¹\nClusteré›†ç¾¤æ¨¡å¼ï¼šé›†ç¾¤æ¨¡å¼ç”¨äºå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä¸»è¦ç”¨äºè§£å†³å¤§æ•°æ®ã€é«˜ååé‡çš„åœºæ™¯ã€‚å°†æ•°æ®è‡ªåŠ¨åˆ†ä¸åˆ°å¤šä¸ªRediså®ä¾‹ä¸Šï¼Œæ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆå¦‚æœæŸä¸ªå®ä¾‹å¤±æ•ˆï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨é‡å†™é…ç½®å’Œå¹³è¡¡ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œè°ƒæ•´ï¼Œå› ä¸ºå†…ç½®äº†å“¨å…µé€»è¾‘ï¼‰\nSentinelå“¨å…µæ¨¡å¼: å“¨å…µæ¨¡å¼ç”¨äºä¿è¯ä¸»ä»èŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦»åœºæ™¯ã€‚å¦‚æœä¸»èŠ‚ç‚¹å®•æœºï¼Œå“¨å…µä¼šå°†ä»èŠ‚ç‚¹å‡ä¸ºä¸»èŠ‚ç‚¹ã€‚\nå¦‚æœé›†ç¾¤çš„Redisä¸­ä¸€å°çªç„¶æŒ‚äº†ï¼Œæ­¤æ—¶æœ‰è¯·æ±‚æœªå¤„ç†æ€ä¹ˆåŠï¼Ÿ é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹ï¼šä»æœ‰æ•ˆçš„ä»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªä»èŠ‚ç‚¹åšä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼ˆé€‰å–æ¡ä»¶ï¼šä¼˜å…ˆçº§ \u0026gt; å¤åˆ¶è¿›åº¦ offset \u0026gt; ä»èŠ‚ç‚¹ id å¤§å°ï¼‰\nå®¢æˆ·ç«¯é‡è¯•ä¸é‡å®šå‘ï¼šRedisé›†ç¾¤çš„Smartå®¢æˆ·ç«¯ï¼ˆå¦‚JedisClusterï¼‰å†…ç½®è·¯ç”±è¡¨ï¼Œå½“è¯·æ±‚å‘é€è‡³æ•…éšœèŠ‚ç‚¹æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ° MOVED æˆ– ASK é‡å®šå‘æŒ‡ä»¤ï¼Œè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘è‡³æ–°ä¸»èŠ‚ç‚¹ã€‚\nRediså¦‚ä½•è®¾ç½®å‡è¡¡è´Ÿè½½çš„ï¼Ÿ Redis ç¼“å­˜æ˜¯å¦‚ä½•æ›´æ–°çš„ ï¼ˆæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼‰ï¼Ÿ å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ï¼šé™¤äº†åˆ é™¤ç¼“å­˜æ“ä½œå¤±è´¥ä»¥å¤–ï¼Œèƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§é—®é¢˜ å»¶è¿ŸåŒåˆ  (å…ˆåˆ ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“ï¼Œå†å»¶è¿Ÿåˆ é™¤ç¼“å­˜)ï¼šé™¤äº†åˆ é™¤ç¼“å­˜æ“ä½œå¤±è´¥ä»¥å¤–ï¼Œèƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå¦å¤–ä¹Ÿä¸å¥½ç¡®å®šå»¶è¿Ÿçš„æ—¶é—´ï¼ˆä¸€èˆ¬æ˜¯æ‰‹åŠ¨è®¾ç½®çš„ï¼‰ ã€å¼ºä¸€è‡´æ€§ã€‘\nbinlog + Canalï¼šé€šè¿‡ binlog æ£€æµ‹æ•°æ®åº“æ˜¯å¦å‘ç”Ÿæ”¹åŠ¨ï¼Œå¦‚æœå‡ºç°æ”¹åŠ¨ï¼Œå°±è§¦å‘åˆ é™¤ç¼“å­˜çš„æœºåˆ¶ã€‚åˆ é™¤ç¼“å­˜æ“ä½œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼å®ç°ï¼Œä¹‹åå½“Redisæ¶ˆæ¯è¢«æˆåŠŸåˆ é™¤ï¼Œæ‰æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚ ä¸ºä»€ä¹ˆRedisæ˜¯å•çº¿ç¨‹çš„ ï¼Ÿ åŸºäºå†…å­˜æ“ä½œï¼ŒRedisçš„ç“¶é¢ˆä¸»è¦æ˜¯å†…å­˜ï¼Œå¤šæ•°æ“ä½œçš„æ€§èƒ½ç“¶é¢ˆä¸æ˜¯CPUå¸¦æ¥çš„ (å¢åŠ å¤šçº¿ç¨‹ä¹Ÿæ²¡å•¥ç”¨) å•çº¿ç¨‹æ¨¡å‹çš„ä»£ç ç®€å•ï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ€§èƒ½å¼€é”€ã€‚ å•çº¿ç¨‹ç»“åˆI/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œèƒ½æé«˜I/Oåˆ©ç”¨ç‡ ã€æ³¨æ„ã€‘ Redisçš„å•çº¿ç¨‹æ˜¯æŒ‡ç½‘ç»œè¯·æ±‚æ¨¡å—å’Œæ•°æ®æ“ä½œæ¨¡å—æ˜¯å•çº¿ç¨‹çš„, ä½†æ˜¯æŒä¹…åŒ–å­˜å‚¨æ¨¡å—å’Œé›†ç¾¤æ”¯æ’‘æ¨¡å—æ˜¯å¤šçº¿ç¨‹çš„ã€‚\nSpring Springçš„ä¸¤å¤§ç‰¹æ€§ï¼ŸIOCå’ŒAOP? IoCï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼šå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»äº¤ç”± Spring å®¹å™¨ç®¡ç†ï¼Œå®ç°è§£è€¦å’Œçµæ´»é…ç½®ã€‚\nAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼šå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ï¼‰ä»ä¸šåŠ¡é€»è¾‘ä¸­æŠ½ç¦»ï¼Œé›†ä¸­ç®¡ç†ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚\nSpring çš„ bean ç”Ÿå‘½å‘¨æœŸï¼Ÿ Spring çš„ Bean ç”Ÿå‘½å‘¨æœŸä»å®¹å™¨å¯åŠ¨å¼€å§‹ï¼Œé¦–å…ˆåŠ è½½ Bean å®šä¹‰å¹¶å®ä¾‹åŒ– Beanã€‚ç„¶å Spring å®¹å™¨æ³¨å…¥ä¾èµ–ï¼Œå¹¶è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚ @PostConstruct æ³¨è§£çš„æ–¹æ³•æˆ–é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ init-method æ–¹æ³•ã€‚Bean å®Œæˆåˆå§‹åŒ–åï¼Œå‡†å¤‡å¥½ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚å½“å®¹å™¨å…³é—­æ—¶ï¼ŒSpring ä¼šè°ƒç”¨é”€æ¯æ–¹æ³•ï¼Œå¦‚ @PreDestroy æ³¨è§£çš„æ–¹æ³•æˆ–é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ destroy-method æ–¹æ³•ï¼Œæœ€åé”€æ¯ Bean å®ä¾‹ã€‚\nSpringMVC ä¸­çš„Beanä½œç”¨åŸŸ ? singletonï¼ˆé»˜è®¤ï¼‰ï¼šæ•´ä¸ª Spring å®¹å™¨ä¸­ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé€‚ç”¨äºæ— çŠ¶æ€çš„å…±äº«ç»„ä»¶ã€‚ prototypeï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œé€‚ç”¨äºæœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚ requestï¼šæ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œé€‚ç”¨äºæ¯æ¬¡è¯·æ±‚éœ€è¦ç‹¬ç«‹çŠ¶æ€çš„ç»„ä»¶ã€‚ sessionï¼šæ¯ä¸ª HTTP ä¼šè¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œé€‚ç”¨äºéœ€è¦åœ¨ç”¨æˆ·ä¼šè¯ä¸­å…±äº«çŠ¶æ€çš„ç»„ä»¶ã€‚ applicationï¼šæ•´ä¸ª ServletContext å…±äº«ä¸€ä¸ªå®ä¾‹ï¼Œé€‚ç”¨äºéœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ä¸­å…±äº«çŠ¶æ€çš„ç»„ä»¶ã€‚ Springbootå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶ ? Spring Booté€šè¿‡å¤šæºå±‚çº§åŒ–çš„é…ç½®åŠ è½½æœºåˆ¶ï¼Œæ”¯æŒä»å¤šç§æ¥æºï¼ˆå¦‚å±æ€§æ–‡ä»¶ã€YAMLæ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰ï¼‰åŠ¨æ€åŠ è½½é…ç½®ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½è¦†ç›–åŒåå±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šä¼˜å…ˆåŠ è½½å‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚ --server.port=8080ï¼‰ï¼Œå…¶æ¬¡æ˜¯ç¯å¢ƒå˜é‡ï¼ˆå¦‚SPRING_DATASOURCE_URLï¼‰å’Œå¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆapplication.yml æˆ– application.propertiesï¼‰ï¼Œæœ€åæ˜¯é¡¹ç›®å†…éƒ¨èµ„æºç›®å½•ä¸‹çš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚å¦å¤–ï¼Œå¯ä»¥é€šè¿‡spring.profiles.active æ¿€æ´»ç‰¹å®šç¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚dev ã€test ã€prod ç¯å¢ƒ\nã€æ³¨æ„ã€‘application.properties çš„ä¼˜å…ˆçº§é«˜äº application.yml\nSpringMVCçš„å¯åŠ¨æµç¨‹ ? é¦–å…ˆï¼Œå¯åŠ¨æ—¶åŠ è½½ DispatcherServletï¼Œå®ƒæ˜¯ SpringMVC çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼›\nå…¶æ¬¡ï¼ŒDispatcherServlet é€šè¿‡ web.xml é…ç½®æ–‡ä»¶è¯»å–ç›¸å…³é…ç½®ï¼Œåˆå§‹åŒ–Springå®¹å™¨ï¼›\nç„¶åï¼ŒDispatcherServlet æ ¹æ® URLè¯·æ±‚ é€šè¿‡ HandlerMapping æŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å™¨ï¼ˆControllerï¼‰ï¼›\næœ€åï¼Œæ‰§è¡Œå¤„ç†å™¨æ–¹æ³•åï¼Œé€šè¿‡ ViewResolver è§£æè§†å›¾å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\næ•´ä¸ªè¿‡ç¨‹å®ç°äº†è¯·æ±‚çš„åˆ†å‘ã€å¤„ç†å’Œå“åº”ã€‚\nå…¶ä»– ä½ è‡ªå·±åœ¨éƒ¨ç½²é¡¹ç›®çš„æ—¶å€™æœ‰æ’æŸ¥è¿‡é—®é¢˜æ²¡æœ‰ï¼Ÿç®€å•æè¿°ä¸€ä¸‹æŸ¥è¯¢æ—¥å¿—çš„linuxå‘½ä»¤ æ’æŸ¥è¿‡é—®é¢˜, æˆ‘ä½¿ç”¨çš„æ˜¯ tail -n 20 -f xxx.log\nLinuxä¸­pwdå‘½ä»¤ï¼Œä»¥åŠå¦‚ä½•æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶å‘½ä»¤ pwd å‘½ä»¤ï¼šè¿™ä¸ªå‘½ä»¤æ˜¯ç”¨æ¥æ˜¾ç¤ºå½“å‰è·¯å¾„çš„ç»å¯¹è·¯å¾„çš„ æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶å‘½ä»¤ï¼šfind /home -name xxx.txt AIåµŒå…¥è¿›IDEAä¸­çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆç®—æ³•ï¼Ÿ copilot : å¤§è¯­è¨€æ¨¡å‹æ¥å£ + å½“å‰æ–‡ä»¶ / æŒ‡å®šæ–‡ä»¶åšä¸ºä¸Šä¸‹æ–‡\nè®¾è®¡æ¨¡å¼äº†è§£å“ªäº›ï¼Œè®¾è®¡æ¨¡å¼æœ‰å“ªäº›åŸåˆ™ ã€è®¾è®¡æ¨¡å¼ã€‘\nè®¾è®¡æ¨¡å¼æ˜¯å¯¹è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„é€šç”¨å¯å¤ç”¨è§£å†³æ–¹æ¡ˆï¼Œåˆ†ä¸ºä¸‰å¤§ç±»ï¼š\nåˆ›å»ºå‹æ¨¡å¼ï¼šè§£å†³å¯¹è±¡åˆ›å»ºçš„å¤æ‚æ€§ï¼Œå¦‚ Singletonï¼ˆå•ä¾‹ï¼‰ã€Factory Methodï¼ˆå·¥å‚æ–¹æ³•ï¼‰ã€Abstract Factoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰ã€Builderï¼ˆå»ºé€ è€…ï¼‰ã€Prototypeï¼ˆåŸå‹ï¼‰ã€‚ ç»“æ„å‹æ¨¡å¼ï¼šå¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œç®€åŒ–ç»“æ„ï¼Œå¦‚ Adapterï¼ˆé€‚é…å™¨ï¼‰ã€Bridgeï¼ˆæ¡¥æ¥ï¼‰ã€Compositeï¼ˆç»„åˆï¼‰ã€Decoratorï¼ˆè£…é¥°å™¨ï¼‰ã€Facadeï¼ˆå¤–è§‚ï¼‰ã€Flyweightï¼ˆäº«å…ƒï¼‰ã€Proxyï¼ˆä»£ç†ï¼‰ã€‚ è¡Œä¸ºå‹æ¨¡å¼ï¼šå…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å’ŒèŒè´£åˆ†é…ï¼Œå¦‚ Chain of Responsibilityï¼ˆè´£ä»»é“¾ï¼‰ã€Commandï¼ˆå‘½ä»¤ï¼‰ã€Iteratorï¼ˆè¿­ä»£å™¨ï¼‰ã€Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ã€Strategyï¼ˆç­–ç•¥ï¼‰ã€Template Methodï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰ã€Visitorï¼ˆè®¿é—®è€…ï¼‰ã€‚ ã€è®¾è®¡åŸåˆ™ã€‘\nè®¾è®¡åŸåˆ™åˆ™æ˜¯æŒ‡å¯¼è½¯ä»¶å¼€å‘çš„é«˜å±‚æ¬¡å‡†åˆ™ï¼Œå¸®åŠ©æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ç³»ç»Ÿã€‚å…¶ä¸­ï¼ŒSOLID æ˜¯äº”ä¸ªæ ¸å¿ƒé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„é¦–å­—æ¯ç¼©å†™ï¼š\nå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼šä¸€ä¸ªç±»åº”ä»…æœ‰ä¸€ä¸ªå¼•èµ·å…¶å˜åŒ–çš„åŸå› ï¼Œå³åªæ‰¿æ‹…ä¸€ä¸ªèŒè´£ã€‚ å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼šè½¯ä»¶å®ä½“åº”å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œå³å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ‰©å±•åŠŸèƒ½ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰ï¼šå­ç±»å‹å¯¹è±¡åº”èƒ½å¤Ÿæ›¿æ¢ä»»ä½•çˆ¶ç±»å‹å¯¹è±¡ï¼Œå¹¶ä¸”ç¨‹åºè¡Œä¸ºä¸å—å½±å“ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ï¼šä¸åº”å¼ºè¿«å®¢æˆ·ä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ–¹æ³•ï¼Œå»ºè®®ä¸ºä¸åŒçš„å®¢æˆ·æä¾›ä¸“é—¨çš„æ¥å£ã€‚ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ï¼šé«˜å±‚æ¨¡å—ä¸åº”ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”ä¾èµ–äºæŠ½è±¡ï¼›æŠ½è±¡ä¸åº”ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”ä¾èµ–æŠ½è±¡ã€‚ è¯·æ±‚è½¬å‘å’Œé‡å®šå‘åŒºåˆ« ? ç‰¹æ€§ è¯·æ±‚è½¬å‘ï¼ˆForwardï¼‰ è¯·æ±‚é‡å®šå‘ï¼ˆRedirectï¼‰ è·³è½¬æ–¹å¼ æœåŠ¡å™¨ç«¯å†…éƒ¨è·³è½¬ æµè§ˆå™¨å‘èµ·æ–°è¯·æ±‚ è¯·æ±‚æ¬¡æ•° ä¸€æ¬¡è¯·æ±‚ è‡³å°‘ä¸¤æ¬¡è¯·æ±‚ URL åœ°å€æ  ä¸å˜ æ›´æ–°ä¸ºæ–° URL æ•°æ®å…±äº« åŒä¸€è¯·æ±‚å¯¹è±¡ï¼Œå…±äº«æ•°æ® ä¸å…±äº«æ•°æ®ï¼Œéœ€é€šè¿‡ session æˆ– URL å‚æ•°ä¼ é€’ æ€§èƒ½ è¾ƒå¿« è¾ƒæ…¢ ä½¿ç”¨åœºæ™¯ åŒä¸€ Web åº”ç”¨å†…éƒ¨è·³è½¬ è·¨åŸŸã€è·¨ç«™ç‚¹è·³è½¬ï¼Œæˆ–é¿å…é‡å¤æäº¤ç­‰åœºæ™¯ TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œ4æ¬¡æŒ¥æ‰‹ ç®€å†ç›¸å…³å…«è‚¡ ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸€äººä¸€å•ï¼Ÿå¦‚ä½•è§£å†³è¶…å–é—®é¢˜å’Œä¸€äººä¸€å•é—®é¢˜ï¼Ÿ è®¾ç½®ä¸€äººä¸€å•ï¼šé˜²æ­¢é¡¾å®¢åå¤åˆ·å• è¶…å–é—®é¢˜ï¼šMySQL ä¹è§‚é”æ£€æµ‹ stock \u0026gt; 0 / Redisç”¨ lua è„šæœ¬ ä¸€äººä¸€å•é—®é¢˜ï¼šMySQL ç»Ÿè®¡æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·çš„è®¢å• / Redis ç”¨ lua è„šæœ¬ æ¶ˆæ¯é˜Ÿåˆ—æ€ä¹ˆä¿è¯æ•°æ®å¯é æ€§ ? æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰é€šè¿‡å¤šç§æœºåˆ¶ç¡®ä¿æ•°æ®çš„å¯é æ€§ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\næ¶ˆæ¯æŒä¹…åŒ–ï¼šå°†æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ï¼Œç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒæˆ–é‡å¯åæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯åï¼Œç­‰å¾…æ¶ˆæ¯è¢«æ¶ˆè´¹è€…ç¡®è®¤å¤„ç†æˆåŠŸï¼Œæœªç¡®è®¤çš„æ¶ˆæ¯ä¼šè¢«é‡è¯•å‘é€ã€‚ é‡è¯•æœºåˆ¶ï¼šåœ¨æ¶ˆæ¯å‘é€æˆ–æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§é¢„å®šç­–ç•¥è¿›è¡Œé‡è¯•ï¼Œç›´è‡³æ¶ˆæ¯æˆåŠŸå¤„ç†æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚ å¹‚ç­‰æ€§å¤„ç†ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯æ—¶ï¼Œç¡®ä¿åŒä¸€æ¶ˆæ¯å¤šæ¬¡æ¶ˆè´¹ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ æ­»ä¿¡é˜Ÿåˆ—ï¼šå°†æ— æ³•æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯è½¬ç§»åˆ°ä¸“é—¨çš„é˜Ÿåˆ—ä¸­ï¼Œä¾›åç»­äººå·¥æˆ–ç³»ç»Ÿå¤„ç†ã€‚ äº‹åŠ¡æœºåˆ¶ï¼šåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å®ç°äº‹åŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯çš„å‘é€å’Œæ¶ˆè´¹æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚ Websocketï¼Œwebsocket ä¸ http åŒºåˆ«ï¼Ÿ Websocket ç›¸å½“äºå…¨åŒå·¥é€šä¿¡ï¼Œä¾‹å¦‚ç›´æ’­èŠå¤©å°±æ˜¯é‡‡ç”¨ Websocket å…¨åŒå·¥é€šä¿¡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åŒå‘å‘é€æ¶ˆæ¯\nã€websocket å’Œ http åŒºåˆ«ã€‘\nHTTP æ˜¯åŸºäºè¯·æ±‚-å“åº”æ¨¡å¼çš„æ— çŠ¶æ€çŸ­è¿æ¥åè®®ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡éœ€ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”åè¿æ¥ç«‹å³æ–­å¼€ï¼Œé€‚ç”¨äºä¼ ç»Ÿç½‘é¡µåŠ è½½ç­‰ä½é¢‘äº¤äº’åœºæ™¯ï¼›WebSocket åˆ™é€šè¿‡ä¸€æ¬¡ HTTP æ¡æ‰‹å‡çº§ä¸ºå…¨åŒå·¥é•¿è¿æ¥åè®®ï¼Œæ”¯æŒå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å®æ—¶åŒå‘é€šä¿¡ï¼Œæ•°æ®ä»¥äºŒè¿›åˆ¶å¸§é«˜æ•ˆä¼ è¾“ï¼Œå‡å°‘äº†å¤´éƒ¨å†—ä½™å¼€é”€ï¼Œé€‚ç”¨äºåœ¨çº¿èŠå¤©ã€å®æ—¶æ¸¸æˆç­‰é«˜é¢‘ä½å»¶è¿Ÿåœºæ™¯ã€‚æ­¤å¤–ï¼ŒHTTP é»˜è®¤æ— åŠ å¯†ï¼ˆHTTPS éœ€é¢å¤–é…ç½®ï¼‰ï¼Œè€Œ WebSocket å¤©ç„¶æ”¯æŒ WSS åŠ å¯†ï¼Œå®‰å…¨æ€§æ›´ä¼˜ã€‚\nåœºæ™¯é¢˜ æˆ‘ç°åœ¨æœ‰ä¸¤åƒä¸‡çš„å®¢æˆ·æ•°æ®ï¼Œä½†æ˜¯æˆ‘çš„Redisä¸­åªèƒ½å­˜å‚¨20ä¸‡çš„é«˜å‡€å€¼ç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘è¯¥æ€ä¹ˆç¡®ä¿æ¯æ¬¡æ‹¿å‡ºæ¥çš„éƒ½æ˜¯é«˜å‡€å€¼çš„ç”¨æˆ·å‘¢ï¼Ÿ ç­›é€‰çš„æ­¥éª¤å¦‚å›¾æ‰€ç¤ºï¼š\né«˜å‡€å€¼ç”¨æˆ·å®šä¹‰ä¸æ•°æ®å»ºæ¨¡ï¼š æ ¹æ®ä¸šåŠ¡ç‰¹å¾å®šä¹‰å¤šç»´åº¦è¯„ä¼°æ¨¡å‹ï¼Œæ„å»ºæŒ‡æ ‡ä½“ç³»ã€‚ä¾‹å¦‚ï¼Œé‡‘èèµ„äº§æ€»é¢ (40%)ã€å¹´æ¶ˆè´¹é¢‘æ¬¡ (30%)ã€æœ€è¿‘æ´»è·ƒæ—¶é—´ (20%)ã€é£é™©ç­‰çº§ (10%)\n@Data public class Customer { private String id; // ç”¨æˆ·IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ private BigDecimal assets; // é‡‘èèµ„äº§ï¼ˆç²¾ç¡®è®¡ç®—ï¼‰ private int annualPurchases; // å¹´æ¶ˆè´¹æ¬¡æ•° private LocalDateTime lastActive; // æœ€è¿‘æ´»è·ƒæ—¶é—´ private int riskLevel; // é£é™©ç­‰çº§ï¼ˆ1-5çº§ï¼‰ // è®¡ç®—ç»¼åˆå¾—åˆ†ï¼ˆéœ€ç¼“å­˜é¿å…é‡å¤è®¡ç®—ï¼‰ private transient BigDecimal score; } é«˜æ•ˆç­›é€‰2000ä¸‡ä¸­çš„20ä¸‡ä¼˜è´¨æ•°æ®ï¼š\næ–¹æ¡ˆ1ï¼šStream API + å¹¶è¡Œè®¡ç®—ï¼ˆé€‚åˆå…¨é‡ç­›é€‰ï¼‰ List\u0026lt;Customer\u0026gt; allCustomers = loadFromDatabase(); // ä»æ•°æ®åº“åŠ è½½2000ä¸‡æ•°æ® Predicate\u0026lt;Customer\u0026gt; highValueFilter = customer -\u0026gt; customer.getRiskLevel() \u0026lt;= 3 \u0026amp;\u0026amp; // é£é™©ç­‰çº§â‰¤3 customer.getLastActive().isAfter(LocalDateTime.now().minusMonths(3)); // è¿‘3ä¸ªæœˆæ´»è·ƒ List\u0026lt;Customer\u0026gt; topCustomers = allCustomers.parallelStream() // å¯ç”¨å¹¶è¡Œæµ .filter(highValueFilter) .sorted(Comparator.comparing(Customer::getScore).reversed()) // æŒ‰å¾—åˆ†é™åº .limit(200_000) // å–å‰20ä¸‡ .collect(Collectors.toList()); æ–¹æ¡ˆ2ï¼šæ•°æ®åº“åˆ†é¡µ+å®æ—¶è®¡ç®—ï¼ˆé€‚åˆå¢é‡æ›´æ–°ï¼‰ // ä½¿ç”¨JPA/Hibernateåˆ†é¡µæŸ¥è¯¢ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰ int pageSize = 5000; int page = 0; List\u0026lt;Customer\u0026gt; batchList; do { batchList = customerRepository.findHighValueCustomers( PageRequest.of(page, pageSize, Sort.by(\u0026#34;score\u0026#34;).descending()) ); redisClient.batchInsert(batchList); // æ‰¹é‡å†™å…¥Redis page++; } while (!batchList.isEmpty()); Redis å­˜å‚¨æ•°æ® (å¯¹åº”ä¸Šé¢çš„æ‰¹é‡å†™å…¥Redis)ï¼š\nå­˜å‚¨å®¢æˆ·æ’åæ•°æ®ï¼šé‡‡ç”¨ Sorted Setï¼ˆZSET) ä»¥ç”¨æˆ·IDä¸º memberï¼Œç»¼åˆå¾—åˆ†ä¸ºscoreï¼Œè‡ªåŠ¨æŒ‰ score æ’åºï¼Œå¤©ç„¶æ”¯æŒ TOP NæŸ¥è¯¢ã€‚\nJedis jedis = RedisPool.getResource(); Pipeline pipeline = jedis.pipelined(); topCustomers.forEach(c -\u0026gt; pipeline.zadd(\u0026#34;high_value_users\u0026#34;, c.getScore().doubleValue(), c.getId()) ); pipeline.sync(); å­˜å‚¨å®¢æˆ·ä¿¡æ¯æ•°æ®ï¼šç”¨Hashå­˜å‚¨ç”¨æˆ·è¯¦ç»†ä¿¡æ¯\ntopCustomers.forEach(c -\u0026gt; { pipeline.hset(\u0026#34;user:\u0026#34; + c.getId(), \u0026#34;assets\u0026#34;, c.getAssets().toString(), \u0026#34;lastActive\u0026#34;, c.getLastActive().toString() ); }); å®¹é‡æ§åˆ¶ (åªä¿ç•™20ä¸‡æ•°æ®)ï¼š\n// ä¿ç•™å‰20ä¸‡ï¼Œè‡ªåŠ¨æ·˜æ±°ä½åˆ†ç”¨æˆ· jedis.zremrangeByRank(\u0026#34;high_value_users\u0026#34;, 200_000, -1); // è®¾ç½®TTLé¿å…æ•°æ®è¿‡æœŸï¼ˆæ•°æ®ä¸ä¸€è‡´ï¼‰ jedis.expire(\u0026#34;high_value_users\u0026#34;, 86400); åŠ¨æ€æ›´æ–°æœºåˆ¶ (å®šæ—¶æ›´æ–°)\n@Scheduled(cron = \u0026#34;0 0 3 * * ?\u0026#34;) // æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œ public void refreshHighValueUsers() { List\u0026lt;Customer\u0026gt; newHighValue = customerRepository.findNewHighValueUsers(); // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼ˆç½‘é¡µ6[6](@ref)ï¼‰ String luaScript = \u0026#34;redis.call(\u0026#39;ZADD\u0026#39;, KEYS[1], ARGV[1], ARGV[2]) \u0026#34; + \u0026#34;redis.call(\u0026#39;ZREMRANGEBYRANK\u0026#39;, KEYS[1], 200000, -1)\u0026#34;; jedis.eval(luaScript, 1, \u0026#34;high_value_users\u0026#34;, newHighValue.getScore(), newHighValue.getId()); } æˆ‘ä»¬åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°èŠ‚ç‚¹æŒ‚æ‰æˆ–è€…æ˜¯æ•´ä¸ªRedisæŒ‚æ‰çš„æƒ…å†µï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½ä¿è¯RedisæŒ‚æ‰ä¹‹åèƒ½å¤Ÿè®©æ•°æ®è¿›è¡Œæ¢å¤å‘¢? æ‰“å¼€â€¯AOFâ€¯(everysec) + RDBâ€¯åŒæŒä¹…åŒ–ï¼›é‡å¯æ—¶å…ˆåŠ è½½â€¯RDBâ€¯å†å›æ”¾â€¯AOFï¼Œå‡ ä¹é›¶ä¸¢æ•°æ®ã€‚ éƒ¨ç½²ä¸»ä»å¤åˆ¶ï¼‹ å¤§äºç­‰äº3â€¯ä¸ªâ€¯çš„å“¨å…µSentinelâ€¯æˆ–ç›´æ¥ç”¨â€¯Redisâ€¯Clusterï¼ŒèŠ‚ç‚¹å®•æœºç§’çº§è‡ªåŠ¨é€‰ä¸»å¹¶åˆ‡æ¢å®¢æˆ·ç«¯ã€‚ å®šæ—¶æŠŠâ€¯AOF/RDBâ€¯å¤‡ä»½åˆ°å¤–éƒ¨å­˜å‚¨ï¼›ç¾éš¾æ—¶æ‹‰å›æ–‡ä»¶å¯åŠ¨æˆ–â€¯RESTOREâ€¯å³å¯ï¼Œæ³¨æ„å¤šâ€¯TBâ€¯å¤‡ä»½çš„åŠ è½½æ—¶é—´å¹¶å®šæœŸæ¼”ç»ƒã€‚ ã€AOF å’Œ RDB å¦‚ä½•æ‰“å¼€ï¼Ÿã€‘\nRDBï¼š\nredis.confä¿ç•™/æ·»åŠ  save 900 1, save 300 10, save 60 10000 ç­‰è¡Œå³å¯ï¼ˆé»˜è®¤å·²å¯ç”¨ RDBï¼‰ã€‚\nsave 900 1 # 15åˆ†é’Ÿè‡³å°‘1æ¬¡ä¿®æ”¹è§¦å‘ save 60 10000 # 1åˆ†é’Ÿè‡³å°‘10000æ¬¡ä¿®æ”¹è§¦å‘ rdbcompression yes # å¯ç”¨å‹ç¼©å‡å°‘ç£ç›˜å ç”¨ åœ¨çº¿å¼€å¯ï¼šCONFIG SET save \u0026quot;900 1 300 10 60 10000\u0026quot;ï¼Œéšå CONFIG REWRITE å†™å›æ–‡ä»¶ã€‚\nAOF\nredis.conf è®¾ç½® appendonly yesï¼Œé€šå¸¸é…ç½® appendfsync everysecã€‚ åœ¨çº¿å¼€å¯ï¼šCONFIG SET appendonly yesï¼ŒRedis ä¼šè‡ªåŠ¨è§¦å‘ AOF é‡å†™ï¼›å®Œæˆåæ‰§è¡Œ CONFIG REWRITE ã€‚ AOF æ–‡ä»¶åé»˜è®¤ appendonly.aofï¼Œå¯ç”¨ appendfilename è‡ªå®šä¹‰ã€‚ æˆ‘ç°åœ¨Redisæ˜¯ä¸ªå•æœºï¼Œä½†æ˜¯æˆ‘ç°åœ¨æœ‰å¾ˆå¤šä¸ªç³»ç»Ÿï¼ŒåŒæ—¶å¯¹ä¸€ä¸ªç±»è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆæˆ‘çš„ä¸€ä¸ªkeyè‚¯å®šä¼šå¯¼è‡´è¢«å¤šå¹¶å‘çš„å»ç«äº‰ï¼Ÿæ€ä¹ˆè§£å†³è¿™æ ·çš„ç«äº‰é—®é¢˜ï¼Ÿ åˆ†å¸ƒå¼é”ï¼ˆSETNXï¼‰ï¼šä½¿ç”¨Redisçš„ SETNX å‘½ä»¤æˆ–è€…Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªç³»ç»Ÿå®ä¾‹æ“ä½œè¯¥keyã€‚\næ¶ˆæ¯é˜Ÿåˆ—ä¸²è¡ŒåŒ–ï¼šå°†å¯¹åŒä¸€ key çš„æ“ä½œæ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¡®ä¿æ“ä½œæŒ‰é¡ºåºæ‰§è¡Œï¼Œé¿å…å¹¶å‘å†²çªã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨RabbitMQæˆ–Kafkaç­‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå°†æ“ä½œå°è£…ä¸ºæ¶ˆæ¯ï¼ŒæŒ‰é¡ºåºå¤„ç†ã€‚\næ—¶é—´æˆ³æ§åˆ¶ï¼šåœ¨å†™å…¥keyæ—¶ï¼Œæºå¸¦æ—¶é—´æˆ³ï¼Œåªæœ‰å½“æ–°æ“ä½œçš„æ—¶é—´æˆ³æ™šäºå½“å‰å­˜å‚¨çš„æ—¶é—´æˆ³æ—¶ï¼Œæ‰æ‰§è¡Œå†™å…¥ï¼Œç¡®ä¿æ•°æ®çš„æ—¶åºæ€§ã€‚\nHSET your_key value new_value timestamp new_timestamp é«˜å¹¶å‘ä¸»è¦è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Ÿ çº¿ç¨‹/è¿æ¥æ± å®¹é‡ï¼šTomcat workThreadsã€HikariCPâ€¯maxâ€‘poolâ€‘size å¿…é¡»æŒ‰â€¯CPUÃ—2+I/Oâ€¯è´Ÿè½½ä¼°ç®—ï¼Œé˜²æ­¢æ± è€—å°½å’Œæ’é˜Ÿâ€‚ç†”æ–­â€‘é™æµâ€‘éš”ç¦»ï¼šç”¨â€¯Hystrix/Sentinel/Gatewayâ€¯åšçº¿ç¨‹æ± éš”ç¦»ã€ç†”æ–­ä¸åŸºäºâ€¯Redisâ€¯çš„é™æµï¼Œé˜»æ–­çº§è”é›ªå´©â€‚ç¼“å­˜ç­–ç•¥ï¼šçƒ­ç‚¹é¢„åŠ è½½ã€äº’æ–¥é”ã€å¸ƒéš†è¿‡æ»¤å™¨ï¼Œåˆ†æ•£è¿‡æœŸæ—¶é—´ï¼Œè§£å†³ç©¿é€/å‡»ç©¿/é›ªå´©â€‚æ•°æ®ä¸€è‡´æ€§ï¼šå¹‚ç­‰é”®ï¼‹TCC/SAGAâ€¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¿å…é‡å¤å†™ä¸è„æ•°æ®â€‚JVMâ€¯GCåœé¡¿ï¼šG1/ZGCâ€¯+â€¯-XX:MaxGCPauseMillis=*ï¼ŒæŒç»­å‹æµ‹ã€ç›‘æ§ è¶…æ—¶/é‡è¯•/èƒŒå‹ï¼šè¶…æ—¶ \u0026gt; é‡è¯•æ€»æ—¶é•¿ï¼›Reactive æµèƒŒå‹å®ˆæŠ¤çº¿ç¨‹æ± â€‚å¯è§‚æµ‹æ€§ï¼šæŒ‡æ ‡ã€æ—¥å¿—ã€åˆ†å¸ƒå¼ Tracing æŒç»­å®¡è®¡æ€§èƒ½ç“¶é¢ˆã€‚ å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ’åºç„¶åè½¬æ¢ä¸ºå¤§å†™æ€ä¹ˆå®ç°ï¼Ÿ å°†å­—ç¬¦ä¸²ä¸“ç¨‹æ•°ç»„ï¼Œç„¶åè°ƒç”¨ Arrays.sort() å‡½æ•°ï¼Œç„¶åè°ƒç”¨ new String(chars).toUpperCase() å°†å­—ç¬¦æ•°ç»„è½¬æˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†æ‰€æœ‰çš„å­—æ¯éƒ½è½¬æ¢æˆå¤§å°ã€‚\nString originalStr = \u0026#34;helloWorld\u0026#34;; // 1. è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„å¹¶æ’åº char[] chars = originalStr.toCharArray(); Arrays.sort(chars); // 2. ç”Ÿæˆæ’åºåçš„å­—ç¬¦ä¸²å¹¶è½¬å¤§å†™ String sortedUpperStr = new String(chars).toUpperCase(); System.out.println(sortedUpperStr); // è¾“å‡º: DEHLLLOORW ç»¼åˆé¢˜ \u0026amp; æ™ºåŠ›é¢˜ é«˜è€ƒå®Œå­¦ç”ŸæŠ•æ¡£åˆ°å„ä¸ªå­¦æ ¡ï¼Œåº”è¯¥æ€æ ·è®¾è®¡ç®—æ³•ï¼Ÿ æ±‚ä¸¤æ”¯è‚¡ç¥¨åœ¨ä¸€æ®µæ—¶é—´å†…çš„æœ€é•¿åŒæ­¥ä¸Šå‡æ—¶é—´ ","permalink":"https://swimmingliu.cn/posts/job/hensheng-interview-questions/","summary":"\u003ch2 id=\"å…«è‚¡é¢˜\"\u003eå…«è‚¡é¢˜\u003c/h2\u003e\n\u003ch3 id=\"java-åŸºç¡€--é›†åˆ\"\u003eJava åŸºç¡€ + é›†åˆ\u003c/h3\u003e\n\u003ch4 id=\"é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«\"\u003eé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«ï¼Ÿ\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eé¢å‘å¯¹è±¡\u003c/strong\u003eï¼šå°†æ•°æ®å’Œæ–¹æ³•å°è£…æˆå¯¹è±¡ï¼Œä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒæ¥ç»„ç»‡ä»£ç ï¼ŒåŒ…å«å°è£…ã€ç»§æ‰¿ã€å¤šæ€ä¸‰å¤§ç‰¹æ€§ï¼Œæ–¹ä¾¿ä»£ç å¤ç”¨å’Œçµæ´»æ€§ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eé¢å‘è¿‡ç¨‹\u003c/strong\u003eï¼šä»¥è¿‡ç¨‹åšä¸ºåŸºæœ¬å•å…ƒæ¥ç»„ç»‡ä»£ç ï¼Œè¿‡ç¨‹å¯¹åº”åˆ°ä»£ç ä¸­å°±æ˜¯å‡½æ•°ï¼Œå°†å‡½æ•°å’Œæ•°æ®åˆ†ç¦»ï¼Œæ¯”è¾ƒå…³æ³¨æ­¥éª¤å’Œæµç¨‹ã€‚å…¶å®å°±æ˜¯ä¸€æ¡è·¯èµ°åˆ°åº•çš„æ€æƒ³ï¼Œå…³æ³¨å¦‚ä½•è®¾è®¡ä¸€ç³»åˆ—é¡ºåºæ‰§è¡Œçš„è¿‡ç¨‹å®ç°ã€‚\u003c/p\u003e\n\u003ch4 id=\"å°è£…ç»§æ‰¿å¤šæ€\"\u003eå°è£…ã€ç»§æ‰¿ã€å¤šæ€?\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eå°è£…\u003c/strong\u003eï¼ˆEncapsulationï¼‰ï¼šé€šè¿‡å°†\u003cstrong\u003eå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ç»“åˆä¸ºç‹¬ç«‹å•å…ƒ\u003c/strong\u003eï¼Œå¹¶åˆ©ç”¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚\u003ccode\u003eprivate\u003c/code\u003eï¼‰éšè—å†…éƒ¨ç»†èŠ‚ï¼Œä»…é€šè¿‡\u003cstrong\u003eå…¬å…±æ¥å£ï¼ˆå¦‚\u003ccode\u003egetter/setter\u003c/code\u003eï¼‰æ§åˆ¶è®¿é—®\u003c/strong\u003eï¼Œä»è€Œæå‡å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eç»§æ‰¿\u003c/strong\u003eï¼ˆInheritanceï¼‰ï¼šå…è®¸\u003cstrong\u003eå­ç±»åŸºäºçˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ‰©å±•\u003c/strong\u003eï¼Œå®ç°ä»£ç å¤ç”¨ï¼ŒJavaé‡‡ç”¨å•ç»§æ‰¿æœºåˆ¶ï¼ˆä»…æ”¯æŒä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼‰ï¼Œä½†å¯é€šè¿‡æ¥å£å®ç°å¤šé‡ç»§æ‰¿çš„æ•ˆæœ\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¤šæ€\u003c/strong\u003eï¼ˆPolymorphismï¼‰ï¼šåŒä¸€æ–¹æ³•è°ƒç”¨å› å¯¹è±¡å®é™…ç±»å‹ä¸åŒè€Œäº§ç”Ÿä¸åŒè¡Œä¸ºï¼Œé€šå¸¸é€šè¿‡\u003cstrong\u003eçˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡åŠæ–¹æ³•é‡å†™å®ç°\u003c/strong\u003eï¼Œä¾èµ–è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šæœºåˆ¶å†³å®šå…·ä½“æ‰§è¡Œé€»è¾‘ã€‚ï¼ˆé‡å†™å’Œé‡è½½ï¼‰\u003c/p\u003e\n\u003ch4 id=\"å¸¸è§æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦\"\u003eå¸¸è§æ’åºç®—æ³•ï¼Ÿæ—¶é—´å¤æ‚åº¦ï¼Ÿ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eç›´æ¥æ’å…¥æ’åºï¼šo(n^2)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå†’æ³¡æ’åºï¼šo(n^2)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¿«é€Ÿæ’åº: o(nlogn)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå †æ’åºï¼šo(nlogn)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå½’å¹¶æ’åºï¼šo(nlogn)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: center\"\u003e\u003cstrong\u003eç®—æ³•\u003c/strong\u003e\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eå¹³å‡æ—¶é—´å¤æ‚åº¦\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eæœ€åæ—¶é—´å¤æ‚åº¦\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eç©ºé—´å¤æ‚åº¦\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eç¨³å®šæ€§\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eé€‚ç”¨åœºæ™¯\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eæ’å…¥æ’åº\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(nÂ²)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(nÂ²)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(1)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eç¨³å®š\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eéƒ¨åˆ†æœ‰åºæ•°æ®\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eå†’æ³¡æ’åº\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(nÂ²)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(nÂ²)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(1)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eç¨³å®š\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eæ•™å­¦ç¤ºä¾‹ã€å°æ•°æ®\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eå¿«é€Ÿæ’åº\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(nÂ²)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eä¸ç¨³å®š\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eå¤§è§„æ¨¡éšæœºæ•°æ®\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eå½’å¹¶æ’åº\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eç¨³å®š\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eå¤§æ•°æ®ã€å¤–éƒ¨æ’åº\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eå †æ’åº\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(n log n)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eO(1)\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eä¸ç¨³å®š\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003eå®æ—¶ç³»ç»Ÿã€å†…å­˜å—é™åœºæ™¯\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch4 id=\"arraylist-å’Œ-linkedlist-çš„åŒºåˆ«\"\u003eArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eArrayList\u003c/strong\u003eï¼šåº•å±‚æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæœ‰æ‰©å®¹æœºåˆ¶ï¼Œå†…å­˜è¿ç»­ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLinkedList\u003c/strong\u003eï¼šåº•å±‚æ˜¯åŒå‘é“¾è¡¨ï¼Œå†…å­˜ä¸è¿ç»­ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å¿«ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e å®é™…è¿‡ç¨‹ä¸­ï¼Œ\u003ccode\u003eArrayList\u003c/code\u003e çš„å¢åˆ æ“ä½œæ¯” \u003ccode\u003eLinkedList\u003c/code\u003e å¿«äº†è¿›ç™¾å€ã€‚\u003c/p\u003e","title":"æ’ç”Ÿèšæºé¢ç»è®°å½•"},{"content":"JVM å…¨å±€æ„æ¶å›¾å¦‚ä¸‹ï¼ŒåŒ…å« JVM çš„å…¨éƒ¨å†…å®¹\n1. JVM çš„å†…å­˜åŒºåŸŸæ˜¯å¦‚ä½•åˆ’åˆ†çš„ï¼Ÿ JVM å†…å­˜å½“ä¸­ï¼Œè¿è¡Œæ—¶æ•°æ®çš„åŒºåŸŸåŒ…å«å †ã€æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€‚å¦å¤–ï¼Œå…¶ä»–çš„å†…å­˜åŒºåŸŸå±äºæœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜å°±åŒ…æ‹¬ç›´æ¥å†…å­˜ï¼Œç›´æ¥å†…å­˜æ˜¯éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ã€‚ å…¶ä¸­ï¼Œå †å’Œæ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨éƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚\nã€æ³¨æ„ã€‘ JVM è§„èŒƒå¯¹äºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„è§„å®šæ˜¯å¾ˆå®½æ¾çš„ã€‚å°±æ‹¿å †æ¥è¯´ï¼Œå †å¯ä»¥æ˜¯è¿ç»­ç©ºé—´ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸è¿ç»­ç©ºé—´ã€‚å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥å†è¿è¡Œæ—¶æŒ‰ç…§éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚è™šæ‹Ÿæœºå®ç°è€…å¯ä»¥ä½¿ç”¨ä»»ä½•åƒåœ¾å›æ”¶ç®—æ³•ç®¡ç†å †ï¼Œç”šè‡³å®Œå…¨ä¸è¿›è¡Œåƒåœ¾å›æ”¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\nä¸‹é¢é€ä¸€ä»‹ç»ä¸åŒéƒ¨åˆ†çš„åŠŸèƒ½å’Œä½œç”¨\né¦–å…ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„éƒ¨åˆ†ï¼Œç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€‚\nã€ç¨‹åºè®¡æ•°å™¨ã€‘\nå®šä¹‰ï¼šç¨‹åºè®¡æ•°å™¨å°±æ˜¯è®°å½•å½“å‰æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·ã€‚å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼Œæ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ ä½œç”¨ï¼šåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤è¿™äº›åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨å®Œæˆã€‚æ¯”å¦‚çº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡ä¸­ï¼Œä» Açº¿ç¨‹ å…ˆåˆ‡æ¢åˆ° Bçº¿ç¨‹ï¼Œç„¶åä» Bçº¿ç¨‹ æ¢å¤åˆ° Açº¿ç¨‹ çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸ºäº† Açº¿ç¨‹ èƒ½å¤Ÿæ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œå°±éœ€è¦è¯»å– Açº¿ç¨‹ ç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼Œæ¥ç¡®è®¤åˆ‡æ¢çº¿ç¨‹å‰æ‰§è¡Œçš„ä½ç½®åœ¨å“ªé‡Œã€‚ ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ç§æœ‰ï¼šå› ä¸ºçº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹å½“ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨æ¥è®°å½•è‡ªå·±çš„ç¨‹åºæ‰§è¡Œä½ç½®ã€‚ ã€æ³¨æ„ã€‘ ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OOM å†…å­˜ä¸è¶³çš„å†…å­˜åŒºåŸŸï¼Œå› ä¸ºä»–å°±åªæ˜¯å­˜å‚¨ä¸€ä¸ªå€¼ã€‚\nã€è™šæ‹Ÿæœºæ ˆã€‘\nå®šä¹‰ï¼šè™šæ‹Ÿæœºæ ˆæŒ‰ç…§å…ˆè¿›åå‡ºçš„æ–¹æ¡ˆå­˜å‚¨çš„æ˜¯éæœ¬åœ°æ–¹æ³•çš„è°ƒç”¨å¯¹åº”çš„æ ˆå¸§ã€‚æ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ä¼šè¢«å‹å…¥æ ˆä¸­ï¼Œæ–¹æ³•ç»“æŸçš„æ—¶å€™ä¼šè¢«å¼¹å‡ºæ ˆä¸­ã€‚æ ˆå¸§ä¸­åŒ…å«å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ¬¡æ•°æ ˆï¼ˆå­˜å‚¨æ“ä½œæ•°å’Œä¸´æ—¶è®¡ç®—ç»“æœï¼‰ã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•çš„è¿”å›åœ°å€ã€‚è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ ä½œç”¨ï¼šå­˜å‚¨éæœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ï¼Œæ”¯æŒæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚å½“æ ˆæ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œä¼šæŠ›å‡º StackOverflowError æ ˆæº¢å‡ºå¼‚å¸¸ã€‚å¦‚æœè™šæ‹Ÿæœºæ ˆæ— æ³•åŠ¨æ€æ‰©å±•æˆ–ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å†…å­˜ä¸è¶³å¼‚å¸¸ã€‚ æ ˆå¸§ä¸­åŒ…å«å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ¬¡æ•°æ ˆï¼ˆå­˜å‚¨æ“ä½œæ•°å’Œä¸´æ—¶å˜é‡ï¼‰ã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•çš„è¿”å›åœ°å€ã€‚å…¶ä¸­ï¼Œå±€éƒ¨å˜é‡è¡¨å­˜æ”¾çš„æ˜¯æ‰€æœ‰çš„å±€éƒ¨å˜é‡ï¼Œæˆ–è€…å…¶å‡ºå¯¹åº”çš„åœ°å€ï¼ˆæ•°ç»„ï¼‰ã€‚åŠ¨æ€é“¾æ¥å°±æ˜¯å½“å‰ç±»å¸¸é‡æ± çš„å¼•ç”¨ã€‚\nå±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾æ–¹æ³•å‚æ•°ä¼ å…¥çš„å½¢å‚å€¼ï¼Œæ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„ this å¼•ç”¨ã€‚å†…éƒ¨ç»“æ„ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼‰ æ“ä½œæ•°æ ˆï¼šä¸»è¦ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´è®¡ç®—ç»“æœã€‚å¦å¤–ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚ åŠ¨æ€é“¾æ¥ï¼šä¸»è¦ä½œç”¨æ˜¯å®ç°åœ¨å½“å‰æ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–æ–¹æ³•ã€‚ Class æ–‡ä»¶çš„å¸¸é‡æ± é‡Œé¢ä¿å­˜æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œæ¯”å¦‚æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚ å½“ä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œéœ€è¦å°†å¸¸é‡æ± ä¸­åªæƒ³æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨å†…å­˜åœ°å€å½“ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯æŠŠå¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºå†…å­˜å½“ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚ ã€æœ¬åœ°æ–¹æ³•æ ˆã€‘\nå®šä¹‰ï¼šæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæ ˆçš„ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚ä¸åŒçš„æ˜¯ï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ JVM è°ƒç”¨ Native æ–¹æ³•çš„æ—¶å€™æ‰ä¼šç”¨åˆ°çš„ï¼Œè™šæ‹Ÿæœºæ ˆæ˜¯æ‰§è¡Œ Java è‡ªèº«çš„æ–¹æ³• (ä¹Ÿå°±æ˜¯å­—èŠ‚ç ) ä¼šç”¨åˆ°çš„ã€‚ ä½œç”¨ï¼šå­˜å‚¨æœ¬åœ°æ–¹æ³• (Native) æ ˆå¸§ï¼Œæ”¯æŒæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚ ã€æ³¨æ„ã€‘ åœ¨ HotSpot è™šæ‹Ÿæœºå½“ä¸­ï¼Œå°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€äº†ã€‚\nå…¶æ¬¡ï¼Œæˆ‘ä»¬å°†ä»‹ç»çº¿ç¨‹å…±äº«çš„éƒ¨åˆ†ï¼Œå † å’Œ æ–¹æ³•åŒº ï¼ˆJDK 1.8å«å…ƒç©ºé—´ï¼‰\nã€å †ã€‘\nå®šä¹‰ï¼šå †å½“ä¸­å­˜å‚¨äº†æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ã€æ•°ç»„ã€‚å †æ˜¯ JVM å†…å­˜åŒºåŸŸå½“ä¸­æœ€å¤§çš„ä¸€å—ï¼Œæ‰€æœ‰çº¿ç¨‹å‡å¯å…±äº«ã€‚å¦å¤–ï¼ŒJVM çš„å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ GC å †ï¼ˆGarbage Collected Heapï¼‰ å †ç»“æ„ï¼šä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œå †å¯ä»¥åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ã€‚å…¶ä¸­ï¼Œæ–°ç”Ÿä»£å½“ä¸­è¿˜åŒ…æ‹¬äº†ä¸€ä¸ª Eden ä¼Šç”¸å›­åŒº å’Œ ä¸¤ä¸ª Survivor å­˜æ´»åŒº (S0 å’Œ S1) ã€‚åœ¨ JDK 1.8 å½“ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«å…ƒç©ºé—´å–ä»£äº†ï¼Œè€Œä¸”å…ƒç©ºé—´ç”¨å¾—æ˜¯æœ¬åœ°å†…å­˜ã€‚ ä¸åŒä»£çš„åŒºåˆ«ï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹è±¡ä¼šåˆ†å…ˆåˆ†åˆ°æ–°ç”Ÿä»£çš„ Eden åŒºåŸŸï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ä¹‹åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜è´§ï¼Œåˆ™è¿›å…¥ Survivor åŒºä¸­çš„ s0 æˆ–è€… s1ã€‚åŒæ—¶ï¼Œå¯¹è±¡çš„å¹´é¾„è¿˜ä¼šå¢åŠ  1 (ä» Eden åŒºåˆ° Survior åŒºåï¼Œå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ã€‚å½“å®ƒçš„å¹´é¾„è¾¾åˆ°ä¸€å®šé˜ˆå€¼ (é»˜è®¤ä¸º 15 å²)ï¼Œå°±ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ã€‚å¹´é¾„çš„é˜ˆå€¼å¯ä»¥é€šè¿‡ XX:MaxTenuringThreshold æ¥è®¾ç½®ï¼Œä½†æ˜¯è®¾ç½®çš„å€¼å¿…é¡»åœ¨ 0 ~ 15 ä¹‹é—´ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ ä¸ºä»€ä¹ˆå¹´é¾„åªèƒ½æ˜¯ 0-15?: å› ä¸ºè®°å½•å¯¹è±¡å¹´é¾„çš„åŒºåŸŸåœ¨å¯¹è±¡å¤´ä¸­ï¼Œè¿™ä¸ªåŒºåŸŸçš„å¤§å°é€šå¸¸æ˜¯ 4 ä½ã€‚è¿™ 4 ä½å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§äºŒè¿›åˆ¶æ•°å­—æ˜¯ 1111 ï¼Œå³åè¿›åˆ¶çš„ 15 ã€‚å› æ­¤ï¼Œå¯¹è±¡çš„å¹´é¾„è¢«é™åˆ¶ä¸º 0 ~ 15ã€‚ åœ¨Hotspot è™šæ‹Ÿæœºä¸­ï¼Œéå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† Survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼ ã€æ³¨æ„ã€‘ JVM çš„å † æœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ OutOfMemoryError å†…å­˜ä¸è¶³é”™è¯¯ï¼Œå¹¶ä¸”å‡ºç°è¿™ç§é”™è¯¯ä¹‹åçš„è¡¨ç°å½¢å¼è¿˜ä¼šæœ‰å¥½å‡ ç§ã€‚æ¯”å¦‚ java.lang.OutOfMemoryError: GC Overhead Limit Exceeded è¯´æ˜ JVM èŠ±å¤ªå¤šæ—¶é—´ ( 98% çš„æ—¶é—´) è¿›è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªå›æ”¶äº†å¾ˆå°‘çš„åƒåœ¾ (2% çš„åƒåœ¾); java.lang.OutOfMemoryError: Java heap space æ˜¯åœ¨åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™ï¼Œå †å†…å­˜ä¸­ç©ºé—´ä¸è¶³ï¼Œä¸èƒ½å†å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡äº†ã€‚\nã€æ–¹æ³•åŒºã€‘\nå®šä¹‰ï¼šå½“è™šæ‹Ÿæœºè¦ä½¿ç”¨ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå®ƒéœ€è¦è¯»å–å¹¶è§£æ Class æ–‡ä»¶å¹¶è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯å­˜å…¥æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºå­˜å‚¨è¢« JVM åŠ è½½çš„ ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€JIT å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®\næ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿï¼šæ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´çš„å…³ç³»ï¼Œç‰¹åˆ«åƒ Java å½“ä¸­çš„æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ã€‚ç±»å°±ç›¸å½“äºæ°¸ä¹…ä»£æˆ–è€…å…ƒç©ºé—´ï¼Œæ¥å£å°±æ˜¯æ–¹æ³•åŒºã€‚ä¹Ÿå°±æ˜¯è¯´æ°¸ä¹…ä»£æˆ–è€…å…ƒç©ºé—´æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚ JDK 1.7 æ˜¯ æ°¸ä¹…ä»£ï¼Œ JDK 1.8 ä¹‹åæ˜¯æ–¹æ³•åŒºã€‚\nä¸ºä»€ä¹ˆJDK 1.8 é‡‡ç”¨å…ƒç©ºé—´æ›¿æ¢æ°¸ä¹…ä»£ï¼Ÿ\næ— æ³•åŠ¨æ€è°ƒæ•´å¤§å°ï¼Œå®¹æ˜“å†…å­˜æº¢å‡ºï¼šæ•´ä¸ªæ°¸ä¹…ä»£çš„å¤§å°å— JVM å†…å­˜å¤§å°çš„é™åˆ¶ï¼Œè€Œå…ƒç©ºé—´ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå…ƒç©ºé—´çš„å¤§å°å’Œæœ¬æœºå¯ç”¨å†…å­˜å¤§å°ç›¸å…³ã€‚è™½ç„¶å…ƒç©ºé—´è¿˜æ˜¯å¯èƒ½å‡ºç°å†…å­˜æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥çš„å‡ ç‡æ›´å°ã€‚\nå¯ä»¥ä½¿ç”¨ -XXï¼šMaxMetaspaceSize æ ‡å¿—è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤å€¼ä¸º unlimitedï¼Œè¿™æ„å‘³ç€å®ƒåªå—ç³»ç»Ÿå†…å­˜çš„é™åˆ¶ã€‚-XXï¼šMetaspaceSize è°ƒæ•´æ ‡å¿—å®šä¹‰å…ƒç©ºé—´çš„åˆå§‹å¤§å°å¦‚æœæœªæŒ‡å®šæ­¤æ ‡å¿—ï¼Œåˆ™å…ƒç©ºé—´å°†æ ¹æ®è¿è¡Œæ—¶çš„åº”ç”¨ç¨‹åºéœ€æ±‚åŠ¨æ€åœ°é‡æ–°è°ƒæ•´å¤§å°ã€‚\nå…ƒç©ºé—´åŠ è½½çš„ç±»æ›´å¤šï¼šå…ƒç©ºé—´å­˜æ”¾çš„æ˜¯ç±»çš„å…ƒæ•°æ®ï¼Œæ‰€ä»¥åŠ è½½ç±»çš„å…ƒæ•°æ®ä¸å†å— MaxPermSize æ§åˆ¶ (æ°¸ä¹…ä»£çš„æœ€å¤§é˜ˆå€¼) ï¼Œè€Œæ˜¯ç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥è¿›è¡Œæ§åˆ¶çš„ï¼Œè¿™æ ·åŠ è½½çš„ç±»å°±æ›´å¤šäº†ã€‚\næ°¸ä¹…ä»£ GC å¤æ‚åº¦æ›´é«˜ï¼šæ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚\næ–¹æ³•åŒºå¸¸ç”¨å‚æ•°æœ‰å“ªäº›ï¼Ÿï¼š å¯ä»¥åˆ†ä¸º JDK 1.7 å’Œ JDK 1.8 æ¥çœ‹\nJDK 1.7: é‡‡ç”¨æ°¸ä¹…ä»£ï¼Œå¸¸ç”¨ä¸‹é¢çš„å‚æ•°\n-XX:PermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å° -XX:MaxPermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGen JDK 1.8ï¼šé‡‡ç”¨å…ƒç©ºé—´ï¼Œå¸¸ç”¨ä¸‹é¢çš„å‚æ•°\n-XX:MetaspaceSize=N //è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰ -XX:MaxMetaspaceSize=N //è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°, é»˜è®¤å€¼ä¸º unlimited ä¸‹é¢å°†å¯¹è¿è¡Œæ—¶å¸¸é‡æ±  ï¼ˆæ–¹æ³•åŒºï¼‰ã€å­—ç¬¦ä¸²å¸¸é‡æ±  ï¼ˆå †ï¼‰ã€ç›´æ¥å†…å­˜è¿›è¡Œä»‹ç»\nã€è¿è¡Œæ—¶å¸¸é‡æ± ã€‘\nè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯ç”¨æ¥å­˜æ”¾ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨çš„å¸¸é‡æ± è¡¨ã€‚è¿™ä¸ªå¸¸é‡æ± è¡¨ä¼šåœ¨ç±»åŠ è½½ä¹‹åï¼Œå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± å½“ä¸­ã€‚\nå­—é¢é‡ï¼šé¡¾åæ€ä¹‰ï¼ŒåŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰å­—é¢é‡ ç¬¦å·å¼•ç”¨ï¼šç±»ç¬¦å·å¼•ç”¨ã€å­—æ®µç¬¦å·å¼•ç”¨ã€æ–¹æ³•ç¬¦å·å¼•ç”¨ã€æ¥å£æ–¹æ³•ç¬¦å· ã€å­—ç¬¦ä¸²å¸¸é‡æ± ã€‘\nå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—ä¸“é—¨é’ˆå¯¹å­—ç¬¦ä¸² String ç±»å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦æ˜¯ç”¨æ¥é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚\n// åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ \u0026#34;ab\u0026#34; // å°†å­—ç¬¦ä¸²å¯¹è±¡ \u0026#34;ab\u0026#34; çš„å¼•ç”¨èµ‹å€¼ç»™ç»™ aa String aa = \u0026#34;ab\u0026#34;; // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡\u0026#34;ab\u0026#34;ï¼Œèµ‹å€¼ç»™å¼•ç”¨ bb String bb = \u0026#34;ab\u0026#34;; System.out.println(aa==bb); // true, aaå’Œbbéƒ½æ˜¯ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„\u0026#34;ab\u0026#34; JDK 1.6 å’Œ JDK 1.7 ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± çš„å­˜æ”¾ä½ç½®ä¸ä¸€è‡´ã€‚åœ¨ JDK 1.6 ä¸­å’Œ è¿è¡Œæ—¶å¸¸é‡æ± ä¸€æ ·ï¼Œå­˜æ”¾åœ¨æ–¹æ³•åŒºé‡Œé¢ã€‚åœ¨ JDK 1.7 ä¸­ï¼Œå­˜æ”¾åœ¨å †é‡Œé¢ã€‚é‚£ä¹ˆ JDK 1.7 ä¸ºä»€ä¹ˆè¦å°†å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åŠ¨åˆ°å †ä¸­å‘¢ï¼Ÿ ä¸»è¦æ˜¯å› ä¸ºæ°¸ä¹…ä»£ (æ–¹æ³•åŒº) çš„ GC å›æ”¶æ•ˆç‡å¤ªä½ï¼Œ åªæœ‰åœ¨æ•´å †æ”¶é›† Full GC çš„æ—¶å€™ï¼Œæ‰ä¼šè¢«æ‰§è¡Œ GCã€‚ Java ç¨‹åºä¸­é€šå¸¸ä¼šæœ‰å¤§é‡çš„è¢«åˆ›å»ºçš„å­—ç¬¦ä¸²ç­‰å¾…å›æ”¶ï¼Œå°†è¿™äº›å­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨å †ä¸­ï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåŠæ—¶åœ°å›æ”¶å­—ç¬¦ä¸²å†…å­˜ã€‚\nã€ç›´æ¥å†…å­˜ã€‘\nç›´æ¥å†…å­˜æ˜¯ä¸€ç§ç‰¹æ®Šçš„å†…å­˜ç¼“å†²åŒºï¼Œå¹¶ä¸å±äº JVM å½“ä¸­çš„å †æˆ–è€…æ–¹æ³•åŒºï¼Œè€Œæ˜¯é€šè¿‡ JNI ï¼ˆJava Native Interfaceï¼‰Java æœ¬åœ°æ–¹æ³•æ¥å£çš„æ–¹å¼åœ¨æœ¬åœ°å†…å­˜ä¸Šç›´æ¥åˆ†é…çš„ä¸€å—åŒºåŸŸã€‚ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ OutOfMemoryError é”™è¯¯å‡ºç°ã€‚\nJDK1.4 ä¸­æ–°åŠ å…¥çš„ NIOï¼ˆNon-Blocking I/Oï¼Œä¹Ÿè¢«ç§°ä¸º New I/Oï¼‰ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å­˜åŒºï¼ˆBufferï¼‰çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®ã€‚\n2. HotSpot å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ åœ¨ HotSpot è™šæ‹Ÿæœºå½“ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š\nç±»åŠ è½½æ£€æŸ¥ï¼šè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚\nåˆ†é…å†…å­˜ï¼šåœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥ JVM å°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚åˆ†é…æ–¹å¼æœ‰ â€œæŒ‡é’ˆç¢°æ’â€ å’Œ â€œç©ºé—²åˆ—è¡¨â€ ä¸¤ç§ï¼Œé€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€Œ Java å †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚\næŒ‡é’ˆç¢°æ’ï¼š\né€‚ç”¨åœºåˆï¼š**å †å†…å­˜è§„æ•´ï¼ˆå³æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼‰**çš„æƒ…å†µä¸‹ã€‚ åŸç†ï¼šç”¨è¿‡çš„å†…å­˜å…¨éƒ¨æ•´åˆåˆ°ä¸€è¾¹ï¼Œæ²¡æœ‰ç”¨è¿‡çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªåˆ†ç•ŒæŒ‡é’ˆï¼Œåªéœ€è¦å‘ç€æ²¡ç”¨è¿‡çš„å†…å­˜æ–¹å‘å°†è¯¥æŒ‡é’ˆç§»åŠ¨å¯¹è±¡å†…å­˜å¤§å°ä½ç½®å³å¯ã€‚ ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šSerial, ParNew ç©ºé—²åˆ—è¡¨ï¼š\né€‚ç”¨åœºåˆï¼šå †å†…å­˜ä¸è§„æ•´çš„æƒ…å†µä¸‹ã€‚ åŸç†ï¼šè™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œæ‰¾ä¸€å—å„¿è¶³å¤Ÿå¤§çš„å†…å­˜å—å„¿æ¥åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œæœ€åæ›´æ–°åˆ—è¡¨è®°å½•ã€‚ ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šCMS åˆå§‹åŒ–é›¶å€¼ï¼šå†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚\nè®¾ç½®å¯¹è±¡å¤´ï¼šåˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œå€¼ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚\næ‰§è¡Œ init æ–¹æ³•ï¼šåœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ\u0026lt;init\u0026gt; æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ \u0026lt;init\u0026gt; æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚\nã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‘\nåœ¨ Hotspot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€**å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰**å’Œ å¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚\nå¯¹è±¡å¤´ï¼š å¯¹è±¡å¤´ä¸»è¦åŒ…å«æ ‡è®°å­—æ®µå’Œç±»å‹æŒ‡é’ˆä¸¤ä¸ªéƒ¨åˆ†\næ ‡è®°å­—æ®µï¼ˆMark Wordï¼‰ï¼šç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ å¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ã€‚ ç±»å‹æŒ‡é’ˆï¼ˆKlass pointerï¼‰ï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ å®ä¾‹æ•°æ®ï¼šå®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚\nå¯¹é½å¡«å……ï¼šå¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·å ä½ä½œç”¨ã€‚å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯ 8 å­—èŠ‚çš„å€æ•°ï¼ˆ1 å€æˆ– 2 å€ï¼‰ï¼Œå› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨.\nã€å¯¹è±¡çš„è®¿é—®æ–¹å¼ã€‘\nå¯¹è±¡çš„è®¿é—®æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šä½¿ç”¨å¥æŸ„ æˆ–è€… ç›´æ¥æŒ‡é’ˆ\nå¥æŸ„ï¼šå¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸å¯¹è±¡ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚ ç›´æ¥æŒ‡é’ˆï¼šå¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚ 3. è¯´è¯´ Java çš„æ‰§è¡Œæµç¨‹? Java ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œå¯ä»¥åˆ†æˆä¸‰æ­¥ã€‚é¦–å…ˆï¼Œä»ç¼–è¯‘åˆ°å­—èŠ‚ç çš„ç”Ÿæˆã€‚å…¶æ¬¡ï¼Œå†åˆ°ç±»åŠ è½½å’Œ JIT å³æ—¶ç¼–è¯‘å™¨çš„ç¼–è¯‘è¿‡ç¨‹ã€‚æœ€ç»ˆï¼Œåœ¨ JVM å½“ä¸­æ‰§è¡Œã€‚ ç¨‹åºåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒJVM è´Ÿè´£å†…å­˜ç®¡ç†ã€åƒåœ¾å›æ”¶å’Œçº¿ç¨‹è°ƒåº¦ç­‰å·¥ä½œã€‚\nå…·ä½“çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š\nç¼–å†™æºä»£ç ï¼šç¨‹åºå‘˜ç¼–å†™ .java æºä»£ç æ–‡ä»¶ ç¼–è¯‘å™¨ç¼–è¯‘æºä»£ç ï¼šjavac ç¼–è¯‘å™¨ç¼–è¯‘ .java æºä»£ç ï¼Œç”Ÿæˆ .class å­—èŠ‚ç æ–‡ä»¶ ç±»åŠ è½½ï¼šJVM çš„ç±»åŠ è½½å™¨åŠ è½½ .class æ–‡ä»¶åˆ°å†…å­˜é‡Œé¢ è§£é‡Šæ‰§è¡Œï¼šJVM å°†åŠ è½½åçš„ .class æ–‡ä»¶çš„å­—èŠ‚ç è½¬æ¢ä¸ºåŠå…¶ç æ‰§è¡Œ JIT å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼šåœ¨è§£é‡Šæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒJVM ä¼šé€šè¿‡ çƒ­ç‚¹æ¢æµ‹æŠ€æœ¯ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ã€å›è¾¹è®¡æ•°å™¨ï¼‰è¯†åˆ«é¢‘ç¹æ‰§è¡Œçš„ä»£ç ï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ã€‚å½“æŸæ®µä»£ç çš„è°ƒç”¨æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼ˆä¾‹å¦‚ Server æ¨¡å¼ä¸‹çš„ 10000 æ¬¡ï¼‰ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°†å…¶ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œå¹¶ç¼“å­˜åˆ°æ–¹æ³•åŒºçš„ Code Cache ä¸­ã€‚å…¶ä»–ä»£ç ä»ç”±è§£é‡Šå™¨æ‰§è¡Œã€‚ è¿è¡Œç¨‹åºï¼šæ‰§è¡Œ main æ–¹æ³•ä¸­çš„é€»è¾‘ åƒåœ¾å›æ”¶ï¼šJVM ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ ç¨‹åºæ‰§è¡Œç»“æŸï¼š main æ–¹æ³•ç»“æŸï¼ŒJVM æ¸…ç†èµ„æºï¼Œé€€å‡ºç¨‹åº 4. Javaä¸­å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ Java å½“ä¸­å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨å’Œè€å¹´ä»£åƒåœ¾æ”¶é›†å™¨\næ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨éƒ½é‡‡ç”¨ â€œæ ‡è®°-å¤åˆ¶â€ çš„åƒåœ¾å›æ”¶ç®—æ³•\nSerial æ”¶é›†å™¨ï¼šSerial æ”¶é›†å™¨æ˜¯ä¸€ç§ä¸²è¡Œçš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé€‚åˆå°å‹åº”ç”¨å’Œå•å¤„ç†å™¨çš„ç¯å¢ƒã€‚æ”¶é›†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè§¦å‘ Stop-The-World (STW) æ“ä½œï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹åœ¨ GC åƒåœ¾æ”¶é›†çš„æ—¶å€™ä¼šè¢«æš‚åœã€‚\nParNew Parallel New æ”¶é›†å™¨ï¼šParNew æ”¶é›†å™¨å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¹¶è¡Œå¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿå¹¶è¡Œåœ°è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚å’Œ CMS æ”¶é›†å™¨è¿›è¡Œé…åˆä½¿ç”¨ (CMS æ”¶é›†å™¨ç”¨æ¥æ”¶é›†è€å¹´ä»£çš„åƒåœ¾ï¼ŒParNew æ”¶é›†æ–°ç”Ÿä»£çš„åƒåœ¾)ã€‚ä¸€èˆ¬é€‚ç”¨äºå¤šå¤„ç†å™¨çš„ç¯å¢ƒã€‚\nParallel Scavenge å¹¶è¡Œæ¸…é™¤åƒåœ¾æ”¶é›†å™¨ï¼šParallel Scavenge ä¹Ÿè¢«ç§°ä¸º ååé‡æ”¶é›†å™¨, åŸºäºæ ‡è®°-å¤åˆ¶åƒåœ¾å›æ”¶ç®—æ³•å®ç°çš„ï¼Œä¸»è¦ä¾§é‡äºæœ€å¤§åŒ– CPU æ—¶é—´çš„åˆ©ç”¨ç‡ã€‚å¹¶è¡Œå¤„ç†æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼Œé€‚åˆå¤§è§„æ¨¡è¿ç®—å¯†é›†å‹çš„åå°ä»»åŠ¡ï¼Œä»¥åŠå¯¹ååé‡è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚\n-XX:+UseParallelGC //ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£ä¸²è¡Œ -XX:+UseParallelOldGC //ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£å¹¶è¡Œ ã€æ³¨æ„ã€‘ ParNew å’Œ Parallel Scavenge åƒåœ¾æ”¶é›†å™¨çš„åŒºåˆ«åœ¨äº ParNew åƒåœ¾æ”¶é›†å™¨é€šå¸¸é…åˆ CMS æ”¶é›†å™¨è¿›è¡Œä½¿ç”¨ï¼Œä¸»è¦ä¾§é‡äºæ§åˆ¶ GC æ‰€å¯¼è‡´çš„ STOP-THE-WORLD (STW) æ“ä½œçš„æš‚åœæ—¶é—´ï¼Œä½†æ˜¯å¯èƒ½ GC çš„æ¬¡æ•°æ›´åŠ é¢‘ç¹ã€‚Parallel Scavenge æ”¶é›†å™¨ä¸»è¦ä¾§é‡ååé‡çš„å¤§å°ï¼Œæ”¯æŒè‡ªé€‚åº”è°ƒèŠ‚(æ¯”å¦‚æœ€å¤§çš„ GC æš‚åœæ—¶é—´ MaxGCPauseMillis å’Œ GC æ—¶é—´æ¯”ä¾‹ GCTimeRatio)ï¼Œä½†æ˜¯å¯èƒ½ç‰ºç‰²éƒ¨åˆ†å“åº”æ—¶é—´ (STWè¿‡ç¨‹) ã€‚\nè€å¹´ä»£åƒåœ¾æ”¶é›†å™¨ï¼šå¤§éƒ¨åˆ†è€å¹´ä»£åƒåœ¾æ”¶é›†å™¨é‡‡ç”¨çš„**\u0026ldquo;æ ‡è®°-æ•´ç†\u0026rdquo;** åƒåœ¾å›æ”¶ç®—æ³•ï¼Œéƒ¨åˆ†æ”¶é›†å™¨ (æ¯”å¦‚ CMS æ”¶é›†å™¨) é‡‡ç”¨çš„**\u0026ldquo;æ ‡è®°-æ¸…é™¤\u0026rdquo;**\nSerial Old æ”¶é›†å™¨ï¼šSerial Old å…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç† ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é€‚åˆå•çº¿ç¨‹ç¯å¢ƒå’Œä½å†…å­˜ä½¿ç”¨åœºæ™¯ Parallel Old æ”¶é›†å™¨ï¼šParallel Old æ”¶é›†å™¨æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ã€‚é€‚åˆå¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—çš„åœºæ™¯ï¼Œé€‚ç”¨äºé«˜ååé‡è¦æ±‚çš„ä»»åŠ¡ã€‚ CMS Concurrent Mark-Sweep æ”¶é›†å™¨ï¼šCMS æ”¶é›†å™¨é‡‡ç”¨çš„å¹¶å‘æ ‡è®°-æ¸…é™¤åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œè¿½æ±‚ä½å»¶è¿Ÿï¼Œå‡å°‘ GC åœé¡¿æ—¶é—´ (STW è¿‡ç¨‹)ã€‚ä½†æ˜¯è¿™ä¸ªåƒåœ¾æ”¶é›†çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†…å­˜è„†ç‰‡ï¼Œå¹¶ä¸”åœ¨å¹¶å‘é˜¶æ®µå¯èƒ½ä¼šå‡ºç° Concurrent Mode Failureï¼Œ å¯¼è‡´ Full GCã€‚é€‚ç”¨äºå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„åº”ç”¨ï¼Œæ¯”å¦‚ Web æœåŠ¡å’Œç”µå•†å¹³å° G1 Garbage First æ”¶é›†å™¨ï¼šä¸»è¦ç”¨æ¥å–ä»£ CMS çš„åœ°å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼Œèƒ½å¤Ÿæä¾›å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ï¼Œ é‡‡ç”¨å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•ã€‚é€šè¿‡åˆ†åŒºæ¥ç®¡ç†å†…å­˜ï¼Œå¹¶åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™ï¼Œä¼˜å…ˆå¤„ç†æœ€æœ‰ä»·å€¼çš„åŒºåŸŸï¼Œé¿å…äº† CMS å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚é€‚ç”¨äºå¤§å†…å­˜ã€å¤š CPU æœåŠ¡å™¨ï¼ŒåæœŸæ˜¯åœ¨å»¶è¿Ÿå’Œå“åº”æ—¶é—´é“­æ„Ÿçš„åœºæ™¯ã€‚ ZGC Z Garbage Collector æ”¶é›†å™¨ï¼šZGC æ˜¯ä¸€ç§ä½åœé¡¿ (STWæ“ä½œ)ã€é«˜ååé‡çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœé¡¿æ—¶é—´ä¸€èˆ¬ä¸ä¼šè¶…è¿‡ 10 msã€‚é€‚ç”¨äºéœ€è¦ç®¡ç†å¤§å †å†…å­˜ä¸”å¯¹ä½å»¶è¿Ÿè¦æ±‚æé«˜çš„åº”ç”¨ã€‚ ã€è¯¦è§£ CMSã€G1 åƒåœ¾æ”¶é›†å™¨ã€‘\nCMS Concurrent Mark Sweepåƒåœ¾æ”¶é›†å™¨ï¼šCMS æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ (SWTæ“ä½œ) ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼ŒåŸºäº æ ‡è®°-æ¸…é™¤ ç®—æ³•å®ç°ï¼Œæ•´ä¸ªæ”¶é›†è¿‡ç¨‹åˆ†ä¸ºä¸‹é¢å››ä¸ªé˜¶æ®µï¼š\nåˆå§‹æ ‡è®°ï¼šæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ ï¼ˆå¯è¾¾æ€§åˆ†æï¼‰ï¼Œè€—æ—¶çŸ­ä½†éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚ å¹¶å‘æ ‡è®°ï¼šä» GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾ ï¼ˆå°±æ˜¯ä»æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡å¼€å§‹ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡ï¼‰ï¼Œè€—æ—¶é•¿ä½†æ˜¯ä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚ é‡æ–°æ ‡è®°ï¼šé‡‡ç”¨å¢é‡æ›´æ–°ç®—æ³• ï¼ˆå°±æ˜¯ä¸ä»å¤´å¼€å§‹æ ‡è®°ï¼‰ï¼Œå¯¹å¹¶å‘æ ‡è®°é˜¶æ®µå› ä¸ºç”¨æˆ·çº¿ç¨‹è¿è¡Œè€Œäº§ç”Ÿå˜åŠ¨çš„é‚£éƒ¨åˆ†å¯¹è±¡è¿›è¡Œé‡æ–°æ ‡è®°ï¼Œè€—æ—¶æ¯”åˆå§‹æ ‡è®°ä¼šç¨å¾®é•¿ä¸€ç‚¹ï¼Œéœ€è¦æš‚åœçº¿ç¨‹ã€‚ï¼ˆç›¸å½“äºå¯¹å¹¶å‘æ ‡è®°åšä¸€æ¬¡å…œåº•æ“ä½œï¼‰ å¹¶å‘æ¸…é™¤ï¼šå¹¶å‘æ¸…é™¤æ‰å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œè€—æ—¶é•¿ä½†ä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚ CMS çš„ä¼˜ç‚¹åœ¨äºè€—æ—¶é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤ é˜¶æ®µéƒ½ä¸éœ€è¦æš‚åœç”¨æˆ·å¿åŸï¼Œå› æ­¤SWTæ“ä½œçš„æ—¶é—´å°±æ¯”è¾ƒçŸ­ã€‚ä½†æ˜¯å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š\nå†…å­˜ç¢ç‰‡ï¼šç”±äº CMS æ”¶é›†å™¨é‡‡ç”¨ æ ‡è®°-æ¸…é™¤ ç®—æ³•å®ç°ï¼Œå› æ­¤ä¼šäº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ã€‚\nååé‡ä¸‹é™ï¼šç”±äº CMS æ”¶é›†å™¨åœ¨å¹¶å‘çš„é˜¶æ®µä¼šå ç”¨éƒ¨åˆ† CPU èµ„æºï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„å¯ç”¨ CPU èµ„æºå˜å°‘ï¼ˆè®¡ç®—èƒ½åŠ›å‡å°‘ï¼‰ï¼Œæ•´ä½“å¼•ç”¨ç¨‹åºçš„ååé‡å°±é™ä½äº†ã€‚\nååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ \\ (è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + è¿è¡Œåƒåœ¾æ”¶é›†æ—¶é—´) æ— æ³•ä¸€æ¬¡æ€§å¤„ç†æµ®åŠ¨åƒåœ¾ï¼šç”±äºå¹¶å‘æ¸…é™¤çš„æ—¶å€™ï¼Œç”¨æˆ·çº¿ç¨‹è¿˜æ˜¯åœ¨ç»§ç»­ï¼Œæ‰€ä»¥æ­¤æ—¶ä»ç„¶ä¼šäº§ç”Ÿåƒåœ¾ ï¼ˆæµ®åŠ¨åƒåœ¾ï¼‰ã€‚åªèƒ½ç­‰åˆ°ä¸‹ä¸€æ¬¡å‡ºå‘åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå†åšæ¸…ç†ã€‚\nG1 æ”¶é›†å™¨ï¼šG1 æ”¶é›†å™¨æ˜¯ä¸€ç§é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦åº”ç”¨å°±æ˜¯åœ¨å¤šæ ¸ CPU å’Œå¤§å†…å­˜çš„æœåŠ¡å™¨ç¯å¢ƒå½“ä¸­ã€‚ G1 åŒæ ·éµå¾ªåˆ†ä»£æ”¶é›†ç†è®ºï¼Œä½†æ˜¯ä¸å†ä»¥å›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡æ¥åˆ’åˆ†åˆ†ä»£åŒºåŸŸï¼Œè€Œæ˜¯æŠŠè¿ç»­çš„ Java å † åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸ (Region)ã€‚æ¯ä¸€ä¸ªç‹¬ç«‹åŒºåŸŸéƒ½å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚æ¥æ‰®æ¼”æ–°ç”Ÿä»£çš„ Eden ç©ºé—´ (E) ã€Survivor ç©ºé—´ (S) æˆ–è€…è€å¹´ä»£ç©ºé—´ (O)ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®ç‹¬ç«‹åŒºåŸŸæ‰®æ¼”çš„ä¸åŒè§’è‰²ï¼Œé‡‡ç”¨ä¸åŒçš„æ”¶é›†ç­–ç•¥ã€‚é™¤äº†ä¸Šè¿°çš„ç©ºé—´ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ç‹¬ç«‹åŒºåŸŸä½¿ç”¨ H è¿›è¡Œæ ‡æ³¨ï¼Œè¡¨ç¤º Humongous å·¨å¤§çš„ï¼Œè¯´æ˜è¿™éƒ¨åˆ†ç‹¬ç«‹åŒºåŸŸç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯å¤§å¯¹è±¡æ˜¯æŒ‡å¯¹è±¡å¤§å° \u0026gt;= ç‹¬ç«‹åŒºåŸŸä¸€åŠç©ºé—´çš„å¯¹è±¡ã€‚\nG1 æ”¶é›†å™¨çš„å®ç°æµç¨‹å¤§è‡´ä¹Ÿå¯ä»¥åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nåˆå§‹æ ‡è®°ï¼šæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹ TAMS (Top at Mark Start) æŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€ä¸ªé˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®çš„åœ¨ç‹¬ç«‹åŒºåŸŸä¸­åˆ†é…æ–°å¯¹è±¡ã€‚G1 ä¸ºæ¯ä¸ªç‹¬ç«‹åŒºåŸŸéƒ½è®¾ç½®äº†ä¸¤ä¸ª TAMS æŒ‡é’ˆï¼Œæ–°åˆ†é…çš„å¯¹è±¡å¿…é¡»ä½äºè¿™ä¸¤ä¸ªæŒ‡é’ˆä½ç½®ä¸Šï¼Œä½äºè¿™ä¸¤ä¸ªæŒ‡é’ˆä½ç½®ä¸Šçš„å¯¹è±¡é»˜è®¤è¢«éšå¼æ ‡è®°ä¸ºå­˜æ´»çš„ï¼Œä¸ä¼šçº³å…¥å›æ”¶èŒƒå›´ã€‚ å¹¶å‘æ ‡è®°: ä»GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡å¼€å§‹å˜é‡æ•´ä¸ªå¯¹è±¡å›¾ã€‚éå†å®Œæˆä¹‹åï¼Œè¿˜éœ€è¦å¤„ç† SATB è®°å½•å½“ä¸­å˜åŠ¨çš„å¯¹è±¡ã€‚ SATB (snapshot-at-the-beginningï¼Œå¼€å§‹é˜¶æ®µå¿«ç…§) èƒ½å¤Ÿæœ‰æ•ˆçš„è§£å†³å¹¶å‘æ ‡è®°é˜¶æ®µå› ä¸ºç”¨æˆ·çº¿ç¨‹å…è®¸è€Œå¯¼è‡´çš„ç‹¬äº«å˜åŠ¨ï¼Œå…¶æ•ˆç‡æ¯” CMS é‡æ–°æ ‡è®°ä½¿ç”¨çš„å¢é‡æ›´æ–°ç®—æ³•æ•ˆç‡æ›´é«˜ã€‚ æœ€ç»ˆæ ‡è®°ï¼šå †ç”¨æˆ·çº¿ç¨‹åšä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåçš„å°‘é‡ STAB è®°å½•ã€‚è™½ç„¶å¹¶å‘æ ‡è®°é˜¶æ®µä¼šå¤„ç† SATB è®°å½•ï¼Œä½†ç”±äºå¤„ç†çš„æ—¶å€™ï¼Œç”¨æˆ·çº¿ç¨‹ä¾ç„¶æ˜¯è¿è¡Œä¸­çš„ï¼Œå› æ­¤ä¾ç„¶ä¼šæœ‰å°‘é‡çš„å˜åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æœ€ç»ˆæ ‡è®°æ¥åšå…œåº•ã€‚ ç­›é€‰å›æ”¶ï¼šè´Ÿè´£æ›´æ–°ç‹¬ç«‹åŒºåŸŸ Region ç»Ÿè®¡æ•°æ®ï¼ŒæŒ‰ç…§å„ä¸ª Region çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œåœ¨æ ¹æ®ç”¨æˆ·æœŸæœ›çš„åœé¡¿æ—¶é—´è¿›è¡Œæ¥æŒ‡å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥é€‰æ‹©ä»»æ„å¤šä¸ªç‹¬ç«‹åŒºåŸŸæ„æˆå›æ”¶é›†ã€‚ç„¶åå°†å›æ”¶é›†ä¸­ç‹¬ç«‹åŒºåŸŸçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„ç‹¬ç«‹åŒºåŸŸé‡Œé¢ï¼Œå†äº²å†æ‰æ•´ä¸ªæ—§çš„ç‹¬ç«‹åŒºåŸŸã€‚æ­¤æ—¶ï¼Œå› ä¸ºæ¶‰åŠåˆ°å­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä¸”ç”±å¤šä¸ªæ”¶é›†çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚ 5. Java ä¸­æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ Java ä¸­çš„åƒåœ¾ç®—æ³•ä¸»è¦åŒ…æ‹¬ä¸‰ç§ï¼Œæ ‡è®°-æ¸…é™¤ã€æ ‡è®°-æ•´ç†ã€æ ‡è®°-å¤åˆ¶ ã€æ³¨æ„ã€‘ ä¸‰ç§ç®—æ³•éƒ½æ˜¯æ ‡è®°å­˜æ´»çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶çš„å¯¹è±¡\nç‰¹æ€§ æ ‡è®°-æ¸…é™¤ æ ‡è®°-æ•´ç† æ ‡è®°-å¤åˆ¶ å·¥ä½œåŸç† é¦–å…ˆéå†å †ä¸­çš„å¯¹è±¡ï¼Œæ ‡è®°å‡ºæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åç›´æ¥æ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡ é¦–å…ˆæ ‡è®°å‡ºå †ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå°†å­˜æ´»çš„å¯¹è±¡å•ç‹¬æ•´ç†åœ¨ä¸€ä¸ªåŒºåŸŸï¼Œæœ€åæ¸…é™¤ä¸ºæ ‡è®°çš„å¯¹è±¡ å°†å†…å­˜åˆ†ä¸¤éƒ¨åˆ†ï¼Œæ¯æ¬¡åªç”¨å…¶ä¸­çš„ä¸€åŠã€‚æ ‡è®°å †ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œå°†å…¶å¤åˆ¶åˆ°æœªä½¿ç”¨çš„é‚£ä¸€åŠåŒºåŸŸï¼Œç„¶åæ¸…é™¤å¦å¤–ä¸€åŠåŒºåŸŸã€‚ï¼ˆå®é™…ä¸Šä¼šç”¨åˆ° eden å’Œ ä¸¤ä¸ª survivor åŒºï¼‰ ä¼˜ç‚¹ å®ç°ç®€å•ï¼Œèƒ½å¤Ÿæ¸…é™¤å †ä¸­æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ è§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ æ— åºå¤„ç†å†…å­˜ç¢ç‰‡ï¼Œå¹¶ä¸”åˆ†é…æ•ˆç‡é«˜ ç¼ºç‚¹ æ ‡è®°å’Œæ¸…é™¤çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå½±å“åç»­å†…å­˜åˆ†é…çš„æ•ˆç‡ æ•´ç†é˜¶æ®µéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œä¼šå¯¼è‡´é¢å¼€é”€ éœ€è¦åŒå€çš„å†…å­˜ç©ºé—´ï¼Œæµªè´¹äº†ä¸€åŠçš„ç©ºé—´ ã€æ ‡è®°-æ¸…é™¤ã€‘\næ ‡è®°-æ¸…é™¤ ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°å’Œæ¸…é™¤\næ ‡è®°é˜¶æ®µ (tracing)ï¼šä»GC Roots æ ¹å‡ºå‘ï¼Œé€šè¿‡ DFS æˆ–è€… BFS éå†æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡çš„å¤´éƒ¨ Header æ ‡è®°ä¸ºå­˜æ´»ã€‚å¦‚æœæ²¡æœ‰æ ‡è®°åˆ°çš„å¯¹è±¡ï¼Œè¯´æ˜ä»–ä»¬æ˜¯ä¸å¯è¾¾çš„ï¼Œä¸è¿›è¡Œæ ‡è®°æ–¹ä¾¿åæœŸè¿›è¡Œå›æ”¶ã€‚ ã€æ³¨æ„ã€‘ GC Roots çš„å¯¹è±¡åŒ…æ‹¬ï¼šæ ˆã€å¯„å­˜å™¨ã€å…¨å±€å˜é‡ç­‰ã€‚å…·ä½“æ¥è¯´ï¼Œè™šæ‹Ÿæœºä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ï¼‰ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼ˆå…¨å±€å˜é‡ï¼‰ã€æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡\næ¸…é™¤é˜¶æ®µï¼šéå†å †ä¸­çš„ç‹¬äº«ï¼Œå°†æœªè¢«æ ‡è®°çš„å¯¹è±¡ (ä¸å¯è¾¾) è¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ¸…é™¤çš„è¿‡ç¨‹ä¸ä¼šç§»åŠ¨å’Œæ•´ç†å†…å­˜ç©ºé—´ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç©ºé—²é“¾è¡¨ï¼ˆåŒå‘é“¾è¡¨ï¼‰æ¥æ ‡è®°è¢«åƒåœ¾å›æ”¶çš„åŒºåŸŸï¼Œå†…å­˜æ˜¯ç©ºé—²å¯ç”¨çš„ã€‚æ‰€ä»¥è¿™ç§ç®—æ³•ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ç¢ç‰‡çš„äº§ç”Ÿ\nå†…å­˜ç¢ç‰‡ (æ¸…é™¤è¿‡ç¨‹)ï¼šç¨‹åºåœ¨ç”³è¯·ä½¿ç”¨å†…å­˜çš„æ—¶å€™ï¼Œæ˜æ˜å‰©ä½™å†…å­˜ç©ºé—´æ˜¯å¤Ÿçš„ï¼Œä½†å°±æ˜¯ç”³è¯·ä¸åˆ°å†…å­˜ï¼Œè¿™ç§ç°è±¡å°±æ˜¯å­˜åœ¨å†…å­˜ç¢ç‰‡ã€‚å¦å¤–ï¼Œå†…å­˜ç¢ç‰‡ä¼šå¯¼è‡´åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦éå†é“¾è¡¨æŸ¥æ‰¾åˆé€‚çš„å†…å­˜å—ï¼Œä¼šæ¯”è¾ƒè€—æ—¶ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨å¤šä¸ªç©ºé—²é“¾è¡¨æ¥æ ¹æ®å†…å­˜åˆ†å—å¤§å°æ¥ç»„æˆä¸åŒçš„é“¾è¡¨ã€‚æ¯”å¦‚åˆ†ä¸ºå¤§åˆ†å—é“¾è¡¨å’Œå°åˆ†å—é“¾è¡¨ï¼Œæ ¹æ®ç”³è¯·çš„å†…å­˜åˆ†å—å¤§å°éå†ä¸åŒçš„é“¾è¡¨ï¼ŒåŠ å¿«å†…å­˜çš„ç”³è¯·æ•ˆç‡ã€‚\nä½å›¾æ ‡è®°æ³• (æ ‡è®°è¿‡ç¨‹)ï¼šæ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ˜¯æ ‡è®°åœ¨å¯¹è±¡å¤´é‡Œé¢ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´å†™æ—¶å¤åˆ¶ä¸å…¼å®¹ã€‚å› ä¸ºæ ‡è®°çš„è¿‡ç¨‹éœ€è¦ä¿®æ”¹å¯¹è±¡å¤´ï¼Œå³ä¾¿æ²¡æœ‰ä¿®æ”¹å¯¹è±¡çš„å€¼ï¼Œä¹Ÿå¯èƒ½è¢«è¯¯åˆ¤ä¸ºå†™æ“ä½œã€‚æ‰€ä»¥å¯ä»¥é‡‡ç”¨ä½å›¾æ ‡è®°æ³•ï¼Œå°†å †å†…å­˜çš„æŸä¸ªå—ç”¨ä¸€ä¸ªä½æ¥æ ‡è®°ï¼ŒæŠŠå †å†…å­˜åˆ†ä¸ºä¸€å—ä¸€å—çš„ã€‚å¯¹è±¡å°±æ˜¯å­˜å‚¨åœ¨ä¸€å—æˆ–è€…å¤šå—å†…å­˜ä¸Šã€‚æ ¹æ®å¯¹è±¡æ‰€åœ¨çš„åœ°å€å’Œå †çš„å…¶å®åœ°å€ï¼Œå°±å¯ä»¥ç®—å‡ºå¯¹è±¡æ˜¯åœ¨ç¬¬å‡ å—ä¸Šã€‚ç„¶åç”¨ä½å›¾ï¼ˆæ•°ç»„ï¼‰å°†å¯¹åº”çš„å¯¹è±¡ç¬¬ä¸€å—çš„å¯¹ä½ç½®ä¸º1ï¼Œè¡¨æ˜è¯¥å¯¹è±¡è¢«æ ‡è®°äº†ã€‚è¿™æ ·å°±å¯ä»¥å…¼å®¹å†™æ—¶å¤åˆ¶çš„ç®—æ³•äº†ã€‚å¦å¤–ï¼Œå¦‚æœæ ‡æ³¨åœ¨å¯¹è±¡å¤´ä¸Šï¼Œåˆ™æ¸…é™¤çš„è¿‡ç¨‹éœ€è¦éå†æ•´ä¸ªå †æ¥æ‰«æå¯¹è±¡ã€‚è€Œå¦‚æœé‡‡ç”¨ä½å›¾æ ‡è®°æ³•ï¼Œåˆ™å¯ä»¥ç›´æ¥å¿«é€Ÿéå†ä½å›¾ï¼Œæ¸…é™¤å¯¹åº”çš„å¯¹è±¡ ï¼ˆä½å›¾çš„æ•°ç»„å’Œå †å†…å­˜å—ä½ç½®å¯¹åº”ï¼‰ã€‚ä½†æ˜¯ï¼Œæ— è®ºæ˜¯é‡‡ç”¨æ ‡è®°å¯¹è±¡å¤´è¿˜æ˜¯ä½å›¾æ ‡è®°æ³•ï¼Œéƒ½ä¼šå­˜åœ¨å†…å­˜ç¢ç‰‡ ã€æ³¨æ„ã€‘å†™æ—¶å¤åˆ¶æ“ä½œå°±æ˜¯å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å…±äº«åŒä¸€ä»½æ•°æ®ï¼Œç›´åˆ°æŸä¸ªè¿›ç¨‹/çº¿ç¨‹å°è¯•ä¿®æ”¹æ•°æ®æ—¶ï¼Œæ‰å¤åˆ¶å¹¶ç”Ÿæˆè¯¥æ•°æ®çš„ç‹¬ç«‹å‰¯æœ¬\nã€æ ‡è®°-å¤åˆ¶ã€‘\næ ‡è®°-å¤åˆ¶ç®—æ³•ä¼šæŠŠå †åˆ†ä¸ºä¸¤å—ï¼Œä¸€å—æ˜¯ From åŒºï¼Œä¸€å—æ˜¯ To åŒº ã€‚æ‰€æœ‰çš„å¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šæ”¾åœ¨ From åŒºåŸŸã€‚å‘ç”Ÿ GC åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä¼šæ ‡è®°æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå°†æ ‡è®°çš„å¯¹è±¡ä» From åŒº å¤åˆ¶åˆ° To åŒºï¼Œç„¶åæ•´ä½“å›æ”¶ From åŒºã€‚å›æ”¶å®Œ From åŒºä¹‹åï¼Œå°† To åŒºå’Œ From åŒºçš„è¿›è¡Œç½®æ¢ï¼Œè®©åŸæ¥çš„ From åŒº å˜æˆ To åŒºï¼ŒåŸæ¥çš„ To åŒº å˜æˆ From åŒºã€‚ è¯¥è¿‡ç¨‹å½“ä¸­ï¼Œå› ä¸ºæ˜¯æ•´ä½“From åŒºè¿›è¡Œå›æ”¶ï¼Œä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ã€‚åŒæ—¶ï¼Œä¹Ÿä¸éœ€è¦ç©ºé—²é“¾è¡¨æ¥è®°å½•å†…å­˜ç©ºé—²çš„åŒºåŸŸï¼Œç›´æ¥ç§»åŠ¨æŒ‡é’ˆåˆ†é…å†…å­˜ã€‚è¯¥æ–¹æ³•å¯¹ CPU ç¼“å­˜éå¸¸å‹å¥½ï¼Œå› ä¸ºä» GC Roots å¼€å§‹é‡‡ç”¨DFSéå†ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŠŠå…³è”çš„å¯¹è±¡éƒ½æ‰¾åˆ°ï¼Œç„¶åå¯¹è±¡å’Œå…³è”å¯¹è±¡çš„å†…å­˜ä½ç½®åˆ†é…çš„å¾ˆè¿‘ã€‚æ ¹æ®å±€éƒ¨æ€§åŸç†ï¼Œè®¿é—®åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå…³è”å¯¹è±¡ä¹Ÿå¯èƒ½è¢«åŒæ—¶è®¿é—®ï¼Œè®¿é—®ç¼“å­˜å¯ä»¥ç›´æ¥å‘½ä¸­ã€‚ è¯¥æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œæœ‰ä¸€åŠçš„å †å†…å­˜æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œå†…å­˜çš„åˆ©ç”¨ç‡å¾ˆä½ã€‚å¦å¤–ï¼Œå¦‚æœå­˜æ´»çš„å¯¹è±¡å¾ˆå¤šï¼Œå¤åˆ¶çš„è¿‡ç¨‹æ˜¯å¾ˆæ…¢çš„ã€‚\nã€æ ‡è®°-æ•´ç†ã€‘\næ ‡è®°-æ•´ç†å’Œæ ‡è®°-å¤åˆ¶çš„åŸç†å…¶å®å·®ä¸å¤šï¼ŒåŒºåˆ«åœ¨äºå¤åˆ¶ç®—æ³•éœ€è¦åˆ†ä¸ºä¸¤ä¸ªåŒºæ¥å›å¤åˆ¶ï¼Œè€Œæ•´ç†éƒ¨åˆ†éœ€ï¼Œç›´æ¥æ•´ç†ã€‚æ ‡è®°æ•´ç†çš„è¿‡ç¨‹æ˜¯ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¾€è¾¹ç•Œä¸Šæ•´ç†ï¼Œç„¶åå¯¹å…¶ä»–çš„éƒ¨åˆ†è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿä¸éœ€è¦åƒå¤åˆ¶ç®—æ³•é‚£æ ·è…¾å‡ºä¸€åŠçš„ç©ºé—´ï¼Œæ‰€ä»¥å†…å­˜åˆ©ç”¨ç‡ä¹ŸæŒºé«˜çš„ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯éœ€è¦å¯¹å †å†…å­˜è¿›è¡Œå¤šæ¬¡æœç´¢ï¼Œå› ä¸ºéœ€è¦åœ¨åŒä¸€ä¸ªç©ºé—´é‡Œé¢ï¼Œå®Œæˆæ ‡è®°å’Œæ•´ç†ï¼ˆç§»åŠ¨ï¼‰çš„æ“ä½œã€‚æ‰€ä»¥å®Œæˆè¯¥è¿‡ç¨‹éœ€è¦èŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ã€‚\n6. Java ä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å¼ºå¼•ç”¨ï¼šå¼ºå¼•ç”¨å®é™…ä¸Šå°±æ˜¯ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ï¼Œå…¶ä»£ç å¦‚ä¸‹\nString strongReference = new String(\u0026#34;abc\u0026#34;); å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚\nè½¯å¼•ç”¨ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚è½¯å¼•ç”¨ä»£ç å¦‚ä¸‹\nString str = new String(\u0026#34;abc\u0026#34;); SoftReference\u0026lt;String\u0026gt; softReference = new SoftReference\u0026lt;String\u0026gt;(str); å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ— ReferenceQueue è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJVM å°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\nå¼±å¼•ç”¨ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š\nString str = new String(\u0026#34;abc\u0026#34;); WeakReference\u0026lt;String\u0026gt; weakReference = new WeakReference\u0026lt;\u0026gt;(str); str = null; //strå˜æˆè½¯å¼•ç”¨ï¼Œå¯ä»¥è¢«æ”¶é›† å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å¼±å¼•ç”¨ä¹Ÿå¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ— ReferenceQueue è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJVM å°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\nè™šå¼•ç”¨ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è™šå¼•ç”¨ä»£ç å¦‚ä¸‹\nString str = new String(\u0026#34;abc\u0026#34;); ReferenceQueue queue = new ReferenceQueue(); // åˆ›å»ºè™šå¼•ç”¨ï¼Œè¦æ±‚å¿…é¡»ä¸ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—å…³è” PhantomReference pr = new PhantomReference(str, queue); è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ReferenceQueue è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸ºè½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º OutOfMemory ç­‰é—®é¢˜çš„äº§ç”Ÿã€‚\n","permalink":"https://swimmingliu.cn/posts/job/java-jvm-interview-questions/","summary":"\u003cp\u003e\u003ccode\u003eJVM\u003c/code\u003e å…¨å±€æ„æ¶å›¾å¦‚ä¸‹ï¼ŒåŒ…å« \u003ccode\u003eJVM\u003c/code\u003e çš„å…¨éƒ¨å†…å®¹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"JVM-å…¨å±€ç»“æ„å›¾\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/695c3cf0-098e-11f0-a8ba-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003ch2 id=\"1-jvm-çš„å†…å­˜åŒºåŸŸæ˜¯å¦‚ä½•åˆ’åˆ†çš„\"\u003e1. JVM çš„å†…å­˜åŒºåŸŸæ˜¯å¦‚ä½•åˆ’åˆ†çš„ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eJVM\u003c/code\u003e å†…å­˜å½“ä¸­ï¼Œè¿è¡Œæ—¶æ•°æ®çš„åŒºåŸŸåŒ…å«å †ã€æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€‚å¦å¤–ï¼Œå…¶ä»–çš„å†…å­˜åŒºåŸŸå±äºæœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜å°±åŒ…æ‹¬ç›´æ¥å†…å­˜ï¼Œç›´æ¥å†…å­˜æ˜¯éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ã€‚\nå…¶ä¸­ï¼Œå †å’Œæ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨éƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e \u003ccode\u003eJVM\u003c/code\u003e è§„èŒƒå¯¹äºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„è§„å®šæ˜¯å¾ˆå®½æ¾çš„ã€‚å°±æ‹¿å †æ¥è¯´ï¼Œå †å¯ä»¥æ˜¯è¿ç»­ç©ºé—´ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸è¿ç»­ç©ºé—´ã€‚å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥å†è¿è¡Œæ—¶æŒ‰ç…§éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚è™šæ‹Ÿæœºå®ç°è€…å¯ä»¥ä½¿ç”¨ä»»ä½•\u003cstrong\u003eåƒåœ¾å›æ”¶ç®—æ³•\u003c/strong\u003eç®¡ç†å †ï¼Œç”šè‡³å®Œå…¨ä¸è¿›è¡Œåƒåœ¾å›æ”¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"JVMå†…å­˜åŒºåŸŸ\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/6ebff0fa-07e8-11f0-86bd-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹é¢é€ä¸€ä»‹ç»ä¸åŒéƒ¨åˆ†çš„åŠŸèƒ½å’Œä½œç”¨\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„éƒ¨åˆ†ï¼Œ\u003cstrong\u003eç¨‹åºè®¡æ•°å™¨\u003c/strong\u003eã€\u003cstrong\u003eè™šæ‹Ÿæœºæ ˆ\u003c/strong\u003eã€\u003cstrong\u003eæœ¬åœ°æ–¹æ³•æ ˆ\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€ç¨‹åºè®¡æ•°å™¨ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šç¨‹åºè®¡æ•°å™¨å°±æ˜¯è®°å½•å½“å‰æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·ã€‚å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼Œæ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä½œç”¨\u003c/strong\u003eï¼šåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤è¿™äº›åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨å®Œæˆã€‚æ¯”å¦‚çº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡ä¸­ï¼Œä» \u003ccode\u003eAçº¿ç¨‹\u003c/code\u003e å…ˆåˆ‡æ¢åˆ° \u003ccode\u003eBçº¿ç¨‹\u003c/code\u003eï¼Œç„¶åä» \u003ccode\u003eBçº¿ç¨‹\u003c/code\u003e æ¢å¤åˆ° \u003ccode\u003eAçº¿ç¨‹\u003c/code\u003e çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸ºäº† \u003ccode\u003eAçº¿ç¨‹\u003c/code\u003e èƒ½å¤Ÿæ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œå°±éœ€è¦è¯»å– \u003ccode\u003eAçº¿ç¨‹\u003c/code\u003e ç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼Œæ¥ç¡®è®¤åˆ‡æ¢çº¿ç¨‹å‰æ‰§è¡Œçš„ä½ç½®åœ¨å“ªé‡Œã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ç§æœ‰\u003c/strong\u003eï¼šå› ä¸ºçº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹å½“ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨æ¥è®°å½•è‡ªå·±çš„ç¨‹åºæ‰§è¡Œä½ç½®ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° \u003ccode\u003eOOM\u003c/code\u003e å†…å­˜ä¸è¶³çš„å†…å­˜åŒºåŸŸï¼Œå› ä¸ºä»–å°±åªæ˜¯å­˜å‚¨ä¸€ä¸ªå€¼ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€è™šæ‹Ÿæœºæ ˆã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šè™šæ‹Ÿæœºæ ˆæŒ‰ç…§å…ˆè¿›åå‡ºçš„æ–¹æ¡ˆå­˜å‚¨çš„æ˜¯éæœ¬åœ°æ–¹æ³•çš„è°ƒç”¨å¯¹åº”çš„\u003cstrong\u003eæ ˆå¸§\u003c/strong\u003eã€‚æ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ä¼šè¢«å‹å…¥æ ˆä¸­ï¼Œæ–¹æ³•ç»“æŸçš„æ—¶å€™ä¼šè¢«å¼¹å‡ºæ ˆä¸­ã€‚æ ˆå¸§ä¸­åŒ…å«\u003cstrong\u003eå±€éƒ¨å˜é‡è¡¨\u003c/strong\u003eã€\u003cstrong\u003eæ“ä½œæ¬¡æ•°æ ˆ\u003c/strong\u003eï¼ˆå­˜å‚¨æ“ä½œæ•°å’Œä¸´æ—¶è®¡ç®—ç»“æœï¼‰ã€\u003cstrong\u003eåŠ¨æ€é“¾æ¥\u003c/strong\u003eã€\u003cstrong\u003eæ–¹æ³•çš„è¿”å›åœ°å€\u003c/strong\u003eã€‚è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä½œç”¨\u003c/strong\u003eï¼šå­˜å‚¨éæœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ï¼Œæ”¯æŒæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚å½“æ ˆæ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œä¼šæŠ›å‡º \u003ccode\u003eStackOverflowError\u003c/code\u003e æ ˆæº¢å‡ºå¼‚å¸¸ã€‚å¦‚æœè™šæ‹Ÿæœºæ ˆæ— æ³•åŠ¨æ€æ‰©å±•æˆ–ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œä¼šæŠ›å‡º \u003ccode\u003eOutOfMemoryError\u003c/code\u003e å†…å­˜ä¸è¶³å¼‚å¸¸ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"JVM-è™šæ‹Ÿæœºæ ˆ-å®Œæ•´ç»“æ„\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/6f22fcdc-07e8-11f0-92ef-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003cp\u003eæ ˆå¸§ä¸­åŒ…å«\u003cstrong\u003eå±€éƒ¨å˜é‡è¡¨\u003c/strong\u003eã€\u003cstrong\u003eæ“ä½œæ¬¡æ•°æ ˆ\u003c/strong\u003eï¼ˆå­˜å‚¨æ“ä½œæ•°å’Œä¸´æ—¶å˜é‡ï¼‰ã€\u003cstrong\u003eåŠ¨æ€é“¾æ¥\u003c/strong\u003eã€\u003cstrong\u003eæ–¹æ³•çš„è¿”å›åœ°å€\u003c/strong\u003eã€‚å…¶ä¸­ï¼Œå±€éƒ¨å˜é‡è¡¨å­˜æ”¾çš„æ˜¯æ‰€æœ‰çš„å±€éƒ¨å˜é‡ï¼Œæˆ–è€…å…¶å‡ºå¯¹åº”çš„åœ°å€ï¼ˆæ•°ç»„ï¼‰ã€‚åŠ¨æ€é“¾æ¥å°±æ˜¯å½“å‰ç±»å¸¸é‡æ± çš„å¼•ç”¨ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå±€éƒ¨å˜é‡è¡¨\u003c/strong\u003eï¼šå­˜æ”¾\u003cstrong\u003eæ–¹æ³•å‚æ•°ä¼ å…¥çš„å½¢å‚å€¼\u003c/strong\u003eï¼Œ\u003cstrong\u003eæ–¹æ³•å†…çš„å±€éƒ¨å˜é‡\u003c/strong\u003eã€\u003cstrong\u003eæ–¹æ³•çš„ \u003ccode\u003ethis\u003c/code\u003e å¼•ç”¨\u003c/strong\u003eã€‚å†…éƒ¨ç»“æ„ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆ\u003ccode\u003eboolean\u003c/code\u003eã€\u003ccode\u003ebyte\u003c/code\u003eã€\u003ccode\u003echar\u003c/code\u003eã€\u003ccode\u003eshort\u003c/code\u003eã€\u003ccode\u003eint\u003c/code\u003eã€\u003ccode\u003efloat\u003c/code\u003eã€\u003ccode\u003elong\u003c/code\u003eã€\u003ccode\u003edouble\u003c/code\u003eï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ“ä½œæ•°æ ˆ\u003c/strong\u003eï¼šä¸»è¦ä½œä¸º\u003cstrong\u003eæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™\u003c/strong\u003eä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾\u003cstrong\u003eæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­\u003c/strong\u003eäº§ç”Ÿçš„\u003cstrong\u003eä¸­é—´è®¡ç®—ç»“æœ\u003c/strong\u003eã€‚å¦å¤–ï¼Œ\u003cstrong\u003eè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡\u003c/strong\u003eä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŠ¨æ€é“¾æ¥\u003c/strong\u003eï¼šä¸»è¦ä½œç”¨æ˜¯å®ç°åœ¨\u003cstrong\u003eå½“å‰æ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–æ–¹æ³•\u003c/strong\u003eã€‚ \u003ccode\u003eClass\u003c/code\u003e æ–‡ä»¶çš„å¸¸é‡æ± é‡Œé¢ä¿å­˜æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œæ¯”å¦‚æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚ å½“ä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œéœ€è¦å°†å¸¸é‡æ± ä¸­åªæƒ³æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨å†…å­˜åœ°å€å½“ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯\u003cstrong\u003eæŠŠå¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºå†…å­˜å½“ä¸­çš„ç›´æ¥å¼•ç”¨\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€æœ¬åœ°æ–¹æ³•æ ˆã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæ ˆçš„ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚ä¸åŒçš„æ˜¯ï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ \u003ccode\u003eJVM\u003c/code\u003e è°ƒç”¨ \u003ccode\u003eNative\u003c/code\u003e æ–¹æ³•çš„æ—¶å€™æ‰ä¼šç”¨åˆ°çš„ï¼Œè™šæ‹Ÿæœºæ ˆæ˜¯æ‰§è¡Œ \u003ccode\u003eJava\u003c/code\u003e è‡ªèº«çš„æ–¹æ³• (ä¹Ÿå°±æ˜¯å­—èŠ‚ç ) ä¼šç”¨åˆ°çš„ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä½œç”¨\u003c/strong\u003eï¼šå­˜å‚¨æœ¬åœ°æ–¹æ³• (\u003ccode\u003eNative\u003c/code\u003e) æ ˆå¸§ï¼Œæ”¯æŒæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e åœ¨ \u003ccode\u003eHotSpot\u003c/code\u003e è™šæ‹Ÿæœºå½“ä¸­ï¼Œå°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€äº†ã€‚\u003c/p\u003e","title":"JVM é¢è¯•é¢˜ç¬”è®°"},{"content":"1. TCP å’Œ UDP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ TCP æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥ã€åŸºäºå­—èŠ‚æµä¼ è¾“çš„ä¼ è¾“åè®®ï¼Œèƒ½å¤Ÿä¿è¯æ•°æ®çš„é¡ºåºï¼Œä½†æ˜¯å…¶å»¶è¿Ÿæ¯”è¾ƒå¤§ã€‚ä¸€èˆ¬é€‚ç”¨äºéœ€è¦æ•°æ®å®Œæ•´æ€§å’Œé¡ºåºçš„åœºæ™¯ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“ã€é‚®ä»¶ã€Web ç½‘ç«™ã€‚ UDP æ˜¯ä¸€ç§ä¸å¯é çš„ã€æ— è¿æ¥ã€åŸºäºæ•°æ®æŠ¥ä¼ è¾“çš„ä¼ è¾“åè®®ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºï¼Œä½†æ˜¯å»¶è¿Ÿæ¯”è¾ƒå°ã€‚ä¸€èˆ¬é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½è¦æ±‚å’Œå¿«é€Ÿä¼ è¾“æ•°æ®çš„åº”ç”¨ï¼Œæ¯”å¦‚å®æ—¶é€šè®¯ã€è¯­éŸ³ã€è§†é¢‘ã€æ¸¸æˆç­‰ã€‚\nã€æ³¨æ„ã€‘TCP å’Œ UDP éƒ½å±äºä¼ è¾“å±‚\nç‰¹æ€§ TCP UDP è¿æ¥æ–¹å¼ é¢å‘è¿æ¥ (ä¸‰æ¬¡æ¡æ‰‹) æ— è¿æ¥ å¯é æ€§å’Œé¡ºåºä¿è¯ å¯é ï¼Œä¿è¯æ•°æ®æŒ‰é¡ºåºé€è¾¾ ä¸å¯é ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºï¼Œè€Œä¸èƒ½ä¿è¯å®‰å…¨é€è¾¾ æµé‡æ§åˆ¶/æ‹¥å¡æ§åˆ¶ æä¾›æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ æ²¡æœ‰æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ å¤´éƒ¨å¤§å° å¤´éƒ¨è¾ƒå¤§ (20 ~ 80 å­—èŠ‚) è¾ƒå° (åªæœ‰ 8 å­—èŠ‚) æ€§èƒ½ è¾ƒä½ï¼Œå»¶è¿Ÿå¤§ è¾ƒé«˜ï¼Œå»¶è¿Ÿå° æ˜¯å¦æ”¯æŒå¹¿æ’­ ä¸æ”¯æŒå¹¿æ’­ æ”¯æŒå¹¿æ’­ æ•°æ®ä¼ è¾“æ¨¡å¼ é€šè¿‡å­—èŠ‚æµä¼ è¾“ é€šè¿‡æ•°æ®æŠ¥ä¼ è¾“ é€‚ç”¨åœºæ™¯ æ–‡ä»¶ä¼ è¾“ã€Webã€é‚®ä»¶ç­‰éœ€è¦å¯é æ€§çš„ä¼ è¾“ å®æ—¶é€šè®¯ã€è¯­éŸ³ã€è§†é¢‘ã€æ¸¸æˆç­‰é«˜æ€§èƒ½è¦æ±‚åº”ç”¨ åŸºäºä¸¤è€…çš„åè®® 1. HTTPåè®®ï¼šè¶…æ–‡æœ¬å’Œå¤šåª’ä½“å†…å®¹çš„åè®®\n2. HTTPSåè®®ï¼šåŸºäºHTTPåè®®ä¸ŠåŠ äº†ä¸€å±‚SSL / TSL å¤–å£³ï¼Œä¿è¯äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§\n3. FTPåè®®ï¼š æ–‡ä»¶ä¼ è¾“åè®®ï¼Œç”¨æ¥ä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„\n4. SMTPåè®®ï¼šç®€å•é‚®ä»¶åè®®ï¼Œç”¨äºå‘é€é‚®ä»¶çš„åè®® (POP3 åè®®ï¼š è´Ÿè´£é‚®ä»¶æ¥å—çš„åè®®) 1. HTTP 3.0 åè®®: åŸºäº UDP çš„QUIC åè®®\n2. DHCP åè®®ï¼š åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ŒåŠ¨æ€é…ç½® IP åœ°å€\n3. DNS ï¼šåŸŸåè§£æç³»ç»Ÿï¼Œå°†åŸŸåè½¬å˜ä¸ºæœºå™¨åˆ»åº¦çš„ IP åœ°å€ ã€ISO å’Œ TCP/IP æ¨¡å‹ã€‘\n**ISO (7å±‚) **ï¼š â€œç‰©è”ç½‘æ·‘æ…§é€‚ç”¨â€ : ç‰©ç†å±‚â€”æ•°æ®é“¾è·¯å±‚â€”ç½‘ç»œå±‚â€”ä¼ è¾“å±‚â€”ä¼šè¯å±‚â€”è¡¨ç¤ºå±‚â€”åº”ç”¨å±‚ TCP/IP (4å±‚)ï¼šé“¾è·¯å±‚â€”ç½‘ç»œå±‚â€”ä¼ è¾“å±‚â€”åº”ç”¨å±‚ ã€TCP è¯¦è§£ã€‘\nTCPåŒ…æ²¡æœ‰IPåœ°å€ï¼Œç½‘ç»œå±‚å·²ç»å¤„ç†è¿‡äº†ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£\nåºåˆ—å· (Sequence Number)ï¼šåœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œä¸»æœºç”Ÿæˆéšæœºæ•°ä½œä¸ºåˆå§‹å€¼ï¼Œ ç»è¿‡ SYN åŒ… (ç¬¬ä¸€æ¬¡æ¡æ‰‹)ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºã€‚æ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œç´¯åŠ æ•°æ®å­—èŠ‚æ•°å¤§å°ï¼Œç”¨æ¥ç¡®ä¿ä¼ è¾“æ˜¯æŒ‰ç…§é¡ºåºæ¥å—çš„ã€‚ ç¡®è®¤åº”ç­”å· (Acknowledgement Number) ï¼šç”¨æ¥è¡¨ç¤ºä¸‹ä¸€æ¬¡å¸Œæœ›å—åˆ°çš„æ•°æ®åºåˆ—å·ï¼Œå‘é€ç«¯å—åˆ°ç¡®è®¤åº”ç­”åå¯è®¤ä¸ºæ­¤åºåˆ—å·å‰æ•°æ®å·²ç»è¢«æ­£å¸¸æ¥å—ï¼Œé˜²æ­¢å‡ºç°ä¸¢åŒ…çš„æƒ…å†µã€‚ æ§åˆ¶ä½ (TCP Flags): ä¸‹é¢çš„å­—æ®µéƒ½æ˜¯äºŒè¿›åˆ¶æ¥è¡¨ç¤ºæ˜¯å¦æœ‰æ•ˆï¼Œ0 å’Œ 1 åˆ†åˆ«è¡¨ç¤ºæ— æ•ˆå’Œæœ‰æ•ˆ ACK : è¡¨ç¤ºç¡®è®¤åº”ç­”å­—æ®µæ˜¯å¦æœ‰æ•ˆ, TCP è§„å®šé™¤äº†ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ SYN åŒ…ä»¥å¤–ï¼Œè¯¥ä½ç½®å¿…é¡»ä¸º 1ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»æœ‰æ•ˆ **RST (Reset) **: è¡¨ç¤º TCPè¿æ¥å½“ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ˜¯å¦éœ€è¦å¼ºåˆ¶æ–­å¼€è¿æ¥ï¼Œè¿›è¡Œé‡ç½® SYNï¼šè¡¨ç¤ºæ˜¯å¦ç”¨æ¥å»ºç«‹è¿æ¥ (ç¬¬ä¸€æ¬¡æ¡æ‰‹)ï¼Œ å¹¶è®¾ç½®å…¶åºåˆ—å·çš„å­—æ®µçš„åˆå§‹å€¼ FINï¼šè¡¨ç¤ºæ˜¯å¦ç»“æŸ TCP è¿æ¥ï¼Œå¦‚æœä¸º1ï¼Œ åé¢ä¸ä¼šå†ä¼ è¾“æ•°æ®ï¼Œæ–­å¼€è¿æ¥ã€‚ çª—å£å¤§å° (Window / Advertise-Window)ï¼šç”¨äºå®ç°æ»‘åŠ¨çª—å£ï¼Œè¿›è¡Œæµé‡æ§åˆ¶ï¼Œç¡®ä¿å‘é€æ–¹ä¸ä¼šè¶…å‡ºæ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºã€‚æ»‘åŠ¨çª—å£æœºåˆ¶æ˜¯ç”¨æ¥å…è®¸å‘é€æ–¹åœ¨æœªæ”¶åˆ°æ¥æ”¶æ–¹ç¡®è®¤çš„æƒ…å†µä¸‹ï¼Œè¿ç»­å‘é€å¤šä¸ªæ•°æ®åŒ…ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚å®ç°æ–¹å¼æ˜¯ï¼Œæ¥æ”¶æ–¹åœ¨æŠ¥æ–‡å½“ä¸­é€šçŸ¥å…¶å‰©ä½™çš„ç¼“å†²åŒºå¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¯¥ä¿¡æ¯è°ƒæ•´å‘é€çª—å£ï¼ŒåŠ¨æ€æ§åˆ¶æ•°æ®æµé‡ã€‚ ã€TCP é¢è¯•é¢˜æ‹“å±•ã€‘\næœ‰ä¸€ä¸ªIPçš„æœåŠ¡ç«¯ç›‘å¬äº†ä¸€ä¸ªç«¯å£ï¼Œå®ƒçš„TCPæœ€å¤§è¿æ¥æ•°ç›®æ˜¯å¤šå°‘ï¼Ÿ\næœ€å¤§TCPè¿æ¥æ•° = å®¢æˆ·ç«¯IPæ•° * å®¢æˆ·ç«¯çš„ç«¯å£æ•° åœ¨ IPv4 å½“ä¸­ï¼Œå®¢æˆ·ç«¯çš„IPæ•°ç›®æœ€å¤šä¸º 2^32, å®¢æˆ·ç«¯çš„ç«¯å£æ•°æœ€å¤šä¸º 2^16ï¼Œæ‰€ä»¥å•æœºçš„TCPæœ€å¤§è¿æ¥æ•°ä¸º2^48ã€‚ä½†æ˜¯ç”±äºæ–‡ä»¶æè¿°ç¬¦å’Œå†…å­˜é™åˆ¶ï¼Œä¸€èˆ¬æ²¡æ³•å„¿è¾¾åˆ°ç†è®ºä¸Šé™ã€‚\nã€UDP çš„é¦–éƒ¨ç»“æ„ã€‘\nUDP å¯¹åº”ç”¨å±‚ä¼ ä¸‹æ¥çš„ä¿æ¸©ï¼Œæ—¢ä¸åˆå¹¶ä¹Ÿä¸æ‹†åˆ†ï¼Œä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œ, åªæ˜¯åŠ ä¸€ä¸ª UDP å¤´éƒ¨ã€‚\nç›®æ ‡ã€æºç«¯å£ï¼šè¡¨ç¤º UDP å°†æ•°æ®å‘é€åˆ°å“ªä¸ªè¿›ç¨‹ åŒ…é•¿åº¦ï¼šè¡¨ç¤º UDP é¦–éƒ¨å’Œæ•°æ®çš„æ€»é•¿åº¦ æ ¡éªŒå’Œï¼šç”¨äºç¡®ä¿ UDP é¦–éƒ¨å’Œæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªå—æŸ ã€TCP å’Œ UDP èƒ½å¦ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ã€‘\nTCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¼ è¾“åè®®æ˜¯å®Œå…¨ç‹¬ç«‹çš„è½¯ä»¶æ¨¡å—ã€‚æ•°æ®åŒ…é€šè¿‡ IPåŒ…å¤´ä¸­çš„åè®®å·å­—æ®µåˆ¤æ–­æ˜¯ TCP è¿˜æ˜¯ UDPï¼Œå¹¶è½¬å‘ç»™ç›¸åº”çš„æ¨¡å—å¤„ç†ã€‚ç„¶å, TCP æˆ– UDP æ¨¡å—æ ¹æ®ç«¯å£å·å°†æŠ¥æ–‡è½¬å‘ç»™å¯¹åº”çš„åº”ç”¨ç¨‹åºã€‚\n2. è¯´è¯´TCPçš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ ? TCP ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯å‘é€ SYN ç»™æœåŠ¡ç«¯ï¼Œå»ºç«‹è¿æ¥ æœåŠ¡ç«¯æ”¶åˆ° SYN æ¶ˆæ¯ä¹‹åï¼Œå›å¤ä¸€ä¸ª SYN-ACK ç¡®è®¤æ¶ˆæ¯ï¼Œè¡¨ç¤ºæ¥æ”¶åˆ°äº†å®¢æœç«¯çš„è¿æ¥è¯·æ±‚ å®¢æœç«¯æ”¶åˆ°SYN-ACK æ¶ˆæ¯ä¹‹åï¼Œå†å‘ä¸€ä¸ª ACK ç¡®è®¤æ¶ˆæ¯ï¼Œè¡¨ç¤ºæ”¶åˆ°æœåŠ¡å™¨çš„SYN-ACK æ¶ˆæ¯ï¼ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚ ã€TCP ä¸‰æ¬¡æ¡æ‰‹çš„å®ç°ç»†èŠ‚ã€‘\næœ€å¼€å§‹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äº CLOSE çŠ¶æ€ï¼Œè¡¨ç¤ºåŒæ–¹æ²¡æœ‰å»ºç«‹è¿æ¥ã€‚æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£ï¼Œå¤„äºLISTEN çŠ¶æ€ã€‚\nã€ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‘\nå®¢æˆ·ç«¯éšæœºåˆå§‹åŒ– client_isn å€¼ï¼Œå°†å…¶è®¾ç½®ä¸ºTCP å¤´éƒ¨çš„åºåˆ—å·å­—æ®µã€‚ å°†æ ‡å¿—ä½çš„ SYN è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºè¯¥æŠ¥æ–‡ä¸º SYN æŠ¥æ–‡ã€‚ å®¢æœç«¯å°†è¯¥æŠ¥æ–‡å‘é€ç»™æœåŠ¡ç«¯ï¼Œä¹‹åå®¢æˆ·ç«¯å¤„äº SYN-SENT çŠ¶æ€ã€‚è¡¨ç¤ºå‘æœåŠ¡ç«¯å‘èµ· TCP è¿æ¥ï¼Œè¯¥æŠ¥æ–‡ä¸åŒ…å«åº”ç”¨å±‚çš„ä»»ä½•æ•°æ®ï¼Œåªç”¨äºå»ºç«‹è¿æ¥ã€‚ ã€ç¬¬äºŒæ¬¡æ¡æ‰‹ã€‘\næœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ SYN æŠ¥æ–‡çŸ¥ä¹ï¼Œéšæœºåˆå§‹åŒ–åºå·server_isn , å¹¶æŠŠå®ƒå¡«å…¥ TCP å¤´éƒ¨çš„åºåˆ—å·å­—æ®µã€‚ å°†ç¡®è®¤åº”ç­”å¥½ä¿®æ”¹ä¸º SYN æŠ¥æ–‡ä¸­çš„åºåˆ—å· + 1ï¼Œä¹Ÿå°±æ˜¯client_isn + 1ã€‚å¹¶æŠŠSYN å’Œ ACK çš„æ ‡è®°ä½éƒ½æ”¹ä¸º1ï¼Œè¯¥æŠ¥æ–‡ä¸º SYN-ACK æŠ¥æ–‡ å‘é€ SYN-ACK æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œä¸åŒ…å«ä»»ä½•åº”ç”¨å±‚æ•°æ®ï¼Œåªç”¨äºç¡®è®¤æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯è¿›å…¥ SYN-RCVD çŠ¶æ€ ã€ç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‘\nå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ SYN-ACK æŠ¥æ–‡ï¼Œå‡†å¤‡å›åº”æœ€åçš„åº”ç­”æŠ¥æ–‡ æŠŠæŠ¥æ–‡çš„ TCP å¤´éƒ¨çš„ç¡®è®¤åº”ç­”å·ä¿®æ”¹ä¸º SYN-ACK æŠ¥æ–‡çš„åºåˆ—å· + 1ï¼Œä¹Ÿå°±æ˜¯server_isn + 1ã€‚ ACK æ ‡å¿—ä¿®æ”¹ä¸º 1, SYN ä¸åšä»»ä½•ä¿®æ”¹ï¼Œä¾ç„¶ä¸º 0ï¼Œè¯¥æŠ¥æ–‡è¡¨ç¤º ACKæŠ¥æ–‡ã€‚ æŠŠæŠ¥æ–‡å‘é€ç»™æœåŠ¡ç«¯ï¼Œå¯ä»¥æºå¸¦åº”ç”¨å±‚çš„æ•°æ®ï¼Œä¹‹åå®¢æˆ·ç«¯å¤„äºESTABLISHED çŠ¶æ€ï¼Œè¡¨ç¤ºæˆåŠŸå»ºç«‹è¿æ¥ã€‚ **ã€æ³¨æ„ã€‘**ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼Œä½†æ˜¯å‰ä¸¤æ¬¡æ¡æ‰‹éƒ½ä¸èƒ½æºå¸¦æ•°æ®ã€‚å¹¶ä¸”å°±ç®—ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±ï¼ŒæœåŠ¡ç«¯ä¾ç„¶å¯ä»¥æ ¹æ®æ•°æ®åŒ…æ¥å¾—åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ä¿¡æ¯ (ç”¨åºåˆ—å·è¿›è¡Œåˆ¤æ–­ï¼Œæ‰¾client_isn + 1 çš„æ•°æ®åŒ…)ã€‚å¦‚æœç¬¬ä¸‰æ¬¡æ¡æ‰‹ ACK ç¡®è®¤åŒ…ä¸¢å¤±äº†ï¼Œä½†æ˜¯æ”¶åˆ°äº†å®¢æœç«¯å‘çš„æºå¸¦æ•°æ®çš„åŒ…ï¼Œå¹¶ä¸”åŒ…å« ACK æ ‡è®°ï¼Œ æœåŠ¡ç«¯é»˜è®¤è¡¨ç¤ºç¬¬ä¸‰æ¬¡æ¡æ‰‹æœ‰æ•ˆï¼ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚ç„¶åå¤„ç†è¯¥æ•°æ®åŒ…å¹¶ç»§ç»­æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚\nã€TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­æ¯æ¬¡æ¡æ‰‹çš„æ„ä¹‰ã€‘\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥ç¡®è®¤åŒæ–¹çš„å‘é€å’Œæ¥å—éƒ½æ˜¯æ­£å¸¸çš„\nç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯ç¡®è®¤å®¢æˆ·ç«¯å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥å—æ­£å¸¸ã€‚å®¢æˆ·ç«¯æ— æ³•ç¡®è®¤ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ç¡®è®¤è‡ªå·±å‘é€å’Œæ¥å—æ­£å¸¸ï¼ŒæœåŠ¡ç«¯æ¥å—æ­£å¸¸ã€‚æœåŠ¡ç«¯ç¡®è®¤è‡ªå·±æ¥å—æ­£å¸¸ï¼Œå®¢æœç«¯å‘é€æ­£å¸¸ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ç¡®è®¤è‡ªå·±å’Œå¯¹æ–¹ï¼Œå½¼æ­¤å‘é€å’Œæ¥å—éƒ½æ˜¯æ­£å¸¸çš„ ã€ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡å‘¢ï¼Ÿã€‘\né¿å…æµªè´¹èµ„æºï¼šå¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼Œæ— æ³•é˜»æ­¢å†å²è¿æ¥ã€‚æœåŠ¡ç«¯åœ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ä¹‹å‰ï¼Œæ²¡æœ‰é˜»æ­¢æ‰å†å²è¿æ¥ (ç¬¬ä¸€æ¬¡ SYN è¯·æ±‚åˆ°è¾¾å°±ä¼šå»ºç«‹è¿æ¥)ï¼Œä»è€Œå¯¼è‡´æœåŠ¡ç«¯å»ºç«‹äº†ä¸€ä¸ªå†å²è¿æ¥ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€äº† å¤šä¸ªSYN æŠ¥æ–‡ï¼Œå°±ä¼šä¸æ–­é‡å¤å»ºç«‹è¿æ¥ï¼Œæµªè´¹èµ„æºã€‚å¦‚æœé‡‡ç”¨å››æ¬¡æ¡æ‰‹ï¼Œå°±éœ€è¦å¤šä¸€æ¬¡ä¸å¿…è¦çš„æ“ä½œï¼Œä¹Ÿä¼šæµªè´¹èµ„æºã€‚\nã€ä¸ºä»€ä¹ˆæ¯æ¬¡å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ï¼Œåˆå§‹åŒ–çš„åºåˆ—å·è¦æ±‚ä¸ä¸€è‡´ï¼Ÿã€‘\né˜²æ­¢å†å²æŠ¥æ–‡è¢«ä¸‹ä¸€ä¸ªç›¸åŒçš„å››å…ƒç»„è¿æ¥æ¥å— é˜²æ­¢é»‘å®¢ä¼ªé€ ç›¸åŒåºåˆ—å·çš„ TCP æŠ¥æ–‡è¢«å¯¹æ–¹æ¥å— ã€ä»€ä¹ˆæ˜¯åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Ÿã€‘\nTCP ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å½“ä¸­ï¼Œ Linuxå†…æ ¸ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—æ¥ç®¡ç†è¿æ¥ã€‚\nåŠè¿æ¥é˜Ÿåˆ— (SYN Queue)ï¼š æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN è¯·æ±‚åï¼ŒåŒæ–¹æœªå®Œå…¨å»ºç«‹è¿æ¥ï¼Œä¼šå°†åŠè¿æ¥çŠ¶æ€çš„è¿æ¥æ”¾å…¥åŠè¿æ¥é˜Ÿåˆ— å…¨è¿æ¥é˜Ÿåˆ— (Accept Queue)ï¼šæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å¯¹ ACK å“åº”çš„æ—¶å€™ï¼Œæ„å‘³ç€ä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼ŒæœåŠ¡ç«¯å°†è¯¥è¿æ¥ä»åŠè¿æ¥é˜Ÿåˆ—ç§»åŠ¨åˆ°å…¨è¿æ¥é˜Ÿåˆ—ã€‚ 3. TCP ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ TCP åè®®ä¸»è¦æ˜¯é€šè¿‡å¯é ä¼ è¾“ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶å’Œè¿æ¥ç®¡ç†ï¼Œè§£å†³æ•°æ®åœ¨ä¸å¯é çš„IPç½‘ç»œä¸Šä¼ è¾“çš„é—®é¢˜ã€‚\nå¯é æ€§ï¼šTCP ç¡®ä¿æ•°æ®åŒ…åœ¨ç½‘ç»œä¼ è¾“çš„è¿‡ç¨‹å½“ä¸­ä¸ä¸¢å¤±ã€ä¸é‡å¤ï¼Œå¹¶ä¸”æŒ‰é¡ºåºåˆ°è¾¾ã€‚é€šè¿‡ç¡®è®¤-é‡ä¼ æœºåˆ¶å’Œåºåˆ—å·ï¼Œä¿è¯æ•°æ®åœ¨IPç½‘ç»œä¸Šçš„å¯é ä¼ è¾“ã€‚ æµé‡æ§åˆ¶ï¼šTCP é€šè¿‡æ»‘åŠ¨çª—å£æœºåˆ¶è°ƒèŠ‚å‘é€æ–¹(å®¢æˆ·ç«¯)çš„å‘é€é€Ÿç‡ï¼Œé˜²æ­¢æ¥æ”¶æ–¹å› ä¸ºå¤„ç†èƒ½åŠ›æˆ–è€…ç¼“å­˜æœ‰é™ï¼Œè€Œå¯¼è‡´æ•°æ®æµè¢«æ·¹æ²¡æˆ–è€…ä¸¢å¤±ã€‚ æ‹¥å¡æ§åˆ¶ï¼šTCP é€šè¿‡æ‹¥å¡é¿å…ç®—æ³• (æ¯”å¦‚æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤) æ¥é˜²æ­¢ç½‘ç»œè¿‡è½½ï¼Œç¡®ä¿ç½‘ç»œèµ„æºçš„å…¬å¹³ä½¿ç”¨å’Œç¨³å®šæ€§ã€‚ è¿æ¥ç®¡ç†ï¼š TCP æ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ï¼Œæ¥ç®¡ç†è¿æ¥ä¼šè¯ï¼Œç¡®ä¿é€šä¿¡çš„å¯é æ€§å’ŒçŠ¶æ€çš„åŒæ­¥ã€‚ 4. è¯´è¯´ TCP çš„å››æ¬¡æŒ¥æ‰‹ï¼Ÿ TCP çš„å››æ¬¡æŒ¥æ‰‹æ˜¯ç”¨æ¥å®‰å…¨å…³é—­å·²ç»å»ºç«‹çš„è¿æ¥çš„è¿‡ç¨‹ï¼Œå®ƒå¯ä»¥ç¡®ä¿åŒæ–¹éƒ½èƒ½å®Œæˆæ•°æ®ä¼ è¾“å¹¶ä¸”å®‰å…¨é‡Šæ”¾è¿æ¥èµ„æºã€‚å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š\nç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯å‘ FIN (seq_num = x) æ•°æ®åŒ…åˆ°å®¢æˆ·ç«¯ï¼Œè¡¨ç¤ºå…¶ç”³è¯·å…³é—­æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ï¼Œéšåè¿›å…¥FIN_WAIT_1 çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯è¿›è¡Œç¡®è®¤ã€‚ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ FIN (seq_num = x) æ•°æ®åŒ…ä¹‹åï¼Œå‘é€ ACK (ack_num = x + 1, seq_num = y) ç»™å®¢æˆ·ç«¯ï¼Œè¡¨ç¤ºç¡®è®¤æ”¶åˆ° FIN æ•°æ®åŒ…ï¼Œéšåè¿›å…¥ CLOSE_WAIT çŠ¶æ€ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ° ACK åŒ…ä¹‹åï¼Œè¿›å…¥FIN_WAIT_2 çŠ¶æ€ã€‚åŒæ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†æ²¡æœ‰ä¼ é€å®Œçš„æ•°æ®ä¼ ç»™å®¢æˆ·ç«¯ã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯å‘é€ FIN (seq_num = w) çš„æ•°æ®åŒ…ç»™å®¢æœç«¯ï¼Œè¯·æ±‚å…³é—­è¿æ¥ï¼Œè¿›å…¥ LAST-ACK çŠ¶æ€ã€‚ ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ° FIN æ•°æ®åŒ…ä¹‹åï¼Œå‘é€ ACK (ack_num = w + 1)æ•°æ®åŒ…ï¼Œéšåè¿›å…¥ TIME-WAIT çŠ¶æ€ã€‚æœåŠ¡ç«¯æ”¶åˆ°æ­¤æ•°æ®åŒ…ä¹‹åï¼Œè¿›å…¥ CLOSE çŠ¶æ€ã€‚å¦‚æœå®¢æˆ·ç«¯ç­‰å¾… 2MSL æ²¡æœ‰æ”¶åˆ°å›å¤çš„è¯ï¼Œè¯æ˜æœåŠ¡ç«¯å·²ç»æ­£å¸¸å…³é—­ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¹Ÿè¿›å…¥ CLOSE çŠ¶æ€ã€‚ ã€æ³¨æ„ã€‘\nå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ (è¢«åŠ¨å…³é—­çš„ä¸€æ–¹) åœ¨ CLOSE_WAIT çš„çŠ¶æ€ä¸‹ï¼Œä»ç„¶å¯ä»¥å‘é€æ•°æ®ï¼Œç›´åˆ°å®ƒä¸»åŠ¨å‘é€FIN è¯·æ±‚å…³é—­è¿æ¥ã€‚ å®¢æˆ·ç«¯(ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹) å‘å‡º FIN åï¼Œæ— æ³•å†ä¼ è¾“æ•°æ®ï¼Œåªèƒ½æ¥å—æ•°æ® åªæœ‰å®¢æˆ·ç«¯ (ä¸»åŠ¨å…³é—­çš„ä¸€æ–¹) ä¼šè¿›å…¥TIME_WAIT çŠ¶æ€ï¼Œç”¨äºç­‰å¾…æ½œåœ¨çš„é‡ä¼  FIN ã€ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‘\nä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ï¼ŒæœåŠ¡å™¨éœ€è¦æŠŠæ²¡æœ‰å‘é€å®Œçš„æ•°æ®å…¨éƒ¨ä¼ è¾“å®Œä¹‹åï¼Œå†å…³é—­è¿æ¥ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡ç«¯çš„ ACK ç¡®è®¤åŒ… å’Œ FIN è¯·æ±‚å…³é—­åŒ…ï¼Œä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œæ‰€ä»¥éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚TCP ä¸ºå…¨åŒå·¥é€šä¿¡ï¼Œå¯ä»¥åŒå‘ä¼ è¾“æ•°æ®ã€‚ä»»æ„ä¸€æ–¹æ•°æ®ä¼ è¾“ç»“æŸéƒ½å¯ä»¥å‘é€è¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å¦ä¸€æ–¹æ— æ•°æ®å†å‘é€çš„æ—¶å€™ï¼Œä¹Ÿå‘è¿æ¥é‡Šæ”¾é€šçŸ¥ï¼ŒåŒæ–¹ç¡®è®¤åˆ™å®Œå…¨å…³é—­TCPè¿æ¥ (å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ä¸€æ¥ä¸€å›ï¼Œè¯·æ±‚é‡Šæ”¾å’Œç¡®è®¤ä¸€æ¬¡)\nã€ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸‰æ¬¡æŒ¥æ‰‹ã€‘\nå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ•°æ®éœ€è¦å‘é€äº†ï¼Œå¹¶ä¸”å¼€å¯äº† TCP å»¶è¿Ÿç¡®è®¤æœºåˆ¶ (é»˜è®¤å¼€å¯)ï¼Œç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹å°±ä¼šåˆå¹¶ä¼ è¾“ (ACK å’Œ FIN)ï¼Œå°±ä¼šå‡ºç°ä¸‰æ¬¡æŒ¥æ‰‹ã€‚\n5. TCP çš„ç²˜åŒ…å’Œæ‹†åŒ…èƒ½è¯´è¯´å—ï¼Ÿ ã€å®šä¹‰ã€‘\næ‹†åŒ… / åŠåŒ…ï¼šå®¢æœç«¯ (å‘é€æ–¹) è¦å‘é€çš„åŒ…å¤ªå¤§äº†ï¼Œå¿…é¡»æ‹†åˆ†æˆå¤šä¸ªåŒ…è¿›è¡Œå‘é€ã€‚å¯¼è‡´ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯è¦è¢«æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ŒæœåŠ¡ç«¯ (æ¥æ”¶æ–¹) æ— æ³•ä¸€æ¬¡æ€§æ¥å—å®Œæ•´çš„æ•°æ®ã€‚ ç²˜åŒ…ï¼šå®¢æˆ·ç«¯ (å‘é€æ–¹)è¦å‘é€çš„åŒ…å¤ªå°äº†ï¼Œä¼šå°†å¤šä¸ªåŒ…æ”¾åœ¨æ•°æ®ç¼“å­˜åŒºï¼Œåˆå¹¶æˆä¸€ä¸ªåŒ…å‘é€å‡ºå»ã€‚æœåŠ¡ç«¯(æ¥æ”¶æ–¹)åœ¨è¯»å–çš„æ—¶å€™ï¼Œå¯èƒ½å°†å¤šä¸ªæ¶ˆæ¯æ‹¼æ¥åœ¨ä¸€èµ·ã€‚å¯¼è‡´å¤šæ¡æ¶ˆæ¯æ•°æ®ç²˜åœ¨ä¸€èµ·ï¼ŒæœåŠ¡ç«¯ (æ¥å—æ–¹) æ— æ³•åŒºåˆ†è¿™äº›æ¶ˆæ¯çš„è¾¹ç•Œã€‚ ã€åŸå› ã€‘\næ‹†åŒ… / åŠåŒ…ï¼šç”±äºç½‘ç»œä¼ è¾“ä¸­çš„ MTU æœ€å¤§ä¼ è¾“å•å…ƒé™åˆ¶æˆ–è€…å‘é€ç¼“å†²åŒºçš„å¤§å°çš„é™åˆ¶ï¼Œä¸€ä¸ªå¤§åŒ…å¿…é¡»è¢«æ‹†åˆ†ä¸ºå¤šä¸ªå°åŒ…ã€‚ ç²˜åŒ…ï¼šç”±äº TCP æ˜¯åŸºäºå­—èŠ‚æµä¼ è¾“çš„åè®®ï¼Œä¸å…³å¿ƒæ•°æ®çš„è¾¹ç•Œã€‚æ•°æ®åœ¨å‘é€æ–¹å¯èƒ½è¢«ä¸€æ¬¡æ€§å‘é€ï¼Œæ¥æ”¶æ–¹è¯»å–çš„æ—¶å€™å¯èƒ½ä¼šå°†å¤šä¸ªæ¶ˆæ¯æ‹¼æ¥åœ¨ä¸€èµ·ã€‚ ã€æ³¨æ„ã€‘ åªæœ‰ TCP åè®®æ‰ä¼šå‡ºç°ç²˜åŒ…å’Œæ‹†åŒ…çš„ç°è±¡ï¼ŒUDP åè®®ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å› ä¸º TCP åè®®çš„åŒ…æ²¡æœ‰æŠ¥æ–‡é•¿åº¦ï¼Œè€Œ UDP çš„åŒ…æœ‰æŠ¥æ–‡é•¿åº¦ã€‚ æ‰€ä»¥TCP æ˜¯æµå¼çš„ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰ç•Œé™ï¼Œè€Œ UDP æ˜¯æœ‰ç•Œé™çš„ã€‚\nã€è§£å†³æ–¹æ¡ˆã€‘\nå›ºå®šæ•°æ®åŒ…çš„é•¿åº¦ï¼šå®¢æˆ·ç«¯æ¯æ¬¡å‘é€æ•°æ®åŒ…çš„æ—¶å€™ï¼Œç»Ÿä¸€æ•°æ®åŒ…çš„é•¿åº¦ã€‚æ¯”å¦‚é‡‡ç”¨ 1024 å­—èŠ‚ï¼Œå¦‚æœæ•°æ®ä¸è¶³ï¼Œå°±é‡‡ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……ã€‚\næ·»åŠ åˆ†éš”ç¬¦ï¼šå®¢æˆ·ç«¯åœ¨æ¯ä¸ªæ•°æ®åŒ…çš„æœ«å°¾ç”¨å›ºå®šçš„åˆ†éš”ç¬¦ ï¼ˆæ¯”å¦‚ \\r\\n æˆ– ;ï¼‰ã€‚æœåŠ¡ç«¯æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œæ ¹æ®åˆ†éš”ç¬¦è¿›è¡Œåˆå¹¶æˆ–æ‹†åˆ†å¤´éƒ¨ä¸å‰åŒ…å‰©ä½™çš„éƒ¨åˆ†ï¼Œè·å–å®Œæ•´æ•°æ®åŒ…ã€‚\nå›ºå®šæ¶ˆæ¯å¤´éƒ¨å’Œæ¶ˆæ¯ä½“ï¼šé‡‡ç”¨å›ºå®šé•¿åº¦çš„å¤´éƒ¨è®°å½•æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œè¯»å–åˆ°è¶³å¤Ÿé•¿åº¦æ•°æ®ï¼Œæ‰è§†ä¸ºå®Œæ•´æ¶ˆæ¯ã€‚\nç¦ç”¨Nagleåè®®ï¼šä¸ºäº†å‡å°‘ç½‘ç»œä¸­çš„å°åŒ…æ•°é‡ï¼ŒTCP é‡‡ç”¨äº† Nagle ç®—æ³•ï¼Œå°†å°æ•°æ®å—ç¼“å†²èµ·æ¥ï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡äº†æˆ–è€…æ”¶åˆ°æ¥å—æ–¹çš„ç¡®è®¤ä¹‹åï¼Œå†å‘é€æ•°æ®åŒ…ã€‚è¯¥ç®—æ³•å¯èƒ½ä¼šå¯¼è‡´ç²˜åŒ…ç°è±¡ï¼Œæ‰€ä»¥åœ¨éœ€è¦å®æ—¶ä¼ è¾“å°æ•°æ®åŒ…çš„åœºæ™¯ï¼Œå¯ä»¥è®¾ç½® TCP_NODELAY ç¦ç”¨ Nagle ç®—æ³•ï¼Œå‡å°‘ç²˜åŒ…çš„å¯èƒ½æ€§ã€‚\n6. è¯´è¯´ TCP é˜»å¡æ§åˆ¶æ­¥éª¤ ? é˜»å¡æ§åˆ¶æœºåˆ¶ï¼šå°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„äº¤é€šç®¡ç†ï¼Œç›®çš„æ˜¯é˜²æ­¢æ•°æ®æµé‡è¿‡å¤§å¯¼è‡´ç½‘ç»œâ€œæ‹¥å µâ€ã€‚å½“ç½‘ç»œå¼€å§‹â€œæ‹¥å¡â€æ—¶ï¼ŒTCPä¼šè‡ªåŠ¨å‡æ…¢æ•°æ®å‘é€é€Ÿåº¦ï¼Œä»¥ç¡®ä¿ç½‘ç»œä¿æŒç•…é€šã€‚\næ»‘åŠ¨çª—å£æœºåˆ¶ï¼šè¿™æ˜¯ä¸€ç§æµé‡æ§åˆ¶æ–¹æ³•ï¼Œç¡®ä¿å‘é€æ–¹ä¸ä¼šå‘é€è¶…è¿‡æ¥æ”¶æ–¹å¤„ç†èƒ½åŠ›çš„æ•°æ®é‡ã€‚å¯ä»¥ç±»æ¯”ä¸ºæ°´ç®¡ä¸­çš„æ°´æµï¼Œæ»‘åŠ¨çª—å£å°±åƒä¸€ä¸ªé˜€é—¨ï¼Œè°ƒèŠ‚æ°´æµé‡ï¼Œé˜²æ­¢æ°´ç®¡æº¢å‡ºã€‚\nã€æ³¨æ„ã€‘ å‡è®¾æ‹¥å¡çª—å£ ä¸º cwnd å’Œ æµé‡æ§åˆ¶çš„æ»‘åŠ¨çª—å£ ä¸ºrwndï¼Œå½“å‰çª—å£çš„å³è¾¹ç•Œå—è¿™ä¸¤ä¸ªå€¼å…±åŒå½±å“ï¼Œåº”è¯¥å–å®ƒä»¬ä¹‹é—´çš„æœ€å°å€¼ã€‚\nçª—å£å¤§å° = min(cwnd, rwnd) ã€é˜»å¡æ§åˆ¶æ­¥éª¤ã€‘ é˜»å¡æ§åˆ¶å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œåˆ†åˆ«æ˜¯è¶…æ—¶é‡ä¼  (åŸºäºè¶…æ—¶çš„æ‹¥å¡æ§åˆ¶) å’Œå¿«é€Ÿé‡ä¼  (åŸºäºé‡å¤ ACK çš„æ‹¥å¡æ§åˆ¶)\nè¶…æ—¶é‡ä¼ ï¼šå½“å®¢æˆ·ç«¯æ£€æµ‹åˆ°æ•°æ®åŒ…ä¼ è¾“è¶…æ—¶ (æœªæ”¶åˆ° ACK ç¡®è®¤)ï¼Œä¼šè®¤ä¸ºç½‘ç»œå‡ºç°ä¸¥é‡é˜»å¡ã€‚æ­¤æ—¶ï¼ŒTCPä¼šé‡‡å–æœ€ä¿å®ˆçš„ç­–ç•¥ï¼šå°†æ‹¥å¡çª—å£cwnd é‡ç½®ä¸º 1ï¼Œå¹¶é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µï¼Œ åŒæ—¶å°†æ…¢å¯åŠ¨é˜ˆå€¼ssthresh è®¾ç½®æœªå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠ å¿«é€Ÿé‡ä¼ ï¼šå½“å®¢æˆ·ç«¯è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤çš„ ACK (æ¯”å¦‚æœåŠ¡ç«¯æ£€æµ‹åˆ°æŠ¥æ–‡æ®µå¤±åºçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¯¥æœºåˆ¶)ï¼Œè¡¨æ˜ç½‘ç»œä¸­å¯èƒ½åªå‘ç”Ÿäº†å•ä¸ªæ•°æ®åŒ…ä¸¢å¤±è€Œéå…¨å±€é˜»å¡ã€‚æ­¤æ—¶ï¼ŒTCPä¼šå‡ºå‘å¿«é€Ÿé‡ä¼  (ç«‹å³é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…) å’Œ å¿«é€Ÿæ¢å¤ (è°ƒæ•´æ‹¥å¡çª—å£ cwnd ä¸º æ…¢å¯åŠ¨é˜ˆå€¼ + 3 ssthred + 3ï¼Œé¿å…å®Œå…¨é€€å›åˆ°æ…¢å¯åŠ¨)ã€‚ TCP åè®®çš„æ‹¥å¡æ§åˆ¶ä¸»è¦é€šè¿‡äº”ä¸ªç®—æ³•æ¥å®ç°ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€è¶…æ—¶é‡ä¼ ã€å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ã€‚\næ…¢å¯åŠ¨ï¼šå‘é€æ–¹å¼€å§‹è®¾ç½®ä¸€ä¸ªè¾ƒå°çš„æ‹¥å¡çª—å£å¤§å°ï¼Œåœ¨æ¯æ”¶åˆ°ä¸€ä¸ªæ–°çš„æŠ¥æ–‡æ®µçš„ ACK ç¡®è®¤ä¹‹åï¼Œæ¯å½“æˆåŠŸå‘é€è·Ÿæ‹¥å¡çª—å£å¤§å°ç­‰é‡çš„æ•°æ®åï¼Œæ‹¥å¡çª—å£å¤§å°å°±ä¼šç¿»å€ã€‚æ‹¥å¡çª—å£æŒ‰ç…§æŒ‡æ•°æ–¹å¼å¢é•¿ï¼Œç›´åˆ°æ‹¥å¡çª—å£ cwnd è¾¾åˆ° æ…¢å¯åŠ¨é—¨é™ ssthresh æ‹¥å¡é¿å…ï¼šå½“æ‹¥å¡çª—å£å¤§å° cwnd è¾¾åˆ° æ…¢å¯åŠ¨é—¨é™ ssthresh ä¹‹åï¼Œå°±è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚æ¯å½“æˆåŠŸå‘é€è·Ÿæ‹¥å¡çª—å£å¤§å°ç­‰é‡çš„æ•°æ®ä¹‹åï¼Œæ‹¥å¡çª—å£å¤§å°å°±ä¼šå¢åŠ ä¸€ä¸ªæŠ¥æ–‡æ®µçš„å¤§å°ï¼Œä»¥çº¿æ€§çš„æ–¹å¼å¢é•¿ã€‚ æ‹¥å¡å‘ç”Ÿï¼šéšç€å‘é€é€Ÿç‡æ…¢æ…¢åŠ å¿«ï¼Œå¯èƒ½ä¼šå‡ºç°ç½‘ç»œé˜»å¡ç°è±¡ï¼Œå‘ç”Ÿæ•°æ®åŒ…ä¸¢å¤±ã€‚æ­¤æ—¶ï¼Œå°±éœ€è¦é‡ä¼ æ•°æ®ã€‚é‡ä¼ çš„æœºåˆ¶æœ‰ä¸¤ç§ï¼Œè¶…æ—¶é‡ä¼ å’Œå¿«é€Ÿé‡ä¼ ã€‚ è¶…æ—¶é‡ä¼ ï¼šå½“å‘ç”Ÿè¶…æ—¶é‡ä¼ çš„æ—¶å€™ï¼Œæ…¢å¯åŠ¨é—¨é™ssthreshä¼šè®¾ç½®ä¸ºæ‹¥å¡çª—å£çš„ä¸€åŠï¼Œå¹¶ä¸”å°†æ‹¥å¡çª—å£æ¢å¤ä¸ºåˆå§‹å€¼ã€‚éšåé‡æ–°å¼€å§‹æ…¢å¯åŠ¨ï¼Œå‘é€é€Ÿç‡å°±ç¬é—´ä¸‹é™äº†ã€‚ å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ï¼šå½“å®¢æˆ·ç«¯è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤çš„ ACK (æ¯”å¦‚æœåŠ¡ç«¯æ£€æµ‹åˆ°æŠ¥æ–‡æ®µå¤±åºçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¯¥æœºåˆ¶)ï¼Œå°±è®¤ä¸ºå‘é€äº†ä¸¢åŒ…ã€‚æ­¤æ—¶ï¼Œæ‹¥å¡çª—å£ä¼š cwnd å‡å°‘åˆ°åŸæ¥çš„ä¸€åŠï¼Œç„¶åæ…¢å¯åŠ¨é—¨é™ ssthresh è®¾ç½®ä¸ºå‡å°‘åçš„æ‹¥å¡çª—å£çš„å¤§å° cwndï¼Œç„¶åè¿›å…¥å¿«é€Ÿæ¢å¤é˜¶æ®µã€‚æ­¤æ—¶ï¼Œä¼šæŠŠæ‹¥å¡æ§åˆ¶çª—å£+3 (cwnd + 3)ï¼Œ 3 çš„æ„æ€æ˜¯ç¡®è®¤æœ‰ 3 ä¸ªæ•°æ®åŒ…æ”¶åˆ°äº†ã€‚ç„¶åé‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡ï¼Œå¦‚æœæ”¶åˆ°é‡ä¼ ä¸¢å¤±æŠ¥æ–‡çš„ACK ä¹‹åï¼Œå°†æ‹¥å¡çª—å£è®¾ç½®ä¸ºæ…¢å¯åŠ¨é—¨é™ï¼Œç›´æ¥è¿›å…¥æ‹¥å¡é¿å…ï¼Œç»§ç»­å¢å¤§å‘é€é€Ÿç‡ã€‚ 7. å¸¸è§çš„ HTTP çŠ¶æ€ç æœ‰å“ªäº›ï¼Ÿ å¸¸è§çš„ HTTP çŠ¶æ€åˆ†ä¸ºäº”å¤§ç±»ï¼Œæœ‰ä¸‰ä½æ•°å­—ï¼Œä¸€èˆ¬ç”¨ç¬¬ä¸€ä½æ•°å­—æ¥åŒºåˆ†ç±»åˆ«ã€‚\n1xx ä¿¡æ¯çŠ¶æ€ç  : åè®®å¤„ç†ä¸­çš„ä¸­é—´çŠ¶æ€ï¼Œè¿˜æœ‰åç»­æ“ä½œ 100 Continueï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚çš„åˆæ­¥éƒ¨åˆ†ï¼Œå®¢æˆ·ç«¯éœ€è¦ç»§ç»­è¯·æ±‚ 101 Switching Protocolsï¼šæœåŠ¡å™¨åŒæ„åˆ‡æ¢åè®®ï¼Œæ¯”å¦‚ï¼šä» HTTP åè®®åˆ‡æ¢åˆ° WebSocket åè®® 2xx æˆåŠŸçŠ¶æ€ç ï¼šæœåŠ¡å™¨æˆåŠŸå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ â­ 200 OK: è¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨è¿”å›æ‰€è¯·æ±‚çš„èµ„æºæˆ–æ•°æ® 201 Created: è¯·æ±‚æˆåŠŸå¹¶åˆ›å»ºæ–°çš„èµ„æºï¼Œä¸€èˆ¬ç”¨äº POST è¯·æ±‚ 202 Acceptedï¼šæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¿˜æœªå¤„ç† â­ 204 Not Contentï¼šè¯·æ±‚æˆåŠŸä½†æ˜¯æœåŠ¡å™¨ä¸è¿”å›ä»»ä½•å†…å®¹ï¼Œå¸¸ç”¨äºåˆ é™¤ â­ 206 Partial Contentï¼šè¯·æ±‚æˆåŠŸä½†æœåŠ¡å™¨è¿”å›éƒ¨åˆ†èµ„æºï¼Œä¸€èˆ¬ç”¨äºHTTPåˆ†å—ä¸‹è½½æˆ–è€…æ–­ç‚¹ç»­ä¼  3xx é‡å®šå‘çŠ¶æ€ç ï¼šå®¢æˆ·ç«¯ç”¨æ–°çš„ URL é‡æ–°å‘é€è¯·æ±‚è·å–èµ„æº â­ 301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼Œèµ„æºå·²ç»ç§»åŠ¨åˆ°æ–°çš„ URLï¼Œé€šçŸ¥å®¢æˆ·ç«¯ç”¨æ–°çš„ URL è®¿é—® â­ 302 Foundï¼šèµ„æºä¸´æ—¶ç§»åŠ¨åˆ°æ–°çš„ URLï¼Œ å®¢æˆ·ç«¯åº”è¯¥ç»§ç»­ä½¿ç”¨åŸæ¥çš„ URLã€‚å…è®¸æµè§ˆå™¨å°† POST è¯·æ±‚è½¬æ¢ä¸º GET 303 See Otherï¼šå’Œ 302 æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æº 304 No Modifiedï¼šç¼“å­˜é‡å®šå‘ï¼Œèµ„æºæ²¡æœ‰è¢«ä¿®æ”¹ã€‚å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜èµ„æºï¼Œå‡å°‘å¸¦å®½æ¶ˆè€— 307 Temporary Redirectï¼šä¸´æ—¶é‡å®šå‘ï¼Œå’Œ 302 çš„å«ä¹‰å‡ ä¹å·®ä¸å¤šã€‚ä½†æ˜¯ 307 éœ€è¦ä¿è¯é‡å®šå‘æ—¶è¯·æ±‚æ–¹æ³•å’Œä¸»ä½“ä¸å˜ã€‚ 4xx å®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯çŠ¶æ€ç ï¼šå®¢æˆ·ç«¯å‘é€çš„æŠ¥æ–‡æœ‰è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç† â­ 400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡æ— æ•ˆæˆ–è€…è¯­æ³•é”™è¯¯ 401 Unauthorized: è¯·æ±‚éœ€è¦èº«ä»½éªŒè¯ï¼Œå®¢æˆ·ç«¯æœªæä¾›æœ‰æ•ˆçš„å‡­è¯ â­ 403 Forbiddenï¼šæœåŠ¡å™¨ç†è§£è¯¥è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œï¼Œä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰æƒé™è®¿é—® â­ 404 Not Foundï¼š è¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°ï¼Œæ¯”å¦‚ URL çš„ä¸€éƒ¨åˆ†å†™é”™äº† 409 Conflictï¼š è¯·æ±‚çš„èµ„æºå’ŒæœåŠ¡å™¨çš„å½“å‰çŠ¶æ€å­˜åœ¨å†²çª 5xx æœåŠ¡ç«¯é”™è¯¯çŠ¶æ€ç ï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„æŠ¥æ–‡æ­£ç¡®ï¼Œä½†æ˜¯æœåŠ¡å™¨å¤„ç†çš„æ—¶å€™å†…éƒ¨å‘é€é”™è¯¯ã€‚ â­ 500 Internal Server Errorï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ï¼Œè€Œä¸”ä¸çŸ¥é“æ˜¯ä»€ä¹ˆé”™è¯¯ 501 Not Implementedï¼šè¿˜ä¸æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚ï¼Œç±»ä¼¼äºâ€œå³å°†å¼€ä¸šï¼Œæ•¬è¯·æœŸå¾…â€çš„æ„æ€ 502 Bad Gatewayï¼šæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº”ã€‚æ¯”å¦‚è°ƒç”¨å…¶ä»–ç½‘ç«™çš„API å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ 503 Service Unavailableï¼šæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºå¤„ç†ç»´æŠ¤ä¸­ï¼Œæˆ–è€…æœåŠ¡è¿‡è½½ 8. HTTP è¯·æ±‚åŒ…å«å“ªäº›å†…å®¹ï¼Œè¯·æ±‚å¤´å’Œè¯·æ±‚ä½“æœ‰å“ªäº›ç±»å‹ï¼Ÿ ã€è¯·æ±‚æŠ¥æ–‡ã€‘ è¯·æ±‚æŠ¥æ–‡ä¸»è¦åŒ…æ‹¬å››ä¸ªéƒ¨åˆ†ï¼Œè¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´ï¼Œç©ºè¡Œ(åˆ†å‰²è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“)ï¼Œè¯·æ±‚ä½“ã€‚\nè¯·æ±‚è¡Œï¼šåŒ…å«è¯·æ±‚æ–¹æ³• (GET / POST) ã€è¯·æ±‚è·¯å¾„ /doc/test.html) å’Œ HTTP ç‰ˆæœ¬ (HTTP/1.1) è¯·æ±‚å¤´ï¼šåŒ…å«å„ç§é”®å€¼å¯¹ï¼Œå®¢æˆ·ç«¯ç¯å¢ƒ(User-Agent)ã€è¯·æ±‚å†…å®¹ å’Œè®¤è¯ä¿¡æ¯ (Token) ç­‰ç­‰ ç©ºè¡Œï¼šç”¨äºåˆ†å‰²è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ è¯·æ±‚ä½“ï¼šåªåœ¨ POST å’Œ PUT æ–¹æ³•ä¸­å­˜åœ¨ï¼ŒåŒ…å«éœ€è¦å‘é€åˆ°æœåŠ¡å™¨çš„ä¿¡æ¯ ã€å“åº”æŠ¥æ–‡ã€‘ å“åº”æŠ¥æ–‡ä¸»è¦åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼ŒçŠ¶æ€è¡Œï¼Œå“åº”å¤´ï¼Œç©ºè¡Œï¼Œå“åº”ä½“\nçŠ¶æ€è¡Œï¼šåŒ…å« HTTP çš„ç‰ˆæœ¬ (HTTP/1.1)ã€çŠ¶æ€ç  (200) å’ŒçŠ¶æ€æè¿° (OK) å“åº”å¤´ï¼šåŒ…å«æœåŠ¡å™¨è¿”å›çš„å„ç§é”®å€¼å¯¹ï¼Œç”¨äºæè¿°å“åº”çš„å…ƒä¿¡æ¯ï¼Œå¸¸è§çš„å“åº”å¤´å¦‚ä¸‹ Content-Typeï¼šå“åº”é¢å‘¢ç»’çš„ç±»å‹, ä¸€èˆ¬ä¸º text/html / application/json Content-Lengthï¼š å“åº”å†…å®¹çš„å­—èŠ‚é•¿åº¦ ç©ºè¡Œï¼šç”¨äºé£æ ¼å“åº”å¤´å’Œå“åº”ä½“ å“åº”ä½“ï¼šåŒ…å«æœåŠ¡å™¨è¿”å›çš„å®é™…å†…å®¹ï¼Œæ¯”å¦‚ HTMLæ–‡æ¡£ã€å›¾ç‰‡ã€JSONæ•°æ®ç­‰ ã€HTTP å¸¸è§è¯·æ±‚æ–¹æ³•ã€‘\nGETï¼šè·å–æŒ‡å®šçš„èµ„æº POST: ä¼ è¾“å®ä½“æ•°æ®ï¼ŒPOST ä¸€èˆ¬ç”¨æ¥ä¼ æ•°æ®ï¼ŒGET ä¸€èˆ¬ç”¨æ¥è·å–æ•°æ® PUT: ä¸Šä¼ æ–‡ä»¶ï¼Œç”±äºè‡ªèº«æ²¡æœ‰éªŒè¯æœºåˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ DELETE: åˆ é™¤æ–‡ä»¶ï¼Œå’Œ PUT åŠŸèƒ½æ­£å¥½ç›¸åï¼ŒåŒæ ·æ²¡æœ‰éªŒè¯æœºåˆ¶ 9. HTTP ä¸­ GET å’Œ POST çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç‰¹æ€§ GET POST ä¸»è¦ç”¨é€” è·å–æœåŠ¡ç«¯çš„èµ„æº å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºåˆ›å»ºæˆ–è€…ä¿®æ”¹ å‚æ•°ä¼ é€’ å‚æ•°éƒ½åœ¨ URL ä¸­ å‚æ•°éƒ½åœ¨è¯·æ±‚ä½“å½“ä¸­ï¼ŒURL ä¹Ÿå¯ä»¥æ”¾å‚æ•° å®‰å…¨æ€§ å‚æ•°å¯è§ï¼Œæ•°æ®å®¹æ˜“æš´éœ²åœ¨æµè§ˆå™¨çš„å†å²è®°å½•ã€æ—¥å¿—å’Œç¼“å­˜é‡Œé¢ï¼Œä¸é€‚åˆä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼Œä¸å®‰å…¨ æ•°æ®æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œç›¸å¯¹å®‰å…¨ï¼Œä½†æ˜¯éœ€è¦HTTPSæ‰èƒ½ä¿è¯æ•°æ®åŠ å¯†ä¼ è¾“ (ä¸ç„¶ä¼šè¢«æŠ“åŒ…) å¹‚ç­‰æ€§ åªè¯»æ“ä½œï¼Œå¤šæ¬¡è¯·æ±‚ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ ä¿®æ”¹æ“ä½œï¼Œå¤šæ¬¡è¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´é‡å¤åˆ›å»ºèµ„æºï¼Œæˆ–è€…æ‰§è¡Œå¤šæ¬¡ç›¸åŒæ“ä½œ é•¿åº¦é™åˆ¶ è¯·æ±‚å‚æ•°åœ¨ URL ä¸­ï¼Œæµè§ˆå™¨å¯¹ URL æœ‰é•¿åº¦é™åˆ¶ è¯·æ±‚å‚æ•°æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œç†è®ºä¸Šæ¥è¯´æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚ä½†ä¸€èˆ¬æœåŠ¡å™¨å¯¹è¯·æ±‚ä½“é•¿åº¦æœ‰é…ç½®é™åˆ¶ï¼Œæ¯”å¦‚ Nginx é»˜è®¤é™åˆ¶ä¸º 1MB ç¼“å­˜æœºåˆ¶ æµè§ˆå™¨å’ŒCDNéƒ½ä¼šç¼“å­˜ GET è¯·æ±‚çš„æ•°æ®ï¼Œç”¨äºå‡å°‘æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæ¯”å¦‚å›¾ç‰‡ã€é™æ€é¡µé¢ç­‰ä¸ä¼šé¢‘ç¹æ”¹åŠ¨çš„é™æ€èµ„æº ä¸€èˆ¬ä¸ä¼šç¼“å­˜ POST è¯·æ±‚ï¼Œå› ä¸ºå®ƒé€šå¸¸å¯¹æœåŠ¡å™¨æ•°æ®ä¼šäº§ç”Ÿå½±å“ ã€æ³¨æ„ã€‘ å¹‚ç­‰æ„å‘³ç€ç›¸åŒçš„è¯·æ±‚é‡å¤å¤šæ¬¡ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€åªä¼šæ”¹å˜ä¸€æ¬¡ï¼Œä¸ä¼šç´¯è®¡å¤šæ¬¡å‰¯ä½œç”¨ï¼Œè€Œéå¹‚ç­‰è¯·æ±‚æ¯æ¬¡è°ƒç”¨å¯èƒ½å¼•èµ·çŠ¶æ€çš„å¤šæ¬¡æ”¹å˜\nã€GET è¯·æ±‚ä¸€å®šæ˜¯å¹‚ç­‰çš„å—ï¼Ÿã€‘\nä¸ä¸€å®šï¼Œå› ä¸ºå¦‚æœæœ‰å¼€å‘è€…ä¸éµå¾ªè§„èŒƒå»å¤„ç†è¯·æ±‚ï¼Œé‡‡ç”¨ GET æ–¹å¼æ¥æ–°å¢æ•°æ®ï¼Œè¿™æ—¶å€™ GET è¯·æ±‚å°±ä¸æ˜¯å¹‚ç­‰çš„äº†ã€‚æ›¾ç»æœ‰ä¸ªç¬‘è¯ï¼Œæœ‰äººå†™äº†ä¸ªåšå®¢ï¼Œåˆ é™¤åšå®¢ç”¨çš„æ˜¯ GET è¯·æ±‚ï¼Œä»–è§‰å¾—æ²¡äººè®¿é—®å°±è¿é‰´æƒéƒ½æ²¡åšã€‚ç„¶å Google æœåŠ¡å™¨çˆ¬è™«çˆ¬äº†ä¸€éï¼Œä»–æ‰€æœ‰åšæ–‡å°±æ²¡äº†\u0026hellip;\n10. HTTP 1.0ã€HTTP 1.1ã€HTTP 2.0ã€HTTP 3.0 åŒºåˆ«ï¼Ÿ ã€åŒºåˆ«ã€‘\nç‰¹æ€§ HTTP 1.0 HTTP 1.1 HTTP 2.0 HTTP 3.0 è¿æ¥æ–¹å¼ çŸ­è¿æ¥ æŒä¹…è¿æ¥ æŒä¹…è¿æ¥ QUIC è¿æ¥ (åŸºäºUDP) ä¼ è¾“æ–¹å¼ æ–‡æœ¬ æ–‡æœ¬ äºŒè¿›åˆ¶ äºŒè¿›åˆ¶ å¤šè·¯å¤ç”¨ ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ æ”¯æŒ æœåŠ¡å™¨æ¨é€ ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒï¼ˆä¸»åŠ¨æ¨é€èµ„æºï¼‰ æ”¯æŒï¼ˆå¢å¼ºèµ„æºæ¨é€æ•ˆç‡ï¼‰ å¤´éƒ¨å‹ç¼© ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ (HPACK) æ”¯æŒ (QPACK) å®‰å…¨æ€§ æ˜æ–‡ä¼ è¾“ï¼ˆéœ€ HTTPS åŠ å¯†ï¼‰ æ˜æ–‡ä¼ è¾“ï¼ˆéœ€ HTTPS åŠ å¯†ï¼‰ å¼ºåˆ¶å»ºè®® HTTPS é»˜è®¤é›†æˆ TLS 1.3ï¼Œ æ”¯æŒHTTPS æ˜¯å¦è§£å†³é˜Ÿå¤´é˜»å¡é—®é¢˜ å­˜åœ¨ï¼ˆå•è¯·æ±‚é˜»å¡ï¼‰ éƒ¨åˆ†ç¼“è§£ï¼ˆç®¡é“åŒ–è¯·æ±‚ï¼Œä½†å“åº”ä»éœ€é¡ºåºæ¥æ”¶ï¼‰ åŸºæœ¬è§£å†³ï¼ˆTCP è¿æ¥å†…å¤šè·¯å¤ç”¨ï¼‰ å½»åº•è§£å†³ï¼ˆQUIC åè®®æ˜¯åŸºäºUDPåè®®ï¼Œæ²¡æœ‰é˜»å¡é˜Ÿåˆ—ï¼‰ å…¸å‹æ”¹è¿› å®šä¹‰äº†åŸºç¡€ HTTP åè®® é•¿è¿æ¥ã€æ–­ç‚¹ç»­ä¼ ã€Host å¤´åŸŸ äºŒè¿›åˆ¶åè®®ã€å¤´éƒ¨å‹ç¼©ã€å¤šè·¯å¤ç”¨ åŸºäº UDP çš„ QUIC åè®®ã€é›¶ RTT è¿æ¥ã€æŠ—ç½‘ç»œåˆ‡æ¢ é€‚ç”¨åœºæ™¯ é™æ€ç½‘é¡µã€ç®€å•æ–‡ä»¶ä¸‹è½½ ä¸­å°å‹ç½‘ç«™ã€å†…éƒ¨ç®¡ç†ç³»ç»Ÿ (éé«˜å¹¶å‘ç½‘ç«™) é«˜å¹¶å‘ç½‘ç«™(æ·˜å®/å¾®åš)ã€åŠ¨æ€åŠ è½½çš„å•é¡µåº”ç”¨ã€è§†é¢‘æµåª’ä½“ å®æ—¶é€šä¿¡(è§†é¢‘ä¼šè®®/åœ¨çº¿æ¸¸æˆ)ã€ç§»åŠ¨ç«¯åº”ç”¨(5G/å¼±ç½‘ç¯å¢ƒ)ã€ç‰©è”ç½‘è®¾å¤‡é€šä¿¡ ã€HTTP/1.0ã€‘\næ— çŠ¶æ€ã€çŸ­è¿æ¥ï¼šæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹æ–°çš„TCPè¿æ¥ï¼Œå¤„ç†å®Œä¹‹åç«‹å³å…³é—­ï¼Œå¯¼è‡´å¼€é”€æ¯”è¾ƒå¤§ é˜Ÿå¤´é˜»å¡ï¼šæ¯ä¸ªè¯·æ±‚å¿…é¡»æŒ‰ç…§é¡ºåºä¾æ¬¡å¤„ç†ï¼Œå‰é¢çš„è¯·æ±‚è¿˜æ²¡å®Œæˆï¼Œåé¢çš„è¯·æ±‚åªèƒ½ç­‰å¾…ï¼Œå¹¶å‘æ•ˆç‡ä¸é«˜ ã€HTTP/1.1ã€‘\næŒä¹…è¿æ¥ï¼šå¼•å…¥äº†è¿æ¥å¤ç”¨ï¼ˆKeep-Alive)ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œå°±ä¿æŒTCPè¿æ¥çŠ¶æ€ã€‚å‡å°‘TCPæ¡æ‰‹å¼€é”€ ç®¡é“ä¼ è¾“ï¼šåœ¨ä¸€ä¸ªTCPé“¾æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å‘é€å¤šä¸ªè¯·æ±‚ï¼Œåªè¦ä¸€ä¸ªè¯·æ±‚å‘å‡ºäº†ï¼Œä¸ç”¨ç­‰å¾…å“åº”ï¼Œç›´æ¥å‘é€ç¬¬äºŒä¸ªè¯·æ±‚ã€‚è¯¥ç­–ç•¥å¯ä»¥å‡å°‘æ•´ä½“çš„å“åº”æ—¶é—´ã€‚ é˜Ÿå¤´é˜»å¡ï¼šå½“é¡ºåºå‘é€çš„è¯·æ±‚åºåˆ—ä¸­çš„ä¸€ä¸ªè¯·æ±‚ï¼Œå¯èƒ½å› ä¸ºæŸç§åŸå› è¢«é˜»å¡çš„æ—¶å€™ï¼Œåé¢æ’é˜Ÿçš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸€åŒè¢«é˜»å¡äº†ï¼Œä¼šå¯¼è‡´å®¢æˆ·ç«¯ä¸€è‡´è¯·æ±‚ä¸åˆ°æ•°æ®ã€‚ HOSTå­—æ®µï¼šå¯ä»¥åœ¨åŒä¸€ä¸ªIPåœ°å€ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿä¸»æœº æ–­ç‚¹ç»­ä¼ ï¼šæ”¯æŒæ–‡ä»¶ä¼ è¾“ä¸­æ–­åï¼Œä»æ–­ç‚¹å‡ºç»§ç»­ä¼ è¾“ã€‚ ã€HTTP/1.0 å’Œ HTTP/1.1 ç¼“å­˜æœºåˆ¶åŒºåˆ«ã€‘\nHTTP/1.0 ç¼“å­˜æœºåˆ¶ï¼šåŸºäºæ—¶é—´çš„ç¼“å­˜æœºåˆ¶ï¼Œç”¨è¯·æ±‚å¤´ä¸­çš„ If-Modified-Since å’Œå“åº”å¤´ä¸­çš„ Last-Modified å­—æ®µå®ç°\nå“åº”å¤´ä¸­çš„ Last-Modified ï¼šè¡¨ç¤ºå“åº”èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´\nè¯·æ±‚å¤´ä¸­çš„ If-Modified-Since ï¼šè¯·æ±‚çš„æ—¶å€™ä¿®æ”¹ä¸ºå“åº”å¤´çš„ Last-Modified æ—¶é—´ã€‚å½“æœåŠ¡å™¨å—åˆ°è¯¥è¯·æ±‚ä¹‹åï¼Œä¼šå¯¹æ¯”è¯·æ±‚èµ„æºæœ€åä¿®æ”¹çš„æ—¶é—´Last-Modifiedã€‚ å¦‚æœä» If-Modified-Since æ²¡æœ‰ä¿®æ”¹ï¼Œç›´æ¥å“åº” 304 Not Modified èµ°ç¼“å­˜ã€‚å¦‚æœå·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œè¿”å›æœ€æ–°èµ„æº, å“åº” 200 OKã€‚\nHTTP/1.1 ç¼“å­˜æœºåˆ¶ï¼šåŸºäºå”¯ä¸€æ ‡è¯†çš„ç¼“å­˜æœºåˆ¶ï¼Œç”¨è¯·æ±‚å¤´ä¸­çš„ If-None-Match å­—æ®µå’Œå“åº”å¤´ä¸­çš„ ETag å­—æ®µå®ç°\nå“åº”å¤´ä¸­çš„ ETagï¼šè¡¨ç¤ºå“åº”èµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªid è¯·æ±‚å¤´ä¸­çš„ If-None-Match ï¼šå½“èµ„æºè¿‡æœŸçš„æ—¶å€™ï¼Œæµè§ˆå™¨å‘ç°å“åº”å¤´é‡Œé¢æœ‰ ETagï¼Œå†æ¬¡æƒ³æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œå°†If-None-Match è®¾ä¸º Etag çš„å€¼ã€‚æœåŠ¡å™¨å—åˆ°è¯·æ±‚åè¿›è¡Œå¯¹æ¯”ï¼Œèµ„æºæ²¡å˜åŒ–ï¼Œè¿”å›304ã€‚èµ„æºæœ‰å˜åŒ–ï¼Œè¿”å›ä¿¡çš„èµ„æºï¼Œå“åº”200 ã€HTTP/2.0ã€‘\nå¤šè·¯å¤ç”¨ï¼šæ”¯æŒä¸€ä¸ªTCPè¿æ¥ä¸­ï¼Œä¼ è¾“å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œè§£å†³äº† HTTP/1.x ä¸­çš„ä¸²è¡Œé—®é¢˜\näºŒè¿›åˆ¶å¸§ï¼šä½¿ç”¨äºŒè¿›åˆ¶æ¡¢æ ¼å¼ï¼Œå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§åˆ†ç¦»ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚å…¶ä¸­æ¡¢æ•°æ®(Data Frame)ï¼Œä¼šè¢«å¤´éƒ¨å‹ç¼©\nå¤´éƒ¨å‹ç¼© (HPACK): é€šè¿‡é™æ€è¡¨å’ŒåŠ¨æ€è¡¨å¯¹HTTPå¤´éƒ¨è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘å¸¦å®½å ç”¨ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»´æŠ¤åŒä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å‚¨è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå‘é€åå€ŸåŠ©ç´¢å¼•å·æå‡é€Ÿåº¦ã€‚\næœåŠ¡å™¨æ¨é€ï¼šæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€èµ„æºï¼Œå‡å°‘è¯·æ±‚å»¶è¿Ÿã€‚HTTP/1.1 éœ€è¦ä»æœåŠ¡å™¨è·å–HTMLæ–‡ä»¶ï¼Œå¦‚æœè¿˜éœ€è¦è·å– CSSæ¸²æŸ“é¡µé¢ï¼Œéœ€è¦å†æ¬¡å‘èµ·è·å– CSSæ–‡ä»¶çš„è¯·æ±‚ï¼Œå°±éœ€è¦ä¸¤æ¬¡æ¶ˆæ¯å¾€è¿”ã€‚HTTP/2.0 æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€HTMLå’ŒCSSæ–‡ä»¶ä¿¡æ¯ï¼ŒåŒæ–¹å»ºç«‹ Streamã€‚\nã€æ³¨æ„ã€‘ å®¢æˆ·ç«¯çš„ Stream å¿…é¡»æ˜¯å¥‡æ•°å·ã€æœåŠ¡å™¨å»ºç«‹çš„ Stream å¿…é¡»æ˜¯å¶æ•°å·\nã€HTTP/3.0ã€‘\nRTT: Round Trip Time å¾€è¿”æ—¶é—´ RTO: Retransmission Timeout è¶…æ—¶é‡ä¼ æ—¶é—´ QUIC åè®®ï¼šåŸºäºUDPåè®®ï¼ŒQUIC é€šè¿‡è‡ªèº«å®ç°å¯é ä¼ è¾“ï¼Œå‡å°‘äº† RTTã€‚å‚è€ƒææ–™ï¼šQUICå¦‚ä½•å®ç°å¯é ä¼ è¾“\nå¤šè·¯å¤ç”¨ï¼šåœ¨ä¸€ä¸ª QUIC åè®®ä¸Šï¼Œå¯ä»¥åŒæ—¶ä¼ è¾“å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œå¹¶æ”¯æŒæµä¼˜å…ˆçº§ã€‚QUIC å½“ä¸­æ¯ä¸ª stream ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå‡å¦‚å•ä¸ª stream ä¸¢å¤±äº†ï¼Œä¸ä¼šå½±å“å…¶ä»–çš„streamï¼Œå½»åº•è§£å†³äº†é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå› ä¸ºUDPæ˜¯æ— åºäº¤ä»˜çš„ï¼Œæ•°æ®ä¸ä¸€å®šæŒ‰ç…§å‘é€æ—¶çš„é¡ºåºåˆ°è¾¾ã€‚\næ›´å¿«çš„è¿æ¥å»ºç«‹ï¼šæ¨¡æ‹ŸTCPçš„ä¸‰æ¬¡æ¡æ‰‹æ“ä½œï¼Œä½†æ˜¯æ¡æ‰‹è¿‡ç¨‹åªéœ€è¦ä¸€ä¸ªå¾€è¿”æ—¶é—´RTT ï¼Œç”¨äºç¡®è®¤åŒæ–¹çš„è¿æ¥IDã€‚QUIC å†…éƒ¨åŒ…å«äº† TLS/1.3 ï¼Œå…¶å¸§æºå¸¦äº† TLS è®°å½•, æ‰€ä»¥ä¸éœ€è¦ TLS æ¡æ‰‹ã€‚\n11. TCP/IP å››å±‚æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ TCP/IP å››å±‚æ¨¡å‹æ˜¯ä¸€ä¸ªåˆ†å±‚ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œè¿™å››å±‚ä»åº•å‘ä¸Šåˆ†åˆ«æ˜¯ï¼šç½‘ç»œæ¥å£å±‚ (ç‰©ç†å±‚+æ•°æ®é“¾è·¯å±‚)ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚ (ä¼šè¯å±‚+è¡¨ç¤ºå±‚+åº”ç”¨å±‚)\nç½‘ç»œæ¥å£å±‚ï¼šè´Ÿè´£æ•°æ®æ¡¢çš„å°è£…å’Œç‰©ç†ä¼ è¾“ (æ¯”å¦‚ä»¥å¤ªç½‘ã€WIFIã€PPPæ‹¨å·åè®®ç­‰) ç½‘ç»œå±‚ï¼šè´Ÿè´£æ•°æ®åŒ…çš„è·¯ç”±å’Œå¯»å€ (æ¯”å¦‚ IPã€ARPã€NATç­‰åè®®) ä¼ è¾“å±‚ï¼šè´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡ (æ¯”å¦‚TCPã€UDP) åº”ç”¨å±‚ï¼šè´Ÿè´£ä¸ºç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡ (æ¯”å¦‚ HTTPã€åŸŸåæœåŠ¡å™¨ DNSã€é‚®ä»¶ SMTPå’ŒPOP3ã€FTPã€SSHã€åŠ¨æ€IPåœ°å€åˆ†é… DHCP) ã€åº”ç”¨å±‚ã€‘ æä¾›ä¸¤ä¸ªç»ˆç«¯è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºä¹‹é—´ä¿¡æ¯äº¤æ¢çš„æœåŠ¡ (æ¯”å¦‚ä¸¤ä¸ªQQå‘æ¶ˆæ¯)ï¼Œå®šä¹‰äº†ä¿¡æ¯äº¤æ¢çš„æ ¼å¼ï¼Œæ¶ˆæ¯ä¼šäº¤ç»™ä¸‹ä¸€ä¸ªä¼ è¾“å±‚æ¥ä¼ è¾“\nã€ä¼ è¾“å±‚ã€‘ è´Ÿè´£å°†ä¸¤å°è®¾å¤‡è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œåº”ç”¨è¿›ç¨‹åˆ©ç”¨è¯¥æœåŠ¡ä¼ é€åº”ç”¨å±‚çš„æŠ¥æ–‡ã€‚\nã€ç½‘ç»œå±‚ã€‘ åˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„è·¯ç”±ï¼Œè®©æºä¸»æœºä¼ è¾“å±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œå±‚ä¸­çš„è·¯ç”±å™¨æ‰¾åˆ°ç›®çš„ä¸»æœºã€‚è·¯ç”±å™¨å¯»å€å·¥ä½œä¸­ï¼Œè¦æ‰¾åˆ°ç›®æ ‡åœ°å€çš„å­ç½‘ï¼Œæ‰¾åˆ°åè¿›è€ŒæŠŠæ•°æ®åŒ…è½¬å‘ç»™å¯¹åº”çš„ç½‘ç»œå†…ã€‚\nç½‘ç»œå±‚å¸¸è§çš„åè®®å¦‚ä¸‹ï¼š\nIP ï¼šç”¨äºå¯¹æ•°æ®åŒ…è¿›è¡Œè·¯ç”±å’Œå¯»å€ ARPï¼šç”¨äºå°†IPåœ°å€å’ŒMACåœ°å€è¿›è¡Œç›¸äº’è½¬æ¢ NATï¼šç”¨äºå°†å†…éƒ¨IPå’Œå¤–éƒ¨IPè¿›è¡Œç›¸äº’è½¬æ¢ ICMPï¼šç”¨äºä¼ è¾“ç½‘ç»œçŠ¶æ€å’Œé”™è¯¯æ¶ˆæ¯çš„çŠ¶æ€ï¼Œä¸€èˆ¬ç”¨æ¥ç½‘ç»œè¯Šæ–­å’Œæ•…éšœæ’é™¤ ã€ç½‘ç»œæ¥å£å±‚ã€‘ å°†ç½‘ç»œå±‚çš„IPæ•°æ®æŠ¥ç»„è£…æˆå¸§ï¼Œåœ¨ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„é“¾è·¯ä¼ é€ã€‚æ¯ä¸€å¸§å«æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ (æ¯”å¦‚åŒæ­¥ã€åœ°å€ã€å·®é”™æ§åˆ¶ç­‰ä¿¡æ¯)ã€‚å®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´æ¯”ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚\n12. Cookieã€Sessionã€Token ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç‰¹æ€§ Cookie Session Token ç”¨é€” ç”¨äºè·Ÿè¸ªå’Œä¿æŠ¤ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„å°å‹æ•°æ®æ–‡ä»¶ ç”¨äºä¿å­˜ç”¨æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œæ¯ä¸ªä¼šè¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„Session ID ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œç”¨äºèº«ä»½æ ¡éªŒ å­˜å‚¨ä½ç½® å®¢æˆ·ç«¯ (æµè§ˆå™¨) æœåŠ¡å™¨ å®¢æˆ·ç«¯ (æµè§ˆå™¨ã€ç§»åŠ¨è®¾å¤‡) æ˜¯å¦æœ‰çŠ¶æ€ æ²¡æœ‰ æœ‰çŠ¶æ€ æ²¡æœ‰ é€‚ç”¨åœºæ™¯ è½»é‡çº§çŠ¶æ€å­˜å‚¨ (ç”¨æˆ·åå¥½ã€ä¸ªæ€§åŒ–è®¾ç½®) ç”¨æˆ·èº«ä»½è®¤è¯ã€ä¸´æ—¶ä¼šè¯æ•°æ®å­˜å‚¨ åˆ†å¸ƒå¼è®¤è¯ã€ç§»åŠ¨ç«¯å’Œå•é¡µåº”ç”¨ (SPA) é€‚ç”¨åè®® HTTP/HTTPS HTTP/HTTPS HTTPã€HTTPSã€WebSocket å®‰å…¨æ€§ è¾ƒä½ï¼šå®¹æ˜“è¢«ç¯¡æ”¹æˆ–è€…ä¼ªé€  è¾ƒé«˜ï¼šæ•°æ®å­˜å‚¨åœ¨æœåŠ¡ç«¯ è¾ƒé«˜ï¼šTokené€šå¸¸åŠ å¯†ä¸”æ”¯æŒç­¾åå’Œè¿‡æœŸæœºåˆ¶ ã€Cookies è¯¦è§£ã€‘\næœåŠ¡å™¨é€šè¿‡ HTTP å“åº”å¤´ (Set-Cookie) è¿”å›Cookieç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯ä¿å­˜ Cookieï¼Œåç»­æ‰€æœ‰åŒæºçš„è¯·æ±‚ï¼Œéƒ½ä¼šæºå¸¦è¯¥ Cookie æœåŠ¡å™¨æ ¹æ® Cookie çš„å€¼ (æ¯”å¦‚ SessionID) è¯†åˆ«ç”¨æˆ·çŠ¶æ€ ã€æ³¨æ„ã€‘ Cookieæ˜¯HTTPåè®®ç°‡çš„ä¸€éƒ¨åˆ†ï¼ŒHTTPåè®®æ²¡æœ‰çŠ¶æ€ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥Cookieæ˜¯æ— çŠ¶æ€åè®®ä¸‹åœ¨å®¢æˆ·ç«¯å­˜å‚¨çŠ¶æ€ä¿¡æ¯çš„è¡¥å……æœºåˆ¶\nã€Session è¯¦è§£ã€‘\nç”¨æˆ·ç™»å½•çš„æ—¶å€™æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•çš„HTTPè¯·æ±‚æŠ¥æ–‡ï¼ŒæœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·å’Œå¯†ç  å¦‚æœæ­£ç¡®ï¼Œåˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis / ConcurrentHashMap é‡Œé¢, key ä¸º Session IDï¼Œ value åŒ…å«ç”¨æˆ·çš„ä¿¡æ¯ æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡ä¸­ï¼Œå¤´éƒ¨çš„ Set-Cookie å­—æ®µåŒ…å«è¯¥Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡åå­˜å‚¨Cookieå€¼ å®¢æˆ·ç«¯åç»­è¯·æ±‚åŒä¸€æœåŠ¡å™¨ä¼šåŒ…å«Cookieå€¼ï¼ŒæœåŠ¡å™¨ä¼šæå–å½“ä¸­çš„ Session IDï¼Œä»Redisé‡Œé¢æå–ç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¸šåŠ¡æ“ä½œã€‚ ã€Cookie å’Œ Session çš„å…³ç³»ã€‘\nSession çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ï¼Œ Cookieå°±æ˜¯åœ¨å®¢æˆ·ç«¯ä¿å­˜å¯¹åº”çš„Session IDã€‚å…¸å‹çš„åœºæ™¯å°±æ˜¯è´­ç‰©è½¦ï¼ŒæœåŠ¡ç«¯ç»™æŒ‡å®šç”¨æˆ·åˆ›å»º Session ä¹‹åï¼Œå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·ã€‚\nã€åˆ†å¸ƒå¼ Sessionå…±äº«é—®é¢˜ã€‘\nå‡å¦‚åœ¨ä¸€ä¸ªç§’æ€åœºæ™¯ä¸‹, æ¯ä¸ªç”¨æˆ·åªèƒ½è¿›å…¥ä¸€æ¬¡ç§’æ€é¡µé¢ã€‚ä½†æ˜¯ï¼Œç”¨æˆ·åœ¨è¯·æ±‚çš„è¿‡ç¨‹å½“ä¸­ï¼ŒNginxå¯èƒ½ä¼šå°†å…¶è´Ÿè½½å‡è¡¡åˆ°ä¸åŒçš„ Tomcatã€‚æ¯”å¦‚ç¬¬ä¸€æ¬¡è¯·æ±‚åˆ° Tomcat A è®°å½• Session, ç„¶åè´­ä¹°äº†å•†å“ã€‚ä½†æ˜¯ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚åˆ° Tomcat B å°±ä¼šå‡ºé—®é¢˜ï¼Œå› ä¸º Tomcat B è®¤ä¸ºç”¨æˆ·ç¬¬ä¸€æ¬¡æ¥è€Œå…è®¸è´­ä¹°è¯·æ±‚ï¼Œé€ æˆé‡å¤è´­ä¹°ã€‚å› ä¸ºæ¯å° Tomcat å½“ä¸­ï¼Œåªèƒ½çœ‹åˆ°è‡ªå·±å­˜å‚¨çš„Session\nã€Token è¯¦è§£ã€‘\nå®¢æˆ·ç«¯ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•æœåŠ¡å™¨ æœåŠ¡ç«¯éªŒè¯èº«ä»½ä¹‹åç”ŸæˆTokenå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯å°†Tokenå­˜åˆ°æœ¬åœ°æµè§ˆå™¨ (ä¸€èˆ¬å­˜åˆ°Cookieé‡Œé¢) å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™æºå¸¦Tokenï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œå…ˆéªŒè¯Tokenå†è¿”å›æ•°æ® Tokenä¸€èˆ¬éƒ½é‡‡ç”¨ JWT ç®—æ³•è¿›è¡Œé¢å‘ä»¤ç‰Œï¼Œå…¶ä¸»è¦æ„æˆå¦‚ä¸‹ï¼š\nHeaderï¼šæè¿°JWTå…ƒæ•°æ®ï¼Œå®šä¹‰ç”Ÿæˆç­¾åçš„ç®—æ³•å’Œ Token ç±»å‹ Payloadï¼šç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®é›† Signatureï¼šæœåŠ¡å™¨åˆ©ç”¨Payloadã€Header å’Œå¯†é’¥ (Secret)ï¼Œé‡‡ç”¨HeaderæŒ‡å®šçš„ç­¾åç®—æ³• (é»˜è®¤ä¸ºHS256) ç”Ÿæˆ ã€æ³¨æ„ã€‘ JWTä¸€èˆ¬å­˜åœ¨ LocalStorage æœ¬åœ°å­˜å‚¨å½“ä¸­ï¼Œæ”¾åœ¨Cookie ä¼šæœ‰è·¨ç«™è¯·æ±‚ä¼ªè£…CSRF é£é™©ï¼Œä¸€èˆ¬è¯·æ±‚æœåŠ¡ç«¯æºå¸¦JWTçš„é•¿ç«ç®­åšæ³•æ˜¯ä½¿ç”¨ HTTP Header ä¸­çš„ Authorization å­—æ®µ\n13. ä»ç½‘ç»œè§’åº¦æ¥çœ‹ï¼Œç”¨æˆ·ä»è¾“å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥æŒ‡å®šç½‘é¡µçš„URLï¼Œæµè§ˆå™¨è§£æURLè·¯å¾„ æµè§ˆå™¨é€šè¿‡DNSåè®®ï¼Œè·å–åŸŸåå¯¹åº”çš„IPåœ°å€ (å…ˆæ‰¾æœ¬åœ°ç¼“å­˜ï¼Œæ‰¾ä¸åˆ°å°±æ‰¾é…ç½®çš„DNSæœåŠ¡å™¨) æµè§ˆå™¨æ ¹æ®IPåœ°å€å’Œç«¯å£å·ï¼Œå‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªTCPè¿æ¥è¯·æ±‚ ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ æµè§ˆå™¨åœ¨TCPè¿æ¥ä¸Šï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œå°è£…æˆIPæ•°æ®åŒ…ï¼Œè¯·æ±‚è·å–ç½‘é¡µå†…å®¹ æ“ä½œç³»ç»Ÿåœ¨IPæ•°æ®åŒ…çš„åŸºç¡€ä¸ŠåŠ ä¸ŠMACå¤´éƒ¨ï¼ŒåŠ ä¸Šå‘é€æ–¹MACåœ°å€å’Œæ¥å—æ–¹ç›®æ ‡MACåœ°å€ (ARPåè®®) æ•°æ®åŒ…è¿˜æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç½‘å¡å°†äºŒè¿›åˆ¶æ•°æ®è½¬ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿è¿›è¡Œä¼ è¾“ äº¤æ¢æœºæ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œä¼šæ ¹æ®æ•°æ®åŒ…ä¸­çš„MACå¤´æ‰¾åˆ°å¦å¤–ä¸€ä¸ªè®¾å¤‡è¿æ¥åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ï¼Œç„¶åä¼ è¾“ã€‚ï¼ˆå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å¯¹æ‰€æœ‰çš„ç«¯å£è¿›è¡Œå¹¿æ’­ï¼‰ è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åŒ…ä¹‹åæ ¹æ®IPåœ°å€ï¼Œåœ¨ä¸åŒçš„ç½‘ç»œèŠ‚ç‚¹ä¹‹é—´è½¬å‘ï¼Œæœ€ååˆ°è¾¾æœåŠ¡å™¨ã€‚ï¼ˆå¦‚æœè¶…è¿‡TTLï¼Œè¿˜æ²¡æ‰¾åˆ°æœåŠ¡å™¨ï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨ä¸å¯è¾¾ï¼‰ æœåŠ¡å™¨æ”¶åˆ°HTTPè¯·æ±‚æŠ¥æ–‡ä¹‹åè¿›è¡Œå¤„ç†ï¼Œé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œè¿”å›HTTPå“åº”æŠ¥æ–‡ç»™æµè§ˆå™¨ æµè§ˆå™¨æ”¶åˆ°HTTPå“åº”æŠ¥æ–‡ä¹‹åï¼Œè§£æHTMLä»£ç æ¸²æŸ“ç½‘é¡µç»“æ„å’Œå¤®è§†ã€‚åŒæ—¶æ ¹æ®HTMLä¸­çš„èµ„æºURLå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œè·å–èµ„æºå†…å®¹ ï¼ˆæ¯”å¦‚ä¸€äº›å›¾ç‰‡èµ„æºï¼‰ï¼Œç›´åˆ°ç½‘é¡µå®Œå…¨åŠ è½½ æµè§ˆå™¨å†ä¸éœ€è¦å’ŒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„æ—¶å€™ï¼Œä¸»åŠ¨å…³é—­TCPè¿æ¥æˆ–ç­‰å¾…æœåŠ¡å™¨å…³é—­è¯·æ±‚ï¼Œè¿›è¡Œå››æ¬¡æŒ¥æ‰‹ã€‚ ã€URL ç»“æ„ã€‘\nSchema åè®®ç±»å‹ï¼šä¸€èˆ¬ä¸ºHTTP/HTTPSåè®®ï¼Œä¹Ÿå¯èƒ½æ˜¯æ–‡ä»¶ä¼ è¾“åè®® FTP, é‚®ä»¶åè®® SMTP åŸŸå + ç«¯å£ï¼šåŸŸåæ˜¯ç½‘å€çš„é€šç”¨åæˆ–è€…IPåœ°å€çš„å¯è¯»ç‰ˆæœ¬ï¼Œç«¯å£å°±åœ¨åŸŸååé¢ï¼Œç”¨å†’å·éš”å¼€ èµ„æºè·¯å¾„ï¼šæŒ‡æ˜è¦è®¿é—®å“ªä¸€ä¸ªç½‘é¡µ/èµ„æº å‚æ•°ï¼šå‚æ•°ç”¨é”®å€¼å¯¹çš„å½¢å¼ key = valueï¼Œç”¨ \u0026amp; è¿›è¡Œéš”å¼€ é”šç‚¹ï¼šé”šç‚¹ä»¥#å¼€å¤´ï¼Œæ˜¯é¡µé¢ä¸Šçš„é”šï¼Œç”¨äºå®šä½ï¼Œä¸å‘é€ç»™æœåŠ¡ç«¯ ã€åŸŸåè§£æã€‘\næŸ¥è¯¢æœ¬åœ°çš„Hostæ–‡ä»¶/åˆ—è¡¨ï¼šæµè§ˆå™¨å›å»æŸ¥è¯¢æœ¬åœ°æ˜¯å¦æœ‰å¯¹åº”åŸŸåçš„è®°å½•ï¼Œ å¦‚æœæœ‰ï¼Œç›´æ¥æå–å¯¹åº”çš„IPåœ°å€\næŸ¥è¯¢æœ¬åœ°DNSç¼“å­˜ï¼š æŸ¥è¯¢æµè§ˆå™¨ç¼“å­˜/æ“ä½œç³»ç»Ÿç¼“å­˜/è·¯ç”±å™¨ç¼“å­˜ï¼Œå¦‚æœå­˜åœ¨è®°å½•ï¼Œç›´æ¥æå–å¯¹åº”çš„IPåœ°å€\næŸ¥è¯¢DNSæœåŠ¡å™¨ï¼š å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæµè§ˆå™¨ä¼šå‘é…ç½®çš„DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ (é€šå¸¸ç”±è¿è¥å•† ISP æä¾›)ï¼ŒDNSæœåŠ¡å™¨ä¼šé€šè¿‡é€’å½’æŸ¥è¯¢çš„æ–¹å¼è§£æåŸŸå\næ ¹DNSæœåŠ¡å™¨ï¼šè¿”å›é¡¶çº§åŸŸåçš„æœåŠ¡å™¨åœ°å€ (.com) é¡¶çº§åŸŸå(TLD)æœåŠ¡å™¨ï¼šè¿”å›æƒå¨DNSæœåŠ¡å™¨çš„åœ°å€ æƒå¨DNSæœåŠ¡å™¨ï¼š è¿”å›å…·ä½“åŸŸåçš„å…·ä½“IPåœ°å€ 14. HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ å…ˆè¯´åŒºåˆ«ï¼Œä¸Šè¡¨ï¼ï¼ï¼\nç‰¹æ€§ HTTP HTTPS å®‰å…¨æ€§ æ˜æ–‡ä¼ è¾“ï¼Œä¸å®‰å…¨ é‡‡ç”¨TLS / SSL å®‰å…¨åè®®ï¼Œè®©æŠ¥æ–‡åŠ å¯†ä¼ è¾“ è¿æ¥è¿‡ç¨‹ åŸºäº TCP åè®®ï¼Œä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œå³å¯å‘é€æŠ¥æ–‡ä¿¡æ¯ åŸºäº TCP + SSL / TLS åè®®ï¼Œåœ¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œè¿˜ä¼šè¿›è¡Œ SSL / TLS çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œæ‰èƒ½è¿›è¡ŒåŠ å¯†æŠ¥æ–‡ä¼ è¾“ é»˜è®¤ç«¯å£ 80 443 æ•°å­—è¯ä¹¦ ä¸éœ€è¦æ•°å­—è¯ä¹¦ éœ€è¦å‘ CA ï¼ˆCertificate Authority) è¯ä¹¦æƒå¨æœºæ„ç”³è¯·æ•°å­—è¯ä¹¦ï¼Œç¡®ä¿æœåŠ¡å™¨çš„èº«ä»½æ˜¯å¯ä¿¡çš„ ã€ä¸ºä»€ä¹ˆéœ€è¦ HTTPSåè®®ã€‘\nä¼ ç»Ÿçš„ HTTP åè®®å­˜åœ¨ä¸‹é¢çš„ä¸‰ç§å®‰å…¨é£é™©éšæ‚£ï¼š\nçªƒå¬é£é™©ï¼šé€šä¿¡é“¾è·¯ä¸Šå¯ä»¥è·å–é€šä¿¡å†…å®¹ï¼Œç”¨æˆ·ä¿¡æ¯å®¹æ˜“è¢«ç›—çªƒ ï¼ˆæŠ“åŒ…ï¼‰ ç¯¡æ”¹é£é™©ï¼šæ¯”å¦‚åœ¨æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡é‡Œé¢ï¼Œå¼ºè¡Œæ¤å…¥åƒåœ¾å¹¿å‘Šï¼Œç”¨æˆ·å®¹æ˜“è¯¯è§¦è¿›å…¥åƒåœ¾ç½‘ç«™ å†’å……é£é™©ï¼šä¼ªè£…æˆå¤©çŒ«ã€äº¬ä¸œç­‰å®˜æ–¹ç½‘ç«™ï¼Œç”¨æˆ·å®¹æ˜“è¢«éª—é’±ã€‚ HTTPS å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸Šé¢çš„ä¸‰ç§é£é™©ï¼Œå…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š\nä¿¡æ¯åŠ å¯† ï¼ˆè§£å†³çªƒå¬ï¼‰ï¼šç½‘ç»œæŠ¥æ–‡ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼ŒæŠ¥æ–‡æ—¶åŠ å¯†çš„ï¼ŒæŠ“åŒ…æ‹¿åˆ°æŠ¥æ–‡ä¹Ÿæ²¡ç”¨ æ ¡éªŒæœºåˆ¶ ï¼ˆè§£å†³ç¯¡æ”¹ï¼‰ï¼šæ— æ³•ç¯¡æ”¹é€šä¿¡å†…å®¹ï¼Œç¯¡æ”¹ä¹‹åå°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚HTTPS ä¼šé€šè¿‡æ¶ˆæ¯è®¤è¯ç  (MAC) æˆ–è€…æ•°å­—ç­¾åç¡®ä¿æ•°æ®å®Œæ•´ã€‚ MACæœºåˆ¶ï¼šå‘é€æ–¹ç”¨å¯†é’¥ç”Ÿæˆæ•°æ®çš„å“ˆå¸Œå€¼ (HMAC)ï¼Œ æ¥æ”¶æ–¹é‡æ–°è®¡ç®—å¹¶è¿›è¡Œå¯¹æ¯”é¢å¦‚æœå“ˆå¸Œå€¼ä¸åŒ¹é…ï¼Œåˆ™è¯´æ˜æ•°æ®è¢«ç¯¡æ”¹ã€‚ æ•°å­—ç­¾åï¼šCA å¯¹è¯ä¹¦å†…å®¹å“ˆå¸Œå€¼åŠ å¯†ç”Ÿæˆç­¾åï¼Œå®¢æˆ·ç«¯éªŒè¯ç­¾åä¸€è‡´æ€§ï¼Œé˜²æ­¢è¯ä¹¦å†…å®¹è¢«ç¯¡æ”¹ èº«ä»½è¯ä¹¦ï¼šé€šè¿‡ CA é¢å‘çš„è¯ä¹¦ï¼ŒéªŒè¯å½“å‰ç½‘ç«™æ˜¯å¦ä¸ºçœŸå®çš„ç½‘ç«™ã€‚ ã€HTTPSè¯¦è§£ã€‘\nä¸‹é¢å›´ç»• HTTPS è§£å†³ä¸‰å¤§é£é™©ï¼ˆçªƒå¬ã€ç¯¡æ”¹ã€å†’å……ï¼‰çš„æ–¹æ¡ˆè¿›è¡Œå±•å¼€\nã€çªƒå¬é£é™© (æ··åˆåŠ å¯†)ã€‘\nä¸ºäº†è§£å†³çªƒå¬é£é™©ï¼ŒHTTPSå¯¹æŠ¥æ–‡é‡‡ç”¨äº†æ··åˆåŠ å¯†çš„æ–¹å¼ ã€‚HTTPS é‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯† + éå¯¹ç§°åŠ å¯†çš„æ–¹å¼æ¥å®ç°æ··åˆåŠ å¯†çš„ã€‚å…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š\nåœ¨é€šä¿¡å»ºç«‹å‰ï¼Œé‡‡ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼äº¤æ¢ä¼šè¯å¯†é’¥ï¼Œåç»­ä¸å†ä½¿ç”¨éå¯¹ç§°åŠ å¯† åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå…¨éƒ¨ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„ä¼šè¯å¯†é’¥åŠ å¯†æ˜æ–‡æ•°æ® ä¸ºä»€ä¹ˆä¼šé‡‡ç”¨æ··åˆåŠ å¯†å‘¢ï¼Ÿä¸»è¦æ˜¯å•ä¸ªåŠ å¯†æ–¹å¼éƒ½æœ‰å…¶å¯¹åº”çš„ç¼ºç‚¹ï¼Œå…·ä½“åŠ å¯†ç‰¹ç‚¹å¦‚ä¸‹ï¼š\nå¯¹ç§°åŠ å¯†ï¼šåªä½¿ç”¨ä¸€ä¸ªå¯†é’¥ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œå¯†é’¥å¿…é¡»ä¿å¯†ï¼Œæ— æ³•åšåˆ°å®‰å…¨çš„å¯†é’¥äº¤æ¢ éå¯¹ç§°åŠ å¯†ï¼šéœ€è¦ä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ï¼Œå…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥å¯ä»¥ä»»æ„åˆ†å‘è€Œç§é’¥éœ€è¦ä¿å¯†ï¼Œè§£å†³äº†å¯†é’¥äº¤æ¢é—®é¢˜ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ ä¸ºäº†å‡è¡¡é€Ÿåº¦å’Œå®‰å…¨çš„æ€§èƒ½ï¼ŒHTTPS é‡‡ç”¨æ··åˆåŠ å¯†æ–¹å¼è¿›è¡ŒåŠ å¯† ã€ç¯¡æ”¹é£é™© (æ‘˜è¦ç®—æ³• + æ•°å­—ç­¾å)ã€‘\nä¸ºäº†è§£å†³ç¯¡æ”¹é£é™©ï¼ŒHTTPSå¯¹æŠ¥æ–‡é‡‡ç”¨äº†æ‘˜è¦ç®—æ³• + æ•°å­—ç­¾åçš„æ–¹å¼ ã€‚ä¸ºäº†ä¿è¯ä¼ è¾“çš„å†…å®¹ä¸è¢«ç¯¡æ”¹ï¼Œéœ€è¦å¯¹å‘é€æ–¹çš„æŠ¥æ–‡å†…å®¹è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè®¡ç®—å‡ºå…¶å“ˆå¸Œå€¼ï¼Œç„¶åæ”¾åœ¨æŠ¥æ–‡å†…å®¹å½“ä¸­ä¸€èµ·ä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå¯¹æ–¹æ”¶åˆ°æŠ¥æ–‡å†…å®¹ä¹‹åï¼ŒåŒæ ·ä¼šå…ˆè®¡ç®—æŠ¥æ–‡çš„å“ˆå¸Œå€¼ã€‚å¦‚æœè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼å’ŒæŠ¥æ–‡æœ¬èº«æºå¸¦çš„å“ˆå¸Œå€¼ä¸ä¸€æ ·ï¼Œå°±è¯´æ˜æŠ¥æ–‡è¢«ç¯¡æ”¹äº†ï¼Œä¼šä¸¢å¼ƒè¿™æ¡æ•°æ®ã€‚\nHTTPS åè®®é‡‡ç”¨æ‘˜è¦ç®—æ³• (å“ˆå¸Œå‡½æ•°) æ¥è®¡ç®—æŠ¥æ–‡å†…å®¹çš„å“ˆå¸Œå€¼ï¼Œå“ˆå¸Œå€¼æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ²¡æ³•å„¿é€šè¿‡å“ˆå¸Œå€¼åæ¨å†…å®¹ï¼Œå¯ä»¥é˜²æ­¢æŠ¥æ–‡åœ¨ä¼ è¾“çš„è¿‡ç¨‹å½“ä¸­è¢«ç¯¡æ”¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰ä¸­é—´äººå°†å†…å®¹å’Œå“ˆå¸Œå€¼åŒæ—¶è¿›è¡Œç¯¡æ”¹ï¼Œæ¥æ”¶æ–¹æ˜¯æ²¡æ³•å„¿åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦æ˜¯æºäºå‘é€æ–¹å‘å‡ºçš„è¿˜æ˜¯ä¸­é—´äººå‘å‡ºçš„ã€‚ä¸ºæ­¤ï¼ŒHTTPS åè®®é‡‡ç”¨äº†éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œåˆ©ç”¨ç§é’¥å°†å“ˆå¸Œå€¼ç”Ÿæˆæ•°å­—ç­¾åæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å‘é€æ–¹ä¼šæŠŠå†…å®¹å’Œæ•°å­—ç­¾å(ç§é’¥åŠ å¯†ä¹‹åçš„å“ˆå¸Œå€¼)ä¸€èµ·å‘é€å‡ºå»ã€‚æ¥æ”¶æ–¹æ”¶åˆ°ä¹‹åï¼Œé‡‡ç”¨å…¬é’¥å¯¹æ•°å­—ç­¾åè¿›è¡Œè§£å¯†ã€‚å¹¶ä¸”åŒæ—¶å¯¹å†…å®¹è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¦‚æœå†…å®¹è®¡ç®—çš„å“ˆå¸Œå€¼å’Œæ•°å­—ç­¾åè§£å¯†çš„å“ˆå¸Œå€¼ç›¸åŒï¼Œåˆ™è¯´æ˜æ¶ˆæ¯æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚å¦åˆ™ï¼Œè¯´æ˜æ¶ˆæ¯è¢«ç¯¡æ”¹äº†ï¼Œç›´æ¥ä¸¢å¼ƒã€‚ ã€å…¬é’¥å’Œç§é’¥å…³ç³»ã€‘ å…¬é’¥å’Œç§é’¥æ˜¯å¯ä»¥åŒå‘åŠ è§£å¯†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œæˆ–è€…ç”¨ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€‚\nå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼šä¸€èˆ¬ç”¨äºé˜²æ­¢ä¼ è¾“çš„å†…å®¹è¢«çªƒå–ï¼Œå…¶ä»–äººæ˜¯æˆªå–åˆ°æŠ¥æ–‡ï¼Œä¹Ÿæ˜¯æ²¡æ³•å„¿è§£å¯†çš„ã€‚åªæœ‰æŒæœ‰ç§é’¥çš„äººï¼Œæ‰èƒ½å¤Ÿè§£å¯†ã€‚ ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼šä¸€èˆ¬ç”¨äºé˜²æ­¢ä¼ è¾“çš„å†…å®¹è¢«å†’å……ï¼Œå› ä¸ºç§é’¥æ˜¯ä¸å¯æ³„éœ²çš„ï¼Œå¦‚æœå…¬é’¥èƒ½å¤Ÿè§£å¯†å‡ºç§é’¥çš„å†…å®¹ï¼Œè¯æ˜è¿™æ¡æ¶ˆæ¯æ˜¯ç§é’¥èº«ä»½çš„äººå‘é€çš„ã€‚ ã€å†’å……é£é™© (æ•°å­—è¯ä¹¦)ã€‘\nè™½ç„¶å‰é¢é€šè¿‡å“ˆå¸Œç®—æ³•èƒ½å¤Ÿä¿è¯æ¶ˆæ¯ä¸è¢«ç¯¡æ”¹ï¼Œä¸”é€šè¿‡æ•°å­—ç­¾åä¿è¯æ•°æ®çš„æ¥æºå¯é æ€§ï¼ˆç¡®ä¿æ˜¯æŒæœ‰ç§é’¥çš„ä¸€æ–¹å‘é€çš„ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸­é—´äººä¼ªé€ ä¸€å †å…¬é’¥å’Œç§é’¥ï¼Œå°†æ¥æ”¶æ–¹åŸæ¥çš„å…¬é’¥æ›¿æ¢ä¸ºä¼ªé€ çš„å…¬é’¥ã€‚é‚£ä¹ˆä¸­é—´äººå°±å¯ä»¥æ„é€ å‡æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹é€šè¿‡è¢«æ›¿æ¢çš„å‡å…¬é’¥æ­£å¸¸è§£å¯†ï¼Œå¾—åˆ°çš„å´æ˜¯ä¼ªé€ çš„å‡æŠ¥æ–‡ã€‚HTTPS åè®®ä¸ºäº†è§£å†³ä¸­é—´äººå†’å……å‘é€æ–¹çš„é—®é¢˜ï¼Œé‡‡ç”¨äº†æ•°å­—è¯ä¹¦çš„æ–¹å¼ã€‚CA æ•°å­—è¯ä¹¦è®¤è¯æœºæ„å¯ä»¥åˆ©ç”¨ç§é’¥ (CAè‡ªå·±çš„ç§é’¥)åˆ¶ä½œæ•°å­—è¯ä¹¦ï¼ˆå…¬é’¥ + CAçš„æ•°å­—ç­¾åï¼‰ï¼Œæ‰€æœ‰ CA çš„å…¬é’¥éƒ½å·²ç»ç½®å…¥æµè§ˆå™¨æˆ–è€…æ“ä½œç³»ç»Ÿé‡Œé¢äº†ã€‚å‘é€æ–¹å°†å…¬é’¥äº¤ç»™ CA æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ç”Ÿæˆæ•°å­—è¯ä¹¦ï¼Œç„¶åæ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œç”¨æµè§ˆå™¨/æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„ CA å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œç¡®è®¤æœåŠ¡å™¨æ•°å­—è¯ä¹¦çš„çœŸå®æ€§ã€‚å¦‚æœè§£å¯†æˆåŠŸä¸”å“ˆå¸Œå€¼åŒ¹é…ï¼Œåˆ™ä»æ•°å­—è¯ä¹¦ä¸­æå–å‘é€æ–¹é¢å‘çš„å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥å°†æŠ¥æ–‡åŠ å¯†è¿›è¡Œä¼ è¾“ã€‚\nã€HTTPS å»ºç«‹è¿æ¥è¿‡ç¨‹ã€‘\nHTTPS ç›¸è¾ƒäº HTTP æ¥è¯´ï¼Œ é™¤äº† TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹å¤–ï¼Œè¿˜å¤šäº† SSL/TLS åè®®çš„æ¡æ‰‹é˜¶æ®µã€‚TLS æ¡æ‰‹é˜¶æ®µæ¶‰åŠå››æ¬¡é€šä¿¡ï¼Œä½¿ç”¨ä¸åŒçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œä¸€èˆ¬å¸¸ç”¨ RSA ç®—æ³• å’Œ ECDHE ç®—æ³•ã€‚ä¸‹é¢å…·ä½“ä»‹ç»åŸºäº RSA ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹ã€‚TLS åè®®å»ºç«‹çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\nClientHelloï¼šé¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·åŠ å¯†é€šä¿¡è¯·æ±‚ ClientHelloã€‚å®¢æˆ·ç«¯ä¼šåœ¨è¿™ä¸€æ­¥å‘æœåŠ¡å™¨å‘é€ä¸€ä¸‹ä¿¡æ¯ï¼š\nå®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç‰ˆæœ¬ï¼Œæ¯”å¦‚ TLS 1.2 å®¢æˆ·ç«¯äº§ç”Ÿçš„éšæœºæ•° Cï¼Œåé¢ç”¨äºç”Ÿæˆä¼šè¯å¯†é’¥çš„æ¡ä»¶ä¹‹ä¸€ å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œæ¯”å¦‚ RSA åŠ å¯†ç®—æ³• ServerHelloï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¹‹åï¼Œæƒ³å®¢æˆ·ç«¯å‘å‡ºå“åº” ServerHelloã€‚æœåŠ¡å™¨å›åº”çš„å†…å®¹å¦‚ä¸‹ï¼š\nç¡®è®¤ TLS åè®®ç‰ˆæœ¬ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œåˆ™å…³é—­åŠ å¯†é€šä¿¡ æœåŠ¡å™¨äº§ç”Ÿçš„éšæœºæ•° S, ä¹Ÿæ˜¯åé¢ç”¨äºç”Ÿæˆä¼šè¯å¯†é’¥çš„æ¡ä»¶ä¹‹ä¸€ ç¡®è®¤å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œæ¯”å¦‚ RSA åŠ å¯†ç®—æ³• æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦ (æœåŠ¡å™¨å‘CAç”³è¯·çš„) å®¢æˆ·ç«¯å›åº”ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„å›ä¹‹åï¼Œé¦–å…ˆé€šè¿‡æµè§ˆå™¨/æ“ä½œç³»ç»Ÿä¸­çš„ CA å…¬é’¥ï¼Œå¯¹æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚å¦‚æœè¯ä¹¦æ²¡æœ‰é—®é¢˜ï¼Œåˆ™å–å‡ºæ•°å­—è¯ä¹¦ä¸­çš„æœåŠ¡å™¨å…¬é’¥ï¼Œç„¶åä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†æŠ¥æ–‡ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸‹é¢çš„ä¿¡æ¯ï¼š\nä¸€ä¸ªéšæœºæ•° (pre-master key)ï¼Œè¯¥éšæœºæ•°ä¼šè¢«å®¢æˆ·ç«¯ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯† åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨ä¼šè¯å¯†é’¥è¿›è¡ŒåŠ å¯†é€šä¿¡ å®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œé€šçŸ¥æœåŠ¡å™¨è¡¨æ˜å®¢æˆ·ç«¯æ¡æ‰‹çš„é˜¶æ®µå·²ç»ç»“æŸäº† ã€æ³¨æ„ã€‘ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æœ‰äº†ä¸‰ä¸ªéšæœºæ•° (å®¢æˆ·ç«¯éšæœºæ•° Cã€æœåŠ¡å™¨éšæœºæ•° Sã€pre-master key)ä¹‹åï¼Œé€šè¿‡åå•†çš„åŠ å¯†ç®—æ³•ï¼Œè®¡ç®—å‡ºæœ¬æ¬¡çš„é€šä¿¡çš„ä¼šè¯å¯†é’¥ã€‚\næœåŠ¡å™¨çš„æœ€åå›åº”ï¼šæœåŠ¡å™¨è®¡ç®—å‡ºä¼šè¯å¯†é’¥ä¹‹åï¼Œå‘å®¢æˆ·ç«¯å‘é€æœ€åçš„æ¶ˆæ¯ï¼š\nåŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„æ¶ˆæ¯éƒ½å°†ç”¨ä¼šè¯å¯†é’¥åŠ å¯†é€šä¿¡ æœåŠ¡å™¨æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œé€šçŸ¥å®¢æˆ·ç«¯è¡¨æ˜æœåŠ¡å™¨æ¡æ‰‹çš„é˜¶æ®µç»“æŸäº† ","permalink":"https://swimmingliu.cn/posts/job/computer-networks-interview-questions/","summary":"\u003ch2 id=\"1-tcp-å’Œ-udp-æœ‰ä»€ä¹ˆåŒºåˆ«\"\u003e1. TCP å’Œ UDP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eTCP\u003c/code\u003e æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥ã€åŸºäºå­—èŠ‚æµä¼ è¾“çš„ä¼ è¾“åè®®ï¼Œèƒ½å¤Ÿä¿è¯æ•°æ®çš„é¡ºåºï¼Œä½†æ˜¯å…¶å»¶è¿Ÿæ¯”è¾ƒå¤§ã€‚ä¸€èˆ¬é€‚ç”¨äºéœ€è¦æ•°æ®å®Œæ•´æ€§å’Œé¡ºåºçš„åœºæ™¯ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“ã€é‚®ä»¶ã€\u003ccode\u003eWeb\u003c/code\u003e ç½‘ç«™ã€‚\n\u003ccode\u003eUDP\u003c/code\u003e æ˜¯ä¸€ç§ä¸å¯é çš„ã€æ— è¿æ¥ã€åŸºäºæ•°æ®æŠ¥ä¼ è¾“çš„ä¼ è¾“åè®®ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºï¼Œä½†æ˜¯å»¶è¿Ÿæ¯”è¾ƒå°ã€‚ä¸€èˆ¬é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½è¦æ±‚å’Œå¿«é€Ÿä¼ è¾“æ•°æ®çš„åº”ç”¨ï¼Œæ¯”å¦‚å®æ—¶é€šè®¯ã€è¯­éŸ³ã€è§†é¢‘ã€æ¸¸æˆç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eã€æ³¨æ„ã€‘\u003ccode\u003eTCP\u003c/code\u003e å’Œ \u003ccode\u003eUDP\u003c/code\u003e éƒ½å±äºä¼ è¾“å±‚\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eç‰¹æ€§\u003c/th\u003e\n          \u003cth\u003eTCP\u003c/th\u003e\n          \u003cth\u003eUDP\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eè¿æ¥æ–¹å¼\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eé¢å‘è¿æ¥ (ä¸‰æ¬¡æ¡æ‰‹)\u003c/td\u003e\n          \u003ctd\u003eæ— è¿æ¥\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eå¯é æ€§å’Œé¡ºåºä¿è¯\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå¯é ï¼Œä¿è¯æ•°æ®æŒ‰é¡ºåºé€è¾¾\u003c/td\u003e\n          \u003ctd\u003eä¸å¯é ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºï¼Œè€Œä¸èƒ½ä¿è¯å®‰å…¨é€è¾¾\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæµé‡æ§åˆ¶/æ‹¥å¡æ§åˆ¶\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæä¾›æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶\u003c/td\u003e\n          \u003ctd\u003eæ²¡æœ‰æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eå¤´éƒ¨å¤§å°\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå¤´éƒ¨è¾ƒå¤§ (\u003ccode\u003e20\u003c/code\u003e ~ \u003ccode\u003e80\u003c/code\u003e å­—èŠ‚)\u003c/td\u003e\n          \u003ctd\u003eè¾ƒå° (åªæœ‰ \u003ccode\u003e8\u003c/code\u003e å­—èŠ‚)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ€§èƒ½\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eè¾ƒä½ï¼Œå»¶è¿Ÿå¤§\u003c/td\u003e\n          \u003ctd\u003eè¾ƒé«˜ï¼Œå»¶è¿Ÿå°\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ˜¯å¦æ”¯æŒå¹¿æ’­\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eä¸æ”¯æŒå¹¿æ’­\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒå¹¿æ’­\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ•°æ®ä¼ è¾“æ¨¡å¼\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eé€šè¿‡å­—èŠ‚æµä¼ è¾“\u003c/td\u003e\n          \u003ctd\u003eé€šè¿‡æ•°æ®æŠ¥ä¼ è¾“\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eé€‚ç”¨åœºæ™¯\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ–‡ä»¶ä¼ è¾“ã€Webã€é‚®ä»¶ç­‰éœ€è¦å¯é æ€§çš„ä¼ è¾“\u003c/td\u003e\n          \u003ctd\u003eå®æ—¶é€šè®¯ã€è¯­éŸ³ã€è§†é¢‘ã€æ¸¸æˆç­‰é«˜æ€§èƒ½è¦æ±‚åº”ç”¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eåŸºäºä¸¤è€…çš„åè®®\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003e1. \u003cstrong\u003eHTTPåè®®\u003c/strong\u003eï¼šè¶…æ–‡æœ¬å’Œå¤šåª’ä½“å†…å®¹çš„åè®®\u003cbr /\u003e2. \u003cstrong\u003eHTTPSåè®®\u003c/strong\u003eï¼šåŸºäºHTTPåè®®ä¸ŠåŠ äº†ä¸€å±‚\u003ccode\u003eSSL\u003c/code\u003e / \u003ccode\u003eTSL\u003c/code\u003e å¤–å£³ï¼Œä¿è¯äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§\u003cbr /\u003e3. \u003cstrong\u003eFTPåè®®\u003c/strong\u003eï¼š æ–‡ä»¶ä¼ è¾“åè®®ï¼Œç”¨æ¥ä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„\u003cbr /\u003e4. \u003cstrong\u003eSMTPåè®®\u003c/strong\u003eï¼šç®€å•é‚®ä»¶åè®®ï¼Œç”¨äºå‘é€é‚®ä»¶çš„åè®® (\u003ccode\u003ePOP3\u003c/code\u003e åè®®ï¼š è´Ÿè´£é‚®ä»¶æ¥å—çš„åè®®)\u003c/td\u003e\n          \u003ctd\u003e1. \u003cstrong\u003eHTTP 3.0 åè®®\u003c/strong\u003e: åŸºäº \u003ccode\u003eUDP\u003c/code\u003e çš„\u003ccode\u003eQUIC\u003c/code\u003e åè®®\u003cbr /\u003e2. \u003cstrong\u003eDHCP åè®®\u003c/strong\u003eï¼š åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ŒåŠ¨æ€é…ç½® \u003ccode\u003eIP\u003c/code\u003e åœ°å€\u003cbr /\u003e3. \u003cstrong\u003eDNS\u003c/strong\u003e ï¼šåŸŸåè§£æç³»ç»Ÿï¼Œå°†åŸŸåè½¬å˜ä¸ºæœºå™¨åˆ»åº¦çš„ \u003ccode\u003eIP\u003c/code\u003e åœ°å€\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eã€ISO å’Œ TCP/IP æ¨¡å‹ã€‘\u003c/strong\u003e\u003c/p\u003e","title":"è®¡ç®—æœºç½‘ç»œé¢è¯•é¢˜ç¬”è®°"},{"content":"1. å•ä¾‹æ¨¡å¼æœ‰å“ªå‡ ç§å®ç°ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ é¦–å…ˆï¼Œå•ä¾‹æ¨¡å¼å’Œå·¥å‚æ¨¡å¼éƒ½æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼å½“ä¸­ï¼Œä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡(æˆ–è€…è¯´å®ä¾‹)ï¼Œ é‚£è¿™ä¸ªç±»å°±æ˜¯å•ä¾‹ç±»ã€‚å•ä¾‹ç±»æ˜¯ä¸å¯ä»¥è¢«ç»§æ‰¿çš„ï¼Œä¹Ÿæ²¡æœ‰äº†å¤šæ€çš„ç‰¹æ€§ã€‚\nã€å•ä¾‹ç±»çš„å®ç°æ–¹å¼ã€‘\nå¸¸è§„å•ä¾‹æ¨¡å¼æœ‰äº”ç§å†™æ³•ï¼Œä½†æ˜¯ç¼–å†™ä»£ç çš„è¿‡ç¨‹å½“ä¸­ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\næ„é€ å™¨éœ€è¦ç§æœ‰åŒ– æš´éœ²ä¸€ä¸ªå…¬å…±è·å–å•ä¾‹å¯¹è±¡çš„æ¥å£ ï¼ˆobj.getInstance()ï¼‰ æ˜¯å¦æ”¯æŒæ‡’åŠ è½½ å»¶è¿ŸåŠ è½½ æ˜¯å¦çº¿ç¨‹å®‰å…¨ äº”ç§å†™æ³•ä¸ºï¼š\né¥¿æ±‰å¼ï¼š ç±»åŠ è½½çš„æ—¶å€™ï¼Œå°±ä¸€èµ·æŠŠ instance é™æ€å®ä¾‹åˆ›å»ºå¥½äº†ï¼Œæ‰€ä»¥åˆ›å»ºçš„è¿‡ç¨‹å¸‚çº¿ç¨‹å®‰å…¨çš„ã€‚\né¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼è™½ç„¶ä¸æ”¯æŒæ‡’åŠ è½½ï¼Œæœ‰ç‚¹æµªè´¹èµ„æºã€‚ä½†å…¶å®ä¸ä¼šå ç”¨å¤ªå¤šèµ„æºï¼Œå¹¶ä¸”å¦‚æœä¸€ä¸ªå®ä¾‹åˆå§‹åŒ–çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå°±åº”è¯¥æ”¾åœ¨å¯åŠ¨çš„æ—¶å€™æ¥å¤„ç†ï¼Œé¿å…è¿è¡Œæ—¶å¡é¡¿æˆ–å‘ç”Ÿé—®é¢˜ï¼Œ æ»¡è¶³fail-fast å¤±è´¥å¿«é€Ÿè§£å†³çš„è®¾è®¡åŸåˆ™\npublic class EagerSingleton { private static Singleton instance = new Singleton(); private Singleton (){} public static Singleton getInstance() { return instance; } } æ‡’æ±‰å¼ï¼šç›¸è¾ƒäºé¥¿æ±‰å¼çš„æ–¹å¼ï¼Œä¿®æ”¹æˆå»¶è¿ŸåŠ è½½çš„æ¨¡å¼ã€‚æ³¨æ„getInstance()æ–¹æ³•æ²¡æœ‰ä¸Šé”çš„è¯ï¼Œåœ¨å¤§é‡çº¿ç¨‹å¹¶å‘è¯·æ±‚çš„æ—¶å€™ï¼Œå¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚\npublic class Singleton { private static Singleton instance; private Singleton (){} public synchronized static Singleton getInstance() { if (instance == null) { instance = new Singleton(); } return instance; } } åŒé‡æ£€æŸ¥é”ï¼šé¥¿æ±‰å¼é”ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œç„¶åæ‡’æ±‰å¼é”çš„ç²’åº¦æ¯”è¾ƒå¤§ï¼Œä¸æ”¯æŒé«˜å¹¶å‘ã€‚åŒé‡æ£€æŸ¥é”å¯ä»¥å®ç°æ—¢å»¶è¿ŸåŠ è½½ï¼Œåˆæ”¯æŒé«˜å¹¶å‘ã€‚å…¶å®å°±æ˜¯åœ¨åˆ¤æ–­äº†æ²¡æœ‰å®ä¾‹ä¹‹åï¼Œå†è¿›è¡Œä¸Šé”ï¼Œåˆ›å»ºå®ä¾‹ã€‚ ä½†æ˜¯å®ä¾‹å¿…é¡»ç”¨volatile ä¿®é¥°ï¼Œä¸ç„¶new æ“ä½œåˆ›å»ºå¯¹è±¡æ—¶ï¼Œå®¹æ˜“å‡ºç°é‡æ’åºçš„é—®é¢˜ã€‚\npublic class DclSingleton { // volatileå¦‚æœä¸åŠ å¯èƒ½ä¼šå‡ºç°åŠåˆå§‹åŒ–çš„å¯¹è±¡ // ç°åœ¨ç”¨çš„é«˜ç‰ˆæœ¬çš„ Java å·²ç»åœ¨ JDK å†…éƒ¨å®ç°ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ˆè§£å†³çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªè¦æŠŠå¯¹è±¡ new æ“ä½œå’Œåˆå§‹åŒ–æ“ä½œè®¾è®¡ä¸ºåŸå­æ“ä½œï¼Œå°±è‡ªç„¶èƒ½ç¦æ­¢é‡æ’åºï¼‰,ä¸ºäº†å…¼å®¹æ€§æˆ‘ä»¬åŠ ä¸Š private volatile static Singleton singleton; private Singleton (){} public static Singleton getInstance() { if (singleton == null) { synchronized (Singleton.class) { if (singleton == null) { singleton = new Singleton(); } } } return singleton; } } é™æ€å†…éƒ¨ç±»ï¼šåˆ©ç”¨Javaçš„å†…éƒ¨ç±»ï¼Œå†è°ƒç”¨getInstance()æ–¹æ³•çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›å†…éƒ¨ç±»çš„å®ä¾‹ã€‚ä»–ä¼šå†è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œåˆ›å»ºå†…éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ã€‚å®ä¾‹çš„å”¯ä¸€æ€§å’Œåˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œéƒ½æœ‰JVMæ¥ä¿è¯ã€‚è¿™ç§æ–¹æ³•æ—¢æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåˆèƒ½å¤Ÿåšå»¶è¿ŸåŠ è½½ã€‚\npublic class InnerSingleton { /** ç§æœ‰åŒ–æ„é€ å™¨ */ private Singleton() { } /** å¯¹å¤–æä¾›å…¬å…±çš„è®¿é—®æ–¹æ³• */ public static Singleton getInstance() { return SingletonHolder.INSTANCE; } /** å†™ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œé‡Œé¢å®ä¾‹åŒ–å¤–éƒ¨ç±» */ private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } } æšä¸¾ï¼šé€šè¿‡Javaæšä¸¾ç±»å‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯å®ä¾‹åˆ›å»ºçº¿ç¨‹çš„å®‰å…¨æ€§å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚\n// ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ public enum Singleton { INSTANCE; // å•ä¾‹ä¸­çš„æ–¹æ³•ç¤ºä¾‹ public void doSomething() { System.out.println(\u0026#34;å•ä¾‹æ–¹æ³•æ‰§è¡Œ\u0026#34;); } } // ä½¿ç”¨æ–¹æ³•ï¼š Singleton.INSTANCE.doSomething(); ä¹Ÿå¯ä»¥ç”¨å•ä¾‹é¡¹ä½œä¸ºæšä¸¾çš„æˆå‘˜å˜é‡ï¼Œç´¯åŠ å™¨å¯ä»¥åƒä¸‹é¢è¿™æ ·ç¼–å†™ï¼š\npublic enum GlobalCounter { INSTANCE; private AtomicLong atomicLong = new AtomicLong(0); public long getNumber() { return atomicLong.incrementAndGet(); } } ã€å•ä¾‹æ¨¡å¼çš„å®‰å…¨é—®é¢˜ã€‘\nåå°„å…¥ä¾µï¼šå¦‚æœæƒ³è¦é˜»æ­¢å…¶ä»–äººæ„é€ å®ä¾‹ï¼Œä»…ä»…ç§æœ‰åŒ–æ„é€ å™¨è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶æ¥è·å–ç§æœ‰æ„é€ å™¨è¿›è¡Œæ„é€ ã€‚å¦‚æœè¦é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¯ä»¥å†æ„é€ å™¨å½“ä¸­è¿›è¡Œåˆ¤æ–­å®ä¾‹æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…å¤šæ¬¡åˆ©ç”¨æ„é€ å™¨æ„é€ å®ä¾‹\npublic class Singleton { private volatile static Singleton singleton; private Singleton (){ if(singleton != null) throw new RuntimeException(\u0026#34;å®ä¾‹ï¼šã€\u0026#34; + this.getClass().getName() + \u0026#34;ã€‘å·²ç»å­˜åœ¨ï¼Œè¯¥å®ä¾‹åªå…è®¸å®ä¾‹åŒ–ä¸€æ¬¡\u0026#34;); } public static Singleton getInstance() { if (singleton == null) { synchronized (Singleton.class) { if (singleton == null) { singleton = new Singleton(); } } } return singleton; } } // åˆ©ç”¨åå°„æœºåˆ¶æ¥å…¥ä¾µæ„é€ å®ä¾‹ @Test public void testReflect() throws NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException { Class\u0026lt;DclSingleton\u0026gt; clazz = DclSingleton.class; Constructor\u0026lt;DclSingleton\u0026gt; constructor = clazz.getDeclaredConstructor(); constructor.setAccessible(true); boolean flag = DclSingleton.getInstance() == constructor.newInstance(); log.info(\u0026#34;flag -\u0026gt; {}\u0026#34;,flag); } åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šå¦‚æœå•ä¾‹å­˜åˆ°æ–‡ä»¶æµå½“ä¸­ï¼Œå†è¿›è¡Œååºåˆ—è¯ï¼Œä¹Ÿä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚ä½†æ˜¯å¯ä»¥ç”¨readResolve()çš„æ–¹æ³•ï¼Œå°†è¿”å›å€¼ä½œä¸ºååºåˆ—åŒ–çš„ç»“æœï¼Œè€Œä¸ä¼šå…‹éš†ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¿è¯jvmå½“ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚\n@Test public void testSerialize() throws IllegalAccessException, NoSuchMethodException, IOException, ClassNotFoundException { // è·å–å•ä¾‹å¹¶åºåˆ—åŒ– Singleton singleton = Singleton.getInstance(); FileOutputStream fout = new FileOutputStream(\u0026#34;D://singleton.txt\u0026#34;); ObjectOutputStream out = new ObjectOutputStream(fout); out.writeObject(singleton); // å°†å®ä¾‹ååºåˆ—åŒ–å‡ºæ¥ FileInputStream fin = new FileInputStream(\u0026#34;D://singleton.txt\u0026#34;); ObjectInputStream in = new ObjectInputStream(fin); Object o = in.readObject(); log.info(\u0026#34;ä»–ä»¬æ˜¯åŒä¸€ä¸ªå®ä¾‹å—ï¼Ÿ{}\u0026#34;,o == singleton); // å¦‚æœç›´æ¥è·å–ï¼Œååºåˆ—åŒ–åçš„ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ } // æ·»åŠ readResolve()æ¥è§£å†³åºåˆ—åŒ–å’Œååºåˆ—åŒ–é—®é¢˜ public class Singleton implements Serializable { // çœç•¥å…¶ä»–çš„å†…å®¹ public static Singleton getInstance() { } // éœ€è¦åŠ è¿™ä¹ˆä¸€ä¸ªæ–¹æ³• public Object readResolve(){ return singleton; } } ã€ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹æ¨¡å¼ã€‘\nä¸ºäº†å…¨å±€å”¯ä¸€ï¼šç³»ç»Ÿä¸­å¦‚é…ç½®ç±»ã€å…¨å±€è®¡æ•°å™¨ç­‰ç±»å‹ï¼Œåº”è¯¥éƒ½éƒ½åªèƒ½ä¿å­˜ä¸€ä»½æ•°æ®ï¼Œä¸åº”è¯¥æœ‰å¤šä»½æ•°æ®ã€‚\né…ç½®ç±»ï¼šç³»ç»Ÿä»…æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ŒåŠ è½½åˆ°å†…å­˜åæ˜ å°„æˆå”¯ä¸€çš„é…ç½®å®ä¾‹ å…¨å±€è®¡æ•°å™¨ï¼šç”¨äºæ•°æ®ç»Ÿè®¡ã€ç”Ÿæˆå…¨å±€é€’å¢id ç­‰åŠŸèƒ½ï¼Œå¿…é¡»è¦æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç»Ÿè®¡æ— æ•ˆã€ID é‡å¤ç­‰é—®é¢˜ã€‚ // å…¨å±€idç”Ÿæˆå™¨ public class GlobalCounter { private AtomicLong atomicLong = new AtomicLong(0); private static final GlobalCounter instance = new GlobalCounter(); // ç§æœ‰åŒ–æ— å‚æ„é€ å™¨ private GlobalCounter() {} public static GlobalCounter getInstance() { return instance; } public long getId() { return atomicLong.incrementAndGet(); } } // æŸ¥çœ‹å½“å‰çš„ç»Ÿè®¡æ•°é‡ long courrentNumber = GlobalCounter.getInstance().getId(); å¤„ç†èµ„æºè®¿é—®å†²çªï¼šå‡å¦‚éœ€è¦æ—¥å¿—è¾“å‡ºçš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨å•ä¾‹ié¢èµ„æºè®¿é—®å†²çª\npublic class Logger { private String basePath = \u0026#34;D://log/\u0026#34;; private static Logger instance = new Logger(); private FileWriter writer; private Logger() { File file = new File(basePath); try { writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥ } catch (IOException e) { throw new RuntimeException(e); } } public static Logger getInstance(){ //ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªloggerå®ä¾‹å¯¹è±¡ return instance; } public void log(String message) { try { writer.write(message); } catch (IOException e) { throw new RuntimeException(e); } } public void setBasePath(String basePath) { this.basePath = basePath; } } ã€å•ä¾‹æ¨¡å¼å­˜åœ¨çš„é—®é¢˜ã€‘\næ— æ³•æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹OOPï¼š OOP çš„ä¸‰å¤§ç‰¹æ€§æ˜¯å°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚å•ä¾‹æŠŠæ„é€ å‡½æ•°ç§æœ‰åŒ–äº†ï¼Œä¸æ”¯æŒç»§æ‰¿å’Œå¤šæ€ã€‚æ‰€ä»¥æ— æ³•å¯¹å®ƒè¿›è¡Œæ‹“å±•ã€‚ å¾ˆéš¾æ¨ªå‘æ‹“å±•ï¼šå•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå¦‚æœåé¢éœ€è¦è¿›è¡Œæ‹“å±•ï¼Œåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚å¿…é¡»ä¿®æ”¹æºç ï¼Œæ— æ³•å‹å¥½æ‹“å±•ã€‚ ã€ä¸åŒä½œç”¨èŒƒå›´çš„å•ä¾‹æ¨¡å¼ã€‘\nçº¿ç¨‹çº§åˆ«å•ä¾‹ï¼šå•ä¾‹ç±»å¯¹è±¡æ˜¯è¿›ç¨‹å”¯ä¸€çš„ï¼Œå¦‚æœæƒ³è¦çº¿ç¨‹å”¯ä¸€ã€‚åœ¨ä¸ä½¿ç”¨ThreadLocalçš„æ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨ConCurrentHashMap çš„æ–¹å¼ï¼Œç”¨çº¿ç¨‹idä¸ºkeyï¼Œ å®ä¾‹ä¸ºvalueã€‚æ¯ä¸ªçº¿ç¨‹çš„å­˜å–éƒ½ä»å…±äº«çš„ map å½“ä¸­è¿›è¡Œæ“ä½œã€‚\npublic class Connection { private static final ConcurrentHashMap\u0026lt;Long, Connection\u0026gt; instances = new ConcurrentHashMap\u0026lt;\u0026gt;(); private Connection() {} public static Connection getInstance() { Long currentThreadId = Thread.currentThread().getId(); instances.putIfAbsent(currentThreadId, new Connection()); return instances.get(currentThreadId); } } å®¹å™¨çº§åˆ«çš„å•ä¾‹ï¼šå°†å•ä¾‹çš„ä½œç”¨èŒƒå›´ç”±è¿›ç¨‹åˆ‡æ¢åˆ°ä¸€ä¸ªå®¹å™¨ï¼Œå¯èƒ½ä¼šæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå•ä¾‹å¯¹è±¡çš„ç®¡ç†ã€‚è¿™ä¹Ÿæ˜¯Spring çš„æ ¸å¿ƒæ€æƒ³ã€‚Spring æä¾›ä¸€ä¸ªå•ä¾‹å®¹å™¨ï¼Œç¡®ä¿ä¸€ä¸ªå®ä¾‹æ˜¯å®¹å™¨çº§åˆ«çš„å•ä¾‹ï¼Œå¹¶ä¸”åœ¨å®¹å™¨å¯åŠ¨æ—¶å®Œæˆåˆå§‹åŒ–ã€‚å…·ä½“ä¼˜åŠ¿å¦‚ä¸‹ï¼š\næ‰€æœ‰çš„bean éƒ½ä»¥å•ä¾‹çš„å½¢å¼å­˜æ”¾åœ¨å®¹å™¨ä¸­ï¼Œé¿å…å¤§é‡çš„å¯¹è±¡è¢«åˆ›å»ºï¼Œé€ æˆJVM å†…å­˜æŠ–åŠ¨ä¸¥é‡ï¼Œé¢‘ç¹GCã€‚ ç¨‹åºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–å•ä¾‹beanï¼Œ æ»¡è¶³fast-failï¼Œå°†æ‰€æœ‰æ„å»ºè¿‡ç¨‹çš„å¼‚å¸¸æš´éœ²åœ¨å¯åŠ¨æ—¶ï¼Œè€Œéè¿è¡Œæ—¶ã€‚ ç¼“å­˜äº†æ‰€æœ‰å•ä¾‹beanï¼Œå¯åŠ¨çš„è¿‡ç¨‹ç›¸å½“äºé¢„çƒ­çš„è¿‡ç¨‹ï¼Œè¿è¡Œæ—¶ä¸å¿…è¿›è¡Œå¯¹è±¡åˆ›å»ºï¼Œæ•ˆç‡æ›´é«˜ã€‚ å®¹å™¨ç®¡ç†beançš„ç”Ÿå‘½å‘¨æœŸï¼Œç»“åˆä¾èµ–æ³¨å…¥ä½¿å¾—è§£è€¦æ›´åŠ å½»åº•ã€æ‰©å±•æ€§æ›´å¥½ã€‚ 2. ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿä¸€èˆ¬ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ ç­–ç•¥æ¨¡å¼æ˜¯è¡Œä¸ºè®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼Œé€šè¿‡å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ç±»ã€‚å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ç®—æ³•ï¼Œä»è€Œå®ç°æ›´åŠ çµæ´»çš„ä»£ç ç»“æ„ã€‚è¯¥æ¨¡å¼ç”¨äºç»„ç»‡å’Œè°ƒç”¨è¿™äº›ç®—æ³•ï¼Œè®©ç¨‹åºç»“æ„å˜å¾—æ›´åŠ çµæ´»ï¼Œå…·æœ‰æ›´å¥½çš„ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚\nç­–ç•¥æ¨¡å¼ä¸€èˆ¬ç”¨äºå½“ä¸€ä¸ªåŠŸèƒ½å­˜åœ¨å¤šç§ç®—æ³•çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µä½¿ç”¨ä¸åŒçš„è®¡ç®—ç®—æ³•(éƒ½å°è£…æˆç±»çš„)ã€‚è¿™æ ·å°±å¯ä»¥é¿å…åˆ©ç”¨å¤§é‡çš„if-else æˆ–è€… switch-else\nã€ä¸ºä»€ä¹ˆè¦ç”¨ç­–ç•¥æ¨¡å¼ã€‘\né¿å…ç¨‹åºå­˜åœ¨åˆ¤æ–­æˆ–é€‰æ‹©åˆ†æ”¯è¯­å¥ï¼šå½“ç¨‹åºå­˜åœ¨å¤§é‡çš„ if-else æˆ–è€… switch-else åˆ¤æ–­è¯­å¥ï¼Œä»£ç å¯èƒ½å˜å¾—éš¾ä»¥ç»´æŠ¤ é¿å…ç ´åç°æœ‰åŠŸèƒ½ï¼šå½“ç®—æ³•çš„å®ç°ç»å¸¸å˜æ›´æˆ–éœ€è¦æ‹“å±•çš„æ—¶å€™ï¼Œç›´æ¥ä¿®æ”¹ä»£ç å¯èƒ½ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚ ã€ç­–ç•¥æ¨¡å¼çš„åœºæ™¯ã€‘\nå¤šç§ç®—æ³•å¯äº’æ¢ï¼šéœ€è¦åŠ¨æ€é€‰æ‹©ç®—æ³•ï¼Œä¾‹å¦‚æ’åºç®—æ³•çš„é€‰æ‹©ã€‚æœ‰å¾ˆå¤šç§æ’åºç®—æ³•ï¼Œå¯ä»¥æŠŠä¸åŒçš„æ’åºæ–¹å¼å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„ç®—æ³•ç±» (å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€ç›´æ¥æ’å…¥æ’åºç­‰) é¿å…æ¡ä»¶è¯­å¥ï¼šé‡‡ç”¨ç­–ç•¥æ¨¡å¼æ›¿æ¢æ‰ä»£ç å½“ä¸­çš„å¤§é‡if-else æˆ– switch è¯­å¥ ä¸ä¸Šä¸‹æ–‡ç‹¬ç«‹ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“çš„å®ç°ç»†èŠ‚ï¼Œåªéœ€ä»¥æ¥æŠ½è±¡ç­–ç•¥ã€‚ ã€ç­–ç•¥æ¨¡å¼å…¸å‹åº”ç”¨åœºæ™¯ã€‘\næ”¯ä»˜ç³»ç»Ÿï¼šæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼Œæ¯”å¦‚å¾®ä¿¡ã€æ”¯ä»˜å®ã€ä¿¡ç”¨å¡ æ•°æ®å‹ç¼©ï¼šæä¾›ä¸åŒçš„å‹ç¼©ç®—æ³• æ—¥å¿—ç­–ç•¥ï¼šæ ¹æ®æ—¥å¿—çº§åˆ«åŠ¨æ€é€‰æ‹©è®°å½•ç­–ç•¥ ã€ç­–ç•¥æ¨¡å¼çš„ç»„æˆã€‘\nStrategy ç­–ç•¥ï¼šç”¨æ¥çº¦æŸä¸€ç³»åˆ—å…·ä½“çš„ç­–ç•¥ç®—æ³•ã€‚Context ä¸Šä¸‹æ–‡ä½¿ç”¨è¿™ä¸ªæ¥å£æ¥è°ƒç”¨å…·ä½“çš„ç­–ç•¥å®ç°å®šä¹‰çš„ç®—æ³•ã€‚å¦‚æœå¤šä¸ªç®—æ³•å…·æœ‰å…¬å…±åŠŸèƒ½çš„åŒ–ï¼ŒæŠŠStrategy å®ç°ä¸ºæŠ½è±¡ç±»ï¼Œç„¶åæŠŠå¤šä¸ªç®—æ³•çš„åŠŸèƒ½å®ç°åˆ°Stragy é‡Œé¢ã€‚ (æ¯”å¦‚å¤šç§æ’åºç®—æ³•ï¼Œéƒ½æ”¾åœ¨ Strategy æŠ½è±¡ç±»é‡Œé¢) ConcreteStrategy å…·ä½“ç­–ç•¥ï¼š å…·ä½“çš„ç­–ç•¥å®ç°ï¼Œè´Ÿè´£å®ç°Strategy ç­–ç•¥çš„æ¥å£ (å¤šç§æ’åºç®—æ³•çš„å…·ä½“å®ç°) Context ä¸Šä¸‹æ–‡ï¼šä¸Šä¸‹æ–‡æ˜¯è´Ÿè´£å’Œå…·ä½“çš„ç­–ç•¥ç±»äº¤äº’ï¼Œé€šå¸¸ä¸Šä¸‹æ–‡ä¼šåƒæœ‰ä¸€ä¸ªçœŸæ­£çš„ç­–ç•¥å®ç° (å°±æ˜¯è°ƒç”¨å“ªä¸ªæ’åºæ–¹æ³•ï¼Œæ¯”å¦‚è¯´ main å‡½æ•°) 3. ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Ÿä¸€èˆ¬ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ æ¨¡æ¿æ–¹æ³•å°±æ˜¯åœ¨æŠ½è±¡ç±»é‡Œé¢å®šä¹‰å¥½ç®—æ³•çš„éª¨æ¶ï¼Œå…·ä½“æ­¥éª¤åœ¨å­ç±»å®ç°ã€‚\nã€æ¨¡æ¿æ–¹æ³•ç‰¹ç‚¹ã€‘\nç®—æ³•éª¨æ¶ï¼šåœ¨åŸºç±»ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„å›ºå®šæ‰§è¡Œæ­¥éª¤ï¼Œå…·ä½“å®ç°æ­¥éª¤äº¤ç»™å­ç±»å®ç° å¤ç”¨ä»£ç ï¼šå­ç±»å¤ç”¨åŸºç±»ä¸­å®šä¹‰çš„å…¬å…±é€»è¾‘ï¼Œåªéœ€è¦å®ç°ç‰¹å®šçš„é€»è¾‘ éµå¾ªå¼€é—­è§„åˆ™ï¼šæ¨¡æ¿æ–¹æ³•æ˜¯æ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹é—­åˆçš„ ã€å…¸å‹ä½¿ç”¨åœºæ™¯ã€‘\næ•°æ®è¯·æ±‚å¤„ç†: è¯»å–æ•°æ®ã€å¤„ç†æ•°æ®ã€è¾“å‡ºç»“æœ Webè¯·æ±‚å¤„ç†ï¼šè§£æè¯·æ±‚ã€å¤„ç†é€»è¾‘ã€è¿”å›å“åº” String Template å­—ç¬¦ä¸²æ¨¡æ¿ String name = \u0026#34;World\u0026#34;; String greeting = STR.\u0026#34;Hello, \\{name}!\u0026#34;; System.out.println(greeting); // è¾“å‡º: Hello, World! 4. è°ˆè°ˆä½ äº†è§£çš„æœ€å¸¸è§çš„å‡ ç§è®¾è®¡æ¨¡å¼ï¼Œè¯´è¯´ä»–ä»¬çš„åº”ç”¨åœºæ™¯ ã€å¸¸è§çš„è®¾è®¡æ¨¡å¼ã€‘\nå•ä¾‹æ¨¡å¼ï¼šä¿è¯ç³»ç»Ÿä¸­ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ¯”å¦‚å…¨å±€é…ç½®ã€å…¨å±€è®¡æ•°å™¨ã€æ•°æ®åº“è¿æ¥æ±  ç­–ç•¥æ¨¡å¼ï¼šå°è£…ä¸€ç»„ç®—æ³•è®©ä»–ä»¬ä¹‹é—´èƒ½å¤Ÿç›¸äº’æ›¿ä»£ï¼Œé¿å…å¤§é‡çš„if-else å’Œ switch-case è¯­å¥ï¼Œæ¯”å¦‚ç”¨æˆ·é€‰æ‹©ä¸åŒçš„æ”¯ä»˜ç­–ç•¥ï¼Œæˆ–è€…è°ƒç”¨ä¸åŒçš„æ’åºç®—æ³•ã€‚ æ¨¡æ¿æ¨¡å¼ï¼šæç‚¼æ ¸å¿ƒæµç¨‹å°è£…æˆä¸€ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚åƒæ”¯ä»˜é€»è¾‘(å‚æ•°æ ¡éªŒã€è°ƒèµ·æ”¯ä»˜æ¥å£ã€ä¿®æ”¹æ”¯ä»˜çŠ¶æ€)ï¼Œé™¤äº†è°ƒèµ·æ”¯ä»˜æ¥å£ä»¥å¤–ï¼Œå…¶ä»–çš„æµç¨‹åŸºæœ¬ä¸€è‡´ã€‚æ‰€ä»¥å¯ä»¥å°è£…æˆæ¨¡æ¿æ–¹æ³•ï¼Œç„¶åæŠŠè°ƒèµ·æ”¯ä»˜æ¥å£çš„æ“ä½œï¼Œåœ¨å…·ä½“å®ç°æ–¹æ³•å½“ä¸­é‡å†™è¯¥æ–¹æ³•ã€‚ ç®€å•å·¥å‚æ¨¡å¼ï¼šè·å–ä¸åŒçš„å¯¹è±¡æ—¶å¯ä»¥ä½¿ç”¨ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘æŠ½ç¦»å¤ç”¨ã€‚ å¤–è§‚æ¨¡å¼ï¼šä¸ºå­ç³»ç»Ÿæä¾›ä¸€ç»„ç»Ÿä¸€æ¥å£ï¼Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œæ–¹ä¾¿å­ç³»ç»Ÿç›´æ¥è°ƒç”¨ï¼Œè€Œæ— éœ€å…³æ³¨å®ç°ç»†èŠ‚(æ¯”å¦‚é«˜å¾·å’Œç™¾åº¦çš„ SDK) ä»£ç†æ¨¡å¼ï¼šé€šè¿‡åˆ›å»ºä»£ç†å¯¹è±¡æ¥æ§åˆ¶å“¦å¯¹å®é™…å¯¹è±¡çš„è®¿é—®ï¼Œä¾‹å¦‚Sping AOPåˆ‡é¢ç¼–ç¨‹é‡‡ç”¨ä»£ç†æ¨¡å¼æ¥åŠ¨æ€ç”Ÿæˆå¢å¼ºç›®æ ‡å¯¹è±¡çš„ä»£ç† (é€šè¿‡ JDK åŠ¨æ€ä»£ç†æˆ–è€…CGLIBä»£ç†) ã€‚Sping AOP é»˜è®¤ä¼˜å…ˆä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚å½“ç›®æ ‡ç±»æœªå®ç°æ¥å£æ—¶ï¼Œæ‰ä¼šåˆ‡æ¢ä¸º CGLIB åŠ¨æ€ä»£ç†ã€‚ ã€Springä¸­çš„è®¾è®¡æ¨¡å¼ã€‘\n5. ä½ è®¤ä¸ºå¥½çš„ä»£ç åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ ã€é€šä¿—æ˜“æ‡‚çš„è®²ã€‘\næ¸…æ™°æ˜“æ‡‚ï¼Œä¿æŒç®€æ´å’Œæ˜“è¯»æ€§ï¼šä»£ç ç®€æ´ã€ç›´è§‚ï¼Œå‡½æ•°å’Œå˜é‡å‘½åéƒ½æœ‰æ„ä¹‰ï¼Œå¯è¯»æ€§éå¸¸å¼ºï¼Œæœ‰åˆç†çš„æ³¨é‡Šã€‚ é«˜å†…èšä½è€¦åˆï¼šé«˜å†…èšæ˜¯æŒ‡ä»£ç æ¨¡å—å†…éƒ¨åŠŸèƒ½é›†ä¸­ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰å•ä¸€èŒè´£ã€‚ä½è€¦åˆæŒ‡çš„æ˜¯ä¸åŒæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å°½é‡æ¾æ•£ï¼Œä¿®æ”¹ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå…¶ä»–æ¨¡å—å—åˆ°çš„å½±å“æ¯”è¾ƒå°ã€‚ å¯æµ‹è¯•ï¼šæ¯ä¸ªæ¨¡å—éƒ½è®¾è®¡ä¸ºç‹¬ç«‹çš„ã€å¯éªŒè¯çš„å•å…ƒï¼Œç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œèƒ½å¤Ÿç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å¹¶ä¸”å‘ç°æ½œåœ¨é—®é¢˜ã€‚ æ˜“äºæ‰©å±•ï¼Œéµå¾ªå¼€é—­åŸåˆ™ï¼šä»£ç å…·æœ‰ä¸€å®šçµæ´»æ€§ï¼Œèƒ½åœ¨ä¸ç ´åç°æœ‰åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œæ–¹ä¾¿è¿›è¡Œæ‰©å±•å’Œä¿®æ”¹ã€‚ ç¬¦åˆå›¢é˜Ÿè§„èŒƒï¼šä»£ç é£æ ¼å’Œå›¢é˜Ÿæ•´ä½“ä»£ç è§„èŒƒç»Ÿä¸€ï¼Œæœ‰åŠ©äºååŠ©å›¢é˜Ÿåä½œå’Œä»£ç å®¡æŸ¥ã€‚ å‡å°‘ç¡¬ç¼–ç ã€é­”æ³•å€¼ï¼šå°½é‡é¿å…ç¡¬ç¼–ç å’Œé­”æ³•å€¼çš„ç°è±¡ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œä¿®æ”¹ã€‚ ã€å¥½ä»£ç å…·å¤‡ä»¥ä¸‹ç‰¹æ€§ã€‘\nè®¾è®¡åŸåˆ™ ä»£ç ç‰¹æ€§ ç»“æœ å•ä¸€èŒè´£ ç±»æˆ–æ¨¡å—èŒè´£å•ä¸€ é™ä½ç±»çš„å¤æ‚åº¦ï¼Œå¢å¼ºå¯è¯»æ€§å’Œç»´æŠ¤æ€§ å¼€é—­åŸåˆ™ å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ æé«˜æ‰©å±•æ€§ï¼Œå‡å°‘å¯¹å·²æœ‰ä»£ç çš„ä¿®æ”¹ é«˜å†…èšä½è€¦åˆ æ¨¡å—èŒè´£æ˜ç¡®ï¼Œä¾èµ–å…³ç³»æ¾æ•£ å¢å¼ºä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ æ¥å£éš”ç¦»åŸåˆ™ æ¥å£å°ä¸”ä¸“ç”¨ å‡å°‘æ— å…³å®ç°ä»£ç ï¼Œå¢å¼ºæ¥å£çš„çµæ´»æ€§ ä¾èµ–å€’ç½® ä¾èµ–äºæŠ½è±¡è€Œéå…·ä½“å®ç° é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œæé«˜ä»£ç çµæ´»æ€§ åˆæˆå¤ç”¨åŸåˆ™ ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ æé«˜çµæ´»æ€§ï¼Œé¿å…ç»§æ‰¿å¯¼è‡´çš„é«˜èšåˆ é‡Œæ°æ›¿æ¢åŸåˆ™ å­ç±»å¯ä»¥æ— ç¼æ›¿æ¢çˆ¶ç±» ç¡®ä¿ç»§æ‰¿ä½“ç³»çš„æ­£ç¡®æ€§ï¼Œå¢å¼ºä»£ç çš„ç¨³å®šæ€§ è¿ªç±³ç‰¹æ³•åˆ™ å‡å°‘ç±»ä¹‹é—´çš„ä¾èµ– é™ä½è€¦åˆåº¦ï¼Œå¢å¼ºæ¨¡å—ç‹¬ç«‹æ€§ 6. å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ã€å·¥å‚æ¨¡å¼ã€‘\nå¯¹è±¡ï¼šåˆ›å»ºä¸€ç§ç±»å‹çš„äº§å“å¯¹è±¡ï¼Œæ¯”å¦‚è®©googleåˆ›å»ºå®‰å“ç³»ç»Ÿï¼Œ ä¸åŒå“ç‰Œçš„æ‰‹æœºå‚å•†(å·¥å‚å­ç±»)å°±å¯ä»¥æ ¹æ®å®‰å“ç³»ç»Ÿå½“ä¸­çš„åŠŸèƒ½ï¼Œé‡å†™å‡ºå…¶ä»–çš„os ç³»ç»Ÿï¼Œæ¯”å¦‚é¸¿è’™ç³»ç»Ÿã€æ¾æ¹ƒç³»ç»Ÿç­‰ç­‰ å·¥å‚ç»“æ„ï¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡çš„å·¥å‚ç±»ï¼Œå®šä¹‰åˆ›å»ºäº§å“çš„æŠ½è±¡æ–¹æ³•ï¼Œç„¶åå…·ä½“çš„å·¥å‚å­ç±»å»å®ç°è¿™ä¸ªæ–¹æ³•æ¥å®é™…åˆ›å»ºå…·ä½“çš„äº§å“ã€‚æ¯”å¦‚ android ç³»ç»Ÿçš„æºç æ˜¯å¤§å®¶éƒ½å¯ä»¥çœ‹åˆ°çš„ï¼Œå…¶ä»–å‚å•†ä¹Ÿå¯ä»¥æ ¹æ®android ç³»ç»Ÿçš„è®¾è®¡ï¼Œé‡æ–°å®ç°éƒ¨åˆ†å‡½æ•°ï¼Œä¿®æ”¹æˆå…¶ä»–çš„åŠŸèƒ½ã€‚ ä½¿ç”¨åœºæ™¯ï¼šå½“åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæƒ³æŠŠå¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»æ—¶å¸¸ç”¨ï¼Œæ¯”å¦‚åˆ›å»ºæ•°æ®åº“è¿æ¥å¯¹è±¡ç­‰ç®€å•çš„å•ä¸€äº§å“åˆ›å»ºåˆ›å»ºé€‚ç”¨ã€‚ ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€‘\nå¯¹è±¡ï¼šç”¨äºåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡ï¼Œæ¯”å¦‚åˆ›å»ºæ‰‹æœºçš„æ—¶å€™ï¼Œéœ€è¦è¿å¸¦åˆ›å»ºé…å¥—çš„å……ç”µå™¨ã€è€³æœºç­‰é…å¥—äº§å“ å·¥å‚ç»“æ„ï¼šæŠ½è±¡å·¥å‚ç±»å®šä¹‰äº†å¤šä¸ªæŠ½è±¡åˆ›å»ºæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³çš„äº§å“ã€‚æ›´å…·ä½“çš„å·¥å‚å­ç±»è¦å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ï¼Œæä¾›ä¸€æ•´å¥—çš„å…·ä½“äº§å“çš„åˆ›å»ºã€‚ ä½¿ç”¨åœºæ™¯ï¼šå½“ç³»ç»Ÿè¦åˆ›å»ºå¤šä¸ªç›¸äº’ä¾èµ–æˆ–è€…å…³è”çš„å¯¹è±¡çš„æ—¶å€™ï¼Œç¡®ä¿è¿™äº›å¯¹è±¡æ­é…åˆç†ã€‚æ¯”å¦‚æ¸¸æˆå¼€å‘ä¸­åˆ›å»ºä¸åŒé£æ ¼(æ¯”å¦‚ç§‘æŠ€é£æ ¼ã€å¤é£)çš„è§’è‰²ã€æ­¦å™¨ã€åœºæ™¯ç­‰ä¸€æ•´å¥—ç›¸å…³çš„å…ƒç´ æ—¶ï¼Œå°±é€‚åˆç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ // æŠ½è±¡äº§å“A public interface ProductA { void use(); } // å…·ä½“äº§å“A1 -\u0026gt; æ‰‹æœº public class ConcreteProductA1 implements ProductA { @Override public void use() { System.out.println(\u0026#34;Using ConcreteProductA1\u0026#34;); } } // å…·ä½“äº§å“A2 -\u0026gt; ç”µè„‘ public class ConcreteProductA2 implements ProductA { @Override public void use() { System.out.println(\u0026#34;Using ConcreteProductA2\u0026#34;); } } // æŠ½è±¡äº§å“B public interface ProductB { void eat(); } // å…·ä½“äº§å“B1 -\u0026gt; æ‰‹æœºå……ç”µçº¿ public class ConcreteProductB1 implements ProductB { @Override public void eat() { System.out.println(\u0026#34;Eating ConcreteProductB1\u0026#34;); } } // å…·ä½“äº§å“B2 -\u0026gt; ç”µè„‘å……ç”µçº¿ public class ConcreteProductB2 implements ProductB { @Override public void eat() { System.out.println(\u0026#34;Eating ConcreteProductB2\u0026#34;); } } // æŠ½è±¡å·¥å‚ -\u0026gt; æŠŠä¸¤ä¸ªç›¸äº’å…³è”çš„æŠ½è±¡äº§å“ä¸€èµ·åˆ›å»º public interface AbstractFactory { ProductA createProductA(); ProductB createProductB(); } // å…·ä½“å·¥å‚1 public class ConcreteFactory1 implements AbstractFactory { @Override public ProductA createProductA() { return new ConcreteProductA1(); } @Override public ProductB createProductB() { return new ConcreteProductB1(); } } // å…·ä½“å·¥å‚2 public class ConcreteFactory2 implements AbstractFactory { @Override public ProductA createProductA() { return new ConcreteProductA2(); } @Override public ProductB createProductB() { return new ConcreteProductB2(); } } // ä½¿ç”¨æŠ½è±¡å·¥å‚åˆ›å»ºäº§å“ public class Client { public static void main(String[] args) { AbstractFactory factory1 = new ConcreteFactory1(); ProductA productA1 = factory1.createProductA(); ProductB productB1 = factory1.createProductB(); productA1.use(); productB1.eat(); AbstractFactory factory2 = new ConcreteFactory2(); ProductA productA2 = factory2.createProductA(); ProductB productB2 = factory2.createProductB(); productA2.use(); productB2.eat(); } } ","permalink":"https://swimmingliu.cn/posts/job/desgin-mode-interview-questions/","summary":"\u003ch2 id=\"1-å•ä¾‹æ¨¡å¼æœ‰å“ªå‡ ç§å®ç°å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨\"\u003e1. å•ä¾‹æ¨¡å¼æœ‰å“ªå‡ ç§å®ç°ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆï¼Œå•ä¾‹æ¨¡å¼å’Œå·¥å‚æ¨¡å¼éƒ½æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼å½“ä¸­ï¼Œä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡(æˆ–è€…è¯´å®ä¾‹)ï¼Œ é‚£è¿™ä¸ªç±»å°±æ˜¯å•ä¾‹ç±»ã€‚å•ä¾‹ç±»æ˜¯ä¸å¯ä»¥è¢«ç»§æ‰¿çš„ï¼Œä¹Ÿæ²¡æœ‰äº†å¤šæ€çš„ç‰¹æ€§ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€å•ä¾‹ç±»çš„å®ç°æ–¹å¼ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå¸¸è§„å•ä¾‹æ¨¡å¼æœ‰äº”ç§å†™æ³•ï¼Œä½†æ˜¯ç¼–å†™ä»£ç çš„è¿‡ç¨‹å½“ä¸­ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæ„é€ å™¨éœ€è¦ç§æœ‰åŒ–\u003c/li\u003e\n\u003cli\u003eæš´éœ²ä¸€ä¸ªå…¬å…±è·å–å•ä¾‹å¯¹è±¡çš„æ¥å£ ï¼ˆ\u003ccode\u003eobj.getInstance()\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003eæ˜¯å¦æ”¯æŒæ‡’åŠ è½½ \u003ccode\u003eå»¶è¿ŸåŠ è½½\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eæ˜¯å¦çº¿ç¨‹å®‰å…¨\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eäº”ç§å†™æ³•ä¸ºï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eé¥¿æ±‰å¼\u003c/strong\u003eï¼š ç±»åŠ è½½çš„æ—¶å€™ï¼Œå°±ä¸€èµ·æŠŠ \u003ccode\u003einstance\u003c/code\u003e é™æ€å®ä¾‹åˆ›å»ºå¥½äº†ï¼Œæ‰€ä»¥åˆ›å»ºçš„è¿‡ç¨‹å¸‚çº¿ç¨‹å®‰å…¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eé¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼è™½ç„¶ä¸æ”¯æŒæ‡’åŠ è½½ï¼Œæœ‰ç‚¹æµªè´¹èµ„æºã€‚ä½†å…¶å®ä¸ä¼šå ç”¨å¤ªå¤šèµ„æºï¼Œå¹¶ä¸”å¦‚æœä¸€ä¸ªå®ä¾‹åˆå§‹åŒ–çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå°±åº”è¯¥æ”¾åœ¨å¯åŠ¨çš„æ—¶å€™æ¥å¤„ç†ï¼Œé¿å…è¿è¡Œæ—¶å¡é¡¿æˆ–å‘ç”Ÿé—®é¢˜ï¼Œ æ»¡è¶³\u003ccode\u003efail-fast\u003c/code\u003e å¤±è´¥å¿«é€Ÿè§£å†³çš„è®¾è®¡åŸåˆ™\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEagerSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(){}\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \t\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ‡’æ±‰å¼\u003c/strong\u003eï¼šç›¸è¾ƒäºé¥¿æ±‰å¼çš„æ–¹å¼ï¼Œä¿®æ”¹æˆå»¶è¿ŸåŠ è½½çš„æ¨¡å¼ã€‚æ³¨æ„\u003ccode\u003egetInstance()\u003c/code\u003eæ–¹æ³•æ²¡æœ‰ä¸Šé”çš„è¯ï¼Œåœ¨å¤§é‡çº¿ç¨‹å¹¶å‘è¯·æ±‚çš„æ—¶å€™ï¼Œå¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(){}\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003esynchronized\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eSingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eåŒé‡æ£€æŸ¥é”\u003c/strong\u003eï¼šé¥¿æ±‰å¼é”ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œç„¶åæ‡’æ±‰å¼é”çš„ç²’åº¦æ¯”è¾ƒå¤§ï¼Œä¸æ”¯æŒé«˜å¹¶å‘ã€‚åŒé‡æ£€æŸ¥é”å¯ä»¥å®ç°æ—¢å»¶è¿ŸåŠ è½½ï¼Œåˆæ”¯æŒé«˜å¹¶å‘ã€‚å…¶å®å°±æ˜¯åœ¨åˆ¤æ–­äº†æ²¡æœ‰å®ä¾‹ä¹‹åï¼Œå†è¿›è¡Œä¸Šé”ï¼Œåˆ›å»ºå®ä¾‹ã€‚ ä½†æ˜¯å®ä¾‹å¿…é¡»ç”¨\u003ccode\u003evolatile\u003c/code\u003e ä¿®é¥°ï¼Œä¸ç„¶\u003ccode\u003enew\u003c/code\u003e æ“ä½œåˆ›å»ºå¯¹è±¡æ—¶ï¼Œå®¹æ˜“å‡ºç°é‡æ’åºçš„é—®é¢˜ã€‚\u003c/p\u003e","title":"è®¾è®¡æ¨¡å¼é¢è¯•é¢˜ç¬”è®°"},{"content":"1. ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Ÿ JMM æ˜¯ Javaå†…å­˜æ¨¡å‹ ï¼Œ å®ƒæ˜¯Javaè™šæ‹Ÿæœº JVM å®šä¹‰çš„ä¸€ç§è§„èŒƒï¼Œç”¨äºæè¿°å¤šçº¿ç¨‹ç¨‹åºä¸­çš„å˜é‡ï¼Œåƒå®ä¾‹å­—æ®µã€é™æ€å­—æ®µå’Œæ•°ç»„å…ƒç´ ï¼Œä»–ä»¬å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨å’Œä¼ é€’çš„è§„åˆ™ã€‚ä¹Ÿå°±æ˜¯è§„å®šçº¿ç¨‹å•¥æ—¶å€™ä»ä½å†…å­˜é‡Œé¢è¯»æ•°æ®ï¼Œå•¥æ—¶å€™æŠŠæ•°æ®å†™å›åˆ°ä½å†…å­˜ã€‚JMM çš„æ ¸å¿ƒç›®æ ‡æ˜¯ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§, é¿å…ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„ä¸ä¸€è‡´é—®é¢˜ã€‚\nJMM å½“ä¸­åŒ…å«ä¸»å†…å­˜ (æ‰€æœ‰çº¿ç¨‹å…±äº«) å’Œ å·¥ä½œå†…å­˜ ï¼ˆæ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼‰ä¸¤ç§å†…å­˜ã€‚\nä¸»å†…å­˜ï¼šä¸»å†…å­˜æ˜¯Javaå †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œå­˜å‚¨å…¨å±€å˜é‡ï¼Œæ¯”å¦‚é™æ€å˜é‡ã€å®ä¾‹å­—æ®µã€æ•°ç»„å…ƒç´ ç­‰ç­‰ã€‚çº¿ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ï¼Œå¿…é¡»é€šè¿‡å·¥ä½œå†…å­˜é—´æ¥è®¿é—®ã€‚ å·¥ä½œå†…å­˜ï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œç¼“å­˜ä¸»å†…å­˜çš„å˜é‡å‰¯æœ¬ã€‚çº¿ç¨‹å¯¹å˜é‡çš„è¯»å†™æ“ä½œå‡åœ¨å·¥ä½œå†…å­˜ç§è¿›è¡Œï¼Œä¿®æ”¹åçš„ç»“æœéœ€è¦åŒæ­¥ä¼šä¸»å†…å­˜ã€‚çº¿ç¨‹æ˜¯é€šè¿‡å†…å­˜å±éšœ ( volatile å…³é”®å­—) æˆ–è€… åŒæ­¥æ“ä½œ ( synchronized ) å®ç°ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„æ•°æ®ä¸€è‡´æ€§çš„ã€‚ ã€å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§å®šä¹‰ã€‘\nå¯è§æ€§ï¼šç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œèƒ½å¤ŸåŠæ—¶è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°ã€‚ volatileå°±æ˜¯ç”¨æ¥ä¿è¯å¯è§æ€§çš„ï¼Œå¼ºåˆ¶çº¿ç¨‹æ¯æ¬¡è¯»å†™çš„æ—¶å€™ï¼Œç›´æ¥ä»ä¸»å†…å­˜å½“ä¸­è·å–æœ€æ–°å€¼ã€‚ æœ‰åºæ€§ï¼šæŒ‡çº¿ç¨‹æ‰§è¡Œæ“ä½œçš„é¡ºåºã€‚JMMå…è®¸æŸäº›æŒ‡ä»¤é‡æ’åºä¹‹åå†æé«˜æ€§èƒ½ï¼Œä½†ä¼šä¿è¯çº¿ç¨‹å†…çš„æ“ä½œé¡ºåºä¸ä¼šè¢«ç ´åã€‚é€šè¿‡happens-before (çº¿ç¨‹Aå‘ç”Ÿåœ¨çº¿ç¨‹Bä¹‹å‰)çš„å…³ç³»æ¥ä¿è¯è·¨çº¿ç¨‹çš„æœ‰åºæ€§ã€‚ åŸå­æ€§ï¼šæ“ä½œä¸å¯åˆ†å‰²ï¼Œçº¿ç¨‹ä¸ä¼šåœ¨æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­è¢«æ‰“æ–­ã€‚ä¾‹å¦‚, synchronize å…³é”®å­—èƒ½ç¡®ä¿æ–¹æ³•æˆ–ä»£ç å—çš„åŸå­æ€§ ã€JMMä½œç”¨ã€‘\nå› ä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿéƒ½æœ‰ä¸€å¥—ç‹¬ç«‹çš„å†…å­˜æ¨¡å‹ï¼Œä½†æ˜¯Javaä¸ºäº†æ»¡è¶³è·¨å¹³å°çš„ç‰¹æ€§ï¼Œå®ƒéœ€è¦å®šä¹‰ä¸€å¥—å†…å­˜æ¨¡å‹å±è”½ä¸ªæ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨JMMå½“ä¸­å®šä¹‰å¥½çš„ä»Javaæºç åˆ°CPUæŒ‡ä»¤çš„æ‰§è¡Œè§„èŒƒï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨synchronized ã€volatile ç­‰å…³é”®å­—ï¼Œè¿˜æœ‰happens-beforeåŸåˆ™ï¼Œå°±å¯ä»¥å†™å‡ºå¹¶å‘å®‰å…¨çš„ä»£ç äº†ã€‚ æ¯”å¦‚è¯´ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ“ä½œ å˜é‡-1ï¼Œå‡å¦‚æœ€å¼€å§‹å˜é‡-1 æ˜¯ 0\né¦–å…ˆï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½è¯»å–äº†å˜é‡-1 ç„¶åï¼Œçº¿ç¨‹Bå¯¹å–åˆ°çš„å˜é‡-1è‡ªå¢ä¸º1ï¼Œå¹¶å†™å›ä¸»å†…å­˜ æ­¤æ—¶ï¼Œçº¿ç¨‹Aå¯¹è¯»å–åˆ°çš„å˜é‡-1ä¹Ÿè‡ªå¢1ï¼Œå¹¶å†™å›ä¸»å†…å­˜ã€‚è¿™å°±ä¼šå¯¼è‡´çº¿ç¨‹Bçš„æ“ä½œå¤±æ•ˆäº†ï¼Œå‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜ã€‚ å¦‚æœæœ‰JMMï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨çº¿ç¨‹Aè¦ä¿®æ”¹æ•°æ®ä¹‹å‰,è®©å®ƒé‡‡ç”¨CASä¹è§‚é”çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚å†æ¬¡å»è¯»ä¸»å†…å­˜å½“ä¸­çš„å€¼ï¼Œç„¶åä¿®æ”¹ä¹‹åï¼Œå†åˆ¤æ–­ä¸€ä¸‹ä¸»å†…å­˜çš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±å†™å›ä¸»å†…å­˜ã€‚å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œå°±è¦è¿›è¡Œè‡ªæ—‹ã€‚\nã€æ³¨æ„ã€‘ å·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯çœ‹ä¸åˆ°çš„ã€‚ä¸»å†…å­˜æ˜¯Javaå †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å®ä¾‹å˜é‡ã€é™æ€å˜é‡å’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜å½“ä¸­ã€‚\nã€å†…å­˜é—´äº¤äº’æ“ä½œç±»å‹ (8ç§åŸå­æ“ä½œ)ã€‘\nlock ä¸Šé”ï¼šæŠŠä¸€ä¸ªå˜é‡è¡¨ç¤ºä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ unlock è§£é”ï¼š æŠŠä¸€ä¸ªå˜é‡ä»ç‹¬å çŠ¶æ€ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹é”å®š read è¯»å–ï¼š ä»ä¸»å†…å­˜å½“ä¸­è¯»å–ä¸€ä¸ªå˜é‡åˆ°å·¥ä½œå†…å­˜ä¸­ load è½½å…¥ï¼šæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬å½“ä¸­ use ä½¿ç”¨ï¼šæŠŠå·¥ä½œå†…å­˜å½“ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ assign èµ‹å€¼ï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ store å­˜å‚¨ï¼šæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€ç»™ä¸»å†…å­˜ä¸­ write å†™å…¥ï¼šæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ ã€volatile ç‰¹æ®Šè§„åˆ™ã€‘\nå¯è§æ€§ï¼šå¯¹äº volatile ä¿®é¥°çš„å˜é‡çš„å†™æ“ä½œä¼šç«‹å³åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼Œä»»ä½•çº¿ç¨‹å¯¹è¿™ä¸ªvolatile å˜é‡çš„è¯»æ“ä½œéƒ½èƒ½ç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼š åœ¨å¯¹ volatile å˜é‡è¿›è¡Œè¯»/å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šæ’å…¥å†…å­˜å±éšœï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚ä¹Ÿå°±æ˜¯è¯¥å˜é‡çš„å†™æ“ä½œä¸èƒ½ä¸ä¹‹å‰çš„è¯»/å†™æ“ä½œé‡æ’åºï¼Œå®ƒçš„éƒ½æ“ä½œä¸èƒ½ä¸ä¹‹åçš„è¯»/å†™æ“ä½œé‡æ’åºã€‚ ã€Happens-Before åŸåˆ™ã€‘\nè§ä¸‹ä¸€ä¸ªé—®é¢˜\n2. ä»€ä¹ˆæ˜¯Javaçš„ happens-before è§„åˆ™? happens-before åŸåˆ™å°±æ˜¯ JMM å½“ä¸­å®šä¹‰æ“ä½œé—´é¡ºåºçš„è§„åˆ™ï¼Œç¡®ä¿æ“ä½œçš„æœ‰åºæ€§å’Œå¯è§æ€§ã€‚\nç¨‹åºæ¬¡åºè§„åˆ™ï¼šçº¿ç¨‹å½“ä¸­æ‰€æœ‰æ“ä½œéƒ½æ˜¯æŒ‰ç¨‹åºä»£ç çš„é¡ºåºå‘ç”Ÿ ç›‘è§†å™¨é”è§„åˆ™ï¼šè§£é”æ“ä½œå‘ç”Ÿåœ¨åŒä¸€ä¸ªé”çš„éšåçš„åŠ é”æ“ä½œä¹‹å‰ï¼Œè¯´ç™½äº†ï¼Œå…ˆè§£é”ï¼Œåä¸Šé” volatile å˜é‡è§„åˆ™ï¼š volatile å˜é‡çš„å†™æ“ä½œå‘ç”Ÿåœ¨å¯¹æ”¹å˜é‡éšåçš„è¯»æ“ä½œä¹‹å‰ï¼Œå…ˆå†™åè¯» çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šçº¿ç¨‹Aå¯¹çº¿ç¨‹Bçš„Thread.start() è°ƒç”¨å‘ç”Ÿåœ¨è¿™ä¸ªæ–°çº¿ç¨‹çš„æ¯ä¸€ä¸ªæ“ä½œä¹‹å‰ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹Aæ‰€æœ‰çš„æ“ä½œéƒ½å‘ç”Ÿåœ¨å…¶ä»–çº¿ç¨‹æ£€æµ‹åˆ°çº¿ç¨‹Aç»ˆæ­¢ä¹‹å‰ çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹çš„ä¸­æ–­æ“ä½œ (Thread.interrupt()) å‘ç”Ÿåœ¨è¢«ä¸­æ–­çº¿ç¨‹æ£€æµ‹åˆ°çš„ä¸­æ–­æ—¶é—´ä¹‹å‰ (é€šè¿‡Thread.interrupted() æˆ– Thread.isInterrupted() è¿›è¡Œæ£€æµ‹) å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼š ä¸€ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°æ‰§è¡Œç»“æŸå‘ç”Ÿåœ¨è¿™ä¸ªå¯¹è±¡çš„finalize() æ–¹æ³•ä¹‹å‰ ä¼ é€’æ€§ï¼š å¦‚æœA happens-before Bï¼ŒB happens-before C, åˆ™ A happens-before C 3. Java çš„ synchronized æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ ã€å®ç°åŸç†ã€‘\nsynchronized å…³é”®å­—æ˜¯ä»¥æ¥ JVM çš„Monitor (ç›‘è§†å™¨é”)å’Œ Object Header (å¯¹è±¡å¤´) å®ç°çš„ã€‚å…¶ä¸­ï¼Œé‡é‡çº§æ‰€ä¾èµ–äº Monitor ç›‘è§†å™¨é”ï¼Œ è½»é‡çº§é”å’Œåå‘é”éƒ½ä¾èµ–äºå¯¹è±¡å¤´ (Object Header)\nã€ä¸åŒä½¿ç”¨åœºæ™¯çš„åŒºåˆ«ã€‘\nä¿®é¥°æ–¹æ³•ï¼šä¼šåœ¨ä¿®é¥°çš„æ–¹æ³•çš„è®¿é—®æ ‡å¿—ä¸­å¢åŠ ä¸€ä¸ª ACC_SYNCHRONIZED æ ‡å¿—ï¼Œæ¯å½“æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥æ–¹æ³•æ—¶ï¼Œ JVMå›å»æ£€æµ‹è¯¥æ–¹æ³•çš„è®¿é—®æ ‡å¿—ã€‚å¦‚æœåŒ…å«ACC_SYNCHRONIZED æ ‡å¿—ï¼Œ çº¿ç¨‹å¿…é¡»è·å¾—è¯¥æ–¹æ³•å¯¹åº”çš„å¯¹è±¡ç›‘è§†å™¨é” (å¯¹è±¡é”)ï¼Œä¹Ÿå°±æ˜¯Monitor å½“ä¸­çš„owneræ‰§è¡Œè¯¥çº¿ç¨‹ã€‚ ç„¶åå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œä¿æŒåŒæ­¥æ€§ã€‚ ä¿®é¥°ä»£ç å—ï¼šåœ¨ä»£ç å—çš„å‰ååˆ†åˆ«æ’å…¥ monitorenter å’Œ monitorexit å­—èŠ‚ç æŒ‡ä»¤ï¼Œ å¯ä»¥ç†è§£ä¸ºåŠ é”å’Œè§£é” ã€å¯é‡å…¥æ€§ã€‘\nsynchronized æ˜¯å¯ä»¥é‡å…¥çš„ï¼Œæ¯æ¬¡è·å–ä¸€æ¬¡é”ã€‚å¦‚æœæ˜¯å½“å‰çº¿ç¨‹çš„é”ï¼Œè®¡æ•°å™¨åŠ 1ï¼Œé”é‡Šæ”¾çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å‡1ã€‚ç›´åˆ°è®¡æ•°å™¨å‡ä¸º 0 ä¸ºæ­¢ï¼Œé”æ‰çœŸæ­£é‡Šæ”¾\nã€synchronized é”å‡çº§ã€‘\nsynchronized é”åˆ†ä¸ºä¸‰ç§ï¼Œåå‘é”ï¼Œè½»é‡çº§é”ï¼Œé‡é‡çº§é”ã€‚å…¶å‡çº§æ¬¡åºä¸ºåå‘é”(ä¸€ä¸ªçº¿ç¨‹) -\u0026gt; è½»é‡çº§é” (å¤šä¸ªçº¿ç¨‹) -\u0026gt; é‡é‡çº§é” (å¤šä¸ªçº¿ç¨‹ç«äº‰æ¿€çƒˆ)\nåå‘é”ï¼šå½“æœ‰çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”çš„æ—¶å€™ï¼Œ JVM ä¼šé‡‡ç”¨ä¿®æ”¹é”å¯¹è±¡çš„å¯¹è±¡å¤´ï¼Œå°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºåå‘çŠ¶æ€ã€‚å¯¹è±¡å¤´é‡Œé¢ä¼šè®°å½•çº¿ç¨‹ID å’Œ å¯¹åº”çš„epoch åå‘é”ç‰ˆæœ¬ã€‚åç»­è¯¥çº¿ç¨‹å†è·å–é”ï¼ŒåŸºæœ¬æ²¡å•¥å¼€é”€ã€‚ è½»é‡çº§é”ï¼šå½“æœ‰å¦å¤–çš„çº¿ç¨‹å°è¯•å»è·å–å·²ç»è¢«åå‘çš„é”æ—¶ï¼Œé”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚æ­¤æ—¶ï¼Œç”³è¯·ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼ŒJVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼ˆåŒ…æ‹¬æ‰€æœ‰çš„å±€éƒ¨å˜é‡ã€å‚æ•°å’Œè¿”å›åœ°å€ï¼‰ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•Lock Recordï¼Œè®©é”è®°å½•æŒ‡å‘é”å¯¹è±¡ã€‚ç„¶åç”¨ CAS æ›¿æ¢é”å¯¹è±¡çš„Mark Wordï¼Œ å¹¶å°†Mark Word çš„å€¼å­˜å…¥é”è®°å½•ã€‚å¦‚æœæ›¿æ¢æˆåŠŸï¼Œé”å¯¹è±¡çš„Mark Word å°±å˜æˆå½“å‰çº¿ç¨‹çš„æ‰€é”è®°å½•ã€‚ä½¿ç”¨ CAS æ“ä½œçš„ç›®çš„æ˜¯å‡å°‘é”ç«äº‰çš„å¼€é”€ã€‚ é‡é‡çº§é”ï¼šå½“ CAS å¤±è´¥æ— æ³•è·å–é”çš„æ—¶å€™ï¼ŒJVMåˆ¤å®šå…¶ä¸ºå¤šä¸ªçº¿ç¨‹ç«äº‰é”æ¿€çƒˆã€‚é”ä¼šå‡çº§æˆä¸ºé‡é‡é”ï¼Œä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ Mutex æ¥å®ç°çº¿ç¨‹çš„é˜»å¡å’Œç¯å½¢ã€‚è‹¥æœè·å–é”æˆåŠŸï¼Œçº¿ç¨‹ä¼šè¢«æ”¾å…¥Monitorçš„ owner å½“ä¸­ ã€é”æ¶ˆé™¤å’Œé”ç²—åŒ–ã€‘\né”æ¶ˆé™¤ï¼šJVMåˆ¤æ–­å¯¹è±¡æ˜¯å¦åªåœ¨å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œå¦‚æœåªåœ¨å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œåˆ™æ¶ˆé™¤ä¸å¿…è¦åŠ çš„é” é”ç²—åŒ–ï¼šå¤šä¸ªé”é¢‘ç¹æ“ä½œå‡ºç°æ—¶ï¼ŒJVMä¼šå°†è¿™äº›é”æ“ä½œåˆå¹¶ï¼Œè§é”è·å–å’Œé‡Šæ”¾çš„å¼€é”€ã€‚ ã€å‚è€ƒææ–™ã€‘ é»‘é©¬ç¨‹åºå‘˜-synchronizedé”å‡çº§\nã€Synchronized æ€§èƒ½ä¼˜åŒ–ã€‘\nsynchronized åœ¨ JDK 1.6 ä¹‹åè¿›è¡Œäº†å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–ï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢çš„å››ç§ï¼š\nåå‘é”ï¼šå¦‚æœä¸€ä¸ªé”è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œ JVM ä¼šæŠŠè¿™ä¸ªé”è®¾ç½®ä¸ºåå‘é”ï¼Œå‡å°‘è·å–é”çš„ä»£ä»· è½»é‡çº§é”ï¼šå¦‚æœæ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼ŒJVM ä¼šå°†é”è®¾ç½®ä¸ºè½»é‡çº§é”ï¼Œä½¿ç”¨ CAS æ“ä½œä»£æ›¿äº’æ–¥åŒæ­¥ é”ç²—åŒ–ï¼šJVM åœ¨ JIT ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹åˆ°ä¸€äº›æ²¡æœ‰ç«äº‰çš„é”ï¼Œå¹¶å°†è¿™äº›é”å»æ‰ï¼Œå‡å°‘åŒæ­¥çš„å¼€é”€ é”æ¶ˆé™¤ï¼šJVM ä¼šå°†ä¸€äº›çŸ­æ—¶é—´å†…è¿ç»­çš„é”æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªé”æ“ä½œï¼Œå‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚ [è¡¥å……] 3. Java ä¸­çš„ synchronized è½»é‡çº§é”æ˜¯å¦ä¼šè¿›è¡Œè‡ªæ—‹ï¼Ÿ synchronized è½»é‡çº§é”çš„é˜¶æ®µï¼Œåªä¼šé€šè¿‡ CAS æ“ä½œæ¥æ›¿æ¢å¯¹è±¡å¤´å½“ä¸­çš„ Mark Word æ¥è·å–é”ï¼Œä¸ä¼šæœ‰è‡ªæ—‹æ“ä½œã€‚å¦‚æœ CAS å¤±è´¥äº†ä¹‹åï¼Œä¼šç›´æ¥è†¨èƒ€ä¸º é‡é‡çº§é”ã€‚å¦‚æœè·å–é‡é‡çº§é”å¤±è´¥ï¼Œä¼šè¿›è¡Œè‡ªæ—‹æ“ä½œã€‚\nã€synchronized é”çš„å››ä¸ªé˜¶æ®µã€‘\næ— é”é˜¶æ®µï¼šæœ€å¼€å§‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½éƒ½ä¸éœ€è¦åŒæ­¥è®¿é—®å…±äº«èµ„æºï¼Œå› æ­¤å¯èƒ½ä¸å­˜åœ¨æ˜¾å¼çš„é”ã€‚ä¸å­˜åœ¨ä»»ä½•é”çš„å¼€é”€ï¼Œè¿™ä¸ªé˜¶æ®µæ€§èƒ½æœ€é«˜ åå‘é”é˜¶æ®µï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼ŒJVM ä¼šè®¤ä¸ºè¿™ä¸ªçº¿ç¨‹åœ¨å°†æ¥è¿˜ä¼šç»§ç»­è®¿é—®è¿™ä¸ªèµ„æºï¼Œæ‰€ä»¥ä½¿ç”¨åå‘é”ã€‚åå‘é”çš„ä¸Šé”æ–¹å¼æ˜¯ï¼Œä¿®æ”¹é”å®šå¯¹è±¡çš„å¯¹è±¡å¤´ï¼Œæ ‡è®°å½“å‰çº¿ç¨‹çš„ çº¿ç¨‹idã€‚è¿™æ ·å…¶ä»–çº¿ç¨‹å°±æ²¡æ³•å„¿è·å–è¿™ä¸ªé”ï¼Œåªæœ‰è¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— ç«äº‰çš„è®¿é—®èµ„æºã€‚ è½»é‡çº§é”é˜¶æ®µï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–ä¸€ä¸ªå·²ç»è¢«åå‘é”é”å®šçš„å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥è½»é‡çº§é”é˜¶æ®µã€‚æ­¤æ—¶ï¼Œ JVM ä¼šä½¿ç”¨ CAS æ“ä½œä¿®æ”¹å¯¹è±¡å¤´çš„Mark Word ä¸ºçº¿ç¨‹çš„Lock Recordï¼Œæ¥å°è¯•è·å–é”ã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è·å–äº†é”ã€‚ å¦‚æœ CAS å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥é‡é‡çº§é”é˜¶æ®µ é‡é‡çº§é˜¶æ®µï¼šå½“è½»é‡çº§é”é˜¶æ®µçš„ CAS æ“ä½œå¤±è´¥çš„æ—¶å€™ï¼Œä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”æ„å‘³ç€çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰å¾…é”çš„é‡Šæ”¾ã€‚å…¶ä»–çº¿ç¨‹åœ¨è·å–é‡é‡çº§é”çš„æ—¶å€™ï¼Œéœ€è¦é˜»å¡ç­‰å¾…æˆ–è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å¦‚æœé‡é‡çº§é”è·å–å¤±è´¥ï¼Œä¼šè¿›è¡Œè‡ªé€‰çš„æ“ä½œã€‚ 4. AQSäº†è§£è¿‡å—? AQS (Abstract Queued Synchronizerç®€ç§°ï¼ŒæŠ½è±¡çš„é˜Ÿåˆ—å¼åŒæ­¥å™¨), å®ƒå…¶å®å°±æ˜¯æŠŠè·Ÿé”ç›¸å…³çš„æ“ä½œè¿›è¡ŒæŠ½è±¡å’Œå°è£…çš„ä¸€ä¸ªå·¥å…·ç±»ã€‚å°†æ’é˜Ÿã€å…¥é˜Ÿã€åŠ é”ã€ä¸­æ–­è¿™äº›æ–¹æ³•æä¾›å‡ºæ¥ï¼Œæ–¹ä¾¿å…¶ä»–ç›¸å…³JUC é”çš„ä½¿ç”¨ï¼Œå…·ä½“çš„åŠ é”æ—¶æœºã€å…¥é˜Ÿæ—¶æœºéƒ½éœ€è¦å®ç°ç±»è‡ªå·±æ§åˆ¶ã€‚ AQS é€šè¿‡ç»´æŠ¤ä¸€ä¸ªå…±äº«çŠ¶æ€ state ã€ä¸€ä¸ªå…ˆè¿›å…ˆå‡º FIFO çš„ç­‰å¾…é˜Ÿåˆ—å’Œä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œæ¥ç®¡ç†çº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å…±äº«çŠ¶æ€ state ç”¨ volatile ä¿®é¥°ï¼Œè¡¨ç¤ºå½“å‰èµ„æºçš„çŠ¶æ€ï¼Œä¿è¯äº†å¯è§æ€§å’Œæœ‰åºæ€§ã€‚åœ¨ç‹¬å é”ä¸­ (ReentrantLock æˆ–è€… synchronized), state ä¸º 0 è¡¨ç¤ºæœªè¢«å ç”¨ï¼Œä¸º1 è¡¨ç¤ºå·²è¢«å ç”¨ã€‚å‡å¦‚å½“å‰å…±äº«èµ„æºå·²ç»è¢«å ç”¨ï¼Œçº¿ç¨‹è·å–èµ„æºå¤±è´¥ï¼Œä¼šè¢«åŠ å…¥åˆ°AQS çš„ç­‰å¾…é˜Ÿåˆ—é‡Œé¢ã€‚è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ªå˜ä½“çš„ CLH é˜Ÿåˆ—ï¼Œ é‡‡ç”¨åŒå‘é“¾è¡¨ç»“æ„ï¼Œå…¶èŠ‚ç‚¹åŒ…å«çº¿ç¨‹çš„å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ã€å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚AQS çš„å¸¸è§å®ç°ç±»æœ‰ ReentrantLockã€CountDownLatch ã€Semaphore ç­‰ç­‰ å…¶ä¸­ï¼ŒCLH é˜Ÿåˆ—æ˜¯ä¸€ç§åŸºäºé“¾è¡¨çš„ã€å…¬å¹³çš„è‡ªæ—‹é”ç®—æ³•ï¼Œä¸»è¦ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸­å®ç°é”çš„å…¬å¹³åˆ†é…ã€‚\nã€AQS å·¥ä½œæµç¨‹ã€‘ å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«å°±åœ¨äºï¼Œå…¬å¹³é”æ˜¯ç›´æ¥æ”¾åˆ°é˜Ÿé‡Œé¢ï¼Œä¸ä¼šä¸»åŠ¨å»å°è¯• CAS è·å–é”\nå…ˆè¿›å…ˆå‡º FIFO é˜Ÿåˆ—ç”¨æ¥å®ç°å¤šçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œï¼Œå½“çº¿ç¨‹åŠ é”å¤±è´¥æ—¶ï¼Œå°±æŠŠè¿™ä¸ªçº¿ç¨‹å°è£…æˆä¸€ä¸ªNode èŠ‚ç‚¹ç½®äºé˜Ÿåˆ—å°¾éƒ¨ å½“æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼ŒAQS ä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªçº¿ç¨‹å”¤é†’ï¼Œå¹¶è®©å®ƒé‡æ–°å°è¯•è·å–é” ã€åŒæ­¥çŠ¶æ€ - stateã€‘\nAQS ä½¿ç”¨ä¸€ä¸ªvolatile intç±»å‹çš„æˆå‘˜å˜é‡stateæ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œ å½“state = 0 çš„æ—¶å€™è¡¨ç¤ºæ²¡æœ‰é”ï¼Œå½“state = 1 çš„æ—¶å€™è¡¨ç¤ºå½“å‰å¯¹è±¡é”å·²ç»è¢«å æœ‰äº†ã€‚æä¾›äº†ä¸‰ç§APIï¼Œ åˆ†åˆ«ç”¨äºè·å–çŠ¶æ€ã€è®¾ç½®çŠ¶æ€å’Œé‡‡ç”¨CAS æ›´æ–°çŠ¶æ€\n// åŒæ­¥çŠ¶æ€ private volatile int state; // è·å–çŠ¶æ€ protected final int getState() { return state; } // è®¾ç½®çŠ¶æ€ protected final void setState(int newState) { state = newState; } // CASæ›´æ–°çŠ¶æ€ protected final boolean compareAndSetState(int expect, int update) { // See below for intrinsics setup to support this return unsafe.compareAndSwapInt(this, stateOffset, expect, update); } ã€FIFOé˜Ÿåˆ— - Nodeã€‘\nä¸Šé¢AQS å·¥ä½œæµç¨‹æåˆ°çš„Node èŠ‚ç‚¹å¦‚ä¸‹ï¼Œ Node èŠ‚ç‚¹é‡Œé¢åŒ…å«waitStatus ç”¨äºæ ‡è®°èŠ‚ç‚¹çŠ¶æ€ï¼Œ thread çº¿ç¨‹æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹æ‰€ä»£è¡¨çš„çº¿ç¨‹ï¼Œè¿˜æœ‰å‰é©±èŠ‚ç‚¹å’Œåç»§ç»“ç‚¹æŒ‡é’ˆã€‚\n// Nodeç±»ç”¨äºæ„å»ºé˜Ÿåˆ— static final class Node { // æ ‡è®°èŠ‚ç‚¹çŠ¶æ€ã€‚å¸¸è§çŠ¶æ€æœ‰ CANCELLEDï¼ˆè¡¨ç¤ºçº¿ç¨‹å–æ¶ˆï¼‰ã€SIGNALï¼ˆè¡¨ç¤ºåç»§èŠ‚ç‚¹éœ€è¦è¿è¡Œï¼‰ã€CONDITIONï¼ˆè¡¨ç¤ºèŠ‚ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼‰ç­‰ã€‚ volatile int waitStatus; // å‰é©±èŠ‚ç‚¹ volatile Node prev; // åç»§èŠ‚ç‚¹ volatile Node next; // èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ï¼Œå­˜å‚¨çº¿ç¨‹å¼•ç”¨ï¼ŒæŒ‡å‘å½“å‰èŠ‚ç‚¹æ‰€ä»£è¡¨çš„çº¿ç¨‹ã€‚ volatile Thread thread; } // é˜Ÿåˆ—å¤´èŠ‚ç‚¹ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚åªåœ¨setHeadæ—¶ä¿®æ”¹ private transient volatile Node head; // é˜Ÿåˆ—å°¾èŠ‚ç‚¹ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚ private transient volatile Node tail; // å…¥é˜Ÿæ“ä½œ private Node enq(final Node node) { for (;;) { Node t = tail; if (t == null) { // å¿…é¡»å…ˆåˆå§‹åŒ– if (compareAndSetHead(new Node())) tail = head; } else { node.prev = t; if (compareAndSetTail(t, node)) { t.next = node; return t; } } } } ã€åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ã€‘\nAQS æœ‰ä¸¤ç§ FIFO é˜Ÿåˆ—ï¼ŒåŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ã€‚åŒæ­¥é˜Ÿåˆ—ç”¨äºé”çš„è·å–å’Œé‡Šæ”¾ï¼Œæ¡ä»¶é˜Ÿåˆ—ç”¨äºç‰¹å®šæ¡ä»¶ä¸‹ç®¡ç†çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ã€‚å¸¸ç”¨çš„ReentrantLock å°±æ˜¯åŸºäºåŒæ­¥é˜Ÿåˆ—å®ç°çš„ã€‚\nåŒæ­¥é˜Ÿåˆ—çš„å®ç°åŸç†ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”å¤±è´¥çš„æ—¶å€™ï¼ŒAQS ä¼šå°†è¯¥çº¿ç¨‹åŒ…è£…æˆä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚è¿™ä¸ªèŠ‚ç‚¹ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æ‰€èµ„æºè¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ã€‚å½“é”è¢«é‡Šæ”¾çš„æ—¶å€™ï¼ŒæŒæœ‰é”çš„çº¿ç¨‹ä¼šé€šçŸ¥å…¶ä»–åç»§ç»“ç‚¹(å¦‚æœå­˜åœ¨çš„è¯)ï¼Œåç»§ç»“ç‚¹ä¼šå°è¯•è·å–é”ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°çº¿ç¨‹æˆåŠŸè·å–é”æˆ–é˜Ÿåˆ—ä¸ºç©º\nprivate Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // å°è¯•å¿«é€Ÿè·¯å¾„ï¼šç›´æ¥å°è¯•åœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹ Node pred = tail; if (pred != null) { node.prev = pred; if (compareAndSetTail(pred, node)) { pred.next = node; return node; } } // å¿«é€Ÿè·¯å¾„å¤±è´¥æ—¶ï¼Œè¿›å…¥å®Œæ•´çš„å…¥é˜Ÿæ“ä½œ enq(node); return node; } private Node enq(final Node node) { for (;;) { Node t = tail; if (t == null) { // é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆå§‹åŒ– if (compareAndSetHead(new Node())) tail = head; } else { node.prev = t; if (compareAndSetTail(t, node)) { t.next = node; return t; } } } } æ¡ä»¶é˜Ÿåˆ—çš„å®ç°åŸç†ï¼šæ¡ä»¶é˜Ÿåˆ—ä¸»è¦ç”¨äºå®ç°æ¡ä»¶å˜é‡ï¼Œå®ç°äº†çº¿ç¨‹é—´çš„åè°ƒå’Œé€šä¿¡ã€‚å…è®¸çº¿ç¨‹åœ¨ç‰¹å®šæ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™æŒ‚èµ·ï¼Œç­‰åˆ°å…¶ä»–çº¿ç¨‹æ”¹å˜äº†æ¡ä»¶å¹¶æ˜¾ç¤ºçš„å”¤é†’ç­‰å¾…åœ¨è¯¥æ¡ä»¶é˜Ÿåˆ—ä¸Šçš„çº¿ç¨‹ï¼Œå…¸å‹çš„æ¡ä»¶é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯å°±æ˜¯ReentrantLock çš„ Condition\npublic class ConditionObject implements Condition, java.io.Serializable { // æ¡ä»¶é˜Ÿåˆ—çš„é¦–å°¾èŠ‚ç‚¹ private transient Node firstWaiter; private transient Node lastWaiter; // ... } // ConditionObjectæ˜¯AQSçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç”¨äºå®ç°æ¡ä»¶å˜é‡ã€‚æ¡ä»¶å˜é‡ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨ç‰¹å®šæ¡ä»¶æˆç«‹ä¹‹å‰ç­‰å¾…ï¼ŒåŒæ—¶é‡Šæ”¾å…ˆå…³çš„é”ã€‚ public final void await() throws InterruptedException { // å¦‚æœå½“å‰çº¿ç¨‹åœ¨è¿›å…¥æ­¤æ–¹æ³•ä¹‹å‰å·²ç»è¢«ä¸­æ–­äº†ï¼Œåˆ™ç›´æ¥æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚ if (Thread.interrupted()) throw new InterruptedException(); // å°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ Node node = addConditionWaiter(); // é‡Šæ”¾å½“å‰çº¿ç¨‹æ‰€æŒæœ‰çš„é”ï¼Œå¹¶è¿”å›é‡Šæ”¾å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥é‡æ–°è·å–åˆ°ç›¸åŒæ•°é‡çš„é”ã€‚ int savedState = fullyRelease(node); // ä¸­æ–­æ¨¡å¼ï¼Œç”¨äºè®°å½•çº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æ˜¯å¦è¢«ä¸­æ–­ã€‚ int interruptMode = 0; // å¦‚æœå½“å‰èŠ‚ç‚¹ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œåˆ™è¡¨ç¤ºçº¿ç¨‹åº”è¯¥ç»§ç»­ç­‰å¾…ã€‚ while (!isOnSyncQueue(node)) { // é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¢«å”¤é†’æˆ–ä¸­æ–­ã€‚ LockSupport.park(this); // æ£€æŸ¥çº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶æ›´æ–°interruptModeçŠ¶æ€ã€‚ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; } // å½“èŠ‚ç‚¹æˆåŠŸåŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—åï¼Œå°è¯•ä»¥ä¸­æ–­æ¨¡å¼è·å–é”ã€‚ // å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­çº¿ç¨‹è¢«ä¸­æ–­ï¼Œä¸”ä¸æ˜¯åœ¨signalä¹‹åï¼Œåˆ™è®¾ç½®ä¸­æ–­æ¨¡å¼ä¸ºREINTERRUPTã€‚ if (acquireQueued(node, savedState) \u0026amp;\u0026amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; // å¦‚æœèŠ‚ç‚¹åé¢è¿˜æœ‰ç­‰å¾…çš„èŠ‚ç‚¹ï¼Œä»ç­‰å¾…é˜Ÿåˆ—ä¸­æ¸…ç†æ‰è¢«å–æ¶ˆçš„èŠ‚ç‚¹ã€‚ if (node.nextWaiter != null) // clean up if cancelled unlinkCancelledWaiters(); // æ ¹æ®ä¸­æ–­æ¨¡å¼å¤„ç†ä¸­æ–­ã€‚ if (interruptMode != 0) reportInterruptAfterWait(interruptMode); } å½“çº¿ç¨‹è°ƒç”¨äº†Condition çš„ await() æ–¹æ³•åï¼Œå®ƒä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„é”ï¼Œå¹¶ä¸”è¯¥çº¿ç¨‹ä¼šè¢«åŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ç›´åˆ°è¢«å¦ä¸€ä¸ªçº¿ç¨‹çš„signal() (å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­å¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹) æˆ–è€… signalAll()ï¼ˆå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼‰æ–¹æ³•å”¤é†’æˆ–è€…è¢«ä¸­æ–­ã€‚\npublic final void signal() { if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignal(first); } private void doSignal(Node first) { do { if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; first.nextWaiter = null; } while (!transferForSignal(first) \u0026amp;\u0026amp; (first = firstWaiter) != null); } ã€ReentrantLockã€CountDownLatchã€Semaphore åŒºåˆ«ã€‘\nå¯¹æ¯”ç»´åº¦ ReentrantLock CountDownLatch Semaphore ç”¨é€” äº’æ–¥è®¿é—®å…±äº«èµ„æºï¼Œæ”¯æŒå¯é‡å…¥é” ç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆæ“ä½œåè§¦å‘åç»­ä»»åŠ¡ æ§åˆ¶åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹æ•°é‡ï¼ˆé™æµï¼‰ åŒæ­¥æ–¹å¼ ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰ å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰ å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰ èµ„æºç®¡ç† é€šè¿‡ state è®°å½•é”é‡å…¥æ¬¡æ•° é€šè¿‡ state è¡¨ç¤ºå‰©ä½™éœ€ç­‰å¾…çš„è®¡æ•° é€šè¿‡ state è¡¨ç¤ºå¯ç”¨è®¸å¯è¯æ•°é‡ é‡Šæ”¾æœºåˆ¶ éœ€æ˜¾å¼è°ƒç”¨ unlock() é‡Šæ”¾é” è‡ªåŠ¨è§¦å‘ï¼ˆcountDown() å‡è‡³ 0ï¼‰ éœ€æ˜¾å¼è°ƒç”¨ release() å½’è¿˜è®¸å¯ å¯é‡ç”¨æ€§ å¯é‡å¤åŠ é”/è§£é”ï¼ˆå¯é‡å…¥ï¼‰ ä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆè®¡æ•°å½’é›¶åä¸å¯é‡ç½®ï¼‰ å¯é‡å¤è·å–/é‡Šæ”¾è®¸å¯è¯ çº¿ç¨‹åä½œ åŸºäºæ¡ä»¶å˜é‡ Condition æ§åˆ¶ æ— æ¡ä»¶åä½œï¼Œä»…ç­‰å¾…è®¡æ•°å½’é›¶ æ— åä½œï¼Œä»…æ§åˆ¶å¹¶å‘é‡ å…¸å‹åœºæ™¯ æ›¿ä»£ synchronized çš„æ˜¾å¼é”æ§åˆ¶ ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹åˆå§‹åŒ–å®Œæˆ æ•°æ®åº“è¿æ¥æ± ã€é™æµåœºæ™¯ ã€å‚è€ƒææ–™ã€‘\nä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨ ã€åŸºæœ¬åŠŸã€‘ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹ 5. Java ä¸­ ReentrantLock çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ReentrantLock æ˜¯åŸºäº AQS å®ç°çš„ä¸€ä¸ªå¯é‡å…¥é”ï¼Œæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§æ–¹å¼ã€‚\nã€ReentrantLock ç»“æ„ã€‘\nä¸€ä¸ª state å˜é‡: ç”¨äºè¡¨ç¤ºé”çš„çŠ¶æ€, state = 0 è¡¨ç¤ºæ²¡æœ‰é”å ç”¨ï¼Œstate = 1 è¡¨ç¤ºå·²ç»è¢«å ç”¨ åŒæ­¥é˜Ÿåˆ—ï¼šç”¨äºé”çš„è·å–å’Œé‡Šæ”¾ã€‚å¯¹äºéå…¬å¹³é”ï¼Œæ²¡æœ‰è·å–åˆ°é”çš„å°±ä¼šè¢«æ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢ã€‚å¯¹äºå…¬å¹³é”ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯ç›´æ¥æ”¾åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¾æ¬¡ç­‰å¾…è·å–é”ã€‚ æ¡ä»¶é˜Ÿåˆ—ï¼šç”¨äºç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³äº†ä¹‹åï¼Œæ‰è®©è¿™äº›çº¿ç¨‹é€ä¸ªè·å–é”ã€‚æ¯”å¦‚æŒ‡å®šæ‰€æœ‰çš„çº¿ç¨‹å¿…é¡»åœ¨æ™šä¸Š2ç‚¹å¼€å§‹æ‰«ææ£€æŸ¥æ˜¯å¦å­˜åœ¨å¼‚å¸¸è®¢å•çš„æƒ…å†µï¼Œå¿…é¡»è¦ç­‰åˆ°æ™šä¸Š2ç‚¹ï¼Œè¿™äº›çº¿ç¨‹æ‰å¼€å§‹è·å–é”ã€‚ ã€CLHé˜Ÿåˆ—ã€‘\nCLH æ˜¯ä¸€ç§åŸºäºé˜Ÿåˆ—çš„è‡ªé€‰é”ï¼Œå®ƒé€‚ç”¨äºå¤šå¤„ç†å™¨ç¯å¢ƒä¸‹çš„é«˜å¹¶å‘åœºæ™¯ã€‚åŸç†æ˜¯é€šè¿‡ç»´æŠ¤ä¸€ä¸ªéšå¼é˜Ÿåˆ—ï¼Œè®©çº¿ç¨‹åœ¨ç­‰å¾…é”çš„æ—¶å€™è‡ªæ—‹åœ¨æœ¬åœ°å˜é‡ä¸Šï¼Œä»è€Œå‡å°‘å¯¹å…±äº«å˜é‡çš„äº‰ç”¨å’Œç¼“å­˜ä¸€è‡´æ€§æµé‡ã€‚ å®ƒå°†äº‰æŠ¢çš„çº¿ç¨‹ç»„ç»‡æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œé€šè¿‡æ’é˜Ÿçš„æ–¹å¼æŒ‰åºäº‰æŠ¢é”ã€‚æ¯ä¸ªçº¿ç¨‹ä¸å†CAS äº‰æŠ¢ä¸€ä¸ªå˜é‡ï¼Œè€Œæ˜¯è‡ªé€‰åˆ¤æ–­æ’åœ¨å®ƒå‰é¢çš„çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœå‰é¢çš„çº¿ç¨‹çŠ¶æ€ä¸ºé‡Šæ”¾é”ï¼Œé‚£ä¹ˆåç»­çš„çº¿ç¨‹å°±æŠ¢é”ã€‚\nCLH é€šè¿‡æ’é˜ŸæŒ‰åºäº‰æŠ¢è§£å†³äº†é”é¥¥é¥¿çš„é—®é¢˜ (é”é¥¥é¥¿å°±æ˜¯æœ‰çš„çº¿ç¨‹é•¿æœŸæŠ¢ä¸åˆ°é”)ï¼Œé€šè¿‡ CAS è‡ªé€‰ç›‘å¬å‰é¢ç°æˆçš„çŠ¶æ€é¿å…æ€»çº¿é£æš´é—®é¢˜çš„äº§ç”Ÿã€‚æ€»çº¿é£æš´æ˜¯æŒ‡çŸ­æ—¶é—´å†…å¤§é‡å¹¶å‘CASæ“ä½œå’Œç¼“å­˜ä¸€è‡´æ€§åè®®äº§ç”Ÿçš„æ€»çº¿æµé‡æ¿€å¢ï¼Œä¼šå¯¼è‡´CPUåˆ©ç”¨ç‡ä¸‹é™ï¼Œå†…å­˜è®¿é—®å»¶è¿Ÿå¢åŠ ã€‚ ä¸è¿‡, CLH çš„è‡ªæ—‹æœŸé—´çº¿ç¨‹ä¼šä¸€ç›´å ç”¨CPUèµ„æºï¼Œåªé€‚åˆé”ç­‰å¾…æ¯”è¾ƒçŸ­çš„åœºæ™¯ã€‚\nã€AQSå¯¹CLHè¿›è¡Œæ”¹é€ ã€‘\nä¸ºäº†é˜²æ­¢CLH è‡ªæ—‹æœŸé—´é•¿æœŸå ç”¨CPUèµ„æºçš„é—®é¢˜ï¼ŒAQSå°†è‡ªæ—‹ç­‰å¾…å‰ç½®èŠ‚ç‚¹æ”¹æˆäº†é˜»å¡çº¿ç¨‹ã€‚åç»­çš„çº¿ç¨‹æ²¡æ³•å„¿ä¸»åŠ¨å»å‘ç°å‰é¢çš„çº¿ç¨‹æ˜¯å¦é‡Šæ”¾äº†é”ï¼Œåªèƒ½ç­‰å¾…å‰é¢çº¿ç¨‹é€šçŸ¥åç»­çº¿ç¨‹é”è¢«é‡Šæ”¾äº†ï¼Œå®ƒé‡‡ç”¨å»äº‰å¤ºé”ã€‚æ‰€ä»¥ï¼ŒAQS æŠŠ CLH æ”¹æˆäº†ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œè®©å‰é¢çš„çº¿ç¨‹å¯ä»¥é€šçŸ¥åç»­çš„çº¿ç¨‹ã€‚å¦‚æœåé¢çš„çº¿ç¨‹ç­‰å¾…è¶…æ—¶æˆ–è€…ä¸»åŠ¨å–æ¶ˆï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œåé¢çš„çº¿ç¨‹é¡¶ä¸Šæ¥ã€‚\nã€ReentrantLock ä½¿ç”¨æ–¹æ³•ã€‘\nReentrantLock å¯é‡å…¥é”ï¼šéœ€è¦é€šè¿‡æ‰‹åŠ¨è°ƒç”¨ lock() å’Œ unlock() æ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾é”ã€‚æ”¯æŒæ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä¸­æ–­çš„é”ç­‰å¾…ã€å®šæ—¶é”ç­‰å¾…ã€å…¬å¹³é”ç­‰å¾…ç­‰\npublic class ReentrantLockDemo { // æ„é€ æ—¶ä¼ å…¥trueè¡¨ç¤ºä½¿ç”¨å…¬å¹³é” private final ReentrantLock lock = new ReentrantLock(true); // å¯ä¸­æ–­é”ç­‰å¾…ç¤ºä¾‹ public void interruptibleLockMethod() throws InterruptedException { lock.lockInterruptibly(); // å¯ä¸­æ–­ç­‰å¾… try { // ä¸´ç•ŒåŒºä»£ç  System.out.println(\u0026#34;è·å–é”æˆåŠŸï¼ˆå¯ä¸­æ–­ç­‰å¾…ï¼‰\u0026#34;); } finally { lock.unlock(); } } // å®šæ—¶é”ç­‰å¾…ç¤ºä¾‹ public void timedLockMethod() throws InterruptedException { if (lock.tryLock(5, TimeUnit.SECONDS)) { // ç­‰å¾…5ç§’ try { // ä¸´ç•ŒåŒºä»£ç  System.out.println(\u0026#34;åœ¨è§„å®šæ—¶é—´å†…è·å–åˆ°é”\u0026#34;); } finally { lock.unlock(); } } else { System.out.println(\u0026#34;æœªåœ¨è§„å®šæ—¶é—´å†…è·å–åˆ°é”\u0026#34;); } } public static void main(String[] args) { ReentrantLockDemo demo = new ReentrantLockDemo(); Thread t1 = new Thread(() -\u0026gt; { try { demo.interruptibleLockMethod(); } catch (InterruptedException e) { System.out.println(\u0026#34;çº¿ç¨‹1ç­‰å¾…æ—¶è¢«ä¸­æ–­\u0026#34;); } }); Thread t2 = new Thread(() -\u0026gt; { try { demo.timedLockMethod(); } catch (InterruptedException e) { System.out.println(\u0026#34;çº¿ç¨‹2ç­‰å¾…æ—¶è¢«ä¸­æ–­\u0026#34;); } }); t1.start(); t2.start(); // å¯æ ¹æ®éœ€è¦ä¸­æ–­çº¿ç¨‹ t1.interrupt(); } } 6. ä»€ä¹ˆæ˜¯ Java çš„ CASï¼ˆCompare-And-Swapï¼‰æ“ä½œï¼Ÿ CAS æ˜¯ä¸€ç§ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œï¼Œç”¨äºå®ç°æ— é”å¹¶å‘ç¼–ç¨‹ï¼Œä½¿ç”¨æ¯”è¾ƒå’Œäº¤æ¢çš„æ–¹å¼ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚CAS çš„ä½œç”¨å°±æ˜¯ä¿è¯æ— é”å¹¶å‘ï¼Œè€Œä¸”CASæ“ä½œæ˜¯åŸå­çš„ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚\nã€CASè¿‡ç¨‹ã€‘\næ¯”è¾ƒï¼šCAS åœ¨æ¯æ¬¡æ“ä½œä¹‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥å†…å­˜å½“ä¸­çš„æŸä¸ªå€¼æ˜¯å¦ä¸é¢„æœŸå€¼ç›¸ç­‰ äº¤æ¢ï¼šå¦‚æœå‘ç°åŒé¢„æœŸå€¼ç›¸åŒï¼Œåˆ™å°†å†…å­˜ä¸­çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ è‡ªæ—‹é‡è¯•ï¼šå¦‚æœå‘ç°å’Œé¢„æœŸå€¼ä¸ç›¸åŒï¼Œè¯´æ˜å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹äº†è¯¥å€¼ã€‚å®ƒä¼šåœ¨ä¸€å®šæ¬¡æ•°å†…ï¼Œä¸æ–­è·å–æœ€æ–°çš„å†…å­˜å€¼ï¼Œæ›´æ–°é¢„æœŸå€¼ï¼Œç„¶åå†æ¬¡å°è¯• CAS æ“ä½œã€‚ ã€CASå­˜åœ¨çš„é—®é¢˜ã€‘\nABAé—®é¢˜ï¼šCAS æ“ä½œä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡å€¼è¢«å…¶ä»–çº¿ç¨‹ä»Aå˜æˆBï¼Œç„¶ååˆå˜å›A. CAS æ— æ³•æ£€æµ‹åˆ°è¿™ç§å˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚ è‡ªæ—‹å¼€é”€ï¼šCAS æ“ä½œé€šå¸¸æ˜¯é€šè¿‡è‡ªæ—‹å®Œæˆçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´CPUèµ„æºæµªè´¹ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ã€‚ å•å˜é‡æ§åˆ¶ï¼šCAS æ“ä½œåªé€‚ç”¨å•ä¸ªå˜é‡çš„æ›´æ–°ï¼Œä¸èƒ½æ¶‰åŠå¤šä¸ªå˜é‡çš„å¤æ‚æ“ä½œã€‚ æ€»çº¿é£æš´ï¼šå¦‚æœCASä¿®æ”¹åŒä¸€ä¸ªå˜é‡çš„å¹¶å‘å¾ˆé«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€»çº¿é£æš´ã€‚ ã€æ€»çº¿é£æš´ã€‘\næ€»çº¿é£æš´æ˜¯æŒ‡çŸ­æ—¶é—´å†…å¤§é‡å¹¶å‘CASæ“ä½œå’Œç¼“å­˜ä¸€è‡´æ€§åè®®äº§ç”Ÿçš„æ€»çº¿æµé‡æ¿€å¢ï¼Œä¼šå¯¼è‡´CPUåˆ©ç”¨ç‡ä¸‹é™ï¼Œå†…å­˜è®¿é—®å»¶è¿Ÿå¢åŠ ã€‚å› ä¸ºlock å‰ç¼€æŒ‡ä»¤ä¼šæŠŠå†™ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œåœ¨å¯¹ç§°å¤šå¤„ç†æ¶æ„ä¸‹ï¼Œæ¯ä¸ªCPUéƒ½ä¼šé€šè¿‡å—…æ¢æ€»çº¿æ¥æ£€æŸ¥è‡ªå·±çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚å¦‚æœæŸä¸ªCPUåˆ·æ–°è‡ªå·±çš„æ•°æ®åˆ°é©»æ‘ï¼Œå°±ä¼šé€šè¿‡æ€»çº¿é€šçŸ¥å…¶ä»–CPUè¿‡æœŸå¯¹åº”çš„ç¼“å­˜ï¼Œå®ç°å†…å­˜å±éšœï¼Œä¿è¯ä¸€è‡´æ€§ã€‚ é€šè¿‡æ€»çº¿æ¥å›é€šä¿¡æˆä¸ºCache ä¸€è‡´æ€§æµé‡ï¼Œå¦‚æœè¿™ä¸ªæµé‡è¿‡å¤§ï¼Œæ€»çº¿å°±ä¼šæˆä¸ºç“¶é¢ˆï¼Œå¯¼è‡´æœ¬åœ°ç¼“å­˜æ›´æ–°å»¶è¿Ÿã€‚ æ‰€ä»¥ï¼Œå¦‚æœ CAS ä¿®æ”¹åŒä¸€ä¸ªå˜é‡å¹¶å‘å¾ˆé«˜ï¼Œå°±ä¼šå¯¼è‡´æ€»çº¿é£æš´ï¼Œå‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚\n7. ä»€ä¹ˆæ˜¯ Java ä¸­çš„ ABA é—®é¢˜ï¼Ÿ ABA é—®é¢˜æ˜¯æŒ‡å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŸä¸ªå˜é‡çš„å€¼åœ¨ä¸€é¡¿æ—¶é—´å†…ç»å†äº†ä» A åˆ° B å†åˆ° A çš„å˜åŒ–ï¼Œè¿™ç§å˜åŒ–å¯èƒ½ä¼šè¢«CAS åˆ¤å®šä¸ºå€¼æ²¡æœ‰å˜åŒ–ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹å‘ç”Ÿé”™è¯¯çš„åˆ¤æ–­å’Œæ“ä½œã€‚\nã€ABAçº¿ç¨‹ç¤ºä¾‹ã€‘\nä¸‹é¢çš„ä»£ç å½“ä¸­ï¼Œå¦‚æœçº¿ç¨‹Aè¯»å–äº†oldHeadï¼Œ æ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹Bä¿®æ”¹äº†æ ˆçš„å†…å®¹ï¼Œç„¶åå°† oldHead ç§»é™¤ (å°†æ ˆé¡¶å…ƒç´ ä»A å˜æˆ B ï¼Œ å†å˜æˆA)ï¼Œ å½“çº¿ç¨‹Aå†æ¬¡æ‰§è¡Œ compareAndSet å‡½æ•°çš„æ—¶å€™ï¼Œå°½ç®¡å€¼æ˜¯ä¸€æ ·çš„(oldHeadæ²¡æœ‰å˜åŒ–)ï¼Œä½†å®é™…ä¸Šæ ˆçš„çŠ¶æ€å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\npublic class LockFreeStack\u0026lt;T\u0026gt; { private AtomicReference\u0026lt;Node\u0026lt;T\u0026gt;\u0026gt; head = new AtomicReference\u0026lt;\u0026gt;(); public T pop() { Node\u0026lt;T\u0026gt; oldHead; Node\u0026lt;T\u0026gt; newHead; do { oldHead = head.get(); if (oldHead == null) { return null; } newHead = oldHead.next; } while (!head.compareAndSet(oldHead, newHead)); return oldHead.value; } } ã€è§£å†³ABAé—®é¢˜çš„åŠæ³•ã€‘\nå¼•å…¥ç‰ˆæœ¬å·ï¼šåœ¨æ¯æ¬¡æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œä¸ä»…æ›´æ–°å˜é‡çš„å€¼ï¼Œè¿˜æ›´æ–°ä¸€ä¸ªç‰ˆæœ¬å·ã€‚CAS æ“ä½œåœ¨æ¯”è¾ƒçš„æ—¶å€™ï¼Œé™¤äº†æ¯”è¾ƒå€¼æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æ¯”è¾ƒç‰ˆæœ¬å·æ˜¯å¦åŒ¹é…ã€‚Java å½“ä¸­çš„ AtomicStampReference æä¾›äº†ç‰ˆæœ¬å·æœºåˆ¶æ¥é¿å… ABA é—®é¢˜ã€‚æ¯æ¬¡æ›´æ–°stampedRef çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸€èµ·æ›´æ–°å¯¹åº”çš„ç‰ˆæœ¬å·\nAtomicStampedReference\u0026lt;Integer\u0026gt; stampedRef = new AtomicStampedReference\u0026lt;\u0026gt;(1, 0); int[] stampHolder = new int[1]; Integer ref = stampedRef.get(stampHolder); ä½¿ç”¨AtomicMarkableReferenceï¼šåœ¨å˜é‡çš„å¼•ç”¨ä¸Šæ ‡è®°ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥åŒºåˆ†æ˜¯å¦å‘ç”Ÿäº†ç‰¹å®šçš„å˜åŒ–ã€‚ä¸ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œç›´æ¥ç”¨æ ‡è®°ä½æ¥è¿½è¸ªçŠ¶æ€çš„å˜åŒ–ã€‚\nAtomicMarkableReference\u0026lt;Integer\u0026gt; markableRef = new AtomicMarkableReference\u0026lt;\u0026gt;(1, false); 8. ä½ äº†è§£ Java çº¿ç¨‹æ± çš„åŸç†å—ï¼Ÿ çº¿ç¨‹æ± æ˜¯ç”¨æ¥ç®¡ç†çº¿ç¨‹çš„èµ„æºæ± ï¼Œå½“éœ€è¦ç”¨çº¿ç¨‹çš„æ—¶å€™ï¼Œç›´æ¥ä»çº¿ç¨‹æ± é‡Œé¢å–å°±å¯ä»¥äº†ã€‚ä½¿ç”¨å®Œçº¿ç¨‹ä¹‹åï¼Œä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚\nã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ã€‘\nå‡å°‘èµ„æºçš„æ¶ˆè€—ï¼šé€šè¿‡é‡å¤åˆ©ç”¨å·²ç»åˆ›å»ºçš„çº¿ç¨‹ï¼Œé¿å…é‡å¤åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹é€ æˆçš„æ¶ˆè€— æé«˜å“åº”é€Ÿåº¦ é¿å…çº¿ç¨‹æŠ¢å è¿‡å¤šèµ„æºï¼šå¦‚æœçº¿ç¨‹é¢‘ç¹åˆ›å»ºç³»ç»Ÿèµ„æºï¼Œä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚è€Œä¸”ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚ ã€å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± ã€‘\né€šè¿‡ ThreadPoolExecutor æ„é€ å‡½æ•°åˆ›å»º\n// ThreadPoolExecutor æ„é€ å‡½æ•° public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue) { this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), defaultHandler); } // ç”¨ThreadPoolExecutoråˆ›å»ºçœ‹å¯¹è±¡ ThreadPoolExecutor executor = new ThreadPoolExecutor( 2, // corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«å›æ”¶ 5, // maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ï¼Œå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡æ—¶ä¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†ä¸èƒ½è¶…è¿‡æ­¤å€¼ã€‚ 60L, TimeUnit.SECONDS, // keepAliveTime éæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²å­˜æ´»æ—¶é—´(å•ä½ç”±unitå‚æ•°æŒ‡å®š) new LinkedBlockingQueue\u0026lt;\u0026gt;(10), // ä»»åŠ¡é˜Ÿåˆ— (å¦‚LinkedBlockingQueue/ArrayBlockingQueue) Executors.defaultThreadFactory(), // çº¿ç¨‹å·¥å‚ï¼ˆå¯è®¾ç½®çº¿ç¨‹åç§°ã€ä¼˜å…ˆçº§ç­‰ï¼‰ new ThreadPoolExecutor.CallerRunsPolicy() // æ‹’ç»ç­–ç•¥(å¦‚ AbortPolicy æŠ›å‡ºå¼‚å¸¸ï¼ŒCallerRunsPolicy ç”±æäº¤çº¿ç¨‹æ‰§è¡Œä»»åŠ¡) ); é€šè¿‡ Executor æ¡†æ¶çš„å·¥å…·ç±» Executors æ¥åˆ›å»º\nExecutor å½“ä¸­åŒ…å«äº”ç§ä¸åŒçš„çº¿ç¨‹æ± \nçº¿ç¨‹æ± ç±»å‹ ç‰¹æ€§ å›ºå®šå¤§å°çº¿ç¨‹æ±  FixedThreadPool å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚æ ¸å¿ƒçº¿ç¨‹æ•°é‡å’Œæœ€å¤§çº¿ç¨‹æ•°é‡æ˜¯ä¸€è‡´çš„ã€‚æœ‰æ–°ä»»åŠ¡æäº¤å¹¶ä¸”æœ‰ç©ºé—²çº¿ç¨‹å°±ç«‹å³æ‰§è¡Œï¼Œå¦åˆ™å­˜æ”¾åˆ°è¯·æ±‚é˜Ÿåˆ—å½“ä¸­ å•çº¿ç¨‹çº¿ç¨‹æ±  SingleThreadExecutor åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œåç»­çš„ä»»åŠ¡ã€‚é€‚åˆç”¨äºä¿è¯ä»»åŠ¡æŒ‰ç…§æäº¤é¡ºåºæ‰§è¡Œ å¯ç¼“å­˜çº¿ç¨‹æ±  CachedThreadPool æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ï¼Œä¼˜å…ˆä½¿ç”¨å¯å¤ç”¨çš„çº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹ä¸å¤Ÿç”¨ï¼Œä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œæœ€å¤šåˆ›å»ºçš„ä¸ªæ•°æ˜¯int æœ€å¤§å€¼ å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  ScheduledThreadPool åœ¨ä¸€å®šæ—¶é—´åï¼Œæˆ–è€…å®šæ—¶å»æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ±  å•çº¿ç¨‹å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  SingleThreadScheduled å’Œå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± åŸºæœ¬ä¸€æ ·ï¼Œç›¸å½“äºå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± é‡Œé¢åªæœ‰ä¸€ä¸ªçº¿ç¨‹ ã€æ³¨æ„ã€‘ ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ Executors å»åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯ä½¿ç”¨ThreadPoolExecutor çš„æ–¹å¼åˆ›å»ºï¼Œé¿å…èµ„æºè€—å°½çš„é£é™©ã€‚\nã€Executors çš„å¼Šç«¯ã€‘\nå›ºå®šå¤§å°çº¿ç¨‹æ±  FiexedThreadPool å’Œ SingleThreadPoolï¼šå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOM å†…å­˜ä¸è¶³ å¯ç¼“å­˜çº¿ç¨‹æ±  CachedThreadPool å’Œ å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  ScheduledThreadPoolï¼š å…è®¸åˆ›å»ºçº¿ç¨‹çš„æ•°é‡ä¸º Integer.MAX_VALUEï¼Œ å¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOM å†…å­˜ä¸è¶³ å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  ScheduledThreadPool å’Œ å•çº¿ç¨‹å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  SingleScheduledThreadPool : ä½¿ç”¨çš„æ— ç•Œçš„å»¶è¿Ÿé˜»å¡é˜Ÿåˆ— DelayedWorkQueue ç”¨æ¥å­˜æ”¾åç»­çš„çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œ å¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOM å†…å­˜ä¸è¶³ // å›ºå®šå¤§å°çº¿ç¨‹æ±  newFixedThreadPool ExecutorService executor = Executors.newFixedThreadPool(5); // æ ¸å¿ƒçº¿ç¨‹æ•°=æœ€å¤§çº¿ç¨‹æ•°=5 // å•çº¿ç¨‹çº¿ç¨‹æ±  newSingleThreadExecutor ExecutorService executor = Executors.newSingleThreadExecutor(); // å¯ç¼“å­˜çº¿ç¨‹æ±  newCachedThreadPool ExecutorService executor = Executors.newCachedThreadPool(); // å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±  newScheduledThreadPool ScheduledExecutorService executor = Executors.newScheduledThreadPool(3); // å»¶è¿Ÿæ‰§è¡Œ executor.schedule(() -\u0026gt; System.out.println(\u0026#34;Delayed Task\u0026#34;), 3, TimeUnit.SECONDS); // å‘¨æœŸæ€§æ‰§è¡Œ executor.scheduleAtFixedRate(() -\u0026gt; System.out.println(\u0026#34;Periodic Task\u0026#34;), 1, 5, TimeUnit.SECONDS); ã€çº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°ã€‘\nçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰ 7 ä¸ªï¼Œåˆ†åˆ«æ˜¯æ ¸å¿ƒçº¿ç¨‹æ± å¤§å° corePoolSizeã€ æœ€å¤§çº¿ç¨‹æ± å¤§å° maximumPoolSizeã€çº¿ç¨‹å­˜æ´»æ—¶é—´å’Œå®ƒçš„å•ä½ã€å­˜æ”¾æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ— workQueueã€çº¿ç¨‹å·¥å‚ threadFactory ã€æ‹’ç»ç­–ç•¥ handler\nå‚æ•°åç§° ç±»å‹ ç‰¹æ€§ æ ¸å¿ƒçº¿ç¨‹æ± å¤§å° corePoolSize int çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ \u0026lt;= æ ¸å¿ƒçº¿ç¨‹æ•°é‡ coolPoolSizeï¼Œå³ä½¿çº¿ç¨‹æ˜¯ç©ºé—²çŠ¶æ€ï¼Œéƒ½ä¸ä¼šåˆ é™¤çš„çº¿ç¨‹ã€‚ æœ€å¤§çº¿ç¨‹æ± å¤§å° maximumPoolSize int çº¿ç¨‹æ± æœ€å¤šå¯ä»¥å®¹çº³çš„çº¿ç¨‹æ•°é‡ã€‚å¦‚æœé˜»å¡é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œä½†æ˜¯å½“å‰çº¿ç¨‹æ•° \u0026lt; æœ€å¤§çº¿ç¨‹æ± å¤§å° maximumPoolSizeï¼Œåˆ™ä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹ã€‚å¦‚æœå¤§äºç­‰äºï¼Œå°±æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ çº¿ç¨‹å­˜æ´»æ—¶é—´ keepAliveTime long çº¿ç¨‹æ± ä¸­å¤§äºæ ¸å¿ƒçº¿ç¨‹ corePoolSize çš„å…¶ä»– éæ ¸å¿ƒçº¿ç¨‹ å¤„äºç©ºé—²çŠ¶æ€ä¸‹çš„å­˜æ´»æ—¶é—´ã€‚è¶…è¿‡è¯¥æ—¶é—´å°±ä¼šè¢«å›æ”¶é”€æ¯ å­˜æ´»æ—¶é—´å•ä½ unit TimeUnit çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½ é˜»å¡é˜Ÿåˆ— workQueue BlockingQueue\u0026lt;Runnable\u0026gt; é˜»å¡å·¥ä½œé˜Ÿåˆ—ï¼Œæ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹å¯ä»¥æ‰§è¡Œçš„æ—¶å€™ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¢«æ”¾åœ¨é˜»å¡é˜Ÿåˆ—é‡Œé¢ çº¿ç¨‹å·¥å‚ threadFactory ThreadFactory Executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œå¯ä»¥ç»™çº¿ç¨‹å–åå­— æ‹’ç»ç­–ç•¥ handler RejectedExecutionHandler æ‹’ç»ç­–ç•¥ public ThreadPoolExecutor(int corePoolSize, // æ ¸å¿ƒçº¿ç¨‹æ± å¤§å° int maximumPoolSize, // æœ€å¤§çº¿ç¨‹æ± å¤§å° long keepAliveTime, // çº¿ç¨‹å­˜æ´»æ—¶é—´ TimeUnit unit, // æ—¶é—´å•ä½ï¼ˆå¦‚ç§’ã€æ¯«ç§’ç­‰ï¼‰ BlockingQueue\u0026lt;Runnable\u0026gt; workQueue,//ç”¨äºå­˜æ”¾å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ— ThreadFactory threadFactory, // çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ RejectedExecutionHandler handler) { // æ‹’ç»ç­–ç•¥å¤„ç†å™¨ if (corePoolSize \u0026lt; 0 || // æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°å¿…é¡»å¤§äºæˆ–ç­‰äº0 maximumPoolSize \u0026lt;= 0 || // æœ€å¤§çº¿ç¨‹æ± å¤§å°å¿…é¡»å¤§äº0 maximumPoolSize \u0026lt; corePoolSize || // æœ€å¤§çº¿ç¨‹æ± å¤§å°ä¸èƒ½å°äºæ ¸å¿ƒçº¿ç¨‹æ± å¤§å° keepAliveTime \u0026lt; 0) // çº¿ç¨‹å­˜æ´»æ—¶é—´ä¸èƒ½å°äº0 throw new IllegalArgumentException(); // å‚æ•°ä¸åˆæ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (workQueue == null || threadFactory == null || handler == null) // å‚æ•°ä¸èƒ½ä¸ºç©º throw new NullPointerException(); // å‚æ•°ä¸ºç©ºï¼ŒæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ this.corePoolSize = corePoolSize; // è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ± å¤§å° this.maximumPoolSize = maximumPoolSize; // è®¾ç½®æœ€å¤§çº¿ç¨‹æ± å¤§å° this.workQueue = workQueue; // è®¾ç½®ä»»åŠ¡é˜Ÿåˆ— this.keepAliveTime = unit.toNanos(keepAliveTime); // å°†çº¿ç¨‹å­˜æ´»æ—¶é—´è½¬æ¢ä¸ºçº³ç§’ this.threadFactory = threadFactory; // è®¾ç½®çº¿ç¨‹å·¥å‚ this.handler = handler; // è®¾ç½®æ‹’ç»ç­–ç•¥å¤„ç†å™¨ } ã€çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ã€‘\nçº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Œ å¯ä»¥ç†è§£ä¸ºå»é“¶è¡ŒåŠä¸šåŠ¡ã€‚å…·ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\nå½“å‰çº¿ç¨‹æäº¤ä»»åŠ¡ ï¼ˆå‡†å¤‡å»å­˜é’±ï¼‰ åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦è¿˜åœ¨è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥è°ƒç”¨æ‹’ç»ç­–ç•¥ ï¼ˆé“¶è¡ŒæŸœå°ä»Šå¤©éƒ½æ²¡äººï¼Œ å¿«æ»šï¼‰ å¦‚æœçº¿ç¨‹æ± è¿˜åœ¨è¿è¡Œï¼Œåˆ™åˆ¤æ–­å·²æœ‰çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ·»åŠ å·¥ä½œçº¿ç¨‹ç›´æ¥æ‰§è¡Œ ï¼ˆæœ‰ç©ºé—²çš„æŸœå°å°å§å§ï¼Œå¯ä»¥å¸®å¿™åŠç†ä¸šåŠ¡ï¼‰ å¦‚æœå·²æœ‰çº¿ç¨‹æ•°å¤§äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ¤æ–­é˜»å¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ï¼Œå¦‚æœæ²¡æ»¡ï¼Œå°†å…¶æ”¾å…¥é˜»å¡é˜Ÿåˆ—å½“ä¸­ã€‚ï¼ˆæŸœå§å¿™ä¸è¿‡æ¥äº†ï¼Œå…ˆå»æ’é˜Ÿç­‰ç€ï¼‰ å¦‚æœé˜»å¡é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ï¼ˆæ’é˜Ÿçš„äººå¤ªå¤šäº†ï¼Œå·²ç»æ’ä¸ä¸‹äº†ã€‚å¤šå¼€ä¸€ä¸ªæŸœå°ï¼Œåˆ†é…ä¸€ä¸ªæŸœå§å»åŠç†ä¸šåŠ¡ï¼‰ å¦‚æœè¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œç›´æ¥æ ¹æ®æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚ï¼ˆå·²ç»æ²¡æœ‰å¤šçš„æŸœå§äº†ï¼Œåªèƒ½è®©ä»–æ»šè›‹äº†ï¼‰ ã€æ ¸å¿ƒçº¿ç¨‹æ”¯æŒè¢«å›æ”¶å—ï¼Ÿã€‘\nå¦‚æœçº¿ç¨‹æ± ç”¨äºå‘¨æœŸæ€§ä½¿ç”¨ã€é¢‘ç‡ä¸é«˜ï¼ˆå‘¨æœŸé—´æœ‰æ˜æ˜¾ç©ºé—²æ—¶é—´ï¼‰çš„åœºæ™¯ï¼Œå¯ä»¥å°† allowCoreThreadTimeOut (boolean value) æ–¹æ³•å‚æ•°è®¾ä¸º trueï¼Œ å›æ”¶ç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹ (æ—¶é—´é—´éš”è¿˜æ˜¯ç”± keepAliveTime æŒ‡å®š)\npublic void allowCoreThreadTimeOut(boolean value) { if (value \u0026amp;\u0026amp; keepAliveTime \u0026lt;= 0) // æ£€æŸ¥å­˜æ´»æ˜¯å¦åˆæ³• throw new IllegalArgumentException(\u0026#34;Core threads must have nonzero keep alive times\u0026#34;); if (value != allowCoreThreadTimeOut) { allowCoreThreadTimeOut = value; if (value) interruptIdleWorkers(); } } ã€çº¿ç¨‹æ± æ»¡äº†ï¼Œæœ‰å“ªäº›æ‹’ç»ç­–ç•¥?ã€‘\nç­–ç•¥åç§° ç‰¹æ€§ ç»ˆæ­¢ç­–ç•¥ AbortPolicy (é»˜è®¤) æŠ›å‡ºå¼‚å¸¸ RejectExecutionException æ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç† è°ƒç”¨è€…è¿è¡Œç­–ç•¥ CallerRunsPolicy è®©è°ƒç”¨çº¿ç¨‹æ± çš„executeæ–¹æ³•çš„çº¿ç¨‹ï¼Œè‡ªå·±æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœè°ƒç”¨çš„çº¿ç¨‹å·²ç»è¢«å…³é—­ï¼Œåˆ™ä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚è¿™ç§ç­–ç•¥ä¼šé™ä½æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ï¼Œå½±å“æ•´ä½“çš„æ€§èƒ½ã€‚å¦‚æœåœ¨æ‰¿å—å»¶è¿Ÿçš„èŒƒå›´å†…ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå¯ä»¥é€‰æ‹©è¯¥ç­–ç•¥ ä¸¢å¼ƒç­–ç•¥DiscardPolicy ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒ æœ€æ—©æœªå¤„ç†ä¸¢å¼ƒç­–ç•¥DiscardOldestPolicy ä¸¢å¼ƒæœ€æ—©æ²¡æœ‰è¢«å¤„ç†çš„ä»»åŠ¡è¯·æ±‚ ã€è°ƒç”¨è€…è¿è¡Œç­–ç•¥ CallerRunsPolicy æœ‰ä»€ä¹ˆé£é™©ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿã€‘\nå¦‚æœé‡‡ç”¨ CallerRunsPolicy ç­–ç•¥çš„ä»»åŠ¡æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¹¶ä¸”å¤„ç†æäº¤ä»»åŠ¡çš„æ˜¯ä¸»è¿›ç¨‹ã€‚å¯èƒ½ä¼šé˜»å¡ä¸»è¿›ç¨‹å¤„ç†å…¶ä»–çš„ä»»åŠ¡ï¼Œå½±å“ç¨‹åºæ­£å¸¸è¿è¡Œã€‚\nã€è§£å†³æ–¹æ¡ˆã€‘\n**å°½é‡é¿å…è°ƒç”¨æ‹’ç»ç­–ç•¥ **ï¼ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼‰\nè°ƒå¤§ maximumPoolSize æœ€å¤§çº¿ç¨‹å‚æ•°ï¼Œå¤šæ·»åŠ ä¸€äº›çº¿ç¨‹ï¼Œå……åˆ†åˆ©ç”¨ CPUã€‚æé«˜ä»»åŠ¡çš„å¤„ç†é€Ÿåº¦ï¼Œé¿å…åœ¨ é˜»å¡é˜Ÿåˆ—BlockingQueue çš„ä»»åŠ¡è¿‡å¤šå¯¼è‡´å†…å­˜ç”¨å®Œ å¢åŠ é˜»å¡é˜Ÿåˆ— BlockingQueue çš„å¤§å°å¹¶è°ƒæ•´å †å†…å­˜ï¼ˆæ–°å¢çš„æ•°æ®ï¼Œæ”¾åœ¨å †å†…å­˜ï¼‰ï¼Œå®¹çº³æ›´å¤šçš„ä»»åŠ¡ å¦‚æœæœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œéœ€è¦ä¿è¯ä»»åŠ¡ä¸è¢«ä¸¢å¼ƒ\nå®ç° RejectExecutionHandler æ¥å£è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œå½“çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—æ»¡äº†çŸ¥ä¹ï¼Œå°†æ²¡æ³•å„¿å¤„ç†çš„ä»»åŠ¡å­˜å‚¨åˆ° MySQL æ•°æ®åº“é‡Œé¢ å®ç°ä¸€ä¸ªç»§æ‰¿é˜»å¡é˜Ÿåˆ— BlockingQueue çš„æ··åˆé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ç»“åˆ ArrayBlockingQueue å’Œæ•°æ®åº“ã€‚é‡å†™ take() æ–¹æ³•ï¼Œä¼šä¼˜å…ˆä»æ•°æ®åº“è¯»å–æœ€é«˜çš„ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä» ArrayBlockingQueue ä¸­å–ä»»åŠ¡ ã€çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿã€‘\né˜»å¡é˜Ÿåˆ—åç§° ç‰¹æ€§ ç»‘å®šçš„çº¿ç¨‹æ± ç±» æœ‰ç•Œé˜»å¡é˜Ÿåˆ— LinkedBlockingQueue åº•å±‚ç”±é“¾è¡¨å®ç°ï¼Œå®¹é‡ä¸º int çš„æœ€å¤§å€¼ FixedThreadPoolã€SinglThreadExecutor **åŒæ­¥é˜Ÿåˆ— SynchronousQueue ** ä¿è¯å¯¹äºæäº¤çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹ï¼Œå°±ç”¨ç©ºé—²çº¿ç¨‹å¤„ç†ã€‚å¦åˆ™æ–°å»ºçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ CachedThreadPool å»¶è¿Ÿé˜Ÿåˆ— DelayedWorkQueue ä»»åŠ¡æŒ‰ç…§å»¶è¿Ÿæ—¶é—´é•¿çŸ­è¿›è¡Œæ’åºï¼Œä¸æŒ‰ç…§åŸæ¥çš„æ”¾å…¥é¡ºåºè¿›è¡Œæ’åºã€‚å†…éƒ¨é‡‡ç”¨ â€œå †â€ çš„æ•°æ®ç»“æ„ï¼Œç¡®ä¿æ¯æ¬¡å‡ºé˜Ÿä»»åŠ¡æ˜¯å½“å‰é˜Ÿåˆ—æ±‡æ€»æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ ScheduledThreadPoolã€SingleScheduledThreadPool æœ‰ç•Œé˜»å¡é˜Ÿåˆ— ArrayBlockingQueue åº•å±‚ç”±æ•°ç»„å®ç°ï¼Œå®¹é‡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ ã€çº¿ç¨‹æ± çš„å‚æ•°ä¸€èˆ¬å¦‚ä½•è®¾ç½®ï¼Ÿã€‘\nçº¿ç¨‹æ± çš„å‚æ•°å¯ä»¥æ ¹æ®ä»»åŠ¡çš„ç±»å‹æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ä¸åŒçš„æƒ…å†µï¼Œåˆ†åˆ«ä¸º CPU å¯†é›†å‹å’Œ I/O å¯†é›†å‹\nCPU å¯†é›†å‹ï¼šcorePoolSize = CPU æ ¸å¿ƒæ•°ç›® + 1\nè¿™ä¸€ç±»çš„ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨æ¥é˜²æ­¢è¿›ç¨‹å› ä¸ºä¸­æ–­è€Œè¢«æš‚åœï¼ˆæ¯”å¦‚è¯´ç¼ºé¡µä¸­æ–­ï¼‰\nI/O å¯†é›†å‹ï¼šcorePoolSize = CPU æ ¸å¿ƒæ•°ç›® * 2\nè¿™ä¸€ç±»çš„ä»»åŠ¡ï¼Œç³»ç»Ÿå¤§éƒ¨åˆ†æ—¶é—´åœ¨å¤„ç† I/O äº¤äº’ï¼Œ çº¿ç¨‹å¤„ç† I/O çš„æ—¶å€™ï¼Œä¸å  CPU èµ„æºã€‚æ‰€ä»¥ï¼Œå¯ä»¥æŠŠCPU è®©ç»™å…¶ä»–çº¿ç¨‹ã€‚æœ€æç«¯çš„æƒ…å†µå°±æ˜¯æœ‰ CPU æ ¸å¿ƒæ•°ç›®è¿™ä¹ˆå¤šçš„çº¿ç¨‹åœ¨å¤„ç† I/Oï¼Œ åˆšå¥½ CPU å…¨éƒ¨ç©ºå‡ºæ¥äº†ã€‚\nã€æ³¨æ„ã€‘ å¦‚æœçº¿ç¨‹æ•°ç›®è®¾ç½®çš„è¿‡å¤šï¼Œä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ˜¯å½“çº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†é‡æ–°å¤„äºå°±ç»ªçŠ¶æ€ï¼ŒæŠŠCPUè®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nã€çº¿ç¨‹æ± çš„ shutdown() å’Œ showdownNow() çš„ä½œç”¨å’ŒåŒºåˆ«ã€‘\nshutdown()ï¼šè®¾ç½®çŠ¶æ€ä¸ºshutdownï¼Œè®©æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ä¸­æ–­ã€‚æ­¤æ—¶ä¸èƒ½å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºRejectedExecutionException å¼‚å¸¸ã€‚\npublic void shutdown() { // è·å–çº¿ç¨‹æ± çš„ä¸»é”ï¼ˆReentrantLockï¼‰ï¼Œç”¨äºåŒæ­¥å…³é—­æ“ä½œ final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ try { // 1. æ£€æŸ¥æ˜¯å¦æœ‰æƒé™å…³é—­çº¿ç¨‹æ± ï¼ˆä¾‹å¦‚å®‰å…¨ç®¡ç†å™¨é™åˆ¶ï¼‰ checkShutdownAccess(); // 2. å°†çº¿ç¨‹æ± çŠ¶æ€æ¨è¿›åˆ° SHUTDOWNï¼Œé˜»æ­¢æ–°ä»»åŠ¡æäº¤ï¼ˆä½†å…è®¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼‰ advanceRunState(SHUTDOWN); // 3. ä¸­æ–­æ‰€æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼ˆæ­£åœ¨ç­‰å¾…ä»»åŠ¡çš„çº¿ç¨‹ï¼‰ interruptIdleWorkers(); // 4. è°ƒç”¨é’©å­æ–¹æ³•ï¼Œä¾›å­ç±»æ‰©å±•ï¼ˆå¦‚ ScheduledThreadPoolExecutor å–æ¶ˆå»¶è¿Ÿä»»åŠ¡ï¼‰ onShutdown(); // hook for ScheduledThreadPoolExecutor } finally { mainLock.unlock(); // é‡Šæ”¾é” } // 5. å°è¯•ç»ˆæ­¢çº¿ç¨‹æ± ï¼ˆè‹¥é˜Ÿåˆ—ä¸ºç©ºä¸”æ²¡æœ‰æ´»åŠ¨çº¿ç¨‹ï¼‰ tryTerminate(); } shutdownNow()ï¼šè¿”å›å“ªäº›è¿˜æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åå°è¯•ç»ˆæ­¢çº¿ç¨‹ã€‚å°è¯•ç»ˆæ­¢çº¿ç¨‹æ˜¯è°ƒç”¨ Thread.interrupt() æ–¹æ³•æ¥å®ç°çš„ã€‚shutdownNow() ä¸ä»£è¡¨çº¿ç¨‹æ± ä¸€å®šç«‹å³é€€å‡ºï¼Œå¯èƒ½è¦ç­‰æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å®Œæˆä¹‹åæ‰é€€å‡ºã€‚\npublic List\u0026lt;Runnable\u0026gt; shutdownNow() { List\u0026lt;Runnable\u0026gt; tasks; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { checkShutdownAccess(); advanceRunState(STOP); interruptWorkers(); tasks = drainQueue(); } finally { mainLock.unlock(); } tryTerminate(); return tasks; } ã€çº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸ä¹‹åï¼Œé”€æ¯è¿˜æ˜¯å¤ç”¨ï¼Ÿã€‘\næ­¤å¤„éœ€è¦åˆ†æˆä¸¤ç§æäº¤ä»»åŠ¡çš„æ–¹å¼æ¥åŒºåˆ†ï¼Œåˆ†åˆ«æ˜¯ execute() å’Œ submit() æ–¹å¼\nä½¿ç”¨ execute() æäº¤ä»»åŠ¡ï¼Œæ–°çº¿ç¨‹æ›¿æ¢è€çº¿ç¨‹ï¼šå½“ä»»åŠ¡é€šè¿‡ execute() æäº¤åˆ°çº¿ç¨‹æ± å¹¶ä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ã€‚å¦‚æœå¼‚å¸¸æ²¡æœ‰åœ¨ä»»åŠ¡å½“ä¸­è¿›è¡Œtry-catchï¼Œä¼šå¯¼è‡´å½“å‰çº¿ç¨‹ç»ˆæ­¢ã€‚å¼‚å¸¸ä¼šæ‰“å°åœ¨æ§åˆ¶å°æˆ–è€…æ—¥å¿—æ–‡ä»¶é‡Œé¢ã€‚çº¿ç¨‹æ± æ£€æµ‹åˆ°çº¿ç¨‹ç»ˆæ­¢ä¹‹åï¼Œä¼šåˆ›å»ºæ–°çº¿ç¨‹æ›¿æ¢åŸæ¥çš„çº¿ç¨‹ï¼Œç»´æŒé…ç½®çš„çº¿ç¨‹æ•°ä¸å˜ã€‚ ä½¿ç”¨ submit() æäº¤ä»»åŠ¡ï¼Œçº¿ç¨‹ä¸ç»ˆæ­¢ï¼šå¦‚æœåœ¨ä»»åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œä¸ä¼šç»ˆæ­¢å½“å‰çš„çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šç›´æ¥æ‰“å°å¼‚å¸¸ã€‚å¼‚å¸¸ä¼šè¢«å°è£…åœ¨ submit() è¿”å›çš„Future å¯¹è±¡é‡Œé¢ã€‚è°ƒç”¨ Future.get() å¯ä»¥çœ‹åˆ° ExecutionExceptionã€‚æ­¤æ—¶çº¿ç¨‹ä¸ä¼šå› ä¸ºå¼‚å¸¸è€Œç»ˆæ­¢ï¼Œè¿˜åœ¨çº¿ç¨‹æ± é‡Œé¢ï¼Œå‡†å¤‡æ‰§è¡Œåç»­ä»»åŠ¡ã€‚ ã€å¦‚ä½•ç»™çº¿ç¨‹å‘½åï¼Ÿã€‘\nå€ŸåŠ© guava ä¸­çš„ ThreadFactoryBuilder\npublic class ThreadFactoryBuilderDemo { static final String threadNamePrefix = \u0026#34;test-thread-name-prefix:\u0026#34;; public static void main(String[] args) { ThreadFactory threadFactory = new ThreadFactoryBuilder() .setNameFormat(threadNamePrefix + \u0026#34;---- SwimmingLiu\u0026#34;) .setDaemon(true) .build(); ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor( 1, 2, 60, TimeUnit.SECONDS, new ArrayBlockingQueue\u0026lt;\u0026gt;(1), threadFactory); Runnable target = () -\u0026gt; { String name = Thread.currentThread().getName(); System.out.println(name); }; poolExecutor.execute(target); poolExecutor.execute(target); poolExecutor.shutdown(); /* è¾“å‡º: test-thread-name-prefix:---- SwimmingLiu test-thread-name-prefix:---- SwimmingLiu */ } } è‡ªå®šä¹‰å®ç° ThreadFactory æ¥å£\n// çº¿ç¨‹å·¥å‚ï¼Œå®ƒè®¾ç½®çº¿ç¨‹åç§°ï¼Œæœ‰åˆ©äºæˆ‘ä»¬å®šä½é—®é¢˜ã€‚ public final class NamingThreadFactory implements ThreadFactory { private final AtomicInteger threadNum = new AtomicInteger(); private final String name; // åˆ›å»ºä¸€ä¸ªå¸¦åå­—çš„çº¿ç¨‹æ± ç”Ÿäº§å·¥å‚ public NamingThreadFactory(String name) { this.name = name; } @Override public Thread newThread(Runnable r) { Thread t = new Thread(r); t.setName(name + \u0026#34; [#\u0026#34; + threadNum.incrementAndGet() + \u0026#34;]\u0026#34;); return t; } } ã€å¦‚ä½•ç”¨ä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§é¡ºåºæ‰“å°å¥‡æ•°å’Œå¶æ•°ã€‘\npublic class PrintOddorEven { // ä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§é¡ºåºæ‰“å°å¥‡æ•°å’Œå¶æ•° private static final Object lock = new Object(); // synchronizedé”å¯¹è±¡ private static int count = 1; private static final int MAX_COUNT = 10; public static void main(String[] args) { Runnable printOdd = () -\u0026gt; { synchronized (lock) { while (count \u0026lt;= MAX_COUNT) { if (count % 2 != 0) { System.out.println(Thread.currentThread().getName() + \u0026#34;:\u0026#34; + count ++); lock.notify(); } else { try { lock.wait(); } catch (Exception error) { error.printStackTrace(); } } } } }; Runnable printEven = () -\u0026gt; { synchronized (lock) { while (count \u0026lt;= MAX_COUNT) { if (count % 2 == 0) { System.out.println(Thread.currentThread().getName() + \u0026#34;:\u0026#34; + count ++); lock.notify(); } else { try { lock.wait(); } catch (Exception error) { error.printStackTrace(); } } } } }; Thread printOddThread = new Thread(printOdd, \u0026#34;printOdd\u0026#34;); Thread printEvenThread = new Thread(printEven, \u0026#34;printEven\u0026#34;); printOddThread.start(); printEvenThread.start(); } } 9. ä½ ä½¿ç”¨è¿‡å“ªäº› Java å¹¶å‘å·¥å…·ç±»ï¼Ÿ é¢è¯•å®˜ï¼Œæ‚¨å¥½ã€‚æˆ‘ä½¿ç”¨è¿‡ ConcurrentHashMapã€BlockingQueueã€CountdownLatchã€AtomicIntegerã€Semaphore ã€CyclicBarrier è¿™äº›å·¥å…·ç±»ã€‚\nã€ CountDownLatch ã€‘\nCountDownLatch æ˜¯ JUC åŒ…ä¸­çš„ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œç”¨æ¥åè°ƒå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚å…è®¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ç»„æ“ä½œå®Œæˆã€‚ä¸€èˆ¬é€‚ç”¨äºä¸»çº¿æˆéœ€è¦ç­‰å¾…å¤šä¸ªå­çº¿ç¨‹å®Œæˆä»»åŠ¡çš„åœºæ™¯ã€‚CountDownLatch æ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨å®ç°çš„ï¼Œè¯¥è®¡æ•°å™¨æœ€å¼€å§‹è®°å½•éœ€è¦ç­‰å¾…çš„çº¿ç¨‹çš„æ€»ä¸ªæ•°ï¼Œç”±çº¿ç¨‹æ¥è¿›è¡Œé€’å‡ï¼Œç›´è‡³ä¸º 0\n// ç‹è€…è£è€€ï¼Œç­‰å¾…äº”ä½è‹±é›„åŠ è½½å®Œæˆä¹‹åï¼Œæ‰èƒ½å¼€å§‹æ¸¸æˆ // countDownLatch.countDown(); å°±ç›¸å½“äº notify() // countDownLatch.await(); å°±ç›¸å½“äº wait() // new CountDownLatch(int count), åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç»™å®šè®¡æ•°å™¨çš„ CountDownLatch public static void main(String[] args) throws InterruptedException { CountDownLatch countDownLatch = new CountDownLatch(5); Thread daqiao = new Thread(() -\u0026gt; { System.out.println(\u0026#34;å¤§ä¹”å·²å°±ä½ï¼\u0026#34;); countDownLatch.countDown(); // é‡Šæ”¾ä¿¡å· }); Thread lanlingwang = new Thread(() -\u0026gt; { System.out.println(\u0026#34;å…°é™µç‹å·²å°±ä½ï¼\u0026#34;); countDownLatch.countDown(); }); Thread anqila = new Thread(() -\u0026gt; { System.out.println(\u0026#34;å®‰å…¶æ‹‰å·²å°±ä½ï¼\u0026#34;); countDownLatch.countDown(); }); Thread nezha = new Thread(() -\u0026gt; { System.out.println(\u0026#34;å“ªå’å·²å°±ä½ï¼\u0026#34;); countDownLatch.countDown(); }); Thread kai = new Thread(() -\u0026gt; { System.out.println(\u0026#34;é“ å·²å°±ä½ï¼\u0026#34;); countDownLatch.countDown(); }); daqiao.start(); lanlingwang.start(); anqila.start(); nezha.start(); kai.start(); countDownLatch.await(); //ç­‰å¾…ä¿¡å· System.out.println(\u0026#34;å…¨å‘˜å°±ä½ï¼Œå¼€å§‹æ¸¸æˆï¼\u0026#34;); } ã€åœºæ™¯é¢˜ã€‘ å‡å¦‚è¦æŸ¥10ä¸‡å¤šæ¡æ•°æ®ï¼Œç”¨çº¿ç¨‹æ± åˆ†æˆ20ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œæ€ä¹ˆåšåˆ°ç­‰æ‰€æœ‰çš„çº¿ç¨‹éƒ½æŸ¥æ‰¾å®Œä¹‹åï¼Œå³æœ€åä¸€æ¡ç»“æœæŸ¥æ‰¾ç»“æŸäº†ï¼Œæ‰è¾“å‡ºç»“æœã€‚\npublic class CountDownLatchTest { private static int count = 100000; private static final int THREAD_TOTAL_NUMS = 20; private static final int BATCH_SIZE = count / THREAD_TOTAL_NUMS; @Test public void test() throws InterruptedException { CountDownLatch latch = new CountDownLatch(THREAD_TOTAL_NUMS); ExecutorService executor = Executors.newFixedThreadPool(THREAD_TOTAL_NUMS); ConcurrentLinkedQueue\u0026lt;String\u0026gt; results = new ConcurrentLinkedQueue\u0026lt;\u0026gt;(); // å­˜æ”¾æŸ¥è¯¢ç»“æœ for (int i = 0; i \u0026lt; THREAD_TOTAL_NUMS; i++) { int start = i * BATCH_SIZE; int end = (i == THREAD_TOTAL_NUMS - 1) ? count : (start + BATCH_SIZE); executor.submit(() -\u0026gt; { try { for (int k = start; k \u0026lt; end; k++) { results.add(\u0026#34;Data - \u0026#34; + k); } System.out.println(Thread.currentThread().getName() + \u0026#34;å·²å¤„ç†æ•°æ®ï¼š[\u0026#34; + start + \u0026#34;, \u0026#34; + (end - 1) + \u0026#34;]\u0026#34;); } finally { latch.countDown(); } }); } latch.await(); executor.shutdown(); System.out.println(\u0026#34;æŸ¥è¯¢å®Œæ¯•ï¼ŒæŸ¥è¯¢ç»“æœçš„æ€»æ•°ï¼š\u0026#34; + results.size()); } } ã€ CyclicBarrier ã€‘\nCyclicBarrier å°±æ˜¯å¯å¾ªç¯ä½¿ç”¨çš„å±éšœï¼Œä¸»è¦ç”¨äºè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆæˆ–è€…å«åŒæ­¥ç‚¹ï¼‰çš„æ—¶å€™ï¼Œé˜»å¡è¿™éƒ¨åˆ†çº¿ç¨‹ã€‚ç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚ CyclicBarrier å’Œ CountDownLatch å¾ˆç›¸ä¼¼ï¼Œéƒ½å¯ä»¥åè°ƒå¤šçº¿ç¨‹çš„ç»“æŸåŠ¨ä½œã€‚\nimport java.util.concurrent.BrokenBarrierException; import java.util.concurrent.CyclicBarrier; public class CyclicBarrierDemo { final static int threadCount = 3; static CyclicBarrier barrier = new CyclicBarrier(threadCount, () -\u0026gt; System.out.println(\u0026#34;æ‰€æœ‰çº¿ç¨‹éƒ½æŠµè¾¾è¯¥å±éšœï¼Œæ‰§è¡Œåç»­....\u0026#34;)); public static void main(String[] args) { for (int i = 0; i \u0026lt; threadCount; i++) { new T(barrier).start(); } /*è¾“å‡º: Thread-2 æ­£åœ¨æ‰§è¡Œä»»åŠ¡... Thread-1 æ­£åœ¨æ‰§è¡Œä»»åŠ¡... Thread-0 æ­£åœ¨æ‰§è¡Œä»»åŠ¡... Thread-0 åˆ°è¾¾å±éšœ Thread-1 åˆ°è¾¾å±éšœ Thread-2 åˆ°è¾¾å±éšœ æ‰€æœ‰çº¿ç¨‹éƒ½æŠµè¾¾è¯¥å±éšœï¼Œæ‰§è¡Œåç»­.... */ } } class T extends Thread { private CyclicBarrier barrier; public T(CyclicBarrier barrier) { this.barrier = barrier; } @Override public void run() { System.out.println(Thread.currentThread().getName() + \u0026#34; æ­£åœ¨æ‰§è¡Œä»»åŠ¡...\u0026#34;); try { Thread.sleep(1000); System.out.println(Thread.currentThread().getName() + \u0026#34; åˆ°è¾¾å±éšœ\u0026#34;); this.barrier.await(); // ç­‰å¾…å…¶ä»–çº¿ç¨‹ } catch (InterruptedException | BrokenBarrierException e) { throw new RuntimeException(e); } } } ã€ CountDownLatch å’Œ CyclicBarrier åŒºåˆ«ã€‘\nä½¿ç”¨æ¬¡æ•°ï¼šCountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼ˆè¾¾åˆ°æ¡ä»¶å°±ç»“æŸäº†ï¼‰ï¼ŒCyclicBarrier æ˜¯å¯ä»¥é‡å¤åˆ©ç”¨çš„ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªå±éšœ ï¼ˆå¤šä¸ªç»“æŸæ¡ä»¶ï¼‰ æ˜¯å¦èƒ½å¤Ÿç­‰å¾…å…¶ä»–çº¿ç¨‹ï¼šCountDownLatch ä¸­çš„å„ä¸ªå­çº¿ç¨‹éƒ½ä¸ä¼šç­‰å¾…å…¶ä»–çº¿ç¨‹ï¼Œåªèƒ½å®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚ CyclicBarrier çš„å„ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…å…¶ä»–çº¿ç¨‹ ç‰¹æ€§ CountDownLatch CyclicBarrier ä½¿ç”¨æ¬¡æ•° ä¸€æ¬¡æ€§çš„ï¼Œä¸åŒçš„çº¿ç¨‹åœ¨åŒä¸€ä¸ªè®¡æ•°å™¨ä¸Šå·¥ä½œï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0 å¯é‡å¤åˆ©ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡ï¼Œç„¶åæ‹†é™¤å¯¹åº”çš„å±éšœ é¢å‘å¯¹è±¡ ä»»åŠ¡æ•° çº¿ç¨‹æ•° ï¼ˆæ‰€æœ‰çº¿ç¨‹éƒ½å®Œæˆä»»åŠ¡ï¼Œæ‹†é™¤å±éšœï¼‰ å®šä¹‰æ–¹å¼ æŒ‡å®šä»»åŠ¡æ•°ï¼Œè¿™éƒ¨åˆ†ä»»åŠ¡ç”±å“ªäº›çº¿ç¨‹å®Œæˆæ— æ‰€è°“ æŒ‡å®šéœ€è¦å‚ä¸åä½œçš„çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»è°ƒç”¨await() ç»“æŸæ¡ä»¶ è®¡æ•°å™¨ä¸º 0 ï¼Œå°±ç›´æ¥ç»“æŸäº† æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åï¼Œå¯ä»¥é‡å¤åˆ©ç”¨ å‡ºç°å¼‚å¸¸ æŸä¸ªçº¿ç¨‹å‡ºç°é—®é¢˜ï¼Œå…¶ä»–çº¿ç¨‹ä¸å—å½±å“ æŸä¸ªçº¿ç¨‹å‡ºç°é—®é¢˜ï¼ˆä¸­æ–­ã€è¶…æ—¶ï¼‰ï¼Œåˆ™å¤„äºawait() çš„çº¿ç¨‹ä¼šå‡ºé—®é¢˜ ã€Semaphore ä¿¡å·é‡ã€‘\nSemaphore ä¿¡å·é‡æ˜¯ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®tç‰¹å®šèµ„æºçš„çº¿ç¨‹é‡ï¼Œé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œä¿è¯åˆç†çš„ä½¿ç”¨å…¬å…±èµ„æºã€‚Semaphore çš„å¸¸è§„ç”¨é€”æ˜¯ç”¨ä½œæµé‡æ§åˆ¶ï¼Œæ¯”å¦‚è¯´è¿æ¥æ•°æ®åº“çš„çº¿ç¨‹æ•°é‡, æ•°æ®åº“è¿æ¥æ•°é‡æ˜¯éœ€è¦æ§åˆ¶çš„ã€‚ å‡å¦‚æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦è¯»å– 10w ä¸ªæ–‡ä»¶ï¼Œç„¶åå­˜å…¥æ•°æ®åº“å½“ä¸­ã€‚å› ä¸ºå¤§éƒ¨åˆ†éƒ½æ˜¯ I/O æ“ä½œï¼Œå±äº I/O å¯†é›†å‹ï¼Œå¯ä»¥é‡‡ç”¨å¤šçº¿ç¨‹è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯ï¼Œæ•°æ®åº“çš„è¿æ¥æ•°é‡æ˜¯æœ‰é™çš„ï¼ˆå‡å¦‚æ˜¯ 10 ä¸ªï¼‰ï¼Œæ‰€ä»¥å¿…é¡»è¦æ§åˆ¶åªæœ‰ 10 ä¸ªçº¿ç¨‹æ¥è¿æ¥æ•°æ®åº“ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ç”¨Semaphore ä¿¡å·é‡æ¥æ§åˆ¶æµé‡ã€‚\n// ä¸‹é¢è®¾ç½®çš„çº¿ç¨‹æ˜¯30ä¸ªï¼Œä½†æ˜¯åªå…è®¸10ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚ä½¿ç”¨Semaphoreå½“ä¸­çš„acquireå’Œreleaseæ¥è¿›è¡Œæ§åˆ¶ã€‚ public class SemaphoreTest { private static final int THREAD_COUNT = 30; private static ExecutorService threadPool = Executors.newFixedThreadPool(THREAD_COUNT); private static Semaphore s = new Semaphore(10); public static void main(String[] args) { for (int i = 0; i \u0026lt; THREAD_COUNT; i++) { threadPool.execute(new Runnable() { @Override public void run() { try { s.acquire(); System.out.println(\u0026#34;save data\u0026#34;); s.release(); } catch (InterruptedException e) { } } }); } threadPool.shutdown(); } } 10. Synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç‰¹æ€§ Synchronized ReentrantLock å®ç°æœºåˆ¶ Javaå†…ç½®çš„å…³é”®å­—ï¼Œä¾èµ– JVM å®ç°åŸºæœ¬çš„åŒæ­¥æœºåˆ¶, åŸºäºç›‘ç®¡å™¨ Monitor ï¼ˆé‡é‡çº§ï¼‰ å’Œ å¯¹è±¡å¤´ï¼ˆåå‘é”å’Œè½»é‡çº§é”ï¼‰å®ç° JUC ç±»åº“æä¾›çš„ï¼ŒåŸºäº AQS ï¼ˆ AbstactQueuedSynchronizer ï¼‰æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨å®ç° åŠ é”/è§£é” JVM è‡ªåŠ¨å¯¹ä»£ç å—/æ–¹æ³•è¿›è¡ŒåŠ é”å’Œé‡Šæ”¾é” æ˜¾ç¤ºé”æœºåˆ¶ï¼Œéœ€è¦é€šè¿‡ lock() å’Œ unlock() æ‰‹åŠ¨ç®¡ç†é”çš„è·å–å’Œé‡Šæ”¾ æ˜¯å¦å¯é‡å…¥ å¯é‡å…¥ å¯é‡å…¥ çµæ´»æ€§ ä¸å¤ªçµæ´»ï¼Œåªæ”¯æŒéå…¬å¹³é”ï¼Œä¸æ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´ã€ä¸æ”¯æŒä¸­æ–­ï¼Œä»¥åŠå¤šæ¡ä»¶åˆ¤æ–­ã€‚ æ¯”è¾ƒçµæ´»ï¼Œæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œæ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆé¿å…æ­»é”ï¼‰ï¼Œå¯ä»¥ä¸­æ–­ï¼Œæ”¯æŒå¤šæ¡ä»¶åˆ¤æ–­ ã€Java å½“ä¸­å¸¸ç”¨çš„é”æœ‰å“ªäº›ï¼Ÿã€‘\nsynchronized åŒæ­¥é”ï¼šä¿®é¥°æ–¹æ³•æˆ–è€…ä»£ç å—ã€‚çº¿ç¨‹è¿›å…¥synchronized ä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—çš„æ—¶å€™ï¼Œä¼šè·å–å…³è”å¯¹è±¡çš„é” (ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª Object ç±»å‹çš„é”å¯¹è±¡)ã€‚å½“çº¿ç¨‹é€€å‡ºè¯¥ä»£ç å—æˆ–è€…æ–¹æ³•çš„æ—¶å€™ï¼Œé”ä¼šè¢«é‡Šæ”¾ã€‚å…¶ä»–çº¿ç¨‹å°è¯•è·å–åŒä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œä¼šè¢«é˜»å¡çŸ¥é“é”è¢«é‡Šæ”¾ã€‚\nReentrantLock å¯é‡å…¥é”ï¼šéœ€è¦é€šè¿‡æ‰‹åŠ¨è°ƒç”¨ lock() å’Œ unlock() æ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾é”ã€‚æ”¯æŒæ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä¸­æ–­çš„é”ç­‰å¾…ã€å®šæ—¶é”ç­‰å¾…ã€å…¬å¹³é”ç­‰å¾…ç­‰\nReadWriteLock è¯»å†™é”ï¼šå…è®¸å¤šä¸ªè¯»å–çº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªå†™å…¥è€…ã€‚è¯»å†™é”ä¸€èˆ¬ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§\nä¹è§‚é”å’Œæ‚²è§‚é”\nä¹è§‚é”ï¼šé€šå¸¸ä¸ä¼šé”å®šèµ„æºï¼Œåªæœ‰åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ã€‚ä¸€èˆ¬é€šå¸¸ä½¿ç”¨ç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³æ¥å®ç° ï¼ˆ CAS å°±æ˜¯ä¹è§‚é”ï¼‰\næ‚²è§‚é”ï¼šåœ¨è®¿é—®æ•°æ®å‰å°±é”å®šèµ„æºï¼Œå°±å‡è®¾ä¼šå‡ºç°æœ€åçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ•°æ®å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ã€‚ synchronized å’Œ ReentrantLock éƒ½æ˜¯æ‚²è§‚é”\n11. Java ä¸­ volatile å…³é”®å­—çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ volatile å…³é”®å­—å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä¹Ÿå°±æ˜¯ä¿è¯çº¿ç¨‹å¯¹å˜é‡çš„ä¿®æ”¹æ˜¯å¯è§çš„ï¼Œå¹¶ä¸”ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚å½“å˜é‡è¢«å£°æ˜ä¸º volatileï¼Œ åˆ™æŒ‡ç¤º JVM è¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”å¼‚å˜çš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œéœ€è¦ä»ä¸»å­˜æˆ¿ä¸­è¿›è¡Œè·å–æœ€æ–°çš„å˜é‡å€¼ã€‚\nå¯è§æ€§ï¼šå½“æŸä¸ªçº¿ç¨‹ä¿®æ”¹äº† volatile å˜é‡çš„å€¼ï¼Œæ–°å€¼ä¼šç«‹å³è¢«åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚å…¶ä»–çº¿ç¨‹åœ¨è¯»å–è¯¥å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥è·å–æœ€æ–°çš„å€¼ã€‚è¿™æ ·å¯ä»¥é¿å…çº¿ç¨‹é—´ç”±äºç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å¯¼è‡´è¯»å–åˆ°æ—§å€¼çš„ç°è±¡ã€‚ï¼ˆå› ä¸ºæ¯ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ ˆå¸§ä¼šè®°å½•ä¸»å†…å­˜ä¸­çš„è¯»å–çš„ï¼‰ æœ‰åºæ€§ï¼ˆç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼‰: volatile é€šè¿‡å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šæƒ…å†µä¸‹çš„æŒ‡ä»¤é‡æ’åº ï¼ˆå†™å±éšœå’Œè¯»å±éšœï¼‰ï¼Œä»è€Œä¿è¯ç¨‹åºçš„æ‰§è¡Œé¡ºåºç¬¦åˆé¢„æœŸã€‚å¯¹ volatile å˜é‡çš„å†™æ“ä½œä¼šå†å‰é¢åŠ æ’å…¥ä¸€ä¸ª StoreStore å†™å±éšœï¼Œå¯¹ volatile å˜é‡çš„è¯»æ“ä½œï¼Œåˆ™ä¼šåœ¨å˜é‡çš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad è¯»å±éšœã€‚ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŸäº›ä»£ç å—çš„æ‰§è¡Œé¡ºåºçš„å¯é¢„æµ‹æ€§ã€‚ ã€volatile å…³é”®å­—å¦‚ä½•å®ç°ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Ÿã€‘\nåœ¨ä¸»å­˜å½“ä¸­ï¼Œä¸»è¦é€šè¿‡å†…å­˜å±éšœç±»ç¦æ­¢ç‰¹å®šç±»å‹çš„æŒ‡ä»¤é‡æ–°æ’åºã€‚(å†™å‰è¯»åï¼Œvolatile ç¦æ­¢é‡æ’)\nå†™-å†™å±éšœ (Write-Write)ï¼šå¯¹ volatile å˜é‡è¿›è¡Œå†™æ“ä½œä¹‹å‰ï¼Œä¼šæ’å…¥ä¸€ä¸ªå†™å±éšœã€‚ç¡®ä¿åœ¨è¯¥å˜é‡å†™æ“ä½œä¹‹å‰çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œéƒ½å®Œæˆäº†ã€‚ è¯»-å†™å±éšœ (Read-Write)ï¼šå¯¹ volatile å˜é‡æ‰§è¡Œè¯»æ“ä½œä¹‹åï¼Œä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœã€‚ç¡®ä¿äº†å¯¹ volatile å˜é‡çš„è¯»æ“ä½œåçš„æ™®é€šè¯»æ“ä½œï¼Œä¸ä¼šæå‰åˆ° volatile è¯»ä¹‹å‰ï¼Œç¡®ä¿è¯»åˆ°æœ€æ–°çš„æ•°æ®ã€‚ å†™-è¯»å±éšœ (Write-Read) ï¼šå†™-è¯»å±éšœæ˜¯æœ€é‡è¦çš„å±éšœï¼Œè¿™ä¸ªå±éšœå¯ä»¥ç¡®ä¿ volatile å†™æ“ä½œä¹‹å‰çš„å†…å­˜æ“ä½œ ï¼ˆåŒ…æ‹¬å†™æ“ä½œï¼‰ ä¸ä¼šé‡æ’åºåˆ° volatile è¯»æ“ä½œåï¼Œå¹¶ä¸” volatile è¯»åçš„å†…å­˜æ“ä½œï¼ˆåŒ…æ‹¬è¯»æ“ä½œï¼‰ä¸ä¼šé‡æ’åºåˆ°volatile å†™æ“ä½œä¹‹å‰ ã€æ³¨æ„ã€‘ ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼ŒJMM Javaå†…å­˜æ¨¡å‹åœ¨ä¸æ”¹å˜æ­£ç¡®è¯­ä¹‰çš„æƒ…å†µä¸‹ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ’åºã€‚\nã€volatile å’Œ synchronized åŒºåˆ«ã€‘\nsynchronized ï¼šsynchronized æ˜¯æ’ä»–æ€§åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶çš„äº’æ–¥æ€§ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚é€šè¿‡åœ¨ä»£ç å—æˆ–è€…æ–¹æ³•ä¸Šï¼Œæ·»åŠ è¯¥å…³é”®å­—å®ç°åŒæ­¥ã€‚å¯ä»¥ç¡®ä¿åŸå­æ€§ volatile ï¼švolatile æ˜¯è½»é‡çº§åŒæ­¥æœºåˆ¶ï¼Œä¿è¯å˜é‡å¯è§æ€§å’Œæœ‰åºæ€§ (ç¦æ­¢æŒ‡ä»¤é‡æ’åº)ã€‚å˜é‡å£°æ˜æˆ volatile çš„æ—¶å€™ï¼Œçº¿ç¨‹è¯»è¯¥å˜é‡çš„æ—¶å€™ï¼Œç›´æ¥ä»ä¸»å†…å­˜å½“ä¸­è¯»å–ï¼Œä¸ä½¿ç”¨å·¥ä½œå†…å­˜å½“ä¸­çš„ç¼“å­˜ã€‚å†™æ“ä½œç«‹å³åˆ·å›ä¸»å†…å­˜ï¼Œä¸ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ ã€volatile åº”ç”¨åœºæ™¯ã€‘\nç”¨äºæŒ‡ç¤ºå‘ç”Ÿä¸€ä¸ªé‡è¦çš„ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œæ¯”å¦‚å®Œæˆäº†åˆå§‹åŒ–æˆ–è€…è¯·æ±‚åœæœº\nvolatile boolean shutdownRequested; public void shutdown() { shutdownRequested = true; } public void doWork() { while(!shutdownRequested) { // æ‰§è¡Œä»»åŠ¡ } } volatile bean æ¨¡å¼ï¼šJavaBean ä¸­çš„æ‰€æœ‰æ•°æ®æˆå‘˜éƒ½æ˜¯ volatile ç±»å‹çš„ï¼Œå¹¶ä¸” getter å’Œ setter æ–¹æ³•ï¼Œé™¤äº†è·å–æˆ–è€…è®¾ç½®ç›¸åº”çš„å±æ€§ä¹‹å¤–ï¼Œä¸èƒ½åŒ…å«ä»»ä½•é€»è¾‘ã€‚å¯¹äºå¼•ç”¨çš„æ•°æ®æˆå‘˜ï¼Œå¼•ç”¨çš„å¯¹è±¡å¿…é¡»æ˜¯æœ‰æ•ˆä¸”ä¸å¯å˜çš„ã€‚\npublic class Person { private volatile String firstName; private volatile String lastName; private volatile int age; public String getFirstName() { return firstName; } public String getLastName() { return lastName; } public int getAge() { return age; } public void setFirstName(String firstName) { this.firstName = firstName; } public void setLastName(String lastName) { this.lastName = lastName; } public void setAge(int age) { this.age = age; } } å†™é”ç­–ç•¥ï¼šé€šè¿‡å†…éƒ¨é”å’Œ volatile å˜é‡å‡å°‘å…¬å…±ä»£ç è·¯å¾„çš„å¼€é”€ã€‚è®¡ç®—å™¨ä½¿ç”¨ synchronized ä¿è¯å¢é‡æ“ä½œçš„åŸå­æ€§ï¼Œå¹¶ç”¨ volatile ç¡®ä¿ç»“æœçš„å¯è§æ€§ã€‚å¦‚æœæ›´æ–°ä¸é¢‘ç¹ï¼Œè¯¥æ–¹æ³•æ€§èƒ½æ›´ä¼˜ã€‚å› ä¸ºè¯»æ“ä½œåªæ¶‰åŠ volatile è¯»å–ï¼Œæ¯”æ— ç«äº‰çš„é”è·å–å¼€é”€è¿˜è¦å°\n@ThreadSafe // æ ‡è¯†è¯¥ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€é€šè¿‡åŒæ­¥æœºåˆ¶ä¿è¯å¤šçº¿ç¨‹è®¿é—®çš„æ­£ç¡®æ€§ public class CheesyCounter { // ä½¿ç”¨ volatile ä¿è¯å¯è§æ€§ï¼Œä½†å¤åˆæ“ä½œï¼ˆå¦‚ value++ï¼‰ä»éœ€åŒæ­¥ @GuardedBy(\u0026#34;this\u0026#34;) // è¯¥å­—æ®µå—å¯¹è±¡å†…éƒ¨é”ï¼ˆthisï¼‰ä¿æŠ¤ï¼Œå†™æ“ä½œå¿…é¡»æŒæœ‰é” private volatile int value; // è¯»æ“ä½œæœªåŠ é”ï¼Œä¾èµ– volatile çš„å¯è§æ€§ä¿è¯ public int getValue() { return value; // volatile ä¿è¯è¯»å–æœ€æ–°å€¼ï¼Œä½†å¤šçº¿ç¨‹ä¸‹éœ€æ³¨æ„\u0026#34;å…ˆéªŒæ¡ä»¶\u0026#34;çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ } // å†™æ“ä½œé€šè¿‡ synchronized ä¿è¯åŸå­æ€§å’Œå¯è§æ€§ public synchronized int increment() { return value++; // åŒæ­¥é”ç¡®ä¿å¤åˆæ“ä½œï¼ˆè¯»-æ”¹-å†™ï¼‰çš„åŸå­æ€§ } } 12. è¯·ä½ è®²è®²ThreadLocalæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ ThreadLocal å‚è€ƒææ–™\næ­£å¸¸çš„æƒ…å†µä¸‹é¢ï¼Œä½¿ç”¨ ThreadLocal ä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯åœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æ•°æ®æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„é—®é¢˜ï¼š\nå†…å­˜æ³„éœ²é—®é¢˜ ï¼šThreadLocal çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰ç»“æŸçš„è¯ï¼Œ ThreadLocal å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½è¢«å¤ç”¨ï¼Œå¦‚æœ ThreadLocal ä¸­çš„å€¼ä¸ä¼šè‡ªåŠ¨æ¸…ç†ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ã€‚ ã€æ³¨æ„ã€‘å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯æŒ‡ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å†…å­˜æœªè¢«æ­£ç¡®é‡Šæ”¾ï¼Œå¯¼è‡´è¿™éƒ¨åˆ†å†…å­˜æ— æ³•è¢«å›æ”¶ï¼Œé•¿æœŸå ç”¨ç³»ç»Ÿèµ„æºçš„ç°è±¡\nå“ˆå¸Œå†²çªçš„å¤„ç†æ–¹å¼ï¼Œæ•ˆç‡ä½ï¼šThreadLocal ä¸­çš„ ThreadLocalMap Hashå†²çªç”¨çš„æ˜¯çº¿æ€§æ¢æµ‹æ³• (æ‰¾åˆ°slotToExpunge ï¼Œç„¶åé€ä¸ªå‘å‰éå†æ‰¾åˆ°åˆé€‚çš„ä½ç½®)ã€‚å¦‚æœå†²çªçš„æ¬¡æ•°æ¯”è¾ƒå¤šï¼Œéœ€è¦éå†çš„æ¬¡æ•°å°±å¾ˆå¤šäº†ã€‚å¦å¤–ï¼Œåé¢å†æ¬¡ get æŸ¥æ‰¾è¯¥å…ƒç´ çš„æ—¶å€™ï¼ŒHashå‘½ä¸­ä¹‹åï¼Œä»ç„¶éœ€è¦å‘åéå†æ¥æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ ã€‚ä¼˜åŒ–æ–¹å¼æ˜¯åƒ HashMap ä¸€æ ·æ”¹æˆæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ ä¸»åŠ¨æ¸…ç† key ä¸º null çš„å¼€é”€ï¼šThreadLocal éœ€è¦ä¸»åŠ¨æ¸…ç† Entry çš„ key ä¸ºç©ºçš„å¯¹è±¡ï¼Œä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€ã€‚å› ä¸º ThreadLocal ä½¿ç”¨äº†å¼±å¼•ç”¨æ¥ä¿è¯èµ„æºå¯ä»¥è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯èƒ½ä¼šäº§ç”Ÿä¸€äº› Entry çš„ key ä¸º nullï¼Œä¹Ÿå°±æ˜¯æ— ç”¨çš„ Entry å­˜åœ¨ã€‚éœ€è¦åœ¨ä½¿ç”¨ set å’Œ get æ–¹æ³•çš„æ—¶å€™ï¼ŒThreadLocal ä¼šæ¸…ç†æ‰æ— ç”¨çš„ Entryï¼Œ å‡è½»å†…å­˜æ³„éœ²çš„å‘ç”Ÿã€‚å¦‚æœéœ€è¦æ¸…ç†çš„Entry å¯¹è±¡å¾ˆå¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´ get å’Œ set æ“ä½œç›¸å¯¹æ¯”è¾ƒæ…¢ã€‚\n13. ä¸ºä»€ä¹ˆ Java ä¸­çš„ ThreadLocal å¯¹ key çš„å¼•ç”¨ä¸ºå¼±å¼•ç”¨ï¼Ÿ ThreadLocal å¯¹ key çš„å¼•ç”¨é‡‡ç”¨å¼±å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æ³„éœ²ã€‚å¦‚æœ ThreadLocal å®ä¾‹è¢«ä¸å†éœ€è¦çš„çº¿ç¨‹æŒæœ‰ä¸ºå¼ºå¼•ç”¨ï¼Œå³ä¾¿çº¿ç¨‹ç»“æŸä¹‹åï¼Œç›¸å…³çš„ ThreadLocal å®ä¾‹åŠå…¶å¯¹åº”çš„æ•°æ®å¯èƒ½æ— æ³•è¢«å›æ”¶ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æŒç»­å ç”¨ã€‚å¼±å¼•ç”¨å…è®¸åƒåœ¾å›æ”¶å™¨åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå›æ”¶å¯¹è±¡ã€‚å¦‚æœå½“æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æŒ‡å‘æŸä¸ª ThreadLocal å®ä¾‹æ—¶ï¼Œå®ƒå¯ä»¥è¢«åŠæ—¶å›æ”¶ï¼Œé¿å…é•¿æ—¶é—´å ç”¨å†…å­˜ã€‚\nã€æ³¨æ„ã€‘ å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨çš„åŒºåˆ«å¦‚ä¸‹ï¼š\nå¼±å¼•ç”¨ï¼šå½“å¯¹è±¡è¢«å¼±å¼•ç”¨å…³è”çš„æ—¶å€™ï¼Œåƒåœ¾å›æ”¶å™¨ GC æ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šåœ¨ä¸‹æ¬¡ GC è¿è¡Œçš„æ—¶å€™ï¼Œå›æ”¶è¯¥å¯¹è±¡ã€‚ è½¯å¼•ç”¨ï¼šå½“å¯¹è±¡è¢«è™šå¼•ç”¨çš„æ—¶å€™ï¼Œåƒåœ¾å›æ”¶å™¨ GC åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œä¼šå›æ”¶æ‰è½¯å¼•ç”¨å¯¹è±¡æ¥é‡Šæ”¾å†…å­˜ï¼Œä¸€èˆ¬ç”¨äºå®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ (å†…å­˜æ•æ„ŸæŒ‡çš„æ˜¯é¿å…è¿‡åº¦æ¶ˆè€—å†…å­˜ï¼Œéå¸¸èŠ‚çº¦å†…å­˜çš„ä½¿ç”¨) ã€æ€»ç»“ã€‘\nå¼±å¼•ç”¨ï¼šThreadLocal ä½¿ç”¨å¼±å¼•ç”¨ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢å†…å­˜æ³„éœ²ã€‚å¦‚æœé‡‡ç”¨å¼ºå¼•ç”¨çš„è¯ï¼Œå½“ä¸»çº¿ç¨‹å½“ä¸­çš„ ThreadLocal ç›¸å…³ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆæ¡¢è¢«å¼¹å‡ºï¼ŒEntry å¯¹è±¡ä»ç„¶å¼ºå¼•ç”¨ç€ ThreadLocal å¯¹è±¡ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚\nThreadLocal åº•å±‚åŸç†ï¼š\næ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ ThreadLocalMap ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ª ThreadLocalMap å½“ä¸­åŒ…å«å¤šä¸ª Entryå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æ˜¯å­˜å‚¨åœ¨æ•°ç»„ä¸Šï¼Œé‡‡ç”¨å¼ºå¼•ç”¨ Entry å¯¹è±¡é€šè¿‡å¼±å¼•ç”¨å…³è”å½“å‰è¦ä½¿ç”¨çš„ ThreadLocal å¯¹è±¡ï¼Œå®ƒçš„ key å°±æ˜¯ ThreadLocalï¼Œ value æ˜¯æˆ‘ä»¬éœ€è¦è®¾ç½®çš„å€¼ï¼Œå¯ä»¥ä¸ºä»»æ„ Java å¯¹è±¡ç±»å‹ã€‚ ThreadLocal é€šè¿‡å¼ºå¼•ç”¨ value ä¿å­˜è®¾ç½®çš„å€¼ ä¸»çº¿ç¨‹å½“ä¸­ä½¿ç”¨ ThreadLocal çš„æ—¶å€™ï¼Œé‡‡ç”¨å¼ºå¼•ç”¨æŒ‡å‘ Entry å½“ä¸­çš„ ThreadLocal å¯¹è±¡ é‡‡ç”¨å¼±å¼•ç”¨ä¹‹åï¼Œä¹Ÿåªèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢å†…å­˜æ³„éœ²ã€‚åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰åœºæ™¯ä¸­ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½é•¿äº ThreadLocal å®ä¾‹ï¼ŒThreadLocalMap å¯èƒ½ä¸€ç›´è¢«å¼ºå¼•ç”¨ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨å®Œ ThreadLocal åï¼Œéœ€è¦è°ƒç”¨ remove() æ–¹æ³•æ¸…ç† ThreadLocalMap ä¸­å¯èƒ½æ®‹ç•™æ— ç”¨çš„é”®å€¼å¯¹ã€‚\nThreadLocal å†…éƒ¨åœ¨æ‰§è¡Œ set å’Œ get çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¹Ÿä¼šåƒåéå†å»æ¸…ç†æ‰ key ä¸º null çš„ Entry å¯¹è±¡ã€‚\n","permalink":"https://swimmingliu.cn/posts/job/java-juc-interview-questions/","summary":"\u003ch2 id=\"1-ä»€ä¹ˆæ˜¯-java-å†…å­˜æ¨¡å‹jmm\"\u003e1. ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eJMM\u003c/code\u003e æ˜¯ Javaå†…å­˜æ¨¡å‹ ï¼Œ å®ƒæ˜¯Javaè™šæ‹Ÿæœº \u003ccode\u003eJVM\u003c/code\u003e å®šä¹‰çš„ä¸€ç§è§„èŒƒï¼Œç”¨äºæè¿°å¤šçº¿ç¨‹ç¨‹åºä¸­çš„å˜é‡ï¼Œåƒå®ä¾‹å­—æ®µã€é™æ€å­—æ®µå’Œæ•°ç»„å…ƒç´ ï¼Œä»–ä»¬å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨å’Œä¼ é€’çš„è§„åˆ™ã€‚ä¹Ÿå°±æ˜¯è§„å®šçº¿ç¨‹å•¥æ—¶å€™ä»ä½å†…å­˜é‡Œé¢è¯»æ•°æ®ï¼Œå•¥æ—¶å€™æŠŠæ•°æ®å†™å›åˆ°ä½å†…å­˜ã€‚\u003ccode\u003eJMM\u003c/code\u003e çš„æ ¸å¿ƒç›®æ ‡æ˜¯ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„\u003cstrong\u003eå¯è§æ€§\u003c/strong\u003eã€\u003cstrong\u003eæœ‰åºæ€§\u003c/strong\u003eå’Œ\u003cstrong\u003eåŸå­æ€§\u003c/strong\u003e, é¿å…ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„ä¸ä¸€è‡´é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eJMM\u003c/code\u003e  å½“ä¸­åŒ…å«\u003cstrong\u003eä¸»å†…å­˜\u003c/strong\u003e (æ‰€æœ‰çº¿ç¨‹å…±äº«) å’Œ \u003cstrong\u003eå·¥ä½œå†…å­˜\u003c/strong\u003e ï¼ˆæ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼‰ä¸¤ç§å†…å­˜ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eä¸»å†…å­˜\u003c/strong\u003eï¼šä¸»å†…å­˜æ˜¯Javaå †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œå­˜å‚¨å…¨å±€å˜é‡ï¼Œæ¯”å¦‚é™æ€å˜é‡ã€å®ä¾‹å­—æ®µã€æ•°ç»„å…ƒç´ ç­‰ç­‰ã€‚çº¿ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ï¼Œå¿…é¡»é€šè¿‡å·¥ä½œå†…å­˜é—´æ¥è®¿é—®ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå·¥ä½œå†…å­˜\u003c/strong\u003eï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œç¼“å­˜ä¸»å†…å­˜çš„å˜é‡å‰¯æœ¬ã€‚çº¿ç¨‹å¯¹å˜é‡çš„è¯»å†™æ“ä½œå‡åœ¨å·¥ä½œå†…å­˜ç§è¿›è¡Œï¼Œä¿®æ”¹åçš„ç»“æœéœ€è¦åŒæ­¥ä¼šä¸»å†…å­˜ã€‚çº¿ç¨‹æ˜¯é€šè¿‡å†…å­˜å±éšœ ( \u003ccode\u003evolatile\u003c/code\u003e å…³é”®å­—) æˆ–è€… åŒæ­¥æ“ä½œ ( \u003ccode\u003esynchronized\u003c/code\u003e ) å®ç°ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„æ•°æ®ä¸€è‡´æ€§çš„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§å®šä¹‰ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå¯è§æ€§\u003c/strong\u003eï¼šç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œèƒ½å¤ŸåŠæ—¶è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°ã€‚ \u003ccode\u003evolatile\u003c/code\u003eå°±æ˜¯ç”¨æ¥ä¿è¯å¯è§æ€§çš„ï¼Œå¼ºåˆ¶çº¿ç¨‹æ¯æ¬¡è¯»å†™çš„æ—¶å€™ï¼Œç›´æ¥ä»ä¸»å†…å­˜å½“ä¸­è·å–æœ€æ–°å€¼ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæœ‰åºæ€§\u003c/strong\u003eï¼šæŒ‡çº¿ç¨‹æ‰§è¡Œæ“ä½œçš„é¡ºåºã€‚JMMå…è®¸æŸäº›æŒ‡ä»¤é‡æ’åºä¹‹åå†æé«˜æ€§èƒ½ï¼Œä½†ä¼šä¿è¯çº¿ç¨‹å†…çš„æ“ä½œé¡ºåºä¸ä¼šè¢«ç ´åã€‚é€šè¿‡\u003ccode\u003ehappens-before\u003c/code\u003e (çº¿ç¨‹Aå‘ç”Ÿåœ¨çº¿ç¨‹Bä¹‹å‰)çš„å…³ç³»æ¥ä¿è¯è·¨çº¿ç¨‹çš„æœ‰åºæ€§ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŸå­æ€§\u003c/strong\u003eï¼šæ“ä½œä¸å¯åˆ†å‰²ï¼Œçº¿ç¨‹ä¸ä¼šåœ¨æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­è¢«æ‰“æ–­ã€‚ä¾‹å¦‚, \u003ccode\u003esynchronize\u003c/code\u003e å…³é”®å­—èƒ½ç¡®ä¿æ–¹æ³•æˆ–ä»£ç å—çš„åŸå­æ€§\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€JMMä½œç”¨ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå› ä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿéƒ½æœ‰ä¸€å¥—ç‹¬ç«‹çš„å†…å­˜æ¨¡å‹ï¼Œä½†æ˜¯Javaä¸ºäº†æ»¡è¶³è·¨å¹³å°çš„ç‰¹æ€§ï¼Œå®ƒéœ€è¦å®šä¹‰ä¸€å¥—å†…å­˜æ¨¡å‹å±è”½ä¸ªæ“ä½œç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨JMMå½“ä¸­å®šä¹‰å¥½çš„ä»Javaæºç åˆ°CPUæŒ‡ä»¤çš„æ‰§è¡Œè§„èŒƒï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨\u003ccode\u003esynchronized\u003c/code\u003e ã€\u003ccode\u003evolatile\u003c/code\u003e ç­‰å…³é”®å­—ï¼Œè¿˜æœ‰\u003ccode\u003ehappens-before\u003c/code\u003eåŸåˆ™ï¼Œå°±å¯ä»¥å†™å‡ºå¹¶å‘å®‰å…¨çš„ä»£ç äº†ã€‚\næ¯”å¦‚è¯´ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ“ä½œ \u003ccode\u003eå˜é‡-1\u003c/code\u003eï¼Œå‡å¦‚æœ€å¼€å§‹\u003ccode\u003eå˜é‡-1\u003c/code\u003e æ˜¯ \u003ccode\u003e0\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¦–å…ˆï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½è¯»å–äº†\u003ccode\u003eå˜é‡-1\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eç„¶åï¼Œçº¿ç¨‹Bå¯¹å–åˆ°çš„\u003ccode\u003eå˜é‡-1\u003c/code\u003eè‡ªå¢ä¸º\u003ccode\u003e1\u003c/code\u003eï¼Œå¹¶å†™å›ä¸»å†…å­˜\u003c/li\u003e\n\u003cli\u003eæ­¤æ—¶ï¼Œçº¿ç¨‹Aå¯¹è¯»å–åˆ°çš„\u003ccode\u003eå˜é‡-1\u003c/code\u003eä¹Ÿè‡ªå¢\u003ccode\u003e1\u003c/code\u003eï¼Œå¹¶å†™å›ä¸»å†…å­˜ã€‚è¿™å°±ä¼šå¯¼è‡´çº¿ç¨‹Bçš„æ“ä½œå¤±æ•ˆäº†ï¼Œå‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¦‚æœæœ‰JMMï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨çº¿ç¨‹Aè¦ä¿®æ”¹æ•°æ®ä¹‹å‰,è®©å®ƒé‡‡ç”¨CASä¹è§‚é”çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚å†æ¬¡å»è¯»ä¸»å†…å­˜å½“ä¸­çš„å€¼ï¼Œç„¶åä¿®æ”¹ä¹‹åï¼Œå†åˆ¤æ–­ä¸€ä¸‹ä¸»å†…å­˜çš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±å†™å›ä¸»å†…å­˜ã€‚å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œå°±è¦è¿›è¡Œè‡ªæ—‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e å·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯çœ‹ä¸åˆ°çš„ã€‚ä¸»å†…å­˜æ˜¯Javaå †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å®ä¾‹å˜é‡ã€é™æ€å˜é‡å’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜å½“ä¸­ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"JMMæ¶æ„å›¾\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/49ddf552-f9c8-11ef-99c5-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€å†…å­˜é—´äº¤äº’æ“ä½œç±»å‹ (8ç§åŸå­æ“ä½œ)ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003elock ä¸Šé”\u003c/strong\u003eï¼šæŠŠä¸€ä¸ªå˜é‡è¡¨ç¤ºä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eunlock è§£é”\u003c/strong\u003eï¼š æŠŠä¸€ä¸ªå˜é‡ä»ç‹¬å çŠ¶æ€ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹é”å®š\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eread è¯»å–\u003c/strong\u003eï¼š ä»ä¸»å†…å­˜å½“ä¸­è¯»å–ä¸€ä¸ªå˜é‡åˆ°å·¥ä½œå†…å­˜ä¸­\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eload è½½å…¥\u003c/strong\u003eï¼šæŠŠ\u003ccode\u003eread\u003c/code\u003eæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬å½“ä¸­\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003euse ä½¿ç”¨\u003c/strong\u003eï¼šæŠŠå·¥ä½œå†…å­˜å½“ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eassign èµ‹å€¼\u003c/strong\u003eï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜ä¸­çš„å˜é‡\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003estore å­˜å‚¨\u003c/strong\u003eï¼šæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€ç»™ä¸»å†…å­˜ä¸­\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ewrite å†™å…¥\u003c/strong\u003eï¼šæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eã€volatile ç‰¹æ®Šè§„åˆ™ã€‘\u003c/strong\u003e\u003c/p\u003e","title":"(JUC) Javaå¹¶å‘é¢è¯•é¢˜ç¬”è®°"},{"content":"1. è¯´è¯´ä½ çŸ¥é“çš„å‡ ç§ I/O æ¨¡å‹ ã€å¸¸è§çš„äº”å¤§I/Oæ¨¡å‹ã€‘\nå¸¸è§çš„äº”å¤§I/Oæ¨¡å¼åˆ†åˆ«ä¸º: åŒæ­¥é˜»å¡I/O (Blocking I/O) BIOã€éé˜»å¡I/O (Non-blocking I/O) NIOã€I/Oå¤šè·¯å¤ç”¨ã€ä¿¡å·é‡é©±åŠ¨I/Oã€å¼‚æ­¥I/O AIO\næˆ‘ä»¬å‡å¦‚è¦çƒ§æ°´å–ï¼Œçœ‹ä¸åŒæ¨¡å‹æ˜¯æ€ä¹ˆçƒ§çš„æ°´å–\nI/O æ¨¡å‹ ç‰¹æ€§ çƒ§æ°´æ¡ˆä¾‹ åŒæ­¥é˜»å¡I/O BIO æ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ï¼Œå†ä»å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´ï¼Œéƒ½æ˜¯é˜»å¡æ“ä½œã€‚ è‡ªå·±åŠ¨æ‰‹çƒ§æ°´ï¼Œä¸€ç›´ç›¯ç€ï¼Œç­‰æ°´çƒ§å¼€äº†ï¼Œå€’åœ¨æ¯å­é‡Œå–ã€‚ éé˜»å¡I/O NIO æ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ä¸é˜»å¡ï¼Œreadä¸åˆ°æ•°æ®ç›´æ¥è¿”å›ï¼Œä½†æ˜¯ä»å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´ä¼šé˜»å¡ (ç”¨æˆ·è½®è¯¢read) è‡ªå·±åŠ¨æ‰‹çƒ§æ°´ï¼Œéš”ä¸¤åˆ†é’Ÿçœ‹ä¸€ä¸‹ï¼Œæ°´çƒ§å¼€æ²¡æœ‰ã€‚ç­‰æ°´çƒ§å¼€äº†ï¼Œå€’åœ¨æ¯å­é‡Œå–ã€‚ I/Oå¤šè·¯å¤ç”¨ åªæœ‰ä¸€ä¸ªçº¿ç¨‹æŸ¥çœ‹å¤šä¸ªè¿æ¥æ˜¯å¦æœ‰æ•°æ®å‡†å¤‡å°±ç»ª (çœ‹ä»ç½‘å¡èƒ½ä¸èƒ½readåˆ°æ•°æ®åˆ°å†…æ ¸) æ‰¾ä¸“é—¨çƒ§æ°´çš„é¢†å±…å¸®å¿™ï¼Œä»–æŠŠæ°´çƒ§å¥½äº†ä¹‹åï¼Œä¼šå–Šä½ æ¥æ‹¿ã€‚ä½†æ˜¯ä½ è¦è‡ªå·±å€’åœ¨æ¯å­é‡Œå–ã€‚ ä¿¡å·é©±åŠ¨I/O æ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ä¹‹åä¼šè‡ªåŠ¨é€šçŸ¥ç”¨æˆ·ç¨‹åºï¼Œç„¶åè®©ä»–readè¯»å–æ•°æ® å»çƒ§æ°´æˆ¿çƒ§æ°´ï¼Œå…¨è‡ªåŠ¨çš„ï¼Œæœ‰ä¸ªé€šçŸ¥ç¯ã€‚æ°´çƒ§å®Œäº†ä¹‹åä¼šæŒ‰ä½ å®¶çš„é—¨é“ƒï¼Œä½†æ˜¯æœ‰å®¢äººæ¥äº†ï¼Œä¹Ÿä¼šæŒ‰é—¨é“ƒ å¼‚æ­¥I/O AIO å…¨ç¨‹ä¸é˜»å¡ï¼Œæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ä¹‹åç›´æ¥å›è°ƒã€‚ å’Œå¤šè·¯å¤ç”¨ç±»ä¼¼ï¼Œä½†æ˜¯çƒ§å®Œæ°´ä¹‹åä¸ç”¨è‡ªå·±å€’æ°´ï¼Œä»–å¸®ä½ å€’å¥½äº†ï¼Œè¿˜å¹å‡‰äº†ï¼Œä½ è¿‡æ¥å–å°±è¡Œã€‚ ã€ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå„ç§I/Oã€‘\nä¸‹å›¾æ˜¯ä¸¤ä¸ªä¸åŒä¸»æœºä¸Šï¼Œåº”ç”¨ç¨‹åºä¼ é€’æ•°æ®çš„è¿‡ç¨‹ï¼Œå€ŸåŠ©è¯¥è¿‡ç¨‹æ¥ç†è§£ I/O æ˜¯å¦‚ä½•äº§ç”Ÿçš„\nDMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰æ˜¯ä¸€ç§ä¸ç»è¿‡CPUç›´æ¥åœ¨ç½‘ç»œé€‚é…å™¨ï¼ˆç½‘å¡ï¼‰å’Œä¸»æœºå†…å­˜ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“çš„æœºåˆ¶ï¼Œç”¨äºæå‡æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\nã€åŒæ­¥é˜»å¡ I/O BIOã€‘\nåŒæ­¥é˜»å¡I/O BIO çš„å·¥ä½œæœºåˆ¶ï¼šåº”ç”¨ç¨‹åºè¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒºæ‰è¿”å›ã€‚é˜»å¡å¹¶æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å…¶ä»–ç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œä¸æ¶ˆè€—CPUäº‹ä»¶ã€‚åŒæ­¥é˜»å¡ I/O BIO ä¸­ï¼Œåº”ç”¨ç¨‹åºå‘èµ· read è°ƒç”¨æ¥è¯»å–æ•°æ®ä¹‹åï¼Œä¸€ç›´è¢«é˜»å¡ï¼Œç›´åˆ°å†…æ ¸æŠŠæ•°æ®copyåˆ°ç”¨æˆ·ç©ºé—´ã€‚è¯¥æ–¹æ¡ˆé€‚åˆå®¢æˆ·ç«¯è¿æ¥æ•°é‡ä¸é«˜çš„æƒ…å†µã€‚ä¸‹å›¾çš„read å’Œ recvfrom å‡½æ•°æ˜¯ä¸€ä¸ªæ„æ€ã€‚\nã€éé˜»å¡å¼ I/O NIOã€‘\néé˜»å¡å¼ I/O NIO çš„å·¥ä½œæœºåˆ¶ï¼šåº”ç”¨ç¨‹åºæ‰§è¡Œread ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„è½®è¯¢ read æ¥è·å– I/Oæ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¹‹ä¸º è½®è¯¢ polling ã€‚ç­‰åˆ°æ•°æ®å‡†å¤‡å°±ç»ªï¼Œä»å†…æ ¸ç©ºé—´copyåˆ°ç”¨æˆ·ç©ºé—´çš„æ—¶å€™ï¼Œè¿›ç¨‹æ‰è¢«é˜»å¡ï¼Œç›´åˆ°å†…æ ¸copyå®Œæˆã€‚è¯¥æ–¹æ¡ˆæ¯”è¾ƒä½æ•ˆï¼Œä¼šä¸åœçš„æ¶ˆè€—CPUèµ„æºã€‚\nã€I/O å¤šè·¯å¤ç”¨ã€‘\nI/O å¤šè·¯å¤ç”¨æ˜¯ä¸€ç§æ”¯æŒé¢å‘ç¼“å­˜çš„ï¼ŒåŸºäºé€šé“I/Oçš„æ“ä½œæ–¹æ³•ï¼Œå®ƒæ˜¯åŸºäºåŒæ­¥éé˜»å¡I/Oè®¾è®¡çš„ã€‚é€‚åˆé«˜è´Ÿè½½ã€é«˜å¹¶å‘åº”ç”¨ã€‚I/O å¤ç”¨æ˜¯é€šè¿‡ select æˆ–è€… poll æœºåˆ¶ï¼Œè®©å•ä¸ªè¿›ç¨‹èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå¥—æ¥å­—çš„è¯»å†™äº‹ä»¶ã€‚å½“ä»»ä¸€å¥—æ¥å­—å¯è¯»çš„æ—¶å€™ï¼Œè¢«é˜»å¡çš„è¿›ç¨‹ä¼šè¢«å”¤é†’å¹¶ç»§ç»­æ‰§è¡Œã€‚å’Œå¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹æ–¹æ¡ˆç›¸æ¯”ï¼Œ I/O å¤ç”¨é¿å…äº†åˆ›å»ºå’Œåˆ‡æ¢ è¿›ç¨‹/çº¿ç¨‹å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚åœ¨æ²¡æœ‰I/Oå¤ç”¨çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å»ºç«‹ä¸€ä¸ªæ–°çš„ Socket è¿æ¥ éƒ½éœ€è¦å•ç‹¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚\nã€æ³¨æ„ã€‘I/O å¤šè·¯å¤ç”¨ç›¸è¾ƒäºåŒæ­¥éé˜»å¡I/O NIO å°‘äº†è½®è¯¢è°ƒç”¨ read çš„æ“ä½œ (è½®è¯¢polling)ï¼Œ å‡å°‘äº†CPUèµ„æºçš„æ¶ˆè€—ã€‚å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªsocket ä¸­çš„äº‹ä»¶ï¼Œé˜²æ­¢åˆ›å»ºè¿‡å¤šçº¿ç¨‹å¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚\nI/O å¤ç”¨çš„å…·ä½“å·¥ä½œæµç¨‹ï¼š\nçº¿ç¨‹é¦–å…ˆå‘èµ· select è°ƒç”¨ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ª ç­‰å¾…å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ·read è°ƒç”¨ æ•°æ®ä»å†…æ ¸ç©ºé—´copyåˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¯¥è¿‡ç¨‹åº”ç”¨ç¨‹åºè¿˜æ˜¯é˜»å¡çš„ ã€ä¿¡å·é©±åŠ¨ I/Oã€‘\nä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ã€‚åº”ç”¨ç¨‹åºç»§ç»­æ‰§è¡Œï¼Œå†…æ ¸ç­‰å¾…æ•°æ®å‡†å¤‡å°±ç»ªä¹‹åï¼Œå‘é€ SIGIO ä¿¡å·ã€‚åº”ç”¨ç¨‹åºå—åˆ°ä¿¡å·ä¹‹åï¼Œå¼€å§‹ read ç³»ç»Ÿè°ƒç”¨ï¼Œæ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¯¥è¿‡ç¨‹åº”ç”¨ç¨‹åºé˜»å¡ã€‚ å’Œ I/O å¤šè·¯å¤ç”¨æ¯”è¾ƒç›¸ä¼¼ã€‚\nã€å¼‚æ­¥ I/O AIOã€‘\nå¼‚æ­¥ I/O AIO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œåº”ç”¨ç¨‹åº read ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œç›´æ¥è¿”å›ï¼Œå®Œå…¨ä¸é˜»å¡ã€‚å½“åå°å¤„ç†å®Œä¹‹åï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚\nã€äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒã€‘\n2. Selectã€Pollã€Epoll ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç‰¹æ€§ select poll epoll è§¦å‘æœºåˆ¶ æ°´å¹³è§¦å‘ æ°´å¹³è§¦å‘ è¾¹ç¼˜è§¦å‘ æ–‡ä»¶æè¿°ç¬¦å­˜å‚¨æ–¹å¼ ä½å›¾ åŠ¨æ€æ•°ç»„ çº¢é»‘ä¹¦ + å°±ç»ªé“¾è¡¨ æ€§èƒ½ éšç€æ–‡ä»¶æè¿°ç¬¦é‡å¢åŠ ï¼Œæ€§èƒ½ä¸‹é™ ( O(N) ) éšç€æ–‡ä»¶æè¿°ç¬¦é‡å¢åŠ ï¼Œæ€§èƒ½ä¸‹é™( O(N) ) ç›‘å¬åˆ—è¡¨ä¸º O(1) ï¼Œè°ƒç”¨äº‹ä»¶å›è°ƒ o(k) ã€æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘çš„åŒºåˆ«ã€‘\nè¾¹ç¼˜è§¦å‘ï¼šäº‹ä»¶å‘ç”Ÿçš„æ—¶å€™åªé€šçŸ¥ä¸€æ¬¡ï¼Œéœ€è¦ç”¨æˆ·ç«‹å³å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰å¤„ç†ï¼Œåç»­ä¸ä¼šå†é€šçŸ¥ æ°´å¹³è§¦å‘ï¼šäº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ä¼šåå¤é€šçŸ¥ï¼Œç›´åˆ°å¤„ç†å®Œæˆ 3. çº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ è¿›ç¨‹ (Process)ï¼šè¿›ç¨‹æ˜¯è¿è¡Œä¸­çš„ç¨‹åºå®ä¾‹ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚æ¯”å¦‚æ‰“å¼€çš„å¾®ä¿¡/æŠ–éŸ³/å¾®åšï¼Œéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ã€‚\nçº¿ç¨‹ (Thread)ï¼šçº¿ç¨‹ä¹Ÿå«è½»é‡çº§çš„è¿›ç¨‹ï¼Œæ¯”è¿›ç¨‹è½»é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹é‡Œé¢æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå¹¶ä¸”å…±äº«è¿›ç¨‹çš„èµ„æºã€‚åœ¨ Linux å½“ä¸­ï¼Œçº¿ç¨‹å¯ä»¥å…±äº«å†…å­˜ç©ºé—´ã€æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ã€‚\nåç¨‹ï¼šç”¨æˆ·æ€è½»é‡çº§çº¿ç¨‹ï¼Œç”±ç¨‹åºæ§åˆ¶åˆ‡æ¢ï¼Œæ— éœ€å†…æ ¸å‚ä¸ã€‚åç¨‹åˆ‡æ¢åªéœ€è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œå¼€é”€æ¯”çº¿ç¨‹å°å¾—å¤šï¼Œé€‚åˆå¤„ç†é«˜å¹¶å‘ä»»åŠ¡ï¼ˆæ¯”å¦‚å¼‚æ­¥I/Oï¼‰\nã€æ³¨æ„ã€‘ å¤šçº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå› ä¸ºçº¿ç¨‹è¶Šå¤šå°±ä¼šå¢åŠ åˆ‡æ¢æˆæœ¬ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ã€‚è€Œä¸”éœ€è¦åŒæ­¥æœºåˆ¶é¿å…æ•°æ®ç«äº‰å’Œæ­»é”é—®é¢˜ã€‚\nã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ã€‘\nç‰¹æ€§ è¿›ç¨‹ çº¿ç¨‹ æœ¬è´¨ æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•å…ƒ æ„æˆä»»åŠ¡è°ƒåº¦ä¸æ‰§è¡Œçš„æ ¸å¿ƒå•å…ƒ å¼€é”€ ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®æ®µï¼Œè¿›ç¨‹åˆ‡æ¢æˆæœ¬é«˜ çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œç»´æŠ¤ç‹¬ç«‹çš„å †æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œçº¿ç¨‹åˆ‡æ¢æˆæœ¬ä½ å†…å­˜åˆ†é… æ¯ä¸ªè¿›ç¨‹åˆ†é…ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ é™¤äº†CPUä¹‹å¤–ï¼Œç³»ç»Ÿä¸ä¼šç»™çº¿ç¨‹åˆ†é…å†…å­˜ï¼Œçº¿ç¨‹ç»„å…±äº«èµ„æº ç¨³å®šæ€§ è¿›ç¨‹éš”ç¦»æ€§å¼ºï¼Œå´©æºƒæ—¶ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æºï¼Œå´©æºƒå¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢ å®‰å…¨æ€§ æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå®‰å…¨æ€§é«˜ å¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ï¼Œå­˜åœ¨æ•°æ®ç«äº‰å’Œçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œéœ€è¦ç”¨åŒæ­¥å’Œäº’æ–¥æœºåˆ¶æ¥è§£å†³ ã€JVM è§†è§’ä¸‹çš„è¿›ç¨‹å’Œçº¿ç¨‹ã€‘\nä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«å †å’Œæ–¹æ³•åŒº (å…ƒç©ºé—´)ï¼Œä½†æ˜¯å„è‡ªæœ‰ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œç¡®ä¿çº¿ç¨‹é—´æ‰§è¡Œçš„ä¸Šä¸‹æ–‡å½¼æ­¤éš”ç¦»ã€‚\nçº¿ç¨‹å…±äº«æ•°æ®åŒºï¼šå †ã€æ–¹æ³•åŒº ( JDK8 ä¹‹åå«å…ƒç©ºé—´)ã€æ‰§è¡Œå¼•æ“ çº¿ç¨‹éš”ç¦»åŒºåŸŸï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è„šæœ¬ ã€è¿›ç¨‹åˆ‡æ¢å’Œçº¿ç¨‹åˆ‡æ¢çš„åŒºåˆ«ã€‘\næ—¶é—´æ•ˆç‡ï¼šçº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…±äº«åœ°å€ç©ºé—´ï¼Œè€Œè¿›ç¨‹éœ€è¦åˆ‡æ¢é¡µé¢å’Œä¸Šä¸‹æ–‡ï¼ˆæ¶‰åŠæ›´å¤šèµ„æºï¼‰ ç©ºé—´æ•ˆç‡ï¼šçº¿ç¨‹å…±äº«å†…å­˜å’Œæ–‡ä»¶èµ„æºï¼Œæ•°æ®äº¤æ¢ä¸éœ€è¦å†…æ ¸å‚ä¸ï¼Œæ•ˆç‡æ›´é«˜ï¼›è¿›ç¨‹åˆ‡æ¢æ¶‰åŠæ›´å¤æ‚çš„ä¸Šä¸‹æ–‡ä¿å­˜å’Œæ¢å¤ã€‚ ã€è¿›ç¨‹å’Œçº¿ç¨‹åˆ‡æ¢çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆï¼Ÿã€‘\nè¿›ç¨‹æ§åˆ¶å— (process control block) PCB æ•°æ®ç»“æ„æ˜¯ç”¨æ¥æè¿°è¿›ç¨‹çš„\nPCBæ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå…¶ä¸­åŒ…å«\nPCBå†…å®¹ï¼šè¿›ç¨‹å”¯ä¸€æ ‡è¯†ç¬¦ã€çŠ¶æ€ä¿¡æ¯ï¼ˆåˆ›å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç»“æŸï¼‰ã€ä¼˜å…ˆçº§ã€èµ„æºåˆ†é…æ¸…å•ï¼ˆå†…å­˜å’Œæ–‡ä»¶å¥æŸ„ï¼‰ã€CPUå¯„å­˜å™¨å€¼ç­‰ è¿›ç¨‹çŠ¶æ€å˜è¿ï¼šåˆ›å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç»“æŸï¼Œäº”ç§çŠ¶æ€å½“ä¸­è¿›è¡Œåˆ‡æ¢ ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‘\nè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼šåŒ…å«è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚\nè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šå°†ä¸Šä¸€ä¸ªè¿›ç¨‹ è¿›ç¨‹A çš„ä¸Šä¸‹æ–‡ä¿å­˜åˆ°å½“å‰è¿›ç¨‹ è¿›ç¨‹B çš„PCBä¸­ï¼Œå½“éœ€è¦è¿è¡Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹ è¿›ç¨‹A çš„æ—¶å€™ï¼Œéœ€è¦ä» è¿›ç¨‹B çš„PCBå–å‡ºä¸Šä¸‹æ–‡ï¼Œæ¢å¤åˆ°CPUä¸­ï¼Œä½¿å¾— è¿›ç¨‹A å¯ä»¥ä»ä¸­æ–­ç‚¹ç»§ç»­æ‰§è¡Œã€‚\nè¿›ç¨‹åˆ‡æ¢å‘ç”Ÿçš„åœºæ™¯\næ—¶é—´ç‰‡ç”¨å®Œï¼šæŸä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œè¿›ç¨‹å˜ä¸ºå°±ç»ªæ€ èµ„æºä¸è¶³ï¼šæŸä¸ªè¿›ç¨‹æ‰€éœ€è¦çš„èµ„æºä¸è¶³ï¼Œä¼šè¢«æŒ‚èµ·ï¼Œå˜æˆå°±ç»ªæŒ‚èµ·çŠ¶æ€ ä¸»åŠ¨æŒ‚èµ·ï¼šè¿›ç¨‹è¢«ä¸»åŠ¨æŒ‚èµ· ä¼˜å…ˆçº§ä¸è¶³ï¼šé‡åˆ°æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œéœ€è¦è¢«è°ƒåº¦æˆé˜»å¡çŠ¶æ€ ç¡¬ä»¶ä¸­æ–­ï¼šçªç„¶æ–­ç”µäº† ã€çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‘\nä¸åŒè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢ï¼šç›¸å½“äºä¸åŒè¿›ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ ï¼ˆæ¯”å¦‚ä¸¤ä¸ªå•çº¿ç¨‹çš„è¿›ç¨‹ï¼‰ åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢ï¼šå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œè™šæ‹Ÿå†…å­˜ï¼ˆå †ã€æ–¹æ³•åŒºã€æ‰§è¡Œå¼•æ“ï¼‰ä¸åŠ¨ï¼Œåªåˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ® ï¼ˆæœ¬åœ°æ–¹æ³•æ ˆã€è™šæ‹Ÿæœºæ ˆï¼‰ã€å¯„å­˜å™¨ç­‰å…±äº«çš„æ•°æ® ã€æ–‡ä»¶å¥æŸ„ã€å†…å­˜ç©ºé—´ã€ç½‘ç»œè¿æ¥ã€‘\næ–‡ä»¶å¥æŸ„ï¼šæ–‡ä»¶å¥æŸ„æ˜¯æ“ä½œç³»ç»Ÿç»™è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸ªæ–‡ä»¶åˆ†é…çš„å”¯ä¸€æ•´æ•°æ ‡è¯†ç¬¦ï¼Œç”¨æ¥è·Ÿè¸ªæ–‡ä»¶çš„ä½ç½®ã€æƒé™ç­‰çŠ¶æ€ä¿¡æ¯ã€‚æ¯”å¦‚åŒºé¤å…ç‚¹é¤ï¼ŒæœåŠ¡å‘˜ç»™ä¸€ä¸ªç‰Œå­ï¼ˆæ¡Œå·ï¼‰ã€‚è¿™ä¸ªç‰Œå­å°±æ˜¯å¥æŸ„ï¼Œä»£è¡¨ä½ çš„æ¡Œå­ã€‚æœåŠ¡å‘˜ä¸çŸ¥é“ä½ æ˜¯è°ï¼Œåªèƒ½é€šè¿‡æ¡Œå·ï¼Œæ‰¾åˆ°ä½ çš„æ¡Œå­ï¼Œç»™ä½ ä¸Šèœã€‚\nå†…å­˜ç©ºé—´ï¼šå†…å­˜ç©ºé—´åŒ…å«ä»£ç æ®µã€æ•°æ®æ®µã€å †åŒºã€æ ˆåŒºã€æ–‡ä»¶æ˜ å°„æ®µ\nä»£ç æ®µï¼šå­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œä»£ç ï¼Œé€šå¸¸æ˜¯åªè¯»çš„ æ•°æ®æ®µï¼šå­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œåˆ†ä¸ºå·²åˆå§‹åŒ–æ•°æ®åŒºå’Œæœªåˆå§‹åŒ–æ•°æ®åŒº (BSSæ®µ) å †åŒºï¼šç”¨äºåŠ¨æ€åˆ†é…å†…å­˜ æ ˆåŒºï¼šå­˜æ”¾å‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ç­‰ï¼Œå¤§å°å›ºå®š æ–‡ä»¶æ˜ å°„æ®µï¼šåŒ…æ‹¬åŠ¨æ€åº“ã€å…±äº«å†…å­˜ç­‰ (mmap åˆ†é…å†…å­˜) ç½‘ç»œè¿æ¥ï¼šLinuxé‡Œé¢ï¼Œç½‘ç»œè¿æ¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶å¥æŸ„è¿›è¡Œæ“ä½œã€‚ä¸€èˆ¬æ˜¯ç”¨æ¥ä¸¤å°è®¡ç®—æœºä¹‹é—´é€šè¿‡ç½‘ç»œåè®® (TCP/IP) å»ºç«‹çš„é€šä¿¡ä¿¡é“ã€‚\n4. è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ã€ä¸ºä»€ä¹ˆè¿›ç¨‹éœ€è¦è¿›è¡Œé€šä¿¡ï¼Ÿã€‘\nä¸åŒçš„è¿›ç¨‹æœ‰ä¸åŒçš„ç”¨æˆ·åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹Açš„å…¨å±€å˜é‡ï¼Œè¿›ç¨‹Bæ˜¯çœ‹ä¸åˆ°çš„ã€‚è¿›ç¨‹ä¹‹é—´æƒ³è¦äº¤æ¢æ•°æ®éœ€è¦é€šè¿‡å†…æ ¸ï¼Œåœ¨å†…æ ¸å¼€è¾Ÿç¼“å†²åŒºã€‚è¿›ç¨‹Aä»ç”¨æˆ·ç©ºé—´copyæ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œè¿›ç¨‹Bå†ä»å†…æ ¸ç¼“å†²åŒºè¯»èµ°æ•°æ®ï¼Œå®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚\nã€è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‘\nç®¡é“/åŒ¿åç®¡é“ï¼šç®¡é“æ˜¯ä¸€ç§å•å‘é€šä¿¡çš„æ–¹å¼ï¼Œç”¨äºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´ï¼Œæˆ–è€…åŒä¸€ä¸»æœºä¸Šçš„ä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚å¯ä»¥æ˜¯åŒ¿åçš„ï¼Œä¹Ÿå¯æ˜¯å‘½åçš„ã€‚\nps -ef | grep [name] # LinuxæŒ‡ä»¤çš„|å°±æ˜¯åŒ¿åç®¡é“ å‘½åç®¡é“ï¼šå’ŒåŒ¿åç®¡é“ç±»ä¼¼ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºåŸåˆ™ï¼Œä»¥ç£ç›˜æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œå¯ä»¥å®ç°æœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹çš„é€šä¿¡ã€‚\nmkfifo pipeDemo # åˆ›å»ºå‘½åç®¡é“ echo \u0026#34;Hello! World!\u0026#34; \u0026gt; pipeDemo # å‘ç®¡é“å†…å†™å…¥æ•°æ® cat \u0026lt; pipeDemo # è¯»å–pipeDemoç®¡é“çš„æ•°æ®,æ˜¾ç¤º Hello! World! ä¿¡å·ï¼šå¼‚æ­¥çš„é€šä¿¡æ–¹å¼ï¼Œé€šçŸ¥æ¥å—è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿï¼Œä¸€èˆ¬ç”¨äºè¿›ç¨‹ä¹‹é—´å‘é€ä¸­æ–­æˆ–è€…ç»ˆæ­¢å‘½ä»¤ã€‚\nä¿¡å·é‡ï¼šä¿¡å·é‡æ˜¯ä¸€ç§åŒæ­¥åŸè¯­ï¼Œç”¨äºç®¡ç†å¯¹å…±äº«åŒºåŸŸçš„è®¿é—®ï¼Œå¯ä»¥ç”¨æ¥å®ç°è¿›ç¨‹é—´çš„äº’æ–¥è®¿é—®å’ŒåŒæ­¥æ“ä½œã€‚\næ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯é“¾è¡¨å½¢å¼çš„ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚å…è®¸è¿›ç¨‹Aå‘è¿›ç¨‹Bå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­æŒ‰ç…§é¡ºåºå­˜å‚¨ã€‚ä½†æ˜¯è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹Bä¸ä¸€å®šéè¦æŒ‰ç…§ç°é‡‘å…ˆå‡ºçš„é¡ºåºè¯»å–ï¼Œå¯ä»¥éšæœºæŸ¥è¯¢ã€‚\nå…±äº«å†…å­˜ï¼šå…±äº«å†…å­˜å…è®¸å¤šä¸ªè¿›ç¨‹è®¿é—®åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œå¯ä»¥çœ‹è§å…¶ä»–è¿›ç¨‹å¯¹å…±äº«è¿›ç¨‹çš„æ›´æ–°ï¼Œä»è€Œå®ç°å¿«é€Ÿçš„æ•°æ®äº¤æ¢ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„æ•°æ®åŒæ­¥çš„é—®é¢˜ï¼Œé¿å…å‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚\nå¥—æ¥å­— (socket)ï¼šå¥—æ¥å­—å…¶å®å°±æ˜¯åè®®+IP+ç«¯å£ï¼Œå…è®¸åœ¨ç½‘ç»œä¸Šçš„ä¸åŒä¸»æœºä¸Šé¢çš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚è¯´å¾®ä¿¡/é£ä¹¦å‘æ¶ˆæ¯ã€‚\næ–‡ä»¶ï¼šè¿›ç¨‹å¯ä»¥é€šè¿‡è¯»å†™æ–‡ä»¶æ¥è¿›è¡Œé€šä¿¡ï¼Œè¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè¿›ç¨‹ä¹‹é—´çš„é—´æ¥é€šä¿¡ï¼Œæ¯”å¦‚ä¸´æ—¶æ–‡ä»¶æˆ–è€…å…±äº«æ–‡ä»¶ã€‚\nã€æ¶ˆæ¯é˜Ÿåˆ—è¯¦è§£ã€‘\næ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿå‘½å‘¨æœŸéšå†…æ ¸å­˜åœ¨è€Œå­˜åœ¨ã€‚å¦‚æœä¸ä¸»åŠ¨é‡Šæ”¾æˆ–è€…ä¸å…³é—­ç³»ç»Ÿï¼Œåˆ™ä¼šä¸€ç›´å­˜åœ¨ã€‚åŒ¿åç®¡é“çš„ç”Ÿå‘½å‘¨æœŸæ˜¯éšè¿›ç¨‹å­˜åœ¨è€Œå­˜åœ¨çš„ï¼Œè¿›ç¨‹ç»“æŸå°±é”€æ¯äº†ã€‚å’Œç®¡é“ä¸åŒï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸éœ€è¦å…¶ä»–è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¸Šé¢ç­‰å¾…æ¶ˆæ¯åˆ°è¾¾ï¼Œå¯ä»¥éšæ—¶å¾€æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢å†™å…¥æ¶ˆæ¯ã€‚\næ¶ˆæ¯é˜Ÿåˆ—çš„ç¼ºç‚¹ï¼š\né€šä¿¡ä¸åŠæ—¶ï¼šå› ä¸ºä¸éœ€è¦å…¶ä»–è¿›ç¨‹åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç­‰ç€ï¼Œè¿›ç¨‹åªæœ‰è½®è¯¢æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰æ—¶é—´é—´éš”ï¼Œè‚¯å®šä¼šæœ‰æ²¡æ¥å¾—åŠçœ‹æ¶ˆæ¯çš„æ—¶å€™ æ•°æ®å¤§å°å­˜åœ¨é™åˆ¶ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¸é€‚åˆä¼ è¾“æ¯”è¾ƒå¤§çš„æ•°æ®ï¼Œè€Œä¸”éœ€è¦æŠŠæ•°æ®ä»ç”¨æˆ·æ€copyåˆ°å†…æ ¸æ€é‡Œé¢ ã€å…±äº«å†…å­˜ã€‘\nè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½æ‹¿å‡ºä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°ç›¸åŒç‰©ç†å†…å­˜ï¼Œä¸€ä¸ªè¿›ç¨‹å†™å…¥ï¼Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹å°±å¯ä»¥é©¬ä¸Šçœ‹åˆ°ï¼Œä¸ç”¨ä»ç”¨æˆ·æ€copyæ•°æ®åˆ°å†…æ ¸æ€ï¼Œæé«˜è¿›ç¨‹é—´çš„é€šä¿¡é€Ÿåº¦ã€‚ä½†æ˜¯éœ€è¦æŸç§åŒæ­¥æœºåˆ¶(æ¯”å¦‚ä¿¡å·é‡)æ¥è¾¾åˆ°è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥å’Œäº’æ–¥ ï¼ˆæ¯”å¦‚è¿›ç¨‹Aéœ€è¦é€šè¿‡ä¿¡å·é‡é€šçŸ¥è¿›ç¨‹Bï¼Œå®ƒæ­£åœ¨å†™å…¥ï¼‰ã€‚å¦å¤–ï¼Œä¸¤ä¸ªè¿›ç¨‹å†™åŒä¸€ä¸ªåœ°å€ï¼Œå…ˆå†™çš„è¿›ç¨‹ä¼šå‘ç°å†…å®¹è¢«è¦†ç›–äº†ã€‚\nã€ä¿¡å·é‡æœºåˆ¶ã€‘\nä¿¡å·é‡æ˜¯ç”¨æ¥é˜²æ­¢è¿›ç¨‹ä¹‹é—´å› ä¸ºç«äº‰å…±äº«èµ„æºçš„ï¼Œè€Œé€ æˆçš„æ•°æ®é”™ä¹±ã€‚å¼•å…¥ä¿æŠ¤æœºåˆ¶ï¼Œä½¿å¾—å…±äº«çš„èµ„æºåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹è®¿é—®ã€‚ä¿¡å·é‡æ˜¯æ•´å‹è®¡æ•°å™¨ï¼Œç”¨äºå®ç°è¿›ç¨‹é—´çš„äº’æ–¥å’ŒåŒæ­¥ï¼Œä¸æ˜¯ç”¨æ¥ç¼“å­˜è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ•°æ®çš„ã€‚ä¿¡å·é‡æœ‰ä¸¤ç§æ“ä½œï¼ŒP æ“ä½œå’Œ V æ“ä½œï¼š\nP æ“ä½œï¼šå°†ä¿¡å·é‡å‡å»1ï¼Œå¦‚æœç›¸å‡ä¹‹åä¿¡å·é‡ \u0026lt; 0ï¼Œåˆ™è¡¨æ˜èµ„æºè¢«å ç”¨ã€‚å¦‚æœä¿¡å·é‡ \u0026gt;= 0ï¼Œ è¡¨æ˜èµ„æºè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ V æ“ä½œï¼šå°†ä¿¡å·é‡åŠ ä¸Š1ï¼Œå¦‚æœç›¸åŠ ä¹‹åä¿¡å·é‡ \u0026lt;= 0, è¯´æ˜æœ‰é˜»å¡è¿›ç¨‹ï¼Œå”¤é†’è¯¥è¿›ç¨‹è¿è¡Œã€‚å¦‚æœç›¸åŠ ä¹‹åï¼Œä¿¡å·é‡ \u0026gt; 0ï¼Œåˆ™è¡¨æ˜æ²¡æœ‰é˜»å¡è¿›ç¨‹ï¼Œç›´æ¥è¿è¡Œã€‚ å¦‚æœä¿¡å·é‡åˆå§‹åŒ–ä¸º 1ï¼Œä»£è¡¨æ˜¯äº’æ–¥ä¿¡å·é‡ã€‚å¦‚æœåˆå§‹åŒ–ä¸º 0ï¼Œä»£è¡¨æ˜¯åŒæ­¥ä¿¡å·é‡ã€‚\nã€åŸºäºTCPåè®®é€šä¿¡çš„å¥—æ¥å­—socketç¼–ç¨‹æ¨¡å‹ã€‘\nTCPå¥—æ¥å­—é€šä¿¡ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆå§‹åŒ–å¥—æ¥å­— socket çš„ æ–‡ä»¶æè¿°ç¬¦ æœåŠ¡ç«¯ bind ç»‘å®š IP å’Œ ç«¯å£ï¼Œ listen ç›‘å¬ ï¼Œaccept ç­‰å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ å®¢æˆ·ç«¯ connect å‘æœåŠ¡ç«¯åœ°å€å’Œç«¯å£å‘èµ·è¿æ¥è¯·æ±‚ æœåŠ¡ç«¯ accpet è¿”å›ä¼ è¾“ socket æ–‡ä»¶æè¿°ç¬¦ å®¢æˆ·ç«¯ write å†™å…¥æ•°æ®ï¼ŒæœåŠ¡ç«¯ read è¯»å– å®¢æˆ·ç«¯ close çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ read ä¼šè¯»å–åˆ° EOF (End of File)ï¼Œ å¤„ç†å®Œæ•°æ®ä¹‹åï¼ŒæœåŠ¡ç«¯ close å…³é—­é“¾æ¥ UDPå¥—æ¥å­—é€šä¿¡ï¼šæ¯æ¬¡é€šä¿¡çš„æ—¶å€™è°ƒç”¨sendto å’Œ recvfrom()ï¼Œ éƒ½éœ€è¦ä¼ å…¥ç›®æ ‡ä¸»æœºçš„IPåœ°å€å’Œç«¯å£ 5. è¿›ç¨‹é—´çš„è°ƒåº¦ç®—æ³•çŸ¥é“å—ï¼Ÿ å…ˆæ¥å…ˆæœåŠ¡ (FCFS, First Come First Service)ï¼šæŒ‰ç…§è¿›ç¨‹åˆ°è¾¾çš„å…ˆåé¡ºåºè¿›è¡Œè°ƒåº¦ï¼Œå…ˆåˆ°è¾¾çš„è¿›ç¨‹å…ˆæ‰§è¡Œï¼Œåè¾¾åˆ°çš„è¿›ç¨‹åæ‰§è¡Œã€‚å°±åƒåŒºé“¶è¡Œå–é’±ï¼ŒæŒ¨ä¸ªæ’é˜Ÿä¸€æ ·ã€‚\næœ€çŸ­ä½œä¸šä¼˜å…ˆ (SJF, Short Job First)ï¼šæŒ‰ç…§è¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´è¿›è¡Œæ’åºï¼Œæ‰§è¡Œæ—¶é—´çŸ­çš„è¿›ç¨‹ä¼˜å…ˆæ‰§è¡Œï¼Œä»¥å‡å°‘å¹³å‡ç­‰å¾…æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿ç°è±¡ï¼Œæ‰§è¡Œæ—¶é—´é•¿çš„ç¨‹åºï¼Œå¯èƒ½è¦ç­‰å¾ˆä¹…æ‰èƒ½è¢«æ‰§è¡Œã€‚å¯ä»¥ç±»æ¯”æˆé“¶è¡Œè®©å®¢æˆ·æŒ‰ç…§åŠç†ä¸šåŠ¡çš„æ—¶é—´è¿›è¡Œæ’é˜Ÿï¼Œä¾æ¬¡å¤„ç†ã€‚\nä¼˜å…ˆçº§è°ƒåº¦ï¼šç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œæ ¹æ®ä¼˜å…ˆçº§é«˜ä½è¿›è¡Œè°ƒåº¦ï¼Œä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹å…ˆæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¼˜å…ˆçº§è¾ƒä½çš„ç¨‹åºéœ€è¦ç­‰å¾ˆä¹…æ‰èƒ½æ‰§è¡Œï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿ç°è±¡ã€‚\næ—¶é—´ç‰‡è½®è½¬ (PR)ï¼šå°†CPUæ—¶é—´åˆ†æˆå¤šä¸ªæ—¶é—´ç‰‡ï¼Œæ¯ä¸ªè¿›ç¨‹è½®æµå ç”¨ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨è¯¥æ—¶é—´ç‰‡ç»“æŸçš„æ—¶å€™è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™å°†å…¶ç§»åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚\nå¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ (MFQS, Multilevel Feedback Queue Scheduling)ï¼šå¤šçº§çš„æ„æ€æ˜¯æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ï¼ˆä¸ºäº†é¿å…ä¼˜å…ˆçº§ä½çš„è¿›ç¨‹è¢«é¥¿æ­»äº†ï¼‰ã€‚åé¦ˆçš„æ„æ€æ˜¯å¦‚æœæœ‰æ–°çš„è¿›ç¨‹è¿›å…¥ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—çš„æ—¶å€™ï¼Œç«‹å³åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼Œè½¬åˆ°ä¼˜å…ˆçº§æœ€é«˜çš„é˜Ÿé‡Œå»ä»å¤´è¿è¡Œã€‚ï¼ˆè®©ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ï¼Œå¾—åˆ°å¿«é€Ÿå¤„ç†çš„ä¿éšœï¼‰å…·ä½“å·¥ç¨‹æµç¨‹å¦‚ä¸‹ï¼š\nè®¾ç½®å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜çš„é˜Ÿåˆ—ï¼Œæ—¶é—´ç‰‡è®¾ç½®çš„è¶ŠçŸ­ å¦‚æœæœ‰æ–°çš„è¿›ç¨‹ï¼Œä¼šæŠŠå®ƒæ”¾åˆ°ç¬¬ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰ç…§å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’é˜Ÿç­‰å¾…è¢«è°ƒåº¦ã€‚å¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—è§„å®šæ—¶é—´ç‰‡æ²¡æœ‰è¿è¡Œå®Œæˆï¼Œåˆ™å°†å…¶è½¬å…¥ç¬¬äºŒçº§é˜Ÿåˆ—æœ«å°¾ï¼Œç›´åˆ°å®Œæˆä¸ºæ­¢ã€‚ å½“è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰è°ƒåº¦è¾ƒä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœè¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œæœ‰æ–°è¿›ç¨‹è¿›å…¥è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œåˆ™åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶ä¸”å°†å…¶ç§»åŠ¨åˆ°åŸæ¥é˜Ÿåˆ—çš„é˜Ÿå°¾ã€‚ç„¶åä»è¾ƒé«˜ä¼˜å…ˆçº§é˜Ÿåˆ—å¼€å§‹ï¼Œé‡å¤åˆšæ‰çš„è¿‡ç¨‹ã€‚ 6. ç½‘ç»œI/Oé˜»å¡çš„åŸå› ï¼Ÿ ç½‘ç»œI/Oä¼šè¢«é˜»å¡æ˜¯å› ä¸ºè¿›è¡Œç½‘ç»œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿåœ¨ç­‰å¾…æ•°æ®çš„å‘é€æˆ–æ¥æ”¶å®Œæˆä¹‹å‰ï¼Œè¿›ç¨‹å°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°æ•°æ®ä¼ è¾“å®Œæˆä¹‹åæ‰æ¢å¤è¿›ç¨‹æ‰§è¡Œã€‚\nç½‘ç»œI/Oé˜»å¡çš„ä¸»è¦åŸå› ï¼š\nç­‰å¾…æ•°æ®åˆ°è¾¾æˆ–å‘é€å®Œæˆï¼šå½“è¿›ç¨‹å°è¯•ä»ç½‘ç»œå¥—æ¥å­— socket è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®è¿˜æ²¡åˆ°è¾¾ï¼ˆæ•°æ®æœªå°±ç»ªï¼‰ï¼Œæ“ä½œç³»ç»Ÿä¼šè®©è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ•°æ®åˆ°è¾¾ä¸ºæ­¢ã€‚åŒæ ·ï¼Œæ•°æ®æœªèƒ½ç«‹å³å‘å‡ºå»çš„æ—¶å€™ï¼Œå‘é€æ“ä½œä¹Ÿå¯èƒ½è¢«é˜»å¡ï¼Œç­‰å¾…ç¼“å†²åŒºæœ‰ç©ºé—²ç©ºé—´ã€‚ ç³»ç»Ÿèµ„æºæœ‰é™ï¼šå½“ç³»ç»Ÿèµ„æºï¼ˆç½‘ç»œç¼“å†²åŒºã€è¿æ¥æ•°ï¼‰è¢«å æ»¡çš„æ—¶å€™ï¼Œè¿›ä¸€æ­¥çš„I/Oè¯·æ±‚å¯èƒ½ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…èµ„æºé‡Šæ”¾åæ‰èƒ½ç»§ç»­ã€‚ é»˜è®¤çš„é˜»å¡è¡Œä¸ºï¼šå¤§å¤šæ•°ç½‘ç»œAPI (æ¯”å¦‚recvã€sendã€acceptç­‰) åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯é˜»å¡çš„ï¼Œè°ƒç”¨è¿™äº›APIçš„æ—¶å€™ï¼Œå¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œä¼šè®©è°ƒç”¨è€…ç­‰å¾…ï¼Œç›´åˆ°I/Oæ“ä½œå®Œæˆã€‚ 7. ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ è¿è¡Œæ¨¡å¼ æƒé™çº§åˆ« å¯æ‰§è¡Œæ“ä½œ ç‰¹ç‚¹ ç”¨æˆ·æ€ è¾ƒä½ ä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶æˆ–è€…è¶Šæƒæ“ä½œï¼Œéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨è®©å†…æ ¸æ‰§è¡Œæ•æ„Ÿæ“ä½œ å®‰å…¨æ€§é«˜ï¼Œç¨‹åºå‡ºç°é—®é¢˜ï¼Œä¸ä¼šå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ å†…æ ¸æ€ è¾ƒé«˜ å¯ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå¹¶æ‰§è¡Œå¦‚å†…å­˜ç®¡ç†ã€è¿›ç¨‹è°ƒåº¦ç­‰äºè¶Šæƒæ“ä½œ èƒ½å¤Ÿé«˜æ•ˆç®¡ç†ç¡¬ä»¶å’Œç³»ç»Ÿèµ„æº ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ˜¯ CPU çš„çŠ¶æ€ï¼Œæè¿°äº†CPUåœ¨æ‰§è¡ŒæŒ‡ä»¤æ˜¯çš„ç‰¹æƒçº§åˆ«å’ŒèŒƒå›´æƒé™ã€‚è¿›ç¨‹è¿è¡Œçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸ºCPUçŠ¶æ€çš„åˆ‡æ¢ï¼Œåœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´æ›´æ›¿ã€‚\nç®€å•æ¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼Œå¦‚æœCPU æ˜¯ç”¨æˆ·æ€å°±æ˜¯çº¿ç¨‹è¿è¡Œè¿›ç¨‹æœ¬èº«çš„ç¨‹åºä»£ç ï¼Œå¦‚æœ CPU æ˜¯å†…æ ¸æ€å°±æ˜¯æŠŠçº¿ç¨‹äº¤ç»™æ“ä½œç³»ç»Ÿè¿è¡Œã€‚\nCPUæ˜¯ç”¨æˆ·æ€ï¼Œè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼šç”¨æˆ·æ€ä¸‹ï¼Œè¿›ç¨‹ä¸èƒ½ç›´æ¥ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œåªèƒ½è®¿é—®è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¸èƒ½è¶Šæƒè®¿é—®ç³»ç»Ÿçš„èµ„æºã€‚ä¹Ÿä¸èƒ½æ”¹å˜CPUçš„å·¥ä½œçŠ¶æ€ï¼ˆç”¨æˆ·æ€ã€å†…æ ¸æ€ã€ç©ºé—²çŠ¶æ€ï¼‰ã€‚åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œè¿›ç¨‹æ— æ³•ä¿®æ”¹CPUçš„å·¥ä½œçŠ¶æ€ã€‚åœ¨å†…æ ¸æ€ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹CPUå¯„å­˜å™¨çš„å€¼æ¥åˆ‡æ¢æƒé™ï¼Œå®ç°å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ã€‚ CPUæ˜¯å†…æ ¸æ€ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡osè®¿é—®ç³»ç»Ÿèµ„æºï¼šå†…æ ¸æ€ä¸‹ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡æ‰§è¡Œæ“ä½œç³»ç»Ÿçš„ç¨‹åºï¼Œæ¥ç›´æ¥ä½¿ç”¨è®¡ç®—æœºçš„æ‰€æœ‰ç¡¬ä»¶èµ„æºã€‚ä½†æ˜¯ï¼Œå¿…é¡»ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€æ‰å¯ä»¥ï¼Œè¿™æ ·ä¹Ÿä¿è¯äº†å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚ ã€ä¸ºä»€ä¹ˆè¦åŒºåˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ã€‘\nå› ä¸º CPU çš„æ‰€æœ‰æŒ‡ä»¤å½“ä¸­ï¼Œæœ‰éƒ¨åˆ†æŒ‡ä»¤æ˜¯éå¸¸å±é™©çš„ï¼Œæ“ä½œä¸å½“å°±ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚è€Œä¸”éƒ¨åˆ†æŒ‡ä»¤å¯èƒ½æ¶‰åŠåˆ°ç¡¬ä»¶çš„æ“ä½œï¼Œå‚æ•°å¾ˆå¤šï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚æ‰€ä»¥å‡¡æ˜¯æ¶‰åŠåˆ° I/O è¯»å†™ï¼Œå†…å­˜åˆ†é…ç­‰ç¡¬ä»¶èµ„æºçš„æ“ä½œçš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œå¾€å¾€ä¸èƒ½è®©è¿›ç¨‹ç›´æ¥æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆè°ƒç”¨æ“ä½œç³»ç»Ÿçš„ç¨‹åºï¼‰è®© CPU ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç¨‹åºåœ¨å†…æ ¸æ€ä¸‹é¢è¿è¡Œã€‚\nå…¶ä¸­ï¼ŒCPU çš„æŒ‡ä»¤æ˜¯æœ‰æƒé™åˆ†çº§çš„ï¼Œä¸åŒçº§åˆ«çš„æƒé™åŒ…å«ä¸åŒçš„ CPU æŒ‡ä»¤é›†ã€‚æ¯”å¦‚ InterCPU æŠŠ CPU çš„æŒ‡ä»¤é›†æ“ä½œæƒé™ä»é«˜åˆ°ä½åˆ†ä¸ºå››ä¸ªçº§åˆ«ï¼šring0ã€ring1ã€ring2ã€ring3ã€‚\nã€æ³¨æ„ã€‘\nring3 çš„æƒé™æœ€ä½ï¼Œåªèƒ½ä½¿ç”¨å¸¸è§„çš„ CPU æŒ‡ä»¤é›†ï¼Œä¸èƒ½ä½¿ç”¨æ“ä½œç¡¬ä»¶èµ„æºçš„ CPU æŒ‡ä»¤é›†ï¼Œæ¯”å¦‚I/Oè¯»å†™ã€ç½‘å¡è®¿é—®ã€ç”³è¯·å†…å­˜ç­‰æ“ä½œéƒ½ä¸å¯ä»¥ã€‚ring0 çš„æƒé™æœ€é«˜ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„ CPU æŒ‡ä»¤é›† Linuxç³»ç»Ÿå½“ä¸­åªé‡‡ç”¨äº† ring0 å’Œ ring3 è¿™ä¸¤ä¸ªæƒé™ã€‚ring0 å¯¹åº”çš„å°±æ˜¯å†…æ ¸æ€ï¼Œç¨‹åºå®Œå…¨åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸å½“ä¸­è¿è¡Œã€‚ring3 å¯¹åº”çš„æ˜¯ç”¨æˆ·æ€ï¼Œç¨‹åºåœ¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´å½“ä¸­è¿è¡Œã€‚ ã€ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ç©ºé—´ã€‘\nåœ¨å†…å­˜èµ„æºçš„ä½¿ç”¨ä¸Šï¼Œæ“ä½œç³»ç»Ÿå¯¹ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹Ÿåšäº†é™åˆ¶ã€‚å†…å­˜ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…å«äº†å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼ˆç¨‹åºä»£ç å’Œæ•°æ®ã€å †å†…å­˜ã€æ ˆå†…å­˜ã€å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚æ¯ä¸ªè¿›ç¨‹åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ†é…è™šæ‹Ÿç©ºé—´åœ°å€ï¼Œå’Œå†…å­˜ç»“æ„ä¸€æ ·ã€‚è™šæ‹Ÿç©ºé—´å°±è®°å½•ï¼Œå¯¹åº”çš„åœ¨å®é™…å†…å­˜ä¸­å­˜æ”¾çš„ä½ç½®ã€‚è™šæ‹Ÿåœ°å€ç©ºé—´ä¸ç‰©ç†å†…å­˜é€šè¿‡**å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰å’Œé¡µè¡¨ï¼ˆPage Tableï¼‰**å®ç°åŠ¨æ€æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œåœ¨Linux ( 32 ä½ç³»ç»Ÿ)ä¸‹ï¼Œæ€»å…±çš„å†…å­˜ç©ºé—´æ˜¯ 2^32 bytes = 4GB ï¼Œå†…æ ¸æ€ä¸º 1Gï¼Œç”¨æˆ·æ€ä¸º 3Gã€‚ **ã€æ³¨æ„ã€‘**å†…æ ¸æ€çš„åœ°å€ç©ºé—´å­˜æ”¾æ•´ä¸ªå†…æ ¸çš„ä»£ç ï¼Œæ‰€æœ‰çš„å†…æ ¸æ¨¡å—å’Œå†…æ ¸ç»´æŠ¤çš„æ•°æ®ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ã€‚æ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸æ€é€»è¾‘åœ°å€æ˜¯å…±äº«åŒä¸€å—å†…å­˜åœ°å€çš„ã€‚åŒæ—¶ CPU å¤„äºå†…æ ¸æ€çš„æ—¶å€™ï¼Œè¿›ç¨‹å¯ä»¥æ“ä½œå…¨éƒ¨èŒƒå›´çš„è™šæ‹Ÿç©ºé—´åœ°å€ï¼Œå¹¶ä¸”å±äºå†…æ ¸æ€çš„é«˜ä½è™šæ‹Ÿç©ºé—´åªæœ‰å†…æ ¸æ€ä¸‹ï¼Œç¨‹åºæ‰èƒ½æ“ä½œã€‚\nã€ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€‘\nç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢å…·æœ‰ä¸€å®šçš„å¼€é”€ï¼Œä¸‹é¢æ˜¯ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„æµç¨‹ï¼ˆæ¯”å¦‚å‘èµ· I/O è°ƒç”¨ï¼‰\nä¿ç•™ç”¨æˆ·æ€çš„ç°åœº ï¼ˆä¸Šä¸‹æ–‡ã€ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰ã€ç”¨æˆ·æ ˆï¼‰ å¤åˆ¶ç”¨æˆ·å‚æ•°ï¼Œä»ç”¨æˆ·æ ˆåˆ‡æ¢åˆ°å†…æ ¸æ ˆï¼ŒCPU è¿›å…¥å†…æ ¸æ€ é¢å¤–çš„æ£€æŸ¥ ï¼ˆå› ä¸ºå†…æ ¸ä»£ç å¯¹ç”¨æˆ·æ˜¯ä¸ä¿¡ä»»çš„ï¼‰ æ‰§è¡Œå†…æ ¸æ€ä¸­ç›¸å…³çš„ä»£ç  å¤åˆ¶å†…æ ¸æ€ä»£ç æ‰§è¡Œç»“æœï¼Œå›åˆ°ç”¨æˆ·æ€ æ¢å¤ç”¨æˆ·æ€ç°åœºï¼ˆä¸Šä¸‹æ–‡ã€ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰ã€ç”¨æˆ·æ ˆï¼‰ ä»ç”¨æˆ·æ€ä¸»åŠ¨åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œéœ€è¦æœ‰å…¥å£æ‰è¡Œï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†ç»Ÿä¸€çš„å…¥å£ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚ç³»ç»Ÿè°ƒç”¨å°±æ˜¯ä¸€ç»„é€šç”¨çš„è®¿é—®æ¥å£ï¼Œè¿™äº›æ¥å£å°±å«ç³»ç»Ÿè°ƒç”¨ã€‚\nã€ç”¨æˆ·æ€ä»€ä¹ˆæ—¶å€™åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‘\nç³»ç»Ÿè°ƒç”¨ï¼šç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºå®Œæˆå·¥ä½œï¼Œæ¯”å¦‚ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªåˆ›å»ºæ–°è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚ç³»ç»Ÿè°ƒç”¨çš„æ ¸å¿ƒæ˜¯ç³»è‰ç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°çš„ï¼Œæˆä¸ºè½¯ä¸­æ–­ã€‚ å¼‚å¸¸ï¼šå½“ CPU åœ¨æ‰§è¡Œç”¨æˆ·æ€çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå‘ç”Ÿäº†ä¸€äº›æ²¡æœ‰é¢„çŸ¥çš„å¼‚å¸¸ã€‚æ­¤æ—¶ï¼Œå½“å‰è¿è¡Œè¿›ç¨‹ä¼šåˆ‡æ¢åˆ°å¤„ç†è¯¥å¼‚å¸¸çš„å†…æ ¸æ€ä¸­çš„ç›¸å…³è¿›ç¨‹ï¼Œå°±æ˜¯ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€äº†ã€‚æ¯”å¦‚å‡ºç°ç¼ºé¡µå¼‚å¸¸ ä¸­æ–­ï¼šå½“ CPU åœ¨æ‰§è¡Œç”¨æˆ·æ€çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œä¹‹åï¼Œä¼šå‘ CPU å‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ã€‚æ­¤æ—¶ï¼Œ CPU ä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œè½¬åˆ°ä¸ä¸­æ–­ä¿¡å·å¯¹åº”çš„å†…æ ¸æ€ä¸‹çš„å¤„ç†ç¨‹åºå»æ‰§è¡Œï¼Œä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°äº†å†…æ ¸æ€ã€‚æ¯”å¦‚ç¡¬ç›˜è¯»å†™å®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œåè¾¹çš„æ“ä½œã€‚ ","permalink":"https://swimmingliu.cn/posts/job/operation-system-interview-questions/","summary":"\u003ch2 id=\"1-è¯´è¯´ä½ çŸ¥é“çš„å‡ ç§-io-æ¨¡å‹\"\u003e1. è¯´è¯´ä½ çŸ¥é“çš„å‡ ç§ I/O æ¨¡å‹\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eã€å¸¸è§çš„äº”å¤§I/Oæ¨¡å‹ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå¸¸è§çš„äº”å¤§I/Oæ¨¡å¼åˆ†åˆ«ä¸º: åŒæ­¥é˜»å¡I/O (Blocking I/O) \u003ccode\u003eBIO\u003c/code\u003eã€éé˜»å¡I/O (Non-blocking I/O) \u003ccode\u003eNIO\u003c/code\u003eã€I/Oå¤šè·¯å¤ç”¨ã€ä¿¡å·é‡é©±åŠ¨I/Oã€å¼‚æ­¥I/O \u003ccode\u003eAIO\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å‡å¦‚è¦çƒ§æ°´å–ï¼Œçœ‹ä¸åŒæ¨¡å‹æ˜¯æ€ä¹ˆçƒ§çš„æ°´å–\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003cstrong\u003eI/O æ¨¡å‹\u003c/strong\u003e\u003c/th\u003e\n          \u003cth\u003eç‰¹æ€§\u003c/th\u003e\n          \u003cth\u003eçƒ§æ°´æ¡ˆä¾‹\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eåŒæ­¥é˜»å¡I/O \u003ccode\u003eBIO\u003c/code\u003e\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ï¼Œå†ä»å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´ï¼Œéƒ½æ˜¯é˜»å¡æ“ä½œã€‚\u003c/td\u003e\n          \u003ctd\u003eè‡ªå·±åŠ¨æ‰‹çƒ§æ°´ï¼Œä¸€ç›´ç›¯ç€ï¼Œç­‰æ°´çƒ§å¼€äº†ï¼Œå€’åœ¨æ¯å­é‡Œå–ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eéé˜»å¡I/O \u003ccode\u003eNIO\u003c/code\u003e\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ä¸é˜»å¡ï¼Œ\u003ccode\u003eread\u003c/code\u003eä¸åˆ°æ•°æ®ç›´æ¥è¿”å›ï¼Œä½†æ˜¯ä»å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´ä¼šé˜»å¡ (ç”¨æˆ·è½®è¯¢\u003ccode\u003eread\u003c/code\u003e)\u003c/td\u003e\n          \u003ctd\u003eè‡ªå·±åŠ¨æ‰‹çƒ§æ°´ï¼Œéš”ä¸¤åˆ†é’Ÿçœ‹ä¸€ä¸‹ï¼Œæ°´çƒ§å¼€æ²¡æœ‰ã€‚ç­‰æ°´çƒ§å¼€äº†ï¼Œå€’åœ¨æ¯å­é‡Œå–ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eI/Oå¤šè·¯å¤ç”¨\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eåªæœ‰ä¸€ä¸ªçº¿ç¨‹æŸ¥çœ‹å¤šä¸ªè¿æ¥æ˜¯å¦æœ‰æ•°æ®å‡†å¤‡å°±ç»ª (çœ‹ä»ç½‘å¡èƒ½ä¸èƒ½\u003ccode\u003eread\u003c/code\u003eåˆ°æ•°æ®åˆ°å†…æ ¸)\u003c/td\u003e\n          \u003ctd\u003eæ‰¾ä¸“é—¨çƒ§æ°´çš„é¢†å±…å¸®å¿™ï¼Œä»–æŠŠæ°´çƒ§å¥½äº†ä¹‹åï¼Œä¼šå–Šä½ æ¥æ‹¿ã€‚ä½†æ˜¯ä½ è¦è‡ªå·±å€’åœ¨æ¯å­é‡Œå–ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eä¿¡å·é©±åŠ¨I/O\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®ä»ç½‘å¡åˆ°å†…æ ¸ä¹‹åä¼šè‡ªåŠ¨é€šçŸ¥ç”¨æˆ·ç¨‹åºï¼Œç„¶åè®©ä»–\u003ccode\u003eread\u003c/code\u003eè¯»å–æ•°æ®\u003c/td\u003e\n          \u003ctd\u003eå»çƒ§æ°´æˆ¿çƒ§æ°´ï¼Œå…¨è‡ªåŠ¨çš„ï¼Œæœ‰ä¸ªé€šçŸ¥ç¯ã€‚æ°´çƒ§å®Œäº†ä¹‹åä¼šæŒ‰ä½ å®¶çš„é—¨é“ƒï¼Œä½†æ˜¯æœ‰å®¢äººæ¥äº†ï¼Œä¹Ÿä¼šæŒ‰é—¨é“ƒ\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eå¼‚æ­¥I/O \u003ccode\u003eAIO\u003c/code\u003e\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå…¨ç¨‹ä¸é˜»å¡ï¼Œæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ä¹‹åç›´æ¥å›è°ƒã€‚\u003c/td\u003e\n          \u003ctd\u003eå’Œå¤šè·¯å¤ç”¨ç±»ä¼¼ï¼Œä½†æ˜¯çƒ§å®Œæ°´ä¹‹åä¸ç”¨è‡ªå·±å€’æ°´ï¼Œä»–å¸®ä½ å€’å¥½äº†ï¼Œè¿˜å¹å‡‰äº†ï¼Œä½ è¿‡æ¥å–å°±è¡Œã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cimg alt=\"IOäº”ç§æ¨¡å‹\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/3bbe065d-f63f-11ef-a797-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå„ç§I/Oã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹å›¾æ˜¯ä¸¤ä¸ªä¸åŒä¸»æœºä¸Šï¼Œåº”ç”¨ç¨‹åºä¼ é€’æ•°æ®çš„è¿‡ç¨‹ï¼Œå€ŸåŠ©è¯¥è¿‡ç¨‹æ¥ç†è§£ \u003ccode\u003eI/O\u003c/code\u003e æ˜¯å¦‚ä½•äº§ç”Ÿçš„\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰æ˜¯ä¸€ç§ä¸ç»è¿‡CPUç›´æ¥åœ¨ç½‘ç»œé€‚é…å™¨ï¼ˆç½‘å¡ï¼‰å’Œä¸»æœºå†…å­˜ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“çš„æœºåˆ¶ï¼Œç”¨äºæå‡æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"ä¸¤ä¸ªä¸»æœºçš„åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•é€šä¿¡çš„\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/c3fa5783-0332-11f0-9b6e-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€åŒæ­¥é˜»å¡ I/O \u003ccode\u003eBIO\u003c/code\u003eã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåŒæ­¥é˜»å¡I/O \u003ccode\u003eBIO\u003c/code\u003e çš„å·¥ä½œæœºåˆ¶ï¼šåº”ç”¨ç¨‹åºè¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒºæ‰è¿”å›ã€‚é˜»å¡å¹¶æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å…¶ä»–ç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œä¸æ¶ˆè€—CPUäº‹ä»¶ã€‚åŒæ­¥é˜»å¡ I/O \u003ccode\u003eBIO\u003c/code\u003e ä¸­ï¼Œåº”ç”¨ç¨‹åºå‘èµ· \u003ccode\u003eread\u003c/code\u003e è°ƒç”¨æ¥è¯»å–æ•°æ®ä¹‹åï¼Œä¸€ç›´è¢«é˜»å¡ï¼Œç›´åˆ°å†…æ ¸æŠŠæ•°æ®copyåˆ°ç”¨æˆ·ç©ºé—´ã€‚è¯¥æ–¹æ¡ˆé€‚åˆå®¢æˆ·ç«¯è¿æ¥æ•°é‡ä¸é«˜çš„æƒ…å†µã€‚ä¸‹å›¾çš„\u003ccode\u003eread\u003c/code\u003e å’Œ \u003ccode\u003erecvfrom\u003c/code\u003e å‡½æ•°æ˜¯ä¸€ä¸ªæ„æ€ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"åŒæ­¥é˜»å¡IOç»“æ„å›¾\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/c5e8e28c-0332-11f0-bf73-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€éé˜»å¡å¼  I/O \u003ccode\u003eNIO\u003c/code\u003eã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eéé˜»å¡å¼  I/O \u003ccode\u003eNIO\u003c/code\u003e çš„å·¥ä½œæœºåˆ¶ï¼šåº”ç”¨ç¨‹åºæ‰§è¡Œ\u003ccode\u003eread\u003c/code\u003e ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„è½®è¯¢ \u003ccode\u003eread\u003c/code\u003e æ¥è·å– I/Oæ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¹‹ä¸º \u003cstrong\u003eè½®è¯¢ \u003ccode\u003epolling\u003c/code\u003e\u003c/strong\u003e ã€‚ç­‰åˆ°æ•°æ®å‡†å¤‡å°±ç»ªï¼Œä»å†…æ ¸ç©ºé—´copyåˆ°ç”¨æˆ·ç©ºé—´çš„æ—¶å€™ï¼Œè¿›ç¨‹æ‰è¢«é˜»å¡ï¼Œç›´åˆ°å†…æ ¸copyå®Œæˆã€‚è¯¥æ–¹æ¡ˆæ¯”è¾ƒä½æ•ˆï¼Œä¼šä¸åœçš„æ¶ˆè€—CPUèµ„æºã€‚\u003c/p\u003e","title":"æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ç¬”è®°"},{"content":"ä¸ªäººç®€å†è¯¦æƒ…æŸ¥çœ‹ -\u0026gt; ä¸ªäººç®€å†é¡µ\n1. å¼‚æ­¥ç§’æ€æœºåˆ¶çš„å¼‚æ­¥æ˜¯å¦‚ä½•å®ç°çš„? ã€æ­£å¸¸ç§’æ€çš„é¡ºåºã€‘\næŸ¥è¯¢ä¼˜æƒ åˆ¸ -\u0026gt; åˆ¤æ–­ç§’æ€åº“å­˜ -\u0026gt; æŸ¥è¯¢è®¢å• -\u0026gt; æ ¡éªŒæ˜¯å¦ä¸€äººä¸€å• -\u0026gt; æ‰£å‡åº“å­˜ -\u0026gt; åˆ›å»ºè®¢å•\nã€å¼‚æ­¥ç§’æ€ã€‘\nä¸ºäº†å®ç°ç”¨æˆ·å¼‚æ­¥ä¸‹å•ï¼Œå…¶å®å°±æ˜¯æŠŠæ˜¯å¦èƒ½å¤Ÿä¸‹å•çš„åˆ¤æ–­é€»è¾‘å’Œä¸‹å•çš„æ“ä½œæ‹†åˆ†å¼€ã€‚\né‡‡ç”¨Redisæ¥åˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿçš„åº“å­˜å’Œæ ¡éªŒä¸€äººä¸€å• å¦‚æœæ»¡è¶³æ¡ä»¶ï¼ŒæŠŠç”¨æˆ·ã€è®¢å•idã€å•†å“idä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ï¼Œç›´æ¥ç»™ç”¨æˆ·è¿”å›ç§’æ€æˆåŠŸã€‚ å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œç›´æ¥è¿”å›ç§’æ€å¤±è´¥ã€‚ åå°çº¿ç¨‹ä¼šå»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ è¿™æ ·å°±å¯ä»¥å®ç°å¼‚æ­¥çš„ç§’æ€ä¸‹å•äº†ï¼Œé‚£ä¹ˆå¦‚æœå®ç°åˆ¤æ–­ç§’æ€åº“å­˜å’Œæ ¡éªŒä¸€äººä¸€å•å‘¢ï¼Ÿ\nã€ç§’æ€åº“å­˜ + ä¸€äººä¸€å•ã€‘\nç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­rediså½“ä¸­çš„åº“å­˜keyçš„valueæ˜¯å¦å¤§äº0 value \u0026gt; 0 -\u0026gt; ç¬¬2æ­¥ value \u0026lt;= 0 -\u0026gt; ç›´æ¥è¿”å›åº“å­˜ä¸è¶³ ï¼ˆè¿”å›1ï¼‰ å¦‚æœåº“å­˜å……è¶³ï¼Œåˆ¤æ–­rediså½“ä¸­çš„ç§’æ€å•†å“keyçš„ set é›†åˆæ˜¯å¦å·²åŒ…å«userid åŒ…å«useridï¼Œ è¯´æ˜ç”¨æˆ·å·²ç»ä¸‹å•äº†ï¼Œç›´æ¥è¿”å›å½“å‰ç”¨æˆ·å·²ä¸‹å• (è¿”å›2) ä¸åŒ…å« userid -\u0026gt; ç¬¬3æ­¥ å¦‚æœç”¨æˆ·æ²¡æœ‰ä¸‹å•ï¼Œå°†ç”¨æˆ·çš„ userid å­˜å…¥ set é‡Œé¢ (è¿”å›0) ã€æ³¨æ„ã€‘ æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œè¿™æ ·å°±ç¡®ä¿äº†ä¸ä¼šå‡ºç°è¶…å–ç°è±¡å’Œä¸€äººå¤šå•ç°è±¡\n-- 1.å‚æ•°åˆ—è¡¨ -- 1.1.ç§’æ€å•†å“id local voucherId = ARGV[1] -- 1.2.ç”¨æˆ·id local userId = ARGV[2] -- 1.3.è®¢å•id local orderId = ARGV[3] -- 2.æ•°æ®key -- 2.1.åº“å­˜key local stockKey = \u0026#39;seckill:stock:\u0026#39; .. voucherId -- 2.2.ç§’æ€å•†å“è®¢å•key local orderKey = \u0026#39;seckill:order:\u0026#39; .. voucherId -- 3.è„šæœ¬ä¸šåŠ¡ -- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey if(tonumber(redis.call(\u0026#39;get\u0026#39;, stockKey)) \u0026lt;= 0) then -- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1 return 1 end -- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId if(redis.call(\u0026#39;sismember\u0026#39;, orderKey, userId) == 1) then -- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2 return 2 end return 0 ã€é˜»å¡é˜Ÿåˆ—å®ç°ä¸‹å•ã€‘\nåˆå§‹åŒ–ä¸€ä¸ªSingleThreadExecutor çº¿ç¨‹æ± ï¼Œç”¨äºå®Œæˆåç»­çš„ä¸‹å•æ“ä½œ åˆ¤æ–­ä¸Šé¢luaè„šæœ¬æ‰§è¡Œåçš„è¿”å›å€¼ å¦‚æœè¿”å›å€¼ä¸º0ï¼Œ è¯´æ˜ç”¨æˆ·æ»¡è¶³ä¸‹å•çš„èµ„æ ¼ -\u0026gt; ç¬¬2æ­¥ å¦‚æœè¿”å›å€¼ä¸ä¸º0ï¼Œ è¯´æ˜ç”¨æˆ·ä¸‹å•å¤±è´¥ï¼Œè¿”å›å¼‚å¸¸ä¿¡æ¯ å°†useridã€ä¼˜æƒ å•†å“idã€è®¢å•idç­‰ä¿¡æ¯éƒ½å­˜å…¥é˜»å¡é˜Ÿåˆ—(ArrayBlockingQueue)é‡Œé¢ï¼Œè¿”å›è®¢å•id çº¿ç¨‹æ± ä¼šå¼‚æ­¥è·å–é˜»å¡é˜Ÿåˆ—é‡Œé¢çš„è®¢å•ä¿¡æ¯ï¼Œç„¶ååˆ›å»ºè®¢å•ã€‚ 2. å¦‚æœç”¨MySQLæ•°æ®åº“ï¼Œå¦‚ä½•è§£å†³è¶…å–ç°è±¡ è¶…å–ç°è±¡çš„äº§ç”Ÿæ˜¯å› ä¸ºå¤šçº¿ç¨‹å¹¶å‘çš„æ—¶å€™ï¼Œå‡ºç°äº†åº“å­˜æ‰£ä¸ºè´Ÿæ•°çš„ç°è±¡ã€‚\nå‡å¦‚Açº¿ç¨‹æŸ¥è¯¢æ—¶ï¼Œåº“å­˜ä¸º1 ã€‚éšåï¼ŒBçº¿ç¨‹æŸ¥è¯¢åº“å­˜ä¹Ÿä¸º1 Açº¿ç¨‹å®Œæˆä¸‹å•ä¹‹å, åº“å­˜å‡ä¸º0ã€‚æ­¤æ—¶ï¼ŒBçº¿ç¨‹åˆå®Œæˆä¸‹å•ï¼Œåº“å­˜æ‰£å‡ä¸º-1ã€‚ ã€MySQLå¦‚ä½•è§£å†³è¶…å–é—®é¢˜ã€‘\nä¸€èˆ¬è¶…å–é—®é¢˜éƒ½æ˜¯é‡‡ç”¨ä¹è§‚é”è¿›è¡Œè§£å†³ï¼Œä¹Ÿå°±æ˜¯CAS è‡ªæ—‹ã€‚å…¶å®ï¼Œå°±æ˜¯åˆ¤æ–­è¯»å–å‰å’Œç¬¬äºŒæ¬¡è¯»å–çš„ï¼Œæ˜¯å¦å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¦‚æœæ•°æ®ä¸ä¸€è‡´ï¼Œè¯´æ˜è¢«å…¶ä»–äººä¿®æ”¹è¿‡ï¼Œå°±æ”¾å¼ƒå½“å‰çš„æ“ä½œã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±æ­£å¸¸ä¿®æ”¹ã€‚\nã€ä¹è§‚é”ã€‘\nä¹è§‚é”ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ã€‚å†æäº¤å›æ•°æ®æ˜¯ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯å¦å¤§äº1ã€‚å¦‚æœè¶…è¿‡1ï¼Œ åˆ™è¯´æ˜å½“å‰çš„æ•°æ®è¢«ä¿®æ”¹è¿‡ã€‚\nä¹è§‚é”æœ‰ä¸€ä¸ªå˜ç§æ˜¯CASï¼Œåˆ©ç”¨CASè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œwhile ä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ == å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼\nint var5; do { var5 = this.getIntVolatile(var1, var2); } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5; ã€MySQLå¦‚ä½•è§£å†³ä¸€äººä¸€å•ã€‘\nå°±æ˜¯åˆ¤æ–­å½“å‰ç”¨äºåœ¨æ•°æ®åº“é‡Œé¢æ˜¯å¦æœ‰è®¢å•, å¯ä»¥ç”¨count() å»ç»Ÿè®¡ä¸€ä¸‹è¯¥ç”¨æˆ·ç§’æ€è®¢å•çš„æ•°é‡ã€‚å¦‚æœå¤§äº0ï¼Œåˆ™è¯´æ˜ä»–å·²ç»ä¹°è¿‡å•†å“äº†ï¼Œå°±ä¸èƒ½é‡å¤ä¸‹å•äº†ã€‚\n","permalink":"https://swimmingliu.cn/posts/job/personal-interview-hot-question/","summary":"\u003cp\u003eä¸ªäººç®€å†è¯¦æƒ…æŸ¥çœ‹ -\u0026gt; \u003ca href=\"https://rxresu.me/dashboard/resumes\"\u003eä¸ªäººç®€å†é¡µ\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"1-å¼‚æ­¥ç§’æ€æœºåˆ¶çš„å¼‚æ­¥æ˜¯å¦‚ä½•å®ç°çš„\"\u003e1. å¼‚æ­¥ç§’æ€æœºåˆ¶çš„å¼‚æ­¥æ˜¯å¦‚ä½•å®ç°çš„?\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ­£å¸¸ç§’æ€çš„é¡ºåºã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæŸ¥è¯¢ä¼˜æƒ åˆ¸ -\u0026gt; åˆ¤æ–­ç§’æ€åº“å­˜ -\u0026gt; æŸ¥è¯¢è®¢å• -\u0026gt; æ ¡éªŒæ˜¯å¦ä¸€äººä¸€å• -\u0026gt; æ‰£å‡åº“å­˜ -\u0026gt; åˆ›å»ºè®¢å•\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€å¼‚æ­¥ç§’æ€ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä¸ºäº†å®ç°ç”¨æˆ·å¼‚æ­¥ä¸‹å•ï¼Œå…¶å®å°±æ˜¯æŠŠæ˜¯å¦èƒ½å¤Ÿä¸‹å•çš„åˆ¤æ–­é€»è¾‘å’Œä¸‹å•çš„æ“ä½œæ‹†åˆ†å¼€ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eé‡‡ç”¨Redisæ¥åˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿçš„åº“å­˜å’Œæ ¡éªŒä¸€äººä¸€å•\n\u003cul\u003e\n\u003cli\u003eå¦‚æœæ»¡è¶³æ¡ä»¶ï¼ŒæŠŠç”¨æˆ·ã€è®¢å•idã€å•†å“idä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ï¼Œç›´æ¥ç»™ç”¨æˆ·è¿”å›ç§’æ€æˆåŠŸã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œç›´æ¥è¿”å›ç§’æ€å¤±è´¥ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eåå°çº¿ç¨‹ä¼šå»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eè¿™æ ·å°±å¯ä»¥å®ç°å¼‚æ­¥çš„ç§’æ€ä¸‹å•äº†ï¼Œé‚£ä¹ˆå¦‚æœå®ç°åˆ¤æ–­ç§’æ€åº“å­˜å’Œæ ¡éªŒä¸€äººä¸€å•å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"1653561657295\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/8f260a35-f4b5-11ef-a915-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€ç§’æ€åº“å­˜ + ä¸€äººä¸€å•ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­rediså½“ä¸­çš„åº“å­˜keyçš„valueæ˜¯å¦å¤§äº\u003ccode\u003e0\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003evalue \u0026gt; 0\u003c/code\u003e -\u0026gt; ç¬¬2æ­¥\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evalue \u0026lt;= 0\u003c/code\u003e -\u0026gt; ç›´æ¥è¿”å›åº“å­˜ä¸è¶³ ï¼ˆè¿”å›\u003ccode\u003e1\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eå¦‚æœåº“å­˜å……è¶³ï¼Œåˆ¤æ–­rediså½“ä¸­çš„ç§’æ€å•†å“keyçš„ \u003ccode\u003eset\u003c/code\u003e é›†åˆæ˜¯å¦å·²åŒ…å«\u003ccode\u003euserid\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eåŒ…å«\u003ccode\u003euserid\u003c/code\u003eï¼Œ è¯´æ˜ç”¨æˆ·å·²ç»ä¸‹å•äº†ï¼Œç›´æ¥è¿”å›å½“å‰ç”¨æˆ·å·²ä¸‹å• (è¿”å›\u003ccode\u003e2\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eä¸åŒ…å« \u003ccode\u003euserid\u003c/code\u003e -\u0026gt; ç¬¬3æ­¥\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eå¦‚æœç”¨æˆ·æ²¡æœ‰ä¸‹å•ï¼Œå°†ç”¨æˆ·çš„ \u003ccode\u003euserid\u003c/code\u003e å­˜å…¥ \u003ccode\u003eset\u003c/code\u003e é‡Œé¢ (è¿”å›\u003ccode\u003e0\u003c/code\u003e)\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eã€æ³¨æ„ã€‘\u003c/strong\u003e æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œè¿™æ ·å°±ç¡®ä¿äº†ä¸ä¼šå‡ºç°\u003cstrong\u003eè¶…å–ç°è±¡å’Œä¸€äººå¤šå•ç°è±¡\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-lua\" data-lang=\"lua\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 1.å‚æ•°åˆ—è¡¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 1.1.ç§’æ€å•†å“id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003evoucherId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eARGV\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 1.2.ç”¨æˆ·id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eARGV\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 1.3.è®¢å•id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eorderId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eARGV\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 2.æ•°æ®key\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 2.1.åº“å­˜key\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003estockKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;seckill:stock:\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e..\u003c/span\u003e \u003cspan class=\"n\"\u003evoucherId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 2.2.ç§’æ€å•†å“è®¢å•key\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eorderKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;seckill:order:\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e..\u003c/span\u003e \u003cspan class=\"n\"\u003evoucherId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 3.è„šæœ¬ä¸šåŠ¡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etonumber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eredis.call\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;get\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estockKey\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eredis.call\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;sismember\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eorderKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eã€é˜»å¡é˜Ÿåˆ—å®ç°ä¸‹å•ã€‘\u003c/strong\u003e\u003c/p\u003e","title":"ä¸ªäººç®€å†å¸¸é—®é—®é¢˜"},{"content":"1. Redisä¸»ä»å¤åˆ¶çš„åŸç† ã€ä¸»ä»å¤åˆ¶çš„åŸç†ã€‘\nåŒæ­¥ï¼šä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€psyncå‘½ä»¤è¿›è¡ŒåŒæ­¥ï¼Œä»èŠ‚ç‚¹ä¿å­˜ä¸»èŠ‚ç‚¹è¿”å›çš„ runid å’Œ offset å…¨é‡å¤åˆ¶ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥æˆ–è€…è¿æ¥å¤±è´¥ä¸”repl_backlog_buffer ç¼“å­˜åŒºä¸åŒ…å«slave_repl_offsetï¼Œ åˆ™ç”Ÿæˆä¸»èŠ‚ç‚¹çš„æ•°æ®å¿«ç…§(RDBæ–‡ä»¶)å‘ç»™ä»èŠ‚ç‚¹ å¢é‡å¤åˆ¶ï¼šå…¨é‡å¤åˆ¶å®Œæ¯•åï¼Œä¸»ä»èŠ‚ç‚¹ä¹‹é—´ä¼šä¿æŒé•¿è¿æ¥ã€‚å¦‚æœè¿æ¥æ²¡æœ‰æ–­å¼€æˆ–è€…slave_repl_offsetä»ç„¶åœ¨repl_backlog_bufferä¸­ï¼Œåˆ™å°†åç»­çš„å†™æ“ä½œä¼ é€’ç»™ä»èŠ‚ç‚¹ï¼Œè®©æ•°æ®ä¿æŒä¸€è‡´ã€‚ ã€å…¨é‡å¤åˆ¶ç»†èŠ‚ã€‘\nå…¨é‡å¤åˆ¶çš„è¿‡ç¨‹æ˜¯åŸºäºTCPé•¿è¿æ¥çš„ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹\nä»èŠ‚ç‚¹å‘é€psync ? -1è¡¨ç¤ºéœ€è¦å»ºç«‹è¿æ¥è¿›è¡ŒåŒæ­¥ï¼Œä¸»èŠ‚ç‚¹è¿”å›ä¸»èŠ‚ç‚¹ID runid å’Œ å¤åˆ¶è¿›åº¦offset (ç¬¬ä¸€æ¬¡åŒæ­¥ç”¨ -1 è¡¨ç¤º)ã€‚ä»èŠ‚ç‚¹æ¥å—ä¹‹åï¼Œä¿å­˜ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚ ä¸»èŠ‚ç‚¹æ‰§è¡Œbgsaveå‘½ä»¤ç”Ÿæˆæ•°æ®å¿«ç…§RDBæ–‡ä»¶ï¼Œç„¶åå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹æ¥å—æ–‡ä»¶åï¼Œæ¸…é™¤ç°æœ‰çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶ååŠ è½½RDBæ–‡ä»¶ å¦‚æœåœ¨åˆ¶ä½œæ•°æ®å¿«ç…§RDBæ–‡ä»¶çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°äº†æ–°çš„å†™æ“ä½œï¼Œä¸»èŠ‚ç‚¹ä¼šå°†å…¶è®°å½•åœ¨repl buffer é‡Œé¢ã€‚ç„¶åå°†repl bufferå½“ä¸­çš„å†™æ“ä½œå‘ç»™ä»èŠ‚ç‚¹ï¼Œè®©å…¶æ•°æ®ä¿æŒä¸€è‡´ã€‚ ã€å¢é‡å¤åˆ¶ç»†èŠ‚ã€‘\nå¦‚æœä¸»ä»èŠ‚ç‚¹æ„å¤–æ–­å¼€è¿æ¥ï¼Œä¸ºäº†ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¿…é¡»é‡æ–°åŒæ­¥æ•°æ®ã€‚å¦‚æœä½¿ç”¨å…¨é‡å¤åˆ¶æ¥ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œå¼€é”€å¤ªå¤§ï¼Œæ‰€ä»¥é‡‡ç”¨å¢é‡å¤åˆ¶ã€‚\nå¢é‡å¤åˆ¶çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\nè¿æ¥æ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå‘é€psync {runid} {offset}ï¼Œ å…¶ä¸­ä¸»èŠ‚ç‚¹ID runid å’Œ å¤åˆ¶è¿›åº¦offsetç”¨äºæ ‡è¯†æ˜¯å“ªä¸€ä¸ªæœåŠ¡å™¨ä¸»æœºå’Œå¤åˆ¶è¿›åº¦ã€‚ ä¸»èŠ‚ç‚¹æ”¶åˆ°psync å‘½ä»¤ä¹‹åï¼Œä¼šç”¨conitnueå“åº”å‘ŠçŸ¥ä»èŠ‚ç‚¹ï¼Œé‡‡ç”¨å¢é‡å¤åˆ¶åŒæ­¥æ•°æ® æœ€åï¼Œä¸»èŠ‚ç‚¹æ ¹æ®offsetæŸ¥æ‰¾å¯¹åº”çš„è¿›åº¦ï¼Œå°†æ–­çº¿æœŸé—´æœªåŒæ­¥çš„å†™å‘½ä»¤ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œä¸»èŠ‚ç‚¹å°†æ‰€æœ‰çš„å†™å‘½ä»¤å†™å…¥repl_backlog_bufferï¼Œ ç”¨äºåç»­åˆ¤æ–­æ˜¯é‡‡ç”¨å¢é‡å¤åˆ¶è¿˜æ˜¯å…¨é‡å¤åˆ¶ã€‚ ã€æ³¨æ„ã€‘ä»èŠ‚ç‚¹ psync æºå¸¦çš„ offset ä¸º slave_repl_offsetã€‚å¦‚æœ repl_backlog_bufferåŒ…å«slave_repl_offset å¯¹åº”çš„éƒ¨åˆ†ï¼Œåˆ™é‡‡ç”¨å¢é‡å¤åˆ¶ï¼Œå¦åˆ™é‡‡ç”¨å…¨é‡å¤åˆ¶ã€‚repl_backlog_bufferçš„é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º1M\nã€ä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶ã€‘\nå¤‡ä»½æ•°æ®ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„æ•°æ®å†—ä½™æ–¹å¼ æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œå¯ä»¥é‡‡ç”¨ä»èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚ è´Ÿè½½å‡è¡¡: ä¸»ä»å¤åˆ¶å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œåªæœ‰ä¸»èŠ‚ç‚¹æ”¯æŒè¯»å†™æ“ä½œï¼Œä»èŠ‚ç‚¹åªæœ‰è¯»æ“ä½œã€‚åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ 2. Redisé›†ç¾¤çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ? ã€Redisé›†ç¾¤åŸºæœ¬çŸ¥è¯†ã€‘\nå®šä¹‰: Redisé›†ç¾¤ç”±å¤šä¸ªå®ä¾‹ç»„æˆï¼Œæ¯ä¸ªå®ä¾‹å­˜å‚¨éƒ¨åˆ†æ•°æ® (æ¯ä¸ªå®ä¾‹ä¹‹é—´çš„æ•°æ®ä¸é‡å¤) ã€‚ ã€æ³¨ã€‘é›†ç¾¤å’Œä¸»ä»èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œé›†ç¾¤çš„æŸä¸€ä¸ªå®ä¾‹å½“ä¸­å¯èƒ½åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ + å¤šä¸ªä»èŠ‚ç‚¹\nä¸ºä»€ä¹ˆç”¨ é—®é¢˜ è§£å†³æ–¹æ¡ˆ å®¹é‡ä¸è¶³ æ•°æ®åˆ†ç‰‡ï¼Œå°†æ•°æ®åˆ†æ•£ä¸å­˜åˆ°ä¸åŒçš„ä¸»èŠ‚ç‚¹ é«˜å¹¶å‘å†™å…¥ æ•°æ®åˆ†ç‰‡ï¼Œå°†å†™å…¥è¯·æ±‚åˆ†æ‘Šåˆ°å¤šä¸ªä¸»èŠ‚ç‚¹ ä¸»æœºå®•æœºé—®é¢˜ è‡ªåŠ¨åˆ‡æ¢ä¸»ä»èŠ‚ç‚¹ï¼Œé¿å…å½±å“æœåŠ¡ï¼Œ ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å®¢æˆ·ç«¯é…ç½® èŠ‚ç‚¹é€šä¿¡åè®®ï¼šRedisé›†ç¾¤é‡‡ç”¨Gossipåè®®, æ”¯æŒåˆ†å¸ƒå¼ä¿¡æ¯ä¼ æ’­ã€å»¶è¿Ÿä½ã€æ•ˆç‡é«˜ã€‚é‡‡ç”¨å»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œä»»æ„å®ä¾‹(ä¸»èŠ‚ç‚¹)éƒ½å¯ä»¥ä½œä¸ºè¯·æ±‚å…¥å£ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’é€šä¿¡ã€‚ åˆ†ç‰‡åŸç†ï¼š é‡‡ç”¨å“ˆå¸Œæ§½(Hash Slot)æœºåˆ¶æ¥åˆ†é…æ•°æ®ï¼Œæ•´ä¸ªç©ºé—´å¯ä»¥åˆ’åˆ†ä¸º16384 (16 * 1024)ä¸ªæ§½ã€‚ æ¯ä¸ªRedisè´Ÿè´£ä¸€å®šèŒƒå›´çš„å“ˆå¸Œæ§½,æ•°æ®çš„keyç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—ä¹‹åå¯¹16384å–ä½™å¯å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ã€‚ ã€é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„äº¤äº’åè®®ã€‘\nä¸ºä»€ä¹ˆç”¨Gossipåè®® åˆ†å¸ƒå¼ä¿¡æ¯ä¼ æ’­ï¼šæ¯ä¸ªèŠ‚ç‚¹å®šæœŸå‘å…¶ä»–èŠ‚ç‚¹ä¼ æ’­çŠ¶æ€ä¿¡æ¯ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å¯¹é›†ç¾¤çš„çŠ¶æ€æœ‰ä¸€è‡´è§†å›¾ (é‡‡ç”¨ping å‘é€ å’Œ pong æ¥å—ï¼Œå°±åƒæ£€æŸ¥å¿ƒè·³ä¸€æ · ) ä½å»¶è¿Ÿã€é«˜æ•ˆç‡ï¼šè½»é‡çº§é€šä¿¡æ–¹å¼ï¼Œä¼ é€’ä¿¡æ¯å¾ˆå¿« å»ä¸­å¿ƒåŒ–ï¼šæ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä»»æ„å®ä¾‹(ä¸»èŠ‚ç‚¹)éƒ½å¯ä»¥ä½œä¸ºè¯·æ±‚å…¥å£ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’é€šä¿¡ã€‚ Gossipåè®®å·¥ä½œåŸç† çŠ¶æ€æŠ¥å‘Šå’Œä¿¡æ¯æ›´æ–°ï¼šç‰¹å®šæ—¶é—´é—´éš”å†…ï¼Œå‘éšæœºçš„å…¶ä»–èŠ‚ç‚¹æŠ¥å‘Šè‡ªèº«æƒ…å†µ ï¼ˆä¸»ä»å…³ç³»ã€æ§½ä½åˆ†å¸ƒï¼‰ã€‚å…¶ä»–èŠ‚ç‚¹æ¥æ”¶åˆ°ä¹‹åï¼Œä¼šç›¸åº”çš„æ›´æ–°å¯¹åº”çš„èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ èŠ‚ç‚¹æ£€æµ‹ï¼šé€šè¿‡å‘¨æœŸæ€§äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥æ£€æµ‹åˆ°å…¶ä»–èŠ‚ç‚¹çš„å­˜æ´»çŠ¶æ€ã€‚é¢„å®šæ—¶é—´å†…æœªå“åº”ï¼Œåˆ™æ ‡è®°ä¸ºæ•…éšœèŠ‚ç‚¹ã€‚ å®¹é”™å¤„ç†ï¼šå¦‚æœæŸä¸ªèŠ‚ç‚¹æ•…éšœä¹‹åï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å¯ä»¥é‡æ–°åˆ†é…æ§½ä½ï¼Œä¿æŒç³»ç»Ÿçš„å¯ç”¨æ€§ ã€å“ˆå¸Œæ§½çš„ç›¸å…³æœºåˆ¶ã€‘\nå‡å®šé›†ç¾¤ä¸­æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼ŒNode1 (0 - 5460)ã€Node2(5461-10922)ã€Node3(10923-16383)\né›†ç¾¤ä½¿ç”¨å“ˆå¸Œæ§½çš„æµç¨‹å¦‚ä¸‹ï¼š\nè®¡ç®—å“ˆå¸Œæ§½ ä½¿ç”¨CRC16å“ˆå¸Œç®—æ³•è®¡ç®—user:0001çš„CRC16çš„å€¼ å°†CRC16çš„å€¼å¯¹16384è¿›è¡Œå–ä½™ (å“ˆå¸Œæ§½ = CRC16 % 16383) å‡å¦‚CRC16ä¸º12345ï¼Œå“ˆå¸Œæ§½ = 12345 % 16383 = 12345 ç¡®å®šç›®æ ‡èŠ‚ç‚¹ ï¼šæŸ¥è¯¢åˆ°12345ä¸ºNode3çš„å­˜å‚¨çš„é”®ï¼Œå‘è¯¥èŠ‚ç‚¹å‘é€è¯·æ±‚ å½“å‰éå¯¹åº”èŠ‚ç‚¹ ï¼šå‡è®¾å½“å‰è¿æ¥çš„èŠ‚ç‚¹ä¸ºNode1ï¼ŒNode1å°†è¿”å›MOVEDé”™è¯¯åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶è®©å®¢æˆ·ç«¯æ ¹æ®MOVEDæºå¸¦çš„Node3çš„ä¿¡æ¯(ipå’Œç«¯å£)é‡æ–°è¿›è¡Œè¿æ¥ï¼Œæœ€åä»æ–°å‘é€GET user:0001è¯·æ±‚ï¼Œè·å¾—ç»“æœã€‚ 3. Redisçš„å“¨å…µæœºåˆ¶ï¼ˆSentinelï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ ã€å“¨å…µä½œç”¨ã€‘\nç›‘æ§ï¼šå“¨å…µä¸æ–­ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€,å®šæ—¶å‘é€pingè¿›è¡Œæ£€æµ‹ æ•…éšœè½¬ç§»: å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶, å“¨å…µä¼šå…ˆè¸¢å‡ºæ‰€æœ‰å¤±æ•ˆçš„èŠ‚ç‚¹, ç„¶åé€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆçš„ä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹, å¹¶é€šçŸ¥å®¢æˆ·ç«¯æ›´æ–°ä¸»èŠ‚ç‚¹çš„åœ°å€ é€šçŸ¥: å“¨å…µå¯ä»¥å‘é€æœåŠ¡å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€é€šçŸ¥ï¼Œæ–¹ä¾¿è§‚å¯ŸRediså®ä¾‹çš„çŠ¶æ€å˜åŒ–ã€‚ï¼ˆæ¯”å¦‚ä¸»èŠ‚ç‚¹gäº†ï¼Œå·²ç»æ›´æ¢ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼‰ ã€å“¨å…µæœºåˆ¶çš„ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ã€‘\nä¸»è§‚ä¸‹çº¿ï¼šå“¨å…µåœ¨ç›‘æ§çš„è¿‡ç¨‹ä¸­ï¼Œæ¯éš”1sä¼šå‘é€ ping å‘½ä»¤ç»™æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚å¦‚æœå“¨å…µè¶…è¿‡down-after-milliseconds æ‰€é…ç½®çš„æ—¶é—´ï¼Œæ²¡æœ‰æ”¶åˆ° pong çš„å“åº”ï¼Œå°±ä¼šè®¤ä¸ºèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿ã€‚\nå®¢è§‚ä¸‹çº¿ï¼šæŸä¸ªå“¨å…µå‘ç°èŠ‚ç‚¹ä¸»çº¿ä¸‹çº¿åï¼Œä¸èƒ½ç¡®è®¤èŠ‚ç‚¹æ˜¯å¦çœŸçš„ä¸‹çº¿äº†ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œä¸ç¨³å®šï¼‰ï¼Œå°±è¯¢é—®å…¶ä»–çš„å“¨å…µæ˜¯å¦ä¸»è§‚ä¸‹çº¿äº†ã€‚ç­‰å¾…å…¶ä»–å“¨å…µçš„ç¡®è®¤ï¼Œè¿›è¡ŒæŠ•ç¥¨ï¼Œå¦‚æœè¶…è¿‡åŠæ•°+1 (æ€»å“¨å…µæ•°/2 + 1)ï¼Œå°±è®¤å®šä¸ºå®¢è§‚ä¸‹çº¿ã€‚\nã€æ³¨ã€‘å®¢è§‚ä¸‹çº¿åªå¯¹ä¸»èŠ‚ç‚¹é€‚ç”¨ï¼Œå› ä¸ºä»èŠ‚ç‚¹ä¹Ÿæ²¡å¿…è¦è¿™æ ·å­åˆ¤æ–­ï¼Œgäº†å°±gäº†å‘—ã€‚\nã€å“¨å…µleaderå¦‚ä½•é€‰ä¸¾ã€‘\nå“¨å…µleaderæ˜¯é‡‡ç”¨åˆ†å¸ƒå¼ç®—æ³•rafté€‰å‡ºæ¥çš„ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\nå€™é€‰äººï¼šå½“å“¨å…µåˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™å¯ä»¥å½“é€‰å€™é€‰äºº æŠ•ç¥¨ï¼šæ¯ä¸ªå“¨å…µéƒ½å¯ä»¥æŠ•ç¥¨ï¼Œä½†æ˜¯åªèƒ½æŠ•ä¸€ç¥¨ã€‚å€™é€‰è€…ä¼šä¼˜å…ˆæŠ•ç»™è‡ªå·±ã€‚ é€‰ä¸¾ï¼šé€‰å–æŠ•ç¥¨ç»“æœåŠæ•°ä»¥ä¸Šçš„å€™é€‰äººä½œä¸ºleader (å“¨å…µä¸€èˆ¬è®¾ç½®ä¸ºå¥‡æ•°ï¼Œé˜²æ­¢å¹³ç¥¨) ã€ä¸»èŠ‚ç‚¹å¦‚ä½•é€‰ä¸¾ã€‘\nå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿ä¹‹åï¼Œä¼šè¸¢å‡ºæ‰€æœ‰ä¸‹çº¿çš„èŠ‚ç‚¹ï¼Œç„¶åä»æœ‰æ•ˆçš„ä»èŠ‚ç‚¹é€‰æ–°çš„ä¸»èŠ‚ç‚¹ã€‚é€‰å–ä¾æ®å¦‚ä¸‹ï¼š\nä¼˜å…ˆçº§ï¼šæŒ‰ç…§ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ slave-priorityï¼Œä¼˜å…ˆçº§çš„å€¼è¶Šå°è¶Šé«˜ã€‚ ä¸»ä»å¤åˆ¶offsetå€¼ï¼šå¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™åˆ¤æ–­ä¸»ä»å¤åˆ¶çš„offsetå€¼å“ªä¸€ä¸ªå¤§ï¼Œè¡¨æ˜å…¶åŒæ­¥çš„æ•°æ®è¶Šå¤šï¼Œä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚ ä»èŠ‚ç‚¹IDï¼šå¦‚æœä¸Šè¿°æ¡ä»¶å‡ç›¸åŒï¼Œåˆ™é€‰å–IDè¾ƒå°çš„ä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹ã€‚ 4. Redis Cluster é›†ç¾¤æ¨¡å¼ä¸ Sentinel å“¨å…µæ¨¡å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ Clusteré›†ç¾¤æ¨¡å¼ï¼šé›†ç¾¤æ¨¡å¼ç”¨äºå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä¸»è¦ç”¨äºè§£å†³å¤§æ•°æ®ã€é«˜ååé‡çš„åœºæ™¯ã€‚å°†æ•°æ®è‡ªåŠ¨åˆ†ä¸åˆ°å¤šä¸ªRediså®ä¾‹ä¸Šï¼Œæ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆå¦‚æœæŸä¸ªå®ä¾‹å¤±æ•ˆï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨é‡å†™é…ç½®å’Œå¹³è¡¡ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œè°ƒæ•´ï¼Œå› ä¸ºå†…ç½®äº†å“¨å…µé€»è¾‘ï¼‰ Sentinelå“¨å…µæ¨¡å¼: å“¨å…µæ¨¡å¼ç”¨äºä¿è¯ä¸»ä»èŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦»åœºæ™¯ã€‚å¦‚æœä¸»èŠ‚ç‚¹å®•æœºï¼Œå“¨å…µä¼šå°†ä»èŠ‚ç‚¹å‡ä¸ºä¸»èŠ‚ç‚¹ã€‚ 5. Redis åœ¨ç”Ÿæˆ RDB æ–‡ä»¶æ—¶å¦‚ä½•å¤„ç†è¯·æ±‚ï¼Ÿ é¦–å…ˆï¼ŒRedisç”ŸæˆRDBæ–‡ä»¶çš„æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œç”±forkå­çº¿ç¨‹è¿›è¡Œï¼Œä¸»çº¿ç¨‹ç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä¸‹é¢å…·ä½“è¯´æ˜ç”ŸæˆRDBæ–‡ä»¶çš„æµç¨‹\nã€ç”ŸæˆRDBæ–‡ä»¶åŸç†ã€‘\nä½¿ç”¨bgsaveå‘½ä»¤ï¼Œå¼€å¯forkå­çº¿ç¨‹è¿›è¡Œæ“ä½œ forkå­çº¿ç¨‹ä¼šå¤åˆ¶ä¸»çº¿ç¨‹å¯¹åº”çš„é¡µè¡¨ï¼ˆé‡Œé¢åŒ…å«äº†éœ€è¦æ“ä½œæ•°æ®çš„ç‰©ç†åœ°å€ï¼‰ å¦‚æœè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹æ¥æ”¶åˆ°å†™å‘½ä»¤ï¼Œéœ€è¦ä¿®æ”¹æ•°æ®ã€‚ä¸»çº¿ç¨‹ä¼šå°†å¯¹åº”æ•°æ®çš„æ‰€åœ¨é¡µé¢å¤åˆ¶ä¸€ä»½ï¼Œå­çº¿ç¨‹ä»ç„¶æŒ‡å‘è€çš„é¡µé¢ã€‚ï¼ˆè€çš„æ•°æ®æ‰å«æ•°æ®å¿«ç…§ï¼‰ ã€æ³¨æ„äº‹é¡¹ã€‘\nRDBå¤„ç†çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œè¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå¤§é‡çš„ç£ç›˜I/Oå’ŒCPUè´Ÿè½½ã€‚å¦‚æœRDBç”Ÿæˆçš„æ—¶é—´è¿‡é•¿ï¼Œå¹¶ä¸”Redisçš„å†™å¹¶å‘é«˜ï¼Œå°±å¯èƒ½å‡ºç°ç³»ç»ŸæŠ–åŠ¨çš„ç°è±¡ï¼Œåº”è¯¥é€‰å–Redisä½¿ç”¨é¢‘ç‡è¾ƒä½çš„æ—¶é—´æ®µç”ŸæˆRDBæ–‡ä»¶ã€‚\n[è¡¥å……] 5. Redisçš„æŒä¹…åŒ–æœºåˆ¶æœ‰å“ªäº›ï¼Ÿ Redisçš„æŒä¹…åŒ–æœºåˆ¶åˆ†ä¸ºä¸‰ç§ï¼ŒRDB ã€AOF å’Œ æ··åˆæŒä¹…åŒ–è¿™ä¸‰ç§æ–¹å¼ã€‚ä¸è¿‡ RDB å’Œ AOF å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯é‡‡ç”¨æ··åˆæŒä¹…åŒ–æœºåˆ¶ã€‚\næŒä¹…åŒ–æ–¹æ¡ˆ è¯´æ˜ ä¼˜ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ RDB æ•°æ®å¿«ç…§ å°†å†…å­˜å½“ä¸­çš„æ•°æ®å®šæœŸä¿å­˜ä¸ºdump.rdbï¼Œ è®°å½•æŸä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§ æ–‡ä»¶å°ï¼Œæ€§èƒ½é«˜ï¼Œæ¢å¤å¿«ã€‚ä½†æ˜¯æ•°æ®ä¸¢å¤±é£é™©é«˜ï¼Œforkä¼šé˜»å¡ä¸»è¿›ç¨‹ã€‚ é€‚åˆä½é¢‘å¤‡ä»½çš„åœºæ™¯ï¼Œæ¯”å¦‚å†·å¤‡ä»½ï¼Œç¾éš¾æ¢å¤ï¼Œå…¨é‡æ•°æ®åŠ è½½(ä¸»ä»å¤åˆ¶) AOF è¿½åŠ æ—¥å¿— å°†æ¯ä¸ªå†™æ“ä½œè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶appendonly.aofï¼Œ é€šè¿‡é‡æ”¾æ—¥å¿—æ–‡ä»¶æ¢å¤æ•°æ® æ•°æ®æ›´å®‰å…¨ï¼Œæ–‡ä»¶å¯è¯»æ€§å¼ºã€‚ä½†æ˜¯æ–‡ä»¶ä½“ç§¯å¤§ï¼Œæ¢å¤é€Ÿåº¦æ…¢ï¼Œæ€§èƒ½å¼€é”€å¤§ é€‚åˆå¯¹æŒä¹…åŒ–å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚é‡‘èäº¤æ˜“ï¼Œç”¨æˆ·æ•°æ®ä¿å­˜ç­‰ã€‚ æ··åˆæŒä¹…åŒ– ç»“åˆRDB å’Œ AOF çš„ä¼˜ç‚¹ï¼Œå…ˆç”ŸæˆRDBå¿«ç…§æ–‡ä»¶ï¼Œå†è®°å½•å¿«ç…§ä¹‹åçš„å†™æ“ä½œåˆ°æ—¥å¿—æ–‡ä»¶å½“ä¸­ã€‚ é€‚åˆéœ€è¦å¿«é€Ÿæ¢å¤ä¸”å°½é‡ä¿è¯å‡å°‘æ•°æ®ä¸¢å¤±çš„åœºæ™¯ï¼Œä¸€èˆ¬ç”¨äºç”Ÿäº§ç¯å¢ƒ ä¸‹é¢å…·ä½“è¯´ä¸€ä¸‹ä¸åŒæŒä¹…åŒ–æœºåˆ¶çš„æ‰§è¡Œè¿‡ç¨‹\nã€RDB æŒä¹…åŒ–ã€‘\nå®šæ—¶ç”Ÿæˆ RDBï¼šRediså®šæœŸæ ¹æ®é…ç½®è§¦å‘ RDB å¿«ç…§ ï¼ˆæˆ–è€…ä¸»åŠ¨ç”¨bgsaveå‘½ä»¤æ‰‹åŠ¨è§¦å‘ï¼‰ fork å­è¿›ç¨‹ï¼š ä¸»è¿›ç¨‹åˆ¤æ–­æ˜¯å¦æœ‰æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™ fork åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ç”¨äºæŒä¹…åŒ–æ•°æ® ï¼ˆfork çš„è¿‡ç¨‹ï¼Œä¸»è¿›ç¨‹æ˜¯é˜»å¡ç­‰å¾…çš„ï¼‰ å­è¿›ç¨‹æ›´æ–°RDBæ–‡ä»¶ï¼š å­è¿›ç¨‹å°†æ•°æ®å¼‚æ­¥å†™å…¥ä¸´æ—¶ RDB æ–‡ä»¶ï¼Œå®Œæˆåæ›¿æ¢æ—§çš„ RDB æ–‡ä»¶ã€‚åŒæ—¶å‘ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ›´æ–°ä¸€ä¸‹ RDB æ•°æ®å¿«ç…§çš„ç»Ÿè®¡æ¶ˆæ¯ ã€æ³¨æ„ã€‘ é‡‡ç”¨bgsave è€Œ ä¸é‡‡ç”¨save å‘½ä»¤çš„åŸå› æ˜¯ï¼Œsave å‘½ä»¤åœ¨ç”Ÿæˆ RDBæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé˜»å¡Redisæ‰§è¡Œå…¶ä»–æ“ä½œã€‚\né‚£ä¹ˆå­è¿›ç¨‹åœ¨ç”ŸæˆRDBä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯å¯¹Rediså‘èµ·æ–°çš„å†™æ“ä½œã€‚RedisåŒæ ·å¯ä»¥å¤„ç†è¿™äº›å‘½ä»¤, è¿™ç§æ–¹å¼å°±æ˜¯å†™æ—¶å¤åˆ¶æŠ€æœ¯ã€‚\nã€å†™æ—¶å¤åˆ¶æŠ€æœ¯ã€‘\nRedisåœ¨æ‰§è¡Œbgsaveå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡fork åˆ›å»ºå­è¿›ç¨‹ã€‚ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œçˆ¶å­è¿›ç¨‹æ˜¯å…±äº«åŒä¸€ç‰‡å†…å­˜æ•°æ®çš„ã€‚åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„ä¹Ÿè¡¨ï¼Œä½†æ˜¯é¡µè¡¨æŒ‡å‘çš„ç‰©ç†å†…å­˜è¿˜æ˜¯åŒä¸€ä¸ªã€‚å½“å®¢æˆ·ç«¯å‘Rediså‘èµ·æ–°çš„å†™æ“ä½œæ—¶ï¼Œç‰©ç†å†…å­˜ä¼šè¢«å¤åˆ¶ä¸€ä»½ã€‚å­è¿›ç¨‹ä»ç„¶æŒ‡å‘ä¹‹å‰çš„å†…å­˜åœ°å€ (æ•°æ®å¿«ç…§)ï¼Œä¸»è¿›ç¨‹æŒ‡å‘å¤åˆ¶çš„ç‰©ç†å†…å­˜åœ°å€ï¼Œå¹¶å®Œæˆå†™æ“ä½œã€‚\nã€ä¼˜ç¼ºç‚¹ã€‘\nä¼˜ç‚¹ï¼šå†™æ—¶å¤åˆ¶æŠ€æœ¯å¯ä»¥å‡å°‘å­è¿›ç¨‹çš„å†…å­˜æ¶ˆè€—ï¼ŒåŠ å¿«åˆ›å»ºé€Ÿåº¦(fork å­è¿›ç¨‹ï¼Œä¼šé˜»å¡çˆ¶è¿›ç¨‹)ã€‚ç”±äºå­è¿›ç¨‹å…±äº«å†…å­˜å½“ä¸­çš„æ•°æ®ï¼Œåˆ›å»ºåå¯ä»¥ç›´æ¥è¯»å–ä¸»è¿›ç¨‹ä¸­çš„å†…å­˜åšæ•°æ®ï¼Œç„¶åæŠŠæ•°æ®å†™å…¥RDBæ–‡ä»¶ã€‚ ç¼ºç‚¹ï¼šå®¢æˆ·ç«¯åœ¨å†™æ—¶å¤åˆ¶æ“ä½œçš„æ—¶å€™ï¼Œä¸ä¼šæŠŠæ–°çš„æ•°æ®è®°å½•åˆ°RDBæ–‡ä»¶ä¸­ã€‚å¦‚æœRedisåœ¨ç”ŸæˆRDBæ–‡ä»¶åï¼Œé©¬ä¸Šå®•æœºï¼Œé‚£ä¹ˆä¸»è¿›ç¨‹æ–°å†™å…¥çš„è¿™äº›æ•°æ®éƒ½ä¸¢å¤±äº†ã€‚å¦å¤–ï¼Œå¦‚æœæ•°æ®è¢«ä¿®æ”¹ï¼Œæ¯æ¬¡å¤åˆ¶çš„è¿‡ç¨‹éƒ½ä¼šåˆ¶é€ ä¸¤ä»½å†…å­˜ï¼Œå†…å­˜å ç”¨å°±æ˜¯ä¹‹å‰çš„ä¸¤å€äº†ã€‚ ã€AOF æ—¥å¿—æ–‡ä»¶ç”Ÿæˆè¿‡ç¨‹ã€‘\nAOF æ˜¯é€šè¿‡æŠŠRedisçš„æ¯ä¸ªå†™æ“ä½œè¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ appendonly.aof å®ç°æŒä¹…åŒ–çš„æ–¹å¼ã€‚Redisæ¯æ¬¡é‡å¯æ—¶,ä¼šé‡æ”¾æ—¥å¿—æ–‡ä»¶çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚å£è¯€ï¼šå…ˆå†™å†…å­˜ï¼Œå†å†™æ—¥å¿—ï¼Œ è¿‡å¤§é‡å†™ã€‚\nå…ˆå†™å†…å­˜ï¼šæ¯æ¬¡å†™æ“ä½œéƒ½ä¼šè¢«å†™å…¥å†…å­˜çš„AOFç¼“å†²å½“ä¸­ å†å†™æ—¥å¿—ï¼šç„¶åä»AOF ç¼“å†²ä¸­åŒæ­¥åˆ°ç£ç›˜ (ä¸‰ç§å†™å›ç­–ç•¥) è¿‡å¤§é‡å†™ï¼šå½“AOF æ–‡ä»¶è¿‡å¤§çš„æ—¶å€™ï¼ŒRedisä¼šè§¦å‘AOF é‡å†™ï¼Œå°†å†—ä½™å‘½ä»¤åˆå¹¶ï¼Œç”Ÿæˆæ–°çš„AOF æ–‡ä»¶ ã€æ³¨æ„ã€‘ å…ˆå†™å†…å­˜ï¼Œå†å­˜æ—¥å¿—å¯ä»¥é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€ (åªå­˜æ‰§è¡ŒæˆåŠŸçš„æŒ‡ä»¤)ï¼Œè€Œä¸”ä¸ä¼šé˜»å¡å½“å‰æ“ä½œï¼ŒæŒ‡ä»¤åªæƒ³æˆåŠŸåï¼Œæ‰å°†å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—æ–‡ä»¶ã€‚ä½†æ˜¯å¦‚æœè¿˜æ²¡å†™å®ŒAOF æ–‡ä»¶å°±å®•æœºäº†ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ‰§è¡Œå†™å‘½ä»¤å’Œè®°å½•åˆ°æ—¥å¿—éƒ½æ˜¯ä¸»çº¿ç¨‹æ“ä½œï¼Œå¯èƒ½ä¼šé€ æˆé˜»å¡é£é™©ã€‚\nå†™ä¼šç­–ç•¥é…ç½® å†™å›æ—¶æœº ä½œç”¨ always åŒæ­¥å†™å› æ¯æ¬¡éƒ½fsync åŒæ­¥æ•°æ®åˆ°ç£ç›˜ï¼Œæ€§èƒ½æœ€ä½ã€‚å¦‚æœå†™å…¥AOFæ–‡ä»¶æœŸé—´Rediså®•æœºï¼Œåˆ™æ— æ³•é€šè¿‡AOF è¿›è¡Œæ¢å¤ everysec æ¯ç§’å†™å› æ¯ç§’è°ƒç”¨ä¸€æ¬¡fsyncå†™å›ç£ç›˜ï¼Œå®‰å…¨å’Œæ€§èƒ½å±…ä¸­ï¼ŒRedisæœ€å¤šä¸¢1sçš„æ•°æ® no æ“ä½œç³»ç»Ÿå†³å®šå†™å›æ—¶é—´ æ€§èƒ½é«˜ï¼Œå®‰å…¨æ€§ä½ ã€AOFé‡å†™æœºåˆ¶ã€‘ å½“Redisæ£€æµ‹åˆ°AOF æ–‡ä»¶è¿‡å¤§çš„æ—¶å€™ï¼Œä¼šè§¦å‘AOF é‡å†™æœºåˆ¶\nåˆ›å»ºå­è¿›ç¨‹ï¼šRedisé€šè¿‡BGREWRITEAOFå‘½ä»¤åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒAOF é‡å†™ ç”Ÿæˆæ–°AOF æ–‡ä»¶ï¼šå­è¿›ç¨‹åŸºäºå½“å‰æ•°æ®åº“çŠ¶æ€ï¼Œå°†æ¯ä¸ªé”®çš„æœ€æ–°å€¼è½¬æ¢ä¸ºå†™å‘½ä»¤ï¼Œå¹¶å†™å…¥AOFæ–‡ä»¶ å¤„ç†æ–°å†™å…¥çš„å‘½ä»¤ï¼šé‡å†™æœŸé—´ï¼ŒæŠŠå®¢æˆ·ç«¯æ–°çš„å†™æ“ä½œåŒæ—¶è¿½åŠ åˆ°ç°æœ‰çš„AOFæ–‡ä»¶å’Œç¼“å­˜åŒºçš„AOFé‡å†™ç¼“å†²é‡Œé¢ åˆå¹¶æ–°çš„å†™å…¥æŒ‡ä»¤ï¼šå­è¿›ç¨‹å®ŒæˆAOFæ–‡ä»¶é‡å†™ä¹‹åï¼Œéœ€è¦ç¡®ä¿AOFæ–‡ä»¶å½“ä¸­çš„å†™æ“ä½œéƒ½æ˜¯æœ€æ–°çš„ã€‚ æ›¿æ¢æ—§çš„AOF æ–‡ä»¶ï¼š æœ€åç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ—§çš„AOFæ–‡ä»¶ **ã€MP-AOFã€‘**Redis 7.0 é‡‡ç”¨ Multi-Part Append Only File è§£å†³ AOF å½“ä¸­çš„å†…å­˜å¼€é”€å¤§(AOF ç¼“å­˜å’ŒAOF é‡å†™ç¼“å­˜åŒ…å«å¤§é‡é‡å¤æ•°æ®)ã€CPUå¼€é”€å¤§(ä¸»è¿›ç¨‹éœ€è¦è€—æ—¶å°†æ•°æ®å†™å…¥AOF é‡å†™ç¼“å­˜ï¼Œç„¶åä¼ ç»™å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è¦è€—æ—¶æŠŠAOF é‡å†™ç¼“å­˜å†™å…¥æ–°çš„AOF æ–‡ä»¶)ã€ç£ç›˜å¼€é”€å¤§(åŒä¸€ä»½æ•°æ®ä¼šè¢«å†™å…¥ä¸¤æ¬¡ï¼Œä¸€æ¬¡å†™å…¥å½“å‰AOFæ–‡ä»¶ï¼Œå¦ä¸€æ¬¡å†™å…¥æ–°AOF æ–‡ä»¶)ã€‚å…¶å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå°†ä¸€ä¸ªAOFæ–‡ä»¶æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶\nä¸€ä¸ªåŸºç¡€æ–‡ä»¶ basefile, ä»£è¡¨æ•°æ®çš„åˆå§‹å¿«ç…§ ä¸€ä¸ªå¢é‡æ–‡ä»¶ incremental filesï¼Œè®°å½•è‡ªåŸºç¡€æ–‡ä»¶åˆ›å»ºä»¥æ¥çš„æ‰€æœ‰å†™æ“ä½œï¼Œ å¯ä»¥æœ‰å¤šä¸ªè¯¥æ–‡ä»¶ åŸºç¡€æ–‡ä»¶å’Œå¢é‡æ–‡ä¼šæ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”ç”±ä¸€ä¸ªæ¸…å•æ–‡ä»¶ manifest file è¿›è¡Œç»Ÿä¸€è·Ÿè¸ªå’Œç®¡ç† è¯¥æ–¹æ¡ˆå¯ä»¥é¿å…å†™å…¥å¤šä¸ªå’ŒAOFç›¸å…³çš„ç¼“å­˜ï¼Œå­è¿›ç¨‹ç‹¬ç«‹å†™åŸºç¡€AOFæ–‡ä»¶ï¼Œè¿›ç¨‹ä¹‹é—´æ— äº¤äº’ï¼Œä¸ç”¨åˆ‡æ¢ä¸Šä¸‹æ–‡ã€‚\nã€ä¸ºä»€ä¹ˆRediséœ€è¦æŒä¹…åŒ–ã€‘ Redisæ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œé¢ã€‚å¦‚æœRediså‘ç”Ÿäº†å®•æœºäº‹ä»¶ï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨ï¼ŒRedisé‡‡ç”¨æŒä¹…åŒ–æœºåˆ¶ï¼Œè®©æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œæ–¹ä¾¿å®•æœºåè¿›è¡Œæ¢å¤ã€‚å¦‚æœæ²¡æœ‰æŒä¹…åŒ–æœºåˆ¶ï¼ŒRediséœ€è¦ä»æ•°æ®åº“(MySQL)å½“ä¸­æ¢å¤æ•°æ®, å¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„é—®é¢˜ï¼š\n**æ€§èƒ½ç“¶é¢ˆ + æ¢å¤ç¼“æ…¢ **ï¼šåç«¯æ•°æ®åº“æ— æ³•å‘Redisä¸€æ ·å¿«é€Ÿæä¾›æ•°æ®ã€‚å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ¢å¤å°±ä¼šå˜å¾—éå¸¸ç¼“æ…¢ã€‚ ç³»ç»Ÿå‹åŠ›ï¼šæ¢å¤çš„è¿‡ç¨‹æ¯”è¾ƒä¹…ï¼Œå°±ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå½±å“å…¶ä»–çš„ä¸šåŠ¡ã€‚ 6. Redisé›†ç¾¤ä¼šå‡ºç°è„‘è£‚é—®é¢˜å—ï¼Ÿ è„‘è£‚å®šä¹‰: åœ¨ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ï¼ŒRedisåŒä¸€ä¸ªé›†ç¾¤çš„å®ä¾‹å½“ä¸­å‡ºç°å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚\nè„‘è£‚å‘ç”Ÿçš„åŸå› ï¼šæ¯”å¦‚å½“å‰é›†ç¾¤å®ä¾‹æ˜¯ä¸€ä¸»+ä¸¤ä»çš„æ¨¡å¼ï¼Œå½“ç½‘ç»œå‘é€åˆ†åŒºï¼Œåˆ†ä¸ºAåŒºå’ŒBåŒºã€‚ä¸»èŠ‚ç‚¹(åŸ)è¢«åˆ†åˆ°AåŒº,å…¶ä»–èŠ‚ç‚¹å’Œå“¨å…µé›†ç¾¤éƒ½åœ¨BåŒºã€‚å“¨å…µæœºåˆ¶æ— æ³•æ£€æµ‹åˆ°AåŒºçš„åŸä¸»èŠ‚ç‚¹, åªèƒ½é‡æ–°é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹(æ–°)ã€‚æ­¤æ—¶ï¼Œé›†ç¾¤å½“ä¸­å°±æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼ŒAåŒºçš„ä¸»èŠ‚ç‚¹(åŸ)è¢«å†™å…¥çš„æ–°æ•°æ®ä¸ä¼šåŒæ­¥åˆ°BåŒºçš„èŠ‚ç‚¹ä¸Šã€‚ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\nå¦‚ä½•é¿å…è„‘è£‚ï¼šmin-slaves-to-write ä¸»èŠ‚ç‚¹å†™æ“ä½œæ‰€è¦æ±‚æœ‰æ•ˆä»èŠ‚ç‚¹ä¸ªæ•°ã€min-slaves-max-lag ä»èŠ‚ç‚¹çš„æœ€å¤§å»¶è¿Ÿã€‚æ¯”å¦‚ min-slaves-to-write = 3 å’Œmin-slaves-max-lag = 10 è¡¨æ˜éœ€è¦è‡³å°‘3ä¸ªå»¶æ—¶ä½äº10sçš„ä»èŠ‚ç‚¹æ‰å¯ä»¥æ¥å—å†™æ“ä½œã€‚\nã€æ³¨æ„ã€‘è„‘è£‚å¹¶ä¸èƒ½å¤Ÿå®Œå…¨é¿å…ï¼Œæ¯”å¦‚è¯´åœ¨é€‰ä¸¾ä¸»èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹(åŸ)çªç„¶æ¢å¤äº†ï¼Œç„¶åå‘ç°ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„å»¶è¿Ÿéƒ½ä¸è¶…è¿‡10sï¼Œå®¢æˆ·ç«¯æ­£å¸¸åœ¨ä¸»èŠ‚ç‚¹(åŸ)è¿›è¡Œå†™æ“ä½œã€‚ç­‰é€‰ä¸¾å®Œæ¯•ï¼Œé€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè®©ä¸»èŠ‚ç‚¹(åŸ) slaveof ä¸ºä»èŠ‚ç‚¹ã€‚é€‰ä¸¾æ—¶é—´å†™å…¥çš„æ•°æ®ä¼šè¢«è¦†ç›–ï¼Œå°±å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ã€‚\n7. Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ åˆ†å¸ƒå¼é”åŸç†ï¼šRedisåˆ†å¸ƒå¼é”ç”±set ex nx å’Œ lua è„šæœ¬ç»„æˆï¼Œåˆ†åˆ«å¯¹åº”åŠ é”å’Œè§£é”æ“ä½œ\nä¸ºä»€ä¹ˆç”¨ set ex nxï¼šæŸä¸ªè¿›ç¨‹å¯¹æŒ‡å®škeyæ‰§è¡Œ set nx ä¹‹åï¼Œ è¿”å›å€¼ä¸º1ï¼Œå…¶ä»–è¿›ç¨‹æƒ³è¦å¯¹ç›¸åŒçš„keyè·å–é”ï¼Œä¼šå‘ç°keyå·²å­˜åœ¨ï¼Œè¿”å›å€¼ä¸º0ã€‚è¿™æ ·å°±æ˜¯å®ç°äº†ä¸Šé”çš„æ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœAè¿›ç¨‹ä¸Šå®Œé”çªç„¶æŒ‚äº†ï¼Œå…¶ä»–è¿›ç¨‹å°±æ°¸è¿œä¸å¯èƒ½æ‹¿åˆ°é”ã€‚æ‰€ä»¥ï¼Œè®¾ç½®ä¸€ä¸ªexè¿‡æœŸæ—¶é—´ï¼Œè®©å…¶ä¸è¦ä¸€ç›´å ç”¨ç€é”ã€‚\nã€æ³¨æ„ã€‘set ex nxè®¾ç½®valueçš„æ—¶å€™ï¼Œå¿…é¡»é‡‡ç”¨å”¯ä¸€å€¼ï¼Œæ¯”å¦‚uuidã€‚ ä¸ç„¶å¯èƒ½å‡ºç°å¦‚ä¸‹æƒ…å†µ:\nAè¿›ç¨‹æ­£å¸¸ç”³è¯·é”ï¼Œå€¼è®¾ä¸º1ã€‚ Aè¿›ç¨‹ä¸Šé”å, æ‰§è¡Œè¿‡ç¨‹æ—¶é—´æ¯”è¾ƒé•¿, ä»¥è‡³äºé”å·²ç»è¿‡æœŸäº†, Aè¿›ç¨‹è¿˜æ²¡æ‰§è¡Œå®Œ. æ­¤æ—¶ï¼ŒBè¿›ç¨‹ç”³è¯·é”ï¼Œå€¼ä¹Ÿè®¾ä¸º1. åŒæ—¶ï¼ŒAè¿›ç¨‹æ‰§è¡Œå®Œæ¯•, ä½¿ç”¨luaè„šæœ¬æŠŠé”åˆ é™¤äº† Bè¿›ç¨‹æ­¤æ—¶è¿˜åœ¨æ‰§è¡Œç¨‹åºï¼Œä¸€è„¸æ‡µé€¼ã€‚ï¼ˆä¸æ˜¯ï¼Œå“¥ä»¬å„¿ï¼Œæˆ‘é”å‘¢ï¼Ÿè°å·äº†æˆ‘çš„é”ï¼ï¼ï¼ï¼‰ ä¸ºä»€ä¹ˆç”¨ lua è¿›è¡Œè§£é”ï¼šå¦‚ä¸Šè¿°æ³¨æ„äº‹é¡¹æ‰€è¯´çš„ä¸€æ ·ï¼ŒAè¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹å, ä¼šåˆ é™¤é”. å‡å¦‚ä»–ä»¬çš„å€¼éƒ½é‡‡ç”¨äº†uuidä¿è¯äº†å”¯ä¸€æ€§ã€‚å¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ\nAè¿›ç¨‹å…ˆåˆ¤æ–­keyå’Œå…¶å€¼æ˜¯å¦ä¸ºå¯¹åº”çš„uuidï¼Œç„¶åå†åˆ é™¤é”. Aè¿›ç¨‹å‡†å¤‡åˆ é™¤é”ä¹‹å‰, é”è¿‡æœŸäº†. Bè¿›ç¨‹åŒæ—¶è·å–äº†é” Aè¿›ç¨‹å†åˆ é™¤äº†è¯¥é” (Bè¿›ç¨‹ç”³è¯·çš„é”)ï¼Œå‘ç”Ÿäº†è¯¯åˆ çš„ç°è±¡ æ‰€ä»¥éœ€è¦ç”¨luaè„šæœ¬ä¿è¯è§£é”çš„åŸå­æ€§ï¼Œå°±å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜\n8. Redisçš„Red Lockæ˜¯ä»€ä¹ˆï¼Ÿä½ äº†è§£å—? Red Lockå®šä¹‰: ä¸€ç§åˆ†å¸ƒå¼é”çš„å®ç°æ–¹æ¡ˆï¼Œä¸»è¦ç”¨äºè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä½¿ç”¨Redisåˆ†å¸ƒå¼é”çš„å®‰å…¨æ€§é—®é¢˜ ä¸ºä»€ä¹ˆç”¨Red Lock: å‡å¦‚æˆ‘ä»¬é‡‡ç”¨ä¸€ä¸»+ä¸¤ä»+å“¨å…µæ–¹å¼éƒ¨ç½²Redisï¼Œå¦‚æœæœ‰Aè¿›ç¨‹åœ¨ä½¿ç”¨åˆ†å¸ƒå¼é”çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸»èŠ‚ç‚¹å‘é€äº†ä¸»ä»æ›´æ¢ï¼Œä½†æ˜¯åŸä¸»èŠ‚ç‚¹çš„é”ä¿¡æ¯ä¸ä¸€å®šåŒæ­¥åˆ°æ–°ä¸»èŠ‚ç‚¹ä¸Šã€‚æ‰€ä»¥å½“å‰æ–°ä¸»èŠ‚ç‚¹å¯èƒ½æ²¡æœ‰é”ä¿¡æ¯ï¼Œæ­¤æ—¶å¦å¤–çš„Bè¿›ç¨‹å»è·å–é”ï¼Œå‘ç°é”æ²¡è¢«å ï¼ŒæˆåŠŸæ‹¿åˆ°é”å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚æ­¤æ—¶ä¸¤ä¸ªç«äº‰è€…ï¼ˆAå’ŒBè¿›ç¨‹ï¼‰ä¼šåŒæ—¶æ“ä½œä¸´ç•Œèµ„æºï¼Œä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ Red Lockå®ç°åŸç† : å‡å¦‚å½“å‰æœ‰äº”ä¸ªå®ä¾‹ï¼Œä¸éœ€è¦éƒ¨ç½²ä»èŠ‚ç‚¹å’Œå“¨å…µï¼Œåªéœ€è¦ä¸»èŠ‚ç‚¹ã€‚æ³¨æ„å½“å‰çš„äº”ä¸ªå®ä¾‹ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä¸è¿›è¡Œä»»ä½•çš„ä¿¡æ¯äº¤äº’ (ä¸åŒäºRedis Clusteré›†ç¾¤æ¨¡å¼)ã€‚å¯¹äº”ä¸ªå®ä¾‹ä¾æ¬¡ç”³è¯·ä¸Šé”ï¼Œå¦‚æœæœ€ç»ˆç”³è¯·æˆåŠŸçš„æ•°é‡è¶…è¿‡åŠæ•°(å¤§äºæ€»æ•°/2 + 1)ï¼Œåˆ™è¡¨æ˜çº¢é”ç”³è¯·æˆåŠŸã€‚æŒ‰ç…§ä¸‹é¢çš„æµç¨‹è¿›è¡Œæ“ä½œï¼š å®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´ t1 å®¢æˆ·ç«¯ä¾æ¬¡å¯¹äº”ä¸ªå®ä¾‹è¿›è¡Œset ex nx æ“ä½œï¼Œé”çš„è¿‡æœŸæ—¶é—´ä¸º t_lock (è¿œå°äºé”çš„æ€»è¿‡æœŸäº‹ä»¶)ã€‚å¦‚æœå½“å‰èŠ‚ç‚¹è¯·æ±‚è¶…æ—¶ï¼Œåˆ™ç«‹é©¬è¯·æ±‚ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å½“è·å–çš„é”è¶…è¿‡åŠæ•°ï¼Œåˆ™è·å–å½“å‰çš„æ—¶é—´ t2ã€‚è·å–é”çš„è¿‡ç¨‹æ€»è€—æ—¶t = t2 - t1ã€‚å¦‚æœtå°äºé”çš„è¿‡æœŸæ—¶é—´ t_lockï¼Œåˆ™å¯ä»¥åˆ¤æ–­ä¸ºåŠ é”æˆåŠŸï¼Œå¦åˆ™åŠ é”å¤±è´¥ã€‚ åŠ é”æˆåŠŸï¼Œåˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚è‹¥åŠ é”å¤±è´¥ï¼Œåˆ™ä¾æ¬¡é‡Šæ”¾æ‰€æœ‰èŠ‚ç‚¹çš„é”ã€‚ Red Lockæ˜¯å¦å®‰å…¨ï¼šå…ˆè¯´ç»“è®ºï¼Œä¸ä¸€å®šå®‰å…¨\nå½“å‰æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯(Client1 å’Œ Client2)ï¼Œé¦–å…ˆClient1 æ­£å¸¸è·å–é”ï¼Œç„¶åçªç„¶è¢«GCæ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶äº†ã€‚åœ¨GCçš„è¿‡ç¨‹å½“ä¸­ï¼ŒClient1 çš„é”è¶…æ—¶é‡Šæ”¾äº†ï¼ŒClient2å¼€å§‹ç”³è¯·å¹¶è·å¾—é”ã€‚ç„¶åClient2 å†™å…¥æ•°æ®å¹¶é‡Šæ”¾é”ã€‚ åé¢Client1 åœ¨GC ç»“æŸä¹‹ååˆå†™å…¥æ•°æ®ï¼Œ æ­¤æ—¶å°±å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n9. è¯´è¯´ Redisson åˆ†å¸ƒå¼é”çš„åŸç†? ã€Redissonåˆ†å¸ƒå¼é”å®šä¹‰ã€‘\nRedissonåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨Redisçš„åŸå­æ€§æ“ä½œæ¥ç¡®ä¿å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹æˆ–å¤šèŠ‚ç‚¹ç³»ç»Ÿä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å¾—é”ã€‚é¿å…å¹¶å‘æ“ä½œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚\nä¸»è¦å¯ä»¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†æ¥è®²ï¼šé”çš„è·å–ã€é”çš„ç»­æœŸã€å¯é‡å…¥é”ã€é”çš„é‡Šæ”¾\nã€é”çš„è·å–ã€‘\næ‰§è¡Œ exist ï¼Œåˆ¤æ–­é”æ˜¯å¦å­˜åœ¨ è‹¥å­˜åœ¨ ï¼Œåˆ¤æ–­å”¯ä¸€æ ‡è¯†æ˜¯å¦å¯¹åº”ã€‚è‹¥å”¯ä¸€æ ‡è¯†ç›¸åŒ -\u0026gt; ç¬¬ 3 æ­¥ ; è‹¥ä¸åŒï¼Œè¯´æ˜å½“å‰é”åˆ«å…¶ä»–è¿›ç¨‹å ç”¨ -\u0026gt; ç¬¬2 æ­¥ è‹¥ä¸å­˜åœ¨ ï¼Œç›´æ¥ tryLock() ä¸Šé” -\u0026gt; ç¬¬ 3 æ­¥ ä½¿ç”¨pttlæŸ¥è¯¢é”å‰©ä½™çš„è¿‡æœŸæ—¶é—´ï¼Œåç»­å¯ä»¥å†æ¬¡è·å– æ‰§è¡Œhincrbyï¼Œè®¾ç½®é‡å…¥è®¡æ•°ä¸º1 ï¼ˆå¯é‡å…¥é”æ‰æœ‰è¿™ä¸€æ­¥æ“ä½œï¼‰ æ‰§è¡Œpexpireï¼Œ è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ ï¼ˆä¸ºäº†é˜²æ­¢ä»»åŠ¡è¿˜æ²¡æ‰§è¡Œå®Œï¼Œé”å°±è¿‡æœŸäº†ã€‚Redissonå®ç°äº†ç”¨çœ‹é—¨ç‹—æœºåˆ¶æ¥ä¸ºé”è¿›è¡Œè‡ªåŠ¨ç»­æœŸï¼‰ ã€å¯é‡å…¥é”ã€‘\nä¸€èˆ¬æ˜¯åœ¨çº¿ç¨‹å·²ç»è·å–é”çš„åŸºç¡€ä¸Šï¼Œä¸ºäº†åç»­è¿˜èƒ½æ‹¿åˆ°é”ã€‚å› ä¸ºå‡å¦‚increment()å’ŒanotherMethodéƒ½éœ€è¦ç”¨åˆ°Counteré”ã€‚å½“increment()æ‹¿åˆ°é”ä¹‹åï¼Œåˆè°ƒç”¨anotherMethod()åˆéœ€è¦è·å–é”ã€‚å¦‚æœä¸èƒ½äºŒæ¬¡è·å–é”ï¼Œé‚£å°±é™·å…¥æ­»é”äº†ã€‚æ‰€ä»¥ï¼ŒRedissonæ‰æäº†å¯é‡å…¥é”\npublic class Counter { private int count = 0; public synchronized void increment() { count++; anotherMethod(); } public synchronized void anotherMethod() { // å¯ä»¥å†æ¬¡è·å–ç›¸åŒçš„é” count++; } } å¯é‡å…¥é”æ˜¯åœ¨è·å–é”çš„åŸºç¡€ä¸Šï¼Œå¤šäº†ä¸€å±‚é€»è¾‘ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š\nå®ç°é”çš„è·å–çš„æ‰€æœ‰åŠŸèƒ½ æ‰§è¡Œhexist åˆ¤æ–­æ˜¯å¦é”å·²ç»å­˜åœ¨ï¼Œä¸”å”¯ä¸€æ ‡è¯†åŒ¹é…(çº¿ç¨‹idç›¸å…³)ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ç”¨existåˆ¤æ–­é”æ˜¯å¦å­˜åœ¨ å¦‚æœè‡ªå·±çš„é”å­˜åœ¨ï¼Œç”¨hincrbyæŠŠé‡å…¥æ¬¡æ•°åŠ ä¸€ ç”¨pexpireï¼Œè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ å¦‚æœæ²¡æœ‰è·å–æˆåŠŸé”ï¼Œå°±å’Œä¸Šé¢ä¸€æ ·ï¼Œç”¨pttlæŸ¥è¯¢é”çš„è¿‡æœŸå‰©ä½™æ—¶é—´ ã€é”çš„é‡Šæ”¾ã€‘\nç”¨hexiståˆ¤æ–­çº¿ç¨‹è‡ªå·±çš„é”æ˜¯å¦å­˜åœ¨ï¼Œéœ€è¦åˆ¤æ–­å”¯ä¸€æ ‡è¯† å¦‚æœå­˜åœ¨ -\u0026gt; ç¬¬2æ­¥ å¦‚æœä¸å­˜åœ¨ -\u0026gt; ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦åšè§£é”æ“ä½œï¼Œå› ä¸ºæ˜¯åˆ«äººçš„é” ç”¨hincryå‡å°‘ä¸€æ¬¡é”çš„å¯é‡å…¥æ¬¡æ•° (å¢åŠ -1 å°±æ˜¯å‡å°‘ä¸€æ¬¡) åˆ¤æ–­é”çš„å¯é‡å…¥æ¬¡æ•°æ˜¯å¦å¤§äº 0 å¦‚æœå¤§äº 0ï¼Œ è¯´æ˜è¿˜æœ‰å‡½æ•°åœ¨ä½¿ç”¨è¿™ä¸ªé”ï¼Œåˆ™é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ å¦‚æœç­‰äº 0 -\u0026gt; ç¬¬4æ­¥ ç”¨ del åˆ é™¤å¯¹åº”çš„key ç”¨ publish å¹¿æ’­é€šçŸ¥å…¶ä»–ç­‰å¾…é”çš„è¿›ç¨‹ï¼Œæ­¤æ—¶é‡Šæ”¾é”äº† ã€Redissoné”çš„ç±»å‹ã€‘\nå…¬å¹³é”ï¼šå’Œå¯é‡å…¥é”ç±»ä¼¼ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹æŒ‰è¯·æ±‚é¡ºåºè·å¾—é” è¯»å†™é”: æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—è¯»é”ï¼Œè€Œä¸”é”æ˜¯ç‹¬å çš„ ä¿¡å·é‡ä¸å¯æ•°é”: å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰é”ï¼Œé€‚ç”¨äºèµ„æºçš„é™æµå’Œæ§åˆ¶ã€‚ 10. Redisson çœ‹é—¨ç‹—ï¼ˆwatch dogï¼‰æœºåˆ¶äº†è§£å—ï¼Ÿ ã€ä¸ºä»€ä¹ˆç”¨çœ‹é—¨ç‹—æœºåˆ¶ã€‘\nå› ä¸ºå¦‚æœè¿›ç¨‹è·å–é”ä¹‹åï¼Œç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œé”å°±è¿‡æœŸäº†ã€‚æ­¤æ—¶ï¼Œå…¶ä»–è¿›ç¨‹æŠ¢å ä¸´ç•Œèµ„æºï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nã€çœ‹é—¨å£æœºåˆ¶çš„æ‰§è¡Œæµç¨‹ã€‘\nåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è®¾ç½®è¿‡æœŸæ—¶é—´ (åˆ¤æ–­ leaseTime \u0026gt; 0 ï¼Œé»˜è®¤ leaseTime ä¸º -1 ) å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œä¸å¯ç”¨çœ‹é—¨ç‹—æœºåˆ¶ï¼Œç­‰åˆ°æŒ‡å®šçš„è¿‡æœŸæ—¶é—´ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ -\u0026gt; ç¬¬2æ­¥ Redssionä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œç”¨äºè‡ªåŠ¨ç»­æœŸé”çš„è¿‡æœŸæ—¶é—´ã€‚ å®šæ—¶ä»»åŠ¡ä¸­ï¼Œè®¾ç½®é”çš„è¶…æ—¶æ—¶é—´é»˜è®¤ä¸º30sï¼Œ æ¯é—´éš”æ€»æ—¶é•¿çš„1/3ï¼Œä¹Ÿå°±æ˜¯10sã€‚å®šæ—¶ä»»åŠ¡ä¼šè‡ªåŠ¨é”è¿›è¡Œç»­æœŸï¼Œç»­æœŸæ—¶é—´ä¸º30s å½“å®¢æˆ·ç«¯ä¸»åŠ¨é‡Šæ”¾é”ï¼Œé‚£ä¹ˆRedissonå°±ä¼šå–æ¶ˆçœ‹é—¨ç‹—æœºåˆ¶ã€‚ ã€æ³¨æ„ã€‘ å¦‚æœå®¢æˆ·ç«¯ä¸»åŠ¨é‡Šæ”¾é”ä¹‹å‰ï¼ŒæœåŠ¡å™¨çªç„¶å®•æœºäº†ï¼Œå®šæ—¶ä»»åŠ¡æ²¡æ³•å„¿ç»§ç»­æ‰§è¡Œã€‚ç­‰çœ‹é—¨ç‹—æœºåˆ¶è®¾ç½®çš„è¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œé”å°±è‡ªåŠ¨é‡Šæ”¾äº†ã€‚æ‰€ä»¥ï¼Œä¸ä¼šå‡ºç°ä¸€ç›´å ç”¨é”çš„æƒ…å†µã€‚\n11. Redis å®ç°åˆ†å¸ƒå¼é”æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜æœ‰å“ªäº›ï¼Ÿ ä¸šåŠ¡æœªæ‰§è¡Œå®Œï¼Œé”æå‰åˆ°æœŸï¼šç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘è¿˜æ²¡æ‰§è¡Œå®Œæ¯•ï¼Œé”æå‰è¿‡æœŸäº†ã€‚è¢«å…¶ä»–çš„è¿›ç¨‹è·å–äº†é”ï¼ŒåŒæ—¶æŠ¢å ä¸´ç•Œèµ„æºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\nã€è§£å†³æ–¹æ³•ã€‘\né€šå¸¸è¦ä¿è¯ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘éœ€è¦åœ¨é”è¿‡æœŸä¹‹å‰æ‰§è¡Œå®Œï¼Œå› æ­¤éœ€è¦æŠŠé”çš„è¿‡æœŸæ—¶é—´ç¨å¾®è®¾å¤§ä¸€äº›ã€‚ä¹Ÿä¸èƒ½å¤ªå¤§ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå°±æ‹¿ä¸åˆ°é”ï¼Œå°±ä¼šé™ä½ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚æˆ–è€…ä½¿ç”¨Redissonåˆ†å¸ƒå¼é”ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨çœ‹é—¨ç‹—æœºåˆ¶ï¼Œå®šæ—¶ç»­æœŸé”ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¸ç»­æœŸé”äº†ã€‚\nå•ç‚¹æ•…éšœé—®é¢˜ï¼šå¦‚æœåªéƒ¨ç½²äº†ä¸€ä¸ªRedisèŠ‚ç‚¹ï¼Œå½“å®ä¾‹å®•æœºæˆ–è€…ä¸å¯ç”¨çš„æ—¶å€™ã€‚æ•´ä¸ªåˆ†å¸ƒå¼é”æœåŠ¡å°†æ— æ³•å®Œæˆå·¥ä½œï¼Œé˜»å¡ä¸šåŠ¡çš„æ­£å¸¸æ‰§è¡Œã€‚\nã€è§£å†³æ–¹æ³•ã€‘\nå¯ä»¥åˆ©ç”¨Redis Clusteré›†ç¾¤æœºåˆ¶ï¼Œéƒ¨ç½²å¤šä¸ªRediså®ä¾‹ï¼Œé‡‡ç”¨ä¸€ä¸»+ä¸¤ä»çš„å“¨å…µæœºåˆ¶ã€‚å½“æŸä¸ªå®ä¾‹å®•æœºæ—¶, å“¨å…µä¼šè‡ªåŠ¨é€‰ä¸¾æ–°çš„æœ‰æ•ˆèŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹ã€‚\nä¸»ä»åŒæ­¥ä½†é”æœªåŒæ­¥é—®é¢˜ï¼šä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥å®ç°çš„ï¼Œå¦‚æœRedisä¸»èŠ‚ç‚¹è·å–åˆ°é”ï¼Œä½†æ˜¯è¿˜æ²¡åŒæ­¥åˆ°ä»èŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼Œä¸»èŠ‚ç‚¹çªç„¶å®•æœºï¼Œç„¶åå“¨å…µé€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œç”±äºä¸»ä»åŒæ­¥æ²¡æœ‰å®Œæˆï¼Œç°åœ¨å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸è·å–é”ã€‚å°±ä¼šå¯¼è‡´å¤šä¸ªåº”ç”¨åŒæ—¶è·å–é”ï¼Œä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nç½‘ç»œåˆ†åŒºé—®é¢˜ï¼šåœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒRediså¯èƒ½ä¼šä¸­æ–­å†é‡è¿ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´é”æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚å¦‚æœæœ‰å¤šä¸ªé”ï¼Œå¯èƒ½è¿˜ä¼šå¼•å‘æ­»é”çš„ç°è±¡ã€‚\nã€å¤šé”æ­»é”ç°è±¡ã€‘\næœ‰ä¸¤ä¸ªèµ„æºAå’ŒBï¼Œåˆ†åˆ«ç”±é”LockAå’ŒLockBä¿æŠ¤ã€‚\nå®¢æˆ·ç«¯1å…ˆè·å–LockAï¼Œç„¶åå°è¯•è·å–LockBã€‚\nå®¢æˆ·ç«¯2å…ˆè·å–LockBï¼Œç„¶åå°è¯•è·å–LockA\nå¦‚æœå®¢æˆ·ç«¯1æ‹¿åˆ°äº†LockAï¼Œå®¢æˆ·ç«¯2æ‹¿åˆ°äº†LockBã€‚çªç„¶ç½‘ç»œä¸ç¨³å®šï¼Œé”æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚ç„¶åå®¢æˆ·ç«¯1ç­‰å¾…LockBï¼Œå®¢æˆ·ç«¯2ç­‰å¾…LockAï¼Œå°±ä¼šå½¢æˆæ­»é”ã€‚\næ—¶é’Ÿæ¼‚ç§»é—®é¢˜ï¼šå› ä¸ºRedisåˆ†å¸ƒå¼é”ä¾èµ–é”çš„è¿‡æœŸæ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœå‡ºç°æ—¶é’Ÿæ¼‚ç§»ï¼Œå¾ˆå¯èƒ½å¯¼è‡´é”ç›´æ¥å¤±æ•ˆã€‚\nã€è§£å†³æ–¹æ³•ã€‘\nè®©æ‰€æœ‰èŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é’Ÿä»NTPæœåŠ¡è¿›è¡ŒåŒæ­¥ï¼Œå‡å°‘æ—¶é’Ÿæ¼‚ç§»çš„å½±å“ã€‚\nå¯é‡å…¥é—®é¢˜ï¼šæŸä¸ªè¿›ç¨‹å¯èƒ½æœ‰å¤šæ¬¡è°ƒç”¨é”ï¼Œå¦‚æœé”ä¸èƒ½é‡å…¥çš„è¯ã€‚å½“è¿›ç¨‹è·å–åˆ°é”åï¼Œå†æ¬¡ç”³è¯·è·å–é”ï¼Œè·å–ä¸åˆ°å°±æ­»é”äº†ã€‚\n12. Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«? åŸºäºå†…å­˜: Rediså­˜å‚¨çš„æ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«ï¼Œæå‡äº†è¯»å†™é€Ÿåº¦ å•çº¿ç¨‹æ¨¡å‹ + I/Oå¤šè·¯å¤ç”¨ï¼š Redisé‡‡ç”¨å•çº¿ç¨‹+I/Oå¤šè·¯å¤ç”¨çš„æ–¹å¼ï¼Œé¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œæé«˜äº†å¹¶å‘å¤„ç†æ•ˆç‡ é«˜æ•ˆæ•°æ®ç»“æ„ï¼šæä¾›Stringã€Listã€Hashã€Setã€Sorted Set äº”ç§æ•°æ®ç»“æ„ï¼Œä»–ä»¬çš„æ“ä½œå¤æ‚åº¦å¤§éƒ¨åˆ†ä¸ºO(1) å¼‚æ­¥æŒä¹…åŒ–: æŒä¹…åŒ–æ“ä½œç”±å­çº¿ç¨‹å¼‚æ­¥å®Œæˆï¼Œå‡å°‘äº†æŒä¹…åŒ–å¯¹ä¸»çº¿ç¨‹çš„å½±å“ï¼Œæå‡äº†æ•´ä½“æ€§èƒ½ã€‚ ã€æ³¨æ„ã€‘Redisä»6.0å¼€å§‹å¯¹ç½‘ç»œå¤„ç†å¼•å…¥äº†å¤šçº¿ç¨‹æœºåˆ¶ï¼Œæé«˜I/Oæ€§èƒ½ã€‚ç½‘ç»œè¯·æ±‚å¯ä»¥å¹¶å‘å¤„ç†ï¼Œå‡å°‘ç½‘ç»œI/Oç­‰å¾…çš„å½±å“ã€‚ä½†æ˜¯ï¼ŒRedis ä»ç„¶ä¿æŒäº†æ ¸å¿ƒå‘½ä»¤å¤„ç†é€»è¾‘çš„å•çº¿ç¨‹ç‰¹æ€§ã€‚\nã€I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ã€‘\nLinuxå¤šè·¯å¤ç”¨æŠ€æœ¯å…è®¸å¤šä¸ªè¿›ç¨‹çš„I/Oæ³¨å†Œåˆ°åŒä¸€ç®¡é“å’Œå†…æ ¸äº¤äº’ï¼Œå‡†å¤‡å¥½æ•°æ®ä¹‹åå†copyåˆ°ç”¨æˆ·ç©ºé—´ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªI/Oæµã€‚ Linuxä¸‹I/Oå¤šè·¯å¤ç”¨æœ‰selectã€pollã€epoll ä¸‰ç§ï¼ŒåŠŸèƒ½ç±»ä¼¼ï¼Œç»†èŠ‚ä¸åŒ 13. ä¸ºä»€ä¹ˆ Redis è®¾è®¡ä¸ºå•çº¿ç¨‹ï¼Ÿ6.0 ç‰ˆæœ¬ä¸ºä½•å¼•å…¥å¤šçº¿ç¨‹ï¼Ÿ ã€Redisé‡‡ç”¨å•çº¿ç¨‹çš„åŸå› ã€‘\nåŸºäºå†…å­˜æ“ä½œï¼ŒRedisçš„ç“¶é¢ˆä¸»è¦æ˜¯å†…å­˜ï¼Œå¤šæ•°æ“ä½œçš„æ€§èƒ½ç“¶é¢ˆä¸æ˜¯CPUå¸¦æ¥çš„ (å¢åŠ å¤šçº¿ç¨‹ä¹Ÿæ²¡å•¥ç”¨) å•çº¿ç¨‹æ¨¡å‹çš„ä»£ç ç®€å•ï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ€§èƒ½å¼€é”€ã€‚ å•çº¿ç¨‹ç»“åˆI/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œèƒ½æé«˜I/Oåˆ©ç”¨ç‡ ã€æ³¨æ„ã€‘ Redisçš„å•çº¿ç¨‹æ˜¯æŒ‡ç½‘ç»œè¯·æ±‚æ¨¡å—å’Œæ•°æ®æ“ä½œæ¨¡å—æ˜¯å•çº¿ç¨‹çš„, ä½†æ˜¯æŒä¹…åŒ–å­˜å‚¨æ¨¡å—å’Œé›†ç¾¤æ”¯æ’‘æ¨¡å—æ˜¯å¤šçº¿ç¨‹çš„ã€‚\nã€ä¸ºä»€ä¹ˆå¼•å…¥å¤šçº¿ç¨‹ã€‘\néšç€æ•°æ®è§„æ¨¡å’Œè¯·æ±‚é‡çš„å¢åŠ ï¼Œæ‰§è¡Œç“¶é¢ˆä¸»è¦åœ¨ç½‘ç»œI/Oéƒ¨åˆ†ã€‚å¼•å…¥å¤šçº¿ç¨‹å¯ä»¥æé«˜ç½‘ç»œI/Oçš„é€Ÿåº¦ã€‚ä½†æ˜¯ï¼ŒRediså†…æ ¸å»è¿˜æ˜¯ä¿æŒå•çº¿ç¨‹å¤„ç†ï¼Œæ¯”å¦‚è¯»å†™å‘½ä»¤éƒ¨åˆ†è¿˜æ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨é—®é¢˜å°±ä¸å­˜åœ¨äº†ã€‚\nã€Rediså¤šçº¿ç¨‹I/Oåœºæ™¯ä¸‹çš„ç»“æ„ã€‘\n14. å¦‚ä½•ä½¿ç”¨Rediså¿«é€Ÿå®ç°å¸ƒéš†è¿‡æ»¤å™¨? Rediså¯ä»¥ä½¿ç”¨ä½å›¾Bitmapæˆ–è€…ç”¨Redisæ¨¡å—RedisBloomæ¥å®ç°å¸ƒéš†è¿‡æ»¤å™¨\nä½å›¾ bitmap å®ç° bitmap æœ¬è´¨æ˜¯ä¸€ä¸ªä½æ•°ç»„ï¼Œæä¾›äº†setbitå’Œgetbitæ¥è®¾ç½®å’Œè·å–æŸä¸ªå€¼ï¼Œå¯ä»¥ç”¨æ¥æ ‡è¯†æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ å¯¹åº”ç»™å®šçš„keyï¼Œå¯ä»¥ç”¨å“ˆå¸Œå‡½æ•°æ¥è®¡ç®—ä½ç½®ç´¢å¼•ã€‚å¦‚æœä½å›¾ä¸­çš„å€¼ä¸º1ï¼Œ è¡¨ç¤ºè¯¥å…ƒç´ å¯èƒ½å­˜åœ¨ RedisBloom æ¨¡å—å®ç°ï¼šå°è£…äº†å“ˆå¸Œå‡½æ•°å’Œä½å›¾å¤§å°ï¼Œå¯ä»¥ç›´æ¥ç”¨äºåˆ›å»ºå’Œç®¡ç†å¸ƒéš†è¿‡æ»¤å™¨ ã€å¸ƒéš†è¿‡æ»¤å™¨åŸç†ã€‘\nå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ç”±ä¸€ä¸ªä½æ•°ç»„+kä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ç»„æˆã€‚æ¯æ¬¡éªŒè¯æŸä¸ªkeyå¯¹åº”çš„æ•°æ®æ˜¯å¦å­˜åœ¨çš„æ—¶å€™ï¼Œéœ€è¦kä¸ªå“ˆå¸Œå‡½æ•°éƒ½å¯¹å…¶è¿›è¡Œè¿ç®—ï¼Œå¦‚æœä½æ•°ç»„ä¸­çš„å€¼éƒ½ä¸º1ï¼Œè¯´æ˜è¯¥keyå¯¹åº”çš„æ•°æ®å¯èƒ½å­˜åœ¨ã€‚åªè¦æœ‰ä¸€ä¸ªä½ç½®ä¸ä¸º1ï¼Œ å°±è¯´æ˜keyå¯¹åº”çš„æ•°æ®ä¸€å®šä¸å­˜åœ¨ã€‚\nä¸ºä»€ä¹ˆkä¸ªå‡½æ•°æŸ¥åˆ°çš„å€¼éƒ½ä¸º1ï¼Œ ä¹Ÿä¸èƒ½è¯´æ˜keyå¯¹åº”çš„æ•°æ®ä¸€å®šå­˜åœ¨å‘¢ï¼Ÿ\nå› ä¸ºå¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çªï¼Œæ¯”å¦‚key å’Œ key1 çš„kä¸ªhashå‡½æ•°çš„å€¼éƒ½ä¸º1ã€‚ä½†æ˜¯keyå¯¹åº”çš„æ•°æ®åœ¨æ•°æ®åº“é‡Œé¢ï¼Œä½†æ˜¯key1çš„æ•°æ®ä¸åœ¨æ•°æ®åº“é‡Œé¢ã€‚\n15. Redis ä¸­å¸¸è§çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ ã€Rediså¸¸è§çš„äº”ç§æ•°æ®ç»“æ„ã€‘\næ•°æ®ç»“æ„åç§° åº•å±‚ ç‰¹æ€§ é€‚ç”¨åœºæ™¯ String SDS ç®€å•åŠ¨æ€å­—ç¬¦ä¸² Stringå­—ç¬¦ä¸² 1.ç¼“å­˜æ•°æ®ï¼šç¼“å­˜Sessionã€Tokenã€åºåˆ—åŒ–åçš„å¯¹è±¡\n2. åˆ†å¸ƒå¼é”:set ex nx\n3.è®¡æ•°ï¼šç”¨æˆ·å•ä½æ—¶é—´è®¿é—®æ¬¡æ•°ï¼Œé¡µé¢å•ä½æ—¶é—´è®¿é—®æ¬¡æ•° List ListPack / QuickList / ZipList / LinkedList åŒå‘æœ‰åºé“¾è¡¨ï¼Œå„èŠ‚ç‚¹éƒ½åŒ…å«å­—ç¬¦ä¸² 1. ä¿¡æ¯æµå±•ç¤ºï¼šå†å²è®°å½•ã€æ›´æ–°æ–‡ç« ã€æ›´æ–°åŠ¨æ€\n2.æ¶ˆæ¯é˜Ÿåˆ—ï¼šä¸æ¨èï¼Œç¼ºé™·å¤š Hash Dict / ZipList æ— åºæ•£åˆ—è¡¨ï¼Œå­˜å‚¨é”®å€¼å¯¹ å­˜å‚¨ä¿¡æ¯ï¼šç”¨æˆ·ã€å•†å“ã€æ–‡ç« ã€è´­ç‰©è½¦ä¿¡æ¯ Set Dict / Intset æ— åºå»é‡é›†åˆï¼ŒåŒ…å«ä¸åŒçš„å­—ç¬¦ä¸² 1.ä¸é‡å¤æ•°æ®ï¼šç‚¹èµæ¬¡æ•°ã€ä¸‹å•æ¬¡æ•°\n2.å…±åŒèµ„æºï¼šå…±åŒå¥½å‹ã€ç»Ÿç»Ÿç²‰ä¸ã€å…±åŒå…³æ³¨ (äº¤é›†ã€å¹¶é›†)\n3.éšæœºæŠ½å–: æŠ½å¥–ç³»ç»Ÿã€éšæœºç‚¹å ZSet ZipList / SkipList è·³è¡¨ + HashTableå“ˆå¸Œè¡¨ æœ‰åºé›†åˆï¼ŒvalueåŒ…å«member æˆå‘˜å’Œscoreåˆ†æ•°ï¼ŒæŒ‰ç…§score è¿›è¡Œæ’åº 1.å„ç±»æ’è¡Œæ¦œï¼šç‚¹èµæ’è¡Œç‰ˆã€çƒ­é—¨è¯é¢˜æ’è¡Œæ¦œ\n2. ä¼˜å…ˆçº§/é‡è¦ç¨‹åº¦: ä¼˜å…ˆçº§é˜Ÿåˆ— ã€å…¶ä»–æ•°æ®ç»“æ„ã€‘\næ•°æ®ç»“æ„åç§° ç‰¹æ€§ é€‚ç”¨åœºæ™¯ BitMap å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œ0 å’Œ1 1. å¸ƒéš†è¿‡æ»¤å™¨ï¼š é˜²æ­¢ç¼“å­˜ç©¿é€\n2. ç­¾åˆ°ç»Ÿè®¡ï¼š æ¯æ—¥ç­¾åˆ°ç”¨ 1 æ ‡è®°ï¼Œæœªç­¾åˆ°ç”¨0æ ‡è®°ï¼Œå¯ä»¥å¿«é€Ÿç»Ÿè®¡æŸæ—¥ç­¾åˆ°äººæ•°å’Œè¿ç»­ç­¾åˆ°å¤©æ•° HyperLogLog åŸºäºæ¦‚ç‡ç®—æ³•å®ç°ï¼Œå­˜å‚¨æµ·é‡æ•°æ®è¿›è¡Œè®¡æ•°ç»Ÿè®¡ ä¸€èˆ¬ç”¨äºé¡µé¢çš„é¡µé¢æµè§ˆé‡PVå’Œç‹¬ç«‹è®¿å®¢æ•°UVï¼Œ å¿«é€Ÿä¼°ç®—è®¿é—®é‡ GEO å­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œç»çº¬åº¦åæ ‡å’Œä½ç½®åç§° ä¸€èˆ¬ç”¨äºè®¡ç®—ä¸åŒä½ç½®çš„è·ç¦»ï¼Œæ¯”å¦‚å¤–å–å•ä¸­è®¡ç®—é…é€è·ç¦» Stream èƒ½å¤Ÿç”Ÿæˆå…¨å±€å”¯ä¸€æ¶ˆæ¯idçš„æ¶ˆæ¯é˜Ÿåˆ— ç”¨äºå¯é æ¶ˆæ¯ä¼ é€’ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†çš„åœºæ™¯ 16. Redis ä¸­å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ ä¸ºäº†ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰è¿™ä¹ˆå‡ ç§æ–¹æ¡ˆï¼š\nå…ˆä¿®æ”¹ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“\näº‹åŠ¡Aå‡†å¤‡ä¿®æ”¹æŒ‡å®šidçš„ name ä¸º å°å¼  ï¼Œå…ˆä¿®æ”¹ç¼“å­˜ äº‹åŠ¡Bå‡†å¤‡ä¿®æ”¹æŒ‡å®šidçš„ name ä¸º å°ç‹ï¼Œå…ˆä¿®æ”¹ç¼“å­˜, ç„¶åä¿®æ”¹æ•°æ®åº“ä¸ºå°ç‹ äº‹åŠ¡Aä¿®æ”¹æ•°æ®åº“ä¸º å°å¼  (ç½‘ç»œå»¶è¿Ÿ)ï¼Œ æ­¤æ—¶å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ å…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†ä¿®æ”¹ç¼“å­˜\näº‹åŠ¡Aå‡†å¤‡ä¿®æ”¹æŒ‡å®šidçš„ name ä¸º å°å¼  ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ äº‹åŠ¡Bå‡†å¤‡ä¿®æ”¹æŒ‡å®šidçš„ name ä¸º å°ç‹ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“, ç„¶åä¿®æ”¹ç¼“å­˜ä¸ºå°ç‹ äº‹åŠ¡Aä¿®æ”¹ç¼“å­˜ä¸º å°å¼  (ç½‘ç»œå»¶è¿Ÿ)ï¼Œ æ­¤æ—¶å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“\näº‹åŠ¡Bè¯»å–æŒ‡å®šidçš„nameï¼Œ å‘ç°æ‰¾ä¸åˆ°ç¼“å­˜ï¼Œè¯»å–æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ºå°ç‹\näº‹åŠ¡Aå‡†å¤‡ä¿®æ”¹æŒ‡å®šidçš„ name ä¸º å°å¼  ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åä¿®æ”¹æ•°æ®åº“ä¸º å°å¼ \näº‹åŠ¡Bä¿®æ”¹ç¼“å­˜ä¸ºå°ç‹ (è¯»åˆ°ç©ºæ•°æ®ï¼Œè¿”å›æ¥å†™)ï¼Œæ­¤æ—¶å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ\nå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼šåŸºæœ¬ä¸ä¼šå‡ºç°é—®é¢˜ ï¼ˆé™¤éåˆ é™¤ç¼“å­˜çš„è¯·æ±‚å¤±è´¥ï¼‰\nå»¶è¿ŸåŒåˆ ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼š éš¾ä»¥è¯„å®šä¼‘çœ æ—¶é—´\nå¦‚æœè¦ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„å¼ºä¸€è‡´æ€§æ€ä¹ˆåŠï¼Ÿ\nç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼šæŠŠå†™ç­–ç•¥é‡Œé¢çš„åˆ é™¤ç¼“å­˜æ“ä½œåŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè®©æ¶ˆè´¹è€…æ¥æ“ä½œæ•°æ®ã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œåˆ™å¯ä»¥å†²æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–ï¼Œåœ¨ä¸€å®šé‡è¯•æ¬¡æ•°ä¸‹åˆ é™¤æˆåŠŸçš„è¯ï¼Œå°†è¯¥æ¶ˆæ¯åˆ é™¤ã€‚ ï¼ˆç¡®ä¿åˆ é™¤ç¼“å­˜æˆåŠŸï¼‰ binlog + Canal: æ¨¡ä»¿MySQLä¸»ä»åŒæ­¥çš„æ–¹å¼ï¼Œç»“åˆCanal è®¢é˜…MySQLçš„binlogã€‚å…¶å®å°±æ˜¯ç­‰MySQLå†™å…¥æ•°æ®åº“, ç„¶åå»åˆ é™¤ç¼“å­˜ã€‚ å¦‚æœéœ€è¦é¿å…ç¼“å­˜å¤±æ•ˆ (æ¯”å¦‚çƒ­ç‚¹Key), å¦‚ä½•è®¾è®¡å‘¢?\nåˆ†å¸ƒå¼é”ï¼šåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªè¯·æ±‚æ›´æ–°ç¼“å­˜ï¼Œç¡®ä¿ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ã€‚ä½†æ˜¯ï¼Œå¯èƒ½ä¼šé™ä½å†™æ€§èƒ½ æ·»åŠ çŸ­æš‚è¿‡æœŸæ—¶é—´ï¼šåœ¨å…ˆä¿®æ”¹æ•°æ®åº“å†ä¿®æ”¹ç¼“å­˜çš„åŸºç¡€ä¸Šï¼Œç»™ç¼“å­˜åŠ ä¸€ä¸ªçŸ­æš‚çš„è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µæ—¶é—´æ¯”è¾ƒå°‘ã€‚ 17. Redis ä¸­è·³è¡¨çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ è·³è¡¨æ˜¯ç”±å¤šå±‚é“¾è¡¨ç»„æˆçš„ï¼Œå®ƒæ˜¯Redisä¸­ ZSet çš„åº•å±‚ç»“æ„ã€‚æœ€åº•å±‚å­˜æ‰€æœ‰çš„å…ƒç´ ï¼Œä¸Šå±‚æ˜¯ä¸‹å±‚çš„å­é›† (å¯ä»¥ç†è§£æˆä¸€ç§ç´¢å¼•)ã€‚è·³è¡¨çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ï¼š\næŸ¥æ‰¾ï¼šä»æœ€é«˜å±‚å¼€å§‹ï¼Œé€šè¿‡èŒƒå›´ç¡®å®šä½ç½®ï¼Œé€å±‚å‘ä¸‹æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log n) æ’å…¥ï¼šä»æœ€é«˜å±‚å¼€å§‹ï¼Œå…ˆé€å±‚å‘ä¸‹æ‰¾åˆ°å­˜æ”¾ä½ç½®ï¼Œç„¶åéšæœºç¡®å®šæ–°èŠ‚ç‚¹å±‚æ•°ï¼Œæ’å…¥å¹¶æ›´æ–°æŒ‡é’ˆ åˆ é™¤ï¼šä»æœ€é«˜å±‚å¼€å§‹ï¼Œé€šè¿‡èŒƒå›´ç¡®å®šä½ç½®ï¼Œåœ¨å„å±‚æ›´æ–°æŒ‡é’ˆä¿æŒç»“æ„ ã€Redisè·³è¡¨ç»“æ„ã€‘\nRedisçš„è·³è¡¨ç›¸å¯¹äºæ™®é€šçš„è·³è¡¨å¤šäº†ä¸€ä¸ªå›é€€æŒ‡é’ˆ, è€Œä¸” score æ˜¯å¯ä»¥é‡å¤çš„ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è·³è¡¨çš„èŠ‚ç‚¹å®ç°çš„åŸç†\ntypedef struct zskiplistNode { //Zset å¯¹è±¡çš„å…ƒç´ å€¼ sds ele; // é‡‡ç”¨Rediså­—ç¬¦ä¸²åº•å±‚å®ç°sds,ç”¨äºå­˜å‚¨æ•°æ® //å…ƒç´ æƒé‡å€¼ double score; //åé€€æŒ‡é’ˆ struct zskiplistNode *backward; // ç”¨äºæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ //èŠ‚ç‚¹çš„levelæ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦ struct zskiplistLevel { struct zskiplistNode *forward; unsigned long span; // å½“å‰å±‚çš„è·¨åº¦å€¼ } level[]; } zskiplistNode; ä¸Šé¢çš„å›¾ç‰‡çœ‹èµ·æ¥æ¯”è¾ƒæŠ½è±¡ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å›¾ç‰‡è¿›è¡Œç†è§£ã€‚ä¸Šè¿°çš„æŸ¥æ‰¾ã€åˆ é™¤ã€æ’å…¥æ“ä½œï¼Œå…¶å®éƒ½æ˜¯å…ˆä»level[0] å¼€å§‹è¿›è¡Œéå†ï¼Œç„¶åæ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚å†å¾€ä¸‹è¿›å…¥level[1]è¿›è¡Œéå†ï¼Œå†æ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚ä¸€ç›´é‡å¤è¿™ä¸ªæ“ä½œï¼Œç›´åˆ°è¿›å…¥æœ€åº•å±‚ï¼Œç„¶åå°±å¯ä»¥ç¡®å®šä½ç½®äº†ã€‚\nç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è·³è¡¨çš„åº•å±‚å®ç°åŸç†\ntypedef struct zskiplist{ struct zskiplistNode *header, *tail, // å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ unsigned long length,\t// è·³è¡¨é•¿åº¦ int level; // è·³è¡¨çš„æœ€å¤§å±‚æ•° } zskiplist; ã€æ³¨æ„ã€‘è·³è¡¨çš„å¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹ã€è·³è¡¨é•¿åº¦ã€è·³è¡¨çš„æœ€å¤§å±‚æ•°éƒ½å¯ä»¥åœ¨o(1)æ—¶é—´å¤æ‚åº¦è¿›è¡Œè®¿é—®\nã€è·³è¡¨æŸ¥è¯¢è¿‡ç¨‹ç»†èŠ‚ã€‘\nä»å¤´èŠ‚ç‚¹çš„æœ€é«˜å±‚å¼€å§‹ï¼Œé€ä¸€éå†æ¯ä¸€å±‚ éå†æŸä¸€å±‚èŠ‚ç‚¹æ—¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„ SDS ç±»å‹å…ƒç´ å’Œå…ƒç´ æƒé‡è¿›è¡Œåˆ¤æ–­ å¦‚æœå½“å‰èŠ‚ç‚¹æƒé‡ \u0026lt; è¦æŸ¥æ‰¾çš„æƒé‡ï¼Œ ç»§ç»­å‘å‰éå† å¦‚æœå½“å‰èŠ‚ç‚¹æƒé‡ = è¦æ‰¾çš„æƒé‡ \u0026amp;\u0026amp; å½“å‰èŠ‚ç‚¹çš„ SDS ç±»å‹æ•°æ® \u0026lt; è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œç»§ç»­å‘å‰éå† å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³æˆ–è€…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è·³åˆ°ä¸‹ä¸€å±‚levelæ•°ç»„é‡Œé¢ï¼Œç»§éå†ç»­æŸ¥æ‰¾ å¦‚æœå½“å‰å½“å‰èŠ‚ç‚¹æƒé‡ = è¦æ‰¾çš„æƒé‡ \u0026amp;\u0026amp; å½“å‰èŠ‚ç‚¹çš„ SDS ç±»å‹æ•°æ® = è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œ è¿”å›å½“å‰èŠ‚ç‚¹å€¼ï¼ŒæŸ¥è¯¢ç»“æŸ ã€è·³è¡¨çš„æ’å…¥ç»†èŠ‚ã€‘\nå‚æ•°æ£€æŸ¥å’Œåˆå§‹åŒ–ï¼šæ£€æŸ¥è¦æ’å…¥çš„èŠ‚ç‚¹çš„scoreæ˜¯å¦ä¸ºNaNï¼Œåˆå§‹åŒ–éå†æŒ‡é’ˆxæŒ‡å‘è·³è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œå®šä¹‰update æ•°ç»„è®°å½•æ¯å±‚æŸ¥æ‰¾çš„æœ€å³èŠ‚ç‚¹ (åç»­è¦ä¿®æ”¹å®ƒçš„æŒ‡é’ˆ)ï¼Œrank æ•°ç»„è®°å½•æ¯å±‚è·¨è¶Šçš„èŠ‚ç‚¹æ•°ã€‚ æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼šå’Œä¸Šé¢æŸ¥æ‰¾è¿‡ç¨‹ä¸€æ ·ï¼Œä»æœ€é«˜å±‚å¼€å§‹ï¼Œé€å±‚å¾€ä¸‹æŸ¥è¯¢ã€‚æ¯ä¸€å±‚ä¸­ï¼ŒæŠŠæ»¡è¶³æ¡ä»¶çš„æœ€å³èŠ‚ç‚¹è®°å½•åœ¨ update æ•°ç»„ä¸­ï¼Œå¹¶æ›´æ–° rank æ•°ç»„è®°å½•è·¨è¶Šçš„èŠ‚ç‚¹æ•°ã€‚ ç”Ÿæˆæ–°èŠ‚ç‚¹å±‚æ•°ï¼šè°ƒç”¨zsRandomLevel å‡½æ•°ç”Ÿæ–°èŠ‚ç‚¹çš„éšæœºå±‚æ•°ã€‚å¦‚æœæ–°èŠ‚ç‚¹å±‚æ•° \u0026gt; å½“å‰è·³è¡¨æ€»å±‚æ•°ï¼Œåˆ™æ›´æ–°è·³è¡¨æœ€å¤§å±‚æ•°ï¼Œå¹¶åˆå§‹åŒ–æ–°å¢å±‚çš„update å’Œ rank æ•°ç»„æ•°æ®ã€‚ åˆ›å»ºå¹¶æ’å…¥æ–°èŠ‚ç‚¹ï¼šåˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œæ ¹æ® update å’Œ rank æ•°ç»„ä¿¡æ¯ï¼Œåœ¨æ¯ä¸€å±‚æ’å…¥èŠ‚ç‚¹ï¼Œè®¾ç½®forward æŒ‡é’ˆ å’Œ span è·¨åº¦å€¼ æ›´æ–°å…¶ä»–èŠ‚ç‚¹çš„spanå€¼ï¼šå¯¹äºæ²¡æœ‰è§¦åŠåˆ°çš„å±‚ï¼Œæ›´æ–° update èŠ‚ç‚¹çš„ span å€¼ è®¾ç½®å‰åæŒ‡é’ˆï¼šè®¾ç½®æ–°èŠ‚ç‚¹çš„backwardæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™æ›´æ–°è·³è¡¨çš„tailæŒ‡é’ˆã€‚ æ›´æ–°è·³è¡¨çš„é•¿åº¦ï¼šè·³æ ‡çš„èŠ‚ç‚¹æ•° + 1ï¼Œ è¿”å›æ’å…¥çš„æ–°èŠ‚ç‚¹æŒ‡é’ˆã€‚ ã€ä¸ºä»€ä¹ˆZSetè¦ç”¨è·³è¡¨ä¸ç”¨å“ˆå¸Œè¡¨å’Œå¹³è¡¡æ ‘ã€‘\nä¸»è¦æœ‰ä¸‰ä¸ªåŸå› ï¼š\nå†…å­˜æ›´å°‘ï¼šè·³è¡¨ç›¸æ¯”Bæ ‘å¯ä»¥å ç”¨æ›´å°‘çš„å†…å­˜ï¼Œä¸»è¦å–å†³äºå¦‚ä½•è®¾ç½®èŠ‚ç‚¹å±‚æ•°çš„æ¦‚ç‡å‚æ•° å±€éƒ¨æ€§è‰¯å¥½ï¼šè·³è¡¨åœ¨æ‰§è¡ŒZRANGE å’Œ ZREVRANGE ç­‰æ“ä½œæ—¶ï¼Œå…¶ç¼“å­˜å±€éƒ¨æ€§è¡¨ç°è‰¯å¥½ï¼Œä¸æ¯”å…¶ä»–å¹³è¡¡æ ‘å·® å®ç°ç®€å•ï¼šè·³è¡¨çš„ä»£ç æ›´ç®€å•å’Œæ˜“äºè°ƒè¯• 18. Redis Zset çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ ZSet çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å‹ç¼©åˆ—è¡¨ Ziplist / ç´§å‡‘åˆ—è¡¨ Listpackï¼Œå¦ä¸€ç§æ˜¯è·³è¡¨ skiplist + å“ˆå¸Œè¡¨ HashTableã€‚ä¸»è¦åˆ¤æ–­æ¡ä»¶å¦‚ä¸‹ï¼š\nå…ƒç´ æ•°é‡ \u0026lt; zset-max-ziplist-entries zsetå‹ç¼©åˆ—è¡¨æœ€å¤§é”®å€¼å¯¹ä¸ªæ•° (é»˜è®¤æ˜¯128) æ¯ä¸ªå…ƒç´ å¤§å°(key å’Œ value çš„é•¿åº¦) \u0026lt; zset-max-ziplist-value (é»˜è®¤ä¸º64) ã€ZSetå‹ç¼©åˆ—è¡¨ç»“æ„ã€‘\nZSet çš„ å‹ç¼©åˆ—è¡¨ç»“æ„å’Œæ•°ç»„å¾ˆç›¸ä¼¼ï¼Œç”¨ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´å­˜å‚¨æ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å ç”¨ç›¸é‚»çš„ä¸€å°æ®µå†…å­˜ï¼ŒèŠ‚ç‚¹ä¹‹é—´é€šè¿‡å†…å­˜åç§»é‡è€ŒéæŒ‡é’ˆè®°å½•ç›¸å¯¹ä½ç½®ã€‚\nã€æ³¨æ„ã€‘å‹ç¼©åˆ—è¡¨æ¯”ä¼ ç»Ÿçš„é“¾è¡¨æ›´åŠ èŠ‚çœå†…å­˜ï¼Œä½†æ˜¯å‹ç¼©åˆ—è¡¨ä¹Ÿæœ‰æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå®ƒçš„ä¿®æ”¹æˆæœ¬é«˜ã€‚\nå€’åºéå†éƒ½éœ€è¦ä¾èµ–ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦prevlenï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æœ‰ä¿®æ”¹ï¼Œåç»­èŠ‚ç‚¹å°±éœ€è¦ä¿®æ”¹prevlen å½“prevlen \u0026gt; å½“å‰èŠ‚ç‚¹ç¼–ç ç±»å‹çš„æœ€å¤§å¤§å°æ—¶ï¼Œå°±éœ€è¦æ”¹å˜ç¼–ç ç±»å‹ï¼Œé‡æ–°åˆ†é…å†…å­˜ åç»§èŠ‚ç‚¹é‡æ–°åˆ†é…å†…å­˜åï¼Œå…¶ä»–åé¢çš„èŠ‚ç‚¹éƒ½ä¼šé¢ä¸´åŒæ ·çš„æƒ…å†µï¼Œå¯¼è‡´å‘ç”Ÿè¿é”æ›´æ–°ã€‚ å‹ç¼©åˆ—è¡¨çš„å¤´éƒ¨åˆ†åˆ«æœ‰è®°å½•äº†ä¸‰ä¸ªé‡è¦å±æ€§ï¼š\nåˆ—è¡¨å¤§å°zlbytes: æ•´æ®µåˆ—è¡¨åœ¨å†…å­˜ä¸­å ç”¨çš„å­—èŠ‚æ•° å°¾èŠ‚ç‚¹ä½ç½® zltailï¼šä»é˜Ÿåˆ—å¤´åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹èµ·å§‹ä½ç½®çš„å†…å­˜åç§»é‡ã€‚ èŠ‚ç‚¹æ•°é‡ zllenï¼š æ€»å…±çš„èŠ‚ç‚¹ä¸ªæ•° æ¯ä¸ªèŠ‚ç‚¹å½“ä¸­åˆå¯ä»¥åŒ–åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\nä¸Šä¸€èŠ‚ç‚¹é•¿åº¦ prevlenï¼šç”¨äºå€’åºéå†æ—¶ç¡®è®¤ä¸Šä¸€èŠ‚ç‚¹çš„ä½ç½® èŠ‚ç‚¹ç¼–ç  encodingï¼šåŒæ—¶è®°å½•äº†é•¿åº¦å’Œç¼–ç ç±»å‹ æ•°æ® dataï¼šèŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ•°æ® ã€ZSetç´§å‡‘åˆ—è¡¨ç»“æ„ã€‘\nç´§å‡‘åˆ—è¡¨çš„å¤´éƒ¨åˆ†åˆ«æœ‰è®°å½•ä¸¤ä¸ªé‡è¦å±æ€§ï¼š\nåˆ—è¡¨å¤§å°size: æ•´æ®µåˆ—è¡¨åœ¨å†…å­˜ä¸­å ç”¨çš„å­—èŠ‚æ•° åˆ—è¡¨å…ƒç´ æ•°é‡numï¼šæ€»å…±çš„å…ƒç´ ä¸ªæ•° æ¯ä¸ªèŠ‚ç‚¹å½“ä¸­åˆå¯ä»¥åŒ–åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\nèŠ‚ç‚¹ç¼–ç  encodingï¼šåŒæ—¶è®°å½•äº†é•¿åº¦å’Œç¼–ç ç±»å‹ æ•°æ® dataï¼šèŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ•°æ® èŠ‚ç‚¹é•¿åº¦lenï¼šèŠ‚ç‚¹ç¼–ç encoding + æ•°æ®dataçš„æ€»é•¿åº¦ã€‚æ­£å‘æˆ–åå‘éå†éƒ½ä¾èµ–å®ƒå®Œæˆ ç´§å‡‘åˆ—è¡¨ç›¸æ¯”å‹ç¼©åˆ—è¡¨çš„ä¼˜ç‚¹ï¼šæ— éœ€è®°å½•ä¸Šä¸€èŠ‚ç‚¹çš„é•¿åº¦ï¼Œä¸Šä¸€èŠ‚ç‚¹é‡æ–°åˆ†é…å†…å­˜åï¼Œæœ¬èº«èŠ‚ç‚¹æ— éœ€åšä»»ä½•ä¿®æ”¹ã€‚\nã€è·³è¡¨ + å“ˆå¸Œè¡¨ã€‘\nå½“ZSet å¤„ç†æ¯”è¾ƒå¤§çš„æ•°æ®çš„æ—¶å€™ï¼Œä¼šé€‰æ‹©è·³è¡¨+å“ˆå¸Œè¡¨çš„æ–¹å¼ã€‚å…¶ä¸­ï¼Œè·³è¡¨çš„èŠ‚ç‚¹ä¿å­˜æŒ‡å‘memberçš„æŒ‡é’ˆå’Œscoreï¼Œå“ˆå¸Œè¡¨ä¿å­˜memberå’Œscoreä¹‹é—´å¯¹åº”çš„å…³ç³»ï¼Œæ–¹ä¾¿å®ç°é«˜æ•ˆçš„éšæœºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ã€‚\nè·³è¡¨çš„å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥å‚è€ƒ17. Redis Zset çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n19. Redis çš„ hash æ˜¯ä»€ä¹ˆï¼Ÿ Hash æ˜¯ Redisäº”å¤§å¸¸è§„æ•°æ®ç»“æ„(Stringã€Listã€Hashã€Setã€ZSet)çš„ä¸€ç§ï¼Œä¸»è¦ç”¨äºå­˜å‚¨key-value é”®å€¼å¯¹é›†åˆã€‚Hash ä¸€èˆ¬ä¼šç”¨æ¥å­˜å‚¨å•†å“çš„å±æ€§ã€ç”¨æˆ·çš„ä¿¡æ¯ç­‰ç­‰ã€‚\nã€Hashåº•å±‚æ•°æ®ç»“æ„ã€‘\nHash çš„åº•å±‚æ•°æ®ç»“æ„è¦åˆ†ä¸ºRedis 6.0 å’Œ 7.0æ¥çœ‹\nRedis 6.0: å‹ç¼©åˆ—è¡¨ zipList + å“ˆå¸Œè¡¨ HashTable Redis 7.0: ç´§å‡‘åˆ—è¡¨ Listpack + å“ˆå¸Œè¡¨ HashTable å½“Hashå½“ä¸­çš„æ•°æ®è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œå°±ä¼šä»å‹ç¼©åˆ—è¡¨zipList/ç´§å‡‘åˆ—è¡¨ListPack è½¬ä¸ºå“ˆå¸Œè¡¨HashTableã€‚å½“æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™æ‰èƒ½ç”¨å‹ç¼©åˆ—è¡¨zipList/ç´§å‡‘åˆ—è¡¨ListPack\nå“ˆå¸Œç±»å‹çš„ä¸ªæ•° \u0026lt; å“ˆå¸Œç´§å‡‘åˆ—è¡¨æœ€å¤§é”®å€¼å¯¹ä¸ªæ•° hash-max-listpack-entries (é»˜è®¤æ˜¯512) å“ˆå¸Œçš„ key å’Œ value çš„é•¿åº¦ \u0026lt; hash-max-ziplist-value 64 ã€ä¸ºä»€ä¹ˆHashä¼šé€‰æ‹©å‹ç¼©åˆ—è¡¨ zipList /ç´§å‡‘åˆ—è¡¨ ListPackå‘¢?ã€‘\nHash ç»“æ„é‡‡ç”¨å‹ç¼©åˆ—è¡¨ zipList /ç´§å‡‘åˆ—è¡¨ ListPackçš„ä¸»è¦ç›®çš„åº”è¯¥æ˜¯åŸºäºçœå†…å­˜çš„è§’åº¦å»è€ƒè™‘ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› å§ï¼š\nå†…å­˜å ç”¨å°‘ï¼š å‹ç¼©åˆ—è¡¨ zipList å’Œ ç´§å‡‘åˆ—è¡¨ ListPack éƒ½å±äºç´§å‡‘å‹çš„å†…å­˜ç»“æ„ï¼Œæ²¡æœ‰å“ˆå¸Œè¡¨é‚£æ ·å­˜åœ¨é¢å¤–çš„æŒ‡é’ˆå¼€é”€ã€‚å“ˆå¸Œè¡¨ä¸ºäº†ç»´æŒå¿«é€ŸæŸ¥æ‰¾çš„ç‰¹æ€§ï¼Œå†…éƒ¨æ‰ç”¨äº†é“¾è¡¨è§£å†³å“ˆå¸Œå†²çªï¼Œæ¯ä¸ªå“ˆå¸Œæ¡¶çš„å†…éƒ¨éƒ½ä¼šå¸¦æœ‰æŒ‡é’ˆï¼Œæ¯”è¾ƒå ç”¨å†…å­˜ç©ºé—´ã€‚å¦å¤–çš„ä¸¤ä¸ªæ•°æ®ç»“æ„ä¸»è¦é€šè¿‡å°†æ•°æ®å­˜å‚¨åœ¨ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œåˆ©ç”¨äº†è®¡ç®—æœºçš„å±€éƒ¨æ€§åŸç†ï¼Œä»è€Œä½¿å¾—å†…å­˜å ç”¨æœ€å°ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šå“ˆå¸Œè¡¨çš„è®¿é—®é€Ÿç‡æ˜¯O(1)ï¼Œä½†æ˜¯å¦‚æœå†²çªæ¯”è¾ƒå¤šï¼Œæœ€åä¹Ÿä¼šé™åˆ°(O(n))ã€‚å› ä¸ºå†²çªä¹‹åï¼Œå°±éœ€è¦éå†é“¾è¡¨æˆ–è€…æŸ¥çº¢é»‘æ ‘ã€‚ä½†æ˜¯ å‹ç¼©åˆ—è¡¨ zipList å’Œ ç´§å‡‘åˆ—è¡¨ ListPack æ˜¯è¿ç»­æ•°ç»„å­˜å‚¨ï¼Œè‚¯å®šèƒ½åœ¨O(1)çš„æ—¶é—´æ‰¾åˆ°è¿™ä¸ªå…ƒç´  ã€Redisä¸­HashTableçš„ç»“æ„ã€‘\nHashTable å°±æ˜¯ç”±å“ˆå¸Œè¡¨æ•°ç»„å®ç°çš„ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œ æ•ˆç‡æ¯”è¾ƒå¿«ã€‚å…·ä½“æ•°æ®ç»“æ„å¦‚ä¸‹\ntypedef struct dictht { //å“ˆå¸Œè¡¨æ•°ç»„ dictEntry **table; //å“ˆå¸Œè¡¨å¤§å° unsigned long size; //å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ (index = hash(key) \u0026amp; sizemask), sizemask = size - 1 unsigned long sizemask; //è¯¥å“ˆå¸Œè¡¨å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡ unsigned long used; } dictht; å“ˆå¸ŒèŠ‚ç‚¹dictEntry ç”±ä¸‰ä¸ªkeyã€value å’Œ ä¸‹ä¸€ä¸ªå“ˆå¸ŒèŠ‚ç‚¹æŒ‡é’ˆnextç»„æˆ\ntypedef struct dictEntry { //é”®å€¼å¯¹ä¸­çš„é”® void *key; // é”®å€¼å¯¹ä¸­çš„å€¼ union { void *val; // ç”¨äºæŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆï¼Œæ¯”å¦‚å­˜æ”¾string uint64_t u64; int64_t s64; double d; } v; //æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨ struct dictEntry *next; } dictEntry; ã€æ¸è¿›å¼æ‰©å®¹rehashã€‘\nRedisä¸­çš„hashè¡¨ç»“æ„ä¼šéšç€æ•°æ®é‡çš„å¢å¤§è€Œæ‰©å®¹, å°†æ•°ç»„çš„å¤§å°æ‰©å¼ ä¸ºåŸæ¥çš„ä¸¤å€ã€‚åœ¨æ‰©å¼ çš„è¿‡ç¨‹å½“ä¸­ï¼Œç”±äºå®¹é‡çš„å˜åŒ–ï¼Œä¼šå¯¼è‡´ä¹‹å‰çš„èŠ‚ç‚¹ï¼Œç§»åŠ¨åˆ°æ–°çš„ä½ç½®ï¼Œè¿™ä¸ªå˜åŒ–çš„è¿‡ç¨‹å°±æ˜¯ rehash å®ç°çš„ã€‚\nrehash æ‰©å®¹çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸€ä¸‹ä¸‰æ­¥:\nå¢åŠ å“ˆå¸Œè¡¨2çš„ç©ºé—´ï¼šç»™å“ˆå¸Œè¡¨2åˆ†é…ç©ºé—´ï¼Œä¸€èˆ¬æ˜¯å“ˆå¸Œè¡¨1çš„ä¸¤å€ã€‚æ­¤æ—¶ï¼Œrehash ç´¢å¼•çš„å€¼rehashidx ä» -1 æš‚æ—¶å˜æˆ 0ã€‚ è¿ç§»æ•°æ®ï¼šå°†å“ˆå¸Œè¡¨1çš„æ•°æ®è¿ç§»åˆ°å“ˆå¸Œè¡¨2 ï¼ˆè¿ç§»çš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æ˜¯åœ¨å¯¹æŒ‡å®šèŠ‚ç‚¹åšå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼Œæ‰€ä»¥å«æ¸è¿›æ‰©å®¹ï¼Œæœ‰ç‚¹ç±»ä¼¼ ConcurrentHashMap çš„æ‰©å®¹æœºåˆ¶ï¼‰ï¼Œè¿ç§»ä¹‹åï¼Œrehashidx + 1ã€‚ è¿ç§»è¿‡ç¨‹åˆ†ä¸ºå¤šæ¬¡å®Œæˆã€‚ é‡Šæ”¾åŸå“ˆå¸Œè¡¨1ï¼šè¿ç§»å®Œæˆä¹‹åï¼Œå“ˆå¸Œè¡¨1çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸”æŠŠå“ˆå¸Œè¡¨2è®¾ç½®ä¸ºå“ˆå¸Œè¡¨1ã€‚ç„¶åï¼Œå“ˆå¸Œè¡¨2å†åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å“ˆå¸Œè¡¨ã€‚ä¸ºä¸‹ä¸€æ¬¡ rehash åšå‡†å¤‡ã€‚ ã€æ³¨æ„ã€‘ rehashçš„å‡ºå‘æ¡ä»¶å’Œå…¶è´Ÿè½½å› å­ç›¸å…³ï¼Œè´Ÿè½½å› å­ = å·²å­˜å‚¨çš„å“ˆå¸Œè¡¨èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨æ€»å®¹é‡ ã€‚å½“è¾¾åˆ°ä¸‹é¢çš„ä»»ä¸€æ¡ä»¶å°±å¯èƒ½è§¦å‘ã€‚\nè´Ÿè½½å› å­ \u0026gt;= 1 ï¼Œ èµ„æºç›¸å¯¹ç´§å¼ ï¼Œå¦‚æœRedisæ²¡æœ‰åœ¨æ‰§è¡Œbgsave å’Œ bgrewriteAOF å‘½ä»¤ (ç”ŸæˆRDBæ–‡ä»¶å’ŒAOFæ–‡ä»¶)ï¼Œå°±ä¼šè§¦å‘ è´Ÿè½½å› å­ \u0026gt;= 5ï¼Œèµ„æºéå¸¸ç´§å¼ ï¼Œç›´æ¥è§¦å‘ 20. Redis String ç±»å‹çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆSDSï¼‰ Redisä¸­çš„ String ç±»å‹çš„åº•å±‚å®ç°æ˜¯ç®€å•åŠ¨æ€å­—ç¬¦ä¸² SDS, ç»“åˆ int ã€embstr ã€rawç­‰ä¸åŒçš„ç¼–ç æ–¹å¼è¿›è¡Œä¼˜åŒ–å­˜å‚¨ã€‚\nã€ç®€å•åŠ¨æ€å­—ç¬¦ä¸² SDS ç»“æ„ã€‘\nlen å­—ç¬¦æ•°ç»„é•¿åº¦ï¼šè¡¨ç¤ºæ•´ä¸ª SDS å­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ï¼Œè·å–é•¿åº¦æ—¶ç›´æ¥è¿”å›è¯¥å€¼ (æ—¶é—´å¤æ‚åº¦ o(1)) alloc åˆ†é…å†…å­˜ï¼š è¡¨ç¤ºå·²åˆ†é…å­—ç¬¦æ•°ç»„çš„å­˜å‚¨ç©ºé—´å¤§å°ï¼Œé€šè¿‡alloc - len å¯ä»¥è®¡ç®—å‰©ä½™ç©ºé—´ã€‚å¯ç”¨äºåˆ¤æ–­æ˜¯å¦æ»¡è¶³ä¿®æ”¹è¦æ±‚ï¼Œè§£å†³ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚ flags SDSç±»å‹: ä¸€å…±æœ‰ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64 äº”ç§ç±»å‹ï¼Œåé¢çš„æ•°å­—è¡¨ç¤º2çš„å¹‚æ¬¡æ–¹ï¼Œèƒ½å¤Ÿçµæ´»å­˜å‚¨ä¸åŒå¤§å°çš„å­—ç¬¦ä¸²ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ buf å­˜å‚¨æ•°æ®çš„å­—ç¬¦æ•°ç»„ï¼š ç”¨äºä¿å­˜å­—ç¬¦ä¸²ï¼ŒäºŒè¿›åˆ¶æ•°æ®ç­‰ struct __attribute__ ((__packed__)) sdshdr64 { uint64_t len; /* used */ uint64_t alloc; /* excluding the header and null terminator */ unsigned char flags; /* 3 lsb of type, 5 unused bits */ char buf[]; }; ã€Redisåº•å±‚ç»“æ„ redisObjectã€‘\nBTW, Redisçš„åº•å±‚ç»“æ„å°±æ˜¯redisObjectã€‚\nredisObject åŒ…å«æ•°æ®ç±»å‹ï¼Œç¼–ç ç±»å‹å’Œæ•°æ®æŒ‡é’ˆä¸‰ä¸ªå…ƒç´ ã€‚å…¶ä¸­ç¼–ç ç±»å‹ï¼ŒåŒ…å«intã€embstrã€raw ç­‰ç±»å‹\nstruct redisObject { unsigned type:4; // æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€å“ˆå¸Œç­‰ï¼‰ unsigned encoding:4; // ç¼–ç ç±»å‹ï¼ˆintã€embstrã€rawç­‰ï¼‰ int64_t ptr; // å®é™…çš„æ•°æ®æŒ‡é’ˆï¼Œè¿™é‡Œç›´æ¥å­˜å‚¨æ•´æ•°å€¼ }; redisObject çš„å…·ä½“ç¼–ç ç±»å‹ç”±ä¸‹é¢å‡ ä¸ªæ¡ä»¶å†³å®šï¼š\nå¦‚æœå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ•´æ•°å€¼èƒ½ç”¨long ç±»å‹è¡¨ç¤ºï¼Œè¯¥å¯¹è±¡ä¼šæŠŠæ•´æ•°å€¼å­˜å‚¨åˆ°ptr æ•°æ®æŒ‡é’ˆæŒ‡å‘çš„long ç»“æ„é‡Œé¢ ï¼ˆå°† void* è½¬ä¸º longï¼‰ï¼Œå¹¶å°†ç¼–ç è®¾ç½®ä¸ºint å¦‚æœå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„å­—ç¬¦ä¸²é•¿åº¦ \u0026lt;= 32 ä¸ªå­—èŠ‚ï¼Œä¼šç”¨ ä¸Šé¢æåˆ°çš„sds ä¿å­˜å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŠŠå¯¹è±¡ç¼–ç è®¾ç½®ä¸ºembstrã€‚ å¦‚æœå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„å­—ç¬¦ä¸²é•¿åº¦ \u0026gt; 32 ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¼šç”¨ä¸Šé¢æåˆ°çš„sds ä¿å­˜å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŠŠå¯¹è±¡ç¼–ç è®¾ç½®ä¸ºrawã€‚ ã€æ³¨æ„ã€‘\nä¸Šé¢32ä¸ªå­—èŠ‚æ˜¯redis 2.0ç‰ˆæœ¬ï¼Œredis 5.0 ç‰ˆæœ¬æ˜¯44 ä¸ªå­—èŠ‚ embstr å’Œ rawç¼–ç åŒºåˆ«ï¼šembstr åªè°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œåˆ†é…ä¸€å—è¿ç»­å†…å­˜ä¿å­˜redisObjectå’Œ SDSã€‚raw è°ƒç”¨ä¸¤æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œåˆ†åˆ«åˆ†é…ä¸¤å—å†…å­˜ç©ºé—´ä¿å­˜ redisObject å’Œ SDSã€‚ 21. Redis ä¸­çš„ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©æ˜¯ä»€ä¹ˆï¼Ÿ (ç¼“å­˜ä¸‰å…„å¼Ÿ) é—®é¢˜ç±»å‹ è¯´æ˜ è§£å†³æ–¹æ¡ˆ ç¼“å­˜ç©¿é€ æŸ¥è¯¢çš„æ•°æ®æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ•°æ®åº“å’Œç¼“å­˜éƒ½æ²¡æœ‰ã€‚æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»•è¿‡ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¯èƒ½ä¼šé­å—æ¶æ„æ”»å‡»ã€‚ 1.è¯·æ±‚å‚æ•°æ ¡éªŒ 2. ç¼“å­˜ç©ºå€¼ 3. å¸ƒéš†è¿‡æ»¤å™¨ ç¼“å­˜é›ªå´© å¤§é‡çš„ç¼“å­˜åŒæ—¶å¤±æ•ˆæˆ–è€…Rediså®•æœºäº†ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“ï¼Œå¯èƒ½é€ æˆç³»ç»Ÿå´©æºƒã€‚ 1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ 2.Redis é«˜å¯ç”¨é›†ç¾¤ 3.æœåŠ¡ç†”æ–­æˆ–é™æµ ç¼“å­˜å‡»ç©¿ æŸä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜å¤±æ•ˆï¼Œå¤§é‡å¹¶å‘è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å‰§å¢ï¼Œæ€§èƒ½ä¸‹é™ã€‚ 1. äº’æ–¥é” 2. é€»è¾‘è¿‡æœŸ ã€ç¼“å­˜ç©¿é€å…·ä½“è§£å†³æ–¹æ¡ˆã€‘\nè¯·æ±‚å‚æ•°æ ¡éªŒï¼šå¦‚æœè¯·æ±‚å‚æ•°å«æœ‰éæ³•å­—æ®µï¼Œåˆ™ç›´æ¥è¿”å›é”™è¯¯ï¼Œé¿å…è¿›ä¸€æ­¥æŸ¥è¯¢ç¼“å­˜å’Œæ•°æ®åº“\npublic boolean validateRequest(String key) { if(key == null || key.isEmpty()) { return false;\t} } ç¼“å­˜ç©ºå€¼ï¼šå¦‚æœæŸ¥åˆ°ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿå°†å…¶å­˜å…¥ç¼“å­˜ï¼Œvalue é‡‡ç”¨ â€nullâ€œ å­—ç¬¦ä¸²ã€‚åç»­æŸ¥è¯¢ï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚\npublic Object getDataWithEmptyCache(String key) { //å…ˆä»ç¼“å­˜ä¸­è·å–æ•°æ® String value = redisTemplate.opsForValue().get(key); //å¦‚æœç¼“å­˜ä¸ºç©º if (value == null) { Object databaseValue = queryFromDatabase(key);\t//ä»æ•°æ®åº“ä¸­è·å– if (databaseValue == null) { //ç¼“å­˜ç©ºå€¼ redisTemplate.opsForValue().set(key, \u0026#34;null\u0026#34;, 60, TimeUnit.SECONDS); return null; } else { redisTemplate.opsForValue().set(key, databaseValue, 3600, TimeUnit.SECONDS); return databaseValue; } } return \u0026#34;null\u0026#34;.equals(value) ? null : value; // å¦‚æœæ˜¯ç©ºå€¼ç¼“å­˜ï¼Œè¿”å› null } å¸ƒéš†è¿‡æ»¤å™¨ï¼šå†™å…¥æ•°æ®åº“æ—¶ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸€ä¸ªæ ‡è®°ï¼Œç„¶ååœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œç¡®è®¤ç¼“å­˜å¤±æ•ˆäº†ã€‚å…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ã€‚ä½†æ˜¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå‡ºç°è¯¯åˆ¤ã€‚ å› ä¸ºå¯èƒ½ä¼šå‡ºç°å“ˆå¸Œå†²çªï¼Œå¯¼è‡´ä¸€å°éƒ¨åˆ†è¯·æ±‚ç©¿é€åˆ°æ•°æ®åº“ã€‚ å¯ä»¥é‡‡ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ç±» Guava å®ç°å¸ƒéš†è¿‡æ»¤å™¨ ï¼‰\npublic class TestBloomFilter { public static void main(String[] args) { /** * æ„é€ : * ç¬¬äºŒä¸ªå‚æ•°: expectedInsertions æœŸæœ›æ’å…¥çš„å…ƒç´ æ•°é‡ * ç¬¬ä¸‰ä¸ªå‚æ•°: é¢„æµ‹é”™è¯¯ç‡ ä¼ å…¥ 0.01 è¡¨ç¤ºé¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡æ˜¯ 99% * */ BloomFilter\u0026lt;Integer\u0026gt; filter = BloomFilter.create( Funnels.integerFunnel(), 500, 0.01 ); filter.put(1); filter.put(2); filter.put(3); Assert.assertTrue(filter.mightContain(1)); Assert.assertTrue(filter.mightContain(2)); Assert.assertTrue(filter.mightContain(3)); Assert.assertFalse(filter.mightContain(1000)); } /* å½“æˆ‘ä»¬è®¾è®¡å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œä¸ºé¢„æœŸçš„å…ƒç´ æ•°é‡æä¾›ä¸€ä¸ªåˆç†å‡†ç¡®çš„å€¼æ˜¯å¾ˆé‡è¦çš„ã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬çš„è¿‡æ»¤å™¨å°†ä»¥æ¯”æœŸæœ›é«˜å¾—å¤šçš„æ¯”ç‡è¿”å›è¯¯æŠ¥ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚ å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ 1% æœŸæœ›è¯¯æŠ¥æ¦‚ç‡å’Œé¢„æœŸä¸€äº›å…ƒç´ ç­‰äº 5 çš„è¿‡æ»¤å™¨ï¼Œ ä½†éšåæˆ‘ä»¬æ’å…¥äº† 100,000 ä¸ªå…ƒç´ ï¼š */ @Test public void testOverSaturatedBloomFilter() { BloomFilter\u0026lt;Integer\u0026gt; filter = BloomFilter.create( Funnels.integerFunnel(), 5, 0.01); IntStream.range(0, 100_000).forEach(filter::put); Assert.assertTrue(filter.mightContain(1)); Assert.assertTrue(filter.mightContain(2)); Assert.assertTrue(filter.mightContain(3)); Assert.assertFalse(filter.mightContain(1000000)); //æµ‹è¯•ä¸é€šè¿‡ } } ã€ç¼“å­˜é›ªå´©å…·ä½“è§£å†³æ–¹æ¡ˆã€‘\nç¼“å­˜é›ªå´©è¦åˆ†ä¸ºä¸¤ç§ä¸åŒçš„æƒ…å†µæ¥è§£å†³ï¼šå¤§é‡keyåŒæ—¶è¿‡æœŸ å’Œ Rediså®•æœº\nã€å¤§é‡keyåŒæ—¶è¿‡æœŸã€‘\nè®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼šå†™å…¥ç¼“å­˜çš„æ—¶å€™ï¼Œç»™å…¶åœ¨åŸºç¡€æ—¶é—´ä¸Š + ä¸€ä¸ªéšæœºçš„è¿‡æœŸæ—¶é—´ äº’æ–¥é”ï¼š ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¯·æ±‚æ¥æ„å»ºç¼“å­˜ åå°æ›´æ–°ç¼“å­˜ï¼šåå°é‡‡ç”¨Scheduled çš„æ–¹å¼æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¤±æ•ˆï¼Œå¦‚æœå¤±æ•ˆäº†ï¼Œå°±æŸ¥è¯¢æ•°æ®åº“æ›´æ–°ç¼“å­˜ã€‚ ã€Rediså®•æœºã€‘\næœåŠ¡ç†”æ–­æˆ–è€…é™æµæœºåˆ¶ï¼šæš‚å®šæœåŠ¡å¯¹äºç¼“å­˜æœåŠ¡çš„è®¿é—®ï¼Œç›´æ¥è¿”å›é”™è¯¯ã€‚æˆ–è€…å¯ç”¨é™æµè§„åˆ™ï¼Œåªå…è®¸å•†å®¶è¯·æ±‚å‘é€æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œè¿‡å¤šçš„è¯·æ±‚å°±ä¼šæ‹’æ¥ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨Hystrix æˆ–è€… Sentinel å®ç°ç†”æ–­æˆ–è€…é™æµ\n@HystrixCommand(fallbackMethod = \u0026#34;fallbackMethod\u0026#34;) public String getDataFromCache(String key) { // ä» Redis è·å–æ•°æ® return redisTemplate.opsForValue().get(key); } public String fallbackMethod(String key) { return \u0026#34;æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•ï¼\u0026#34;; // ç†”æ–­å¤„ç†é€»è¾‘ } æ„å»ºRedisç¼“å­˜é«˜å¯ç”¨é›†ç¾¤: å¦‚æœå•ä¸ªç¼“å­˜æœåŠ¡èŠ‚ç‚¹å‘ç”Ÿæ•…éšœè‡ªåŠ¨è¿ç§»è®¿é—®æµé‡åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹.\nã€ç¼“å­˜å‡»ç©¿å…·ä½“è§£å†³æ–¹æ¡ˆã€‘\näº’æ–¥é”ï¼šåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹æ›´æ–°ç¼“å­˜ã€‚æœªè·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œå¯ä»¥ç­‰å¾…é”é‡Šæ”¾åè¯»å–ç¼“å­˜ï¼Œæˆ–è€…è¿”å›ç©ºå€¼/é»˜è®¤å€¼ã€‚ (å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜)\né€»è¾‘è¿‡æœŸï¼šä¸ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œvalue é‡‡ç”¨ hash çš„æ–¹å¼ï¼Œè®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ã€‚æ¯æ¬¡åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œæœªè¿‡æœŸç›´æ¥è¿”å›æ•°æ®ã€‚å¦‚æœå·²ç»è¿‡æœŸäº†ï¼Œåˆ™è·å–äº’æ–¥é”é‡å»ºç¼“å­˜ï¼Œç„¶åé‡Šæ”¾é”ã€‚å¦‚æœè·å–äº’æ–¥é”å¤±è´¥ï¼Œåˆ™è¿”å›å·²è¿‡æœŸç¼“å­˜æ•°æ®ã€‚\næœåŠ¡ç†”æ–­æˆ–è€…é™æµæœºåˆ¶\n22.Redis æ•°æ®è¿‡æœŸåçš„åˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ ã€Redisè¿‡æœŸåˆ é™¤ç­–ç•¥ã€‘\nRedisé‡‡ç”¨çš„æ˜¯ å®šæœŸåˆ é™¤ + æƒ°æ€§åˆ é™¤ çš„ç»“åˆæ–¹å¼\nç­–ç•¥ å®ç°æ–¹å¼ ä¼˜ç¼ºç‚¹ å®šæœŸåˆ é™¤ Redisæ¯ä¸ªä¸€æ®µæ—¶é—´ (é»˜è®¤ä¸º100ms éšæœºæ£€æŸ¥ ä¸€å®šæ•°é‡çš„é”®ï¼Œéå…¨éƒ¨key)ï¼Œè¿‡æœŸåˆ™åˆ é™¤ å¯ä»¥å‡å°‘å†…å­˜å ç”¨, ä½†æ˜¯å¯¹CPUæœ‰ä¸€å®šæ¶ˆè€—ï¼Œä¸”ä¸èƒ½ä¿è¯åŠæ—¶åˆ é™¤æ‰€æœ‰è¿‡æœŸé”® æƒ°æ€§åˆ é™¤ å½“å®¢æˆ·ç«¯è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼ŒRedisä¼šæ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè‹¥è¿‡æœŸåˆ™ç«‹å³åˆ é™¤ å¯¹CPUå‹å¥½ï¼Œå¤§é‡è¿‡æœŸé”®æœªè¢«è®¿é—®æ—¶ä»å ç”¨å†…å­˜ ã€å®šæœŸåˆ é™¤ç»†èŠ‚ã€‘\nRedisä¼šå‘¨æœŸæ€§æ‰§è¡Œè¿‡æœŸkeyæ£€æŸ¥ï¼Œé»˜è®¤æ¯100ms æ‰§è¡Œä¸€æ¬¡ æ¯æ¬¡æ£€æŸ¥ä¼šéšæœºæŠ½å–éƒ¨åˆ†keyï¼Œé»˜è®¤æ¯æ¬¡ 20 ä¸ªï¼Œ åˆ¤æ–­æ˜¯å¦è¿‡æœŸ ä¸ºäº†é¿å…è¿‡å¤šçš„CPUå ç”¨ï¼ŒRedisé™åˆ¶æ£€æŸ¥çš„æ‰§è¡Œæ—¶é—´ (é»˜è®¤ä¸ºæ‰§è¡Œæ—¶é—´çš„25%ï¼Œä¹Ÿå°±æ˜¯25ms) å’Œ è¿‡æœŸé”®çš„æ¯”ä¾‹ (é»˜è®¤åªæ£€æŸ¥ 10% ) å¦‚æœè¿‡æœŸé—´æ¯”ä¾‹è¶…è¿‡é™åˆ¶ï¼Œåˆ™ä¼šé‡å¤æ£€æŸ¥ä»¥æé«˜æ¸…ç†æ•ˆç‡ ã€ä¸ºä»€ä¹ˆRedisåˆ é™¤ä¸ç›´æ¥å§æ‰€æœ‰è¿‡æœŸkeyéƒ½åˆ é™¤äº†ï¼Ÿã€‘\nå®šæœŸåˆ é™¤ä¸èƒ½é™¤æ‰€æœ‰è¿‡æœŸkeyåŸå› : å¦‚æœä¸€æ¬¡æ€§æ¸…ç†æ‰€æœ‰è¿‡æœŸé—´,å¯èƒ½ä¼šå¯¼è‡´Redisé•¿æ—¶é—´é˜»å¡ï¼Œå½±å“æ€§èƒ½ã€‚éšæœºæŠ½æ ·å’Œæ—¶é—´é™åˆ¶çš„æ–¹å¼èƒ½åœ¨æ¸…ç†å†…å­˜å’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ã€‚ æƒ°æ€§åˆ é™¤ä¸èƒ½åˆ é™¤æ‰€æœ‰è¿‡æœŸkeyåŸå› ï¼šæƒ°æ€§åˆ é™¤æ—¨åœ¨è®¿é—®keyçš„æ—¶å€™è§¦å‘ï¼Œå¦‚æœæ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œå°±å¯èƒ½ä¸€è‡´å­˜åœ¨ï¼Œæ— æ³•æ¸…ç†ã€‚ ã€å¦‚ä½•ä¼˜åŒ–å¤§é‡keyé›†ä¸­è¿‡æœŸçš„æƒ…å†µ - ç¼“å­˜é›ªå´©ã€‘\nè®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼ŒåŠ ä¸Šä¸€ä¸ªéšæœºå€¼ å¼€å¯lazy free æœºåˆ¶ï¼š é…ç½® lazyfree-lazy-expireï¼Œ è®©è¿‡æœŸçš„keyåˆ é™¤æ“ä½œç”±åå°çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œå‡å°‘ä¸»çº¿ç¨‹çš„å‹åŠ› 23. å¦‚ä½•è§£å†³ Redis ä¸­çš„çƒ­ç‚¹ key é—®é¢˜ï¼Ÿ çƒ­ç‚¹ key æ˜¯æŒ‡è®¿é—®é¢‘ç‡æ˜¾è‘—é«˜äºå…¶ä»– key çš„é”®ï¼Œé€šå¸¸è¡¨ç°ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š\nç±»åˆ« ç‰¹æ€§ QPS é›†ä¸­ æŸä¸ªkey çš„QPS (æ¯ç§’è¯·æ±‚é‡) å Redisæ€»QPSçš„è¾ƒå¤§æ¯”ä¾‹ å¸¦å®½é›†ä¸­ æŸä¸ªkey çš„æ•°æ®é‡è¾ƒå¤§(æ¯”å¦‚1MB ä»¥ä¸Šçš„hash æ•°æ®)ï¼Œè¢«é¢‘ç¹è¯·æ±‚ CPUæ¶ˆè€—é›†ä¸­ æŸä¸ªkeyçš„å¤æ‚æ“ä½œ(æ¯”å¦‚ZRANGEæŸ¥è¯¢è¾ƒå¤§çš„ZSetæ•°æ®) å ç”¨Redisè¿‡å¤šCPUæ—¶é—´ çƒ­ç‚¹key é—®é¢˜å°±æ˜¯æŸä¸ªç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚é›†ä¸­è®¿é—®Redisé‡Œçš„åŒä¸€ä¸ªå›ºå®škeyï¼Œå‡å¦‚çƒ­ç‚¹keyè¿‡æœŸï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜å‡»ç©¿ï¼Œè®©å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“é‡Œé¢ã€‚åƒçƒ­ç‚¹æ–°é—»ã€çƒ­ç‚¹è¯„è®ºã€æ˜æ˜Ÿç›´æ’­ è¿™ç§è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°çƒ­ç‚¹key é—®é¢˜ã€‚å› ä¸ºRedisçš„å•èŠ‚ç‚¹æŸ¥è¯¢æ€§èƒ½ä¸€èˆ¬åœ¨ 2w QPSï¼Œ ä¸€èˆ¬è¶…è¿‡ è¿™ä¸ªæ•°å€¼ï¼Œå¯èƒ½å°±ä¼šå®•æœºã€‚\nã€çƒ­ç‚¹keyçš„å±å®³ã€‘\næ¶ˆè€—CPUå’Œå¸¦å®½èµ„æºï¼š çƒ­ç‚¹ key å¯èƒ½å ç”¨Rediså¤§éƒ¨åˆ†èµ„æºï¼Œå½±å“å…¶ä»–è¯·æ±‚çš„å¤„ç†æ—¶é—´ Rediså®•æœºé£é™©: å¦‚æœè¶…è¿‡Redisæ‰€èƒ½æ‰¿è½½çš„æœ€å¤§QPSï¼Œ å¯èƒ½ä¼šå¯¼è‡´Rediså®•æœºã€‚ç„¶åå¤§é‡çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å´©æºƒã€‚ ã€å¦‚ä½•å‘ç°çƒ­ç‚¹keyã€‘\næ ¹æ®ä¸šåŠ¡ç»éªŒåˆ¤æ–­ï¼šæ¯”å¦‚åƒæ˜æ˜Ÿå…«å¦çˆ†æ–™ã€é‡å¤§æ–°é—»ã€çƒ­ç‚¹è¯„è®ºéƒ½ä¼šèƒ½ä¼šå¯¼è‡´çƒ­ç‚¹keyã€‚ å¥½å¤„æ˜¯ä¸éœ€è¦æ¶ˆè€—ä»€ä¹ˆæˆæœ¬ï¼Œåå¤„æ˜¯æ— æ³•é¢„é˜²çªå‘æƒ…å†µã€‚ Redisè¿›è¡Œé›†ç¾¤ç›‘æ§ï¼š æŸ¥çœ‹å“ªä¸ªRediså‡ºç°äº† QPS å€¾æ–œï¼Œå‡ºç°QPSå€¾æ–œçš„å®ä¾‹æœ‰å¾ˆå¤§æ¦‚ç‡å­˜åœ¨çƒ­ç‚¹key hotkey ç›‘æ§ï¼šå‘½ä»¤è¡Œæ‰§è¡Œredis-cli çš„æ—¶å€™æ·»åŠ --hotkeys å‚æ•°ï¼Œå®ƒæ˜¯åŸºäºscan + object freq æ‰«æç›®æ ‡å‡ºç°é¢‘ç‡æ—¶é—´çš„ã€‚ä½†æ˜¯éœ€è¦è®¾ç½®maxmemory-policy å‚æ•°ï¼Œæ¥é‡‡ç”¨ä¸åŒçš„æ·˜æ±°æ‰‹æ®µï¼š volatile-lfu (least frequently used)ï¼š æ·˜æ±°å·²ç»è¿‡æœŸæ•°æ®é›†ä¸­æœ€ä¸å¸¸ç”¨çš„æ•°æ® allkeys-lfuï¼šå½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œç§»é™¤æœ€ä¸å¸¸ç”¨çš„key monitor å‘½ä»¤ï¼š é›†åˆä¸€äº›Redisçš„æ—¥å¿—å’Œç›¸å…³åˆ†æå·¥å…·è¿›è¡Œç»Ÿè®¡, éå¸¸æ¶ˆè€—æ€§èƒ½, å•å®¢æˆ·ç«¯ä¼šæ¶ˆè€— 50% çš„æ€§èƒ½ ä»£ç†å±‚æ”¶é›†ï¼šåˆ©ç”¨æœ‰äº›æœåŠ¡åœ¨è¯·æ±‚Rediså‰ä¼šå…ˆè¯·æ±‚ä»£ç†æœåŠ¡çš„ç‰¹ç‚¹, åœ¨ä»£ç†å±‚ç»Ÿä¸€æ”¶é›†Redisçƒ­keyæ•°æ®ã€‚æ¯”å¦‚é‡‡ç”¨ äº¬ä¸œçš„ JD-hotkeyã€æœ‰èµé€æ˜å¤šçº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ(TMC) å®¢æˆ·ç«¯æ”¶é›†ï¼šåœ¨æ“ä½œRediså‰æ·»åŠ ç»Ÿè®¡æ¯ä¸ªkeyçš„æŸ¥è¯¢é¢‘æ¬¡ï¼Œå°†ç»Ÿè®¡æ•°æ®å‘é€åˆ°èšåˆè®¡ç®—å¹³å°è®¡ç®—ï¼Œä¹‹åæŸ¥çœ‹ç»“æœã€‚å¯¹æ€§èƒ½æ¶ˆè€—è¾ƒä½ï¼Œä½†æ˜¯æˆæœ¬æ¯”è¾ƒå¤§ï¼Œéœ€è¦ä»‹å…¥èšåˆè®¡ç®—å¹³å°ã€‚ ã€å¦‚ä½•è§£å†³çƒ­ç‚¹keyã€‘\nå¤šçº§ç¼“å­˜ï¼šç»“åˆä½¿ç”¨ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜å°±æ˜¯åº”ç”¨ç¨‹åºçš„æœ¬åœ°ç¼“å­˜ï¼Œæ¯”å¦‚JVMå†…å­˜ä¸­çš„ç¼“å­˜ï¼Œå¯é‡‡ç”¨Caffeine ã€é˜¿é‡Œå·´å·´jetcache )ã€‚ äºŒçº§ç¼“å­˜æ˜¯Redisç¼“å­˜ï¼Œå½“ä»¥åŠç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå†è®¿é—®äºŒçº§ç¼“å­˜ã€‚\né’ˆå¯¹çƒ­ç‚¹keyè¯·æ±‚, æœ¬åœ°ä¸€çº§ç¼“å­˜å¯ä»¥å°†åŒä¸€ä¸ªkeyçš„å¤§é‡è¯·æ±‚ï¼Œæ ¹æ®ç½‘ç»œå±‚è´Ÿè½½å‡è¡¡åˆ°ä¸åŒçš„æœºå™¨èŠ‚ç‚¹ä¸Šï¼Œé¿å…å…¨éƒ¨æ‰“åˆ°å•ä¸ªRedisèŠ‚ç‚¹çš„æƒ…å†µï¼Œå‡å°‘ç½‘ç»œäº¤äº’ã€‚ä½†æ˜¯éœ€è¦è€—è´¹æ›´å¤šçš„ç»å†å»ä¿è¯åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§ï¼Œä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚\nçƒ­ç‚¹keyå¤‡ä»½ï¼šåœ¨å¤šä¸ªRedisèŠ‚ç‚¹ä¸Šå¤‡ä»½çƒ­keyï¼Œé¿å…å›ºå®škeyæ€»æ˜¯è®¿é—®åŒä¸€ä¸ªRedisèŠ‚ç‚¹ã€‚é€šè¿‡åˆå§‹åŒ–æ—¶ä¸ºkey æ‹¼æ¥ 0~2n (nä¸ºé›†ç¾¤æ•°é‡) ä¹‹é—´çš„éšæœºæ•°ï¼Œè®©å…¶æ•£è½åœ¨å„ä¸ªå§ç”µå•†ã€‚è‹¥æœ‰çƒ­ç‚¹keyè¯·æ±‚çš„æ—¶å€™ï¼Œéšæœºé€‰ä¸€ä¸ªå¤‡ä»½çš„èŠ‚ç‚¹è¿›è¡Œå–å€¼ã€‚å¯ä»¥æœ‰æ•ˆå‡è½»å•ä¸ªRedisèŠ‚ç‚¹çš„è´Ÿæ‹…ã€‚ çƒ­ç‚¹keyæ‹†åˆ†ï¼šå°†çƒ­ç‚¹keyæ‹†åˆ†ä¸ºå¤šä¸ªå¸¦åç¼€åçš„keyï¼Œè®©å…¶åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªå®ä¾‹å½“ä¸­ã€‚å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™æŒ‰ç…§è§„åˆ™è®¡ç®—å‡ºå›ºå®škeyï¼Œç„¶åè¯·æ±‚å¯¹åº”çš„RedisèŠ‚ç‚¹ã€‚æ¯”å¦‚â€œæŸéŸ³çƒ­æœæŸæ˜æ˜Ÿç¦»å©šâ€ã€‚å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå¸¦ç¼–å·åç¼€çš„keyå­˜å‚¨åœ¨ä¸åŒçš„èŠ‚ç‚¹ï¼Œç”¨æˆ·æŸ¥è¯¢æ—¶æ ¹æ®ç”¨æˆ·id ç®—å‡ºè¦è®¿é—®çš„å¯¹åº”èŠ‚ç‚¹ã€‚è™½ç„¶ç”¨æˆ·åªèƒ½çœ‹åˆ°ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç­‰å¾…çƒ­ç‚¹é™æ¸©åå†æ±‡æ€»æ•°æ®ï¼ŒæŒ‘é€‰ä¼˜è´¨å†…å®¹é‡æ–°æ¨é€ç»™æœªæ”¶åˆ°çš„ç”¨æˆ·ã€‚ ã€æ³¨æ„ã€‘ çƒ­ç‚¹keyå¤‡ä»½å’Œçƒ­ç‚¹keyæ‹†åˆ†çš„åŒºåˆ«åœ¨äºï¼Œçƒ­ç‚¹keyå¤‡ä»½æ˜¯åŒä¸€ä»½æ•°æ®å…¨é‡å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œçƒ­ç‚¹keyæ‹†åˆ†æ˜¯æŠŠä¸€ä»½æ•°æ®æ‹†åˆ†æˆå¤šä»½ã€‚\nRedisé›†ç¾¤ + è¯»å†™åˆ†ç¦»: å¢åŠ Redisä»èŠ‚ç‚¹, åˆ†æ•£è¯»è¯·æ±‚å‹åŠ›ã€‚ç„¶ååˆ©ç”¨é›†ç¾¤ï¼Œå¯ä»¥å°†çƒ­ç‚¹keyæ‹†åˆ†æˆ–è€…å¤‡ä»½åˆ°ä¸åŒçš„Rediså®ä¾‹ä¸Šã€‚ é™æµå’Œé™çº§ï¼šé‡‡ç”¨é™æµç­–ç•¥ï¼Œå‡å°‘å¯¹Redisçš„è¯·æ±‚ï¼Œåœ¨å¿…è¦çš„æ—¶å€™è¿”å›é™çº§çš„æ•°æ®æˆ–è€…ç©ºå€¼ã€‚ 24. Redis ä¸­çš„ Big Key é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ Rediså½“ä¸­çš„ Big Key (ä¹Ÿå¯ä»¥å«big memory key)æ˜¯æŒ‡æŸä¸ªkey å¯¹åº”çš„valueæ•°æ®é‡è¿‡å¤§ï¼Œæ¯”å¦‚åŒ…å«å¤§é‡å…ƒç´ çš„Listã€Hashã€Setã€ZSet æˆ–è¶…é•¿å­—ç¬¦ä¸²), å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆå’Œç³»ç»Ÿä¸ç¨³å®šã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒString ç±»å‹çš„value è¶…è¿‡ 1MB ï¼Œæˆ–è€…ç¬¦åˆç±»å‹å½“ä¸­çš„å…ƒç´ è¶…è¿‡5000ä¸ªï¼Œå°±ç®—big keyã€‚\nã€Big Key å…¸å‹åœºæ™¯ã€‘\nString: å­˜å‚¨è¶…å¤§JSONæ–‡æœ¬ã€å›¾ç‰‡base64æ•°æ®ç­‰ Hashï¼šå­˜å‚¨æµ·é‡çš„å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ·çš„è¡Œä¸ºè®°å½• List / Setï¼šå­˜å‚¨ç™¾ä¸‡ä¸ªå…ƒç´  ZSetï¼š åŒ…å«å¤§é‡çš„æ’åºå…ƒç´  ã€Big Key å¯¼è‡´çš„é—®é¢˜ã€‘\næ€§èƒ½é—®é¢˜ï¼šRedisæ˜¯å•çº¿ç¨‹å¤„ç†æœºåˆ¶ï¼Œåœ¨å¤„ç†big keyçš„æ—¶å€™ï¼Œéœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œé˜»å¡å·¥ä½œæµç¨‹ï¼Œæ²¡æ³•å„¿å¤„ç†åé¢çš„å‘½ä»¤ã€‚å¦‚æœå¤„ç†çš„æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´å®¢æˆ·ç«¯é•¿æ—¶é—´æœªæ”¶åˆ°å“åº”ã€‚å¦å¤–ï¼Œbig key å ç”¨çš„å¸¦å®½è¿‡é«˜ï¼Œä¼ è¾“æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¹Ÿå®¹æ˜“å¯¼è‡´é˜»å¡ã€‚ å†…å­˜é—®é¢˜ï¼šbig key ä¼šå¯¼è‡´Rediså†…å­˜å˜å¾—å¾ˆå¤§ï¼Œå¢åŠ å†…å­˜ç¢ç‰‡åŒ–é£é™©ã€‚å•æ¬¡å¤§å¯¹è±¡å†…å­˜åˆ†é…å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´æ•´ä¸ªRedisæœåŠ¡å´©æºƒã€‚é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä¼šå‡ºç°æ•°æ®å’ŒæŸ¥è¯¢å€¾æ–œçš„æƒ…å†µï¼Œbig key çš„ RedisèŠ‚ç‚¹ä¼šå ç”¨è¾ƒå¤šçš„å†…å­˜ æŒä¹…åŒ–é—®é¢˜ï¼šå¦‚æœAOFå†™å›ç­–ç•¥ä¸ºalwaysï¼Œä¹Ÿå°±æ˜¯è¯´ä¸»çº¿ç¨‹æ‰§è¡Œå®ŒæŒ‡ä»¤ä¹‹åï¼ŒæŠŠå¯¹åº”æ•°æ®å†™å…¥AOFæ–‡ä»¶åï¼Œç›´æ¥ fsync å†™å…¥ç£ç›˜æ“ä½œã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¤§keyï¼Œ é˜»å¡çš„æ—¶é—´å¯èƒ½æ¯”è¾ƒå°±ï¼ŒåŒæ­¥åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹å¾ˆè€—æ—¶ã€‚ ã€å¦‚ä½•æ‰¾Big Keyã€‘\nå†…ç½®--bigkeysï¼š é‡‡ç”¨å†…ç½®çš„--bigkeyså‘½ä»¤ï¼ŒåŸºäºscan æŸ¥æ‰¾æ‰€æœ‰çš„big key\nredis-cli --bigkeys ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·\nhttps://github.com/sripathikrishnan/redis-rdb-tools https://github.com/weiyanwei412/rdb_bigkeys ã€å¦‚ä½•å¤„ç†Big Keyé—®é¢˜ã€‘\nBig Key é—®é¢˜å¯ä»¥ä»ä¸‹é¢è¯´ä¸‰ä¸ªå±‚é¢æ¥è§£å†³ï¼š\nå¼€å‘å±‚é¢ï¼šå°†æ•°æ®å‹ç¼©åå†å­˜; å°†å¤§JSONå¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªå°å­—æ®µ; å°†æ•°æ®ä¿å­˜ä¸ºæ›´åˆç†çš„æ•°æ®ç»“æ„ (åˆ©ç”¨hashæ›¿ä»£å¤§å­—ç¬¦ä¸²); é¿å…ä¼šé€ æˆé˜»å¡çš„å‘½ä»¤\nä¸šåŠ¡å±‚é¢ï¼šè°ƒæ•´å­˜å‚¨ç­–ç•¥ï¼Œåªå­˜å‚¨å¿…è¦çš„æ•°æ® (æ¯”å¦‚ç”¨æˆ·çš„æ”¶è´§åœ°å€ç­‰ä¸å¸¸ç”¨ä¿¡æ¯ä¸å­˜å‚¨ï¼Œåªå­˜å‚¨ç”¨æˆ·IDã€å§“åã€å¤´åƒç­‰); ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨æ›´å°çš„æ•°æ®æ¥æ»¡è¶³ä¸šåŠ¡è¦æ±‚; è§„åˆ’å¥½æ•°æ®çš„ç”Ÿå‘½\næ¶æ„å±‚é¢ï¼šé‡‡ç”¨Redisé›†ç¾¤çš„æ–¹å¼è¿›è¡ŒRediséƒ¨ç½²ï¼Œç„¶åå°†å¤§Keyæ‹†åˆ†æ•£è½åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šé¢, åŠ å¿«å“åº”é€Ÿåº¦\n","permalink":"https://swimmingliu.cn/posts/job/redis-interview-questions/","summary":"\u003ch2 id=\"1-redisä¸»ä»å¤åˆ¶çš„åŸç†\"\u003e1. Redisä¸»ä»å¤åˆ¶çš„åŸç†\u003c/h2\u003e\n\u003cp\u003eã€\u003cstrong\u003eä¸»ä»å¤åˆ¶çš„åŸç†\u003c/strong\u003eã€‘\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eåŒæ­¥ï¼šä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€\u003ccode\u003epsync\u003c/code\u003eå‘½ä»¤è¿›è¡ŒåŒæ­¥ï¼Œä»èŠ‚ç‚¹ä¿å­˜ä¸»èŠ‚ç‚¹è¿”å›çš„ \u003ccode\u003erunid\u003c/code\u003e å’Œ \u003ccode\u003e offset\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eå…¨é‡å¤åˆ¶ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥æˆ–è€…è¿æ¥å¤±è´¥ä¸”\u003ccode\u003erepl_backlog_buffer\u003c/code\u003e ç¼“å­˜åŒºä¸åŒ…å«\u003ccode\u003eslave_repl_offset\u003c/code\u003eï¼Œ åˆ™ç”Ÿæˆä¸»èŠ‚ç‚¹çš„æ•°æ®å¿«ç…§(RDBæ–‡ä»¶)å‘ç»™ä»èŠ‚ç‚¹\u003c/li\u003e\n\u003cli\u003eå¢é‡å¤åˆ¶ï¼šå…¨é‡å¤åˆ¶å®Œæ¯•åï¼Œä¸»ä»èŠ‚ç‚¹ä¹‹é—´ä¼šä¿æŒé•¿è¿æ¥ã€‚å¦‚æœè¿æ¥æ²¡æœ‰æ–­å¼€æˆ–è€…\u003ccode\u003eslave_repl_offset\u003c/code\u003eä»ç„¶åœ¨\u003ccode\u003erepl_backlog_buffer\u003c/code\u003eä¸­ï¼Œåˆ™å°†åç»­çš„å†™æ“ä½œä¼ é€’ç»™ä»èŠ‚ç‚¹ï¼Œè®©æ•°æ®ä¿æŒä¸€è‡´ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eã€å…¨é‡å¤åˆ¶ç»†èŠ‚ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå…¨é‡å¤åˆ¶çš„è¿‡ç¨‹æ˜¯åŸºäºTCPé•¿è¿æ¥çš„ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eä»èŠ‚ç‚¹å‘é€\u003ccode\u003epsync ? -1\u003c/code\u003eè¡¨ç¤ºéœ€è¦å»ºç«‹è¿æ¥è¿›è¡ŒåŒæ­¥ï¼Œä¸»èŠ‚ç‚¹è¿”å›ä¸»èŠ‚ç‚¹ID \u003ccode\u003erunid\u003c/code\u003e å’Œ å¤åˆ¶è¿›åº¦\u003ccode\u003eoffset\u003c/code\u003e (ç¬¬ä¸€æ¬¡åŒæ­¥ç”¨ -1 è¡¨ç¤º)ã€‚ä»èŠ‚ç‚¹æ¥å—ä¹‹åï¼Œä¿å­˜ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\u003c/li\u003e\n\u003cli\u003eä¸»èŠ‚ç‚¹æ‰§è¡Œ\u003ccode\u003ebgsave\u003c/code\u003eå‘½ä»¤ç”Ÿæˆæ•°æ®å¿«ç…§RDBæ–‡ä»¶ï¼Œç„¶åå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹æ¥å—æ–‡ä»¶åï¼Œæ¸…é™¤ç°æœ‰çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶ååŠ è½½RDBæ–‡ä»¶\u003c/li\u003e\n\u003cli\u003eå¦‚æœåœ¨åˆ¶ä½œæ•°æ®å¿«ç…§RDBæ–‡ä»¶çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°äº†æ–°çš„å†™æ“ä½œï¼Œä¸»èŠ‚ç‚¹ä¼šå°†å…¶è®°å½•åœ¨\u003ccode\u003erepl buffer\u003c/code\u003e é‡Œé¢ã€‚ç„¶åå°†\u003ccode\u003erepl buffer\u003c/code\u003eå½“ä¸­çš„å†™æ“ä½œå‘ç»™ä»èŠ‚ç‚¹ï¼Œè®©å…¶æ•°æ®ä¿æŒä¸€è‡´ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg alt=\"Redisä¸»ä»å…¨é‡å¤åˆ¶\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/ac630d4c-ef8d-11ef-a882-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€å¢é‡å¤åˆ¶ç»†èŠ‚ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚æœä¸»ä»èŠ‚ç‚¹æ„å¤–æ–­å¼€è¿æ¥ï¼Œä¸ºäº†ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¿…é¡»é‡æ–°åŒæ­¥æ•°æ®ã€‚å¦‚æœä½¿ç”¨å…¨é‡å¤åˆ¶æ¥ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œå¼€é”€å¤ªå¤§ï¼Œæ‰€ä»¥é‡‡ç”¨å¢é‡å¤åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eå¢é‡å¤åˆ¶çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eè¿æ¥æ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå‘é€\u003ccode\u003epsync {runid} {offset}\u003c/code\u003eï¼Œ å…¶ä¸­ä¸»èŠ‚ç‚¹ID \u003ccode\u003erunid\u003c/code\u003e å’Œ å¤åˆ¶è¿›åº¦\u003ccode\u003eoffset\u003c/code\u003eç”¨äºæ ‡è¯†æ˜¯å“ªä¸€ä¸ªæœåŠ¡å™¨ä¸»æœºå’Œå¤åˆ¶è¿›åº¦ã€‚\u003c/li\u003e\n\u003cli\u003eä¸»èŠ‚ç‚¹æ”¶åˆ°\u003ccode\u003epsync\u003c/code\u003e å‘½ä»¤ä¹‹åï¼Œä¼šç”¨\u003ccode\u003econitnue\u003c/code\u003eå“åº”å‘ŠçŸ¥ä»èŠ‚ç‚¹ï¼Œé‡‡ç”¨å¢é‡å¤åˆ¶åŒæ­¥æ•°æ®\u003c/li\u003e\n\u003cli\u003eæœ€åï¼Œä¸»èŠ‚ç‚¹æ ¹æ®\u003ccode\u003eoffset\u003c/code\u003eæŸ¥æ‰¾å¯¹åº”çš„è¿›åº¦ï¼Œå°†æ–­çº¿æœŸé—´æœªåŒæ­¥çš„å†™å‘½ä»¤ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œä¸»èŠ‚ç‚¹å°†æ‰€æœ‰çš„å†™å‘½ä»¤å†™å…¥\u003ccode\u003erepl_backlog_buffer\u003c/code\u003eï¼Œ ç”¨äºåç»­åˆ¤æ–­æ˜¯é‡‡ç”¨å¢é‡å¤åˆ¶è¿˜æ˜¯å…¨é‡å¤åˆ¶ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eã€æ³¨æ„ã€‘ä»èŠ‚ç‚¹ \u003ccode\u003epsync\u003c/code\u003e æºå¸¦çš„ \u003ccode\u003eoffset\u003c/code\u003e ä¸º \u003ccode\u003eslave_repl_offset\u003c/code\u003eã€‚å¦‚æœ \u003ccode\u003erepl_backlog_buffer\u003c/code\u003eåŒ…å«\u003ccode\u003eslave_repl_offset\u003c/code\u003e å¯¹åº”çš„éƒ¨åˆ†ï¼Œåˆ™é‡‡ç”¨å¢é‡å¤åˆ¶ï¼Œå¦åˆ™é‡‡ç”¨å…¨é‡å¤åˆ¶ã€‚\u003ccode\u003erepl_backlog_buffer\u003c/code\u003eçš„é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º\u003ccode\u003e1M\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Redisä¸»ä»å¢é‡å¤åˆ¶\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/ac9f21a3-ef8d-11ef-9016-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003eã€\u003cstrong\u003eä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶\u003c/strong\u003eã€‘\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå¤‡ä»½æ•°æ®\u003c/strong\u003eï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„æ•°æ®å†—ä½™æ–¹å¼\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ•…éšœæ¢å¤\u003c/strong\u003eï¼šå½“ä¸»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œå¯ä»¥é‡‡ç”¨ä»èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè´Ÿè½½å‡è¡¡\u003c/strong\u003e:  ä¸»ä»å¤åˆ¶å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œåªæœ‰ä¸»èŠ‚ç‚¹æ”¯æŒè¯»å†™æ“ä½œï¼Œä»èŠ‚ç‚¹åªæœ‰è¯»æ“ä½œã€‚åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"Redisä¸»ä»è¯»å†™åˆ†ç¦»\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/acad0d12-ef8d-11ef-b17f-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2-redisé›†ç¾¤çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ\"\u003e2. Redisé›†ç¾¤çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ?\u003c/h2\u003e\n\u003cp\u003eã€\u003cstrong\u003eRedisé›†ç¾¤åŸºæœ¬çŸ¥è¯†\u003c/strong\u003eã€‘\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003e: Redisé›†ç¾¤ç”±å¤šä¸ªå®ä¾‹ç»„æˆï¼Œæ¯ä¸ªå®ä¾‹å­˜å‚¨éƒ¨åˆ†æ•°æ® (æ¯ä¸ªå®ä¾‹ä¹‹é—´çš„æ•°æ®ä¸é‡å¤) ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã€æ³¨ã€‘é›†ç¾¤å’Œä¸»ä»èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œé›†ç¾¤çš„æŸä¸€ä¸ªå®ä¾‹å½“ä¸­å¯èƒ½åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ + å¤šä¸ªä»èŠ‚ç‚¹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eä¸ºä»€ä¹ˆç”¨\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eé—®é¢˜\u003c/th\u003e\n          \u003cth\u003eè§£å†³æ–¹æ¡ˆ\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eå®¹é‡ä¸è¶³\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®åˆ†ç‰‡ï¼Œå°†æ•°æ®åˆ†æ•£ä¸å­˜åˆ°ä¸åŒçš„ä¸»èŠ‚ç‚¹\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eé«˜å¹¶å‘å†™å…¥\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®åˆ†ç‰‡ï¼Œå°†å†™å…¥è¯·æ±‚åˆ†æ‘Šåˆ°å¤šä¸ªä¸»èŠ‚ç‚¹\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eä¸»æœºå®•æœºé—®é¢˜\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eè‡ªåŠ¨åˆ‡æ¢ä¸»ä»èŠ‚ç‚¹ï¼Œé¿å…å½±å“æœåŠ¡ï¼Œ ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eèŠ‚ç‚¹é€šä¿¡åè®®\u003c/strong\u003eï¼šRedisé›†ç¾¤é‡‡ç”¨Gossipåè®®, æ”¯æŒåˆ†å¸ƒå¼ä¿¡æ¯ä¼ æ’­ã€å»¶è¿Ÿä½ã€æ•ˆç‡é«˜ã€‚é‡‡ç”¨å»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œä»»æ„å®ä¾‹(ä¸»èŠ‚ç‚¹)éƒ½å¯ä»¥ä½œä¸ºè¯·æ±‚å…¥å£ï¼ŒèŠ‚ç‚¹é—´ç›¸äº’é€šä¿¡ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåˆ†ç‰‡åŸç†\u003c/strong\u003eï¼š é‡‡ç”¨å“ˆå¸Œæ§½(Hash Slot)æœºåˆ¶æ¥åˆ†é…æ•°æ®ï¼Œæ•´ä¸ªç©ºé—´å¯ä»¥åˆ’åˆ†ä¸º\u003cstrong\u003e16384\u003c/strong\u003e (16 * 1024)ä¸ªæ§½ã€‚ æ¯ä¸ªRedisè´Ÿè´£ä¸€å®šèŒƒå›´çš„å“ˆå¸Œæ§½,æ•°æ®çš„keyç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—ä¹‹åå¯¹\u003cstrong\u003e16384\u003c/strong\u003eå–ä½™å¯å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"Redisé›†ç¾¤æ¶æ„å›¾\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/acc54635-ef8d-11ef-971e-c858c0c1deba\"\u003e\u003c/p\u003e","title":"Redisé¢è¯•é¢˜ç¬”è®°"},{"content":"1. è¯´è¯´ Java ä¸­ HashMap çš„åŸç†ï¼Ÿ ã€HashMapå®šä¹‰ã€‘\nç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ (JDK 1.8 ä¹‹å)\né»˜è®¤å€¼ï¼šåˆå§‹å®¹é‡ä¸º16 (æ•°ç»„é•¿åº¦)ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚å½“å­˜å‚¨çš„å…ƒç´ ä¸º 16 * 0.75 = 12ä¸ªæ—¶ï¼Œä¼šè§¦å‘Resize() æ‰©å®¹æ“ä½œï¼Œå®¹é‡ x 2 å¹¶é‡æ–°åˆ†é…ä½ç½®ã€‚ä½†æ˜¯æ‰©å®¹æ˜¯æœ‰ä¸€å®šå¼€é”€çš„ï¼Œé¢‘ç¹æ‰©å®¹ä¼šå½±å“æ€§èƒ½ã€‚å¦å¤–ï¼ŒTREEIFY_THRESHOLD è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é»˜è®¤é“¾è¡¨é•¿åº¦é˜ˆå€¼ä¸º 8, UNTREEIFY_THRESHOLD ä»çº¢é»‘æ ‘è½¬æ¢ä¸ºé“¾è¡¨çš„é˜ˆå€¼ä¸º 6ã€‚ ä¸¤ä¸ªé˜ˆå€¼é‡‡ç”¨ä¸åŒå€¼çš„åŸå› æ˜¯é˜²æ­¢åˆšè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆå˜æˆé“¾è¡¨ï¼Œåå¤æ¨ªè·³ï¼Œæ¶ˆè€—èµ„æºã€‚\næ•°ç»„ä¸‹æ ‡ä½ç½®è®¡ç®—æ–¹æ³•ï¼šé¦–å…ˆä½¿ç”¨keyçš„hashCode()æ–¹æ³•è®¡ç®—ä¸‹æ ‡ä½ç½®ï¼Œç„¶åé€šè¿‡ indexFor() (JDK 1.7 ä»¥å‰) è®¡ç®—ä¸‹æ ‡å€¼ã€‚ JDK 1.7åï¼Œä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡é‡‡ç”¨ (len - 1) \u0026amp; hash æ¥ç¡®å®šä¸‹æ ‡å€¼ã€‚\nã€æ³¨ã€‘æ•°ç»„çš„é•¿åº¦len æ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œ(len - 1) \u0026amp; hash ç­‰ä»·äº hash % lenã€‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ•°ç»„é•¿åº¦å¿…é¡»æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚\nã€HashMapçº¿ç¨‹ä¸å®‰å…¨ã€‘\nä¸ºäº†ä¿è¯HashMapçš„è¯»å†™æ•ˆç‡é«˜ï¼Œå®ƒçš„æ“ä½œæ˜¯éåŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å†™æ“ä½œæ²¡æœ‰é”ä¿æŠ¤ã€‚æ‰€ä»¥å¤šçº¿ç¨‹åœºæ™¯ä¸‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚\nã€HashMapä¸åŒç‰ˆæœ¬åŒºåˆ«ã€‘\nJDK 1.7: æ•°ç»„ + é“¾è¡¨ï¼Œé“¾è¡¨éƒ¨åˆ†é‡‡ç”¨å¤´æ’æ³•ï¼Œå¤šçº¿ç¨‹ä¼šå¯¼è‡´å‡ºç°ç¯å½¢é“¾è¡¨ã€‚æ‰©å®¹ä¼šè®¡ç®—æ¯ä¸ªå…ƒç´ hashå€¼ï¼Œå¹¶åˆ†é…åˆ°æ–°çš„ä½ç½®ï¼Œå¼€é”€å¤§ã€‚ JDK 1.8ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œé‡‡ç”¨é«˜ä½ä½ç½®æ¥åˆ†é…ä½ç½®ï¼Œå³åˆ¤æ–­(e.hash \u0026amp; oldCap) == 0ï¼Œ å‡å°‘äº†è®¡ç®—hashçš„æ¬¡æ•° ã€HashMapçš„PUTæ–¹æ³•ã€‘\nHashMapåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼ŒæŒ‰ç…§å¦‚ä¸‹æµç¨‹ï¼š\nåˆ¤æ–­æ•°ç»„tableæ˜¯å¦ä¸ºç©ºæˆ–é•¿åº¦ä¸º0ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ’å…¥ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ Resize() è®¡ç®—keyçš„æ•°ç»„ç´¢å¼•å€¼ index = hash(key) \u0026amp; (len - 1) å¾—åˆ°ç´¢å¼•i , len è¡¨ç¤ºæ•°ç»„é•¿åº¦ åˆ¤æ–­table[i]æ˜¯å¦ä¸ºç©ºï¼Ÿ è‹¥ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥ -\u0026gt; ç¬¬7æ­¥ è‹¥ä¸ä¸ºç©º -\u0026gt; ç¬¬4æ­¥ åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ è‹¥å­˜åœ¨ï¼Œç›´æ¥è¦†ç›– -\u0026gt; ç¬¬7æ­¥ è‹¥ä¸å­˜åœ¨ -\u0026gt; ç¬¬5æ­¥ åˆ¤æ–­table[i]æ˜¯å¦ä¸ºTreeNode å¦‚æœæ˜¯TreeNode ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ’å…¥/è¦†ç›– (åŒç¬¬4æ­¥ï¼Œåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨) -\u0026gt; ç¬¬7æ­¥ å¦‚æœä¸æ˜¯ -\u0026gt; éå†é“¾è¡¨ -\u0026gt; åœ¨é“¾è¡¨ä¸­æ’å…¥/è¦†ç›– (åŒç¬¬4æ­¥ï¼Œåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨) -\u0026gt; ç¬¬6æ­¥ å¦‚æœæ˜¯é“¾è¡¨æ’å…¥èŠ‚ç‚¹ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦listLen æ˜¯å¦ \u0026gt;= TREEIFY_THRESHOLD, é»˜è®¤ä¸º8 å¦‚æœ listLen \u0026gt;= 8ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘ -\u0026gt; ç¬¬7æ­¥ å¦‚æœ listLen \u0026lt; 8 -\u0026gt; ç¬¬7æ­¥ å…ƒç´ ä¸ªæ•°è‡ªå¢ï¼Œåˆ¤æ–­æ˜¯å¦å¤§äºé˜ˆå€¼ thresholdï¼Œ å…¶ä¸­threshold = len * factor é»˜è®¤ä¸º 16 * 0.75 = 12ã€‚è‹¥è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™å¯¹æ•°ç»„æ‰©å®¹ Resize() ã€HashMapçš„GETæ–¹æ³•ã€‘\nè®¡ç®—keyçš„æ•°ç»„ç´¢å¼•å€¼ index = hash(key) \u0026amp; (len - 1) å¾—åˆ°ç´¢å¼•i , len è¡¨ç¤ºæ•°ç»„é•¿åº¦ åˆ¤æ–­table[i]æ˜¯å¦ç›´æ¥key.equals(k)å‘½ä¸­ å‘½ä¸­ -\u0026gt; è¿”å›ç»“æœ æœªå‘½ä¸­ -\u0026gt; ç¬¬3æ­¥ åˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºTreeNode è‹¥æ˜¯TreeNodeï¼Œåœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾ è‹¥ä¸æ˜¯ï¼Œéå†é“¾è¡¨æŸ¥æ‰¾ è¿”å›æŸ¥æ‰¾ç»“æœ ã€Resizeæ‰©å®¹æ“ä½œã€‘\nResize() æºç å¦‚ä¸‹\n/** * Initializes or doubles table size. If null, allocates in * accord with initial capacity target held in field threshold. * Otherwise, because we are using power-of-two expansion, the * elements from each bin must either stay at same index, or move * with a power of two offset in the new table. * * @return the table */ final HashMap.Node\u0026lt;K,V\u0026gt;[] resize() { HashMap.Node\u0026lt;K,V\u0026gt;[] oldTab = table; // è®°å½•Mapå½“å‰çš„å®¹é‡ int oldCap = (oldTab == null) ? 0 : oldTab.length; // è®°å½•Mapå…è®¸å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œå³é˜ˆå€¼ï¼ˆå®¹é‡*è´Ÿè½½å› å­ï¼‰ int oldThr = threshold; // å£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œç”¨æ¥è®°å½•æ–°çš„å®¹é‡å’Œé˜ˆå€¼ int newCap, newThr = 0; // è‹¥å½“å‰å®¹é‡ä¸ä¸º0ï¼Œè¡¨ç¤ºå­˜å‚¨æ•°æ®çš„æ•°ç»„å·²ç»è¢«åˆå§‹åŒ–è¿‡ if (oldCap \u0026gt; 0) { // åˆ¤æ–­å½“å‰å®¹é‡æ˜¯å¦è¶…è¿‡äº†å…è®¸çš„æœ€å¤§å®¹é‡ if (oldCap \u0026gt;= MAXIMUM_CAPACITY) { // è‹¥è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œè¡¨ç¤ºæ— æ³•å†è¿›è¡Œæ‰©å®¹ // åˆ™æ›´æ–°å½“å‰çš„é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼ï¼Œå¹¶è¿”å›æ—§æ•°ç»„ threshold = Integer.MAX_VALUE; return oldTab; } // å°†æ—§å®¹é‡*2å¾—åˆ°æ–°å®¹é‡ï¼Œè‹¥æ–°å®¹é‡æœªè¶…è¿‡æœ€å¤§å€¼ï¼Œå¹¶ä¸”æ—§å®¹é‡å¤§äºé»˜è®¤åˆå§‹å®¹é‡ï¼ˆ16ï¼‰ï¼Œ // æ‰åˆ™å°†æ—§é˜ˆå€¼*2å¾—åˆ°æ–°é˜ˆå€¼ else if ((newCap = oldCap \u0026lt;\u0026lt; 1) \u0026lt; MAXIMUM_CAPACITY \u0026amp;\u0026amp; oldCap \u0026gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr \u0026lt;\u0026lt; 1; // double threshold } // è‹¥ä¸æ»¡è¶³ä¸Šé¢çš„oldCap \u0026gt; 0ï¼Œè¡¨ç¤ºæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œ // è‹¥å½“å‰é˜ˆå€¼ä¸ä¸º0ï¼Œå°±å°†æ•°ç»„çš„æ–°å®¹é‡è®°å½•ä¸ºå½“å‰çš„é˜ˆå€¼ï¼› // ä¸ºä»€ä¹ˆè¿™é‡Œçš„oldThråœ¨æœªåˆå§‹åŒ–æ•°ç»„çš„æ—¶å€™å°±æœ‰å€¼å‘¢ï¼Ÿ // è¿™æ˜¯å› ä¸ºHashMapæœ‰ä¸¤ä¸ªå¸¦å‚æ„é€ å™¨ï¼Œå¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡ï¼Œ // è‹¥ä½ è°ƒç”¨äº†è¿™ä¸¤ä¸ªå¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡çš„æ„é€ å™¨ï¼Œ // è¿™ä¸¤ä¸ªæ„é€ å™¨å°±ä¼šå°†é˜ˆå€¼è®°å½•ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºä½ æŒ‡å®šå®¹é‡ï¼Œä¸”æ»¡è¶³2^nçš„æ•°ï¼ˆå¯ä»¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ„é€ å™¨ï¼‰ else if (oldThr \u0026gt; 0) // initial capacity was placed in threshold newCap = oldThr; // è‹¥ä¸Šé¢çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè¡¨ç¤ºä½ æ˜¯è°ƒç”¨é»˜è®¤æ„é€ å™¨åˆ›å»ºçš„HashMapï¼Œä¸”è¿˜æ²¡æœ‰åˆå§‹åŒ–tableæ•°ç»„ else { // zero initial threshold signifies using defaults // åˆ™å°†æ–°å®¹é‡æ›´æ–°ä¸ºé»˜è®¤åˆå§‹å®¹é‡ï¼ˆ16ï¼‰ // é˜ˆå€¼å³ä¸ºï¼ˆå®¹é‡*è´Ÿè½½å› å­ï¼‰ newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); } // ç»è¿‡ä¸Šé¢çš„æ­¥éª¤åï¼ŒnewCapä¸€å®šæœ‰å€¼ï¼Œä½†æ˜¯è‹¥è¿è¡Œçš„æ˜¯ä¸Šé¢çš„ç¬¬äºŒä¸ªåˆ†æ”¯æ—¶ï¼ŒnewThrè¿˜æ˜¯0 // æ‰€ä»¥è‹¥å½“å‰newThrè¿˜æ˜¯0ï¼Œåˆ™è®¡ç®—å‡ºå®ƒçš„å€¼ï¼ˆå®¹é‡*è´Ÿè½½å› å­ï¼‰ if (newThr == 0) { float ft = (float)newCap * loadFactor; newThr = (newCap \u0026lt; MAXIMUM_CAPACITY \u0026amp;\u0026amp; ft \u0026lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); } // å°†è®¡ç®—å‡ºçš„æ–°é˜ˆå€¼æ›´æ–°åˆ°æˆå‘˜å˜é‡thresholdä¸Š threshold = newThr; // åˆ›å»ºä¸€ä¸ªè®°å½•æ–°æ•°ç»„ç”¨æ¥å­˜HashMapä¸­çš„å…ƒç´  // è‹¥æ•°ç»„ä¸æ˜¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼Œåˆ™è¿™é‡Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªä¸¤å€å¤§å°çš„æ–°æ•°ç»„ @SuppressWarnings({\u0026#34;rawtypes\u0026#34;,\u0026#34;unchecked\u0026#34;}) HashMap.Node\u0026lt;K,V\u0026gt;[] newTab = (HashMap.Node\u0026lt;K,V\u0026gt;[])new HashMap.Node[newCap]; // å°†æ–°æ•°ç»„çš„å¼•ç”¨èµ‹å€¼ç»™æˆå‘˜å˜é‡table table = newTab; // å¼€å§‹å°†åŸæ¥çš„æ•°æ®åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­ if (oldTab != null) { // éå†åŸæ•°ç»„ for (int j = 0; j \u0026lt; oldCap; ++j) { HashMap.Node\u0026lt;K,V\u0026gt; e; // è‹¥åŸæ•°ç»„çš„jä½ç½®æœ‰èŠ‚ç‚¹å­˜åœ¨ï¼Œæ‰è¿›ä¸€æ­¥æ“ä½œ if ((e = oldTab[j]) != null) { // æ¸…é™¤æ—§æ•°ç»„å¯¹èŠ‚ç‚¹çš„å¼•ç”¨ oldTab[j] = null; // è‹¥tableæ•°ç»„çš„jä½ç½®åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥å°†è¿™ä¸ªèŠ‚ç‚¹æ”¾å…¥æ–°æ•°ç»„ // ä½¿ç”¨ \u0026amp; æ›¿ä»£ % è®¡ç®—å‡ºä½™æ•°ï¼Œå³ä¸‹æ ‡ if (e.next == null) newTab[e.hash \u0026amp; (newCap - 1)] = e; // è‹¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ•°èŠ‚ç‚¹ï¼Œè¡¨ç¤ºåŸæ•°ç»„è¿™ä¸ªä½ç½®çš„é“¾è¡¨å·²ç»è¢«è½¬ä¸ºäº†çº¢é»‘æ ‘ // åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å°†èŠ‚ç‚¹åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­ else if (e instanceof HashMap.TreeNode) ((HashMap.TreeNode\u0026lt;K,V\u0026gt;)e).split(this, newTab, j, oldCap); // ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®æ˜¯ä¸€æ¡ä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ // ä»¥ä¸‹æ“ä½œç›¸å¯¹å¤æ‚ï¼Œæ‰€ä»¥å•ç‹¬æ‹¿å‡ºæ¥è®²è§£ else { // preserve order HashMap.Node\u0026lt;K,V\u0026gt; loHead = null, loTail = null; HashMap.Node\u0026lt;K,V\u0026gt; hiHead = null, hiTail = null; HashMap.Node\u0026lt;K,V\u0026gt; next; do { next = e.next; if ((e.hash \u0026amp; oldCap) == 0) { if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next) != null); if (loTail != null) { loTail.next = null; newTab[j] = loHead; } if (hiTail != null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } } } } } // å°†æ–°åˆ›å»ºçš„æ•°ç»„è¿”å› return newTab; } å•ç‹¬åˆ†æä¸­é—´é“¾è¡¨æ‹†åˆ†çš„ä»£ç \nå®šä¹‰ä¸¤ä¸ªé“¾è¡¨ (lo å’Œ hi)ï¼Œ åŒ…æ‹¬å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ Node\u0026lt;K,V\u0026gt; loHead = null, loTail = null; Node\u0026lt;K,V\u0026gt; hiHead = null, hiTail = null; æŒ‰ç…§é¡ºåºéå†tableæºå¸¦çš„é“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœ(e.hash \u0026amp; oldCap) == 0ï¼Œå°±æ”¾å…¥loé“¾è¡¨ï¼Œå…¶ä»–çš„æ”¾å…¥hié“¾è¡¨ do { next = e.next; // æ ¹æ®å…ƒç´ çš„å“ˆå¸Œå€¼å’Œæ—§å®¹é‡çš„ä½è¿ç®—ç»“æœå°†å…ƒç´ åˆ†ç±» if ((e.hash \u0026amp; oldCap) == 0) { // if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next)!= null); å°†åŸæ¥çš„é“¾è¡¨æ‹†åˆ†ä¸ºä¸¤ä¸ªé“¾è¡¨ï¼Œç„¶åå°†ä½ä½ç½®å…ƒç´ å­˜å‚¨åˆ°æ–°æ•°ç»„åŸç´¢å¼•ä½ç½®ï¼Œå°†é«˜ä½ç½®å…ƒç´ å­˜å‚¨åˆ°æ–°æ•°ç»„åŸç´¢å¼•åŠ æ—§å®¹é‡çš„ä½ç½®ã€‚ ä½ç½®çš„é«˜ä½æŒ‰ç…§ (e.hash \u0026amp; oldCap) == 0 æ¥åŒºåˆ† // å°†ä½ä½ç½®å…ƒç´ å­˜å‚¨åˆ°æ–°æ•°ç»„åŸç´¢å¼•ä½ç½® if (loTail!= null) { loTail.next = null; newTab[j] = loHead; } // å°†é«˜ä½ç½®å…ƒç´ å­˜å‚¨åˆ°æ–°æ•°ç»„åŸç´¢å¼•åŠ æ—§å®¹é‡çš„ä½ç½® if (hiTail!= null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } [è¡¥å……] 1. Java ä¸­ HashMap çš„æ‰©å®¹æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ ã€ç®€å•ç†è§£ã€‘\næ¯æ¬¡æ‰©å®¹ï¼Œæ–°æ•°ç»„å˜æˆè€æ•°ç»„çš„ 2 å€ï¼Œ æ‰€ä»¥æ–°æ•°ç»„å¯ä»¥çœ‹æˆæ˜¯è€ç©ºé—´+ä¸€å—ä¸€æ ·å¤§å°çš„æ–°ç©ºé—´ã€‚ï¼ˆä¸¤å—æ•°ç»„ï¼‰ã€‚ æ‰©å®¹çš„æ—¶å€™ï¼Œå¦‚æœåŸæ•°ç»„æ˜¯å•ä¸€çš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥æ”¾å…¥æ–°æ•°ç»„é‡Œé¢ã€‚å‡å¦‚åŸæ•°ç»„é•¿åº¦ä¸ºnï¼Œ æ–°æ•°ç»„ä¸­çš„ä½ç½®æ˜¯e.hash \u0026amp; 2n -1ï¼Œå…¶å®å°±æ˜¯ e.hash % 2n å¦‚æœåŸæ•°ç»„æ˜¯å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±æŒ‰ç…§ä½ä½å’Œé«˜ä½æ¥åˆ†ã€‚åŒºåˆ†çš„æ–¹æ³•ï¼Œå“ˆå¸Œå€¼çš„äºŒè¿›åˆ¶å’ŒåŸæ•°ç»„é•¿åº¦çš„äºŒè¿›åˆ¶çš„æœ€é«˜ä½æ˜¯å¦ä¸º1ã€‚å¦‚æœä¸º0ï¼Œåˆ™ä¸ºä½ä½ï¼Œå¦åˆ™ä¸ºé«˜ä½ã€‚ï¼ˆæ¯”å¦‚å“ˆå¸Œå€¼ä¸º3ï¼ŒäºŒè¿›åˆ¶ä¸º011, åŸæ•°ç»„é•¿åº¦ä¸º4ï¼Œ äºŒè¿›åˆ¶ä¸º100ã€‚å°±æ˜¯çœ‹ç¬¬ 3 ä½æ˜¯å¦ä¸º1ï¼‰ ç„¶åä½ä½é“¾è¡¨ï¼Œå°±æ”¾åœ¨æ–°æ•°ç»„è€ç©ºé—´é‚£è¾¹ã€‚é«˜ä½é“¾è¡¨å°±æ”¾åœ¨æ–°æ•°ç»„æ–°ç©ºé—´é‚£è¾¹ï¼Œå…·ä½“ä½ç½®æ˜¯åŸä½ç½®+è€æ•°ç»„çš„é•¿åº¦ ã€å…·ä½“æµç¨‹ã€‘\nåˆ¤æ–­å½“å‰çš„å®¹é‡æ˜¯å¦å·²ç»è¾¾åˆ°æœ€å¤§å®¹é‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›åŸæ¥çš„å“ˆå¸Œè¡¨å¯¹è±¡ï¼Œä¸äºˆæ‰©å®¹ã€‚ å¦‚æœæ²¡æœ‰è¾¾åˆ°æœ€å¤§å®¹é‡ï¼Œåˆ™ new ä¸€ä¸ªåŸæ•°ç»„ 2 å€å¤§å°çš„æ–°æ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾æ–°çš„æ•°æ® éå†åŸæ•°ç»„ï¼Œå°†åŸæ•°ç»„çš„æ•°æ®éƒ½è¿ç§»åˆ°æ–°çš„æ•°ç»„é‡Œé¢ã€‚ è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ•°ç»„å¯¹åº”ä½ç½®ä¸Šï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥ç”¨å…ƒç´ çš„å“ˆå¸Œå€¼å’Œæ–°æ•°ç»„çš„é•¿åº¦å‡1 è¿›è¡Œä¸è¿ç®— (index = e.hash \u0026amp; (newCap - 1))ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¤åˆ¶è¿‡å»å³å¯ å¦‚æœä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šæ–°å»ºä¸¤ä¸ªå¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹æˆä¸¤æ¡é“¾è¡¨ï¼Œåˆ†ä¸ºä½ä½é“¾è¡¨å’Œé«˜ä½é“¾è¡¨ã€‚æŠŠåŸæ¥çš„é“¾è¡¨/çº¢é»‘æ ‘æ‹†åˆ†åˆ°ä½ä½é“¾è¡¨å’Œé«˜ä½é“¾è¡¨ä¸Š åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºTreeNode, æ¥åˆ¤æ–­æ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ç»“æ„ã€‚ é€ä¸€éå†åŸæ•°ç»„çº¢é»‘æ ‘/é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’ŒåŸæ•°ç»„çš„é•¿åº¦è¿›è¡Œä¸è¿ç®—ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦ä¸º 0 (e.hash \u0026amp; oldCap == 0)ï¼Œå¦‚æœç­‰äº 0ï¼Œåˆ™æ’å…¥ä½ä½é“¾è¡¨ï¼Œå¦‚æœä¸ç­‰äº0ï¼Œåˆ™æ’å…¥é«˜ä½é“¾è¡¨ã€‚ æœ€åï¼Œå°†ä½ä½é“¾è¡¨ï¼Œæ”¾å…¥æ–°æ•°ç»„ä¸­å…ƒç´ åœ¨åŸæ•°ç»„å¯¹åº”çš„ä¸‹æ ‡ä½ç½®ã€‚å°†é«˜ä½é“¾è¡¨æ”¾å…¥ï¼Œä»æ—§ä½ç½®å¾€åç§»åŠ¨åŸæ•°ç»„é•¿åº¦çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ—§ä½ç½®ä¸‹æ ‡ + åŸæ•°ç»„å¤§å°ä½œä¸ºé«˜ä½é“¾è¡¨çš„å­˜æ”¾ä½ç½® æœ€åï¼Œè¿”å›æ–°çš„å“ˆå¸Œè¡¨å¯¹è±¡ 2.ConcurrentHashMapäº†è§£å—? / Java ä¸­ ConcurrentHashMap 1.7 å’Œ 1.8 ä¹‹é—´æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ é¦–å…ˆï¼Œæåˆ° ConcurrentHashMap æˆ‘ä»¬è¦åˆ†æˆJDK 1.7 å’Œ JDK 1.8 ä¸¤ä¸ªç‰ˆæœ¬æ¥çœ‹ï¼š\nJDK 1.7: åœ¨1.7ä¸­ï¼Œ ConcurrentHashMap é‡‡ç”¨åˆ†æ®µé”ã€‚å°±æ˜¯åˆ†æˆä¸åŒçš„segmentï¼Œé»˜è®¤æœ‰16ä¸ªã€‚æ¯ä¸ªsegment ä¸­éƒ½åŒ…å«å¤šä¸ªçš„ HashEntry (å¯ä»¥ç†è§£æˆä¸€ä¸ªHashMap)ã€‚ é”çš„æ–¹å¼æºäºSegment,è¿™ä¸ªç±»å®é™…é›†æˆäº†ReentrantLock\nJDK 1.8ï¼šåœ¨1.8ä¸­ï¼ŒConcurrnetHashMapçš„æ•°æ®ç»“æ„å’ŒHashMapä¸€æ ·ï¼Œå®ƒåšäº†æ›´å°èŒƒå›´çš„é”æ§åˆ¶ã€‚å®ƒçš„æ•°ç»„çš„æ¯ä¸ªä½ç½®ä¸Šéƒ½æœ‰ä¸€æŠŠé”ã€‚å¦‚æœéœ€è¦æ‰©å®¹ï¼Œä¼šä½¿ç”¨CAS è‡ªæ—‹æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé¿å…é”æ•´ä¸ªæ•°ç»„ã€‚å¦‚æœæ˜¯åœ¨é“¾è¡¨/çº¢é»‘æ ‘æ’å…¥æŸä¸ªnodeï¼Œåªéœ€è¦ç”¨synchronizeè¿›è¡Œä¸Šé”ã€‚\nã€JDK1.7å’Œ1.8æ‰©å®¹åŒºåˆ«ã€‘\nJDK 1.7ï¼šå½“æŸä¸ªSegmentå†…çš„HashMap è¾¾åˆ°æ‰©å®¹é˜ˆå€¼çš„æ—¶å€™ï¼Œå•ç‹¬ä¸ºè¯¥Segmentè¿›è¡Œæ‰©å®¹ã€‚\nJDK 1.8ï¼šå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç‰¹ç‚¹å…¨å±€æ‰©å®¹ã€åŸºäºCASæ‰©å®¹ã€æ¸è¿›å¼æ‰©å®¹\nå…¨å±€æ‰©å®¹ï¼š1.8 å› ä¸ºå–æ¶ˆäº† 1.7 é‡Œé¢çš„Segmentï¼Œ æœ¬èº«æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„ç»“æ„ã€‚æ‰€ä»¥æ˜¯ä¸€ä¸ªå…¨å±€çš„æ•°ç»„ï¼Œå½“ä»»æ„ä½ç½®çš„å…ƒç´ è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ•´ä¸ªæ•°ç»„éƒ½ä¼šè¢«æ‰©å®¹ã€‚\nåŸºäº CAS çš„æ‰©å®¹ï¼š é‡‡ç”¨å’Œ HashMap ç›¸ä¼¼çš„æ‰©å®¹æœºåˆ¶ï¼Œé‡‡ç”¨ CAS æ“ä½œç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶é¿å…é”ä½æ•´ä¸ªæ•°ç»„ã€‚\næ¸è¿›å¼æ‰©å®¹ï¼šæ‰©å®¹ä¸æ˜¯ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®é‡æ–°åˆ†é…ï¼Œè€Œæ˜¯å¤šä¸ªçº¿ç¨‹å…±åŒå‚ä¸ï¼Œé€æ­¥è¿ç§»å°±æ•°æ®åˆ°æ–°æ•°ç»„å½“ä¸­ï¼Œé™ä½æ‰©å®¹å¯¹æ€§èƒ½çš„æ¶ˆè€—ã€‚(å‡å¦‚å½“å‰æ•°ç»„é•¿åº¦ä¸º32ï¼Œé‚£ä¹ˆå¯ä»¥Açº¿ç¨‹è´Ÿè´£0~15ï¼ŒBçº¿ç¨‹è´Ÿè´£16~31)\n3. ä¸ºä»€ä¹ˆ Java çš„ ConcurrentHashMap ä¸æ”¯æŒ key æˆ– value ä¸º nullï¼Ÿ ConcurrentMapä¸æ”¯æŒkeyæˆ–valueä¸º null æ˜¯ä¸ºäº†é¿å…æ­§ä¹‰å’Œç®€åŒ–ä»£ç å®ç°æ–¹å¼\nå› ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œget(key) æ–¹æ³•å¦‚æœè¿”å› null ï¼Œä¸çŸ¥é“å…¶è¡¨ç¤ºçš„æ˜¯keyä¸å­˜åœ¨è¿˜æ˜¯valueæœ¬æ¥å°±æ˜¯ nullã€‚ä¸ºäº†é¿å…è¿™ä¸ªæ­§ä¹‰ï¼Œä»£ç å°±éœ€è¦é¢‘ç¹çš„åˆ¤æ–­nullæ˜¯ä»£è¡¨keyä¸å­˜åœ¨è¿˜æ˜¯ value æœ¬æ¥å°±æ˜¯ nullï¼Œå¢åŠ å¤æ‚åº¦ã€‚\nã€ä¸ºä»€ä¹ˆHashMapæ”¯æŒ key æˆ– value ä¸ºnullã€‘\nå› ä¸ºHashMapè®¾è®¡çš„åˆè¡·å°±æ˜¯å•çº¿ç¨‹æ¨¡å¼ä½¿ç”¨çš„ï¼Œæœ¬èº«å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚åœ¨ HashMap çš„å®ç°ä¸­ï¼Œnull é”®è¢«ç‰¹æ®Šå¤„ç†ã€‚å½“ key ä¸º null æ—¶ï¼ŒHashMap ä¸ä¼šè°ƒç”¨ hashCode() æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥å°† null é”®å­˜å‚¨åœ¨è¡¨çš„ç¬¬ä¸€ä¸ªæ¡¶ï¼ˆtable[0]ï¼‰ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å… NullPointerException ã€‚\nã€æ³¨æ„ã€‘ åƒHashTableã€ConcurrentSkipListMapã€CopyOnWriteArrayListè¿™äº›å¹¶å‘é›†åˆï¼Œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéƒ½ä¸æ”¯æŒkeyæˆ–valueä¸º null\n4 . Java ä¸­ ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯å¦éœ€è¦åŠ é”ï¼Ÿ ConcurrentHashMap çš„ get æ–¹æ³•ä¸éœ€è¦åŠ é”ã€‚å› ä¸ºget æ–¹å¼æ˜¯è¯»å–æ“ä½œï¼Œä¸éœ€è¦å¯¹èµ„æºåšä»»ä½•å¤„ç†ï¼Œæ‰€ä»¥æ¯æ¬¡åªéœ€è¦ä¿è¯è¯»å–åˆ°æœ€æ–°çš„æ•°æ®å³å¯ï¼Œæ‰€ä»¥ä¸éœ€è¦åŠ é”ã€‚\nå¦å¤–,ConcurrentHashMap ä¸­ get æ–¹æ³•å¯¹äºæ•°ç»„ä¸­çš„èŠ‚ç‚¹ï¼Œæ˜¯é€šè¿‡Unsafe æ–¹æ³• getObjectVolatile() æ¥ä¿è¯å¯è§æ€§çš„ã€‚å¯¹äºé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œæ˜¯é‡‡ç”¨volatile å…³é”®å­—å»ä¿®é¥° val å’Œ next èŠ‚ç‚¹çš„ï¼Œä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ã€‚\n5. Java ä¸­æœ‰å“ªäº›é›†åˆç±»ï¼Ÿè¯·ç®€å•ä»‹ç» Javaä¸­çš„é›†åˆç±»éƒ½æ˜¯åœ¨java.utilã€‚ ä¸»è¦å¯ä»¥åˆ†ä¸ºå•åˆ—ç±»å‹ Collection å’Œ åŒåˆ— Map ä¸¤ç±»æ¥çœ‹ã€‚ å…¶ä¸­å•åˆ— Collection é‡Œé¢åŒ…æ‹¬ (Listã€Setã€Queueï¼‰ï¼Œå…·ä½“å¦‚ä¸‹å›¾ã€‚\nã€ä¸¤ä¸ªåŸºæœ¬æ¥å£ã€‘\nCollection å•åˆ—é›†åˆæ¥å£ï¼šä¸€ä¸ªç”±å•ä¸ªå…ƒç´ ç»„æˆçš„åºåˆ—ï¼Œè¿™äº›å…ƒç´ è¦ç¬¦åˆä¸€æ¡æˆ–å¤šæ¡è§„åˆ™ã€‚å…¶ä¸­ï¼ŒList æ˜¯æœ‰åºçš„ï¼ŒSet æ˜¯å»é‡çš„ï¼Œ Queue æ˜¯ç¬¦åˆé˜Ÿåˆ—è§„åˆ™çš„ã€‚ Map åŒåˆ—é›†åˆæ¥å£ï¼š ä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ä»¥ç”¨ key æ¥æ£€ç´¢ valueã€‚ ä¸Šé¢çš„ ArrayList æ˜¯é‡‡ç”¨ç´¢å¼•æ¥æŸ¥æ‰¾ä¸€ä¸ªå€¼ã€‚Map å¯ä»¥é‡‡ç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡æ¥æŸ¥æ‰¾æŸä¸ªå¯¹è±¡ã€‚ ã€List ç³»åˆ—ã€‘ List æ¥å£çš„å®ç°ç±»ç”¨äºå­˜å‚¨æœ‰åºçš„ã€å…è®¸é‡å¤çš„å…ƒç´ ã€‚å¿…é¡»æŒ‰ç…§å…ƒç´ æ’å…¥é¡ºåºæ¥ä¿å­˜ä»–ä»¬ã€‚\nArrayListï¼šæ“…é•¿éšæœºè®¿é—®å…ƒç´ ï¼Œä½†æ˜¯åœ¨ List çš„ä¸­é—´æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ¯”è¾ƒæ…¢ã€‚é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ã€‚ LinkedListï¼šæä¾›ç†æƒ³çš„é¡ºåºè®¿é—®æ€§èƒ½ï¼Œåœ¨ List çš„ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æˆæœ¬éƒ½æ¯”è¾ƒä½ã€‚ LinkedList éšæœºè®¿é—®æ€§èƒ½ç›¸å¯¹è¾ƒå·®ï¼Œ é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ã€‚ Vectorï¼šåŸºäºåŠ¨æ€æ•°æ®å®ç°ï¼Œçº¿ç¨‹å®‰å…¨ (æ–¹æ³•åŠ é”)ï¼Œ æ•ˆç‡æ¯”è¾ƒä½ï¼Œå·²ç»å¾ˆå°‘ç”¨äº†ã€‚ ã€Set ç³»åˆ—ã€‘ Set æ¥å£çš„å®ç°ç±»ç”¨äºå­˜å‚¨ä¸é‡å¤çš„å…ƒç´ ã€‚ç»§æ‰¿äºCollection\nHashSetï¼šæ— åºï¼Œé‡‡ç”¨å“ˆå¸Œè¡¨å­˜å‚¨ï¼ŒæŸ¥æ‰¾å’Œæ’å…¥æ€§èƒ½é«˜ã€‚ LinkedHashSetï¼šæœ‰åºï¼Œé‡‡ç”¨å“ˆå¸Œè¡¨ + é“¾è¡¨(å­˜å‚¨æ’å…¥é¡ºåº) TreeSetï¼šæ’åº (æˆ–è‡ªå®šä¹‰æ’åº)ï¼Œé‡‡ç”¨çº¢é»‘æ ‘å®ç°ï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ€§èƒ½é«˜ã€‚ ã€Queue é˜Ÿåˆ—/ä¼˜å…ˆç³»åˆ—ã€‘ Queue æ¥å£çš„å®ç°ç±»ç”¨äºå¤„ç†å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ•°æ®ç»“æ„ã€‚\nPriorityQueueï¼š åŸºäºå †å®ç°ï¼Œç”¨äºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å…ƒç´ æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºæ’åˆ—ã€‚ä¸æ˜¯FIFOçš„é¡ºåºï¼Œä¼˜å…ˆå¤„ç†ä¼˜å…ˆçº§æçš„å…ƒç´  LinkedListï¼š ä¹Ÿå®ç°äº†Queue æ¥å£ï¼Œæ”¯æŒåŒç«¯é˜Ÿåˆ—ç»“æ„ã€‚ Stackï¼š åŒç«¯é˜Ÿåˆ— ã€Map ç³»åˆ—ã€‘ é”®å”¯ä¸€ï¼Œå€¼å¯é‡å¤\nHashMapï¼š æ— åºï¼Œæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œ key å’Œ value éƒ½å¯ä»¥ä¸º null LinkedHashMapï¼šæœ‰åºï¼Œæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œé¢å¤–é“¾è¡¨è®°å½•æ’å…¥é¡ºåº TreeMapï¼šçº¢é»‘æ ‘å®ç°ï¼Œå¯¹keyè¿›è¡Œè‡ªç„¶æ’åº(æˆ–è€…è‡ªå®šä¹‰æ’åº) HashTable: æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œæœ‰sychronized é”ï¼Œ ä¸å…è®¸key å’Œ value ä¸º null ï¼Œçº¿ç¨‹å®‰å…¨ã€‚ 6. Java ä¸­çš„ CopyOnWriteArrayList æ˜¯ä»€ä¹ˆï¼Ÿ CopyOnWriteArrayList æ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„ArrayListï¼Œ å…¶ä¸»è¦çš„åŸç†å°±å’Œåå­—ä¸€æ ·ï¼Œåœ¨å†™çš„æ—¶å€™å¤åˆ¶ï¼Œå†™æ—¶å¤åˆ¶ã€‚\nCopyOnWirteArrayList çš„è¯»æ“ä½œä¸éœ€è¦ä¸Šé”ï¼Œä½†æ˜¯å†™æ“ä½œä¼šé”ã€‚è€Œä¸”è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¤åˆ¶ä¸€ä»½åŸæ•°ç»„å‡ºæ¥ï¼Œç„¶ååœ¨æ–°çš„æ•°ç»„ä¸Šè¿›è¡Œå†™æ“ä½œï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨è€æ•°ç»„çš„åŸºç¡€ä¸Šï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚åˆ°é‚£æ—¶å¤åˆ¶æ•°ç»„æœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—ï¼Œè€Œä¸”ä¼šæ¶ˆè€—å†…å­˜ã€‚\n","permalink":"https://swimmingliu.cn/posts/job/java-set-interview-questions/","summary":"\u003ch2 id=\"1-è¯´è¯´-java-ä¸­-hashmap-çš„åŸç†\"\u003e1. è¯´è¯´ Java ä¸­ HashMap çš„åŸç†ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eã€HashMapå®šä¹‰ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ (\u003ccode\u003eJDK 1.8\u003c/code\u003e ä¹‹å)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé»˜è®¤å€¼ï¼šåˆå§‹å®¹é‡ä¸º16 (æ•°ç»„é•¿åº¦)ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚å½“å­˜å‚¨çš„å…ƒç´ ä¸º 16 * 0.75 = 12ä¸ªæ—¶ï¼Œä¼šè§¦å‘\u003ccode\u003eResize()\u003c/code\u003e æ‰©å®¹æ“ä½œï¼Œå®¹é‡ x 2 å¹¶é‡æ–°åˆ†é…ä½ç½®ã€‚ä½†æ˜¯æ‰©å®¹æ˜¯æœ‰ä¸€å®šå¼€é”€çš„ï¼Œé¢‘ç¹æ‰©å®¹ä¼šå½±å“æ€§èƒ½ã€‚å¦å¤–ï¼Œ\u003ccode\u003eTREEIFY_THRESHOLD\u003c/code\u003e è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é»˜è®¤é“¾è¡¨é•¿åº¦é˜ˆå€¼ä¸º 8, \u003ccode\u003eUNTREEIFY_THRESHOLD\u003c/code\u003e ä»çº¢é»‘æ ‘è½¬æ¢ä¸ºé“¾è¡¨çš„é˜ˆå€¼ä¸º 6ã€‚ ä¸¤ä¸ªé˜ˆå€¼é‡‡ç”¨ä¸åŒå€¼çš„åŸå› æ˜¯é˜²æ­¢åˆšè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆå˜æˆé“¾è¡¨ï¼Œåå¤æ¨ªè·³ï¼Œæ¶ˆè€—èµ„æºã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ•°ç»„ä¸‹æ ‡ä½ç½®è®¡ç®—æ–¹æ³•ï¼šé¦–å…ˆä½¿ç”¨keyçš„\u003ccode\u003ehashCode()\u003c/code\u003eæ–¹æ³•è®¡ç®—ä¸‹æ ‡ä½ç½®ï¼Œç„¶åé€šè¿‡  \u003ccode\u003eindexFor()\u003c/code\u003e (\u003ccode\u003eJDK 1.7\u003c/code\u003e ä»¥å‰) è®¡ç®—ä¸‹æ ‡å€¼ã€‚ \u003ccode\u003eJDK 1.7\u003c/code\u003eåï¼Œä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡é‡‡ç”¨ \u003ccode\u003e(len - 1) \u0026amp; hash\u003c/code\u003e æ¥ç¡®å®šä¸‹æ ‡å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eã€æ³¨ã€‘æ•°ç»„çš„é•¿åº¦\u003ccode\u003elen\u003c/code\u003e æ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œ\u003ccode\u003e(len - 1) \u0026amp; hash\u003c/code\u003e ç­‰ä»·äº \u003ccode\u003ehash % len\u003c/code\u003eã€‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ•°ç»„é•¿åº¦å¿…é¡»æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"HashMapåº•å±‚ç»“æ„\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/65f25922-ef8d-11ef-827a-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003cp\u003eã€\u003cstrong\u003eHashMapçº¿ç¨‹ä¸å®‰å…¨\u003c/strong\u003eã€‘\u003c/p\u003e\n\u003cp\u003eä¸ºäº†ä¿è¯HashMapçš„è¯»å†™æ•ˆç‡é«˜ï¼Œå®ƒçš„æ“ä½œæ˜¯éåŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å†™æ“ä½œæ²¡æœ‰é”ä¿æŠ¤ã€‚æ‰€ä»¥å¤šçº¿ç¨‹åœºæ™¯ä¸‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eã€HashMapä¸åŒç‰ˆæœ¬åŒºåˆ«ã€‘\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eJDK 1.7: æ•°ç»„ + é“¾è¡¨ï¼Œé“¾è¡¨éƒ¨åˆ†é‡‡ç”¨å¤´æ’æ³•ï¼Œå¤šçº¿ç¨‹ä¼šå¯¼è‡´å‡ºç°ç¯å½¢é“¾è¡¨ã€‚æ‰©å®¹ä¼šè®¡ç®—æ¯ä¸ªå…ƒç´ hashå€¼ï¼Œå¹¶åˆ†é…åˆ°æ–°çš„ä½ç½®ï¼Œå¼€é”€å¤§ã€‚\u003c/li\u003e\n\u003cli\u003eJDK 1.8ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œé‡‡ç”¨é«˜ä½ä½ç½®æ¥åˆ†é…ä½ç½®ï¼Œå³åˆ¤æ–­\u003ccode\u003e(e.hash \u0026amp; oldCap) == 0\u003c/code\u003eï¼Œ å‡å°‘äº†è®¡ç®—hashçš„æ¬¡æ•°\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eã€HashMapçš„PUTæ–¹æ³•ã€‘\u003c/strong\u003e\u003c/p\u003e","title":"Javaé›†åˆé¢è¯•é¢˜ç¬”è®°"},{"content":"1. åºåˆ—åŒ–å’Œååºåˆ—åŒ– 1.åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œç”¨äºå­˜å‚¨å’Œä¼ è¾“ï¼›è¯»å–å­—èŠ‚æµæ•°æ®ï¼Œé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚ 2.åºåˆ—åŒ–ä¸åŒ…æ‹¬é™æ€å¯¹è±¡ï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æœ¬è´¨æ˜¯è°ƒç”¨å¯¹è±¡çš„writeObjectå’ŒreadObjectæ–¹æ³•,æ¥å®ç°å°†å¯¹è±¡å†™å…¥è¾“å‡ºæµå’Œè¯»å–è¾“å…¥æµã€‚ä½†æ˜¯ï¼Œé™æ€å˜é‡ä¸å±äºå¯¹è±¡ï¼Œæ‰€ä»¥è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ²¡æ³•å„¿è®©é™æ€å˜é‡å‚ä¸ã€‚\n2. ä»€ä¹ˆæ˜¯ä¸å¯å˜ç±»ï¼Ÿ 1.ä¸å¯å˜ç±»ï¼šåˆå§‹åŒ–ä¹‹åï¼Œå°±ä¸èƒ½ä¿®æ”¹çš„ç±»ã€‚ 2.ä¿®é¥°æ–¹æ³•ï¼šfinal å’Œ private ä¿®é¥°æ‰€æœ‰ç±»å’Œå˜é‡ 3.ä¸å¯ä¿®æ”¹ï¼šä¸æš´éœ²setæ–¹æ³•ï¼Œåªèƒ½é€šè¿‡é‡æ–°åˆ›å»ºå¯¹è±¡æ›¿ä»£ä¿®æ”¹åŠŸèƒ½(Stringçš„replaceæ–¹æ³•) 4.ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œç¼“å­˜å‹å¥½ ç¼ºç‚¹ï¼šé¢‘ç¹æ‹¼æ¥å’Œä¿®æ”¹ä¼šæµªè´¹èµ„æº\n3. Exceptionå’ŒErroråŒºåˆ«? 1.Exceptionå’ŒErrorå®šä¹‰åŒºåˆ«ï¼šExceptionæ˜¯å¯å¤„ç†ç¨‹åºå¼‚å¸¸ï¼ŒErroræ˜¯ç³»ç»Ÿçº§ä¸å¯å›å¤é”™è¯¯ 2.try-catchå»ºè®®ï¼š 1.èŒƒå›´èƒ½å°åˆ™å° 2.Exceptionæœ€å¥½è¦å†™æ¸…æ¥šå…·ä½“æ˜¯å“ªä¸€ä¸ªException(IOException) 3.nullå€¼ç­‰èƒ½ç”¨ifåˆ¤æ–­çš„ï¼Œä¸è¦ç”¨try-catch,å› ä¸ºå¼‚å¸¸æ¯”æ¡ä»¶è¯­å¥ä½æ•ˆ 4.finallyä¸è¦ç›´æ¥returnå’Œå¤„ç†è¿”å›å€¼\n4. Java ä¸­çš„ hashCode å’Œ equals æ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ 1ã€equals() å’Œ hashCode() çš„å…³ç³»\nå¦‚æœä¸¤ä¸ªå¯¹è±¡euqals() ä¸º trueï¼Œ åˆ™å…¶ hashCode()ä¸€å®šç›¸åŒ å¦‚æœä¸¤ä¸ªå¯¹è±¡hashCode() ç›¸åŒï¼Œå…¶equals()ç»“æœä¸ä¸€å®šä¸ºtrue 2ã€ä¸ºä»€ä¹ˆé‡å†™equals()ä¹‹åï¼Œä¸€å®šè¦é‡å†™hashCode()\nå½“é‡å†™equals() ä¹‹åï¼Œé€šå¸¸æ˜¯é‡æ–°å®šä¹‰äº†ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰çš„é€»è¾‘ã€‚å¦‚æœä¸é‡å†™hashCode()æ–¹æ³•ï¼Œ åˆ™åœ¨æ•£åˆ—é›†åˆï¼ˆHashMap å’Œ HashSetï¼‰ä¸­ï¼Œå¯èƒ½æ— æ³•æ­£ç¡®å­˜å‚¨å’Œæ£€ç´¢ï¼Œå› ä¸ºä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡å¯èƒ½æœ‰ä¸åŒçš„hashå€¼ã€‚\nä¾‹å¦‚ï¼Œä¸‹æ–¹Personç±»é‡å†™äº†equals() æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰é‡æ–°hashCode()\npublic class Person { private String name; private int age; @Override public boolean equals(Object obj) { if (this == obj) return true; if (obj == null || getClass() != obj.getClass()) return false; Person person = (Person) obj; return age == person.age \u0026amp;\u0026amp; Objects.equals(name, person.name); } } åˆ›å»ºç›¸åŒçš„å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°HashSetä¸­\nPerson p1 = new Person(\u0026#34;Alice\u0026#34;, 25); Person p2 = new Person(\u0026#34;Alice\u0026#34;, 25); Set\u0026lt;Person\u0026gt; set = new HashSet\u0026lt;\u0026gt;(); set.add(p1); set.add(p2); ç”±äºhashCode() æ²¡æœ‰é‡å†™ï¼Œæ‰€æœ‰ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡å¯èƒ½æœ‰ä¸åŒçš„æ•£åˆ—ç ï¼Œå¯¼è‡´é›†åˆå½“ä¸­æœ‰ä¸¤ä¸ªç›¸åŒçš„å…ƒç´ \nå¦‚ä½•é‡å†™hashCode()?\nåªéœ€è¦è®©å…¶hashå€¼ï¼Œé‡‡ç”¨equals()å½“ä¸­ç›¸åŒçš„åˆ¤æ–­æ¡ä»¶ç”Ÿæˆåˆç†çš„æ•£åˆ—å€¼å³å¯\n@Override public int hashCode() { return Objects.hash(name, age); } 5. æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç‰¹æ€§ æ¥å£ æŠ½è±¡ç±» è®¾è®¡è§’åº¦ è‡ªä¸Šè€Œä¸‹ï¼Œå…ˆå®šä¹‰å¥½æˆ‘ä»¬éœ€è¦çš„æ–¹æ³•ï¼Œç„¶ååœ¨å…·ä½“çš„ç±»å½“ä¸­ï¼Œå®ç°è¯¥æ¥å£çš„æ–¹æ³• è‡ªä¸‹è€Œä¸Šï¼Œå†™äº†å¾ˆå¤šç±»ä¹‹åï¼Œå‘ç°ä»–ä»¬æœ‰å…±æ€§ï¼Œå¯ä»¥æŠŠä»£ç å¤ç”¨ã€‚å› æ­¤å°è£…æˆä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå‡å°‘ä»£ç å†—ä½™ æ–¹æ³•å®ç° æ‰€æœ‰æ–¹æ³•é»˜è®¤æ˜¯ public å’Œ abstract ä¿®é¥° (JDK 8 ä¹‹åå¯ä»¥è®¾ç½®defaultæ–¹æ³•æˆ–è€…é™æ€æ–¹æ³•)ï¼Œæ¥å£ç±»å¯ä»¥æ˜¯ç©ºçš„ (Serializable åºåˆ—åŒ–æ¥å£) å¯ä»¥åŒ…å«abstract æŠ½è±¡æ–¹æ³• (æ— å®ç°) å’Œ å…·ä½“æ–¹æ³•(æœ‰å®ç°)ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³• æ„é€ å‡½æ•°å’Œæˆå‘˜å˜é‡ æ¥å£ä¸èƒ½åŒ…å«æ„é€ å‡½æ•°ï¼Œæ‰€æœ‰æˆå‘˜å˜é‡é»˜è®¤ä¸º public static final å¸¸é‡ æŠ½è±¡ç±»å¯ä»¥åŒ…å«æ„é€ å‡½æ•°ï¼Œæˆå‘˜å˜é‡å¯ä»¥æœ‰ä¸åŒçš„ä¿®é¥°ç¬¦ï¼Œä¸ä¸€å®šæ˜¯å¸¸é‡ å¤šç»§æ‰¿ ä¸€ä¸ªç±»åªèƒ½å®ç°å¤šä¸ªæ¥å£ æŠ½è±¡ç±»åªèƒ½å•ç»§æ‰¿ ã€æ³¨æ„ã€‘\næ¥å£å’ŒæŠ½è±¡ç±»æ˜¯ä¸å¯ä»¥è¢«å®ä¾‹åŒ–çš„ï¼Œåªèƒ½ç”¨æ¥å®ç°æˆ–è€…ç»§æ‰¿ã€‚\nJDK 9 ä¹‹åï¼Œæ¥å£å¯ä»¥å®šä¹‰ç§æœ‰æ–¹æ³•ï¼Œç”¨äºdefault æ–¹æ³•çš„å†…éƒ¨é€»è¾‘å¤ç”¨\n// æ”¯ä»˜æ¥å£ interface PaymentInterface { // æ”¯ä»˜æ–¹æ³• void pay(double amount); // é€šçŸ¥æ”¯ä»˜çŠ¶æ€ void notifyPaymentStatus(String status); // ç§æœ‰æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥æ”¯ä»˜é‡‘é¢æ˜¯å¦åˆæ³• private boolean isAmountValid(double amount) { return amount \u0026gt; 0; } // default æ–¹æ³•ï¼ŒåŒ…å«äº†å¯¹ç§æœ‰æ–¹æ³•çš„è°ƒç”¨ default void performPayment(double amount) { if (isAmountValid(amount)) { pay(amount); } else { System.out.println(\u0026#34;Invalid payment amount\u0026#34;); } } } æ¥å£å½“ä¸­çš„ default æ–¹æ³•ï¼Œå®ç°å¯¹è±¡å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œé‡å†™ã€‚static æ–¹æ³•åªèƒ½é€šè¿‡æ¥å£åè°ƒç”¨\n6. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ JDK åŠ¨æ€ä»£ç†ï¼šåŸºäºåå°„æœºåˆ¶å’Œæ¥å£ï¼Œè¦æ±‚æ‰€æœ‰ä»£ç†ç±»éƒ½å¿…é¡»å®ç°æŸä¸ªæ¥å£ (ç›®æ ‡å¯¹è±¡è‡³å°‘å®ç°ä¸€ä¸ªæ¥å£) CGLIBï¼šåŸºäº ASM å­—èŠ‚ç ç”Ÿæˆå·¥å…·ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»æ¥å®ç°ä»£ç†ï¼Œæ‰€ä»¥è¦æ³¨æ„ final æ–¹æ³• ï¼ˆå­ç±»å¯ä»¥ç»§æ‰¿å¹¶ä½¿ç”¨çˆ¶ç±»çš„ final æ–¹æ³•ï¼Œä½†ä¸èƒ½é‡å†™ï¼ˆOverrideï¼‰è¯¥æ–¹æ³•ï¼‰ ç‰¹æ€§ JDK åŠ¨æ€ä»£ç† CGLIB åº•å±‚å®ç° æ¥å£ + åå°„ï¼Œé€šè¿‡åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ¥å£æ–¹æ³• ç”Ÿæˆå­ç±»çš„å­—èŠ‚ç  + é‡å†™è¢«ä»£ç†ç±»çš„æ–¹æ³• ä»£ç†å¯¹è±¡ å¿…é¡»å®ç°æ¥å£ ä¸éœ€è¦å®ç°æ¥å£ æ€§èƒ½ åˆ›å»ºä»£ç†å¼€é”€å°ï¼Œæ–¹æ³•è°ƒç”¨å¼€é”€å¤§ æ–¹æ³•è°ƒç”¨å¼€é”€å°ï¼Œåˆ›å»ºä»£ç†å¼€é”€å¤§ (éœ€è¦ç”Ÿæˆå­ç±»çš„å­—èŠ‚ç ) é™åˆ¶ ä¸èƒ½ä»£ç†æ²¡æœ‰æ¥å£çš„ç±» ä¸èƒ½ä»£ç† final ç±» å’Œ final æ–¹æ³• ä½¿ç”¨åœºæ™¯ éœ€è¦å®ç°æ¥å£çš„ç±» æ²¡æœ‰æ¥å£çš„ç±» Spring AOP é»˜è®¤æ–¹å¼ AOP é»˜è®¤é‡‡ç”¨JDKåŠ¨æ€ä»£ç† ç›®æ ‡ç±»æ²¡æœ‰æ¥å£çš„æ—¶å€™ï¼Œé‡‡ç”¨ CGLIB ã€æ³¨æ„ã€‘åœ¨ä¸åŒçš„jdkç‰ˆæœ¬ä¸‹ï¼ŒJDK åŠ¨æ€ä»£ç† å’Œ CGLIB çš„æ€§èƒ½éƒ½ä¸ä¸€æ · (å¯å‚è€ƒ CGLIBä¸JDKåŠ¨æ€ä»£ç†çš„è¿è¡Œæ€§èƒ½æ¯”è¾ƒ)\nJDK 1.6ï¼šè¿è¡Œæ¬¡æ•°å°‘çš„æƒ…å†µä¸‹ï¼ŒJDKåŠ¨æ€ä»£ç†å’ŒCGLIB åŸºæœ¬æ²¡å·®ï¼Œç”šè‡³JDKåŠ¨æ€ä»£ç†æ›´å¿«ã€‚å½“æ¬¡æ•°å¢åŠ ä¹‹åï¼ŒCGLIB ä¼šç¨å¾®å¿«ä¸€äº› JDK 1.7: åŸºæœ¬éƒ½æ˜¯ JDKåŠ¨æ€ä»£ç†æ¯”è¾ƒå¿«ï¼Œè¿è¡Œæ¬¡æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒJDKåŠ¨æ€ä»£ç†æ¯”CGLIB å¿« 30% å·¦å³ã€‚å½“æ¬¡æ•°å¢åŠ ä¹‹åï¼ŒJDKåŠ¨æ€ä»£ç†æ¯”CGLIB å¿«äº†æ¥è¿‘ä¸€å€ JDK 1.8ï¼šå’Œ JDK 1.7 è¡¨ç°åŸºæœ¬ä¸€è‡´ ã€JDK åŠ¨æ€ä»£ç†è¯¦è§£ã€‘\nJDK åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡åå°„æœºåˆ¶ï¼Œæ¥å®ç°ä»£ç†æ¥å£ä¸­çš„æ–¹æ³•çš„ã€‚é€šè¿‡ java.lang.reflect.Proxy ç±» å’Œ InvocationHandler æ¥å£æ¥å®ç°ä»£ç†ï¼Œ ä»£ç†å¯¹è±¡åªä»£ç†æ¥å£ä¸­çš„æ–¹æ³•ã€‚å½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•çš„æ—¶å€™ï¼Œä»£ç†ç±»ä¼šæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œç„¶åé€šè¿‡ InvocationHandler.invoke() æ–¹æ³•æ‰§è¡Œé¢å¤–çš„é€»è¾‘ã€‚ (AOP åˆ‡é¢ç¼–ç¨‹çš„åŸç†)\nä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­ï¼ŒDataQuery æ˜¯æ¥å£ï¼Œ DatabaseDataQuery å®ç°è¯¥æ¥å£ã€‚JDK åŠ¨æ€ä»£ç†è¦æ±‚è¢«ä»£ç†å¯¹è±¡è‡³å°‘å®ç°ä¸€ä¸ªæ¥å£ï¼Œä»¥ä¾¿ä»£ç†ç±»é€šè¿‡æ¥å£æš´éœ²ä»£ç†è¡Œä¸ºã€‚ é€šè¿‡ Proxy.newProxyInstance() åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š\nç±»åŠ è½½å™¨ï¼šThread.currentThread().getContextClassLoader()ï¼Œ ç”¨äºåŠ è½½ä»£ç†ç±» æ¥å£åˆ—è¡¨ï¼šnew Class[]{xxx.class}ï¼Œ æŒ‡å®šä»£ç†ç±»åº”è¯¥å®ç°çš„æ¥å£, é‡Œé¢å­˜æ”¾æ¥å£çš„ class è°ƒç”¨å¤„ç†å™¨ InvocationHandlerï¼šä»£ç†å¯¹è±¡çš„å®é™…é€»è¾‘æ˜¯ç”¨å®ç°è¿™ä¸ªInvocationHandleræ¥å£çš„ç±»æ¥æ™šæ¥æˆçš„ï¼Œæ¯”å¦‚CacheInvocationHandler æ‹¦æˆªä»£ç†æ–¹æ³•ï¼Œè°ƒç”¨å¹¶æ·»åŠ é¢å¤–é€»è¾‘ã€‚åº•å±‚çš„å®ç°é€»è¾‘å…¶å®å°±æ˜¯åå°„æœºåˆ¶ã€‚ // æ¥å£ public interface DataQuery { String query(String queryKey); String queryAll(String queryKey); } // ç›®æ ‡å®ç°ç±» public class DatabaseDataQuery implements DataQuery { @Override public String query(String queryKey) { // ä»–ä¼šä½¿ç”¨æ•°æ®æºä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¾ˆæ…¢ System.out.println(\u0026#34;æ­£åœ¨ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®\u0026#34;); return \u0026#34;result\u0026#34;; } @Override public String queryAll(String queryKey) { // ä»–ä¼šä½¿ç”¨æ•°æ®æºä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¾ˆæ…¢ System.out.println(\u0026#34;æ­£åœ¨ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®\u0026#34;); return \u0026#34;all result\u0026#34;; } } // è°ƒç”¨å¤„ç†å™¨ï¼šç”¨äºæ‹¦æˆªæ–¹æ³• public class CacheInvocationHandler implements InvocationHandler { private HashMap\u0026lt;String,String\u0026gt; cache = new LinkedHashMap\u0026lt;\u0026gt;(256); private DataQuery databaseDataQuery; public CacheInvocationHandler(DatabaseDataQuery databaseDataQuery) { this.databaseDataQuery = databaseDataQuery; } public CacheInvocationHandler() { this.databaseDataQuery = new DatabaseDataQuery(); } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { // 1ã€åˆ¤æ–­æ˜¯å“ªä¸€ä¸ªæ–¹æ³• String result = null; if(\u0026#34;query\u0026#34;.equals(method.getName())){ // 2ã€æŸ¥è¯¢ç¼“å­˜ï¼Œå‘½ä¸­ç›´æ¥è¿”å› result = cache.get(args[0].toString()); if(result != null){ System.out.println(\u0026#34;æ•°æ®ä»ç¼“å­˜é‡è·å–ã€‚\u0026#34;); return result; } // 3ã€æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“ï¼ˆéœ€è¦ä»£ç†å®ä¾‹ï¼‰ result = (String) method.invoke(databaseDataQuery, args); // 4ã€å¦‚æœæŸ¥è¯¢åˆ°äº†,è¿›è¡Œå‘¢ç¼“å­˜ cache.put(args[0].toString(),result); return result; } // å½“å…¶ä»–çš„æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸å¸Œæœ›è¢«å¹²é¢„ï¼Œç›´æ¥è°ƒç”¨åŸç”Ÿçš„æ–¹æ³• return method.invoke(databaseDataQuery,args); } } // æµ‹è¯•ç±»ï¼šå¦‚ä½•ä½¿ç”¨JDKåŠ¨æ€ä»£ç† public class Main { public static void main(String[] args) { // jdkæä¾›çš„ä»£ç†å®ç°ï¼Œä¸»è¦æ˜¯ä½¿ç”¨Proxyç±»æ¥å®Œæˆ // 1ã€classLoaderï¼šè¢«ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†ç±» ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader(); // 2ã€ä»£ç†ç±»éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ Class[] classes = new Class[]{DataQuery.class}; // 3ã€InvocationHandler CacheInvocationHandler cacheInvocationHandler = new CacheInvocationHandler(); DataQuery dataQuery = (DataQuery) Proxy.newProxyInstance(contextClassLoader, classes, cacheInvocationHandler); // äº‹å®ä¸Šè°ƒç”¨queryæ–¹æ³•çš„ä½¿ç”¨ï¼Œä»–æ˜¯è°ƒç”¨äº†invoke String result = dataQuery.query(\u0026#34;key1\u0026#34;); System.out.println(result); System.out.println(\u0026#34;--------------------\u0026#34;); result = dataQuery.query(\u0026#34;key1\u0026#34;); System.out.println(result); System.out.println(\u0026#34;--------------------\u0026#34;); result = dataQuery.query(\u0026#34;key2\u0026#34;); System.out.println(result); System.out.println(\u0026#34;++++++++++++++++++++++++++++++++++++\u0026#34;); // äº‹å®ä¸Šè°ƒç”¨queryAllæ–¹æ³•çš„ä½¿ç”¨ï¼Œä»–æ˜¯è°ƒç”¨äº†invoke result = dataQuery.queryAll(\u0026#34;key1\u0026#34;); System.out.println(result); System.out.println(\u0026#34;--------------------\u0026#34;); result = dataQuery.queryAll(\u0026#34;key1\u0026#34;); System.out.println(result); System.out.println(\u0026#34;--------------------\u0026#34;); result = dataQuery.queryAll(\u0026#34;key2\u0026#34;); System.out.println(result); System.out.println(\u0026#34;--------------------\u0026#34;); } } ã€CGLIB åŠ¨æ€ä»£ç†è¯¦è§£ã€‘\nCGLIB (Code Generation Library) ä»£ç ç”Ÿæˆåº“ æ˜¯åŸºäºå­—èŠ‚ç æ“ä½œçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå¹¶ä¸”é‡å†™ç›®æ ‡ç±»çš„æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚é€šè¿‡ç»§æ‰¿æ–¹å¼æ‹¦æˆªæ‰€æœ‰é final æ–¹æ³•çš„è°ƒç”¨ã€‚ CGLIB ä½¿ç”¨çš„æ˜¯ ASM å­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œç”Ÿæˆçš„æ˜¯å­—èŠ‚ç çº§åˆ«çš„ä»£ç†ç±»ã€‚æ€§èƒ½ç›¸å¯¹è¾ƒå¥½ï¼Œä½†æ˜¯ç”Ÿæˆä»£ç†ç±»çš„å¼€é”€æ¯” JDK åŠ¨æ€ä»£ç† ç¨å¾®å¤§ä¸€äº›ã€‚\nMain ç±»å½“ä¸­ï¼Œæ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œè¿™å°±æ˜¯ CGLIB çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œä¸éœ€è¦å®ç°ä»»ä½•æ¥å£ã€‚ CGLIB é€šè¿‡ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»æ¥å®ç°ä»£ç†ã€‚CGLIB é€šè¿‡ Enhancer ç±»æ¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œéœ€è¦é…ç½®çˆ¶ç±»å’Œæ‹¦æˆªå™¨ã€‚\nçˆ¶ç±»ï¼šenhancer.setSuperclass(DatabaseDataQuery.class) ï¼Œé…ç½®ç›®æ ‡ç±»ä½œä¸ºçˆ¶ç±» æ‹¦æˆªå™¨ï¼šenhancer.setCallback(new CacheMethodInterceptor()); ï¼Œé…ç½®æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªæ‰€æœ‰é final æ–¹æ³•çš„è°ƒç”¨ï¼Œå’ŒInvocationHandler å·®ä¸å¤šï¼Œå¯ä»¥æ’å…¥é¢å¤–çš„é€»è¾‘ã€‚ // æ‹¦æˆªå™¨ï¼šç”¨äºæ‹¦æˆªæ–¹æ³• public class CacheMethodInterceptor implements MethodInterceptor { private HashMap\u0026lt;String,String\u0026gt; cache = new HashMap\u0026lt;\u0026gt;(); private DatabaseDataQuery databaseDataQuery; public CacheMethodInterceptor( ) { this.databaseDataQuery = new DatabaseDataQuery(); }; @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { // 1ã€åˆ¤æ–­æ˜¯å“ªä¸€ä¸ªæ–¹æ³• String result = null; if(\u0026#34;query\u0026#34;.equals(method.getName())){ // 2ã€æŸ¥è¯¢ç¼“å­˜ï¼Œå‘½ä¸­ç›´æ¥è¿”å› result = cache.get(args[0].toString()); if(result != null){ System.out.println(\u0026#34;æ•°æ®ä»ç¼“å­˜é‡è·å–ã€‚\u0026#34;); return result; } // 3ã€æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“ï¼ˆéœ€è¦ä»£ç†å®ä¾‹ï¼‰ result = (String) method.invoke(databaseDataQuery, args); // 4ã€å¦‚æœæŸ¥è¯¢åˆ°äº†,è¿›è¡Œå‘¢ç¼“å­˜ cache.put(args[0].toString(),result); return result; } return method.invoke(databaseDataQuery,args); } } // æµ‹è¯•ç±»ï¼šå¦‚ä½•ä½¿ç”¨CGLIBè¿›è¡ŒåŠ¨æ€ä»£ç† public class Main { public static void main(String[] args) { //cglibé€šè¿‡Enhancerå®ç° Enhancer enhancer = new Enhancer(); //è®¾ç½®çˆ¶ç±» enhancer.setSuperclass(DatabaseDataQuery.class); //è®¾ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç”¨æ¥æ‹¦æˆªæ–¹æ³• enhancer.setCallback(new CacheMethodInterceptor()); //åˆ›å»ºä»£ç†ç±»ï¼Œå…¶å®å°±æ˜¯ç›®æ ‡ç±»çš„å­ç±» DatabaseDataQuery databaseDataQuery = (DatabaseDataQuery) enhancer.create(); databaseDataQuery.query(\u0026#34;Key1\u0026#34;); databaseDataQuery.query(\u0026#34;Key1\u0026#34;); databaseDataQuery.query(\u0026#34;Key2\u0026#34;); } } 7. ä½ ä½¿ç”¨è¿‡ Java çš„åå°„æœºåˆ¶å—ï¼Ÿå¦‚ä½•åº”ç”¨åå°„ï¼Ÿ åå°„æœºåˆ¶å®šä¹‰ï¼šJava çš„åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œè·å–ç±»çš„ç»“æ„ä¿¡æ¯ (æ¯”å¦‚æ–¹æ³•ã€å­—æ®µã€æ„å»ºå‡½æ•°) ï¼Œç„¶åè·å–æ“ä½œå¯¹è±¡çš„ä¸€ç§æœºåˆ¶ã€‚åå°„æœºåˆ¶å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ï¼ŒåŠ¨æ€åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µï¼Œä¸éœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™çŸ¥é“è¿™äº›ä¿¡æ¯ã€‚åå°„çš„æ ¸å¿ƒç±»åŒ…æ‹¬ Classã€Constuctorã€Methodã€Filed\nåå°„æœºåˆ¶ä½œç”¨ï¼š\nåŠ¨æ€è·å–ç±»ä¿¡æ¯ï¼šåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ç­‰ï¼Œä¸éœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™çŸ¥é“ç±»çš„ä¿¡æ¯ åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼šå¯ä»¥é€šè¿‡ Class ç±»æˆ–è€… Constructor å¯¹è±¡çš„ newInstance() åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œä¸éœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™çŸ¥é“å¯¹è±¡çš„ç±»å‹ åŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼šé€šè¿‡ Method ç±»çš„ invoke() æ–¹æ³•å®ç° è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼ï¼šé€šè¿‡ Filed.set() ç›´æ¥ä¿®æ”¹å¯¹è±¡çš„å€¼ï¼Œå’Œé€šè¿‡SetAccessible(true) ç»•è¿‡è®¿é—®é™åˆ¶ åå°„æœºåˆ¶çš„åº”ç”¨åœºæ™¯ï¼š ä¸€èˆ¬çš„ä¸šåŠ¡ç¼–ç ç”¨ä¸åˆ°åå°„æœºåˆ¶ï¼Œä½†æ˜¯åœ¨æ¡†æ¶ä¸Šä¼šç”¨åˆ°åå°„æœºåˆ¶ã€‚å› ä¸ºå†™æ¡†æ¶çš„æ—¶å€™ï¼Œå¾ˆå¤šåœºæ™¯æ˜¯å¾ˆçµæ´»çš„ï¼Œä¸èƒ½ç¡®å®šç›®æ ‡å¯¹è±¡çš„ç±»å‹ï¼Œåªèƒ½é€šè¿‡åå°„åŠ¨æ€è·å–å¯¹è±¡ä¿¡æ¯ã€‚æ¯”å¦‚ Spring ä½¿ç”¨åå°„æœºåˆ¶æ¥è¯»å–å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œä»è€Œå®ç° DI ä¾èµ–æ³¨å…¥å’Œ AOP åˆ‡é¢ç¼–ç¨‹ç­‰åŠŸèƒ½ã€‚\nDI ä¾èµ–æ³¨å…¥çš„å…·ä½“å®ç°ï¼Œå‡å¦‚å¯¹æŒ‡å®šç±»åŠ ä¸Š @Service æ³¨è§£ï¼Œä¸‹é¢æ˜¯å…·ä½“çš„å®ç°è¿‡ç¨‹ï¼š\nSpring åœ¨å®¹å™¨å¯åŠ¨åˆå§‹åŒ–çš„æ—¶å€™, å°†æ‰€æœ‰å¸¦æœ‰@Serviceã€@Componentç­‰æ³¨è§£çš„ç±»ï¼Œæ”¾å…¥å®¹å™¨å½“ä¸­ï¼Œæ³¨å†Œä¸ºBean Spring å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå°†å¸¦æœ‰@Autowired æ³¨è§£çš„ç±»è¿›è¡Œæ ‡è®°ï¼Œç„¶åä½¿ç”¨åå°„æœºåˆ¶å°†æ‰€æœ‰çš„å­—æ®µã€æ–¹æ³•ã€æ„é€ å™¨è¿›è¡Œæ³¨å…¥ åå°„çš„ä½¿ç”¨æ–¹æ³•ï¼š\nè·å– Class å¯¹è±¡\nClass\u0026lt;?\u0026gt; clazz = Class.forName(\u0026#34;com.swimmingliu.MyClass\u0026#34;); // æˆ–è€… Class\u0026lt;?\u0026gt; clazz = MyClass.class; // æˆ–è€… Class\u0026lt;?\u0026gt; clazz = obj.getClass(); åˆ›å»ºå¯¹è±¡ ï¼šä¸€èˆ¬éƒ½é‡‡ç”¨ Constructor æ¥æ„é€ å¯¹è±¡\nObject obj = clazz.newInstance(); // å·²è¿‡æ—¶ Constructor\u0026lt;?\u0026gt; constructor = clazz.getConstructor(); Object obj = constructor.newInstance(); è®¿é—®å­—æ®µï¼šå¯ä»¥è®©ç§æœ‰å¯¹è±¡å¯è§ï¼Œè€Œä¸”èƒ½å¤Ÿè®¾ç½®å®ƒçš„å€¼\nField field = clazz.getField(\u0026#34;name\u0026#34;); // å‡è®¾ private String name; field.setAccessible(true); // å…è®¸è®¿é—® private å­—æ®µ Object value = field.get(obj); field.set(obj, newValue); è°ƒç”¨æ–¹æ³•ï¼š\nMethod method = clazz.getMethod(\u0026#34;myMethod\u0026#34;, String.class); Object result = method.invoke(obj, \u0026#34;param\u0026#34;); ","permalink":"https://swimmingliu.cn/posts/job/java-basic-interview-questions/","summary":"\u003ch2 id=\"1-åºåˆ—åŒ–å’Œååºåˆ—åŒ–\"\u003e1. åºåˆ—åŒ–å’Œååºåˆ—åŒ–\u003c/h2\u003e\n\u003cp\u003e1.åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œç”¨äºå­˜å‚¨å’Œä¼ è¾“ï¼›è¯»å–å­—èŠ‚æµæ•°æ®ï¼Œé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚\n2.åºåˆ—åŒ–ä¸åŒ…æ‹¬é™æ€å¯¹è±¡ï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æœ¬è´¨æ˜¯è°ƒç”¨å¯¹è±¡çš„\u003ccode\u003ewriteObject\u003c/code\u003eå’Œ\u003ccode\u003ereadObject\u003c/code\u003eæ–¹æ³•,æ¥å®ç°å°†å¯¹è±¡å†™å…¥è¾“å‡ºæµå’Œè¯»å–è¾“å…¥æµã€‚ä½†æ˜¯ï¼Œé™æ€å˜é‡ä¸å±äºå¯¹è±¡ï¼Œæ‰€ä»¥è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ²¡æ³•å„¿è®©é™æ€å˜é‡å‚ä¸ã€‚\u003c/p\u003e\n\u003ch2 id=\"2-ä»€ä¹ˆæ˜¯ä¸å¯å˜ç±»\"\u003e2. ä»€ä¹ˆæ˜¯ä¸å¯å˜ç±»ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e1.ä¸å¯å˜ç±»ï¼šåˆå§‹åŒ–ä¹‹åï¼Œå°±ä¸èƒ½ä¿®æ”¹çš„ç±»ã€‚\n2.ä¿®é¥°æ–¹æ³•ï¼šfinal å’Œ private ä¿®é¥°æ‰€æœ‰ç±»å’Œå˜é‡\n3.ä¸å¯ä¿®æ”¹ï¼šä¸æš´éœ²setæ–¹æ³•ï¼Œåªèƒ½é€šè¿‡é‡æ–°åˆ›å»ºå¯¹è±¡æ›¿ä»£ä¿®æ”¹åŠŸèƒ½(\u003ccode\u003eString\u003c/code\u003eçš„replaceæ–¹æ³•)\n4.ä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œç¼“å­˜å‹å¥½\nç¼ºç‚¹ï¼šé¢‘ç¹æ‹¼æ¥å’Œä¿®æ”¹ä¼šæµªè´¹èµ„æº\u003c/p\u003e\n\u003ch2 id=\"3-exceptionå’ŒerroråŒºåˆ«\"\u003e3. Exceptionå’ŒErroråŒºåˆ«?\u003c/h2\u003e\n\u003cp\u003e1.Exceptionå’ŒErrorå®šä¹‰åŒºåˆ«ï¼šExceptionæ˜¯å¯å¤„ç†ç¨‹åºå¼‚å¸¸ï¼ŒErroræ˜¯ç³»ç»Ÿçº§ä¸å¯å›å¤é”™è¯¯\n2.try-catchå»ºè®®ï¼š\n1.èŒƒå›´èƒ½å°åˆ™å°\n2.Exceptionæœ€å¥½è¦å†™æ¸…æ¥šå…·ä½“æ˜¯å“ªä¸€ä¸ªException(IOException)\n3.nullå€¼ç­‰èƒ½ç”¨ifåˆ¤æ–­çš„ï¼Œä¸è¦ç”¨try-catch,å› ä¸ºå¼‚å¸¸æ¯”æ¡ä»¶è¯­å¥ä½æ•ˆ\n4.finallyä¸è¦ç›´æ¥returnå’Œå¤„ç†è¿”å›å€¼\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Exceptionå’ŒErroråŒºåˆ«\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/946b73cc-ef5d-11ef-95ab-c858c0c1deba\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4-java-ä¸­çš„-hashcode-å’Œ-equals-æ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»\"\u003e4. Java ä¸­çš„ hashCode å’Œ equals æ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e1ã€\u003ccode\u003eequals()\u003c/code\u003e å’Œ \u003ccode\u003ehashCode()\u003c/code\u003e çš„å…³ç³»\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœä¸¤ä¸ªå¯¹è±¡\u003ccode\u003eeuqals()\u003c/code\u003e ä¸º \u003ccode\u003etrue\u003c/code\u003eï¼Œ åˆ™å…¶ \u003ccode\u003ehashCode()\u003c/code\u003eä¸€å®šç›¸åŒ\u003c/li\u003e\n\u003cli\u003eå¦‚æœä¸¤ä¸ªå¯¹è±¡\u003ccode\u003ehashCode()\u003c/code\u003e ç›¸åŒï¼Œå…¶\u003ccode\u003eequals()\u003c/code\u003eç»“æœä¸ä¸€å®šä¸º\u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e2ã€ä¸ºä»€ä¹ˆé‡å†™\u003ccode\u003eequals()\u003c/code\u003eä¹‹åï¼Œä¸€å®šè¦é‡å†™\u003ccode\u003ehashCode()\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eå½“é‡å†™\u003ccode\u003eequals()\u003c/code\u003e ä¹‹åï¼Œé€šå¸¸æ˜¯é‡æ–°å®šä¹‰äº†ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰çš„é€»è¾‘ã€‚å¦‚æœä¸é‡å†™\u003ccode\u003ehashCode()\u003c/code\u003eæ–¹æ³•ï¼Œ åˆ™åœ¨æ•£åˆ—é›†åˆï¼ˆ\u003ccode\u003eHashMap\u003c/code\u003e å’Œ \u003ccode\u003eHashSet\u003c/code\u003eï¼‰ä¸­ï¼Œå¯èƒ½æ— æ³•æ­£ç¡®å­˜å‚¨å’Œæ£€ç´¢ï¼Œå› ä¸ºä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡å¯èƒ½æœ‰ä¸åŒçš„\u003ccode\u003ehash\u003c/code\u003eå€¼ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¾‹å¦‚ï¼Œä¸‹æ–¹Personç±»é‡å†™äº†\u003ccode\u003eequals()\u003c/code\u003e æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰é‡æ–°\u003ccode\u003ehashCode()\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-Java\" data-lang=\"Java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePerson\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nd\"\u003e@Override\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nf\"\u003eequals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003egetClass\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e!=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eage\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eequals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ›å»ºç›¸åŒçš„å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°\u003ccode\u003eHashSet\u003c/code\u003eä¸­\u003c/p\u003e","title":"JavaåŸºç¡€é¢˜é¢è¯•ç¬”è®°"},{"content":"1.MySQL ä¸­çš„æ•°æ®æ’åºæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ 1.æ’åºæ–¹æ³•ï¼šç´¢å¼•æ’åºå’Œæ–‡ä»¶æ’åº (filesort)\n2.ç´¢å¼•æ’åºï¼šå¦‚æœorder by xxxçš„å­—æ®µä¸ºç´¢å¼•å­—æ®µï¼Œåˆ™åˆ©ç”¨ç´¢å¼•è¿›è¡Œæ’åºã€‚æ•ˆç‡æœ€é«˜ï¼Œç´¢å¼•é»˜è®¤æœ‰åºã€‚\n3.æ–‡ä»¶æ’åº (filesort)ï¼šå†…å­˜æ’åº(å•è·¯æ’åºå’ŒåŒè·¯æ’åº)å’Œç£ç›˜æ’åºï¼Œå…·ä½“å–å†³äºæ’åºæ•°æ®çš„å¤§å°ã€‚å…¶ä¸­ï¼Œå†…å­˜æ’åºä½¿ç”¨å•è·¯æ’åºæˆ–åŒè·¯æ’åºï¼Œå–å†³äºmax_length_for_sort_data(é»˜è®¤ä¸º4096ä¸ªå­—èŠ‚)\n4.åŒè·¯æ’åºï¼šå–row_id(å¦‚æœæœ‰ä¸»é”®ï¼Œåˆ™ä¸ºä¸»é”®)å’Œselect a,b,c order by xxxçš„xxxå­—æ®µæ”¾å…¥sort_buffer(æ’åºç¼“å­˜)ä¸­ï¼Œå°†æ’åºåçš„row_idå›è¡¨æŸ¥è¯¢a,b,c\n5.å•è·¯æ’åº: ç›´æ¥æŠŠè¦æŸ¥çš„æ‰€æœ‰å­—æ®µæ”¾å…¥sort_bufferé‡Œï¼Œæ’åºåç›´æ¥å¾—åˆ°ç»“æœé›†åˆ\n6.ç£ç›˜æ’åºï¼ˆå½’å¹¶æ’åºï¼‰:å°†æ•°æ®åˆ†ä¸ºå¤šä»½æ–‡ä»¶ï¼Œå•ç‹¬å¯¹æ–‡ä»¶è¿›è¡Œæ’åºï¼Œç„¶ååˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶\n2. MySQL çš„ Change Buffer æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 1.ChangeBufferå®šä¹‰ï¼šChange Bufferæ˜¯InnoDBç¼“å†²å½“ä¸­çš„ä¸€å—ç¼“å­˜åŒºï¼Œç”¨äºæš‚å­˜äºŒçº§ç´¢å¼•çš„ä¿®æ”¹ï¼Œé¿å…äºŒçº§ç´¢å¼•é¡µä¿®æ”¹äº§ç”Ÿçš„éšæœºIO 2.ChangeBufferæ³¨æ„äº‹é¡¹ï¼šåªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ï¼Œä¸èƒ½ç”¨äºå…¶ä»–ä»»ä½•ç´¢å¼•ï¼ŒåŒ…æ‹¬ä¸»é”®ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•éƒ½ä¸è¡Œã€‚ 3.å¦‚æœChangeBufferæŒ‚äº†ï¼Œæ›´æ”¹æ“ä½œæœªæ‰§è¡Œï¼Œæ˜¯å¦ä¼šå‡ºç°è„æ•°æ®ï¼Ÿ é¦–å…ˆï¼ŒChangeBufferä¹Ÿä¼šä¿å­˜åœ¨ç£ç›˜ç©ºé—´é‡Œé¢ï¼Œredo logä¼šè®°å½•Change Bufferå½“ä¸­çš„ä¿®æ”¹æ“ä½œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚\nçŸ¥è¯†æ‹“å±•1ï¼šä¸€çº§ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•åŒºåˆ«\nä¸€çº§ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰ï¼šæ•°æ®è¡¨çš„ä¸»é”®ç´¢å¼•ï¼Œæ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨åŒä¸€B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸€çº§ç´¢å¼•ã€‚\näºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰ï¼šé™¤ä¸»é”®å¤–çš„å…¶ä»–ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡äºŒçº§ç´¢å¼•è·å–ä¸»é”®å€¼ï¼Œå†é€šè¿‡ä¸»é”®å€¼æŸ¥è¯¢æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œå›è¡¨â€ã€‚\nçŸ¥è¯†æ‹“å±•2: MySQLä¸­æœ‰å“ªäº›å¸¸è§ç´¢å¼•ï¼Ÿéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nåœ¨MySQLä¸­ï¼Œç´¢å¼•æ˜¯æé«˜æŸ¥è¯¢æ•ˆç‡çš„å…³é”®å·¥å…·ã€‚å¸¸è§çš„ç´¢å¼•ç±»å‹åŒ…æ‹¬ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ã€‚\n1. ä¸»é”®ç´¢å¼•ï¼ˆPrimary Key Indexï¼‰\nå®šä¹‰ï¼šä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä¸”ä¸»é”®åˆ—çš„å€¼ä¸èƒ½ä¸ºç©ºã€‚ ç‰¹ç‚¹ï¼šä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„æ•°æ®è¡Œï¼Œå› æ­¤æŸ¥è¯¢æ•ˆç‡é«˜ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆå¹¶ã€‚ 2. å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰\nå®šä¹‰ï¼šå”¯ä¸€ç´¢å¼•ç¡®ä¿ç´¢å¼•åˆ—çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚ä¸ä¸»é”®ç´¢å¼•ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå”¯ä¸€ç´¢å¼•å…è®¸åˆ—å€¼ä¸ºNULLã€‚ ç‰¹ç‚¹ï¼šå”¯ä¸€ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚åœ¨InnoDBä¸­ï¼Œå”¯ä¸€ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚ 3. æ™®é€šç´¢å¼•ï¼ˆIndexï¼‰\nå®šä¹‰ï¼šæ™®é€šç´¢å¼•æ˜¯æœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚ç´¢å¼•åˆ—çš„å€¼å¯ä»¥é‡å¤ï¼Œä¹Ÿå¯ä»¥ä¸ºNULLã€‚ ç‰¹ç‚¹ï¼šæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚åœ¨InnoDBä¸­ï¼Œæ™®é€šç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚ 4. å…¨æ–‡ç´¢å¼•ï¼ˆFulltext Indexï¼‰\nå®šä¹‰ï¼šå…¨æ–‡ç´¢å¼•ç”¨äºå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œå…¨æ–‡æœç´¢ï¼Œé€‚ç”¨äºMyISAMå­˜å‚¨å¼•æ“ã€‚å®ƒå…è®¸å¯¹æ–‡æœ¬å­—æ®µè¿›è¡Œå¤æ‚çš„æœç´¢ï¼Œå¦‚æŸ¥æ‰¾åŒ…å«ç‰¹å®šå•è¯çš„è®°å½•ã€‚ ç‰¹ç‚¹ï¼šå…¨æ–‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨æ–‡æ¡£çš„è¯é¡¹ä¿¡æ¯ã€‚åœ¨MyISAMä¸­ï¼Œå…¨æ–‡ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚ 5. ç©ºé—´ç´¢å¼•ï¼ˆSpatial Indexï¼‰\nå®šä¹‰ï¼šç©ºé—´ç´¢å¼•ç”¨äºå¯¹åœ°ç†ç©ºé—´æ•°æ®è¿›è¡Œç´¢å¼•ï¼Œæ”¯æŒç©ºé—´æ•°æ®ç±»å‹çš„å¿«é€ŸæŸ¥è¯¢ã€‚å®ƒé€‚ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ã€åœ°å›¾ç­‰ç©ºé—´æ•°æ®çš„è¡¨ã€‚ ç‰¹ç‚¹ï¼šç©ºé—´ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç©ºé—´æ•°æ®çš„ç´¢å¼•ä¿¡æ¯ã€‚åœ¨MyISAMä¸­ï¼Œç©ºé—´ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚ æ€»ç»“ï¼š\nä¸»é”®ç´¢å¼•ï¼šç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸€è¡Œæ•°æ®ï¼Œå€¼ä¸èƒ½ä¸ºç©ºã€‚ å”¯ä¸€ç´¢å¼•ï¼šç¡®ä¿ç´¢å¼•åˆ—çš„å€¼å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚ æ™®é€šç´¢å¼•ï¼šæœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œå…è®¸é‡å¤å’Œç©ºå€¼ã€‚ å…¨æ–‡ç´¢å¼•ï¼šç”¨äºå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œå…¨æ–‡æœç´¢ï¼Œé€‚ç”¨äºMyISAMå­˜å‚¨å¼•æ“ã€‚ ç©ºé—´ç´¢å¼•ï¼šç”¨äºå¯¹åœ°ç†ç©ºé—´æ•°æ®è¿›è¡Œç´¢å¼•ï¼Œæ”¯æŒç©ºé—´æ•°æ®ç±»å‹çš„å¿«é€ŸæŸ¥è¯¢ã€‚ 3. è¯¦ç»†æè¿°ä¸€æ¡ SQL è¯­å¥åœ¨ MySQL ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ è¿æ¥å™¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æˆåŠŸå»ºç«‹è¿æ¥ï¼Œæ•°æ®åº“è¿æ¥çš„æƒé™æ ¡éªŒ è¿æ¥å™¨ä¼šæŸ¥è¯¢ç¼“å­˜ï¼Œkey æ˜¯ SQL è¯­å¥ï¼Œvalue æ˜¯æŸ¥è¯¢ç»“æœã€‚å¦‚æœå‘½ä¸­ï¼Œç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœã€‚(MySQL 8.0ä¹‹åï¼Œå°±ç§»é™¤è¿™ä¸ªåŠŸèƒ½äº†)ã€‚ åˆ†æå™¨åˆ†æSQLè¯­æ³•å’Œè¯æ³•æ˜¯å¦æœ‰è¯¯ ä¼˜åŒ–å™¨ç”ŸæˆSQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œç¡®å®šä½¿ç”¨çš„ç´¢å¼•å’Œè°ƒæ•´whereçš„æ‰§è¡Œé¡ºåºï¼ˆåŒ…æ‹¬è¿è¡¨é¡ºåºï¼‰ æ‰§è¡Œå™¨åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æŸ¥è¯¢è¯¥è¡¨ï¼Œç„¶åæ‰§è¡Œè¯¥SQLè¯­å¥ [å‚è€ƒæ–‡çŒ®] æ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n[è¡¥å……] 3. MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog æœ‰ä»€ä¹ˆç”¨ï¼Ÿ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„åŸå­æ€§ï¼Œä¸»è¦ç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCCã€‚ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„æŒä¹…æ€§ï¼Œä¸»è¦ç”¨äºæ‰ç”µç­‰æ•…éšœæ¢å¤ï¼› binlog ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ï¼šæ˜¯ Server å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦ç”¨äºæ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶ï¼›\nç›´æ¥çœ‹å‚è€ƒæ–‡çŒ®å½“ä¸­çš„ä¸ƒä¸ªé—®é¢˜å’Œå…¶è§£å†³æ–¹æ¡ˆ\n[å‚è€ƒæ–‡çŒ®] MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog æœ‰ä»€ä¹ˆç”¨ï¼Ÿ\n4. MySQL çš„å­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ InnoDB : æ”¯æŒäº‹åŠ¡ã€è¡Œé”ã€å¤–é”®; é«˜å¹¶å‘æ€§èƒ½ã€æ”¯æŒé«˜è´Ÿè½½çš„OLTPåº”ç”¨ (é“¶è¡Œäº¤æ˜“ã€ç”µå­å•†åŠ¡è®¢å•ã€åº“å­˜ç®¡ç†ç­‰); èšé›†ç´¢å¼•å­˜å‚¨ï¼Œæ£€ç´¢æ•ˆç‡é«˜\nMyISAM: è¡¨é”ã€ä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®; é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯(æ•°æ®ä»“åº“); è¾ƒé«˜è¯»æ€§èƒ½å’Œjè¾ƒå¿«çš„è¡¨çº§é”å®š\nMEMORY: å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦å¿«ï¼Œé‡å¯åæ•°æ®ä¸¢å¤±; é€‚ç”¨äºä¸´æ—¶æ•°æ®å­˜å‚¨å’Œå¿«é€Ÿå­˜å‚¨\n5. MySQL çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›ï¼Ÿ åˆ’åˆ†æ–¹å‘ ç´¢å¼•ç±»å‹ æ•°æ®ç»“æ„ B+æ ‘ç´¢å¼•ã€Hashç´¢å¼•ã€å€’æ’ç´¢å¼• (å…¨æ–‡ç´¢å¼•)ã€R-æ ‘ç´¢å¼• (å¤šç»´ç©ºé—´æ ‘)ã€ä½å›¾ç´¢å¼•(Bitmap) ç‰©ç†å­˜å‚¨ èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼• å­—æ®µç‰¹æ€§ ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•(äºŒçº§ç´¢å¼•ã€è¾…åŠ©ç´¢å¼•)ã€å‰ç¼€ç´¢å¼• å­—æ®µä¸ªæ•° å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼• 6. MySQL InnoDB å¼•æ“ä¸­çš„èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ èšç°‡ç´¢å¼•ï¼šå°±åƒæ˜¯å›¾ä¹¦é¦†é‡ŒæŒ‰ç…§ä¹¦ç±ä¸»é¢˜é¡ºåºæ‘†æ”¾çš„ä¹¦æ¶ã€‚åœ¨è¿™ä¸ªä¹¦æ¶ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ï¼‰ä¸Šï¼Œæ¯æœ¬ä¹¦ï¼ˆä¹Ÿå°±æ˜¯æ•°æ®åº“ä¸­çš„è¡Œæ•°æ®ï¼‰éƒ½æ˜¯æŒ‰ç…§æŸä¸ªä¸»é¢˜ï¼ˆé€šå¸¸æ˜¯ä¸»é”®ï¼‰æ¥æ’åˆ—çš„ã€‚æ‰€ä»¥ï¼Œå½“ä½ æƒ³è¦æ‰¾æŸä¸€ä¸»é¢˜çš„ä¹¦æ—¶ï¼Œåªè¦çŸ¥é“ä¸»é¢˜åï¼ˆä¸»é”®å€¼ï¼‰ï¼Œå°±èƒ½å¾ˆå¿«åœ¨ä¹¦æ¶ä¸Šæ‰¾åˆ°å®ƒï¼Œè€Œä¸”ç›¸é‚»ä¸»é¢˜çš„ä¹¦ä¹Ÿæ˜¯æŒ¨åœ¨ä¸€èµ·çš„ï¼Œæ‰¾èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦æ”¹å˜æŸæœ¬ä¹¦çš„ä¸»é¢˜ï¼ˆæ›´æ–°ä¸»é”®ï¼‰ï¼Œå¯èƒ½å°±éœ€è¦ç§»åŠ¨æ•´æœ¬ä¹¦åˆ°æ–°çš„ä½ç½®ï¼Œç”šè‡³å¯èƒ½éœ€è¦é‡æ–°æ•´ç†æ•´ä¸ªä¹¦æ¶ï¼ˆæ•°æ®é¡µï¼‰ï¼Œè¿™æ ·å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\néèšç°‡ç´¢å¼•ï¼šåˆ™æ›´åƒæ˜¯å›¾ä¹¦é¦†é‡Œçš„ä¸€ä¸ªç´¢å¼•å¡ç‰‡ç®±ã€‚åœ¨è¿™ä¸ªå¡ç‰‡ç®±é‡Œï¼Œæ¯å¼ å¡ç‰‡ï¼ˆä¹Ÿå°±æ˜¯éèšç°‡ç´¢å¼•çš„èŠ‚ç‚¹ï¼‰ä¸Šéƒ½å†™ç€ä¹¦ç±çš„ä¸»é¢˜ï¼ˆç´¢å¼•åˆ—çš„å€¼ï¼‰å’Œä¹¦ç±åœ¨ä¹¦æ¶ä¸Šçš„ä½ç½®ï¼ˆä¸»é”®å€¼æˆ–ROWIDï¼‰ã€‚å½“ä½ æƒ³è¦æ‰¾ä¸€æœ¬ä¹¦æ—¶ï¼Œå¯ä»¥å…ˆåœ¨å¡ç‰‡ç®±é‡Œæ‰¾åˆ°å¯¹åº”çš„å¡ç‰‡ï¼Œç„¶åæ ¹æ®å¡ç‰‡ä¸Šçš„ä½ç½®ä¿¡æ¯å»ä¹¦æ¶ä¸Šæ‰¾ä¹¦ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯çµæ´»ï¼Œä½ å¯ä»¥ä¸ºä¸åŒçš„ä¹¦ç±ä¸»é¢˜åˆ¶ä½œå¤šå¼ å¡ç‰‡ï¼Œæ–¹ä¾¿ä»ä¸åŒçš„è§’åº¦æŸ¥æ‰¾ä¹¦ç±ã€‚ä½†æ˜¯ï¼Œåå¤„æ˜¯æ¯æ¬¡æ‰¾ä¹¦éƒ½éœ€è¦ä¸¤æ­¥ï¼šå…ˆåœ¨å¡ç‰‡ç®±é‡Œæ‰¾å¡ç‰‡ï¼Œå†å»ä¹¦æ¶ä¸Šæ‰¾ä¹¦ï¼Œè¿™æ ·å¯èƒ½ä¼šæ¯”ç›´æ¥åœ¨ä¹¦æ¶ä¸Šæ‰¾ä¹¦è¦æ…¢ä¸€äº›ã€‚\næ€»çš„æ¥è¯´ï¼Œèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•å­˜å‚¨æ•°æ®å’Œç´¢å¼•ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å½±å“æ•°æ®çš„æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œã€‚èšç°‡ç´¢å¼•å°†æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•ä¸Šï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†æ›´æ–°æ“ä½œå¯èƒ½è¾ƒå¤æ‚ï¼›è€Œéèšç°‡ç´¢å¼•åˆ™é€šè¿‡ç´¢å¼•æŒ‡å‘æ•°æ®ï¼Œæä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œä½†æŸ¥è¯¢æ—¶å¯èƒ½éœ€è¦é¢å¤–çš„æ­¥éª¤ã€‚åœ¨é€‰æ‹©ä½¿ç”¨å“ªç§ç´¢å¼•æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’ŒæŸ¥è¯¢éœ€æ±‚æ¥å†³å®šã€‚\nMySQL InnoDBçš„èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•å°±åƒå›¾ä¹¦é¦†çš„ä¸¤ç§æ‰¾ä¹¦çš„æ–¹å¼ã€‚ 1.èšç°‡ç´¢å¼•ï¼šå›¾ä¹¦é¦†åœ¨ä¹¦æ¶ä¸Š(èšç°‡ç´¢å¼•)æ‘†æ”¾å„ç§ç¼–å·(ä¸»é”®åç§°)çš„ä¹¦æœ¬(æ•°æ®åº“ä¸­æ¯ä¸€è¡Œçš„æ•°æ®)ã€‚å½“ä½ éœ€è¦ä»å›¾ä¹¦é¦†æ‰¾æŸä¸€æœ¬ä¹¦æ—¶ï¼Œåªéœ€è¦çŸ¥é“ä¹¦ç±çš„ç¼–å·(ä¸»é”®å€¼)ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°ä»–ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦æ¢æŸä¸€æœ¬ä¹¦çš„ç¼–å·(æ›´æ–°ä¸»é”®)ï¼Œå°±éœ€è¦ç§»åŠ¨æ•´æœ¬ä¹¦åˆ°æ–°çš„ä½ç½®ï¼Œç”šè‡³é‡æ–°æ•´ç†ä¹¦æ¶(æ•°æ®é¡µ)ã€‚è¿™ä¹Ÿæ˜¯æ¨èä½¿ç”¨select *çš„åŸå› ï¼Œå› ä¸ºå¦‚æœéœ€è¦æŸ¥æ‰¾ç´¢å¼•åˆ—çš„æ•°æ®ï¼Œç›´æ¥ç”¨äºŒçº§ç´¢å¼•å°±å¯ä»¥æ‰¾åˆ°æ•°æ®ã€‚ä¾‹å¦‚é€šè¿‡å§“åï¼ˆäºŒçº§ç´¢å¼•ï¼‰æŸ¥è¯¢id(ä¸»é”®ç´¢å¼•)ï¼Œç›´æ¥ç”¨äºŒçº§ç´¢å¼•å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„id.ä½†æ˜¯å¦‚æœç”¨select *,æ•°æ®åº“å°±ä¼šå›è¡¨æŸ¥è¯¢å…¶ä»–çš„æ•°æ®ï¼ˆæ€§åˆ«ï¼Œå¹´é¾„ç­‰ç­‰ï¼‰ã€‚ 2.éèšç°‡ç´¢å¼•ï¼šå°±åƒå›¾ä¹¦é¦†å•ç‹¬è®¾ç½®ç¼–å·å¡ç‰‡ç®±ï¼Œæ¯å¼ å¡ç‰‡(éèšç°‡ç´¢å¼•)ä¸ŠåŒ…å«äº†ä¹¦ç±åç§°(ç´¢å¼•åˆ—çš„å€¼)å’Œä¹¦ç±åœ¨ä¹¦æ¶ä¸Šçš„ç¼–å·ä½ç½®(ä¸»é”®å€¼æˆ–è€…ROWID)ã€‚å½“ä½ æƒ³è¦æ‰¾æŸæœ¬ä¹¦çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®å¡ç‰‡é‡Œé¢å¯¹åº”çš„ç¼–å·è¿›è¡ŒæŸ¥æ‰¾ã€‚åå¤„æ˜¯æ¯æ¬¡éƒ½éœ€è¦ä¸¤æ­¥èµ°ï¼ŒæŸ¥æ‰¾èµ·æ¥æ²¡é‚£ä¹ˆæ–¹ä¾¿ã€‚ æ€»ç»“ï¼šèšç°‡ç´¢å¼•æ˜¯åŒ…å«æ•°æ®çš„ï¼Œæ‰€ä»¥æŸ¥æ‰¾èµ·æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯æ›´æ–°æ“ä½œå¼€é”€å¤§ã€‚éèšç°‡ç´¢å¼•ä¸åŒ…å«æ•°æ®ï¼ŒåªåŒ…å«ç´¢å¼•åˆ—çš„å€¼å’Œå…¶æŒ‡å‘çš„æ•°æ®ç´¢å¼•ï¼Œéœ€è¦ä¸¤æ­¥èµ°æ‰èƒ½æŸ¥åˆ°æ•°æ®ã€‚\n7. MySQL ä¸­çš„å›è¡¨æ˜¯ä»€ä¹ˆï¼Ÿ å›è¡¨ï¼šç”¨äºŒçº§ç´¢å¼•ä¸­çš„ä¸»é”®å–èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®è¡Œçš„è¿‡ç¨‹ ä¸ºä»€ä¹ˆéœ€è¦å›è¡¨ï¼šä½¿ç”¨éèšç°‡ç´¢å¼•çš„äºŒçº§ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œåªèƒ½æŸ¥åˆ°ç´¢å¼•åˆ—çš„å€¼å’Œå…¶ä¸»é”®å€¼ï¼Œæ— æ³•è·å–å…¶ä»–æ•°æ® å›è¡¨çš„ç¼ºç‚¹ï¼šå›è¡¨ä¼šå¸¦æ¥éšæœºI/O, é¢‘ç¹å›è¡¨ä¼šå¯¼è‡´æ•ˆç‡éå¸¸ä½ã€‚æ‰€ä»¥ä¸æ¨èä½¿ç”¨ select * å›è¡¨çš„å…¶ä»–åœºæ™¯ï¼šå½“æŸ¥è¯¢çš„éƒ¨åˆ†åˆ—æ²¡æœ‰åŒ…å«åœ¨ç´¢å¼•ä¸­æ—¶ï¼Œå³ä¾¿ä½¿ç”¨äº†ç´¢å¼•ï¼Œä¹Ÿéœ€è¦ä¼šå»è·å–ç¼ºå¤±çš„åˆ—æ•°æ®ï¼Œç§°ä¸ºè¦†ç›–ç´¢å¼•ç¼ºå¤±ã€‚ è¦†ç›–ç´¢å¼•ç¼ºå¤±å‘é€åœºæ™¯ï¼šselect è¯­å¥å½“ä¸­åŒ…å«äº†éç´¢å¼•åˆ—; ç´¢å¼•çš„ç±»å‹ä¸ºHashå’Œfull-textç´¢å¼• ï¼ˆä¸å­˜å‚¨åˆ—çš„å€¼ï¼‰ï¼Œä¸æ”¯æŒè¦†ç›–ç´¢å¼•ã€‚ å¦‚ä½•å‡å°‘å›è¡¨ï¼šMySQL5.6ä¹‹åï¼Œå¼•å…¥äº†æé«˜æŸ¥è¯¢æ•ˆç‡çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé»˜è®¤å¼€å¯ã€‚å…è®¸MySQLç”¨ç´¢å¼•æŸ¥æ‰¾æ•°æ®æ—¶ï¼Œå°†éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶ä¸‹æ¨åˆ°ç´¢å¼•å¼•æ“å±‚æ¥è¿‡æ»¤ï¼Œå‡å°‘äº†éœ€è¦è¯»å–çš„æ•°æ®è¡Œã€‚ 8. MySQLç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æ˜¯ä»€ä¹ˆ? æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™çš„å®šä¹‰ï¼šä½¿ç”¨è”åˆç´¢å¼•çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„æ¡ä»¶å¿…é¡»ä»ç´¢å¼•çš„æœ€å·¦ä¾§å¼€å§‹åŒ¹é…ã€‚å¦‚æœè”åˆç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ï¼ŒæŸ¥è¯¢æ¡ä»¶å¿…é¡»åŒ…å«ç¬¬ä¸€ä¸ªåˆ—ï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªåˆ—ï¼Œä»¥æ­¤ç±»æ¨ã€‚ æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™çš„åŸç†ï¼šè”åˆç´¢å¼•åœ¨B+æ ‘ä¸­çš„æ’åˆ—æ–¹å¼éµå¾ªä»å·¦åˆ°å³çš„åŸåˆ™ï¼Œä¾‹å¦‚è”åˆç´¢å¼•(a, b, c)ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆæŒ‰ç…§açš„å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœaçš„å€¼ç›¸åŒï¼Œå†æŸ¥bçš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å¸¸è§åœºæ™¯ï¼š= ã€\u0026gt;= ã€\u0026lt;= ã€ BETWEEN ã€like (xx%) éƒ½åŒ…å«ç­‰å€¼çš„æƒ…å†µï¼Œå¯ä»¥å®šä½åˆ°æŸä¸ªæ•°ï¼Œç„¶åè¿›è¡ŒèŒƒå›´æ‰«æï¼Œä¸ä¼šå‡ºç°åœæ­¢åŒ¹é…çš„ç°è±¡ã€‚ä½†æ˜¯ \u0026gt; å’Œ \u0026lt; åˆ™ä¸è¡Œã€‚ éƒ¨åˆ†ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•çš„åŸå› ï¼šMySQL8å½“ä¸­å¼•å…¥äº† Skip Can Range Access Method, å°†ç¼ºå¤±çš„å·¦è¾¹çš„å€¼æŸ¥å‡ºæ¥ï¼Œå¦‚æœå·¦è¾¹ç¼ºå¤±çš„åˆ—æ•°æ®é‡å°‘ï¼Œåˆ™æ‹¼å‡‘å·¦è¾¹çš„ç´¢å¼•ï¼Œè®©SQLç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‚ 9. MySQLçš„è¦†ç›–ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ è¦†ç›–ç´¢å¼•å®šä¹‰ï¼šæŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼Œä»è€Œä½¿æŸ¥è¯¢å¯ä»¥ç›´æ¥è®¿é—®äºŒçº§ç´¢å¼•äºŒä¸éœ€è¦è®¿é—®å®ä¹ çš„è¡¨æ•°æ®(ä¸»é”®ç´¢å¼•)ã€‚ è¦†ç›–ç´¢å¼•ä¼˜ç‚¹ï¼šå‡å°‘I/Oæ“ä½œ ; æé«˜æŸ¥è¯¢é€Ÿåº¦ (ç´¢å¼•æ¯”è¡¨æ•°æ®æ›´åŠ ç´§å‡‘); å‡å°‘å†…å­˜å ç”¨ (è¯»å–çš„ç´¢å¼•é¡µé¢è€Œä¸æ˜¯è¡¨æ•°æ®é¡µé¢) 10. MySQLçš„ç´¢å¼•ä¸‹æ¨ (ICP) æ˜¯ä»€ä¹ˆ? ç´¢å¼•ä¸‹æ¨(ICP)å®šä¹‰: å‡å°‘å›è¡¨æŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡çš„è¡Œä¸ºã€‚å…è®¸MySQLä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œå°†éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚è¿›è¡Œè¿‡æ»¤ï¼Œä»è€Œå‡å°‘éœ€è¦ä»è¡¨ä¸­è¯»å–çš„æ•°æ®è¡Œï¼Œå‡å°‘I/Oã€‚\nåº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚å½“å‰è¡¨å»ºäº†ä¸€ä¸ªè”åˆç´¢å¼•(a, b, c)ï¼Œä½¿ç”¨whereæ¡ä»¶çš„æ—¶å€™ï¼Œç”±äºbç”¨å¾—æ˜¯ like '%xxx%' éœ€è¦å›è¡¨æŸ¥è¯¢ (like 'xx%' ä¸éœ€è¦)ã€‚å³å…ˆæŸ¥è¯¢a = '1' çš„æ•°æ®ï¼Œ ç„¶åå›è¡¨æŸ¥è¯¢ï¼Œæœ€åè¿›è¡Œwhereæ¡ä»¶çš„è¿‡æ»¤ã€‚å¦‚æœä½¿ç”¨ç´¢å¼•ä¸‹æ¨ä¹‹å (MySQL 5.6)ï¼Œåœ¨æŸ¥è¯¢æ™ša = '1'çš„æ•°æ®ä¹‹åï¼Œå¯ä»¥å…ˆç”±å­˜å‚¨å¼•æ“å±‚è¿›è¡Œwhereæ¡ä»¶è¿‡æ»¤ï¼Œç„¶åå†å›è¡¨æŸ¥è¯¢ï¼Œ å‡å°‘å›è¡¨æŸ¥è¯¢çš„æ¬¡æ•°ã€‚\nSELECT * FROM people WHERE a=\u0026#39;1\u0026#39; AND b LIKE \u0026#39;%123%\u0026#39; å¦‚è”åˆç´¢å¼•index_name_ageï¼Œå‡è®¾æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼ˆå¼ ä¸‰ï¼Œ18ï¼‰ã€ï¼ˆå¼ ä¸‰ï¼Œ28ï¼‰ã€ï¼ˆå¼ ä¸‰ï¼Œ48ï¼‰ã€ï¼ˆå¼ ä¸‰ï¼Œ8)\nã€æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ã€‘æŸ¥è¯¢name=\u0026lsquo;å¼ ä¸‰\u0026rsquo;å’Œage\u0026gt;30çš„æ•°æ®æ—¶ï¼Œä¼šå…ˆåŒ¹é…æœ‰å››æ¡æ•°æ®name=\u0026lsquo;å¼ ä¸‰\u0026rsquo;åŒ¹é…æˆåŠŸï¼Œå›è¡¨å››æ¬¡æŸ¥è¯¢å‡ºå¸¦æœ‰name=\u0026lsquo;å¼ ä¸‰\u0026rsquo;çš„å››æ¡æ•°æ®ï¼Œç„¶åå†æ ¹æ®age\u0026gt;30å¯¹è¿™å››æ¡æ•°æ®è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾\nã€ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ã€‘æŸ¥è¯¢name=\u0026lsquo;å¼ ä¸‰\u0026rsquo;å’Œage\u0026gt;30çš„æ•°æ®æ—¶ï¼Œä¼šå…ˆåŒ¹é…æœ‰å››æ¡æ•°æ®name=\u0026lsquo;å¼ ä¸‰\u0026rsquo;åŒ¹é…æˆåŠŸï¼Œç„¶åage\u0026gt;30çš„æ•°æ®ï¼Œè¿‡æ»¤å®Œæˆåï¼Œå†ç”¨ä¸»é”®ç´¢å¼•å»è¿›è¡Œä¸€æ¬¡å›è¡¨æ“ä½œ\n11. MySQLå»ºç´¢å¼•éœ€è¦æ³¨æ„å“ªäº›äº‹é¡¹ï¼Ÿ ã€ç´¢å¼•é€‚åˆåœºæ™¯ã€‘\né¢‘ç¹ä½¿ç”¨where ã€order by ã€group byã€distinct çš„å­—æ®µ (åŠ å¿«æ“ä½œé€Ÿåº¦) å…³è”å­—æ®µ (å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œè¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªåªéƒ½ä¼šè¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æ) ã€ä¸é€‚åˆåœºæ™¯ã€‘\nå­—æ®µé¢‘ç¹æ›´æ–° (æ›´æ–°é™¤äº†ä¿®æ”¹æ•°æ®å¤–ï¼Œè¿˜éœ€è¦ç»´æŠ¤ç´¢å¼•ä¿¡æ¯ =\u0026gt; è°ƒæ•´B+æ ‘ä¼šé™ä½æ€§èƒ½) å­—æ®µå€¼é‡å¤ç‡é«˜ï¼ˆåŒºåˆ†åº¦ä½ï¼Œå»ºç«‹ç´¢å¼•æ›´åŠ æ¶ˆè€—èµ„æºï¼‰ å‚ä¸åˆ—è®¡ç®—çš„å­—æ®µ (ç´¢å¼•ä¼šå¤±æ•ˆ) é•¿å­—æ®µ (textã€ longtext) ï¼šé•¿å­—æ®µå æ®çš„å†…å­˜å¤§ï¼Œæå‡æ€§èƒ½ä¸æ˜æ˜¾ã€‚ ã€æ³¨ã€‘ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå› ä¸ºæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦ç»´æŠ¤ç´¢å¼•æ•°æ®ï¼Œæ¶ˆè€—èµ„æº\n12. MySQLä¸­ä½¿ç”¨ç´¢å¼•ä¸€å®šæœ‰æ•ˆå—ï¼Ÿå¦‚ä½•æ’æŸ¥ç´¢å¼•æ•ˆæœï¼Ÿ ã€ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µã€‘\nè”åˆç´¢å¼•ä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ å¯¹ç´¢å¼•åˆ—ä½¿ç”¨äº†è¿ç®—(where id + 3 = 8)ã€å‡½æ•° (lower()ã€count())ã€like '%xx%' ç­‰æ“ä½œ å¯¹ç´¢å¼•åˆ—å’Œéç´¢å¼•åˆ—ä½¿ç”¨ or æ“ä½œ (where name = \u0026quot;swimmingliu\u0026quot; or age = 34) ç´¢å¼•åˆ—ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„å¼ºåˆ¶è½¬æ¢ (where name = 1 ==\u0026gt; where CAST(name AS signed int) = 1) ã€å¦‚ä½•æŸ¥çœ‹å¤±æ•ˆã€‘\nåˆ©ç”¨explainå‘½ä»¤ (å‰é¢æœ€å¥½åŠ ä¸Šanalyse table xxx)\nEXPLAIN çš„ type è¡¨ç¤ºæŸ¥è¯¢çš„è®¿é—®ç±»å‹ï¼Œå½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚å¸¸è§çš„å€¼ï¼š\nref: ä½¿ç”¨ç´¢å¼•ï¼ŒæŸ¥æ‰¾åŒ¹é…æŸä¸ªå•ä¸€åˆ—çš„å€¼ï¼ˆæ¯”å¦‚é€šè¿‡å¤–é”®æŸ¥æ‰¾ï¼‰ã€‚æ¯” range æ›´é«˜æ•ˆã€‚ range: ä½¿ç”¨ç´¢å¼•æ‰«ææŸä¸ªèŒƒå›´å†…çš„å€¼ï¼Œé€‚ç”¨äº BETWEENã€\u0026gt; \u0026lt; ç­‰æ¡ä»¶ã€‚ index: å…¨ç´¢å¼•æ‰«æï¼Œæ‰«ææ•´ä¸ªç´¢å¼•ç»“æ„ï¼Œä¸è¯»è¡¨æ•°æ®ï¼Œé€šå¸¸æ•ˆç‡æ¯”å…¨è¡¨æ‰«æå¥½ã€‚ all: å…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼• æ€»ç»“ï¼šref \u0026gt; range \u0026gt; index \u0026gt; allã€‚\n13. MySQLçš„ç´¢å¼•æ•°æ˜¯å¦è¶Šå¤šè¶Šå¥½ï¼Ÿwhy? ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå› ä¸ºå¯¹ç´¢å¼•å­—æ®µè¿›è¡Œæ›´æ–°æ“ä½œï¼Œéœ€è¦è°ƒæ•´B+æ ‘çš„ç»“æ„ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¢åŠ å¼€é”€ã€‚\nã€æ³¨ã€‘é˜¿é‡Œå·´å·´è§„èŒƒä¸Šè¡¨ç¤ºç´¢å¼•ä¸€èˆ¬ä¸è¶…è¿‡16ä¸ª\n**ã€æ—¶é—´å¼€é”€ã€‘**è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿå¿…é¡»æ›´æ–°ã€‚ç´¢å¼•è¶Šå¤šï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±è¶Šå¤šï¼Œæ—¶é—´å¼€é”€å¤§ã€‚B+æ ‘å¯èƒ½ä¼šå‡ºç°é¡µåˆ†è£‚ã€åˆå¹¶ç­‰æ“ä½œï¼Œæ—¶é—´å¼€é”€æ›´å¤§ã€‚\nã€ç©ºé—´å¼€é”€ã€‘ å»ºç«‹äºŒçº§ç´¢å¼•ï¼Œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ªB+æ ‘ï¼Œæ¯ä¸ªæ•°æ®é¡µé¢éƒ½æ˜¯16KBã€‚å¦‚æœæ•°æ®å¤§ï¼Œç´¢å¼•åˆå¤šï¼Œå ç”¨çš„ç©ºé—´ä¸å°ã€‚\n14. ä¸ºä»€ä¹ˆ MySQL é€‰æ‹©ä½¿ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿ ã€B+æ ‘çš„ä¼˜åŠ¿ã€‘\né«˜æ•ˆçš„æŸ¥æ‰¾æ€§èƒ½ï¼šB+æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡æ ‘ï¼Œæ¯ä¸ªå¶å­ç»“ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ç›¸åŒã€‚å¢åˆ æ”¹æŸ¥çš„äº‹ä»¶å¤æ‚åº¦éƒ½æ˜¯O(logn)ï¼Œä¸”å…·æœ‰ä¸€å®šçš„å†—ä½™èŠ‚ç‚¹ï¼Œåˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ ‘çš„ç»“æ„å˜åŒ–è¾ƒå°ã€‚ I/Oæ¬¡æ•°ç›¸å¯¹è¾ƒå°‘ï¼šé¦–å…ˆï¼ŒB+æ ‘ä¸ä¼šåƒçº¢é»‘æ ‘ä¸€æ ·ï¼Œéšç€æ•°æ®çš„å¢å¤šæ ‘å˜å¾—è¶Šæ¥è¶Šé«˜ï¼Œå®ƒæ˜¯å¤šå‰æ ‘ã€‚è®¡ç®—æœºè®¿é—®æ•°æ®æ—¶ï¼Œå¾€å¾€å…·æœ‰å±€éƒ¨æ€§åŸç†ã€‚å½“è¯»å–ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒBæ ‘å’ŒB+æ ‘ä¼šå°†å¤šä¸ªç›¸å…³çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåç»­ç›´æ¥ä»å†…å­˜åé—®ï¼Œå‡å°‘äº†ç£ç›˜çš„I/Oã€‚å¦å¤–ï¼Œç›¸è¾ƒäºBæ ‘æ¥è¯´ï¼Œ B+æ ‘æ‰€æœ‰çš„æ•°æ®éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸åƒBæ ‘ä¼šåœ¨éå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ã€‚B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä»…å­˜å‚¨ç´¢å¼•å€¼/ä¸»é”®å’Œé¡µé¢æŒ‡é’ˆã€‚ å¯¹èŒƒå›´æŸ¥è¯¢å‹å¥½ï¼šB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡é“¾è¡¨é“¾æ¥ã€‚å½“ä½¿ç”¨betweenè¯­å¥æ—¶ï¼Œä¼šä»æ ¹èŠ‚ç‚¹æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„èµ·å§‹è®°å½•ã€‚ç„¶åä»èµ·å§‹è®°å½•ï¼Œæ²¿ç€å¶å­ç»“ç‚¹çš„é“¾è¡¨è¿›è¡Œé¡ºåºéå†ã€‚ ã€B+æ ‘å­˜åœ¨çš„éƒ¨åˆ†ç¼ºç‚¹ã€‘\nå½“æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹ï¼Œä¼šè§¦å‘åˆ†è£‚å’Œåˆå¹¶æ“ä½œï¼Œä¿æŒæ ‘çš„å¹³è¡¡ï¼Œæœ‰ä¸€å®šçš„å¼€é”€ã€‚\nã€è·³è¡¨ã€‘\nè·³è¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªå¤šçº§é“¾è¡¨ï¼Œä¸ºäº†è®©é“¾è¡¨æ›´é«˜æ•ˆçš„æŸ¥è¯¢ã€‚åœ¨ä¸åŒçš„éƒ¨åˆ†æ’å…¥é«˜çº§ç´¢å¼•ï¼Œè®©å…¶èƒ½å¤Ÿç¼©å°æŸ¥æ‰¾èŒƒå›´ã€‚æœ‰ä¸€ç§äºŒåˆ†çš„æ€æƒ³åœ¨é‡Œé¢ã€‚å…¶ä¸­ï¼ŒRedisçš„æœ‰åºé›†åˆ(sorted set)åº•å±‚çš„ç»“æ„å°±æ˜¯è·³è¡¨ç»“æ„ã€‚\nã€ä¸ºä»€ä¹ˆMySQLä¸ç”¨è·³è¡¨è€Œç”¨B+æ ‘ã€‘\nè·³è¡¨çš„I/Oæ•ˆç‡ä½ï¼šB+æ ‘é€šå¸¸åªæœ‰3~4å±‚ï¼Œå¯ä»¥å­˜å‚¨æµ·é‡çš„æ•°æ®ã€‚B+æ ‘çš„èŠ‚ç‚¹å¤§å°è®¾è®¡é€‚é…ç£ç›˜é¡µçš„å¤§å°ï¼Œç£ç›˜é¡µèƒ½å¤Ÿé¡ºåºå­˜å‚¨å¤§é‡æ•°æ®ã€‚ä¸€æ¬¡ç£ç›˜I/Oæ“ä½œå°±èƒ½è¯»å–èŠ‚ç‚¹çš„æ•°æ®ï¼Œå‡å°‘I/Oã€‚è·³è¡¨æ˜¯å¤šçº§ç´¢å¼•çš„ç»“æ„ï¼Œè™½ç„¶å¯ä»¥åŠ é€ŸæŸ¥æ‰¾ï¼Œä½†æ˜¯å…¶æŸ¥æ‰¾çš„è¿‡ç¨‹å½“ä¸­ä¼šæ¶‰åŠåˆ°å¤šæ¬¡éšæœºçš„I/Oã€‚ èŒƒå›´æŸ¥è¯¢ï¼š B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æœ‰åºé“¾è¡¨ï¼Œåœ¨é‡‡ç”¨betweenæ—¶ï¼Œèƒ½å¤Ÿæ‰¾ä»å¶å­ç»“ç‚¹æŒ‰ç…§é“¾è¡¨é¡ºåºéå†å³å¯ã€‚è·³è¡¨è™½ç„¶æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯å®ç°èµ·æ¥å¾ˆå¤æ‚ï¼Œ è€Œä¸”å…¶å¤šå±‚çš„ç´¢å¼•ç»“æ„ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶ä¸èƒ½åƒB+æ ‘é‚£æ ·ç›´æ¥é«˜æ•ˆã€‚ è·³è¡¨ç»´æŠ¤æˆæœ¬é«˜ï¼šB+æ ‘åœ¨å¢åˆ æ”¹çš„æ—¶å€™ï¼Œåˆé«˜æ•ˆçš„ç®—æ³•å¹³è¡¡æ ‘ç»“æ„ï¼Œç¡®ä¿æ€§èƒ½ç¨³å®šã€‚è€Œè·³è¡¨åœ¨æ–°å¢å’Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œæ¶‰åŠå¤šå±‚é“¾è¡¨çš„è°ƒæ•´ï¼Œå¼€é”€è¾ƒå¤§ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½æ³¢åŠ¨ã€‚ è·³è¡¨å†…å­˜å ç”¨å¤§ï¼šB+æ ‘çš„èŠ‚ç‚¹ç´§å‡‘ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•é¡¹å’Œé¡µé¢æŒ‡é’ˆã€‚è€Œè·³è¡¨é™¤äº†æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ•°æ®ä»¥å¤–ï¼Œè¿˜éœ€è¦é¢å¤–çš„å¼€é”€å­˜å‚¨å¤šå±‚ç´¢å¼•ã€‚ç›¸åŒæ•°æ®é‡ä¸‹ï¼Œè·³è¡¨çš„å¼€é”€æ¯”B+æ ‘å¤§å¾—å¤šã€‚ 15. MySQL ä¸‰å±‚ B+ æ ‘èƒ½å­˜å¤šå°‘æ•°æ®ï¼Ÿ ç®—æ³•åç§° æ•°æ®é¡µå¤§å° å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®è®°å½•å¤§å° (å‡è®¾) èŠ‚ç‚¹çš„ç´¢å¼•å€¼(ä¸»é”®å¤§å°) èŠ‚ç‚¹çš„é¡µé¢æŒ‡é’ˆå¤§å° B+æ ‘ 16KB 1KB 8B ï¼ˆbigintï¼‰ 6B ã€ä¸‰å±‚B+æ ‘å­˜å‚¨æ•°æ®è®¡ç®—ã€‘\nnodesCount = 16 * 1024 / (6 + 8) = 1170 // æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å¤šå°‘ä¸ªå­èŠ‚ç‚¹ recordCount = 16KB / 1KB = 16 // æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å¤šå°‘æ¡æ•°æ®è®°å½• dataCount = nodesCount * nodesCount * recordCount = 1170 * 1170 * 16 = 21,902,400 æ‰€ä»¥å¦‚æœä¸€æ¡æ•°æ®ä¸º1KBå¤§å°ï¼ŒB+æ ‘å¤§çº¦èƒ½å­˜2000wæ¡æ•°æ® ã€æ‹“å±•ã€‘\nMySQLçš„InnoDBå¼•æ“ä¸­ï¼ŒB+æ ‘mæ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®é¡µå¤§å°å¯ä»¥é€šè¿‡è°ƒæ•´innodb_page_sizeæ¥ä¿®æ”¹ (ä¸€èˆ¬ä¸º 4KB / 8KB / 16KB)\n16. MySQLå¦‚ä½•è¿›è¡ŒSQLè°ƒä¼˜ åˆ†ä¸ºé¢„é˜²å’Œè§£å†³æ…¢æŸ¥è¯¢ä¸¤ä¸ªè§’åº¦é˜è¿°ã€‚æ€»ç»“èµ·æ¥å°±ä¸‰ç‚¹ï¼Œå‘½ä¸­ç´¢å¼•ã€å‡å°‘å›è¡¨ã€å‡å°‘I/O.\nã€é¢„é˜²ã€‘\nåˆç†è®¾è®¡ç´¢å¼•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œå‡å°‘I/O é¿å… select * æ“ä½œã€‚å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œéƒ¨åˆ†å­—æ®µæ˜¯æ²¡æœ‰äºŒæ¬¡ç´¢å¼•çš„ï¼Œå®ƒä¼šç”¨ä¸»é”®idæˆ–è€…rowid è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„I/Oã€‚ é¿å…è®©ç´¢å¼•å¤±æ•ˆï¼Œæ¯”å¦‚å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè®¡ç®—ã€èšåˆå‡½æ•°ã€éåŒç±»å‹æ¯”è¾ƒ (å¼ºåˆ¶è½¬æ¢)å’ŒèŒƒå›´æŸ¥è¯¢ (\u0026gt;ã€\u0026lt;ã€like %xxx%)ã€‚è¿˜æœ‰è”åˆç´¢å¼•ä¸åŒ¹é…æœ€å·¦å‰ç¼€åŸåˆ™ é¿å…å¯¹éç´¢å¼•å­—æ®µï¼Œä½¿ç”¨group byã€order byã€dinstinctç­‰å‡½æ•° è¿è¡¨æŸ¥è¯¢çš„æ˜¯å¦éœ€è¦ä¿æŒä¸åŒå­—æ®µçš„å­—ç¬¦é›†ä¸€è‡´ï¼Œä¸ç„¶ä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚æ¯”å¦‚Aè¡¨ç”¨utf-8ï¼ŒBè¡¨ç”¨latin1ï¼ŒæŸ¥è¯¢çš„æ˜¯å¦éœ€è¦è¿›è¡Œå­—ç¬¦é›†è½¬æ¢ï¼Œéœ€è¦é¢å¤–çš„è®¡ç®—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•ã€‚ ã€è§£å†³æ…¢æŸ¥è¯¢ã€‘\nå¼€å¯æ…¢SQLæ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œä½¿ç”¨set global slow_query_log = \u0026quot;ON\u0026quot;ï¼Œ é»˜è®¤æ˜¯å…³é—­çš„ã€‚è®¾ç½®ä¸€ä¸ªæŸ¥è¯¢å»¶è¿Ÿçš„é˜ˆå€¼ï¼ŒæŠŠè¶…è¿‡è§„å®šæ—¶é—´çš„SQLæŸ¥è¯¢æ‰¾å‡ºæ¥ã€‚ åˆ©ç”¨explainå…³é”®å­—åˆ†ææ…¢SQLçš„åŸå› ï¼Œæ¯”å¦‚çœ‹çœ‹æ˜¯å¦æœ‰ç´¢å¼•å¤±æ•ˆã€select *ç­‰æƒ…å†µ 17. å¦‚ä½•ä½¿ç”¨MySQLçš„EXPLAINè¯­å¥è¿›è¡ŒæŸ¥è¯¢åˆ†æ? ã€EXPLAINæŸ¥è¯¢ç»“æœè§£é‡Šã€‘\nåç§° id select_type type key rows Extra ä¸­æ–‡åç§° æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåº æŸ¥è¯¢çš„ç±»å‹ è®¿é—®ç±»å‹ å…³é”®ç´¢å¼• æ‰«æè¡Œæ•° é¢å¤–ä¿¡æ¯ è¯´æ˜ å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ SIMPLEç®€å•æŸ¥è¯¢ã€PRIMARYä¸»æŸ¥è¯¢ã€SUBQUERY å­æŸ¥è¯¢ const \u0026gt; eq_ref \u0026gt; ref \u0026gt; range \u0026gt; index \u0026gt; ALL å®é™…ç”¨åˆ°çš„ç´¢å¼• å€¼è¶Šå°è¶Šå¥½ Using index è¡¨ç¤ºè¦†ç›–ç´¢å¼•ã€Using where è¡¨ç¤ºwhereæ¡ä»¶è¿‡æ»¤ã€Using temporary è¡¨ç¤ºä¸´æ—¶è¡¨ã€Using filesort è¡¨ç¤ºéœ€è¦é¢å¤–çš„æ’åºæ­¥éª¤ ã€typeè¯´æ˜ã€‘\nsystem: è¡¨æ˜æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œ (ç³»ç»Ÿè¡¨)\nconst : è¡¨æ˜æŸ¥è¯¢çš„è¡¨æœ€å¤šåªæœ‰ä¸€è¡ŒåŒ¹é…ç»“æœã€‚é€šå¸¸æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸ºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œ å¹¶ä¸”æ˜¯å¸¸é‡æ¯”è¾ƒã€‚\neq_ref: è¡¨æ˜å¯¹äºæ¯ä¸ªæ¥è‡ªé’±ä¸€å¼ è¡¨çš„è¡Œï¼ŒMySQLåªè®¿é—®ä¸€æ¬¡è¯¥è¡¨ï¼Œé€šå¸¸å‘ç”Ÿåœ¨é“¾æ¥æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹ã€‚\nrefï¼šMySQL ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€‚æŸ¥è¯¢çš„æ¡ä»¶æ˜¯éå”¯ä¸€çš„\nrange: MySQL ä¼šæ‰«æè¡¨çš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯å…¨éƒ¨è¡Œã€‚é€šå¸¸å‡ºç°åœ¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ä¸­ (æ¯”å¦‚\u0026gt;=ã€\u0026lt;=ã€BETWEEN)\nindex: è¡¨ç¤ºMySQLæ‰«æç´¢å¼•ä¸­çš„æ‰€æœ‰è¡Œï¼Œä½†ä¸æ˜¯æ‰«æè¡¨çš„æ‰€æœ‰è¡Œã€‚\nallï¼šè¡¨ç¤ºéœ€è¦æ‰«æè¡¨çš„æ‰€æœ‰è¡Œï¼Œå…¨è¡¨æ‰«æã€‚ä¸€èˆ¬å‡ºç°åœ¨æ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢æ¡ä»¶ä¸­ã€‚\n18. è¯·è¯¦ç»†æè¿° MySQL çš„ B+ æ ‘ä¸­æŸ¥è¯¢æ•°æ®çš„å…¨è¿‡ç¨‹ ã€B+æ ‘æŸ¥è¯¢è¿‡ç¨‹ã€‘\nå¯ä»¥ç±»æ¯”æˆå»ç”µå½±é™¢ (4å·å… ) æ‰¾ä½ç½® çš„è¿‡ç¨‹\nä¹°ç¥¨è¿›é—¨ï¼Œä»æ ¹èŠ‚ç‚¹(Page 20)å‡ºå‘ï¼Œä¸»é”®å€¼ä¸º4, èŒƒå›´åœ¨[1,5)ä¸­é—´ï¼Œéœ€è¦åˆ° Page 2 éå¶å­èŠ‚ç‚¹æŸ¥è¯¢ è¿›å…¥ Page 2 éå¶å­èŠ‚ç‚¹ï¼Œä¸»é”®å€¼å¤§äº3ï¼Œéœ€è¦åˆ°Page 5 çš„å¶å­èŠ‚ç‚¹æŸ¥è¯¢ è¿›å…¥Page 5 çš„å¶å­èŠ‚ç‚¹ï¼Œé€šè¿‡Page Directory å†…çš„æ§½æŸ¥æ‰¾è®°å½•ï¼Œä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½æŸ¥è¯¢è®°å½•åœ¨é‚£ä¸ªæ§½ã€‚ å®šä½åˆ°æ§½ä¹‹åéå†æ‰€æœ‰çš„è®°å½•ï¼Œæ‰¾åˆ°ä¸»é”®ä¸º 4 çš„è®°å½• ã€Page Directory é¡µç›®å½•æŸ¥æ‰¾è¿‡ç¨‹ã€‘\nå‡å¦‚é¡µç›®å½•å½“ä¸­æœ‰5ä¸ªæ§½ï¼Œç°åœ¨éœ€è¦æŸ¥æ‰¾ä¸»é”®å€¼ä¸º3çš„è®°å½•ã€‚æŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š\näºŒåˆ†æŸ¥æ‰¾å®šä½åˆ°æ§½2 æ§½2çš„æœ€å¤§è®°å½•æ˜¯4ï¼Œè®°å½•äºŒåˆ†æŸ¥æ‰¾å®šä½åˆ°æ§½1 æ§½1çš„æœ€å¤§è®°å½•æ˜¯2ï¼Œå› ä¸º3 \u0026gt; 2ï¼Œ ç›´æ¥å‘å‰éå†æŸ¥è¯¢åˆ°ä¸»é”®å€¼ä¸º 3 çš„è®°å½• ã€B+æ ‘æ•°æ®é¡µçš„ç»“æ„ã€‘\nInnoDB å½“ä¸­B+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä»¥æ•°æ®é¡µ(Page)ä¸ºå•ä½å­˜å‚¨ï¼Œæ¯é¡µé»˜è®¤å¤§å°ä¸º16KBã€‚\næ–‡ä»¶å¤´ï¼š è®°å½•å¶å­èŠ‚ç‚¹çš„ä¸Šä¸‹é¡µ (å› ä¸ºå¶å­èŠ‚ç‚¹æ˜¯åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥çš„) æœ€å¤§å’Œæœ€å°è®°å½•ï¼šè¡¨ç¤ºé¡µé¢å½“ä¸­æœ€å°çš„è®°å½•å’Œæœ€å¤§çš„è®°å½• ï¼ˆè™šæ‹Ÿçš„è®°å½•ï¼‰ åœ¨çœŸå®è¡Œè®°å½•çš„ä¸¤ä¾§ é¡µç›®å½•: æ•°æ®é¡µè¢«åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„å¯¹åº”ä¸€ä¸ªæ§½ (Slot)ã€‚é¡µç›®å½•å†…è®°å½•è¿™äº›æ§½çš„ä½ç½®ï¼Œå®ç°åŸºäºå½“å‰æ•°æ®ä¹Ÿçš„äºŒåˆ†æŸ¥æ‰¾çš„å¿«é€Ÿå®šä½ã€‚ ã€B+æ ‘çš„ä¼˜åŠ¿ã€‘\nå‚è§é—®é¢˜14. ä¸ºä»€ä¹ˆ MySQL é€‰æ‹©ä½¿ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿ\n19. MySQL ä¸­ count(*)ã€count(1) å’Œ count(å­—æ®µå) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ã€æ•ˆç‡å±‚é¢ã€‘ count(*) â‰ˆ count(1) \u0026gt; count(å”¯ä¸€ç´¢å¼•) \u0026gt; count(ä¸»é”®) \u0026gt; count(å…¶ä»–å­—æ®µ)\nã€å…·ä½“åŒºåˆ«ã€‘\nç±»å‹ ç»Ÿè®¡å†…å®¹ è¯´æ˜ count(*) è¡¨ä¸­æ‰€æœ‰è®°å½•ï¼ŒåŒ…æ‹¬NULLå€¼ ç›´æ¥ç»Ÿè®¡è¡¨çš„è®°å½•æ•°ï¼Œä¸ä¾èµ–å­—æ®µå†…å®¹ã€‚MySQLç‰¹å®šä¼˜åŒ–ï¼Œå¼€é”€æœ€ä½ count(1) è¡¨ä¸­æ‰€æœ‰è®°å½•ï¼ŒåŒ…æ‹¬NULLå€¼ å‚æ•°1è¢«è§†ä¸ºå¸¸é‡ï¼Œä¸ä¾èµ–å­—æ®µå†…å®¹ã€‚æœªä¼˜åŒ–ï¼Œæ€§èƒ½ç•¥ä½äºcount(*) count(å”¯ä¸€ç´¢å¼•) å”¯ä¸€ç´¢å¼•å­—æ®µä¸­çš„æ‰€æœ‰é NULL çš„è®°å½• éå†éèšç°‡ç´¢å¼•ç»Ÿè®¡å­—æ®µè¡Œæ•°ï¼Œå› ä¸ºæ²¡æœ‰NULL å€¼ï¼Œæ‰€ä»¥ç»“æœå’Œcount(*)å·®ä¸å¤š count(ä¸»é”®) ä¸»é”®å­—æ®µä¸­çš„æ‰€æœ‰é NULL çš„è®°å½• éå†èšç°‡ç´¢å¼•ç»Ÿè®¡ä¸»é”®å­—æ®µè¡Œæ•°ï¼Œå› ä¸ºæ²¡æœ‰NULL å€¼ï¼Œæ‰€ä»¥ç»“æœå’Œcount(*)å·®ä¸å¤šã€‚ä½†æ˜¯ï¼Œæœ‰å›è¡¨æ“ä½œï¼Œä¼šäº§ç”Ÿé¢å¤–çš„I/Oã€‚ count(å…¶ä»–å­—æ®µ) å…¶ä»–å­—æ®µä¸­çš„æ‰€æœ‰é NULL çš„è®°å½• è¯»å–å­—æ®µå€¼ï¼Œåˆ¤æ–­æ˜¯å¦æœªNULLã€‚å¦‚æœè®°å½•è¾ƒå¤§ï¼Œæ€§èƒ½è¾ƒå·®ã€‚ 20. MySQL ä¸­ varchar å’Œ char æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ã€ä¸»è¦åŒºåˆ«ã€‘\nç‰¹ç‚¹ char varchar é•¿åº¦ å›ºå®šé•¿åº¦ï¼Œä¸è¶³çš„ç”¨ç©ºæ ¼è¡¥é½ (InnoDBä¼šè‡ªåŠ¨å¿½ç•¥è¡¥é½çš„ç©ºæ ¼) éå›ºå®šé•¿åº¦ å­˜å‚¨ç©ºé—´ å§‹ç»ˆå ç”¨å›ºå®šé•¿åº¦ç©ºé—´ éšç€é•¿åº¦çš„å˜åŒ–è€Œå˜åŒ–ï¼Œè¿˜æœ‰1~2å­—èŠ‚çš„é¢å¤–ç©ºé—´ï¼Œç”¨äºè¯´æ˜é•¿åº¦ä¿¡æ¯ æ€§èƒ½å½±å“ å¦‚æœé•¿åº¦å¿½å¤§å¿½å°ï¼Œå¯èƒ½æµªè´¹ æ¯”è¾ƒèŠ‚çœç©ºé—´ ä½¿ç”¨åœºæ™¯ å­˜å‚¨é•¿åº¦å›ºå®šä¸”è¾ƒçŸ­çš„å­—ç¬¦ä¸² å­˜å‚¨å˜åŒ–æˆ–ç¨å¾®è¾ƒé•¿çš„å­—ç¬¦ä¸² ã€æ³¨æ„äº‹é¡¹ã€‘\nvarchar é•¿åº¦ä¸è¦å¤ªå¤§ï¼šå› ä¸ºMySQLåœ¨åˆ©ç”¨order byæ’åºçš„è¿‡ç¨‹å½“ä¸­ï¼Œä¼šç”¨åˆ° sort_buffã€‚å¦‚æœvarcharæ‰€è®¾å®šçš„é•¿åº¦è¿‡å¤§ï¼Œå°±ä¼šä½¿ç”¨åŒè·¯æ’åºã€‚è€ŒåŒè·¯æ’åºåœ¨å¯¹æ’åºå­—æ®µæ’åºä¹‹åï¼Œåªèƒ½æ‹¿åˆ°ä¸»é”®å€¼å’Œç´¢å¼•åˆ—çš„å€¼ã€‚éœ€è¦ä½¿ç”¨ä¸»é”®å€¼å†è¿›è¡Œå›è¡¨æŸ¥è¯¢æ“ä½œï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„I/Oï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚ varchar(n) å½“ä¸­çš„n è¡¨ç¤ºçš„æ˜¯å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚é€šå¸¸æœ€å¤§è¡Œé•¿åº¦æ˜¯ 65535 å­—èŠ‚ï¼Œå¦‚æœå…è®¸æœªnullï¼Œ éœ€è¦é¢å¤–ä¸€ä¸ªå­—èŠ‚æ ‡æ³¨æ˜¯å¦æœªnullã€‚ è€Œvarchar éœ€è¦1~2ä¸ªå­—èŠ‚æ¥æ ‡æ³¨å­—æ®µçš„é•¿åº¦ã€‚æ‰€ä»¥ï¼Œæ”¯æŒçš„æœ€å¤§é•¿åº¦ä¸º65535-2 = 65533 å­—èŠ‚ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒUTF-8å­—ç¬¦é›†å ç”¨3ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥ï¼Œæœ€å¤§å­—ç¬¦æ•°n ä¸º 65533 / 3 = 21844 ä¸ªå­—ç¬¦ 21. MySQL æ˜¯å¦‚ä½•å®ç°äº‹åŠ¡çš„ï¼Ÿ ã€äº‹åŠ¡å››ä¸ªç‰¹æ€§ - AIDCã€‘\nåŸå­æ€§ï¼šäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ éš”ç¦»æ€§ï¼šå¹¶å‘çš„äº‹åŠ¡ä¹‹é—´ç›¸äº’æ˜¯ä¸å¹²æ‰°çš„ï¼Œå¯è§æ€§ç”±éš”ç¦»çº§åˆ«è¿›è¡Œæ§åˆ¶ã€‚MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯RRï¼Œå¯é‡å¤è¯» æŒä¹…æ€§ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œç¡®ä¿ä¿®æ”¹çš„æ•°æ®ä¼šè¢«æ°¸ä¹…ä¿å­˜ ä¸€è‡´æ€§ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“è¦ä¿æŒä¸€ç›´çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡è§„åˆ™ã€çº¦æŸå’Œè§¦å‘å™¨çš„è§„åˆ™å¿…é¡»æ»¡è¶³ã€‚ ã€å¦‚ä½•å®ç°äº‹åŠ¡ã€‘\nå®ç°äº‹åŠ¡å…¶å®å°±æ˜¯è¦ç¡®ä¿æ»¡è¶³äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼Œå¦‚ä½•æ»¡è¶³å‘¢ï¼Ÿ\nåŸå­æ€§ï¼šé€šè¿‡Uodo Log å®ç°ï¼Œä»äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼ŒUndo Log é‡Œé¢ä¼šå­˜å‚¨äº‹åŠ¡çš„åå‘æ“ä½œã€‚å°±æ˜¯ä¿å­˜æ•°æ®çš„å†å²ç‰ˆæœ¬æŠŠï¼Œç”¨äºäº‹åŠ¡çš„å›æ»šï¼Œè®©äº‹åŠ¡æ‰§è¡Œå¤±è´¥ä¹‹åå¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„æ ·å­ã€‚\néš”ç¦»æ€§: é€šè¿‡é”å’ŒMVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ¥å®ç°çš„ï¼Œä¸»è¦æ˜¯æ§åˆ¶ä¸åŒéš”ç¦»çº§åˆ«ä¸‹äº‹åŠ¡é—´çš„æ–¹æ³•ï¼Œç¡®ä¿äº‹åŠ¡ä¹‹é—´ä¸ç›¸äº’å¹²æ‰°ã€‚\næŒä¹…æ€§ï¼šé€šè¿‡Redo Logæ¥å®ç°çš„ï¼ŒRedo Logä¼šè®°å½•äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œã€‚å½“MySQLå‘é€å®•æœºæˆ–å´©æºƒçš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®Redo Log é‡Œé¢çš„è®°å½•æ¥æ¢å¤æ•°æ®ã€‚æ»¡è¶³äº‹åŠ¡çš„æŒä¹…æ€§ã€‚\nä¸€è‡´æ€§ï¼š å…¶å®äº‹åŠ¡çš„ä¸€è‡´æ€§å°±æ˜¯AIDå®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡æ˜¯é€šè¿‡åŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§æ¥æ»¡è¶³ä¸€è‡´æ€§çš„ã€‚\n22. MySQLæœ‰å“ªäº›é”çš„ç±»å‹? ã€æŒ‰ç²’åº¦åˆ†ç±»ã€‘\nå…¨å±€é”: å¯¹æ•´ä¸ªæ•°æ®åº“è¿›è¡ŒåŠ é”ï¼Œå¤„äºåªè¯»çš„çŠ¶æ€ï¼Œä¸€èˆ¬ç”¨äºæ•°æ®åº“é€»è¾‘å¤‡ä»½ã€‚è¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„æ•°æ®æ“ä½œ(å¢åˆ æ”¹)å’Œè¡¨ç»“æ„æ“ä½œ(ALTER å’Œ DROP)éƒ½ä¼šè¢«é˜»å¡ã€‚ è¡¨çº§é”: é”çš„æ˜¯æ•´å¼ è¡¨ã€‚å®ç°æ¯”è¾ƒç®€å•ï¼Œèµ„æºæ¶ˆè€—ä½ã€‚ è¡Œçº§é”ï¼šé”çš„æ˜¯æŸä¸€è¡Œã€‚ç²’åº¦æœ€å°ï¼Œæ”¯æŒé«˜å¹¶å‘ã€‚ä½†æ˜¯åŠ é”çš„å¼€é”€å¤§ï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚ ã€æŒ‰åŠŸèƒ½åˆ†ç±»ã€‘\nå…±äº«é” (S é”, share Lock): è¯»é”ï¼Œé¡¾åæ€ä¹‰æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¯ä»¥å…±äº«é”ä¹‹é—´å¯ä»¥å…¼å®¹ï¼Œä¸€èˆ¬ç”¨äºäº‹åŠ¡è¯»å–æ•°æ®çš„æ—¶å€™ æ’ä»–é” (X é”, exclusive lock)ï¼šå†™é”ï¼Œé¡¾åæ€ä¹‰æ˜¯æ‹’ç»åˆ«äººçš„ï¼Œæ‰€ä»¥ä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼Œæ’ä»–é”ä¹‹é—´ä¸å…¼å®¹ã€‚ä¸€èˆ¬ç”¨äºäº‹åŠ¡ä¿®æ”¹è®°å½•çš„æ—¶å€™ã€‚ -- æ·»åŠ å…±äº«é” SELECT ... LOCK IN SHARE MODE;\t-- å…±äº«é” SELECT ... FOR SHARE # MySQL 8.x ç‰ˆæœ¬ -- æ’ä»–é” SELECT .... FOR UPDATE; ã€å…¨å±€é”ã€‘\nç›´æ¥é”ä½æ•´ä¸ªæ•°æ®åº“ï¼Œå¤„äºåªè¯»æ¨¡å¼ã€‚ä¸šåŠ¡åªèƒ½è¯»å–æ•°æ®ï¼Œä¸èƒ½æ›´æ–°æ•°æ®ã€‚\nFLUSH TABLES WITH READ LOCK ã€è¡¨çº§é”ã€‘\nè¡¨é”\nè¡¨çº§å…±äº«é”ï¼šé˜»æ­¢å…¶ä»–ä¼šè¯å¯¹è¡¨çš„å†™æ“ä½œï¼Œå½“å‰ä¼šè¯åªèƒ½è¯»è¯¥è¡¨ï¼Œä¸èƒ½è®¿é—®å…¶ä»–è¡¨ è¡¨çº§æ’ä»–é”ï¼šé˜»æ­¢å…¶ä»–ä¼šè¯å¯¹æ ‡è¿›è¡Œä»»ä½•æ“ä½œï¼ˆè¯»å’Œå†™ï¼‰ï¼Œå½“å‰ä¼šè¯åªèƒ½è¯»è¯¥è¡¨ï¼Œä¸èƒ½è®¿é—®å…¶ä»–è¡¨ # æ·»åŠ è¡¨çº§å…±äº«é” lock tables user read; # æ·»åŠ è¡¨çº§åˆ«æ’å®ƒé” lock tables user write; å…ƒæ•°æ®é”ï¼šäº‹åŠ¡æ‰§è¡ŒSELECT çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹çš„DDLæ“ä½œ(ALTERã€DROP)æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡æäº¤\næ„å‘é”\næ„å‘å…±äº«é” (IS)ï¼šè¡¨æ˜æœ‰æ„å‘å¯¹è¯¥è¡¨æŸäº›è®°å½•æ·»åŠ å…±äº«é” (S é”) æ„å‘æ’ä»–é” (IX)ï¼šè¡¨æ˜æœ‰æ„å‘å¯¹è¯¥è¡¨æŸäº›è®°å½•æ·»åŠ æ’ä»–é” (X é”) æ„å‘é”ä¹‹é—´ç›¸äº’å…¼å®¹ï¼Œä¸ä¼šå’Œè¡Œçº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”å‘ç”Ÿå†²çªã€‚ä½†æ˜¯ï¼Œæ„å‘æ’ä»–é”å’Œå…±äº«é”ã€æ’ä»–é”ä¹‹é—´æ˜¯å†²çªçš„ã€‚\né”åç§° S X IS IX S âœ… âŒ âœ… âŒ X âŒ âŒ âŒ âŒ IS âœ… âŒ âœ… âœ… IX âŒ âŒ âœ… âœ… è‡ªå¢é”\nç”¨äºä¸»é”®è‡ªå¢çš„ä¸€ç§é”ã€‚äº‹åŠ¡å‘æœ‰è‡ªå¢åˆ—çš„è¡¨æ’å…¥æ•°æ®æ˜¯ä¼šå…ˆè·å–è‡ªå¢é”ï¼Œæ‹¿ä¸åˆ°é”å°±è¢«é˜»å¡ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ä¿®æ”¹innodb_autoinc_lock_modeè‡ªå¢é”æ¨¡å¼è¿›è¡Œè°ƒæ•´ï¼Œè‡ªå¢é”çš„å…·ä½“å®ç°æ–¹å¼ï¼š\nè‡ªå¢é”æ¨¡å¼ ä»‹ç» è¯´æ˜ 0 ä¼ ç»Ÿæ¨¡å¼ é‡‡ç”¨AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸé‡Šæ”¾ 1 è¿ç»­æ¨¡å¼ å¯¹æ™®é€šinsertï¼Œè‡ªå¢é”ç”³è¯·åé©¬ä¸Šé‡Šæ”¾ã€‚å¯¹äºæ‰¹é‡æ’å…¥ï¼Œç­‰è¯­å¥æ‰§è¡Œç»“æŸä¹‹åé‡Šæ”¾ 2 äº¤é”™æ¨¡å¼ ç”³è¯·è‡ªå¢ä¸»é”®åé©¬ä¸Šé‡Šæ”¾ï¼Œæ— éœ€ç­‰å¾…è¯­å¥æ‰§è¡Œå®Œ ã€è¡Œçº§é”ã€‘\nè®°å½•é”\näº‹åŠ¡å¯¹æŸæ¡è®°å½•åŠ Sé”ï¼Œå…¶ä»–è®°å½•ä¹Ÿå¯ä»¥åŠ ï¼Œä½†æ˜¯ä¸èƒ½åŠ Xé” äº‹åŠ¡å¯¹æŸæ¡è®°å½•åŠ Xé”ï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½åŠ Sé”ä¹Ÿä¸èƒ½åŠ Xé” BEGINE; # é’ˆå¯¹ä¸»é”® id ä¸º 2 çš„è¿™æ¡è®°å½•æ·»åŠ  X å‹çš„è®°å½•é”ï¼›å…¶ä»–äº‹åŠ¡å°±æ— æ³•å¯¹è¿™æ¡è®°å½•è¿›ä¿®æ”¹ SELECT * FROM user WHERE id = 2 FOR UPDATE; é—´éš™é”\né˜²æ­¢åœ¨å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå‡ºç°å¹»è¯»é—®é¢˜ã€‚\næ¯”å¦‚ï¼Œäº‹åŠ¡Aå¼€å§‹è¯»å–æ•°æ®, å‘ç°æ˜¯3æ¡æ•°æ®ã€‚ç„¶åï¼Œäº‹åŠ¡BåŠ äº†ä¸€æ¡æ•°æ®è¿›å»ã€‚äº‹åŠ¡Aåœ¨è¯»å»æ•°æ®,å‘ç°æ˜¯4æ¡æ•°æ®, å‰åæ•°æ®æ€»æ•°ä¸ä¸€è‡´å°±æ˜¯å¹»è¯»ã€‚\nä¸´é”®é”ï¼šè®°å½•é” + é—´éš™é”çš„ç»„åˆï¼Œæ—¢å¯ä»¥é”ä½è®°å½•ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢å¹»è¯»\næ’å…¥æ„å‘é”\næ„å‘é”ç”¨äºå¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸå¼ è¡¨åŠ è¡¨é”ï¼Œè€Œæ— éœ€åˆ¤æ–­è¡¨ä¸­å…·ä½“è¡Œçš„é”å®šæƒ…å†µã€‚\næ’å…¥æ„å‘é”çš„ä½œç”¨ï¼š\næ ‡è®°æ’å…¥æ„å‘å›¾ï¼šäº‹åŠ¡å‘Šè¯‰InnoDBï¼Œå®ƒè®¡åˆ’åœ¨æŸä¸ªé—´éš™èŒƒå›´å†…æ’å…¥æ–°æ•°æ®ã€‚ å…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘æ’å…¥ä¸åŒä½ç½®ï¼šä¹Ÿå°±æ˜¯è¯´å¦‚æœæ’å…¥çš„èŒƒå›´ä¸åŒï¼Œæ’å…¥æ„å‘é”ä¹‹é—´äº’ä¸ä»çªã€‚ ã€æ³¨æ„ã€‘\nä¸€ä¸ªäº‹åŠ¡æœ‰é—´éš™é”æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½åœ¨ç›¸åŒèŒƒå›´å†…åŠ æ’å…¥æ„å‘é” ä¸€ä¸ªäº‹åŠ¡æœ‰æ’å…¥æ„å‘é”æ˜¯ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½åœ¨ç›¸åŒèŒƒå›´å†…å‡å¦‚é—´éš™é” 23. MySQL ä¸­çš„ MVCC æ˜¯ä»€ä¹ˆï¼Ÿ ã€å½“å‰è¯»å’Œå¿«ç…§è¯»ã€‘\nå½“å‰è¯»ï¼šselect ... lock in share modeã€select ... for updateã€insert/delete/upate æœ‰é”ï¼Œä¼šé˜»å¡å…¶ä»–äº‹åŠ¡ã€‚å½“å‰è¯»ä¸ä¼šç”ŸæˆReadViewï¼Œ åªä¼šåŠ ä¸Šä¸´é”®é”next-key lock (è®°å½•é”+é—´éš™é”) å¿«ç…§è¯»ï¼šç›´æ¥ selectï¼Œæ™®é€šçš„æŸ¥è¯¢æ“ä½œï¼Œä¸åŠ ä»»ä½•é”ï¼Œä¸ä¼šé˜»å¡å…¶ä»–äº‹åŠ¡ã€‚ä¼šç”ŸæˆReadViewï¼Œä¸ä¼šæœ‰å¹»è¡Œ ã€éš”ç¦»çº§åˆ«ã€‘\nä¸åŒçš„éš”ç¦»çº§åˆ«åˆ†åˆ«è§£å†³äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„é—®é¢˜ã€‚\néš”ç¦»æ€§ è¯»æœªæäº¤ RU è¯»å·²æäº¤ RC å¯é‡å¤è¯» RR ä¸²è¡Œè¯» è„è¯» âŒ âœ… âœ… âœ… ä¸å¯é‡å¤è¯» âŒ âŒ âœ… âœ… å¹»è¯» âŒ âŒ âŒ âœ… ã€æ³¨æ„ã€‘åªæœ‰è¯»å·²æäº¤ RC å’Œå¯é‡å¤è¯» RR æ‰ä¼šç”¨åˆ°å¿«ç…§è¯»\nå¯é‡å¤è¯» RRï¼Œå¿«ç…§ä¼šåœ¨äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆï¼Œå¯¹æ•°æ®è¿›è¡Œæ›´æ”¹æ‰ä¿®æ”¹å¿«ç…§ è¯»å·²æäº¤ RC ï¼Œæ¯æ¬¡è¯»å–éƒ½ä¼šé‡æ–°ç”Ÿæˆå¿«ç…§ï¼Œæ€»æ˜¯è¯»å–è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸å¯é‡å¤è¯» ã€MVCCã€‘\nMVCCå¤šç‰ˆæœ¬æ§åˆ¶å¹¶å‘ä¸»è¦æ˜¯ç”¨æ¥è§£å†³ è¯»-å†™å¹¶å‘ æ‰€å¼•èµ·çš„é—®é¢˜çš„\néšè—å­—æ®µï¼š db_row_id: å¦‚æœæ²¡æœ‰åˆ›å»ºä¸»é”®ï¼Œå°±ç”¨è¿™ä¸ªå­—æ®µæ¥åˆ›å»ºèšç°‡ç´¢å¼• db_trx_idï¼šå¯¹è¯¥è®°å½•å·¦æœ€æ–°ä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡çš„ID db_roll_ptr: å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚å…¶å®æ˜¯åªæƒ³undo logå½“ä¸­ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å¿«æ‰¾åœ°å€ Read View: éšè—å­—æ®µå’Œ undo logç‰ˆæœ¬å†³å®šçš„æ˜¯è¿”å›çš„æ•°æ®ï¼Œä½†æ˜¯å…·ä½“è¿”å›å“ªä¸ªç‰ˆæœ¬ï¼Œç”±read view å’Œç‰ˆæœ¬é“¾è¿”å›è§„åˆ™å¯è§æ€§ç®—æ³•æ§åˆ¶\ntrx_ids : è¡¨ç¤ºç”Ÿæˆreadviewæ˜¯,å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„äº‹åŠ¡IDåˆ—è¡¨ low_limit_idï¼šåº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„idå€¼ (æœ€å¤§äº‹åŠ¡id + 1) up_limit_id: æœªæäº¤çš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id (æœ€å°äº‹åŠ¡id) creator_trx_id: åˆ›å»ºè¯¥readviewçš„äº‹åŠ¡id ä»€ä¹ˆæƒ…å†µæ˜¯å¯ä»¥çœ‹è§çš„? trx_id == creator_trx_id (å½“å‰äº‹åŠ¡ä¿®æ”¹çš„)ã€trx_id \u0026lt; up_limit_id (äº‹åŠ¡å·²æäº¤)ï¼Œup_limit_id \u0026lt; trx_id \u0026lt; low_limit_id (å¦‚æœtrx_id ä¸åœ¨ trx_ids é‡Œé¢ï¼Œè¯´æ˜ä¸æ˜¯è¿™æ¡æ•°æ®ä¸æ˜¯å­˜æ´»çš„äº‹åŠ¡æŒæ§çš„ï¼Œæ•°æ®å·²ç»æäº¤äº†) éƒ½æ˜¯å¯è§çš„ã€‚ trx_id \u0026gt; low_limit_id æ˜¯ä¸å¯ä»¥è®¿é—®çš„\nå¦‚æœå‘ç°å½“å‰çš„è®°å½•æ˜¯ä¸å¯è§çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰¾undo logæ—¥å¿—çš„å†å²å¿«ç…§äº†ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å›ç©ºã€‚\nã€ä¸åŒéš”ç¦»ç‰ˆæœ¬ReadViewçš„äº§ç”Ÿæ—¶æœºã€‘\nè¯»å·²æäº¤ RCï¼Œæ¯æ¬¡select éƒ½ä¼šè·å–ä¸€æ¬¡Read View è¯»æœªæäº¤ RRï¼Œ åªæœ‰ç¬¬ä¸€æ¬¡selectæ‰ä¼šè·å–Read View ã€äºŒçº§ç´¢å¼•åœ¨ç´¢å¼•è¦†ç›–é€šè¿‡çš„æ—¶å€™å¯ä»¥ç”¨MVCCå—ï¼Ÿã€‘\nå·²çŸ¥å¦‚æœæŸ¥è¯¢å­—æ®µåŒ…å«äº†æ‰€æœ‰çš„äºŒçº§ç´¢å¼•ï¼Œé‚£ä¹ˆå°±ä¼šèµ°ç´¢å¼•è¦†ç›–ï¼Œè€Œä¸ä¼šå›è¡¨ç”¨ä¸»é”®æˆ–row_idå»è¯»ä¸»é”®ç´¢å¼•çš„é¡µè®°å½•ã€‚ä½†æ˜¯ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹åœ¨ä¸»é”®ç´¢å¼•å½“ä¸­ ( ç‰ˆæœ¬é“¾åŒ…å«row_id ), é€šè¿‡äºŒçº§ç´¢å¼•çš„è®°å½•æ²¡æ³•å„¿ç›´æ¥æ‰¾åˆ°ç‰ˆæœ¬é“¾ã€‚è¿™ç§æƒ…å†µå¦‚ä½•ç”¨MVCCï¼Ÿ\näºŒçº§ç´¢å¼•ä¸­ï¼Œç”¨ä¸€ä¸ªé¢å¤–çš„page_max_trx_id æ¥è®°å½•ä¿®æ”¹è¿‡è¯¥é¡µçš„æœ€å¤§äº‹åŠ¡id\nå¦‚æœæŸ¥è¯¢åˆ°çš„readview çš„æœ€å°æœªæäº¤çš„äº‹åŠ¡id \u0026gt; page_max_trx_idï¼Œ è¯´æ˜åœ¨åˆ›å»ºè¯¥readviewæ—¶ï¼Œæœ€åä¸€æ¬¡æ›´æ–°äºŒçº§ç´¢å¼•çš„äº‹åŠ¡å·²ç»æäº¤äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹å½“å‰æŸ¥è¯¢æ˜¯å¯è§çš„ï¼Œå¦‚æœäºŒçº§ç´¢å¼•çš„è®°å½•æ²¡æœ‰è¢«åˆ é™¤ï¼Œå°±ç›´æ¥èµ°ç´¢å¼•è¦†ç›–ã€‚ å¦‚æœæœ€å°æœªæäº¤çš„äº‹åŠ¡id \u0026lt;= page_max_trx_idï¼Œ æ„å‘³ç€æ•°æ®å¯èƒ½è¢«ä¿®æ”¹äº†ã€‚ä¸èƒ½ç›´æ¥æŸ¥è¯¢ï¼Œéœ€è¦å›è¡¨ï¼Œç”¨èšç°‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚èšç°‡ç´¢å¼•ä¸­ï¼Œå¶å­ç»“ç‚¹è¡Œè®°å½•åŒ…å«äº†ç‰ˆæœ¬é“¾ï¼Œå¯ä»¥ç”¨MVCCã€‚ ã€å¯é‡å¤è¯»RRéš”ç¦»çº§åˆ«æ˜¯å¦å¯ä»¥è§£å†³å¹»è¯»ã€‘\nRRéš”ç¦»æœºåˆ¶ä¸èƒ½å®Œå…¨è§£å†³å¹»è¯»çš„ç°è±¡ï¼Œè™½ç„¶å®ƒç”¨äº†é—´éš™é”ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è§£å†³å¹»åº¦ã€‚\nä½†æ˜¯ï¼Œå¦‚æœå­˜åœ¨ä¸‹é¢è¿™ç§æƒ…å†µå°±ä¸è¡Œã€‚\näº‹åŠ¡Aè¿›è¡Œå¿«ç…§è¯», ç„¶åäº‹åŠ¡Bæ’å…¥äº†ä¸€æ¡è®°å½•å¹¶æäº¤ã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡Aæ˜¯å¯ä»¥update è¿™æ¡è¯­å¥çš„ï¼Œè¿™æ ·å°±å‡ºç°äº†å¹»è¯»ã€‚ å½“äº‹åŠ¡ä¸­å…ˆæ‰§è¡Œå¿«ç…§è¯»ï¼Œå†æ‰§è¡Œå½“å‰è¯»æ—¶ï¼Œå¯èƒ½å› è¯»å–æœ€æ–°æ•°æ®è€Œè§¦å‘å¹»è¯» -- äº‹åŠ¡Aï¼ˆRRéš”ç¦»çº§åˆ«ï¼‰ BEGIN; SELECT * FROM users WHERE age \u0026gt; 20; -- å¿«ç…§è¯»ï¼Œè¿”å›ç©ºç»“æœ -- äº‹åŠ¡Bæ’å…¥ age=25 çš„è®°å½•å¹¶æäº¤ SELECT * FROM users WHERE age \u0026gt; 20 FOR UPDATE; -- å½“å‰è¯»ï¼Œè¿”å›äº‹åŠ¡Bæ’å…¥çš„è®°å½• 24. MySQL ä¸­çš„æ—¥å¿—ç±»å‹æœ‰å“ªäº›ï¼Ÿbinlogã€redo log å’Œ undo log çš„ä½œç”¨å’ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ binlog äºŒè¿›åˆ¶æ—¥å¿—: binlogæ˜¯MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºè®°å½•æ‰€æœ‰çš„å¢åˆ æ”¹æ“ä½œ (åŒ…æ‹¬è¡¨ç»“æ„å’Œæ•°æ®çš„æ“ä½œ)ã€‚binlogæ˜¯åœ¨äº‹åŠ¡æäº¤åç”Ÿæˆçš„ï¼Œå¯ä»¥ç”¨äºæ¢å¤æ•°æ®åº“å’Œå¤‡ä»½æ•°æ®åº“ã€‚(ä¸€èˆ¬MySQLéƒ½æœ‰ä¸»åº“+ä»åº“ä¸¤ä¸ªæ•°æ®åº“ï¼Œé˜²æ­¢å•å°æ•…éšœï¼Œbinlogå°±æ˜¯ä¸ºäº†åŒæ­¥ä¸»åº“å’Œä»åº“çš„) redo log é‡åšæ—¥å¿—: redo logä½¿ç”¨æ¥æ¢å¤æ•°æ®çš„ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ã€‚å½“MySQLå‘ç”Ÿä¿®æ”¹æ˜¯ï¼Œredologä¼šå°†è¿™äº›æ“ä½œè®°å½•ä¸‹æ¥ï¼Œå¹¶å†™å…¥ç£ç›˜ã€‚å½“æ•°æ®åº“å®•æœºæ—¶ï¼Œå¯ä»¥é€šè¿‡é‡æ”¾redo logæ¢å¤æ•°æ® undo log å›æ»šæ—¥å¿—: undo logæ˜¯ç”¨äºå›æ»šæ“ä½œçš„ã€‚å½“MySQLå¼€å§‹äº‹åŠ¡çš„æ—¶å€™ï¼Œundo logä¼šè®°å½•è¿™äº›æ“ä½œçš„åå‘æ“ä½œã€‚å½“éœ€è¦å›æ»šçš„æ—¶å€™ï¼Œé€šè¿‡æ‰§è¡Œç›¸åçš„æ“ä½œï¼Œå°±å¯ä»¥å›æ»šäº‹åŠ¡ã€‚ ã€åŒºåˆ«ã€‘\næ—¥å¿—åç§° ä½œç”¨å±‚çº§ ä½œç”¨ å†…å®¹ å†™å…¥æ–¹å¼ å†™å…¥æ—¶é—´ç‚¹ binlog Serverå±‚ è®°å½•æ‰€æœ‰æ“ä½œï¼Œæ”¯æŒå¤‡ä»½æ¢å¤å’Œä¸»ä»å¤åˆ¶ è®°å½•é€»è¾‘æ“ä½œ (SQLè¯­å¥ / è¡Œçš„å˜åŒ–) è¿½åŠ å†™å…¥ï¼Œå†™æ»¡ä¹‹ååˆ›å»ºæ–°æ–‡ä»¶ï¼Œå†å†™ äº‹åŠ¡æäº¤å®Œæˆåï¼Œå†™å…¥ä¸€æ¬¡ redo log InnoDBå­˜å‚¨å¼•æ“å±‚ ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ï¼Œç”¨äºæ•…éšœæ¢å¤(æ–­ç”µå®•æœº) è®°å½•ç‰©ç†ä¿®æ”¹ (æ•°æ®é¡µçš„ä¿®æ”¹) å¾ªç¯å†™å…¥ï¼Œå›ºå®šå¤§å°ï¼Œå†™å®Œä¹‹åä»å¤´å¼€å§‹å†™ äº‹åŠ¡è¿›è¡Œä¸­ï¼Œä¸æ–­å†™å…¥ undo log InnoDBå­˜å‚¨å¼•æ“å±‚ ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œç”¨äºå›æ»šæ•°æ® è®°å½•äº‹åŠ¡ä¿®æ”¹é’±çš„æ•°æ®ï¼Œç”¨äºå›æ»šå’ŒMVCC éšäº‹åŠ¡å˜åŒ–ç”Ÿæˆï¼Œå½¢æˆç‰ˆæœ¬é“¾ äº‹åŠ¡è¿›è¡Œä¸­ï¼Œä¸æ–­å†™å…¥ ã€undo log ç»“æ„å›¾ã€‘ ã€Redo Log + Undo log ç»“æ„å›¾ã€‘\n25. MySQLéš”ç¦»çº§åˆ«æœ‰å“ªäº›? MySQLçš„éš”ç¦»çº§åˆ«åŒ…æ‹¬å››ç±»: è¯»æœªæäº¤ RUã€è¯»å·²æäº¤ RCã€å¯é‡å¤è¯» RRã€ä¸²è¡ŒåŒ–\nè¯»æœªæäº¤ RU : é¡¾åæ€ä¹‰ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡Aä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¯»å–,äº‹åŠ¡Bè¿˜æ²¡æœ‰æäº¤çš„ä¿®æ”¹æ•°æ®ã€‚ä¼šå‡ºç°è„è¯»çš„æƒ…å†µï¼Œ å°±æ˜¯è¯»å–äº†å…¶ä»–äº‹åŠ¡è¿˜æ²¡æäº¤çš„æ•°æ®ã€‚ è¯»å·²æäº¤ RC: é¡¾åæ€ä¹‰ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡Aä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯»å–äº‹åŠ¡Bæäº¤ä¹‹åçš„æ•°æ®ï¼Œè‹¥æœªæäº¤ä¸ä¼šè¯»å–ã€‚ä½†æ˜¯ä¼šå‡ºç°ä¸å¯é‡å¤è¯»çš„ç°è±¡ï¼Œè¿‡ç¨‹å¦‚ä¸‹ã€‚ äº‹åŠ¡Aç¬¬ä¸€æ¬¡select name where id = 1è¯»å–çš„æ•°æ®ä¸º å°é‚“ äº‹åŠ¡B update user set name = 'å°åˆ˜' å¹¶æäº¤ äº‹åŠ¡Aå†æ¬¡select name where id = 1è¯»å–çš„æ•°æ®ä¸º å°åˆ˜ ï¼Œç»“æœå‘ç”Ÿäº†å˜åŒ– (ä½ **çš„ç©¶ç«Ÿæ˜¯è°) å¯é‡å¤è¯» RR: ä¸ºäº†è§£å†³ä¸å¯é‡å¤è¯»çš„ç°è±¡ï¼ŒRR éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aä¼šåªç”¨ç¬¬ä¸€æ¬¡ select (å¿«ç…§è¯»)çš„æ—¶å€™ï¼Œç”Ÿæˆread viewã€‚å¦‚æœäº‹åŠ¡Bä¿®æ”¹åŒä¸€è¡Œçš„æ•°æ®å¹¶æäº¤ã€‚äº‹åŠ¡Aç¬¬äºŒæ¬¡select (å¿«ç…§è¯»)çš„æ—¶å€™ï¼Œä¼šç”¨ç¬¬ä¸€æ¬¡çš„æŸ¥è¯¢ç»“æœã€‚ä½†æ˜¯ï¼Œå®ƒä¼šå‡ºç°å¹»è¯»çš„ç°è±¡ï¼Œè¿‡ç¨‹å¦‚ä¸‹ã€‚ äº‹åŠ¡Aç¬¬ä¸€æ¬¡select count(*) è¯»å–çš„æ•°æ®ä¸º 10ï¼Œ é‡‡ç”¨çš„å¿«ç…§è¯» äº‹åŠ¡B insert xxx æ–°å¢äº†ä¸€æ¡æ•°æ®å¹¶æäº¤ äº‹åŠ¡Aç¬¬äºŒæ¬¡ç”¨select count(*) for updateï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚è¯»å‡ºæ¥çš„æ•°æ®ä¸º11æ¡ ä¸²è¡ŒåŒ–ï¼š å¯ä»¥ç†è§£æˆæŠŠRRéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰€æœ‰çš„å¿«ç…§è¯»éƒ½æ›¿æ¢æˆå½“å‰è¯»ã€‚å½“å‰è¯»çš„çŠ¶æ€ä¸‹ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹æ­£åœ¨è¯»å–çš„æ•°æ®ï¼Œå®ç°äº†è¯»çš„ä¸€è‡´æ€§ï¼Œé¿å…äº†å¹»è¯»ã€‚ ä½†æ˜¯å¹¶å‘æ€§èƒ½å¾ˆä½ã€‚ ã€ä¸åŒéš”ç¦»çº§åˆ«çš„ç‰¹æ€§ã€‘\nç‰¹æ€§ è¯»æœªæäº¤ RU è¯»å·²æäº¤ RC å¯é‡å¤è¯» RR ä¸²è¡Œè¯» è„è¯» âŒ âœ… âœ… âœ… ä¸å¯é‡å¤è¯» âŒ âŒ âœ… âœ… å¹»è¯» âŒ âŒ âŒ âœ… å¹¶å‘é‡ é«˜ è¾ƒé«˜ è¾ƒä½ ä½ ã€RR éš”ç¦»çº§åˆ«å¹»è¯»çš„è§£å†³æ–¹æ¡ˆã€‘\nåªé‡‡ç”¨ä¸‹é¢çš„æŸä¸€ç§æ–¹å¼è¿›è¡Œè¯»ï¼Œå°±ä¸ä¼šå‡ºç°å¹»è¯»\nå¿«ç…§è¯» (MVCCæœºåˆ¶)ï¼šåˆ©ç”¨MVCCå¤šç‰ˆæœ¬æ§åˆ¶ï¼Œä¸ä¼šå‡ºç°å¹»è¯»ã€‚ å½“å‰è¯» (åŠ é”æŸ¥è¯¢)ï¼šé€šè¿‡ä¸´é”®é”Next-key Lock (è®°å½•é” + é—´éš™é”)ï¼Œé¿å…å…¶ä»–äº‹åŠ¡ä¿®æ”¹æ•°æ®ï¼Œé˜²æ­¢å¹»è¯»ã€‚å…¶å®å°±æ˜¯ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ã€‚ 26. æ•°æ®åº“çš„è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ åç§° å®šä¹‰ å®šä¹‰(æ•´æ´»ç‰ˆ) è„è¯» äº‹åŠ¡Aè¯»å–åˆ°äº†äº‹åŠ¡Bè¿˜æ²¡æäº¤çš„æ•°æ® éª—å­å•Š!!! ä¸å¯é‡å¤è¯» äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–çš„æ•°æ®å’Œåé¢è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€è‡´ è°**åŠ¨æˆ‘ä¸œè¥¿äº†? å¹»è¯» äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–çš„æ•°æ®æ€»æ•°å’Œç¬¬äºŒæ¬¡è¯»å–çš„æ•°æ®æ€»æ•°ä¸ä¸€æ · é—¹é¬¼äº†ï¼Œè¿›å»å‰3ä¸ªäººï¼Œå‡ºæ¥äº†4ä¸ªäºº æ•´æ´»ç‰ˆè§£é‡Šå‚è§IDä¸º å°æ˜ çš„å¤©æ‰é€‰æ‰‹\n27. MySQL é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªçº§åˆ«ï¼Ÿ MySQLé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯» RR ã€‚\nã€ä¸ºä»€ä¹ˆé€‰ RR éš”ç¦»çº§åˆ«ã€‘\nå› ä¸ºMySQLå½“ä¸­ä¸€èˆ¬æ˜¯æœ‰ä¸»åº“ + ä»åº“ä¸¤ä¸ªæ•°æ®åº“ï¼Œä¸ºäº†é¿å…ä¸€ä¸ªåº“çªç„¶gäº†ï¼Œæ•°æ®åº“å°±å…¨gäº†ã€‚ä¸»åº“å’Œä»åº“ä¹‹é—´æ˜¯é‡‡ç”¨binlogè¿›è¡Œå¤‡ä»½çš„ï¼Œå¦‚æœbinlogæ˜¯statementæ ¼å¼ï¼Œåœ¨RUå’ŒRCçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸»åº“å’Œä»åº“å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nã€binlog æ ¼å¼ã€‘\næ ¼å¼åç§° å†…å®¹ ä¼˜ç‚¹ ç¼ºç‚¹ statement è®°å½•æ‰§è¡Œçš„SQLè¯­å¥ï¼Œå‘é€åˆ°ä»åº“æ‰§è¡Œ æ—¥å¿—é‡å°‘ï¼Œä¼ è¾“ç‡é«˜ï¼Œç®€å•æ“ä½œ limit è¿™ç§ä¾èµ–ç¯å¢ƒçš„å‡½æ•°ï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µ row è®°å½•æ¯è¡Œæ•°æ®å˜åŒ–ï¼Œå‘é€åˆ°ä»åº“åº”ç”¨ å‡†ç¡®å¤åˆ¶æ•°æ®ï¼Œé¿å…ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µ æ—¥å¿—é‡å¤§ï¼Œå ç”¨å¸¦å®½å’Œç©ºé—´ mixed ç»“åˆè¯­å¥å’Œè¡Œå¤åˆ¶ï¼Œè‡ªåŠ¨åˆ‡æ¢ æ—¥å¿—é‡ä¸€èˆ¬ï¼Œä¸»ä»ä¸€è‡´æ€§è¾ƒé«˜ è‡ªåŠ¨åˆ‡æ¢æ“ä½œå¤æ‚ ã€RU å’Œ RC å¯¼è‡´ä¸»ä»ä¸ä¸€è‡´ã€‘\nsession1 session2 äº‹åŠ¡Aå¼€å§‹ delete from user where age \u0026lt; 10 äº‹åŠ¡Bå¼€å§‹ insert into user value(5,...) äº‹åŠ¡Bæäº¤ äº‹åŠ¡Aæäº¤ æ­¤æ—¶ï¼Œbinlogé‡Œé¢è®°å½•çš„å¦‚ä¸‹ï¼Œæ‰§è¡Œé¡ºåºæ˜¾ç„¶å’ŒåŸå§‹çš„ä¸ä¸€æ ·ï¼Œä»åº“é‡Œé¢age = 5 è¿™æ¡æ•°æ®è‚¯å®šæ²¡äº†\ninsert into user value(10,...) delete from user where age \u0026lt; 10 ã€ä¸ºä»€ä¹ˆ RR ä¸ä¼šå‡ºç°ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‘\nå› ä¸º RR éš”ç¦»çº§åˆ«ä¸ä»…ä¼šå¯¹æ›´æ–°çš„æ•°æ®è¡Œæ·»åŠ è¡Œçº§çš„è®°å½•é”ï¼Œ è¿˜ä¼šæ·»åŠ é—´éš™é”å’Œä¸´é”®é”ã€‚å¦‚æœæœ‰è¿™ä¸¤ä¸ªé”çš„è¯ï¼Œåœ¨äº‹åŠ¡Bæ‰§è¡Œinsertçš„æ—¶å€™ï¼Œä¼šè¢«é˜»å¡çš„ã€‚\nã€ä¸ºä»€ä¹ˆå¤§å‚ä¸€èˆ¬ç”¨ RC ã€‘\nå…ˆæ¥å¯¹æ¯”ä¸€ä¸‹RC å’Œ RR éš”ç¦»çº§åˆ«çš„åŒºåˆ«\nç‰¹æ€§ RC RR binlogæ ¼å¼ åªèƒ½ç”¨row, ç”¨mixedä¹Ÿä¼šè‡ªåŠ¨åˆ‡æ¢æœªrow statementã€rowã€mixed é”æœºåˆ¶ åªæœ‰è¡Œçº§çš„è®°å½•é” è®°å½•é”ã€é—´éš™é”ã€ä¸´é”®é” è¯»æœºåˆ¶ å½“å‰è¯»ï¼šæ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„å¿«ç…§ï¼Œè¯»å–è¡Œçš„æœ€æ–°ç‰ˆæœ¬ åŒæ—¶æ”¯æŒå½“å‰è¯»å’Œå¿«ç…§è¯»ï¼Œé»˜è®¤selectæ˜¯å¿«ç…§è¯» å¹¶å‘æ€§ å¹¶å‘æ€§é«˜ å¹¶å‘æ€§ä½ï¼šå› ä¸ºæœ‰é—´éš™é”ã€ä¸´é”®é”ï¼Œä¼šå¯¼è‡´é”ç«äº‰åŠ å‰§ï¼Œé™ä½ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚ ç”¨RCçš„åŸå› æœ‰ä¸¤ä¸ª:\næé«˜å¹¶å‘ï¼šå› ä¸ºç›¸è¾ƒäºRRï¼ŒRC çš„å¹¶å‘ç‡æ›´é«˜ å‡å°‘æ­»é”ï¼šå› ä¸ºRR å½“ä¸­çš„é—´éš™é”å’Œä¸´é”®é”ä¼šä½¿å¾—é”çš„ç²’åº¦å˜å¤§ï¼Œæ­»é”çš„å‡ ç‡ä¼šå˜å¤§ã€‚ ã€ RC å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ã€‘\nå¦‚æœåªæ˜¯å•çº¯çš„ä¸å¯é‡å¤è¯»ï¼Œå…¶å®è¿˜å¥½ï¼Œåªè¦åé¢ä¿®æ”¹æ•°æ®ä¸åŸºäºè¿™ä¸ªå€¼ã€‚æ‰€ä»¥ï¼Œåœ¨ä¿®æ”¹æ ¸å¿ƒè¡¨çš„æ—¶å€™ï¼Œå¢åŠ ä¹è§‚é”çš„æ ‡è®°ã€‚æ›´æ–°çš„æ—¶å€™å¸¦ä¸Šä¹è§‚é”è¿›è¡Œç‰ˆæœ¬åˆ¤æ–­ä¹‹åï¼Œå†æ›´æ–°ã€‚\n28. MySQL äº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤æ˜¯ä»€ä¹ˆï¼Ÿ/ MySQLé‡Œé¢çš„ Redolog å’Œ BinLog æ€ä¹ˆä¿æŒä¸€è‡´? é¦–å…ˆï¼Œäº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤å°±æ˜¯ä¸ºäº†è®©MySQLä¸­çš„ binlog å’Œ redo log ä¿æŒä¸€è‡´ã€‚\nã€ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ã€‘\nå¦‚æœæ²¡æœ‰ä¸¤é˜¶æ®µæäº¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´binlogå’Œredo logä¸ä¸€è‡´ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ä¸¤ç§æƒ…å†µ\n**æƒ…å†µä¸€ï¼š**å…ˆå†™å®Œ redo logï¼Œå†å†™binlogï¼šå¦‚æœå†™å®Œredo logåï¼ŒMySQLçªç„¶å®•æœºäº†ï¼Œbinlogè¿˜æ²¡å†™å…¥æ•°æ®ã€‚æ­¤æ—¶ï¼ŒMySQLé‡å¯åï¼Œæ ¹æ® redo log æ¢å¤äº‹åŠ¡çš„ä¿®æ”¹ï¼Œä½†æ˜¯binlogæ²¡æœ‰æœ¬æ¬¡äº‹åŠ¡æäº¤çš„æ•°æ®ã€‚æ‰€ä»¥é€šè¿‡binlogæ¢å¤çš„æ—¶å€™ï¼Œè¿™æ¬¡äº‹åŠ¡çš„ä¿®æ”¹å°±ä¸¢äº†ã€‚\n**æƒ…å†µäºŒï¼š**å…ˆå†™å®Œbinlogï¼Œå†å†™redo logï¼šå¦‚æœå†™å®Œbinlogä¹‹åï¼Œçªç„¶MySQLå®•æœºäº†ï¼Œredo logè¿˜æ²¡å†™å…¥æ•°æ®ã€‚é‡å¯åå› ä¸ºredo logé‡Œé¢æ²¡æœ‰è®°å½•ï¼Œæ‰€ä»¥æ²¡æ³•å„¿æ¢å¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚ä½†æ˜¯binlogè®°å½•äº†æœ¬æ¬¡äº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œåç»­ç”¨binlogæ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œå°±å¯¼è‡´å’ŒåŸåº“ä¸ä¸€æ ·äº†ã€‚(binlogæ˜¯ç”¨æ¥ç»™ä»åº“å¤åˆ¶çš„)\nä¸ºäº†é¿å…ä¸Šé¢çš„ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼Œå°±æŠŠå•ä¸ªäº‹åŠ¡çš„æäº¤æ‹†åˆ†ä¸º2ä¸ªé˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µ(prepare) + æäº¤é˜¶æ®µ(commit)\nã€äº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤è¿‡ç¨‹ã€‘\nprepare å‡†å¤‡é˜¶æ®µ: InnoDB å°†å†…éƒ¨äº‹åŠ¡id XID å†™å…¥redo logï¼Œå¹¶å°†å…¶æ ‡è®°ä¸º prepare çŠ¶æ€ã€‚ç„¶åå°†redo log æŒä¹…åŒ–åˆ°ç£ç›˜æˆ–è€…å†™å…¥redo log bufferï¼Œå…·ä½“å–å†³äº innodb_flush_log_at_trx_commit å‚æ•° commit æäº¤é˜¶æ®µï¼šå°†å†…éƒ¨äº‹åŠ¡id XIDå†™å…¥åˆ°binlogï¼Œè°ƒç”¨write()å‡½æ•°å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„Page Cacheã€‚å½“binlogå†™å…¥ç£ç›˜æˆåŠŸå°±è®¤ä¸ºäº‹åŠ¡å°±æ˜¯æ‰§è¡Œå®Œæˆäº†ï¼Œå°±ç®—redo log è¿˜æ˜¯prepareçŠ¶æ€ä¹Ÿæ²¡äº‹å„¿ã€‚ å¦‚ä½•è§£å†³çš„ä¸Šé¢æåˆ°çš„ä¸¤ç§æƒ…å†µå‘¢ï¼Ÿ\næƒ…å†µä¸€ï¼š å†™å®Œ redo log ä¹‹åï¼Œè¿˜å¤„äºprepareçŠ¶æ€ï¼Œè¿˜æ²¡å†™å…¥binlogï¼Œ çªç„¶å®•æœºäº†ã€‚ MySQLé‡å¯åï¼Œä¼šé¡ºåºæ‰«æredo logæ–‡ä»¶ï¼Œå¦‚æœè¿˜å¤„äºprepareçŠ¶æ€ï¼Œå°±æŸ¥çœ‹redo logå½“ä¸­çš„å†…éƒ¨äº‹åŠ¡IDXIDåœ¨binlogä¸­æ˜¯å¦å­˜åœ¨ å¦‚æœbinlogä¸å­˜åœ¨å†…éƒ¨äº‹åŠ¡idXIDï¼Œè¡¨æ˜redologå·²ç»åˆ·ç›˜(å†™å…¥ç£ç›˜äº†)ï¼Œä½†æ˜¯binlogè¿˜æ²¡æœ‰åˆ·ç›˜ï¼Œç›´æ¥å›æ»šäº‹åŠ¡ï¼Œå°±å½“è¿™æ¡äº‹åŠ¡æ‰§è¡Œå¤±è´¥ æƒ…å†µäºŒï¼š å†™å®Œbin logä¹‹åï¼Œè¿˜å¤„äºprepareçŠ¶æ€ï¼Œè¿˜æ²¡commitï¼Œ çªç„¶å®•æœºäº†ã€‚ MySQLé‡å¯åï¼Œä¼šé¡ºåºæ‰«æredo logæ–‡ä»¶ï¼Œå¦‚æœè¿˜å¤„äºprepareçŠ¶æ€ï¼Œå°±æŸ¥çœ‹redo logå½“ä¸­çš„å†…éƒ¨äº‹åŠ¡IDXIDåœ¨binlogä¸­æ˜¯å¦å­˜åœ¨ã€‚ (ä¸€èˆ¬éƒ½æ˜¯å…ˆæ‰«æredologï¼Œå†çœ‹binlog) å¦‚æœbinlogé‡Œé¢æœ‰å½“å‰å†…éƒ¨äº‹åŠ¡idXIDï¼Œè¯´æ˜redologå’Œbinlogéƒ½åˆ·ç›˜äº†ï¼Œç›´æ¥æäº¤äº‹åŠ¡å°±å¥½äº†ã€‚ ã€ä¸¤é˜¶æ®µæäº¤æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‘\nä¸¤é˜¶æ®µæäº¤ç¡®å®ä¼šå¯¼è‡´ç£ç›˜I/Oæ¬¡æ•°å¢é«˜å’Œé”çš„ç«äº‰å˜å¾—æ¿€çƒˆ\nç£ç›˜I/Oçš„æ¬¡æ•°å¢é«˜: æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½ä¼šè¿›è¡Œä¸¤æ¬¡å†™å…¥ç£ç›˜ fsyncï¼Œä¸€æ¬¡redologåˆ·ç›˜ï¼Œä¸€æ¬¡binlogåˆ·ç›˜ é”ç«äº‰æ¿€çƒˆï¼šä¸ºäº†ä¿è¯å•äº‹åŠ¡çš„ä¸¤ä¸ªæ—¥å¿—å†…å®¹ä¸€è‡´ï¼Œæ‰€ä»¥éœ€è¦åœ¨æäº¤æµç¨‹ä¸Šï¼Œæ·»åŠ é”ä¿è¯ä¸¤é˜¶æ®µçš„åŸå­æ€§ã€‚ç¡®ä¿æ—¥å¿—é‡Œé¢çš„é¡ºåºï¼Œä¸å—å¤šäº‹åŠ¡æäº¤çš„å½±å“ã€‚ ã€ä¼˜åŒ–äºŒé˜¶æ®µæäº¤ï¼šç»„æäº¤ã€‘\nä¸ºäº†å‡å°‘äºŒé˜¶æ®µæäº¤çš„I/Oæ¬¡æ•°å’Œé”çš„ç«äº‰ï¼ŒMySQLæ–°å¢äº†ç»„æäº¤æœºåˆ¶ï¼Œå¯ä»¥è®©å¤šä¸ªäº‹åŠ¡æäº¤æ—¶åˆå¹¶å¤šä¸ªbinlogï¼Œåªè¿›è¡Œä¸€æ¬¡åˆ·ç›˜æ“ä½œã€‚ç»„æäº¤ç‰ˆæœ¬çš„äºŒé˜¶æ®µæäº¤åªæœ‰commitæäº¤éƒ¨åˆ†æœ‰äº›å˜åŒ–ï¼š\nflushé˜¶æ®µï¼šå¤šä¸ªäº‹åŠ¡æŒ‰ç…§é¡ºåºå°†binlogä»Cacheå†™å…¥åˆ°æ–‡ä»¶ (ä¸åˆ·ç›˜)ï¼Œ ä¸ºäº†æ”¯æ’‘redo logç»„æäº¤ syncåŒæ­¥é˜¶æ®µï¼šå¯¹binlogè¿›è¡Œå†™å…¥ç£ç›˜fsyncæ“ä½œï¼Œå¤šä¸ªäº‹åŠ¡çš„binlogä¸€å¹¶å†™å…¥ç£ç›˜ï¼Œä¸ºäº†æ”¯æ’‘binlogçš„ç»„æäº¤ commité˜¶æ®µ: æ‰€æœ‰äº‹åŠ¡æŒ‰ç…§é¡ºåºè¿›è¡Œcommitæäº¤æ“ä½œ æ¯ä¸ªé˜¶æ®µéƒ½æœ‰é˜Ÿåˆ—ç»´æŠ¤ï¼Œé”é’ˆå¯¹é˜Ÿåˆ—è¿›è¡Œä¿æŠ¤ï¼Œå‡å°é”çš„èŒƒå›´çš„åŒæ—¶ï¼Œæé«˜æ•ˆç‡ã€‚\nã€binlogåˆ·ç›˜æ—¶é—´ã€‘\näº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿å†™æ—¥å¿—åˆ°binlog cache (Serverå±‚çš„cache) äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä»binlog cache å†™å…¥åˆ° binlogæ–‡ä»¶ã€‚å•ä¸ªäº‹åŠ¡çš„binlogä¸èƒ½æ‹†å¼€ï¼Œåªèƒ½ä¸€æ¬¡æ€§å†™å…¥ã€‚ â€‹ MySQLåˆ†é…äº†ä¸€ç‰‡å†…å­˜ç”¨äºç¼“å†²binlog ï¼Œå°±æ˜¯binlog cacheã€‚å¯ä»¥ç”¨binlog_cache_sizeä¿®æ”¹å®ƒçš„å¤§å°ã€‚\n29. ä»€ä¹ˆæ˜¯ Write-Ahead Logging (WAL) æŠ€æœ¯ï¼Ÿå®ƒçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼ŸMySQL ä¸­æ˜¯å¦ç”¨åˆ°äº† WALï¼Ÿ WAL æ˜¯ç”¨æ¥ç¡®ä¿åœ¨ä¿®æ”¹çœŸæ­£çš„æ•°æ®ä¹‹å‰ï¼Œå…ˆå°†ä¿®æ”¹è®°å½•å†™å…¥æ—¥å¿—çš„æŠ€æœ¯ã€‚ä¸ºäº†å½“ç³»ç»Ÿå®•æœºçš„æ—¶å€™ï¼Œé€šè¿‡æ—¥å¿—ä¹Ÿå¯ä»¥æ¢å¤æ•°æ®ï¼ŒMySQLçš„redo logå°±æ˜¯ä¾é çš„ WALæŠ€æœ¯ã€‚å®ƒçš„æ ¸å¿ƒå°±æ˜¯, å…ˆå†™æ—¥å¿—ï¼Œå†å†™æ•°æ®\nMySQLäº‹åŠ¡ä»å¼€å¯åˆ°æäº¤çš„è¿‡ç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š\nå¼€å¯äº‹åŠ¡ -\u0026gt; æŸ¥è¯¢æ•°æ®åˆ°å†…å­˜ -\u0026gt; è®°å½•undo log -\u0026gt; è®°å½•redo log(prepareé˜¶æ®µ) -\u0026gt; æ›´æ–°å†…å­˜ -\u0026gt; è®°å½•binlog -\u0026gt; è®°å½•redo log (commitä¹‹å)\n30. MySQL ä¸­å¦‚æœå‘ç”Ÿæ­»é”åº”è¯¥å¦‚ä½•è§£å†³ï¼Ÿ ã€å¦‚ä½•å¤„ç†MySQLæ­»é”ã€‘\nè®¾ç½®MySQLæ­»é”è‡ªåŠ¨æ£€æµ‹æœºåˆ¶\nMySQLè‡ªå¸¦æ­»é”æ£€æµ‹æœºåˆ¶innodb_deadlock_detectï¼Œå¼€å¯å³å¯ã€‚å¦‚æœæ£€æŸ¥åˆ°æ­»é”çš„å‘ç”Ÿï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨å›æ»šä¸€ä¸ªæŒæœ‰èµ„æºè¾ƒå°‘çš„äº‹åŠ¡ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡å°±å¯ä»¥æ‰§è¡Œäº†ã€‚\n-- æŸ¥çœ‹ä¸»åŠ¨æ­»é”æ£€æµ‹æ˜¯å¦å¼€å¯ show variable like \u0026#39;%innodb_deadlock_detect%\u0026#39; -- å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹ (é»˜è®¤ä¸ºON) set global innodb_deadlock_detect=\u0026#39;ON\u0026#39; è®¾ç½®é”ç­‰å¾…è¶…æ—¶å‚æ•°\nå¯ä»¥è®¾ç½®è·å–é”çš„ç­‰å¾…æ—¶é—´(é»˜è®¤ä¸º50s)ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œå°±ä¼šä¸»åŠ¨é‡Šæ”¾é”ï¼Œè®©äº‹åŠ¡å›æ»š\n-- äº‹åŠ¡ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´ (é»˜è®¤ä¸º50s) show variable like \u0026#39;%innodb_lock_wait_timeout%\u0026#39; KILLæ­»é”äº‹åŠ¡\nå¦‚æœMySQLå·²ç»ä¸Šçº¿äº†ï¼Œä¸”æ²¡æœ‰è®¾ç½®é‚£äº›æ£€æµ‹ï¼Œå¯ä»¥ç›´æ¥æŠŠæ­»é”çš„äº‹åŠ¡killæ‰ã€‚killä¹‹å‰ï¼Œéœ€è¦æŸ¥çœ‹ä¸€ä¸‹æ‰§è¡Œçš„äº‹åŠ¡å’Œè¡¨ä¿¡æ¯ï¼Œç”¨show engine innodb status\n-- æŸ¥çœ‹æ­»é”æ—¥å¿— -- æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡, å’Œç›¸å…³çš„è¡¨ä¿¡æ¯ SHOW ENGINE INNODB STATUS -- é€šè¿‡çº¿ç¨‹ID, æ‰‹åŠ¨KILLæ­»é”äº‹åŠ¡ kill çº¿ç¨‹ID ã€å¦‚ä½•é¿å…æ­»é”çš„å‘ç”Ÿã€‘\né¿å…å¤§äº‹åŠ¡: å¤§äº‹åŠ¡å ç”¨çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå®¹æ˜“å¯¼è‡´æ­»é”å‘ç”Ÿã€‚å¯ä»¥æŠŠå¤§äº‹åŠ¡æ‹†è§£æˆå¤šä¸ªå°äº‹åŠ¡ï¼Œå°±å¯ä»¥é™ä½æ­»é”çš„å‘ç”Ÿæ¦‚ç‡ã€‚ æ›´æ”¹æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼šMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯RRï¼Œå®ƒåŒ…å«é—´éš™é”å’Œä¸´é”®é”ã€‚å¦‚æœæ”¹æˆRCï¼Œå¯ä»¥å‡å°‘æ­»é”çš„æ¦‚ç‡ã€‚ åˆç†åŠ ç´¢å¼•ï¼Œå‡å°‘åŠ é”èŒƒå›´ï¼šå‘½ä¸­ç´¢å¼•ä¼šå¯¹è¯¥è¡ŒåŠ ä¸Šè¡Œé”ï¼Œæ²¡æœ‰å‘½ä¸­åˆ™ä¼šå¯¹æ•´å¼ è¡¨åŠ ä¸Šè¡¨é”ã€‚è¡¨é”çš„å†²çªæ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œå®¹æ˜“å¯¼è‡´æ­»é”ã€‚ 31. MySQL ä¸­å¦‚ä½•è§£å†³æ·±åº¦åˆ†é¡µçš„é—®é¢˜ï¼Ÿ æ·±åº¦åˆ†é¡µé—®é¢˜å®šä¹‰ï¼šæ·±åº¦åˆ†é¡µæ˜¯æŒ‡å½“ç”¨æˆ·éœ€è¦æŸ¥è¯¢å¾ˆä¹…ä»¥å‰çš„æ•°æ®ï¼Œæ¯”å¦‚æ—©å¹´æŸä¸ªèŒƒå›´çš„è®¢å•ã€‚ SQLè¯­å¥å½“ä¸­çš„ limit åç§»é‡å˜å¾—éå¸¸å¤§ï¼ŒMySQLæ€§èƒ½ç›´çº¿ä¸‹é™çš„ç°è±¡ã€‚\nä¸ºä»€ä¹ˆä¼šæ€§èƒ½ä¸‹é™: å› ä¸ºMySQLä¼šé€‰æ‹©å…¨è¡¨æ‰«æï¼Œè€Œä¸ç”¨ç´¢å¼•æ‰«æï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚å½“ limit åç§»é‡åå¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š\næ‰«æåç§»é‡ä¹‹å‰çš„1000000è¡Œï¼Œä¸¢å¼ƒä¸ç¬¦åˆæ¡ä»¶çš„ç»“æœ æ¯ä¸€æ¬¡æŸ¥è¯¢éƒ½éœ€è¦ç”¨ age åˆ—æŸ¥åˆ°çš„ä¸»é”®å€¼å»å›è¡¨ï¼Œæ•ˆç‡å¾ˆä½ã€‚(MySQLä¼˜åŒ–å™¨å°±é€‰æ‹©äº†ï¼Œå…¨è¡¨æ‰«æ + æ–‡ä»¶æ’åº) è¿”å›ç¬¦åˆæ¡ä»¶çš„æœ€ç»ˆè®°å½• select * from user where sex = \u0026#39;å¥³\u0026#39; order by age limit 1000000, 10 ã€å¦‚ä½•è§£å†³æ·±åº¦åˆ†æå¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‘\nè®°å½•ä¸Šä¸€æ¬¡çš„æœ€å¤§IDï¼Œä¿®æ”¹ä¸ºèŒƒå›´æŸ¥è¯¢ (å¦‚æœèƒ½å¤Ÿä¿è¯ id è¿ç»­é€’å¢)\næŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä¼šèµ°ä¸»é”®ç´¢å¼•ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚ä½†æ˜¯é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°æ•°æ®é‡å¤æˆ–è€…é—æ¼çš„æƒ…å†µã€‚\n# å¯ä»¥é€šè¿‡è®°å½•ä¸Šæ¬¡æŸ¥è¯¢ç»“æœçš„æœ€åä¸€æ¡è®°å½•è¿›è¡Œä¸‹ä¸€é¡µçš„æŸ¥è¯¢ SELECT * FROM user WHERE id \u0026gt; 1000000 LIMIT 10; å­æŸ¥è¯¢\né€šè¿‡å­æŸ¥è¯¢æ¥è·å– id çš„èµ·å§‹å€¼ï¼ŒæŠŠ limit 2000000 çš„æ¡ä»¶è½¬ç§»åˆ°å­æŸ¥è¯¢ã€‚ æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå­æŸ¥è¯¢è¯­å¥åˆ©ç”¨idçš„ä¸»é”®ç´¢å¼•å¿«é€Ÿæ‰¾åˆ°è¿™æ¡è®°å½•ï¼Œç„¶åå®šä½åˆ° 1000001 è¿™æ¡è®°å½•çš„ä¸»é”® ä¸»æŸ¥è¯¢è¯­å¥å°†å­æŸ¥è¯¢è¿”å›çš„èµ·å§‹ ID ä½œä¸ºè¿‡æ»¤æ¡ä»¶ï¼Œç„¶åä½¿ç”¨æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤æ‰å‰é¢çš„æ•°æ® å¯ä»¥å‡å°‘å…¨è¡¨æ‰«æï¼Œæé«˜æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œå­æŸ¥è¯¢ä¼šç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå¤æ‚åœºæ™¯ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚\nSELECT * FROM user WHERE id \u0026gt;= ( SELECT id FROM user order by id limit 1000000,1 ) LIMIT 10; å»¶è¿Ÿå…³è”\nå’Œå­æŸ¥è¯¢ç±»ä¼¼ï¼Œå°†limit æ“ä½œè½¬ç§»åˆ°ä¸»é”®ç´¢å¼•ä¸Šï¼Œè®©å…¶å‡å°‘å›è¡¨æ¬¡æ•°æ¥ä¼˜åŒ–æŸ¥è¯¢ (åªæŸ¥è¯¢idä¸ç”¨å›è¡¨)ã€‚ç„¶åå°†å­æŸ¥è¯¢ä¸­çš„ç»“æœåˆå¹¶åˆ°ä¸»æŸ¥è¯¢å½“ä¸­ï¼Œé¿å…åˆ›å»ºä¸´æ—¶è¡¨ã€‚æ•´ä½“æ€§èƒ½æ¯”å­æŸ¥è¯¢å¥½ã€‚æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹:\nå­æŸ¥è¯¢è¯­å¥åˆ©ç”¨ id çš„ä¸»é”®ç´¢å¼•æ¥å¿«é€Ÿæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å‰10æ¡è®°å½•çš„id é€šè¿‡inner join å†…è¿æ¥å°†id å’Œ ä¸»è¡¨è¿›è¡Œå…³è”ï¼Œè·å–å®Œæ•´è®°å½• select user.* from user t1 inner join (SELECT id FROM user order by id limit 1000000, 10) t2 on t1.id = t2.id è¦†ç›–ç´¢å¼•ï¼š\nè¦†ç›–ç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µ(éƒ½æ˜¯ç´¢å¼•çš„ï¼Œå¯ä»¥é¿å…å›è¡¨æ“ä½œ\n-- è¦†ç›–ç´¢å¼•æŸ¥è¯¢ SELECT id, name FROM user by id limit 1000000, 10 ä¼˜åŒ–æ–¹æ³• é€‚ç”¨åœºæ™¯ ä¼˜ç‚¹ ç¼ºç‚¹ èŒƒå›´æŸ¥è¯¢ ä¸»é”®æˆ–ç´¢å¼•å­—æ®µï¼Œè¿ç»­æ€§é«˜ ç®€å•é«˜æ•ˆï¼Œå‡å°‘æ‰«é¢èŒƒå›´ ä¸é€‚ç”¨äºéä¸»é”®å­—æ®µ; å¦‚æœæœ‰é«˜å¹¶å‘ï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®é‡å¤æˆ–è€…é—æ¼çš„æƒ…å†µã€‚ å­æŸ¥è¯¢ åç§»é‡å¤§ï¼Œç´¢å¼•åˆ—å­˜åœ¨ åˆ©ç”¨ç´¢å¼•å¿«é€Ÿå®šä½ï¼Œå‡å°‘å…¨è¡¨æ‰«æ éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨ï¼Œå¢åŠ å¼€é”€ï¼Œå¤æ‚åœºæ™¯æ€§èƒ½ä¸‹é™ å»¶è¿Ÿå…³è” ä¸»é”®ç´¢å¼•å­˜åœ¨ï¼ŒæŸ¥è¯¢å­—æ®µå¤š å‡å°‘å›è¡¨æ¬¡æ•° æŸ¥è¯¢é€»è¾‘å¤æ‚ è¦†ç›–ç´¢å¼• éœ€è¦æŸ¥è¯¢å­—æ®µéƒ½åŒ…å«åœ¨ç´¢å¼•é‡Œé¢ æ— éœ€å›è¡¨æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜ åªèƒ½ç”¨äºç®€å•å­—æ®µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„å­—æ®µæœ‰ä¼˜å…ˆ ã€å¦‚æœå‡ºç°è¡¨åˆ†é¡µæ€ä¹ˆåŠã€‘\nå‡å¦‚å‡ºç°è¡¨åˆ†é¡µï¼Œæ¯”å¦‚ç°åœ¨æœ‰è¡¨1å’Œè¡¨2ã€‚è¡¨1ä¸­æŒ‰scoreå­—æ®µæ’åºä¸º100,90,80ï¼Œè¡¨2ä¸­æŒ‰scoreå­—æ®µæ’åºä¸º95,85,75ã€‚ç„¶åé€‚ç”¨select score from student_info limit 1, 2 æŸ¥è¯¢å‡ºæ¥çš„æ˜¯ 90 (è¡¨1) å’Œ 85 (è¡¨2)çš„åˆå¹¶ç»“æœã€‚\nè§£å†³æ–¹æ¡ˆï¼šå°†åˆ†é¡µæ¡ä»¶æ”¹å†™ä¸ºlimit 0, 3ï¼Œå–å‡ºæ‰€æœ‰å‰ä¸¤é¡µæ•°æ®ï¼Œå†ç»“åˆæ’åºæ¡ä»¶è®¡ç®—å‡ºæ­£ç¡®çš„æ•°æ®ã€‚å¦‚æœé‡åˆ°è¡¨åˆ†é¡µçš„æƒ…å†µï¼Œå¿…é¡»ä»offset = 0çš„åœ°æ–¹å¼€å§‹æŸ¥è¯¢ï¼Œé¿å…æ¼æ‰æ•°æ®ã€‚\n32. ä»€ä¹ˆæ˜¯ MySQL çš„ä¸»ä»åŒæ­¥æœºåˆ¶ï¼Ÿå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ ä¸»ä»åŒæ­¥æœºåˆ¶: å°†ä¸»æ•°æ®åº“ä¸Šçš„æ•°æ®åŒæ­¥åˆ°å¤šä¸ªä»æ•°æ®åº“ä¸­çš„æŠ€æœ¯ ä¸ºä»€ä¹ˆä¼šæœ‰ä¸»ä»åŒæ­¥?: å› ä¸ºå¦‚æœMySQLåªæœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œå½“æ•°æ®åº“æ–‡ä»¶æŸåäº†ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ²¡äº†ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§å•å°æ•…éšœï¼Œå°±æœ‰äº†ä¸»ä»æ•°æ®åº“ã€‚ä¸»ä»æ•°æ®åº“ä¹‹é—´ä¸ºäº†ä¿æŒæ•°æ®ä¸€è‡´ï¼Œå°±æœ‰äº†ä¸»ä»åŒæ­¥ã€‚ ã€ä¸»ä»åŒæ­¥çš„æµç¨‹ã€‘\nä»æœåŠ¡å™¨åˆ›å»ºçº¿ç¨‹: ä»æœåŠ¡å™¨å¼€å¯ä¸»ä»å¤åˆ¶ä¹‹åï¼Œåˆ›å»ºI/Oçº¿ç¨‹å’ŒSQLçº¿ç¨‹ ä»æœå™¨å’Œä½æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼šä»æœåŠ¡å™¨çš„I/Oçº¿ç¨‹å’Œä¸»æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä¸»æœåŠ¡å™¨çš„binlog dump çº¿ç¨‹å’Œä»æœåŠ¡å™¨è¿›è¡Œäº¤äº’ ä»æœåŠ¡å™¨å‘ŠçŸ¥åŒæ­¥ä½ç½®ï¼šä»æœåŠ¡å™¨çš„I/Oçº¿ç¨‹ä¼šå‘ŠçŸ¥ä½æœåŠ¡å™¨çš„ dump çº¿ç¨‹ä»å“ªé‡Œå¼€å§‹æ¥å— binlogã€‚ **ä¸»æœåŠ¡å™¨æ›´æ–°binlogï¼š**ä¸»æœåŠ¡å™¨æŠŠæ‰€æœ‰çš„æ›´æ–°è®°å½•ä»Page Cache å†™å…¥binlog æ–‡ä»¶ (æœ‰ä¸‰ç§æ ¼å¼ï¼šstatementã€rowã€mixed) dumpçº¿ç¨‹æ§åˆ¶binlogä¼ è¾“ï¼š ä¸»æœåŠ¡å™¨çš„dumpçº¿ç¨‹æ£€æµ‹åˆ°binlogå˜åŒ–ï¼Œä»æŒ‡å®šä½ç½®è¯»å–ã€‚ä»æœåŠ¡å™¨çš„I/Oçº¿ç¨‹å¼€å§‹æ‹‰å–binlog æ–‡ä»¶ï¼Œé‡‡ç”¨æ‹‰å–æ¨¡å¼æœ‰åˆ©äºä»åº“ç®¡ç†åŒæ­¥è¿›åº¦å’Œå¤„ç†å»¶è¿Ÿ ä¸­ç»§å­˜å‚¨åˆ°relay logï¼š ä»æœåŠ¡å™¨çš„I/Oçº¿ç¨‹å°†æ¥æ”¶åˆ°çš„æ¥è‡ªbinlogä¸­çš„å†…å®¹ï¼Œå­˜å‚¨åˆ°relay log é‡æ”¾relay logï¼Œå†™å…¥æ•°æ®ï¼šä»æœåŠ¡å™¨çš„SQLçº¿ç¨‹è¯»å–relay log å†…å®¹ï¼Œè§£ææˆå…·ä½“æ“ä½œä¹‹åå†™å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­ ã€ä¸»ä»åŒæ­¥çš„ä¸‰ç§æ–¹å¼ã€‘\nåŒæ­¥æ¨¡å¼ è¯´æ˜ ä¼˜ç‚¹ ç¼ºç‚¹ å¼‚æ­¥å¤åˆ¶(é»˜è®¤) ä¸»åº“æ‰§è¡Œå®Œäº‹åŠ¡é©¬ä¸Šç»™å®¢æˆ·ç«¯è¿”å›ï¼Œä»åº“å¼‚æ­¥è¿›è¡Œå¤åˆ¶æ“ä½œã€‚ æ€§èƒ½é«˜ æ•°æ®ä¸€è‡´æ€§ä½ åŒæ­¥å¤åˆ¶ ä¸»åº“æ‰§è¡Œå®Œäº‹åŠ¡ç­‰å¾…ä»åº“å¤åˆ¶å®Œçš„ä¿¡æ¯ï¼Œç„¶åå†ç»™å®¢æˆ·ç«¯è¿”å› æ•°æ®ä¸€è‡´æ€§é«˜ æ€§èƒ½è¾ƒå·®ï¼Œå»¶è¿Ÿå¤§ åŠåŒæ­¥å¤åˆ¶ ä¸»åº“æ‰§è¡Œå®Œäº‹åŠ¡ç­‰å¾…æŒ‡å®šä¸ªæ•°çš„ä»åº“å¤åˆ¶å®Œä¿¡æ¯ï¼Œç„¶åç»™å®¢æˆ·ç«¯è¿”å› æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½éƒ½å±…ä¸­ ä»æœ‰ä¸¢å¤±æ•°æ®çš„å¯èƒ½ ä¸‹é¢å›¾ç‰‡å°±æ˜¯åŠåŒæ­¥å¤åˆ¶/åŒæ­¥å¤åˆ¶çš„è¿‡ç¨‹ï¼ŒåŠåŒæ­¥å¤åˆ¶å¯ä»¥è®¾ç½®æ£€æŸ¥ä»åº“çš„ä¸ªæ•°\nã€ä»æ•°æ®åº“çš„å¹¶è¡Œå¤åˆ¶ã€‘\nä»æ•°æ®åº“é»˜è®¤æ˜¯æŒ‰ç…§é¡ºåºé€æ¡æ‰§è¡Œbinlogçš„æ—¥å¿—æŒ‡ä»¤(ä¹Ÿå°±æ˜¯é‡æ”¾relay log)ï¼Œä½†æ˜¯ä¸²è¡Œæ‰§è¡Œå¯èƒ½å¯¼è‡´ä»åº“çš„å¤åˆ¶æ•°æ®èµ¶ä¸ä¸Šä¸»åº“ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸‹é¢çš„å‡ ç§å¹¶è¡Œå¤åˆ¶æ¨¡å¼\nå¹¶è¡Œå¤åˆ¶æ¨¡å¼ ç‰¹ç‚¹ ä¼˜ç¼ºç‚¹ MySQL 5.6 åº“çº§åˆ«å¹¶è¡Œ å°†ä¸åŒæ•°æ®åº“db1å’Œdb2çš„äº‹åŠ¡åŒæ—¶åˆ†å¼€æ‰§è¡Œ äº‹åŠ¡éƒ½åœ¨åŒä¸€ä¸ªåº“æ—¶ï¼Œå¤±æ•ˆ MySQL 5.7 ç»„æäº¤äº‹åŠ¡ å°†ç»„æäº¤çš„äº‹åŠ¡å½“ä½œç‹¬ç«‹çš„äº‹åŠ¡ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ å¦‚æœäº‹åŠ¡çš„last_commitedç›¸åŒï¼Œåˆ™è¯´æ˜å†åŒä¸€ä¸ªç»„æäº¤çš„ï¼Œå³ä¾¿ä¸å†²çªï¼Œä¹Ÿä¸èƒ½å¹¶å‘æ‰§è¡Œ MySQL 5.7 é€»è¾‘æ—¶é’Ÿ ç»™prepareé˜¶æ®µçš„ä¸å­˜åœ¨é”å†²çªçš„äº‹åŠ¡æ‰“ä¸Šæ—¶é—´æ ‡è®°sequece_numberï¼Œåé¢ç›´æ¥æäº¤ sequence_numberå°±æ˜¯last_commitedï¼Œå‡å¦‚è¿™ä¸ªå€¼ç›¸åŒï¼Œä¸å†²çªï¼Œä¹Ÿä¸èƒ½å¹¶å‘ MySQL 8.0 WriteSet WriteSetå¯ä»¥é€šè¿‡å“ˆå¸Œç®—æ³•å¯¹ä¸»é”®ç”Ÿæˆæ ‡è¯†ï¼Œæ¥åˆ¤æ–­äº‹åŠ¡ä¹‹é—´æ˜¯å¦å†²çªï¼Œä¸å†²çªå°±å¯ä»¥å¹¶è¡Œå¤åˆ¶ å¯èƒ½å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ 33. å¦‚ä½•å¤„ç† MySQL çš„ä¸»ä»åŒæ­¥å»¶è¿Ÿï¼Ÿ é¦–å…ˆï¼ŒMySQLçš„ä¸»ä»åŒæ­¥æ˜¯ä¸€å®šå­˜åœ¨å»¶è¿Ÿçš„ã€‚ä¸»ä»åŒæ­¥å»¶è¿Ÿæ˜¯æŒ‡ä¸»åº“æ›´æ–°å®Œæˆä¹‹åï¼Œä»åº“è¿˜æ²¡æ¥å¾—åŠæ›´æ–°ï¼Œå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚è¿™ç§å»¶è¿Ÿå¯¹ä¸€äº›å®æ—¶æ•°æ®éœ€æ±‚é«˜çš„ä¸šåŠ¡åœºæ™¯(æ¯”å¦‚é‡‘èç³»ç»Ÿ)ä¼šé€ æˆå½±å“ã€‚\nã€ä¸ºä»€ä¹ˆæœ‰ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‘\nä»æ•´ä½“ä¸Šçœ‹ï¼Œæœ‰ä¸‹é¢ä¸¤ä¸ªåŸå› ï¼š\nrelay logèµ¶ä¸ä¸Šbinlog: ä»åº“æ¥å—binlogçš„é€Ÿåº¦è·Ÿä¸ä¸Šä¸»åº“å†™å…¥binlogçš„é€Ÿåº¦ï¼Œä»åº“çš„redo logå°±ä¼šæ¯”ä¸»åº“çš„binlogæ»å SQLæ‰§è¡Œèµ¶ä¸ä¸Šrelay log: ä»åº“SQLçº¿ç¨‹æ‰§è¡Œrelay logçš„é€Ÿåº¦æ¯”ä¸ä¸ŠI/Oçº¿ç¨‹æ¥å—binlogçš„é€Ÿåº¦ï¼Œå¯¼è‡´ä»åº“æ»årelay log å¯¼è‡´ä¸Šé¢ä¸¤ä¸ªæƒ…å†µå‘é€çš„åŸå› å¯èƒ½æ˜¯ï¼š\nä»åº“æ€§èƒ½ä¸è¶³ï¼šCPUã€å†…å­˜ã€ç£ç›˜I/Oæ¯”ä¸»åº“å·®ä¸€äº›ï¼ŒåŒæ­¥é€Ÿåº¦æ…¢ ä»åº“è¯»è¯·æ±‚å¤šï¼šè¦åˆ†é…ä¸€éƒ¨åˆ†èµ„æºå»æ»¡è¶³è¯»è¯·æ±‚ï¼Œå½±å“åŒæ­¥çš„æ•ˆç‡ ä¸»åº“æäº¤å¤ªå¤šå¤§äº‹åŠ¡ï¼šä»åº“å»åŒæ­¥ä¸€ä¸ªå¤§äº‹åŠ¡éœ€è¦è¾ƒé•¿çš„æ—¶é—´ ä»åº“æ•°é‡è¿‡å¤šï¼šä¸»åº“æ¨é€binlogå¼€é”€å¤§ï¼Œå¯¼è‡´å»¶è¿Ÿ ç½‘ç»œå»¶è¿Ÿï¼šä¸»åº“å’Œä»åº“ä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿæ¯”è¾ƒå¤§ï¼Œå¯¼è‡´åŒæ­¥é€Ÿåº¦å—é™åˆ¶ å¤åˆ¶æ¨¡å¼ï¼šé»˜è®¤é‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ¨¡å¼ï¼Œä¸»åº“ä¸ç­‰å¾…ä»åº“å®Œæˆå¤åˆ¶ï¼Œè‚¯å®šæœ‰å»¶è¿Ÿ ã€é¿å…å»¶è¿Ÿçš„æ–¹æ³•ã€‘\nå¼ºè¡ŒæŠŠå†™å…¥åçš„è¯»è¯·æ±‚äº¤ç»™ä¸»åº“å¤„ç† ï¼ˆä¸æ¨èï¼‰: æŠŠå†™å…¥åçš„è¯»è¯·æ±‚ç»™ä¸»åº“å¤„ç†ï¼Œå¯ä»¥é¿å…ä¸»ä»å»¶è¿Ÿï¼Œä½†æ˜¯ä¸»åº“æ‰¿å—çš„å‹åŠ›ä¹Ÿä¼šå¢å¤§\nç”¨åŠåŒæ­¥å¤åˆ¶ï¼šåŠåŒæ­¥å¤åˆ¶å¯ä»¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªä»åº“å¤åˆ¶å®Œæˆäº†\nSET GLOBAL rpl_semi_sync_master_enabled = 1; SET GLOBAL rpl_semi_sync_slave_enabled = 1; ä¼˜åŒ–ä¸»ä»ç»“æ„\næå‡ä»åº“æ€§èƒ½ï¼šé…å¥½ä¸€ç‚¹çš„CPUã€å†…å­˜ã€ç£ç›˜I/O å‡å°‘ä»åº“æ•°é‡ï¼šå‡å°‘ä¸»åº“çš„åŒæ­¥å¼€é”€ æ‹†åˆ†è¯»æµé‡ï¼šæŠŠè¯»è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªä»åº“ä¸Š sleepæ–¹æ¡ˆï¼šå‡è®¾ä¸»ä»åº“çš„å»¶è¿Ÿä¸º1sï¼Œå¯ä»¥æ¯æ¬¡æ‰§è¡Œä¸€ä¸ª select sleep(1)ï¼Œ ä¿è¯æ‹¿åˆ°æœ€æ–°çš„æ•°æ®ã€‚\n34. MySQLä¸­çš„é•¿äº‹åŠ¡å¯èƒ½ä¼šå¯¼è‡´å“ªäº›é—®é¢˜ï¼Ÿ é•¿æ—¶é—´çš„é”ç«äº‰ï¼Œé˜»å¡èµ„æºï¼šé•¿äº‹åŠ¡æŒæœ‰çš„é”æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå®¹æ˜“å¯¼è‡´å…¶ä»–äº‹åŠ¡å†è·å–ç›¸åŒé”çš„æ—¶å€™ï¼Œå‘é€é˜»å¡ï¼Œå¢åŠ ç³»ç»Ÿçš„ç­‰å¾…æ—¶é—´å’Œé™ä½å¹¶å‘æ€§èƒ½ã€‚ä¸šåŠ¡çº¿ç¨‹ä¼šå› ä¸ºé•¿æ—¶é—´çš„æ•°æ®åº“è¯·æ±‚è€Œè¢«é˜»å¡ï¼Œéƒ¨åˆ†ä¸šåŠ¡çš„é˜»å¡ä¼šå½±å“åˆ°å…¶ä»–çš„ä¸šåŠ¡ï¼Œå¯¼è‡´äº§ç”Ÿé›ªå´©ã€‚æœ€ç»ˆå¯èƒ½ä¼šè®©æœåŠ¡å…¨é¢å´©ç›˜ï¼Œå¯¼è‡´ä¸¥é‡çš„çº¿ä¸Šäº‹æ•…ã€‚ æ­»é”é£é™©ï¼šé•¿äº‹åŠ¡æ›´å®¹æ˜“äº§ç”Ÿæ­»é”ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªäº‹åŠ¡åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´ç³»ç»Ÿæ­»é”ã€‚ ä¸»ä»å»¶è¿Ÿï¼šé•¿äº‹åŠ¡å®¹æ˜“å¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼Œå› ä¸ºé•¿äº‹åŠ¡éœ€è¦ä¸»åº“èŠ±æ›´é•¿çš„æ—¶é—´æ‰§è¡Œï¼Œç„¶åé€šè¿‡binlogä¼ ç»™ä»åº“ã€‚ä»åº“è¯»å–relay logçš„æ—¶å€™ï¼Œé‡å‘æ“ä½œåˆéœ€è¦ä¸€é•¿æ®µæ—¶é—´ï¼Œå¯èƒ½å¯¼è‡´ä¸€å¤§æ®µæ—¶é—´æ•°æ®æ˜¯ä¸åŒæ­¥çš„ã€‚ å›æ»šå¯¼è‡´æ—¶é—´æµªè´¹ï¼šå¦‚æœäº‹åŠ¡æ‰§è¡Œäº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œçªç„¶æ‰§è¡Œå‡ºé”™ï¼Œéœ€è¦äº‹åŠ¡å›æ»šï¼Œä¹‹å‰çš„æ‰§è¡Œéƒ½æµªè´¹äº†ï¼Œè€—è´¹æ—¶é—´ã€‚ ç‰ˆæœ¬é“¾è¿‡é•¿ï¼šå‡å¦‚äº‹åŠ¡Aå¯¹æŸæ¡æ•°æ®æ‰§è¡Œäº†10000æ¬¡ä¿®æ”¹æ“ä½œï¼Œåœ¨æ²¡æœ‰æäº¤ä¹‹å‰ï¼Œäº‹åŠ¡Bè¿›è¡Œselect æ“ä½œï¼Œä¼šéœ€è¦è€—è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚ ã€é•¿äº‹åŠ¡çš„SQLå¦‚ä½•å¤„ç†ã€‘\næ‹†åˆ†é•¿äº‹åŠ¡SQL: æŠŠå•æ¡SQLæ‹†åˆ†ä¸ºå¤šæ¡çŸ­äº‹åŠ¡SQL\n# å‡å¦‚éœ€è¦åˆ é™¤2021å¹´çš„æ•°æ®(4.8äº¿æ¡)ï¼Œå…±5äº¿æ¡æ•°æ® delete from yes where create_date \u0026gt; \u0026#34; 2020-12-31\u0026#34; and create_date \u0026lt; \u0026#34;2022-01-01\u0026#34;; # æŒ‰ç…§æ—¥æœŸè¿›è¡Œæ‹†åˆ†æˆå¤šæ¡äº‹åŠ¡ delete from yes where create_date \u0026gt; \u0026#34; 2020-12-31\u0026#34; and create_date \u0026lt; \u0026#34;2021-02-01\u0026#34;; .... delete from yes where create_date \u0026gt; \u0026#34; 2021-11-31\u0026#34; and create_date \u0026lt; \u0026#34;2022-01-01\u0026#34;; åå‘æ“ä½œå‡è½»äº‹åŠ¡æ—¶é—´ï¼šæŠŠéœ€è¦æ—§è¡¨åˆ é™¤çš„æ•°æ®è½¬æˆæ–°å¢åˆ°æ–°çš„è¡¨ï¼Œç„¶åç”¨æ–°è¡¨æ›¿æ¢æ—§è¡¨å°±å¯ä»¥äº†ã€‚\n","permalink":"https://swimmingliu.cn/posts/job/mysql-interview-questions/","summary":"\u003ch2 id=\"1mysql-ä¸­çš„æ•°æ®æ’åºæ˜¯æ€ä¹ˆå®ç°çš„\"\u003e1.MySQL ä¸­çš„æ•°æ®æ’åºæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e1.\u003cstrong\u003eæ’åºæ–¹æ³•\u003c/strong\u003eï¼šç´¢å¼•æ’åºå’Œæ–‡ä»¶æ’åº (filesort)\u003c/p\u003e\n\u003cp\u003e2.\u003cstrong\u003eç´¢å¼•æ’åº\u003c/strong\u003eï¼šå¦‚æœ\u003ccode\u003eorder by xxx\u003c/code\u003eçš„å­—æ®µä¸ºç´¢å¼•å­—æ®µï¼Œåˆ™åˆ©ç”¨ç´¢å¼•è¿›è¡Œæ’åºã€‚æ•ˆç‡æœ€é«˜ï¼Œç´¢å¼•é»˜è®¤æœ‰åºã€‚\u003c/p\u003e\n\u003cp\u003e3.\u003cstrong\u003eæ–‡ä»¶æ’åº (filesort)\u003c/strong\u003eï¼šå†…å­˜æ’åº(å•è·¯æ’åºå’ŒåŒè·¯æ’åº)å’Œç£ç›˜æ’åºï¼Œå…·ä½“å–å†³äºæ’åºæ•°æ®çš„å¤§å°ã€‚å…¶ä¸­ï¼Œå†…å­˜æ’åºä½¿ç”¨å•è·¯æ’åºæˆ–åŒè·¯æ’åºï¼Œå–å†³äº\u003ccode\u003emax_length_for_sort_data\u003c/code\u003e(é»˜è®¤ä¸º4096ä¸ªå­—èŠ‚)\u003c/p\u003e\n\u003cp\u003e4.\u003cstrong\u003eåŒè·¯æ’åº\u003c/strong\u003eï¼šå–\u003ccode\u003erow_id\u003c/code\u003e(å¦‚æœæœ‰ä¸»é”®ï¼Œåˆ™ä¸ºä¸»é”®)å’Œ\u003ccode\u003eselect a,b,c order by xxx\u003c/code\u003eçš„\u003ccode\u003exxx\u003c/code\u003eå­—æ®µæ”¾å…¥\u003ccode\u003esort_buffer\u003c/code\u003e(æ’åºç¼“å­˜)ä¸­ï¼Œå°†æ’åºåçš„\u003ccode\u003erow_id\u003c/code\u003eå›è¡¨æŸ¥è¯¢\u003ccode\u003ea,b,c\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e5.\u003cstrong\u003eå•è·¯æ’åº\u003c/strong\u003e: ç›´æ¥æŠŠè¦æŸ¥çš„æ‰€æœ‰å­—æ®µæ”¾å…¥\u003ccode\u003esort_buffer\u003c/code\u003eé‡Œï¼Œæ’åºåç›´æ¥å¾—åˆ°ç»“æœé›†åˆ\u003c/p\u003e\n\u003cp\u003e6.\u003cstrong\u003eç£ç›˜æ’åº\u003c/strong\u003eï¼ˆå½’å¹¶æ’åºï¼‰:å°†æ•°æ®åˆ†ä¸ºå¤šä»½æ–‡ä»¶ï¼Œå•ç‹¬å¯¹æ–‡ä»¶è¿›è¡Œæ’åºï¼Œç„¶ååˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶\u003c/p\u003e\n\u003ch2 id=\"2-mysql-çš„-change-buffer-æ˜¯ä»€ä¹ˆå®ƒæœ‰ä»€ä¹ˆä½œç”¨\"\u003e2. MySQL çš„ Change Buffer æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\u003c/h2\u003e\n\u003cp\u003e1.ChangeBufferå®šä¹‰ï¼šChange Bufferæ˜¯InnoDBç¼“å†²å½“ä¸­çš„ä¸€å—ç¼“å­˜åŒºï¼Œç”¨äºæš‚å­˜äºŒçº§ç´¢å¼•çš„ä¿®æ”¹ï¼Œé¿å…äºŒçº§ç´¢å¼•é¡µä¿®æ”¹äº§ç”Ÿçš„éšæœºIO\n2.ChangeBufferæ³¨æ„äº‹é¡¹ï¼šåªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ï¼Œä¸èƒ½ç”¨äºå…¶ä»–ä»»ä½•ç´¢å¼•ï¼ŒåŒ…æ‹¬ä¸»é”®ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•éƒ½ä¸è¡Œã€‚\n3.å¦‚æœChangeBufferæŒ‚äº†ï¼Œæ›´æ”¹æ“ä½œæœªæ‰§è¡Œï¼Œæ˜¯å¦ä¼šå‡ºç°è„æ•°æ®ï¼Ÿ\né¦–å…ˆï¼ŒChangeBufferä¹Ÿä¼šä¿å­˜åœ¨ç£ç›˜ç©ºé—´é‡Œé¢ï¼Œredo logä¼šè®°å½•Change Bufferå½“ä¸­çš„ä¿®æ”¹æ“ä½œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚\u003c/p\u003e\n\u003cp\u003eçŸ¥è¯†æ‹“å±•1ï¼šä¸€çº§ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•åŒºåˆ«\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eä¸€çº§ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰\u003c/strong\u003eï¼šæ•°æ®è¡¨çš„ä¸»é”®ç´¢å¼•ï¼Œæ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨åŒä¸€B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸€çº§ç´¢å¼•ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eäºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰\u003c/strong\u003eï¼šé™¤ä¸»é”®å¤–çš„å…¶ä»–ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡äºŒçº§ç´¢å¼•è·å–ä¸»é”®å€¼ï¼Œå†é€šè¿‡ä¸»é”®å€¼æŸ¥è¯¢æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œå›è¡¨â€ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eçŸ¥è¯†æ‹“å±•2:  MySQLä¸­æœ‰å“ªäº›å¸¸è§ç´¢å¼•ï¼Ÿéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨MySQLä¸­ï¼Œç´¢å¼•æ˜¯æé«˜æŸ¥è¯¢æ•ˆç‡çš„å…³é”®å·¥å…·ã€‚å¸¸è§çš„ç´¢å¼•ç±»å‹åŒ…æ‹¬ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. ä¸»é”®ç´¢å¼•ï¼ˆPrimary Key Indexï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä¸”ä¸»é”®åˆ—çš„å€¼ä¸èƒ½ä¸ºç©ºã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç‰¹ç‚¹\u003c/strong\u003eï¼šä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„æ•°æ®è¡Œï¼Œå› æ­¤æŸ¥è¯¢æ•ˆç‡é«˜ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆå¹¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e2. å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šå”¯ä¸€ç´¢å¼•ç¡®ä¿ç´¢å¼•åˆ—çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚ä¸ä¸»é”®ç´¢å¼•ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå”¯ä¸€ç´¢å¼•å…è®¸åˆ—å€¼ä¸ºNULLã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç‰¹ç‚¹\u003c/strong\u003eï¼šå”¯ä¸€ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚åœ¨InnoDBä¸­ï¼Œå”¯ä¸€ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e3. æ™®é€šç´¢å¼•ï¼ˆIndexï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šæ™®é€šç´¢å¼•æ˜¯æœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚ç´¢å¼•åˆ—çš„å€¼å¯ä»¥é‡å¤ï¼Œä¹Ÿå¯ä»¥ä¸ºNULLã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç‰¹ç‚¹\u003c/strong\u003eï¼šæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’Œå¯¹åº”çš„ä¸»é”®å€¼ã€‚åœ¨InnoDBä¸­ï¼Œæ™®é€šç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e4. å…¨æ–‡ç´¢å¼•ï¼ˆFulltext Indexï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šå…¨æ–‡ç´¢å¼•ç”¨äºå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œå…¨æ–‡æœç´¢ï¼Œé€‚ç”¨äºMyISAMå­˜å‚¨å¼•æ“ã€‚å®ƒå…è®¸å¯¹æ–‡æœ¬å­—æ®µè¿›è¡Œå¤æ‚çš„æœç´¢ï¼Œå¦‚æŸ¥æ‰¾åŒ…å«ç‰¹å®šå•è¯çš„è®°å½•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç‰¹ç‚¹\u003c/strong\u003eï¼šå…¨æ–‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨æ–‡æ¡£çš„è¯é¡¹ä¿¡æ¯ã€‚åœ¨MyISAMä¸­ï¼Œå…¨æ–‡ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e5. ç©ºé—´ç´¢å¼•ï¼ˆSpatial Indexï¼‰\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå®šä¹‰\u003c/strong\u003eï¼šç©ºé—´ç´¢å¼•ç”¨äºå¯¹åœ°ç†ç©ºé—´æ•°æ®è¿›è¡Œç´¢å¼•ï¼Œæ”¯æŒç©ºé—´æ•°æ®ç±»å‹çš„å¿«é€ŸæŸ¥è¯¢ã€‚å®ƒé€‚ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ã€åœ°å›¾ç­‰ç©ºé—´æ•°æ®çš„è¡¨ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç‰¹ç‚¹\u003c/strong\u003eï¼šç©ºé—´ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç©ºé—´æ•°æ®çš„ç´¢å¼•ä¿¡æ¯ã€‚åœ¨MyISAMä¸­ï¼Œç©ºé—´ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨ä¸ç´¢å¼•ç»“æ„åˆ†å¼€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eæ€»ç»“\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eä¸»é”®ç´¢å¼•\u003c/strong\u003eï¼šç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸€è¡Œæ•°æ®ï¼Œå€¼ä¸èƒ½ä¸ºç©ºã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå”¯ä¸€ç´¢å¼•\u003c/strong\u003eï¼šç¡®ä¿ç´¢å¼•åˆ—çš„å€¼å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ™®é€šç´¢å¼•\u003c/strong\u003eï¼šæœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œå…è®¸é‡å¤å’Œç©ºå€¼ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå…¨æ–‡ç´¢å¼•\u003c/strong\u003eï¼šç”¨äºå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œå…¨æ–‡æœç´¢ï¼Œé€‚ç”¨äºMyISAMå­˜å‚¨å¼•æ“ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç©ºé—´ç´¢å¼•\u003c/strong\u003eï¼šç”¨äºå¯¹åœ°ç†ç©ºé—´æ•°æ®è¿›è¡Œç´¢å¼•ï¼Œæ”¯æŒç©ºé—´æ•°æ®ç±»å‹çš„å¿«é€ŸæŸ¥è¯¢ã€‚\u003c/li\u003e\n\u003c/ul\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"3-è¯¦ç»†æè¿°ä¸€æ¡-sql-è¯­å¥åœ¨-mysql-ä¸­çš„æ‰§è¡Œè¿‡ç¨‹\"\u003e3. è¯¦ç»†æè¿°ä¸€æ¡ SQL è¯­å¥åœ¨ MySQL ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ã€‚\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eè¿æ¥å™¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æˆåŠŸå»ºç«‹è¿æ¥ï¼Œæ•°æ®åº“è¿æ¥çš„æƒé™æ ¡éªŒ\u003c/li\u003e\n\u003cli\u003eè¿æ¥å™¨ä¼šæŸ¥è¯¢ç¼“å­˜ï¼Œ\u003ccode\u003ekey\u003c/code\u003e æ˜¯ SQL è¯­å¥ï¼Œ\u003ccode\u003evalue\u003c/code\u003e æ˜¯æŸ¥è¯¢ç»“æœã€‚å¦‚æœå‘½ä¸­ï¼Œç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœã€‚(MySQL 8.0ä¹‹åï¼Œå°±ç§»é™¤è¿™ä¸ªåŠŸèƒ½äº†)ã€‚\u003c/li\u003e\n\u003cli\u003eåˆ†æå™¨åˆ†æSQLè¯­æ³•å’Œè¯æ³•æ˜¯å¦æœ‰è¯¯\u003c/li\u003e\n\u003cli\u003eä¼˜åŒ–å™¨ç”ŸæˆSQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œç¡®å®šä½¿ç”¨çš„ç´¢å¼•å’Œè°ƒæ•´whereçš„æ‰§è¡Œé¡ºåºï¼ˆåŒ…æ‹¬è¿è¡¨é¡ºåºï¼‰\u003c/li\u003e\n\u003cli\u003eæ‰§è¡Œå™¨åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æŸ¥è¯¢è¯¥è¡¨ï¼Œç„¶åæ‰§è¡Œè¯¥SQLè¯­å¥\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg alt=\"MySQLæ¶æ„å›¾\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/7457976c-ef5d-11ef-b738-c858c0c1deba\"\u003e\u003c/p\u003e","title":"MySQLé¢è¯•é¢˜ç¬”è®°"},{"content":"== å’Œ equals åŒºåˆ« == åŸºæœ¬ç±»å‹(int, long, float, char, boolean) å€¼æ¯”è¾ƒï¼Œ å¼•ç”¨ç±»å‹(Stringï¼ŒList) è¿›è¡Œåœ°å€æ¯”è¾ƒ\nequals é»˜è®¤å°±æ˜¯ == ï¼Œä½†æ˜¯éƒ¨åˆ†å¼•ç”¨ç±»å‹(Stringï¼ŒList)é‡å†™äº†è¯¥æ–¹æ³•ï¼Œè¿›è¡Œå€¼æ¯”è¾ƒ\nget å’Œ post åŒºåˆ« ç‰¹æ€§ GET POST ç›®çš„ è·å–èµ„æºï¼ŒæŸ¥è¯¢æ•°æ® æäº¤æ•°æ®ï¼Œåˆ›å»ºæˆ–æ›´æ–°èµ„æº è¯·æ±‚æ•°æ®æ–¹å¼ å‚æ•°é€šè¿‡ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’ æ•°æ®é€šè¿‡è¯·æ±‚ä½“ä¼ é€’ æ•°æ®æš´éœ² æ•°æ®æš´éœ²åœ¨ URL ä¸­ï¼Œè¾ƒä¸å®‰å…¨ æ•°æ®å­˜å‚¨åœ¨è¯·æ±‚ä½“ä¸­ï¼Œç›¸å¯¹å®‰å…¨ æ•°æ®å¤§å°é™åˆ¶ URL é•¿åº¦æœ‰é™åˆ¶ï¼ˆçº¦ 2048 ä¸ªå­—ç¬¦ï¼‰ æ²¡æœ‰æ•°æ®å¤§å°é™åˆ¶ é€‚ç”¨åœºæ™¯ è·å–æ•°æ®ï¼ŒæŸ¥è¯¢ï¼Œå±•ç¤ºèµ„æº æäº¤è¡¨å•ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹èµ„æºï¼Œå‘é€æ•æ„Ÿæ•°æ®ç­‰ SpringMVCä¸­@ReponseBodyã€@PathVariableã€@RequestParametersåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨? @ReponseBody ç”¨äºæ¥å—è¯·æ±‚ä½“æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºPOSTè¯·æ±‚\n@PathVariable ç”¨äºæ¥å—è·¯å¾„å‚æ•°ï¼Œä¸€èˆ¬ç”¨æˆ·æ¥å— id\n@RequestParameters ç”¨äºæ¥å—è¯·æ±‚å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºGETè¯·æ±‚\nJVMå †çš„ç»“æ„ã€GCä»‹ç»å’Œä½œç”¨ JVMå †ç»“æ„çš„å‚è€ƒæ–‡ç«  ã€ GCåƒåœ¾å›æ”¶è¿‡ç¨‹\nåŒºåŸŸ ä¸»è¦ç”¨é€” ç‰¹ç‚¹ æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰ å­˜å‚¨æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¿«é€Ÿåƒåœ¾å›æ”¶ åŒ…å« Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•è¿›è¡Œå›æ”¶ è€å¹´ä»£ï¼ˆOld Generationï¼‰ å­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡ å›æ”¶é¢‘ç‡è¾ƒä½ï¼Œåƒåœ¾å›æ”¶è¾ƒè€—æ—¶ æ°¸ä¹…ä»£ï¼ˆPermanent Generation) (jdk 1.7ï¼‰ å­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€æ–¹æ³•å­—èŠ‚ç ç­‰ åœ¨ jdk 1.8 è¢« Metaspace æ›¿ä»£ å…ƒç©ºé—´ï¼ˆjdk 1.8ï¼‰ å­˜å‚¨ç±»çš„å…ƒæ•°æ® ä¸å†å±äºå †ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå¤§å°ç”±ç³»ç»Ÿé™åˆ¶ GC æ˜¯åƒåœ¾å›æ”¶å™¨ï¼Œ ä½œç”¨æ˜¯è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œé¿å…å†…å­˜æ³„æ¼\nInnodbå’ŒMYISAMçš„ç‰¹ç‚¹ InnoDB å’Œ MyISAM æ˜¯ MySQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­çš„ä¸¤ç§ä¸»è¦å­˜å‚¨å¼•æ“ã€‚ InnoDB æ˜¯ MySQL 5.5 ç‰ˆæœ¬çš„é»˜è®¤å¼•æ“ã€‚\nç‰¹æ€§ InnoDB MyISAM äº‹åŠ¡æ”¯æŒ æ”¯æŒäº‹åŠ¡ï¼ˆACIDï¼‰ï¼Œæä¾› COMMIT, ROLLBACK, SAVEPOINT ç­‰è¯­å¥ ä¸æ”¯æŒäº‹åŠ¡ å­˜å‚¨æ–¹å¼ è¡Œçº§é”ï¼ˆRow-level lockingï¼‰ è¡¨çº§é”ï¼ˆTable-level lockingï¼‰ æ”¯æŒå¤–é”® æ”¯æŒå¤–é”®çº¦æŸï¼ˆForeign Keyï¼‰ ä¸æ”¯æŒå¤–é”®çº¦æŸ å´©æºƒæ¢å¤ æ”¯æŒå´©æºƒæ¢å¤ï¼Œè‡ªåŠ¨æ¢å¤åˆ°ä¸€è‡´æ€§çŠ¶æ€ ä¸æ”¯æŒå´©æºƒæ¢å¤ï¼Œæ•°æ®å¯èƒ½ä¼šä¸¢å¤± æ€§èƒ½ç‰¹ç‚¹ é€‚åˆé«˜å¹¶å‘è¯»å†™çš„åº”ç”¨ï¼Œæ€§èƒ½è¾ƒæ…¢ï¼ˆå› ä¸ºä½¿ç”¨è¡Œçº§é”ï¼‰ é€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨ï¼Œæ€§èƒ½è¾ƒå¿«ï¼ˆå› ä¸ºä½¿ç”¨è¡¨çº§é”ï¼‰ æ•°æ®å®Œæ•´æ€§ æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§å¼ºï¼Œæ”¯æŒåŸå­æ€§æ“ä½œ ä¸æ”¯æŒæ•°æ®å®Œæ•´æ€§ï¼Œå®¹æ˜“å‡ºç°æ•°æ®ä¸ä¸€è‡´ ç¼“å­˜æœºåˆ¶ ä½¿ç”¨å†…å­˜ç¼“å†²æ± æ¥æé«˜æ€§èƒ½ ä½¿ç”¨å†…å­˜ç¼“å­˜æé«˜æŸ¥è¯¢é€Ÿåº¦ é€‚ç”¨åœºæ™¯ é«˜å¹¶å‘ã€éœ€è¦äº‹åŠ¡å’Œæ•°æ®ä¸€è‡´æ€§çš„åº”ç”¨ï¼Œå¦‚é‡‘èã€é“¶è¡Œç­‰ è¯»å¤šå†™å°‘ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒä½çš„åº”ç”¨ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ•°æ®ä»“åº“ç­‰ è¡Œçº§é”ï¼ˆRow Lockï¼‰ï¼šInnoDBä½¿ç”¨è¡Œçº§é”ï¼Œé¿å…äº†å¯¹æ•´å¼ è¡¨åŠ é”çš„æ€§èƒ½é—®é¢˜ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®ä¸åŒçš„è¡Œã€‚\nè¡¨çº§é”ï¼ˆTable Lockï¼‰ï¼šMySQLä½¿ç”¨è¡¨çº§é”æ—¶ï¼Œæ•´ä¸ªè¡¨ä¼šè¢«é”å®šï¼Œå¯¼è‡´å…¶ä»–äº‹åŠ¡æ— æ³•è®¿é—®è¡¨ä¸­çš„ä»»ä½•è¡Œï¼Œæ€§èƒ½è¾ƒä½ã€‚\næ„å‘é”ï¼ˆIntention Lockï¼‰ï¼šè¡Œé”å’Œè¡¨é”ä¹‹é—´çš„ä¸€ç§é”ï¼ŒInnoDBç”¨æ¥å¤„ç†è¡Œé”å’Œè¡¨é”ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚\nå¦‚ä½•ç†è§£æ•°æ®åº“ä¸­çš„MVCCåŸç†? MVCCåŸç†è§£æ\nè„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»åŒºåˆ« å¿«é€Ÿç†è§£è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»å’ŒMVCC\nMySQLäº‹åŠ¡ äº‹åŠ¡ç‰¹æ€§ (AIDC) åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚MySQLä¼šä¿è¯å³ä½¿å‘ç”Ÿå´©æºƒæˆ–ä¸­æ–­ï¼Œæœªæäº¤çš„äº‹åŠ¡ä¼šè¢«å›æ»šã€‚\néš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šäº‹åŠ¡çš„æ‰§è¡Œä¸åº”è¯¥è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚éš”ç¦»çº§åˆ«æ§åˆ¶äº†äº‹åŠ¡ä¹‹é—´çš„â€œå¯è§æ€§â€ã€‚\næŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå˜æ›´å°†æ°¸ä¹…ä¿å­˜ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¿…é¡»è®©æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚\näº‹åŠ¡çš„éš”ç¦»çº§åˆ« è¯»æœªæäº¤ï¼šäº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´è„è¯»ã€‚\nè¯»å·²æäº¤ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²æäº¤çš„äº‹åŠ¡æ•°æ®ï¼Œé¿å…äº†è„è¯»ï¼Œä½†ä»ç„¶å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»ã€‚\nå¯é‡å¤è¯»ï¼šäº‹åŠ¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…è¯»å–çš„æ•°æ®å§‹ç»ˆä¸€è‡´ï¼Œé¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚å¯èƒ½ä¼šå‡ºç°å¹»è¯»ã€‚\nä¸²è¡ŒåŒ–ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡å¼ºåˆ¶ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚ä½†æ€§èƒ½å·®ï¼Œå®¹æ˜“äº§ç”Ÿèµ„æºç“¶é¢ˆã€‚\nå¦‚ä½•ä¼˜åŒ–æ•°æ®åº“ SQLä¼˜åŒ– 1.**é¿å…ä½¿ç”¨ select ***\n2.ç´¢å¼•ä¼˜åŒ–\nç´¢å¼•ä½¿ç”¨ï¼šåˆ›å»ºé€‚å½“çš„ç´¢å¼•ï¼Œå°¤å…¶æ˜¯å¸¸ç”¨äº WHEREã€ORDER BYã€JOINã€GROUP BY ä¸­çš„å­—æ®µã€‚\nè¦†ç›–ç´¢å¼•ï¼šå°½é‡è®©æŸ¥è¯¢å¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›ç»“æœï¼Œé¿å…å›è¡¨ã€‚\né¿å…è¿‡å¤šçš„ç´¢å¼•ï¼šç´¢å¼•è™½èƒ½åŠ é€ŸæŸ¥è¯¢ï¼Œä½†ä¹Ÿä¼šå¢åŠ æ’å…¥ã€æ›´æ–°çš„æˆæœ¬ã€‚\nè”åˆç´¢å¼•ï¼šå¯¹äºå¤šä¸ªå­—æ®µå¸¸ä¸€èµ·æŸ¥è¯¢çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘åˆ›å»ºè”åˆç´¢å¼•ã€‚\n3.é¿å…å…¨è¡¨æ‰«æ\nä½¿ç”¨ EXPLAIN æ¥åˆ†æSQLæ‰§è¡Œè®¡åˆ’ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…¨è¡¨æ‰«æï¼Œå¹¶ä¼˜åŒ–æŸ¥è¯¢ã€‚\nç¤ºä¾‹ï¼šEXPLAIN SELECT * FROM orders WHERE user_id = ? å¯ä»¥æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€‚\næ•°æ®åº“æ¶æ„ä¼˜åŒ– 1.åˆ†åº“åˆ†è¡¨ï¼š\nå½“æ•°æ®é‡éå¸¸å¤§æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ†åº“åˆ†è¡¨æ¥æé«˜æŸ¥è¯¢å’Œæ’å…¥çš„æ•ˆç‡ã€‚ ä¾‹å¦‚ï¼šæŒ‰æ—¶é—´èŒƒå›´ã€IDèŒƒå›´æˆ–ä¸šåŠ¡ç»´åº¦è¿›è¡Œæ°´å¹³åˆ†è¡¨ï¼ŒæŒ‰ä¸šåŠ¡æ¨¡å—è¿›è¡Œå‚ç›´åˆ†åº“ã€‚ 2.è¯»å†™åˆ†ç¦» (Redis)ï¼š\nä½¿ç”¨ä¸»ä»å¤åˆ¶ï¼Œä¸»åº“å¤„ç†å†™æ“ä½œï¼Œä»åº“å¤„ç†è¯»æ“ä½œï¼Œå‡è½»ä¸»åº“å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ ç¤ºä¾‹ï¼šä¸»åº“æ‰§è¡Œ INSERTã€UPDATEã€DELETEï¼Œä»åº“æ‰§è¡Œ SELECTã€‚ (ç°åœ¨ç”¨Redisç”¨æ¥ç¬¬ä¸€æ­¥åˆ¤æ–­ï¼Œæ•°æ®åº“åæ“ä½œ) 3.æ•°æ®åº“å†—ä½™ä¸å¤‡ä»½ï¼š\nå¢åŠ æ•°æ®åº“çš„å†—ä½™å‰¯æœ¬ï¼Œå®šæœŸè¿›è¡Œå¤‡ä»½ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§ã€‚ ç¼“å­˜ä¼˜åŒ– 1.ä½¿ç”¨ç¼“å­˜æ¥å‡è½»æ•°æ®åº“å‹åŠ›ï¼šå¯¹é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆå¦‚ä½¿ç”¨ Redisï¼‰ï¼Œæ¯”å¦‚çƒ­é—¨å•†å“ä¿¡æ¯ã€‚\n2.åˆç†çš„ç¼“å­˜ç­–ç•¥ï¼š\nç¼“å­˜ç©¿é€ : Redis å’Œ æ•°æ®åº“éƒ½ä¸å­˜åœ¨ï¼Œç”¨ç©ºå¯¹è±¡ç¼“å­˜åˆ°Redis\nç¼“å­˜é›ªå´© :\nå¤§é‡keyåŒæ—¶è¿‡æœŸï¼šè®¾ç½®éšæœºçš„TLL\nRedisæœåŠ¡å®•æœº : è®¾ç½®Redisé›†ç¾¤ + å“¨å…µæ¨¡å¼ / ç¼“å­˜ä¸šåŠ¡é™çº§é™æµ / ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜\nç¼“å­˜å‡»ç©¿ï¼šRedisçš„çƒ­ç‚¹Keyè¿‡æœŸï¼Œäº’æ–¥é” / é€»è¾‘è¿‡æœŸ\n3.é¿å…ç¼“å­˜ä¸ä¸€è‡´ï¼šä½¿ç”¨åŒå†™ç­–ç•¥ï¼ˆæ›´æ–°æ•°æ®åº“åŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰ï¼Œæˆ–é€šè¿‡å¼‚æ­¥æ›´æ–°ç¼“å­˜æ¥é¿å…ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ã€‚\næ•°æ®åº“è¿æ¥æ±  ä½¿ç”¨è¿æ¥æ± ï¼ˆå¦‚ HikariCPã€Druidï¼‰å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘æ•°æ®åº“è¿æ¥çš„å¼€é”€ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥ã€‚\næ•°æ®åº“å¹¶å‘æ§åˆ¶ 1.äº‹åŠ¡ä¸é”æœºåˆ¶ä¼˜åŒ–\né€šè¿‡åˆç†çš„äº‹åŠ¡ç®¡ç†å’Œé”ç­–ç•¥ï¼Œé¿å…æ­»é”å’Œæ€§èƒ½ç“¶é¢ˆã€‚ æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰é”ï¼Œå‡å°‘é”ç«äº‰ã€‚ 2.ä¹è§‚é”ä¸æ‚²è§‚é”ï¼š\nåœ¨é€‚å½“çš„åœºæ™¯ä¸‹ä½¿ç”¨ä¹è§‚é”ï¼ˆå¦‚ä½¿ç”¨ç‰ˆæœ¬å·ï¼‰ï¼Œé¿å…å¯¹æ•°æ®åŠ é”ã€‚ åœ¨é«˜å¹¶å‘ä¸‹ï¼Œä½¿ç”¨æ‚²è§‚é”ï¼ˆå¦‚æ•°æ®åº“è¡Œçº§é”ã€æ‚²è§‚é”ï¼‰ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚ Redisä¸€ä¸»ä¸¤ä»+å“¨å…µæ¨¡å¼ Redis é‡‡ç”¨ä¸€ä¸»ä¸¤ä»+å“¨å…µçš„é›†ç¾¤æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨é«˜å¹¶å‘å’Œé«˜å¯ç”¨çš„åœºæ™¯ä¸‹ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ä¸»èŠ‚ç‚¹(master)å¤„ç†å†™è¯·æ±‚ï¼Œä»èŠ‚ç‚¹(slave1 å’Œ slave2)å¤„ç†è¯»è¯·æ±‚ï¼Œå‡å°‘ä¸»èŠ‚ç‚¹çš„å‹åŠ›ï¼›å“¨å…µæœºåˆ¶ç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œç¡®ä¿ Redis é›†ç¾¤åœ¨èŠ‚ç‚¹æ•…éšœæ—¶çš„é«˜å¯ç”¨æ€§ã€‚\næ™®é€šçš„ä¸»ä»æ¨¡å¼ï¼Œå½“ä¸»æ•°æ®åº“å´©æºƒæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡æ¢ä»æ•°æ®åº“æˆä¸ºä¸»æ•°æ®åº“ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹äº‹è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ï¼Œå³å­˜åœ¨é«˜å¯ç”¨é—®é¢˜ã€‚æˆ‘ä»¬åˆä½¿ç”¨äº†å“¨å…µã€‚å“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚å…¶åŸç†æ˜¯å“¨å…µé€šè¿‡å‘é€pingå‘½ä»¤ï¼Œç­‰å¾…RedisæœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ªRediså®ä¾‹ã€‚å“¨å…µå¯ä»¥å®ç°è‡ªåŠ¨æ•…éšœä¿®å¤ï¼Œå½“å“¨å…µç›‘æµ‹åˆ°masterå®•æœºï¼Œä¼šè‡ªåŠ¨å°†slaveåˆ‡æ¢æˆmasterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢masterã€‚åŒæ—¶é‚£å°æœ‰é—®é¢˜çš„æ—§ä¸»èŠ‚ç‚¹ä¹Ÿä¼šå˜ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æ—§çš„ä¸»å³ä½¿æ¢å¤æ—¶ï¼Œå¹¶ä¸ä¼šæ¢å¤åŸæ¥çš„ä¸»èº«ä»½ï¼Œè€Œæ˜¯ä½œä¸ºæ–°ä¸»çš„ä¸€ä¸ªä»ã€‚\nOAuth2.0 / å•ç‚¹ç™»å½• (SSO) OAuth2.0 ä»‹ç»ã€å•ç‚¹ç™»å½•SSOä»‹ç»\nå¦‚ä½•é˜²æ³¨å…¥æ”»å‡»ï¼Ÿ 1.ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆMybatisï¼‰ï¼š å°† SQL è¯­å¥ä¸å‚æ•°åˆ†ç¦»ï¼Œé˜²æ­¢æ¶æ„è¾“å…¥è¢«è§£é‡Šä¸ºä»£ç \n2.æœ€å°æƒé™åŸåˆ™: ä¸ºæŒ‡å®šæ•°æ®åº“ç”¨æˆ·åˆ†é…æœ€å°å¿…è¦çš„æƒé™ï¼Œé™åˆ¶å…¶åªèƒ½æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œå‡å°‘æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚\n3.é¿å…åŠ¨æ€æ‹¼æ¥SQL ( XMLé‡Œé¢ # å’Œ $ åŒºåˆ«): ä½¿ç”¨#ï¼Œè€Œä¸ç”¨ $ é˜²æ­¢ç›´æ¥æ‹¼æ¥\nå¦‚ä½•è®¾è®¡è¡¨çš„æ˜ å°„å…³ç³» æœ‰ä¸€ä¸ªè®¢å•è¡¨ï¼Œä¸€ä¸ªäº§å“è¡¨ï¼Œä¸€ä¸ªäº§å“è®¢å•è¡¨\nè®¢å•è¡¨ï¼ˆOrderï¼‰ï¼šå­˜å‚¨è®¢å•çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚è®¢å•IDã€ç”¨æˆ·IDã€è®¢å•æ—¥æœŸã€è®¢å•çŠ¶æ€ç­‰ã€‚\näº§å“è¡¨ï¼ˆProductï¼‰ï¼šå­˜å‚¨äº§å“çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚äº§å“IDã€äº§å“åç§°ã€äº§å“ä»·æ ¼ã€åº“å­˜æ•°é‡ç­‰ã€‚\nè®¢å•é¡¹è¡¨ï¼ˆOrder_Itemï¼‰ï¼šç”¨äºè¡¨ç¤ºè®¢å•ä¸äº§å“ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ï¼Œè®°å½•æ¯ä¸ªè®¢å•ä¸­åŒ…å«çš„äº§å“åŠå…¶æ•°é‡ã€ä»·æ ¼ç­‰ä¿¡æ¯ã€‚\nå“ªäº›è¡¨éœ€è¦åŠ ç´¢å¼•ï¼Ÿå¯¹å“ªäº›å­—æ®µåŠ ç´¢å¼•? éœ€è¦ç´¢å¼•çš„è¡¨ å¯¹äºè®°å½•æ•°è¾ƒå¤šçš„è¡¨ï¼Œå»ºç«‹ç´¢å¼•å¯ä»¥æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ã€‚\néœ€è¦åŠ ç´¢å¼•çš„å­—æ®µ 1.ä¸»é”®å­—æ®µï¼šä¸»é”®å­—æ®µé»˜è®¤å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œç¡®ä¿è®°å½•çš„å”¯ä¸€æ€§å’Œå¿«é€Ÿå®šä½ã€‚\n2.ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼šåœ¨ WHERE å­å¥ä¸­é¢‘ç¹å‡ºç°çš„å­—æ®µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§è¡¨ä¸­ï¼Œåº”å»ºç«‹ç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚\n3.ç”¨äºè¡¨è¿æ¥çš„å­—æ®µï¼šåœ¨ä¸å…¶ä»–è¡¨è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œè¿æ¥å­—æ®µåº”å»ºç«‹ç´¢å¼•ï¼Œä»¥åŠ é€Ÿè¿æ¥æ“ä½œã€‚\n4.ç”¨äºæ’åºï¼ˆORDER BYï¼‰å’Œåˆ†ç»„ï¼ˆGROUP BYï¼‰çš„å­—æ®µï¼šè¿™äº›å­—æ®µå»ºç«‹ç´¢å¼•åï¼Œå¯æé«˜æ’åºå’Œåˆ†ç»„æ“ä½œçš„æ€§èƒ½ã€‚\n5.é€‰æ‹©æ€§é«˜çš„å­—æ®µï¼šé€‰æ‹©æ€§é«˜æ„å‘³ç€å­—æ®µå€¼çš„å”¯ä¸€æ€§è¾ƒé«˜ã€‚åœ¨æ­¤ç±»å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚\nä¸‹é¢æ˜¯ä¸éœ€è¦åŠ ç´¢å¼•çš„\né¿å…åœ¨é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼šå› ä¸ºæ¯æ¬¡æ›´æ–°ä¸ä»…è¦ä¿®æ”¹æ•°æ®ï¼Œè¿˜éœ€ç»´æŠ¤ç´¢å¼•ï¼Œå¯èƒ½å½±å“å†™æ“ä½œæ€§èƒ½ã€‚ (å•†å“åº“å­˜ï¼Œå•†å“ä¿¡æ¯)\né¿å…åœ¨ä½é€‰æ‹©æ€§å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼šå¦‚æ€§åˆ«å­—æ®µï¼Œåªæœ‰ \u0026ldquo;ç”·\u0026rdquo; å’Œ \u0026ldquo;å¥³\u0026rdquo; ä¸¤ç§å€¼ï¼Œå»ºç«‹ç´¢å¼•æ•ˆæœä¸æ˜æ˜¾ã€‚\næ§åˆ¶ç´¢å¼•æ•°é‡ï¼šè¿‡å¤šçš„ç´¢å¼•ä¼šå¢åŠ æ•°æ®åº“çš„ç»´æŠ¤æˆæœ¬ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢‘ç¹å†™æ“ä½œçš„åœºæ™¯ä¸‹ï¼Œéœ€è¦åœ¨æŸ¥è¯¢æ€§èƒ½å’Œå†™æ“ä½œå¼€é”€ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚\nç»„åˆç´¢å¼• / å¤åˆç´¢å¼• / è”åˆç´¢å¼• åƒç»„åˆç´¢å¼•å’Œå¤åˆç´¢å¼•ä½ çŸ¥é“å—?æ¯”å¦‚è¯´æˆ‘å»ºäº†ä¸€ä¸ªa,b,cè”åˆç´¢å¼•ã€‚æˆ‘å†™ä»£ç çš„æ—¶å€™å…ˆå†™çš„cï¼Œbï¼Œaå¯ä»¥å—?\nç»„åˆç´¢å¼•ï¼ˆä¹Ÿç§°å¤åˆç´¢å¼•æˆ–è”åˆç´¢å¼•ï¼‰æ˜¯æŒ‡åœ¨å¤šä¸ªåˆ—ä¸Šåˆ›å»ºçš„å•ä¸ªç´¢å¼•ï¼Œç”¨äºæé«˜å¤šæ¡ä»¶æŸ¥è¯¢çš„æ€§èƒ½ã€‚\nå½“åˆ›å»ºäº†åŒ…å«åˆ— aã€bã€c çš„ç»„åˆç´¢å¼•æ—¶ï¼ŒæŸ¥è¯¢æ¡ä»¶çš„é¡ºåºä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨æ•ˆæœã€‚\nè¿™éµå¾ª æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå³ç´¢å¼•çš„ä½¿ç”¨ä»æœ€å·¦è¾¹çš„åˆ—å¼€å§‹åŒ¹é…ï¼Œå¿…é¡»æŒ‰ç…§ç´¢å¼•å®šä¹‰çš„åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…ã€‚\næ‰€ä»¥ä¸èƒ½ä½¿ç”¨ cï¼Œb ï¼Œa æŸ¥è¯¢ã€‚\nMySQLçš„ç´¢å¼•åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ä¼šå¤±æ•ˆ? å¯¹ç´¢å¼•å­—æ®µçš„è¿ç®—æˆ–å‡½æ•°æ“ä½œ\nSELECT * FROM users WHERE YEAR(birthdate) = 1990; ä½¿ç”¨äº†é€šé…ç¬¦ï¼ˆLIKE '%abc'ï¼‰\nSELECT * FROM products WHERE name LIKE \u0026#39;%abc\u0026#39;; åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨äº†ä¸ç­‰äºï¼ˆ\u0026lt;\u0026gt;ï¼‰æ“ä½œç¬¦\nSELECT * FROM orders WHERE status \u0026lt;\u0026gt; 1; è¿›è¡Œ NULL å€¼æŸ¥è¯¢æ—¶æœªä¼˜åŒ–\nSELECT * FROM users WHERE phone_number IS NULL; æ•°æ®ç±»å‹ä¸åŒ¹é…\nSELECT * FROM users WHERE age = \u0026#39;25\u0026#39;; ä½¿ç”¨äº† OR æ“ä½œç¬¦ï¼Œç‰¹åˆ«æ˜¯è·¨å­—æ®µæ—¶\nSELECT * FROM products WHERE price = 100 OR category = \u0026#39;electronics\u0026#39;; ç´¢å¼•åˆ—çš„æ•°æ®åˆ†å¸ƒä¸å‡åŒ€: å½“ç´¢å¼•åˆ—çš„æ•°æ®åˆ†å¸ƒæå…¶ä¸å‡åŒ€æ—¶ï¼Œå³ä½¿ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼ŒMySQL ä¹Ÿå¯èƒ½é€‰æ‹©ä¸ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºæ‰«æå…¨è¡¨æ¯”æ‰«æç´¢å¼•æ›´é«˜æ•ˆã€‚\näº‹åŠ¡æ”¾åœ¨MVCå½“ä¸­çš„å“ªä¸€å±‚ï¼Ÿ äº‹åŠ¡çš„ç®¡ç†åº”æ”¾åœ¨ Serviceå±‚ï¼Œè¿™æ˜¯å› ä¸ºServiceå±‚è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥ç»Ÿä¸€æ§åˆ¶è·¨å¤šä¸ªDAOæ“ä½œçš„äº‹åŠ¡ã€‚Controllerå±‚åº”è¯¥å°½é‡é¿å…ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œä»¥ä¿æŒç³»ç»Ÿçš„è§£è€¦æ€§å’ŒèŒè´£æ¸…æ™°ã€‚è€ŒDAOå±‚åˆ™ä¸“æ³¨äºæ•°æ®çš„æŒä¹…åŒ–æ“ä½œï¼Œä¸åº”æ‰¿æ‹…äº‹åŠ¡ç®¡ç†çš„è´£ä»»ã€‚\nä»€ä¹ˆæ—¶å€™åº”è¯¥æ·»åŠ äº‹åŠ¡ï¼Ÿ é‚£æˆ‘ä»¬æŸ¥è¯¢listä¼šåŠ äº‹ç‰©å—? ä½¿ç”¨deleteåˆ é™¤æ—¶ä¼šåŠ äº‹ç‰©å—?\näº‹åŠ¡çš„ä½¿ç”¨åœºæ™¯ï¼šäº‹åŠ¡é€šå¸¸ç”¨äºæ•°æ®ä¿®æ”¹æ“ä½œï¼ˆå¦‚æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚\næŸ¥è¯¢æ“ä½œçš„äº‹åŠ¡æ€§ï¼šæŸ¥è¯¢æ“ä½œä¸€èˆ¬ä¸éœ€è¦äº‹åŠ¡ï¼Œé™¤éæœ‰ä¸€è‡´æ€§éœ€æ±‚ï¼Œéœ€é€šè¿‡éš”ç¦»çº§åˆ«æ¥æ§åˆ¶ã€‚\nå¢ã€åˆ ã€æ”¹æ“ä½œçš„äº‹åŠ¡æ€§ï¼šå¢ã€åˆ ã€æ”¹åº”è¯¥æ”¾åœ¨äº‹åŠ¡ä¸­è¿›è¡Œï¼Œç¡®ä¿å¢ã€åˆ ã€æ”¹çš„åŸå­æ€§ã€‚\nå¹¶å‘ä¿®æ”¹è¯·æ±‚å¦‚ä½•æ§åˆ¶? å‡è®¾æˆ‘çš„é“¶è¡Œå¡é‡Œé¢åªæœ‰10å—é’±ï¼Œç°åœ¨è¿‡æ¥10ä¸ªè¯·æ±‚éƒ½è¦æ‰£10å—é’±ï¼Œæ˜¯ä½ çš„è¯ä½ ä¼šæ€ä¹ˆæ§åˆ¶?\næœ€ç›´æ¥çš„æ–¹å¼æ˜¯ä¿è¯æ¯ä¸ªæ‰£æ¬¾æ“ä½œå…·æœ‰åŸå­æ€§ã€‚å¯ä»¥é€šè¿‡æ‚²è§‚é”æˆ–ä¹è§‚é”æ¥æ§åˆ¶å¹¶å‘ï¼Œç¡®ä¿å¤šä¸ªè¯·æ±‚ä¸ä¼šåŒæ—¶æ‰£æ¬¾ã€‚\n1.æ‚²è§‚é”å’Œä¹è§‚é”\næ‚²è§‚é”é€šè¿‡æ•°æ®åº“å±‚é¢çš„é”æœºåˆ¶ï¼ˆå¦‚ SELECT FOR UPDATEï¼‰é˜²æ­¢å¹¶å‘ä¿®æ”¹ä½™é¢ã€‚\nä¹è§‚é”é€šè¿‡ç‰ˆæœ¬å·æˆ– CAS åŸç†è¿›è¡Œæ“ä½œï¼Œé€‚ç”¨äºå¹¶å‘å†²çªè¾ƒå°‘çš„æƒ…å†µã€‚\n2.åˆ†å¸ƒå¼é” ï¼ˆRedissionï¼‰\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥ä¿è¯å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ã€‚\n3.é˜Ÿåˆ—å’Œé™æµ (RabbitMQ)\né˜Ÿåˆ—å’Œé™æµ æ§åˆ¶è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œé¿å…çªå‘çš„é«˜å¹¶å‘è¯·æ±‚ã€‚\nåˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•å¤„ç†ï¼Ÿå®ƒçš„ä½œç”¨? ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸åŒæœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œç¡®ä¿è·¨æœåŠ¡æ“ä½œèƒ½å¤Ÿä¿è¯æœ€ç»ˆçš„ä¸€è‡´æ€§ã€‚\nåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³ä»€ä¹ˆé—®é¢˜ï¼šä¸»è¦è§£å†³è·¨æœåŠ¡çš„ä¸€è‡´æ€§ï¼Œä¿è¯å¤šä¸ªæœåŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚\nåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼šï¼ˆåæœŸå­¦ä¹ ï¼‰\n2PCï¼šé€‚åˆå¼ºä¸€è‡´æ€§è¦æ±‚çš„åœºæ™¯ã€‚ TCCï¼šç”¨äºæ“ä½œæ›´å¤æ‚çš„åˆ†å¸ƒå¼åœºæ™¯ã€‚ Sagaæ¨¡å¼ï¼šé€‚åˆé•¿äº‹åŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šå¸¸ç”¨äºæœ€ç»ˆä¸€è‡´æ€§åœºæ™¯ã€‚ å¼€å‘è¿‡ç¨‹ä¸­Gitåˆ†æ”¯ç®¡ç† 1.å¼€å‘çš„æ—¶å€™æ¥äº†ä¸€ä¸ªæ–°éœ€æ±‚ï¼Œä½ ä»¬çš„åˆ†æ”¯æ˜¯æ€ä¹ˆç®¡ç†çš„?\næˆ‘ä»¬é‡‡ç”¨ä¸‰ç§ä¸åŒçš„å‰ç¼€æ¥ç®¡ç† feat æ–°å¢ã€fix ä¿®å¤ã€refactor é‡æ„\n2.å¢åŠ æ–°éœ€æ±‚ï¼Œåˆ†æ”¯æ˜¯ä»å“ªé‡Œæ–°å¢çš„?\næ¯ä¸ªæ–°éœ€æ±‚éƒ½ä¼šä» main åˆ†æ”¯ä¸Šåˆ›å»ºä¸€ä¸ª feat åˆ†æ”¯è¿›è¡Œå¼€å‘ã€‚\n3.å»ºå®Œä¸€ä¸ªåˆ†æ”¯ä¹‹åå°±å¼€å§‹æ”¹ä»£ç å—?\nç¡®ä¿ä½ ä»ä¸»åˆ†æ”¯ï¼ˆmainï¼‰åˆ›å»ºäº†æœ€æ–°çš„åˆ†æ”¯ï¼Œé¿å…åç»­åˆå¹¶æ—¶çš„å†²çªã€‚\nåœ¨å¼€å‘å‰ï¼Œåº”è¯¥ç¡®è®¤éœ€æ±‚çš„å…·ä½“å†…å®¹ï¼Œå¹¶ä¸ç›¸å…³å›¢é˜Ÿæˆå‘˜å¯¹æ¥ï¼Œç„¶åé…ç½®å¥½å¯¹åº”ç¯å¢ƒï¼Œå†è¿›è¡Œå¼€å‘ã€‚\n4.å¼€å‘å®Œä¹‹åæµ‹è¯•çš„è¯ï¼Œè¿™ä¸ªä»£ç æ”¾åˆ°å“ªé‡Œå»?\næˆ‘ä»¬ä¼šcommit feat åˆ†æ”¯ï¼Œç„¶åæ‰“åŒ…ä¸Šä¼ åˆ°æµ‹è¯•ç¯å¢ƒï¼Œæäº¤ç»™æµ‹è¯•\n5.å‡å¦‚ç°åœ¨åˆæ¥äº†ä¸¤ä¸ªæ–°éœ€æ±‚ï¼Œä¸€ä¸ªéœ€æ±‚å…ˆä¸Šçº¿ï¼Œä¸€ä¸ªéœ€æ±‚è¿‡å‡ å¤©ä¸Šçº¿ã€‚ä½ ä»¬çš„åˆ†æ”¯æ˜¯æ€ä¹ˆç®¡ç†çš„?\nå½“æœ‰å¤šä¸ªéœ€æ±‚æ—¶ï¼Œå…ˆæ»¡è¶³ç¬¬ä¸€ä¸ªè¦ä¸Šçº¿çš„ éœ€æ±‚A ã€‚ç„¶åå†æ‹‰å–ä»£ç ï¼Œç¼–å†™ éœ€æ±‚B çš„ä»£ç \n6.ä½ ä»¬é‚£ä¸ªæµ‹è¯•æ‹‰ä»£ç æ˜¯è¿ç»´æ‹‰ä»£ç è¿˜æ˜¯æµ‹è¯•æ‹‰ä»£ç ï¼Ÿ\næµ‹è¯•æ‹‰å–ä»£ç \nSpringbootå’ŒSpringåŒºåˆ«åŠç†è§£ Springï¼š\næ ¸å¿ƒç‰¹æ€§ï¼šSpring æä¾›äº†æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ”¯æŒï¼Œä¸»è¦ç”¨äºæ„å»ºä¼ä¸šçº§åº”ç”¨ç¨‹åºã€‚ é…ç½®æ–¹å¼ï¼šSpringçš„é…ç½®æ˜¯éå¸¸çµæ´»ä½†å¤æ‚çš„ã€‚é€šå¸¸ï¼Œå¼€å‘è€…éœ€è¦é€šè¿‡ XML é…ç½®ã€æ³¨è§£é…ç½®æˆ– Java é…ç½®ç±»æ¥é…ç½® Spring å®¹å™¨å’Œå„ç§æ¨¡å—ã€‚ æ¨¡å—åŒ–ï¼šSpring æ¡†æ¶åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œå¦‚ Spring Coreã€Spring AOPã€Spring Dataã€Spring MVC ç­‰ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®éœ€è¦é›†æˆå’Œé…ç½®è¿™äº›æ¨¡å—ã€‚ Spring Bootï¼š\nè‡ªåŠ¨é…ç½®ï¼šSpring Boot æä¾›äº†å¤§é‡çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œå¼€å‘è€…åªéœ€è¦å°‘é‡çš„é…ç½®ï¼Œç”šè‡³å¯ä»¥çœå» XML é…ç½®ï¼Œç®€åŒ–äº†ä¼ ç»Ÿ Spring é…ç½®çš„å¤æ‚åº¦ã€‚ å†…åµŒæœåŠ¡å™¨ï¼šSpring Boot æä¾›äº† Tomcatã€Jettyã€Undertow ç­‰å†…åµŒæœåŠ¡å™¨ï¼Œä½¿å¾—åº”ç”¨å¯ä»¥ç›´æ¥æ‰“åŒ…ä¸ºå¯æ‰§è¡Œ JAR æ–‡ä»¶ï¼Œæ— éœ€å¤–éƒ¨å®¹å™¨æ”¯æŒã€‚ å¼€ç®±å³ç”¨ï¼šSpring Boot æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œé»˜è®¤çš„åº”ç”¨ç»“æ„ã€å†…ç½®çš„å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨åŒ–çš„æ—¥å¿—é…ç½®ç­‰ï¼Œæå¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚ Spring Boot Starterï¼šä½¿ç”¨â€œStarterâ€å¯ä»¥è®©å¼€å‘è€…æ–¹ä¾¿åœ°å¼•å…¥å¸¸è§çš„ä¾èµ–åŒ…ï¼Œé¿å…æ‰‹åŠ¨é…ç½®å’Œé›†æˆå¸¸ç”¨ç»„ä»¶ã€‚ Springå’ŒSpringbootåŒºåˆ« ç‰¹æ€§ Spring Spring Boot ç›®æ ‡ æä¾›ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ã€‚ ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œå¯åŠ¨è¿‡ç¨‹ã€‚ é…ç½®æ–¹å¼ éœ€è¦å¤§é‡çš„ XML æˆ– Java é…ç½®ã€‚ é€šè¿‡è‡ªåŠ¨é…ç½®ç®€åŒ–é…ç½®ï¼Œå‡ ä¹ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚ åº”ç”¨å¯åŠ¨ éœ€è¦å¤–éƒ¨åº”ç”¨æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰ã€‚ æ”¯æŒå†…åµŒæœåŠ¡å™¨ï¼Œåº”ç”¨å¯ä»¥æ‰“åŒ…ä¸ºå¯æ‰§è¡Œ JAR æ–‡ä»¶ã€‚ ä¾èµ–ç®¡ç† éœ€è¦æ‰‹åŠ¨é…ç½®ä¾èµ–å’Œç‰ˆæœ¬ã€‚ æä¾›é¢„è®¾çš„ Spring Boot Starterï¼Œè‡ªåŠ¨ç®¡ç†ä¾èµ–ã€‚ æ¨¡å—é›†æˆ éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é›†æˆå„ä¸ªæ¨¡å—ï¼ˆå¦‚ Spring MVC, Spring Dataï¼‰ã€‚ è‡ªåŠ¨åŒ–é›†æˆå„ä¸ªæ¨¡å—ï¼Œå¹¶æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚ å¼€å‘æ•ˆç‡ é…ç½®å’Œé›†æˆè¾ƒä¸ºç¹çï¼Œå¼€å‘æ•ˆç‡è¾ƒä½ã€‚ é€šè¿‡è‡ªåŠ¨é…ç½®å’Œå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚ å¯åŠ¨æ—¶é—´ å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦ç­‰å¾…å®¹å™¨çš„åˆå§‹åŒ–ã€‚ å¯åŠ¨é€Ÿåº¦å¿«ï¼Œé›†æˆåŒ–å’Œå†…åµŒå¼æœåŠ¡å‡å°‘äº†åˆå§‹åŒ–æ—¶é—´ã€‚ ç¯å¢ƒä¾èµ– é…ç½®è¾ƒä¸ºçµæ´»ï¼Œç¯å¢ƒä¾èµ–éœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚ å†…åµŒæœåŠ¡å™¨å’Œè‡ªåŠ¨é…ç½®é™ä½äº†ç¯å¢ƒä¾èµ–é—®é¢˜ã€‚ RabbitMQå’ŒKafkaåŒºåˆ«å’Œç†è§£ Kafka å’Œ RabbitMQ å¯¹æ¯” - åŸç†\nåº”ç”¨åœºæ™¯ RabbitMQ Kafka æ¶ˆæ¯å¤§å°å’Œæ ¼å¼ é€‚åˆå¤„ç†ä¸­å°å‹æ¶ˆæ¯ï¼Œæ”¯æŒå„ç§æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€JSONç­‰ é€‚åˆå¤„ç†å¤§å‹æ¶ˆæ¯å’Œæµå¼æ•°æ®ï¼Œæ”¯æŒæ‰¹é‡æ¶ˆæ¯ä¼ é€’å’Œæ—¥å¿—å­˜å‚¨ å®æ—¶æ€§è¦æ±‚ æ”¯æŒä½å»¶è¿Ÿçš„æ¶ˆæ¯ä¼ é€’å’Œå®šæ—¶åŠŸèƒ½ï¼Œé€‚ç”¨äºå®æ—¶æ¶ˆæ¯å¤„ç† ï¼ˆå¾®ç§’çº§ï¼‰ å»¶è¿Ÿè¾ƒé«˜ï¼Œä¸»è¦ä¼˜åŒ–ååé‡ï¼Œé€‚åˆé«˜ååé‡æ•°æ®æµå¤„ç† ï¼ˆæ¯«ç§’çº§ï¼‰ ååé‡ ååé‡è¾ƒä½ï¼Œé€‚åˆä½å¹¶å‘åœºæ™¯ ååé‡æé«˜ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ã€å¤§æ•°æ®åœºæ™¯ æ•°æ®ä¸€è‡´æ€§å’Œå¯é æ€§ æä¾›æ¶ˆæ¯ç¡®è®¤æœºåˆ¶å’Œå¼ºå¤§çš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± é€šè¿‡æ—¥å¿—å­˜å‚¨ã€åˆ†åŒºå’Œå‰¯æœ¬æœºåˆ¶ä¿è¯æ•°æ®å¯é æ€§å’Œé«˜å¯ç”¨æ€§ åˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æŒ æ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œä½†åœ¨æ‰©å±•æ€§ä¸Šä¸å¦‚ Kafka åŸç”Ÿæ”¯æŒåˆ†å¸ƒå¼æ¶æ„ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿ æ’ä»¶æ”¯æŒå’Œç”Ÿæ€ç³»ç»Ÿ ä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼Œæ˜“ä¸å„ç§æŠ€æœ¯å’Œå·¥å…·é›†æˆï¼ŒåŠŸèƒ½å¤šæ ·åŒ– æ’ä»¶æ”¯æŒè¾ƒå°‘ï¼Œä½†ç”Ÿæ€ç³»ç»Ÿå¹¿æ³›ï¼Œä¸»è¦ç”¨äºæµå¤„ç†ã€å¤§æ•°æ®å¹³å° ","permalink":"https://swimmingliu.cn/posts/job/java-interview-questions-notes/","summary":"\u003ch2 id=\"-å’Œ-equals-åŒºåˆ«\"\u003e== å’Œ equals åŒºåˆ«\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e==\u003c/code\u003e åŸºæœ¬ç±»å‹(int, long, float, char, boolean) å€¼æ¯”è¾ƒï¼Œ å¼•ç”¨ç±»å‹(Stringï¼ŒList) è¿›è¡Œåœ°å€æ¯”è¾ƒ\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eequals\u003c/code\u003e é»˜è®¤å°±æ˜¯ \u003ccode\u003e==\u003c/code\u003e ï¼Œä½†æ˜¯éƒ¨åˆ†å¼•ç”¨ç±»å‹(Stringï¼ŒList)é‡å†™äº†è¯¥æ–¹æ³•ï¼Œè¿›è¡Œå€¼æ¯”è¾ƒ\u003c/p\u003e\n\u003ch2 id=\"get-å’Œ-post-åŒºåˆ«\"\u003eget å’Œ post åŒºåˆ«\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eç‰¹æ€§\u003c/th\u003e\n          \u003cth\u003eGET\u003c/th\u003e\n          \u003cth\u003ePOST\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eç›®çš„\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eè·å–èµ„æºï¼ŒæŸ¥è¯¢æ•°æ®\u003c/td\u003e\n          \u003ctd\u003eæäº¤æ•°æ®ï¼Œåˆ›å»ºæˆ–æ›´æ–°èµ„æº\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eè¯·æ±‚æ•°æ®æ–¹å¼\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå‚æ•°é€šè¿‡ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®é€šè¿‡è¯·æ±‚ä½“ä¼ é€’\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ•°æ®æš´éœ²\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®æš´éœ²åœ¨ URL ä¸­ï¼Œè¾ƒä¸å®‰å…¨\u003c/td\u003e\n          \u003ctd\u003eæ•°æ®å­˜å‚¨åœ¨è¯·æ±‚ä½“ä¸­ï¼Œç›¸å¯¹å®‰å…¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ•°æ®å¤§å°é™åˆ¶\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eURL é•¿åº¦æœ‰é™åˆ¶ï¼ˆçº¦ 2048 ä¸ªå­—ç¬¦ï¼‰\u003c/td\u003e\n          \u003ctd\u003eæ²¡æœ‰æ•°æ®å¤§å°é™åˆ¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eé€‚ç”¨åœºæ™¯\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eè·å–æ•°æ®ï¼ŒæŸ¥è¯¢ï¼Œå±•ç¤ºèµ„æº\u003c/td\u003e\n          \u003ctd\u003eæäº¤è¡¨å•ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹èµ„æºï¼Œå‘é€æ•æ„Ÿæ•°æ®ç­‰\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"springmvcä¸­reponsebodypathvariablerequestparametersåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨\"\u003eSpringMVCä¸­@ReponseBodyã€@PathVariableã€@RequestParametersåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨?\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e@ReponseBody\u003c/code\u003e ç”¨äºæ¥å—è¯·æ±‚ä½“æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºPOSTè¯·æ±‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@PathVariable\u003c/code\u003e ç”¨äºæ¥å—è·¯å¾„å‚æ•°ï¼Œä¸€èˆ¬ç”¨æˆ·æ¥å— \u003ccode\u003eid\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@RequestParameters\u003c/code\u003e ç”¨äºæ¥å—è¯·æ±‚å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºGETè¯·æ±‚\u003c/p\u003e\n\u003ch2 id=\"jvmå †çš„ç»“æ„gcä»‹ç»å’Œä½œç”¨\"\u003eJVMå †çš„ç»“æ„ã€GCä»‹ç»å’Œä½œç”¨\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://www.51cto.com/article/710705.html\"\u003eJVMå †ç»“æ„çš„å‚è€ƒæ–‡ç« \u003c/a\u003e ã€ \u003ca href=\"https://www.bilibili.com/video/BV1dt411u7wi\"\u003eGCåƒåœ¾å›æ”¶è¿‡ç¨‹\u003c/a\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eåŒºåŸŸ\u003c/th\u003e\n          \u003cth\u003eä¸»è¦ç”¨é€”\u003c/th\u003e\n          \u003cth\u003eç‰¹ç‚¹\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå­˜å‚¨æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¿«é€Ÿåƒåœ¾å›æ”¶\u003c/td\u003e\n          \u003ctd\u003eåŒ…å« Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•è¿›è¡Œå›æ”¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eè€å¹´ä»£ï¼ˆOld Generationï¼‰\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡\u003c/td\u003e\n          \u003ctd\u003eå›æ”¶é¢‘ç‡è¾ƒä½ï¼Œåƒåœ¾å›æ”¶è¾ƒè€—æ—¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ°¸ä¹…ä»£ï¼ˆPermanent Generation) (jdk 1.7ï¼‰\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€æ–¹æ³•å­—èŠ‚ç ç­‰\u003c/td\u003e\n          \u003ctd\u003eåœ¨ jdk 1.8 è¢« Metaspace æ›¿ä»£\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eå…ƒç©ºé—´ï¼ˆjdk 1.8ï¼‰\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå­˜å‚¨ç±»çš„å…ƒæ•°æ®\u003c/td\u003e\n          \u003ctd\u003eä¸å†å±äºå †ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå¤§å°ç”±ç³»ç»Ÿé™åˆ¶\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003ccode\u003eGC\u003c/code\u003e æ˜¯åƒåœ¾å›æ”¶å™¨ï¼Œ ä½œç”¨æ˜¯è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œé¿å…å†…å­˜æ³„æ¼\u003c/p\u003e","title":"Javaé¢è¯•é¢˜-éšæ‰‹è®°"},{"content":"Abstract è‚ºç™Œæ˜¯å…¨çƒæœ€è‡´å‘½çš„ç™Œç—‡ä¹‹ä¸€ï¼Œæ—©æœŸè¯Šæ–­å¯¹äºæ‚£è€…çš„ç”Ÿå­˜è‡³å…³é‡è¦ã€‚è‚ºç»“èŠ‚æ˜¯æ—©æœŸè‚ºç™Œçš„ä¸»è¦è¡¨ç°ï¼Œé€šå¸¸é€šè¿‡ CT æ‰«æè¿›è¡Œè¯„ä¼°ã€‚å¦‚ä»Šï¼Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿè¢«å¹¿æ³›ç”¨äºè¾…åŠ©åŒ»ç”Ÿè¿›è¡Œç–¾ç—…è¯Šæ–­ã€‚è‚ºç»“èŠ‚çš„å‡†ç¡®åˆ†å‰²å—åˆ°å†…éƒ¨å¼‚è´¨æ€§å’Œå¤–éƒ¨æ•°æ®å› ç´ çš„å½±å“ã€‚ä¸ºäº†å…‹æœç»“èŠ‚çš„ç»†å¾®ã€æ··åˆã€ç²˜é™„å‹ã€è‰¯æ€§å’Œä¸ç¡®å®šç±»åˆ«çš„åˆ†å‰²æŒ‘æˆ˜ï¼Œæå‡ºäº†ä¸€ç§æ–°çš„æ··åˆæ‰‹åŠ¨ç‰¹å¾ç½‘ç»œï¼Œå¯å¢å¼ºçµæ•åº¦å’Œå‡†ç¡®æ€§ã€‚è¯¥æ–¹æ³•é€šè¿‡åŒåˆ†æ”¯ç½‘ç»œæ¡†æ¶å’Œå¤šç»´èåˆæ¨¡å—é›†æˆç‰¹å¾ä¿¡æ¯ã€‚é€šè¿‡ä½¿ç”¨å¤šä¸ªæ•°æ®æºå’Œä¸åŒæ•°æ®è´¨é‡è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ LUNA16ã€å¤šåšåº¦åˆ‡ç‰‡å›¾åƒæ•°æ®é›† (Multi-thickness Slice Image dataset)ã€LIDC å’Œ UniToChest ä¸Šè¡¨ç°å‡ºé¢†å…ˆçš„æ€§èƒ½ï¼ŒDice ç›¸ä¼¼ç³»æ•°è¾¾åˆ° 86.89%ã€75.72%ã€84.12% å’Œ 80.74åˆ†åˆ«è¶…è¿‡äº†å½“å‰å¤§å¤šæ•°è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ã€‚æˆ‘ä»¬çš„æ–¹æ³•è¿›ä¸€æ­¥æé«˜äº†è‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡çš„å‡†ç¡®æ€§ã€å¯é æ€§å’Œç¨³å®šæ€§ï¼Œå³ä½¿æ˜¯åœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„ CT æ‰«æä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æœ¬ç ”ç©¶ä¸­ä½¿ç”¨çš„ä»£ç å‘å¸ƒåœ¨ GitHub ä¸Šï¼Œå¯é€šè¿‡ä»¥ä¸‹ URL (https://github.com/BITEWKRER/DBNet) è·å–ã€‚\nIntroduction è‚ºç™Œæ˜¯å…¨çƒç™Œç—‡ç›¸å…³æ­»äº¡çš„ä¸»è¦åŸå› [1]ã€‚ä»…åœ¨ç¾å›½ï¼Œé¢„è®¡ 2023 å¹´å°†æœ‰ 127,070 äººæ­»äºè‚ºç™Œï¼Œå æ‰€æœ‰ç™Œç—‡æ­»äº¡çš„ 21% [2]ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¶…è¿‡ 50% çš„è‚ºç™Œç—…ä¾‹å‘ç”Ÿåœ¨å‘å±•ä¸­å›½å®¶æˆ–ä¸å‘è¾¾å›½å®¶ï¼Œä¸å‘è¾¾å›½å®¶ç›¸æ¯”ï¼Œè¿™äº›å›½å®¶çš„åŒ»ç–—èµ„æºæœ‰é™[3]ã€‚\nä¸ºäº†å¢åŠ ç”Ÿå­˜æœºä¼šï¼Œæ—©æœŸè¯Šæ–­å’Œæ²»ç–—è‚ºç™Œä»ç„¶è‡³å…³é‡è¦ã€‚åœ¨ä¸­å›½ï¼Œç ”ç©¶è¡¨æ˜ï¼Œå°äº1å˜ç±³çš„IæœŸè‚ºç™Œçš„5å¹´ç”Ÿå­˜ç‡ä¸º92%ã€‚ç„¶è€Œï¼Œæ™šæœŸè‚ºç™Œçš„5å¹´ç”Ÿå­˜ç‡ä½å¾—å¤šï¼Œä»…ä¸º7.0%[4]ã€‚åˆ©ç”¨è®¡ç®—æœºæ–­å±‚æ‰«æ (CT) è¿›è¡Œè‚ºç™Œç­›æŸ¥å·²æ˜¾ç¤ºå‡ºå¯å¤§å¹…é™ä½æ­»äº¡ç‡çš„æ½œåŠ› [5]ã€[6]ã€‚ä½å‰‚é‡CTæ˜¯ç›®å‰è‚ºç™Œç­›æŸ¥æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œç§»åŠ¨CTçš„å¼•å…¥æœ‰åŠ©äºè§£å†³æ¬ å‘è¾¾å›½å®¶å’Œåè¿œåœ°åŒºç¼ºä¹CTæ‰«æä»ªçš„é—®é¢˜[6]ã€‚ç”±äºå¯èƒ½æ²¡æœ‰æ˜æ˜¾çš„ç—‡çŠ¶ï¼Œæ£€æµ‹æ—©æœŸè‚ºç™Œçš„å­˜åœ¨å¯èƒ½ä¼šå¸¦æ¥é‡å¤§æŒ‘æˆ˜ã€‚\nè¿™ç§åŒ»å­¦èƒŒæ™¯æ•°æ®å¯ä»¥ç›´æ¥å€Ÿé‰´ï¼ŒChatgptæ¶¦è‰²æ”¹å†™å°±å®Œäº‹å„¿\nåœ¨ CT å›¾åƒä¸Šè¯†åˆ«è‚ºç»“èŠ‚æä¾›äº†ç–¾ç—…çš„å…³é”®æŒ‡æ ‡ [1], [3]ã€‚è¿™äº›ç»“èŠ‚ä»£è¡¨åœ†å½¢å¼‚å¸¸ï¼Œå…¶å¤§å°å„å¼‚ï¼Œç›´å¾„èŒƒå›´ä¸º 3 è‡³ 30 æ¯«ç±³ [7]ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç ”ç©¶è‚ºç»“èŠ‚ï¼Œç¾å›½å›½å®¶ç™Œç—‡ç ”ç©¶æ‰€ç»„è£…äº†â€œè‚ºéƒ¨å›¾åƒæ•°æ®åº“è”ç›Ÿå’Œå›¾åƒæ•°æ®åº“èµ„æºè®¡åˆ’ï¼ˆLIDCï¼‰â€æ•°æ®é›†[8]ã€‚\næ¬ å‘è¾¾åœ°åŒºè®¾å¤‡ä¸è¶³ã€äººå‘˜ä¸è¶³ï¼Œå¯¼è‡´åŒ»ç”Ÿçš„è¯Šæ–­å’Œæ²»ç–—æ—¶é—´æœ‰é™[9]ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŒ»ç”Ÿçš„å·¥ä½œé‡å¾ˆå¤§ã€é‡å¤ä¸”è€—æ—¶[10]ã€[5]ã€‚æ­¤å¤–ï¼Œç”±äºä¸CTåˆ‡ç‰‡ç›¸æ¯”ï¼Œè‚ºéƒ¨ç»“èŠ‚æ€§ç—…å˜å æ®ç›¸å¯¹è¾ƒå°çš„é¢ç§¯ï¼Œé•¿æ—¶é—´å’Œå¯†é›†çš„CTç­›æŸ¥å¯èƒ½ä¼šå¯¼è‡´æ¼æ£€å°çš„ã€ç»†å¾®çš„æˆ– GGO (è‚ºç£¨ç»ç’ƒç»“èŠ‚) [3]ï¼Œ[6]ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿï¼ˆCADï¼‰å‡ºç°å¹¶å¾—åˆ°äº†å¿«é€Ÿå‘å±•ï¼Œç‰¹åˆ«æ˜¯éšç€åŸºäºæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¯Šæ–­æ–¹æ³•çš„è¿›æ­¥ã€‚ CADç³»ç»Ÿå¤§å¤§å‡è½»äº†åŒ»ç”Ÿçš„å·¥ä½œé‡ï¼Œæœ€å¤§é™åº¦åœ°é™ä½äº†æœªå‘ç°ç»“èŠ‚çš„é£é™©ï¼Œå¹¶æé«˜äº†è‚ºç»“èŠ‚è¯Šæ–­çš„æ•ˆç‡å’Œå¯é æ€§ã€‚ç„¶è€Œï¼Œå½“å‰ç”¨äºè‚ºç»“èŠ‚åˆ†å‰²çš„ CAD ç³»ç»Ÿä»ç„¶é¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚\nä¸‹é¢è¯¦ç»†é˜è¿°äº†è‚ºç»“èŠ‚åˆ†å‰²çš„å‡ ä¸ªç°æœ‰æŒ‘æˆ˜ï¼Œå¯ä»¥ä»è¿™äº›æŒ‘æˆ˜å…¥æ‰‹\né¦–å…ˆï¼Œæ”¾å°„ç§‘åŒ»ç”Ÿæ ‡è®°çš„è‚ºç»“èŠ‚åŒ…å«ä¹ä¸ªè¯Šæ–­ç‰¹å¾[11]ï¼Œå¼‚è´¨æ€§è¡¨å‹é˜»ç¢äº†è‚ºç»“èŠ‚åˆ†å‰²çš„å‘å±•ã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œå®å¿ƒç»“èŠ‚ï¼ˆaï¼Œbï¼‰å…·æœ‰æ¸…æ™°çš„å½¢çŠ¶å’Œè¾¹ç•Œï¼Œè€Œå¾®å¦™çš„GGOç»“èŠ‚ï¼ˆeï¼‰å…·æœ‰ä½å¯¹æ¯”åº¦å’Œæ¨¡ç³Šçš„è¾¹ç•Œ[4]ï¼Œä½¿å¾—ç½‘ç»œå¾ˆå®¹æ˜“å°†å®ƒä»¬åˆ†ç±»ä¸ºèƒŒæ™¯åŒºåŸŸã€‚ç©ºæ´ï¼ˆgï¼‰ç»“èŠ‚é™ä½äº†ç½‘ç»œåˆ†å‰²çš„æ•æ„Ÿæ€§ï¼Œå¹¶ä¸”ç”±äºèƒŒæ™¯å’Œåˆ†å‰²ç›®æ ‡ä¹‹é—´çš„æåº¦ä¸å¹³è¡¡ï¼Œå°ç»“èŠ‚å¾ˆå®¹æ˜“è¢«é—æ¼[12]ã€‚\nç”±äºå‘¨å›´å¤šä½™çš„ç»„ç»‡ç»“æ„ï¼Œè¡€ç®¡æ—æˆ–èƒ¸è†œæ—ï¼ˆcã€dã€fï¼‰å¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œåˆ†ç±»é”™è¯¯[13]ã€‚æ­¤å¤–ï¼Œéƒ¨åˆ†å®æ€§ç»“èŠ‚ï¼ˆhï¼‰æ¯”çº¯GGOæ›´è‡´å¯†ï¼Œäº§ç”Ÿæ›´å¤æ‚çš„å¼‚è´¨çº¹ç†ï¼Œæ›´å®¹æ˜“å‘å±•æˆæ¶æ€§ç»“èŠ‚[14]ã€‚\nå…¶æ¬¡ï¼Œè‚ºç»“èŠ‚å†…éƒ¨å› ç´ é€ æˆçš„åˆ†å‰²å›°éš¾åœ¨äºåŒ»ç”Ÿæ³¨é‡Šã€å±‚åšã€æ•°æ®æ¥æºå’Œæ•°æ®è´¨é‡ã€‚æ•°æ®è´¨é‡å·®æˆ–ä¸åŒåŒ»ç”Ÿçš„ç»éªŒå¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„æ³¨é‡Šå’Œæ³¨é‡Šè€…æ•°é‡ã€‚ç”±å¤šååŒ»ç”Ÿæ³¨é‡Šçš„ç—…å˜åŒºåŸŸé€šå¸¸æ›´å¯é ï¼Œå‡å°‘äº†æ½œåœ¨çš„ä¸´åºŠé£é™©ã€‚åœ¨èµ„æºæœ‰é™çš„åœ°åŒºï¼Œç”±äº CT æ‰«æä»ªçŸ­ç¼ºå’Œæˆåƒè®¾å¤‡é™ˆæ—§ï¼ŒCT æ‰«æè´¨é‡å·®çš„æƒ…å†µå¾ˆå¸¸è§ã€‚è¾ƒåšçš„åˆ‡ç‰‡æ›´æœ‰å¯èƒ½äº§ç”Ÿâ€œä½“ç§¯å¹³å‡æ•ˆåº”â€å’Œä¼ªå½±ï¼Œä½¿åŒ»ç”Ÿéš¾ä»¥è¾¾æˆä¸€è‡´çš„è¯Šæ–­ã€‚å³ä½¿ä½¿ç”¨ç§»åŠ¨ CT æ‰«æä»ªä¹Ÿå¯èƒ½æ— æ³•æä¾›å®Œæ•´çš„è¯Šæ–­è¯¦ç»†ä¿¡æ¯ã€‚æœ€åï¼Œç›®å‰å¤§å¤šæ•°è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•éƒ½æ˜¯åŸºäº2Då›¾åƒï¼Œä½†è¿™äº›æ–¹æ³•å¿½ç•¥äº†ç©ºé—´å…³ç³»ï¼Œå› æ­¤æå‡ºä¸€ç§æœ‰æ•ˆçš„3Dè‚ºç»“èŠ‚åˆ†å‰²æ¨¡å‹æ¥æ•è·è‚ºç»“èŠ‚çš„ç©ºé—´ä½ç½®ã€çº¹ç†å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯å˜å¾—è¶Šæ¥è¶Šé‡è¦ä»¥é¿å…è¯¯è¯Šå’Œæ¼è¯Šã€‚\nChallenge:\nå¼‚è´¨æ€§: è‚ºç»“èŠ‚çš„å½¢çŠ¶å¤šå¼‚ ï¼ˆå®å¿ƒç»“èŠ‚ã€ç£¨ç»ç’ƒç»“èŠ‚ (GGO) ã€ç©ºæ´ç»“èŠ‚ã€è¡€ç®¡å’Œèƒ¸è†œæ—è¾¹çš„ç»“èŠ‚ï¼‰\næ•°æ®é›†ç¼ºé™·ï¼šæ•°æ®é›†è´¨é‡ä¸å¥½ã€è¾ƒåšçš„åˆ‡ç‰‡å’ŒåŒ»ç”Ÿçš„ä¸åŒæ ‡æ³¨éƒ½å¯èƒ½å½±å“æœ€åçš„åˆ†å‰²ç»“æœ\n2Dç½‘ç»œç¼ºé™·ï¼šå¿½ç•¥äº†CTä¿¡æ¯ä¸­çš„ç©ºé—´å…³ç³»\nèƒŒæ™¯çŸ¥è¯†è¡¥å……ï¼šåœ¨åŒ»å­¦æˆåƒï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨è®¡ç®—æœºæ–­å±‚æ‰«æï¼ˆCTï¼‰è¿›è¡Œè¯Šæ–­æ—¶ï¼Œâ€œä½“ç§¯å¹³å‡æ•ˆåº”â€å’Œâ€œä¼ªå½±â€æ˜¯ä¸¤ä¸ªå¯èƒ½å½±å“å›¾åƒè´¨é‡å’Œè§£è¯»å‡†ç¡®æ€§çš„é—®é¢˜ã€‚\nä½“ç§¯å¹³å‡æ•ˆåº”ï¼šè¿™æ˜¯ä¸€ç§ç”±äºæ‰«æåˆ‡ç‰‡åšåº¦è¾ƒå¤§è€Œå¼•èµ·çš„ç°è±¡ã€‚åœ¨ä¸€ä¸ªè¾ƒåšçš„åˆ‡ç‰‡ä¸­ï¼Œå¤šä¸ªä¸åŒå¯†åº¦çš„ç»“æ„å¯èƒ½è¢«å¹³å‡åˆ°åŒä¸€ä¸ªä½“ç´ ï¼ˆä¸‰ç»´åƒç´ ï¼‰é‡Œã€‚è¿™æ„å‘³ç€é«˜å¯†åº¦å’Œä½å¯†åº¦åŒºåŸŸå¯èƒ½ä¼šæ··åˆåœ¨ä¸€èµ·ï¼Œä»è€Œé™ä½äº†å›¾åƒçš„å¯¹æ¯”åº¦å’Œåˆ†è¾¨ç‡ã€‚è¿™ç§æ•ˆåº”ä½¿å¾—è¾ƒå°çš„ç»“æ„ï¼Œå¦‚å°è‚ºç»“èŠ‚ï¼Œæ›´éš¾ä»¥è¢«å‡†ç¡®è¯†åˆ«å’Œåˆ†å‰²ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨è¾ƒåšçš„åˆ‡ç‰‡ä¸­â€œæ¶ˆå¤±â€æˆ–ä¸å‘¨å›´ç»„ç»‡æ··åˆã€‚ ä¼ªå½±ï¼šä¼ªå½±æ˜¯æŒ‡åœ¨æˆåƒè¿‡ç¨‹ä¸­ç”±å„ç§åŸå› äº§ç”Ÿçš„éå®é™…å­˜åœ¨äºåŸå§‹å¯¹è±¡ä¸­çš„å›¾åƒç‰¹å¾ã€‚åœ¨CTæ‰«æä¸­ï¼Œä¼ªå½±å¯èƒ½ç”±æ‚£è€…ç§»åŠ¨ã€æˆåƒè®¾å¤‡çš„é™åˆ¶ã€è½¯ä»¶å¤„ç†ç®—æ³•æˆ–æ‰«æå‚æ•°è®¾ç½®ä¸å½“ç­‰å› ç´ å¼•èµ·ã€‚è¾ƒåšçš„åˆ‡ç‰‡å¯èƒ½åŠ å‰§è¿™äº›ä¼ªå½±ï¼Œå› ä¸ºæ¯ä¸ªåˆ‡ç‰‡è¦†ç›–æ›´å¤§çš„ä½“ç§¯ï¼Œå¢åŠ äº†å¹³å‡å’Œé‡å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯çš„æœºä¼šã€‚ è¿™æ®µè¯ä¸­æåˆ°ï¼Œâ€œè¾ƒåšçš„åˆ‡ç‰‡æ›´æœ‰å¯èƒ½äº§ç”Ÿâ€˜ä½“ç§¯å¹³å‡æ•ˆåº”â€™å’Œä¼ªå½±â€ï¼Œæ„å‘³ç€åœ¨ä½¿ç”¨è¾ƒåšåˆ‡ç‰‡è¿›è¡ŒCTæ‰«ææ—¶ï¼Œä¸Šè¿°ä¸¤ä¸ªé—®é¢˜æ›´å®¹æ˜“å‘ç”Ÿï¼Œè¿™ä¼šé™ä½å›¾åƒçš„è´¨é‡å’Œå¯è§£é‡Šæ€§ã€‚ç»“æœï¼ŒåŒ»ç”Ÿåœ¨è§£è¯»è¿™äº›å›¾åƒæ—¶å¯èƒ½ä¼šé‡åˆ°å›°éš¾ï¼Œå› ä¸ºå›¾åƒçš„ä¸æ¸…æ™°å’Œä¼ªå½±å¯èƒ½å¯¼è‡´è¯Šæ–­ä¸ä¸€è‡´æˆ–è¯¯è¯Šã€‚è¿™å°±å¼ºè°ƒäº†ä½¿ç”¨é«˜åˆ†è¾¨ç‡ã€è–„å±‚åˆ‡ç‰‡æ‰«æå’Œé«˜è´¨é‡æˆåƒè®¾å¤‡çš„é‡è¦æ€§ï¼Œä»¥æé«˜è¯Šæ–­çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚\né’ˆå¯¹ä¸Šè¿°è‚ºç»“èŠ‚çš„å¼‚è´¨æ€§ç‰¹å¾ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„æ··åˆæ‰‹åŠ¨ç‰¹å¾ï¼Œæ—¨åœ¨æä¾›é¢å¤–çš„è¾¹ç•Œå’Œç—…ç¶ä¿¡æ¯ï¼Œæ˜¾ç€æé«˜è‚ºç»“èŠ‚åˆ†å‰²çš„çµæ•åº¦ï¼Œå‡å°‘æ¼è¯Šçš„å‘ç”Ÿï¼Œé™ä½åƒç´ ç‚¹çš„å¯èƒ½æ€§é”™è¯¯åˆ†ç±»ã€‚ä¸ºäº†ä¿è¯åˆ†å‰²ç»“æœçš„å¯é æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨å¤šä½åŒ»å¸ˆæ ‡æ³¨ç»“æœçš„å¹³å‡å€¼ä½œä¸ºGroundTruthï¼Œå¹¶å¯¹å•ä½åŒ»å¸ˆæ ‡æ³¨çš„æ ·æœ¬è¿›è¡ŒäºŒæ¬¡ç­›é€‰ã€‚ä¸ºäº†ç¡®ä¿æ¨¡å‹åœ¨ä¸åŒæ•°æ®æºå’Œæ•°æ®è´¨é‡ä¸Šçš„é²æ£’æ€§ï¼Œæˆ‘ä»¬åœ¨ä¸åŒæ¥æºã€è´¨é‡å’Œå°ºåº¦çš„æ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œå¹¶åœ¨ä¸åŒæ•°æ®æºå’Œåˆ‡ç‰‡åšåº¦ä¸Šè¿›è¡ŒéªŒè¯ã€‚ä¸ºäº†æœ‰æ•ˆåœ°æ•´åˆä¸»ã€è¾…åˆ†æ”¯çš„ç‰¹å¾ä¿¡æ¯ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¤šç»´èåˆæ¨¡å—ï¼Œå¹¶ä»ç©ºé—´å’Œé€šé“ç»´åº¦è¿›è¡Œå­¦ä¹ ï¼Œä»¥å¢å¼ºç½‘ç»œçš„è¡¨ç¤ºå’Œæ³›åŒ–èƒ½åŠ›ã€‚æœ€åï¼Œæ‰€æå‡ºçš„ç½‘ç»œèƒ½å¤Ÿè¿›è¡Œä¸‰ç»´åˆ†å‰²ï¼Œæœ‰åˆ©äºç—…å˜ä¿¡æ¯çš„å…¨é¢è·å–ã€‚\nä¸‹é¢æ˜¯ Main Contribution\nï¼ˆaï¼‰æå‡ºäº†ä¸€ç§æ–°çš„ç«¯åˆ°ç«¯åŒåˆ†æ”¯ç½‘ç»œå’Œèåˆæ¨¡å—ï¼Œæœ‰æ•ˆå®Œæˆè‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡ï¼Œç®€å•æ˜“ç”¨ï¼Œæ³›åŒ–æ€§è¾ƒå¥½èƒ½åŠ›ã€‚\nï¼ˆbï¼‰æå‡ºäº†æ··åˆæ‰‹åŠ¨ç‰¹å¾æ¥åŒæ—¶å¢å¼ºè‚ºç»“èŠ‚è¾¹ç•Œä¿¡æ¯å’Œå¯¹æ¯”åº¦ä¿¡æ¯ã€‚\nï¼ˆcï¼‰æˆ‘ä»¬çš„æ–¹æ³•æ˜¾ç¤ºäº†åˆ†å‰²å„ç§ç±»å‹çš„è‚ºç»“èŠ‚çš„æ€§èƒ½æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯åœ¨ç»†å¾®çš„ã€æ··åˆçº¹ç†çš„ã€ç²˜è¿çš„ã€è‰¯æ€§çš„å’Œä¸ç¡®å®šçš„ç»“èŠ‚ä¸­ã€‚\n(d) ç ”ç©¶å¹¶æ€»ç»“äº†ä¸åŒå±‚åšå’Œå°ºå¯¸ä¸‹æ¨¡å‹çš„æ€§èƒ½å˜åŒ–å’Œæ¨¡å¼ã€‚\nRelated work ç›®å‰ï¼Œè‚ºéƒ¨ç»“èŠ‚çš„åˆ†å‰²æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥åˆ†ä¸ºåŸºäºç®—æ³•çš„ä¼ ç»Ÿåˆ†å‰²æ–¹æ³•å’Œæ•°æ®é©±åŠ¨çš„æ·±åº¦å­¦ä¹ åˆ†å‰²æ–¹æ³•ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•å­˜åœ¨æ˜æ˜¾çš„ç¼ºé™·ï¼Œç‰¹åˆ«æ˜¯å½“è‚ºç»“èŠ‚çš„è¾¹ç¼˜å˜å¾—æ¨¡ç³Šæ—¶ï¼Œå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™[15]ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ•°æ®é©±åŠ¨çš„æ–¹æ³•è¡¨ç°å‡ºæ›´å¥½çš„æ€§èƒ½[16]ã€‚\næ•°æ®é©±åŠ¨ç®—æ³• \u0026gt; ä¼ ç»Ÿåˆ†å‰²ç®—æ³• ==\u0026gt; è°ƒç ”æ•°æ®é©±åŠ¨ç®—æ³•çš„è®ºæ–‡ï¼Œåˆ©ç”¨æ•°æ®é©±åŠ¨æ¥åˆ›æ–°\nå¤šåˆ†æ”¯ç½‘ç»œæ¶æ„å¼•èµ·äº†å¹¿æ³›çš„å…³æ³¨å’Œç ”ç©¶ã€‚è¿™äº›ç»“æ„æ“…é•¿é›†æˆä¸åŒè§„æ¨¡ã€è§†è§’å’Œç»´åº¦çš„ä¸åŒç‰¹å¾ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ä¸ºäº†è§£å†³è‚ºç»“èŠ‚çš„å¼‚è´¨æ€§ä»¥åŠç»“èŠ‚ä¸å…¶å‘¨å›´ç¯å¢ƒçš„ç›¸ä¼¼æ€§çš„æŒ‘æˆ˜ï¼ŒWangç­‰äºº[17]å¼•å…¥äº†ä¸­å¤®èšç„¦å·ç§¯ç¥ç»ç½‘ç»œã€‚è¯¥ç½‘ç»œä» 2D å’Œ 3D CT å›¾åƒå—ä¸­æå–è‚ºç»“èŠ‚ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ä¸­å¤®æ± åŒ–å±‚ä¿ç•™ä¸­å¤®ä½ç½®çš„åŸºæœ¬ç»†èŠ‚ã€‚ Chenç­‰äºº[18]å¼•å…¥äº†Fast Multi-crop Guided Attentionï¼Œä¸€ç§åŸºäºæ®‹å·®çš„å¤šå°ºåº¦å¼•å¯¼åˆ†å‰²ç½‘ç»œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¯¥æ–¹æ³•æœ€åˆå°† 2D å’Œ 3D å›¾åƒè¾“å…¥å•ç‹¬çš„åˆ†æ”¯ç½‘ç»œï¼Œä»¥ä»å¤šç»´ç›¸é‚»è½´æ•è·ä¸Šä¸‹æ–‡ç‰¹å¾ä¿¡æ¯ã€‚éšåï¼Œé‡‡ç”¨å…¨å±€å·ç§¯å±‚æ¥æ„ŸçŸ¥å’Œèåˆä¸Šä¸‹æ–‡ç‰¹å¾ï¼ŒåŒæ—¶é€šè¿‡ä¸­å¤®æ± åŒ–å±‚å¢å¼ºå¯¹å›¾åƒå—çš„ä¸­å¿ƒåŒºåŸŸçš„å…³æ³¨ã€‚ Wangç­‰[19]æå‡ºäº†ä¸€ç§æé«˜ä¸è§„åˆ™è‚ºç»“èŠ‚åˆ†å‰²æ•ˆç‡çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¿æŒç®€å•ç»“èŠ‚çš„å‡†ç¡®åˆ†å‰²ã€‚ä»–ä»¬åˆ©ç”¨åŒåˆ†æ”¯æ¡†æ¶æ¥å¤„ç† CT å›¾åƒå’Œè¾¹ç•Œæ¢¯åº¦ä¿¡æ¯ï¼Œä½¿ç”¨å¯†é›†æ³¨æ„åŠ›æ¨¡å—æ¥å…³æ³¨å…³é”®ç»“èŠ‚ç‰¹å¾ï¼Œå¹¶ä½¿ç”¨å¤šå°ºåº¦é€‰æ‹©æ€§æ³¨æ„åŠ›æ¨¡å—æ¥è¿æ¥ä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚æ­¤å¤–ï¼Œä»–ä»¬å¼•å…¥äº†è¾¹ç•Œä¸Šä¸‹æ–‡å¢å¼ºæ¨¡å—æ¥åˆå¹¶å’Œå¢å¼ºè¾¹ç¼˜ç›¸å…³çš„ä½“ç´ ç‰¹å¾ï¼Œä»è€Œå®ç°ç®€å•å‹è‚ºç»“èŠ‚çš„å‡†ç¡®åˆ†å‰²ã€‚ Xuç­‰äºº[20]æå‡ºäº†ä¸€ç§ç”¨äºåˆ†å‰²éå…¸å‹ç»“èŠ‚çš„åŒç¼–ç èåˆç½‘ç»œã€‚ä»–ä»¬é¦–å…ˆä½¿ç”¨é‡‘å­—å¡”ä¸Šé‡‡æ ·æ–¹æ³•æ¥åˆ›å»ºå¹³æ»‘çš„ç—…å˜å›¾åƒï¼Œå¹¶å‡å°‘ CT å›¾åƒä¸­é«˜ç²’åº¦åƒç´ çš„å¹²æ‰°ã€‚ç„¶åï¼Œä»–ä»¬ä½¿ç”¨å…¨å±€å’Œå±€éƒ¨åˆ†æ”¯å¯¹ä¸Šé‡‡æ ·çš„ CT å›¾åƒå—å’ŒåŸå§‹å›¾åƒå—è¿›è¡Œç¼–ç ï¼Œä»¥æ•è·å…¨å±€å’Œå±€éƒ¨ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œä»–ä»¬é‡‡ç”¨äº†é‡‘å­—å¡”æ± åŒ–æ¨¡å—æ¥å¢å¼ºæœ¬åœ°åˆ†æ”¯çš„è¾“å‡ºç‰¹å¾ã€‚æœ€åï¼Œä»–ä»¬èåˆå¹¶è§£ç äº†æ¥è‡ªåŒåˆ†æ”¯çš„ç‰¹å¾ä¿¡æ¯ã€‚ Wangç­‰äºº[21]æå‡ºäº†ä¸€ç§æ··åˆæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆH-DLï¼‰ï¼Œç”¨äºåˆ†å‰²å„ç§å¤§å°å’Œå½¢çŠ¶çš„è‚ºç»“èŠ‚ã€‚è¯¥æ¨¡å‹ç»“åˆäº†åŸºäºVGG19çš„æµ…å±‚U-Netç½‘ç»œå’ŒåŸºäºå¯†é›†è¿æ¥çš„æ·±å±‚U-Netç½‘ç»œï¼Œå¢å¼ºäº†å¤æ‚è‚ºç»“èŠ‚åˆ†å‰²çš„å­¦ä¹ èƒ½åŠ›ã€‚ä¸ç‹¬ç«‹çš„ UNet ç»“æ„æ¨¡å‹ç›¸æ¯”ï¼Œå°†è¿™ä¸¤ä¸ªæ¨¡å‹é›†æˆåˆ°æ··åˆæ¨¡å‹ H-DL ä¸­è¯æ˜äº†åˆ†å‰²ç»“æœå¾—åˆ°äº†æ”¹å–„ã€‚\nåŸºæœ¬å—çš„è®¾è®¡å¯¹äºè‚ºç»“èŠ‚åˆ†å‰²ä¹Ÿå…·æœ‰é‡è¦æ„ä¹‰ã€‚ç ”ç©¶äººå‘˜æ¢ç´¢äº†å¤šç§è®¾è®¡æ¦‚å¿µæ¥æé«˜æ¨¡å‹æ€§èƒ½å’Œæ•ˆç‡ã€‚ Wangç­‰äºº[22]è®¾è®¡äº†ä¸€ä¸ªåŸºäºç©ºæ´å·ç§¯çš„æ·±åº¦å°ºåº¦æ„ŸçŸ¥æ¨¡å—æ¥èšåˆä¸Šä¸‹æ–‡ã€‚è¯¥æ¨¡å—å°†å…·æœ‰ä¸åŒæ‰©å¼ ç‡ï¼ˆ1ã€2å’Œ3ï¼‰çš„å¹¶è¡Œåˆ†æ”¯åµŒå…¥åˆ°ç“¶é¢ˆå±‚ä¸­ï¼Œä»¥æ•è·æ›´ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ã€‚ Agnesç­‰äºº[23]æå‡ºäº†ä¸€ç§å¤šå°ºåº¦å…¨å·ç§¯3D UNetæ¨¡å‹ï¼Œå…¶ä¸­ä½œè€…è®¾è®¡äº†ä¸€ä¸ªå¤šå°ºåº¦åŸºæœ¬å—ï¼Œä½¿ç”¨ $3Ã—3Ã—3$ å’Œ$5Ã—5Ã—5$ å·ç§¯ä»å„ç§å°ºåº¦ä¸­æå–ç‰¹å¾ä¿¡æ¯ã€‚ä»–ä»¬ä½¿ç”¨ Maxout æ¿€æ´»å‡½æ•°ä¼˜åŒ–å¤šå°ºåº¦ç‰¹å¾ä¿¡æ¯ï¼ŒæŠ‘åˆ¶ä½è´¡çŒ®ç‰¹å¾ã€‚ Chenç­‰äºº[15]æå‡ºäº†ä¸€ç§ç”¨äºåˆ†å‰²GGOçš„æ³¨æ„åŠ›çº§è”æ®‹å·®ç½‘ç»œã€‚è¯¥ç½‘ç»œé€šè¿‡æ®‹å·®ç»“æ„å’Œæ‰©å¼ çš„ç©ºé—´é‡‘å­—å¡”æ± æ¨¡å—æ•è·è‚ºç»“èŠ‚çš„ç‰¹å¾ä¿¡æ¯ã€‚åœ¨åå¤„ç†é˜¶æ®µï¼Œåº”ç”¨åŸºäºä½“ç´ çš„æ¡ä»¶éšæœºåœºæ¥è¿›ä¸€æ­¥ç»†åŒ–åˆ†å‰²ç»“æœã€‚ Zhouç­‰[3]ä»‹ç»äº†ä¸€ç§çº§è”çš„2.5Dè‚ºç»“èŠ‚æ£€æµ‹å’Œåˆ†å‰²æ–¹æ³•ã€‚åœ¨åˆ†å‰²ç½‘ç»œä¸­ï¼Œä½œè€…å°†å·ç§¯å—æ³¨æ„åŠ›æ¨¡å—ï¼ˆCBAMï¼‰[24]åˆå¹¶åˆ°ç¼–ç å™¨ä¸­ï¼Œä»¥å¢å¼ºç½‘ç»œçš„ç¼–ç èƒ½åŠ›ã€‚åœ¨ç“¶é¢ˆå±‚è®¾è®¡äº†ä¸åŒçš„å¤šå°ºåº¦å·ç§¯æ‰©å¼ ç‡ï¼Œä»¥å®ç°ç»“èŠ‚åŒºåŸŸçš„ç²¾ç»†åˆ†å‰²ã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å¯¹æŠ—æ€§ç”Ÿæˆç½‘ç»œè¿›è¡Œè‚ºç»“èŠ‚åˆ†å‰²ã€‚è®­ç»ƒæ•°æ®ç¨€ç¼ºå’Œç±»åˆ«ä¸å¹³è¡¡ä¸€ç›´æ˜¯å½±å“è‚ºç»“èŠ‚åˆ†å‰²æ€§èƒ½çš„å…³é”®å› ç´ ã€‚æ•°æ®ç¨€ç¼ºä¼šå¯¼è‡´è¿‡åº¦æ‹Ÿåˆæˆ–æ¨¡å‹æ”¶æ•›å¤±è´¥ï¼Œè€Œç±»åˆ«ä¸å¹³è¡¡åˆ™å¢åŠ äº†ç›®æ ‡åŒºåŸŸåˆ†å‰²çš„æŒ‘æˆ˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒSongç­‰äºº[25]æå‡ºäº†ä¸€ç§åŸºäºç”Ÿæˆå¯¹æŠ—ç½‘ç»œå¯¹å¤šç§ç±»å‹è‚ºç»“èŠ‚è¿›è¡Œå…¨è‡ªåŠ¨åˆ†å‰²çš„ç«¯åˆ°ç«¯æ¶æ„ã€‚è¯¥æ¨¡å‹åŒ…æ‹¬ä¸¤ä¸ªåˆ†æ”¯ã€‚ç¬¬ä¸€ä¸ªåˆ†æ”¯ç”¨äºæ½œåœ¨çš„è‚ºç»“èŠ‚åˆ†å‰²å’Œç»“èŠ‚ç”Ÿæˆã€‚ç¬¬äºŒä¸ªåˆ†æ”¯æ—¨åœ¨å‡å°‘ç¬¬ä¸€ä¸ªåˆ†æ”¯äº§ç”Ÿçš„æ½œåœ¨å‡é˜³æ€§ç»“èŠ‚ã€‚æ­¤å¤–ï¼ŒTyagi ç­‰äºº[26]å¼•å…¥äº†ä¸€ç§åŸºäºæ¡ä»¶ç”Ÿæˆç½‘ç»œçš„åˆ†å‰²æ–¹æ³•ã€‚è¯¥æ–¹æ³•åˆ©ç”¨ç”Ÿæˆå™¨ï¼ˆåŸºäºå…·æœ‰ç©ºé—´å’Œé€šé“æŒ¤å‹å’Œæ¿€åŠ±æ¨¡å—çš„ UNetï¼‰å’Œåˆ¤åˆ«å™¨è¿›è¡Œå¯¹æŠ—è®­ç»ƒæ¥å­¦ä¹ è®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬åˆ†å¸ƒï¼Œä»è€Œæé«˜åˆ†å‰²æ€§èƒ½ã€‚åœ¨Luna16æ•°æ®é›†ä¸Šï¼Œå…¶DSCå¾—åˆ†ä¸º80.74%ï¼Œçµæ•åº¦ä¸º85.46%ã€‚è¿™ä¸¤ç§æ–¹æ³•èƒŒåçš„åŠ¨æœºæ˜¯åˆ©ç”¨ç”Ÿæˆå¯¹æŠ—ç½‘ç»œçš„ç‰¹å¾æ¥å­¦ä¹ è‚ºç»“èŠ‚å†…çš„æŠ½è±¡ç‰¹å¾å¹¶ç”Ÿæˆé€‚ç”¨äºä¸´åºŠç¯å¢ƒçš„è®­ç»ƒæ ·æœ¬ã€‚è™½ç„¶è¿™ç§æ–¹æ³•åœ¨æœ‰è¶³å¤Ÿæ•°é‡çš„è®­ç»ƒæ ·æœ¬æ—¶æ˜¯å¯è¡Œçš„ï¼Œä½†ç”±äºè‚ºç»“èŠ‚æ•°æ®é›†ä¸­çš„æ ·æœ¬åˆ†å¸ƒä¸å¹³è¡¡ï¼Œå®ƒé¢ä¸´ç€æŒ‘æˆ˜ã€‚ç›®å‰ï¼Œç”Ÿæˆé«˜è´¨é‡å’Œå¤šæ ·åŒ–çš„æ•°æ®ä»ç„¶æ˜¯ä¸€ä¸ªé‡å¤§æŒ‘æˆ˜ã€‚\nMethod A. Pre-processing è‚ºç»“èŠ‚CTå›¾åƒé¢„å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š\n(a) Ground Truth: åŒä¸€ç»“èŠ‚çš„Mask æ ¹æ®è´¨å¿ƒåæ ‡è¿›è¡Œèšç±»ï¼Œå¹¶ä½¿ç”¨å¼€æºPyldcå·¥å…·åº“å¯¹ä¸åŒåŒ»ç”Ÿçš„æ³¨é‡Šè¿›è¡Œå¹³å‡ï¼Œçº§åˆ«è®¾ç½®ä¸º0.5[27]ã€‚ç„¶åè·å¾—çœŸå®å€¼ (GT)ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚\n(b) é‡æ–°é‡‡æ ·ï¼šå°†è£å‰ªåçš„è‚ºç»“èŠ‚åŒºåŸŸé‡æ–°é‡‡æ ·ä¸º 1 mmï¼Œå¹¶å°†ç”Ÿæˆçš„å›¾åƒå—å¤§å°è°ƒæ•´ä¸º 64Ã—64Ã—64 [28]ï¼Œ[29].\n(c) å½’ä¸€åŒ–å’Œæ··åˆç‰¹å¾ï¼šä½¿ç”¨Z-scoreå¯¹åŸå§‹å›¾åƒå—è¿›è¡Œæ ‡å‡†åŒ–ï¼Œå°†CTå›¾åƒè½¬æ¢ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œæé«˜ç½‘ç»œè®­ç»ƒçš„ç¨³å®šæ€§ã€‚æ··åˆç‰¹å¾é€šè¿‡å˜æ¢å’ŒåŠ æƒæ±‚å’Œï¼ŒåŒæ—¶ä¿ç•™äº†åˆ‡å½’ä¸€åŒ–åçš„å¯¹æ¯”åº¦ä¿¡æ¯ï¼ˆCut-normï¼Œeqï¼ˆ1ï¼‰ï¼‰å’Œ Sobelç®—å­çš„è¾¹ç•Œä¿¡æ¯ï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚è‚ºHUå€¼çš„åˆ‡å½’ä¸€åŒ–èŒƒå›´ä¸º**[-1000, 400]** [3]ï¼Œç„¶åå°†æˆªæ–­çš„ CT å›¾åƒæ˜ å°„åˆ° [0,1]ï¼Œä»è€Œæé«˜ CT å›¾åƒä¸­ä½å¯¹æ¯”åº¦ç»„ç»‡å’Œç»†èŠ‚çš„å¯è§†æ€§ï¼ŒåŒæ—¶å¢å¼ºç½‘ç»œçš„çµæ•åº¦ã€‚ Sobelç®—å­æ˜¯ä¸€ç§ç®€å•ä¸”ç¨³å®šçš„ç®—å­ï¼Œå¯ä»¥æœ‰æ•ˆçªå‡ºç»†å¾®ã€è¡€ç®¡æ—å’Œèƒ¸è†œæ—ç»“èŠ‚çš„è¾¹ç•Œä¿¡æ¯ã€‚å¦å¤–ï¼ŒPrewittç®—å­çš„æˆåƒç»“æœä¸Sobelç®—å­ç›¸ä¼¼ï¼Œå› æ­¤æ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„ç ”ç©¶ã€‚\nB. Overall Design of the Dual-branch network åŒåˆ†æ”¯ç½‘ç»œ (DBNet) çš„æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚å®ƒä»£è¡¨äº†ä¸€ç§ç«¯åˆ°ç«¯è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¿¡æ¯ç¼–ç å’Œè§£ç ä¸¤ä¸ªé˜¶æ®µã€‚åœ¨ç¼–ç é˜¶æ®µï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸»ç½‘ç»œå’Œè¾…åŠ©ç½‘ç»œæ¦‚å¿µã€‚ä¸»ç½‘ç»œï¼ˆ$En_raw$ï¼‰ä»¥åŸå§‹CTå›¾åƒä½œä¸ºè¾“å…¥ï¼Œè€Œè¾…åŠ©ç½‘ç»œï¼ˆ$En_aid$ï¼‰åˆ™åˆ©ç”¨æ··åˆç‰¹å¾å›¾åƒä½œä¸ºè¾“å…¥ã€‚ä¸»ã€è¾…åˆ†æ”¯çš„è¾“å…¥å›¾åƒå—å¤§å°ä¸º $Image^{CÃ—HÃ—WÃ—D}{raw}$ , $Image^{CÃ—HÃ—WÃ—D}{help}$ âˆˆ $R^{1Ã—64Ã—64Ã—64}$ï¼Œå…¶ä¸­ $C$ã€$H$ã€$W$ã€$D$è¡¨ç¤ºè¾“å…¥é€šé“ã€é•¿åº¦ã€å®½åº¦å’Œæ·±åº¦ã€‚ç¼–ç é˜¶æ®µæ€»å…±åŒ…æ‹¬5ä¸ªç¼–ç å—å’Œ4æ¬¡ä¸‹é‡‡æ ·æ“ä½œï¼Œä¸åŒç¼–ç é˜¶æ®µçš„ç‰¹å¾å›¾å¯ä»¥è¡¨ç¤ºä¸º $f^i_r$ , $f^i_a$ , $i$ âˆˆ [1, 5]ï¼Œ$r$ å’Œ $a$ è¡¨ç¤ºä¸»åˆ†æ”¯å’Œè¾…åŠ©åˆ†æ”¯ï¼Œç‰¹å¾å›¾ä» $32 Ã— 64 Ã— 64 Ã— 64$ è¿‡æ¸¡åˆ° $64 Ã— 32 Ã— 32 Ã— 32$ï¼Œç„¶åè¿‡æ¸¡åˆ° $128 Ã— 16 Ã— 16 Ã— 16$ã€$256 Ã— 8 Ã— 8 Ã— 8$ï¼Œæœ€åè¿‡æ¸¡åˆ° $512 Ã— 4 Ã— 4 Ã— 4$\nåœ¨è§£ç é˜¶æ®µï¼Œé‡‡ç”¨åŒåˆ†æ”¯è®¾è®¡ï¼Œå‡å°‘ç½‘ç»œå‚æ•°å’Œè®¡ç®—é‡ï¼ŒåŒæ—¶æä¾›æ›´å¤šçš„ç‰¹å¾é€‰æ‹©å’Œæ›´å¼ºçš„æ³›åŒ–èƒ½åŠ›ã€‚é’ˆå¯¹åŒåˆ†æ”¯ç‰¹å¾ä¿¡æ¯çš„èåˆè®¾è®¡ï¼Œæå‡ºäº†å¤šç»´èåˆæ¨¡å—ï¼Œä»å¤šä¸ªç»´åº¦çš„ç©ºé—´é€šé“ä¸­æå–ç‰¹å¾ä¿¡æ¯ã€‚ç„¶åï¼Œæ³¨æ„åŠ›æ¨¡å—çš„è¾“å‡ºç‰¹å¾å›¾å°†è¢«ä¸Šé‡‡æ ·å¹¶ä¸ç›¸åº”çš„ç¼–ç é˜¶æ®µç‰¹å¾å›¾ $ f^i_r $ å’Œ $f^i_a$ èåˆï¼Œå…¶ä¸­ $i$ âˆˆ [1,4]ï¼Œä»¥è¡¥å¿ä¸‹é‡‡æ ·è¿‡ç¨‹é€ æˆçš„ä¿¡æ¯æŸå¤±ã€‚è¯¥èåˆè¿‡ç¨‹é‡å¤å››æ¬¡ï¼Œä»¥é€æ¸é¢„æµ‹è‚ºç»“èŠ‚åŒºåŸŸã€‚ç»è¿‡ $3Ã—3Ã—3$ å·ç§¯çš„ç‰¹å¾æå–å’Œä¼˜åŒ–åï¼Œå¾—åˆ°é¢„æµ‹çš„è‚ºç»“èŠ‚åŒºåŸŸä¸º $Output^{1Ã—64Ã—64Ã—64}$ âˆˆ [0,1]ã€‚è®¾ç½®é˜ˆå€¼0.5ï¼Œå¦‚æœè¯¥å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¯¥åƒç´ è¢«è®¤ä¸ºæ˜¯è‚ºç»“èŠ‚çš„ä¸€éƒ¨åˆ†ï¼›å¦åˆ™ï¼Œå®ƒè¢«è§†ä¸ºèƒŒæ™¯çš„ä¸€éƒ¨åˆ†ã€‚\nç½‘ç»œçš„åŸºæœ¬å•å…ƒåŒ…æ‹¬å·ç§¯ï¼ˆConvï¼‰ã€BatchNormï¼ˆBNï¼‰å’ŒSwishæ¿€æ´»å‡½æ•°[30]ï¼Œç»Ÿç§°ä¸ºCBSã€‚ BN åŠ é€Ÿç½‘ç»œæ”¶æ•›å¹¶å¢å¼ºå…¶è¡¨è¾¾èƒ½åŠ›ï¼Œè€Œ Swish æ¿€æ´»å‡½æ•°å¯ä»¥å‡è½»ä¸æ›´æ·±ç½‘ç»œç›¸å…³çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚å¯è®­ç»ƒå‚æ•° $beta$ = 1.0 åŠ¨æ€è°ƒæ•´ Swish æ¿€æ´»å‡½æ•°çš„å½¢çŠ¶ï¼Œä»¥æ›´å¥½åœ°é€‚åº”è‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡ï¼Œå¦‚ï¼ˆ2ï¼‰æ‰€ç¤ºï¼Œå…¶ä¸­ $Ïƒ$ è¡¨ç¤º sigmoid æ¿€æ´»å‡½æ•°ã€‚å°†åŸºæœ¬å—çš„æ•°é‡å¢åŠ åˆ°2ï¼Œå¹¶æ·»åŠ æ®‹å·®è¿æ¥ï¼Œå¾—åˆ°æ®‹å·®åŸºæœ¬å—RCBSã€‚\nC. Design of the Multi-Dimensional Fusion Module å¤šç»´èåˆæ¨¡å—ï¼ˆMDFMï¼‰ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé€šé“æŒ¤å‹æ´—ç‰Œæ³¨æ„åŠ›æ¨¡å—ï¼ˆCESAï¼‰å’Œè½´å‘å¤šå°ºåº¦ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼ˆAMSAï¼‰ï¼Œæ¨¡å—è®¾è®¡å’Œå†…éƒ¨æ³¨æ„åŠ›å˜åŒ–[31]å¦‚å›¾5æ‰€ç¤ºï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºæ–¹ç¨‹3è‡³æ–¹ç¨‹5ã€‚\n1) Channel Extrusion Shuffle Attention Module é€šé“æŒ¤å‹æ´—ç‰Œæ³¨æ„åŠ›æ¨¡å— (CESA) çš„è¾“å…¥æ¥è‡ªåŒåˆ†æ”¯ç¼–ç å™¨çš„çº§è”è¾“å‡ºç‰¹å¾å›¾ã€‚åœ¨ä¼˜åŒ–é€šé“ç‰¹å¾ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨è‡ªé€‚åº”å‡å€¼æ± åŒ–å’Œè‡ªé€‚åº”æœ€å¤§æ± åŒ–å°†ç‰¹å¾å›¾èšåˆä¸º $CÃ—1Ã—1Ã—1$ï¼Œå¹¶ä½¿ç”¨CBSåŸºæœ¬å—æ¥èåˆä¸¤ç±»ç‰¹å¾ä¿¡æ¯ã€‚å¤šå°ºåº¦è®¾è®¡å¯ä»¥æ‰©å¤§ç½‘ç»œçš„æ„Ÿå—é‡ï¼Œè·å¾—æ›´ä¸°å¯Œçš„å±€éƒ¨ç»†èŠ‚å’Œå…¨å±€ä¿¡æ¯ã€‚å—è¿™ä¸€æ€æƒ³çš„å¯å‘ï¼Œåœ¨é€šé“ç»´åº¦ä¸Šå¯¹é€šé“ç‰¹å¾è¿›è¡Œå¤šå°ºåº¦é‡‡æ ·ï¼Œåœ¨ä¸æ”¹å˜èåˆç‰¹å¾å›¾å¤§å°çš„æƒ…å†µä¸‹ä¼˜åŒ–ç‰¹å¾ä¿¡æ¯ã€‚é€šé“å¤šå°ºåº¦æ¶‰åŠé€šé“ç»´åº¦ä¸Šçš„é™ç»´å’Œæ‰©å±•æ“ä½œï¼Œæ·±åº¦ä¾æ¬¡ä¸º $C/2$ã€$C/4$ã€$C/8$ã€$C/16$ã€‚æ­¤å¤–ï¼Œé€šè¿‡å¯†é›†è¿æ¥è®¾è®¡ï¼Œç½‘ç»œçš„è¡¨è¾¾å’Œæ³›åŒ–èƒ½åŠ›å¾—åˆ°è¿›ä¸€æ­¥å¢å¼ºï¼Œè¯¥è¿‡ç¨‹ç§°ä¸ºâ€œæŒ¤å‡ºâ€ã€‚é€šé“æ··æ´—æ“ä½œå°†é€šé“åˆ†ä¸º8ç»„ï¼Œå¹¶é€šè¿‡æ··æ´—é€šé“å†…çš„ç‰¹å¾ä¿¡æ¯å¼•å…¥ä¸€å®šç¨‹åº¦çš„éšæœºæ€§å’Œå¤šæ ·æ€§ã€‚ç„¶åå°†æ‰“ä¹±åçš„ç‰¹å¾æ·»åŠ åˆ°æŒ¤å‹æ“ä½œåçš„ç‰¹å¾å›¾ä¸Šï¼Œæœ€åé€šè¿‡ç‚¹ç§¯æ“ä½œæ¢å¤ç‰¹å¾å›¾ã€‚åˆ©ç”¨Sigmoidï¼ˆÏƒï¼‰æ–¹æ³•ï¼Œå°†ç‰¹å¾å›¾è½¬æ¢ä¸º[0,1]ä¹‹é—´çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå¹¶å°†æ³¨æ„åŠ›æƒé‡æ˜ å°„åˆ°åŸå§‹ç‰¹å¾å›¾ã€‚\n2) Axial Multiscale Spatial Attention Module å‡†ç¡®æ•è·è‚ºç»“èŠ‚çš„ç©ºé—´ä½ç½®ã€çº¹ç†å’Œå½¢çŠ¶ä¿¡æ¯å¯¹äºåˆ†å‰²ä»»åŠ¡è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œæå‡ºäº†è½´å‘å¤šå°ºåº¦ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ $7 Ã— 7 Ã— 7 $ çª—å£å¤§å°çš„ CBS å—æ¥æ„ŸçŸ¥å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶ä»¥ 8ã€16ã€32 å’Œ 64 çš„å‹ç¼©æ¯” (r) å‹ç¼©ç‰¹å¾å›¾é€šé“ã€‚å‹ç¼©åçš„ç‰¹å¾ä¿¡æ¯ä¸ä»…æ›´åŠ å…³æ³¨ç©ºé—´ç»´åº¦ç‰¹å¾ï¼Œè€Œä¸”å‡å°‘äº†ç½‘ç»œå‚æ•°å’Œè®¡ç®—é‡ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨çª—å£å¤§å° $HÃ—3Ã—3$ ã€$3Ã—WÃ—3$ å’Œ $3Ã—3Ã—D$ çš„åŸºæœ¬å—æ¥æ„ŸçŸ¥ Coronalã€Sagittal å’Œ Axis æ–¹å‘çš„ç‰¹å¾å›¾ï¼Œå…¶ä¸­ Hã€W å’Œ D åˆ†åˆ«æ˜¯ç‰¹å¾å›¾å°ºå¯¸ï¼Œä»è€Œæ•è·ä¸åŒå¹³é¢**ï¼ˆå† çŠ¶çŸ¢çŠ¶ã€çŸ¢çŠ¶è½´ã€å† çŠ¶çŸ¢çŠ¶ï¼‰**çš„å±€éƒ¨ä¿¡æ¯ä»¥åŠä¸åŒè½´å‘çš„å…¨å±€ä¿¡æ¯ã€‚è¿™ç§è®¾è®¡æœ‰åŠ©äºå¼ºè°ƒå’Œçªå‡ºè‚ºç»“èŠ‚çš„å…³é”®ç‰¹å¾ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œè¡¨è¾¾å¤šç»´æ•°æ®ä¸­çš„ç‰¹å¾ã€‚å¯¹å¤šç»´ç‰¹å¾ä¿¡æ¯è¿›è¡Œæ±‡æ€»ï¼Œå¹¶åˆ©ç”¨æ®‹å·®è¿æ¥è¡¥å……æ¢¯åº¦ä¿¡æ¯ã€‚æœ€ååˆ©ç”¨ $7Ã—7Ã—7$ çš„å·ç§¯æ ¸æ¥æ¢å¤ç‰¹å¾å›¾ï¼Œå®Œæˆç©ºé—´ç‰¹å¾ä¿¡æ¯çš„æå–ã€‚\nD. Loss Function Diceç›¸ä¼¼ç³»æ•°[32]ï¼ˆDSCï¼‰æ˜¯ä¸€ç§ç›¸ä¼¼æ€§æµ‹é‡å‡½æ•°ï¼Œé€šå¸¸ç”¨äºè®¡ç®—ä¸¤ä¸ªæ ·æœ¬çš„ç›¸ä¼¼æ€§ã€‚ DSC âˆˆ [0,1]ï¼Œå€¼è¶Šå°è¡¨æ˜**æ¨¡å‹é¢„æµ‹ç»“æœ **ä¸ çœŸå®æ ‡ç­¾å·®è·è¶Šå¤§ã€‚\nå…¶ä¸­ $P$ è¡¨ç¤ºäºŒè¿›åˆ¶é¢„æµ‹ç»“æœåƒç´ çš„é›†åˆï¼Œ$G$ è¡¨ç¤ºäºŒè¿›åˆ¶çœŸå®æ ‡ç­¾ç»“æœçš„é›†åˆã€‚ $| P âˆ© G |$ è¡¨ç¤º $P $ å’Œ $G$ çš„äº¤é›†ã€‚\nExperiments A. Datasets æœ¬æ–‡åœ¨å…¶å®éªŒè®¾ç½®ä¸­ä»‹ç»äº†å››ä¸ªæ•°æ®é›†ï¼š\nï¼ˆ1ï¼‰LIDCï¼š è‚ºéƒ¨å›¾åƒæ•°æ®åº“è”ç›Ÿå’Œå›¾åƒæ•°æ®åº“èµ„æºå€¡è®® (LIDC) æ•°æ®é›†æ˜¯å…¨çƒæœ€å¤§çš„å…¬å¼€è‚ºç™Œæ•°æ®é›†ã€‚å®ƒåŒ…æ‹¬æ¥è‡ªå¤šå®¶åŒ»é™¢çš„ 1, 018 ä¸ªç ”ç©¶ç—…ä¾‹ï¼ŒåŒ…å« 11 ç§ä¸åŒåšåº¦ç±»å‹çš„æ•°æ®ï¼Œæœ€å¤šæœ‰å››ååŒ»ç”Ÿåœ¨ CT å›¾åƒä¸­æ³¨é‡Šç—…å˜ä¿¡æ¯ [8]ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚é¦–å…ˆï¼Œç›´å¾„ä¸º 3mm æˆ– 3mm çš„ç»“èŠ‚ç”±è‡³å°‘ä¸¤ååŒ»ç”Ÿæ³¨é‡Šçš„è¾ƒå¤§çš„è¢«ä¿ç•™[21]ã€‚ç„¶åï¼Œå¯¹ç”±ä¸€ååŒ»ç”Ÿæ³¨é‡Šçš„ç»“èŠ‚è¿›è¡ŒäºŒæ¬¡ç­›æŸ¥ï¼Œä»¥å»é™¤ä¸ç¡®å®šæˆ–æ³¨é‡Šé”™è¯¯çš„æ ·æœ¬ï¼Œæ€»å…±å¾—åˆ° 2, 615 ä¸ªè‚ºç»“èŠ‚æ ·æœ¬ã€‚\n2ï¼‰Luna16ï¼š Luna16 æ•°æ®é›†æ˜¯ LIDC æ•°æ®é›†çš„å­é›†ï¼Œæ—¨åœ¨è§£å†³ LIDC æ•°æ®é›†ä¸­ CT åˆ‡ç‰‡åšåº¦å˜åŒ–å’Œæ•°æ®è´¨é‡ç­‰é—®é¢˜ã€‚ Luna16æ•°æ®é›†æ€»å…±åŒ…æ‹¬1186ä¸ªè‚ºç»“èŠ‚æ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬ç”±ä¸‰åæˆ–æ›´å¤šåŒ»ç”Ÿæ³¨é‡Šï¼Œç›´å¾„ä¸º3æ¯«ç±³æˆ–æ›´å¤§ï¼Œåˆ‡ç‰‡åšåº¦ä¸º2.5æ¯«ç±³æˆ–æ›´å°[33]ã€‚\n(3) å¤šåšåº¦åˆ‡ç‰‡å›¾åƒæ•°æ®é›†(mThickSImg)ï¼š å‰”é™¤Luna16è‚ºç»“èŠ‚æ ·æœ¬åï¼Œå…±è·å¾—1429ä¸ªå¤šå±‚ç»“èŠ‚ï¼Œä¸»è¦ç”¨äºå†…æ¨¡å‹æ€§èƒ½æµ‹è¯•ï¼Œå®éªŒæ•°æ®çš„æ ·æœ¬åˆ†å¸ƒå¦‚å›¾7æ‰€ç¤ºã€‚\n(4) UniToChestï¼š UniToChest [34] æ•°æ®é›†åŒ…æ‹¬ 306,440 ä¸ªåŒ¿åèƒ¸éƒ¨ CT æ‰«æåˆ‡ç‰‡å’Œç›¸åº”çš„è‚ºç»“èŠ‚åˆ†å‰²æ©æ¨¡ã€‚è¿™äº›æ•°æ®æ¥è‡ª623åä¸åŒçš„æ‚£è€…ï¼Œç»è¿‡å¤„ç†å’Œç­›é€‰åï¼Œæ€»å…±è·å¾—äº†211å¼ ç»“èŠ‚å¤§å°ä»3åˆ°35mmçš„å¤šå±‚CTå›¾åƒç”¨äºå¤–éƒ¨æµ‹è¯•é›†ã€‚\nB. Lung nodule characteristic attributes classification LIDC æ•°æ®é›†æ€»å…±åŒ…å«ç”±åŒ»ç”Ÿæ³¨é‡Šçš„ 9 ä¸ªè§†è§‰ç‰¹å¾ã€‚åœ¨è¯¥å®éªŒä¸­ï¼Œå»é™¤äº†å†…éƒ¨ç»“æ„å’Œé’™åŒ–ç‰¹æ€§ï¼Œå¹¶é‡æ–°å®šä¹‰äº†è‰¯æ€§å’Œæ¶æ€§çš„åˆ†ç±»[35]ï¼ŒåŒæ—¶è¿˜çº³å…¥äº†è‚ºç»“èŠ‚çš„å¤§å°[24]ã€‚ä¸ºäº†ä¿è¯å¤šä¸ªåŒ»å¸ˆå¯¹åŒä¸€è‚ºç»“èŠ‚æ ‡æ³¨çš„ä¸€è‡´æ€§ï¼Œè‚ºç»“èŠ‚å±æ€§åˆ†ç±»é‡‡ç”¨ä¸¤ç§ç­–ç•¥ï¼šï¼ˆ1ï¼‰è‰¯æ¶æ€§è‚ºç»“èŠ‚çš„å®šä¹‰æ˜¯å¤šä¸ªåŒ»å¸ˆå¯¹ç»“èŠ‚æ ‡æ³¨ç»“æœçš„ä¸­ä½æ•° [35]ã€‚ (2)å…¶ä»–ç‰¹å¾å±æ€§é€šè¿‡æŠ•ç¥¨è¿‡ç¨‹è·å¾—ã€‚è‚ºç»“èŠ‚å±æ€§åˆ†ç±»å¦‚è¡¨1æ‰€ç¤ºã€‚\nC. Evaluation Metrics åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç²¾åº¦ï¼ˆPREï¼‰ã€çµæ•åº¦ï¼ˆSENï¼‰ã€éª°å­ç›¸ä¼¼ç³»æ•°ï¼ˆDSCï¼‰å’Œå¹¶é›†å¹³å‡äº¤é›†ï¼ˆmIoUï¼‰ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ï¼Œå¦‚æ–¹ç¨‹ï¼ˆ7ï¼‰è‡³ï¼ˆ10ï¼‰æ‰€ç¤ºã€‚ True Positiveï¼ˆTPï¼‰è¡¨ç¤ºæ­£ç¡®åˆ†å‰²çš„ç„¦ç‚¹åŒºåŸŸï¼ŒTrue Negativeï¼ˆTNï¼‰è¡¨ç¤ºæ­£ç¡®åˆ†å‰²çš„æ­£å¸¸ç»„ç»‡åŒºåŸŸï¼ŒFalse Positiveï¼ˆFPï¼‰è¡¨ç¤ºæ­£å¸¸ç»„ç»‡åŒºåŸŸè¢«é”™è¯¯åœ°åˆ†å‰²ä¸ºç„¦ç‚¹åŒºåŸŸï¼ŒFalse Negativeï¼ˆFNï¼‰è¡¨ç¤ºç„¦ç‚¹åŒºåŸŸè¢«é”™è¯¯åœ°åˆ†å‰²ä¸ºæ­£å¸¸ç»„ç»‡åŒºåŸŸã€‚\nD. Training Details æœ¬å®éªŒä½¿ç”¨Ubuntu 18.04.3 LTSæ“ä½œç³»ç»Ÿä½œä¸ºå®éªŒåŸºç¡€å¹³å°ã€‚ CPUå‹å·ä¸ºIntel(R)Xeon(R)-Gold 6140ï¼Œå†…å­˜å¤§å°ä¸º187.4Gï¼Œè½¯ä»¶ç¯å¢ƒä¸ºPython 3.8ã€Conda 10.1ã€Pytorch 1.8.1åœ¨Tesla V100-SXM2-32GBæ˜¾å¡ä¸Šå®éªŒã€‚\nå®éªŒéµå¾ªæ‰€æœ‰ CAD æ–¹æ³•çš„ä¸€è‡´è®¾ç½®ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œæ•°æ®é›†è¢«åˆ†ä¸º5ä¸ªå­é›†ï¼Œæ¯ä¸ªå­é›†å¾ªç¯ç”¨ä½œéªŒè¯é›†ï¼Œå…¶ä½™4ä¸ªå­é›†ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚åº”ç”¨æ•°æ®å¢å¼ºæŠ€æœ¯ï¼ŒåŒ…æ‹¬æ°´å¹³å’Œå‚ç›´ç¿»è½¬ã€æ—‹è½¬å’Œå¹³ç§»ï¼Œæ¥å¢å¼ºè®­ç»ƒæ ·æœ¬å¹¶å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚æœ€ç»ˆçš„æ€§èƒ½è¯„ä¼°åŸºäº5å€äº¤å‰éªŒè¯è·å¾—çš„å¹³å‡ç»“æœã€‚ Adam ä¼˜åŒ–å™¨ [37] çš„åˆå§‹å­¦ä¹ ç‡ä¸º 3e-4ï¼Œæ‰¹é‡å¤§å°ä¸º 12ï¼Œæœ€å¤š 500 æ¬¡è®­ç»ƒè¿­ä»£ã€‚ä½¿ç”¨çš„æŸå¤±å‡½æ•°æ˜¯ Dice æŸå¤±ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨æå‰åœæ­¢æœºåˆ¶æ¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚åœ¨ 50 è½®è®­ç»ƒä¸­ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°è¾ƒå°çš„æŸå¤±ï¼Œæ¨¡å‹è®­ç»ƒå°†ç»“æŸã€‚\nResult A. CAD model performance comparison å¦‚è¡¨2æ‰€ç¤ºï¼Œæ‰€æå‡ºçš„æ–¹æ³•ä¸ä¸€äº›æœ€è¿‘ä¼˜ç§€çš„CADæ¨¡å‹è¿›è¡Œäº†æ¯”è¾ƒã€‚æ ¹æ®æ ·æœ¬æ•°é‡å’Œé€‰æ‹©ç­–ç•¥ï¼Œè¿™äº›æ–¹æ³•åˆ†ä¸ºå°æ ·æœ¬è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•å’Œä¸€èˆ¬æ ·æœ¬æ•°é‡è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•çš„ç­›é€‰æ ‡å‡†åˆ—äºè¡¨ä¸­ã€‚åœ¨ä½¿ç”¨å°æ ·æœ¬é‡çš„è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æå‡ºçš„æ¨¡å‹åœ¨åŒ…å« 1,186 ä¸ªç»“èŠ‚çš„ Luna16 æ•°æ®é›†ä¸Šå®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œé€šè¿‡ 5 folder äº¤å‰éªŒè¯å®ç°äº†æœ€é«˜ DSC 87.68%ï¼ˆæœ€ä½³ï¼‰å’Œ 86.89%ï¼ˆå¹³å‡ï¼‰ã€‚å°±æ•´ä½“ DSC è€Œè¨€ï¼Œè¿™æ¯”å½“å‰é¡¶çº§å°æ ·æœ¬æ–¹æ³• DS-CMSF é¢†å…ˆ 0.93%ã€‚è¿™è¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•åœ¨ç›¸å¯¹è¾ƒå°çš„è®­ç»ƒæ ·æœ¬é‡ä¸‹çš„æœ‰æ•ˆæ€§ã€‚æ­¤å¤–ï¼Œä¸ºäº†ç ”ç©¶å¤§æ ·æœ¬é‡çš„æ€§èƒ½ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ LIDC æ•°æ®é›†ä¸­çš„ 2,618 ä¸ªèŠ‚ç‚¹é›†ä¸Šè¿›è¡Œäº†è®­ç»ƒã€‚æˆ‘ä»¬å–å¾—äº†æœ€ä½³ DSC åˆ†æ•°å’Œå¹³å‡ DSC åˆ†æ•°åˆ†åˆ«ä¸º 85.42% å’Œ 84.12%ï¼Œæ˜¾ç€ä¼˜äºå½“å‰é¢†å…ˆçš„ LNHG æ¨¡å‹ï¼ˆ82.05%ï¼‰å’Œå…¶ä»–ä¸»æµç®—æ³•ã€‚\næ€»ä½“è€Œè¨€ï¼Œä¸åŒæ•°æ®é‡ä¸‹çš„æµ‹è¯•ç»“æœè¡¨æ˜æœ¬æ–‡æ–¹æ³•å…·æœ‰è¾ƒå¼ºçš„ç¨³å®šæ€§å’Œæ³›åŒ–èƒ½åŠ›ã€‚\nB. Ablation studies åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯¹æ‰€æå‡ºçš„ CAD æ¨¡å‹çš„ä¸åŒéƒ¨åˆ†è¿›è¡Œäº†æ¶ˆèç ”ç©¶ï¼Œä»¥è¯„ä¼°å®ƒä»¬å¯¹æ€§èƒ½çš„è´¡çŒ®ã€‚æ¶ˆèç ”ç©¶ä¸­ä½¿ç”¨çš„æ¨¡å‹æ˜¯åŸºäº Luna16 æ•°æ®é›†è¿›è¡Œè®­ç»ƒçš„ã€‚\nåœ¨å½±å“æ¨¡å‹æ€§èƒ½çš„å› ç´ ä¸­ï¼Œç ”ç©¶äººå‘˜æ™®éè®¤ä¸ºæ¨¡å‹è§„æ¨¡æ˜¯å…³é”®å› ç´ ã€‚ç›®å‰ï¼Œå¤§å¤šæ•°å­¦è€…å€¾å‘äºä½¿ç”¨ $64Ã—64Ã—64$ çš„ patchå¤§å°ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚æŒ‰ç…§æ­¤è®¾ç½®ï¼Œæ¨¡å‹çš„åˆå§‹é€šé“æ•°è®¾ç½®ä¸º32ï¼Œè€ƒè™‘åˆ°è¾“å…¥å¤§å°çš„çº¦æŸï¼Œæ¨¡å‹çš„æœ€å¤§ä¸‹é‡‡æ ·æ¬¡æ•°è®¾ç½®ä¸º4ã€‚æ­¤æ—¶ï¼Œç“¶é¢ˆå±‚çš„è¾“å…¥å¤§å°ä¸º $4 Ã— 4 Ã— 4$ ï¼Œ512 ä¸ªé€šé“ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬è®¾è®¡äº†å››ç§åŒåˆ†æ”¯åˆ†å‰²æ¨¡å‹ï¼ˆç§°ä¸ºæ¨¡å‹Aã€Bã€Cå’ŒDï¼‰ï¼Œæ·±åº¦åˆ†åˆ«ä¸º2ã€3ã€4å’Œ5å±‚ã€‚è¿™äº›æ¨¡å‹å‡ä½¿ç”¨CBAMæ¨¡å—ä½œä¸ºåŒåˆ†æ”¯æ¨¡å‹çš„èåˆæ¨¡å—ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œéšç€ç½‘ç»œæ·±åº¦å’Œé€šé“æ•°çš„å¢åŠ ï¼Œæ¨¡å‹æ€§èƒ½å‘ˆç°å‡ºä¸æ–­å¢åŠ çš„è¶‹åŠ¿ï¼ŒDSCä»80.61%ä¸Šå‡åˆ°85.8%ï¼Œå¦‚è¡¨3æ‰€ç¤ºã€‚å› æ­¤ï¼Œå¾—å‡ºç»“è®ºï¼šåœ¨è¾“å…¥å°ºå¯¸ä¸º64Ã—64Ã—64çš„æƒ…å†µä¸‹ï¼Œæœ¬ç ”ç©¶æ¨¡å‹çš„æœ€ä½³æ·±åº¦ä¸º5ï¼Œç“¶é¢ˆå±‚æœ‰512ä¸ªé€šé“ã€‚\nå®éªŒä¸­ä¸»è¦æ¢ç´¢äº†ä¸¤ç±»è¾…åŠ©ç‰¹å¾ã€‚ä¸€ç§æ˜¯åˆ©ç”¨Cut-normæ¥çªå‡ºç—…å˜çš„ç‰¹å¾ä¿¡æ¯ï¼Œå¦ä¸€ç§æ–¹æ³•ä¸»è¦åˆ©ç”¨Sobelæ¢¯åº¦ç®—å­æ¥å¢å¼ºè¾¹ç•Œä¿¡æ¯ã€‚åœ¨æœ€ä½³æ¨¡å‹è§„æ¨¡çš„è®¨è®ºä¸­ï¼Œæ‰€æœ‰æ¨¡å‹å‡ä½¿ç”¨Z-scoreæ ‡å‡†æ–¹æ³•è¿›è¡Œè®­ç»ƒã€‚è®­ç»ƒè¿™ä¸¤ä¸ªæ‰‹åŠ¨ç‰¹å¾å¹¶ä¸æ¨¡å‹ D è¿›è¡Œæ¯”è¾ƒåï¼Œå‘ç°ä½¿ç”¨ Cut-norm çš„æ¨¡å‹ E å’Œä½¿ç”¨ Sobel ç®—å­çš„æ¨¡å‹ F åœ¨ DSC ä¸­åˆ†åˆ«ä¸æ¨¡å‹ D ç›¸å·® 0.61% å’Œ 0.78%ã€‚è¿™è¯´æ˜äº†è¯¥è¾…åŠ©åˆ†æ”¯ç­–ç•¥çš„æœ‰æ•ˆæ€§ã€‚æ­¤å¤–ï¼Œè¿›ä¸€æ­¥éªŒè¯äº†Sobelç®—å­åœ¨ä¸åŒæ•°æ®å°ºåº¦ä¸‹çš„æœ‰æ•ˆæ€§ï¼Œå‘ç°æ¨¡å‹Då’Œæ¨¡å‹Fåœ¨LIDCæ•°æ®é›†ä¸Šçš„DSCæ€§èƒ½åˆ†åˆ«è¾¾åˆ°83.56%å’Œ83.82%ï¼Œç›¸å·®0.26%ã€‚è¿™è¡¨æ˜ï¼Œå³ä½¿åœ¨æ›´å¤§è§„æ¨¡çš„æµ‹è¯•é›†ä¸­ï¼ŒSobelç®—å­ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤ï¼Œæš‚æ—¶å°†Sobelç®—å­ç”¨ä½œè¾…åŠ©ç‰¹å¾ã€‚\nè¿›ä¸€æ­¥åŸºäºSobelç®—å­ä½œä¸ºè¾…åŠ©ç‰¹å¾ï¼Œæå‡ºäº†é€šé“æŒ¤å‹æ´—ç‰Œæ³¨æ„åŠ›æ¨¡å—å’Œè½´å‘å¤šå°ºåº¦ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼Œå³æ¨¡å‹Gå’Œæ¨¡å‹Hï¼Œæ¨¡å‹æ€§èƒ½æœ€ä¼˜è¾¾åˆ°86.63%ã€‚æœ€åï¼Œä¸ºäº†åŒæ—¶ä¿ç•™é«˜å¯¹æ¯”åº¦ç—…å˜åŒºåŸŸå’Œçªå‡ºæ˜¾ç¤ºçš„è¾¹ç•Œç»†èŠ‚ä»¥æ–¹ä¾¿å­¦ä¹ ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜æ¢æ“ä½œå’ŒåŠ æƒæ±‚å’Œæ¥æ•´åˆè¿™ä¸¤ä¸ªç‰¹å¾ã€‚é€šè¿‡è¿™ç§ç­–ç•¥ï¼Œæœ¬æ–‡æå‡ºçš„æ–¹æ³•è·å¾—äº† 86.89% DSC çš„æœ€ä½³ç»“æœï¼Œè¶…è¿‡äº†å•ç‹¬ä½¿ç”¨ Sobel æ»¤æ³¢å™¨ç‰¹å¾çš„æ€§èƒ½ã€‚ç›´æ¥çš„æ€§èƒ½æå‡éªŒè¯äº†æˆ‘ä»¬è¾…åŠ©åŠŸèƒ½çš„æœ‰æ•ˆæ€§ã€‚\nè™½ç„¶æ¨¡å‹ H å’Œæˆ‘ä»¬çš„æ•´ä½“æ€§èƒ½å·®è·å¹¶ä¸æ˜¾ç€ï¼Œä½†æ¨¡å‹ H åœ¨å†…éƒ¨æ•°æ®é›†ä¸­çš„ DSC æ€§èƒ½ä¸º 63.03%ï¼Œå¯¹äº GGO ç±»å‹è¯„ä¼°çš„çµæ•åº¦ä¸º 62.42%ã€‚ç„¶è€Œï¼Œä½¿ç”¨æ··åˆç‰¹å¾çš„è¿›ä¸€æ­¥æ›¿ä»£å¯¼è‡´çµæ•åº¦å’Œ DSC æ€§èƒ½æ˜¾ç€æé«˜ï¼Œåˆ†åˆ«è¾¾åˆ° 65.27% å’Œ 65.08%ã€‚è§‚å¯Ÿæ¨¡å‹Gã€Hå’ŒOursçš„æ”¶æ•›é€Ÿåº¦ï¼Œéšç€æ³¨æ„åŠ›æ¨¡å—æ•°é‡çš„å¢åŠ å’Œæ··åˆç‰¹å¾çš„æ›¿æ¢ï¼Œæ¨¡å‹æ‹Ÿåˆæ‰€éœ€çš„epoché€æ¸å¢åŠ ï¼Œä½†ç»¼åˆè€ƒè™‘ï¼Œæ€»ä½“è´¹ç”¨æ˜¯å€¼å¾—çš„ã€‚\nC. Comparison experiments of different datasets and segmentation CADs æœ¬èŠ‚å°†æˆ‘ä»¬çš„æ–¹æ³•ä¸å¼€æºåŒ»å­¦åˆ†å‰²æ¨¡å‹ UNet [38]ã€UNet++ [28]ã€ReconNet [39]ã€Unetr [40] å’Œ Asa [41] åœ¨ä¸åŒæ•°æ®é›†ä¸Šçš„æµ‹è¯•ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚ç»“æœå¦‚è¡¨IVæ‰€ç¤ºã€‚æ€»ä½“è€Œè¨€ï¼Œè¯¥æ–¹æ³•åœ¨ Luna16 æ•°æ®é›†ä¸Šå®ç°äº† 86.89% çš„ DSCï¼Œåˆ†åˆ«é¢†å…ˆ UNet å’Œ ReconNet æ¨¡å‹ 1.38% å’Œ 0.77%ã€‚åœ¨åŸºäºTransformerçš„æ–¹æ³•ä¸­ï¼Œåœ¨DSCæ–¹é¢ï¼Œå®ƒä»¥4.01%å’Œ2.66%çš„ä¼˜åŠ¿è¶…è¿‡äº†Unetrå’ŒASAã€‚æ•´ä½“æ€§èƒ½è¶…è¿‡äº†ç»å…¸å’Œç°æœ‰çš„ä¼˜ç§€åˆ†å‰²æ¨¡å‹ã€‚å…·ä½“è€Œè¨€ï¼Œè¯¥æ–¹æ³•çš„ç²¾åº¦ä¸º87.13%ï¼Œçµæ•åº¦ä¸º87.02%ã€‚æ›´é«˜çš„çµæ•åº¦å¯ä»¥æ›´å¥½åœ°è¯†åˆ«ç»“èŠ‚ï¼Œé˜²æ­¢æ¼è¯Šï¼›è€Œæ›´é«˜çš„ç²¾åº¦ä¸ºåŒ»ç”Ÿæä¾›äº†æ›´å¯é çš„åˆ†å‰²åŒºåŸŸï¼Œå‡å°‘è¯¯è¯Šã€‚è¿™å¯¹äºè‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡è‡³å…³é‡è¦ã€‚æ­¤å¤–ï¼Œè¯¥æ–¹æ³•å®ç°äº†é«˜ mIoUï¼Œè¡¨æ˜é¢„æµ‹ä¸çœŸå®æƒ…å†µä¹‹é—´æœ‰æ›´å¤§çš„é‡å ã€‚å¯ä»¥å¾ˆå¥½åœ°åˆ†å‰²å¤§éƒ¨åˆ†è‚ºéƒ¨ç—…å˜åŒºåŸŸï¼Œè¾…åŠ©åˆç†è¯Šæ–­ï¼Œæœ‰åˆ©äºä¸´åºŠä½¿ç”¨ã€‚\néšåï¼Œæ‰€æœ‰æ–¹æ³•éƒ½åœ¨å†…éƒ¨ mThickImgs æ•°æ®é›†å’Œå¤–éƒ¨ UniToChest æ•°æ®é›†ä¸Šè¿›è¡Œäº†éªŒè¯ã€‚åœ¨è¿™ä¸¤ä¸ªæ•°æ®é›†ä¸Šï¼ŒUNet++ è¾¾åˆ°äº†æœ€é«˜çš„ç²¾åº¦ï¼Œä½†çµæ•åº¦è¾ƒä½ã€‚è¿™è¡¨æ˜ UNet++ åœ¨çœŸé˜³æ€§åŒºåŸŸä¸­å‡é˜´æ€§çš„æ¯”ä¾‹è¾ƒå¤§ï¼Œä¸¢å¤±äº†æ›´å¤šæ ·æœ¬å¹¶æœ€ç»ˆå½±å“äº†çµæ•åº¦æŒ‡æ ‡ã€‚è¿™ç§ä¸å¹³è¡¡å¯¹äºä¸´åºŠç›®çš„æ˜¯æœ‰å®³çš„ã€‚æ­¤å¤–ï¼ŒReconNetåœ¨mThickImgsæ•°æ®é›†ä¸­å…·æœ‰è¾ƒé«˜çš„çµæ•åº¦ã€‚æˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸­å®ç°äº† 75.32% å’Œ 80.64% DSCï¼Œåˆ†åˆ«è¶…è¿‡æ¬¡ä¼˜æ–¹æ³• 0.57% å’Œ 0.59%ï¼Œå®éªŒç»“æœå†æ¬¡è¯æ˜äº†æˆ‘ä»¬æ–¹æ³•å¼ºå¤§çš„æ³›åŒ–èƒ½åŠ›ã€‚\næ€»ä½“è€Œè¨€ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸åŒæ•°æ®é›†çš„æŒ‡æ ‡ä¸Šæ¯”å…¶ä»–æœ€å…ˆè¿›çš„3D CADæ¨¡å‹å…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨çµæ•åº¦å’ŒDSCè¿™ä¸¤ä¸ªæœ€å…³é”®çš„åˆ†å‰²æ€§èƒ½æŒ‡æ ‡æ–¹é¢ï¼ŒéªŒè¯äº†æˆ‘ä»¬æ–¹æ³•çš„åˆ†å‰²èƒ½åŠ›åœ¨å¤šæºåŒ»å­¦å›¾åƒä¸­ã€‚\nAnalysis of lung nodule performance A. Effect of different layer thicknesses on model performance æˆ‘ä»¬åˆ†æäº† mThickSImg æ•°æ®é›†ä¸­è‚ºç»“èŠ‚çš„åˆ†å¸ƒï¼Œå¹¶æ£€æŸ¥äº†ä¸åŒ CT åˆ‡ç‰‡åšåº¦å’Œå°ºå¯¸çš„ç»“èŠ‚æ€§èƒ½å˜åŒ–ã€‚æˆ‘ä»¬å°†æ•°æ®åˆ†ä¸ºå…­ç»„ï¼Œæ•°æ®æ ·æœ¬åˆ†å¸ƒå¦‚è¡¨å…­æ‰€ç¤ºã€‚ç„¶åå¯¹ä¸åŒçš„CADæ¨¡å‹è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å°†ä¸åŒæ¨¡å‹çš„å¹³å‡æµ‹è¯•ç»“æœä½œä¸ºæœ€ç»ˆçš„æ€§èƒ½è¶‹åŠ¿ï¼Œå¦‚è¡¨5æ‰€ç¤ºã€‚\næˆ‘ä»¬çš„æ–¹æ³•æ˜¯åŸºäº2.5mmå±‚åšåº¦ä»¥ä¸‹çš„æ ·æœ¬è¿›è¡Œè®­ç»ƒçš„ï¼Œé€šè¿‡è§‚å¯Ÿç²¾åº¦ï¼Œæˆ‘ä»¬å‘ç°åœ¨1.5mmå’Œ1.5mm ~ 2.5mmçš„æ¯”è¾ƒä¸­ï¼Œç½‘ç»œçš„çµæ•åº¦éšç€å±‚åšåº¦çš„å‡å°è€Œå¢åŠ ã€‚\nå¦å¤–ï¼Œåœ¨è§‚å¯ŸDSCæ€§èƒ½æ—¶ï¼Œæ³¨æ„åˆ°DSCæ€§èƒ½éšç€å±‚åšåº¦çš„å¢åŠ è€Œå¢åŠ ã€‚ç„¶è€Œï¼Œä¼¼ä¹å­˜åœ¨éšç€å±‚åšåº¦å‡å°çµæ•åº¦å¢åŠ è€ŒDSCé™ä½çš„ç°è±¡ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ç°è±¡å‘¢ï¼Ÿä¸€æ–¹é¢ï¼Œè¿™ç§è¶‹åŠ¿å¯èƒ½ä¼šå—åˆ°æ•°æ®åˆ†å¸ƒã€æ ·æœ¬æ•°é‡å’Œæ ·æœ¬æ ‡ç­¾çš„å½±å“è€Œæœ‰äº›åå·®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéšç€ CT å±‚åšåº¦çš„å¢åŠ ï¼Œå›¾åƒåˆ†è¾¨ç‡ä¼šé™ä½ï¼Œå¯èƒ½å¯¼è‡´ç¥ç»ç½‘ç»œéš¾ä»¥æ•è·æ›´ç²¾ç»†çš„ç‰¹å¾å’Œç»“æ„ã€‚\nå› æ­¤ï¼Œç”±äºè¾ƒåšçš„ CT å±‚ä¸­è¯¦ç»†ä¿¡æ¯çš„ä¸¢å¤±ï¼Œç½‘ç»œéšç€å±‚åšåº¦çš„å¢åŠ è€Œè¡¨ç°å‡ºè¾ƒä½çš„çµæ•åº¦ã€‚å¦ä¸€æ–¹é¢ï¼Œè™½ç„¶å±‚åšåº¦çš„å‡å°‘æé«˜äº† CT å›¾åƒçš„å±‚å†…åˆ†è¾¨ç‡ï¼Œå¹¶èƒ½å¤Ÿæ›´å‡†ç¡®åœ°å‘ˆç°è§£å‰–ç»“æ„å’Œç—…å˜ï¼Œä½†åŒæ—¶ä¹Ÿå‡å°‘äº†æ¥æ”¶åˆ°çš„å…‰å­æ•°é‡ã€‚ä¸è¾ƒåšçš„å›¾åƒç›¸æ¯”ï¼Œå…‰å­è®¡æ•°çš„å‡å°‘å¯èƒ½ä¼šå¯¼è‡´å™ªå£°å¢åŠ å’Œå¯¹æ¯”åº¦é™ä½ã€‚è¿™äº›å› ç´ ä¼šå¯¹è‚ºç»“èŠ‚ï¼ˆå°¤å…¶æ˜¯ GGOï¼‰çš„åˆ†å‰²äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå¯èƒ½å¯¼è‡´éªŒè¯é›†çš„æ€§èƒ½ä¸‹é™ã€‚\næˆ‘ä»¬è¿˜å‘ç°ï¼Œåœ¨åŸºäºè–„å±‚å›¾åƒè¿›è¡Œè®­ç»ƒç„¶ååœ¨åšå±‚å›¾åƒä¸Šè¿›è¡ŒéªŒè¯åï¼Œç½‘ç»œè¡¨ç°å‡ºæ›´å¥½çš„æ€§èƒ½ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œæ›´è–„çš„ CT å›¾åƒç”±äºå…·æœ‰æ›´é«˜çš„åˆ†è¾¨ç‡å’Œæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ æ›´å¾®å¦™çš„ç‰¹å¾ã€‚è¿™äº›ç»†å¾®çš„ç‰¹å¾åœ¨2.5mmä»¥ä¸Šçš„å±‚åšå›¾åƒä¸­å…·æœ‰æ›´å¼ºçš„æ³›åŒ–èƒ½åŠ›ï¼Œè¿™æ˜¯åŸºäºåšå±‚æ•°æ®æ‰€ä¸å…·å¤‡çš„ã€‚å› æ­¤ï¼Œè¿™ç§ç°è±¡å¯èƒ½è¡¨æ˜å…³äºå±‚åšåº¦æ•ˆåº”çš„æ›´å¥½çš„æ€§èƒ½ã€‚\nB. Heterogeneity analysis of lung nodules æœ¬èŠ‚æ¼”ç¤ºä¸åŒåˆ†å‰²æ¨¡å‹åœ¨Luna16æ•°æ®é›†å’ŒmThickSImgæ•°æ®é›†ä¸Šçš„æµ‹è¯•æ€§èƒ½ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šçš„å¤§å¤šæ•°è‚ºç»“èŠ‚åˆ†å‰²å±æ€§ä¸Šéƒ½å–å¾—äº†é¢†å…ˆçš„ç»“æœ\n1) Subtle feature è‚ºç»“èŠ‚çš„æ—©æœŸè¯Šæ–­å’Œæ²»ç–—å¯¹äºç–¾ç—…çš„è¯Šæ–­å…·æœ‰é‡è¦æ„ä¹‰ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œåœ¨Luna16æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å’ŒUNetåœ¨ â€œExtremely Subtleâ€ å±æ€§å’Œâ€œModerately Subtleâ€å±æ€§çš„åˆ†å‰²ä¸Šè¡¨ç°æ›´å¥½ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ–¹æ³•ä»…æ¬¡äºUNetçš„æ–¹æ³•ï¼Œè¾¾åˆ°äº†70.99%å’Œ76.69%ã€‚åœ¨mThickImgsæµ‹è¯•é›†ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨æ‰€æœ‰Subtletyç‰¹å¾å±æ€§ä¸Šéƒ½è¾¾åˆ°äº†æœ€ä½³æ€§èƒ½ï¼Œâ€œExtremely Subtleâ€å’Œâ€œModerately Subtleâ€å±æ€§åˆ†åˆ«è¶…è¿‡UNetå’ŒReconNet 2.75ï¼…ã€1.03ï¼…å’Œ2.33ï¼…ã€0.94ï¼… ã€‚ UNetç½‘ç»œåœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸­è¡¨ç°å‡ºä¸åŒçš„æ€§èƒ½å˜åŒ–ï¼Œè¿™å¹¶ä¸æ’é™¤æ•°æ®åˆ†å¸ƒå’Œæ•°æ®è´¨é‡çš„å½±å“ã€‚ç”±äºåŒåˆ†æ”¯å’Œæ··åˆç‰¹å¾çš„è®¾è®¡ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ mThickImgs æµ‹è¯•é›†ä¸Šå¯¹â€œExtremely Subtleâ€å±æ€§å’Œâ€œModerately Subtleâ€å±æ€§åˆ†å‰²æœ‰è¾ƒå¤§çš„æ€§èƒ½æå‡ï¼Œè¿™è¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•å…·æœ‰å¾ˆå¼ºçš„æ³›åŒ–èƒ½åŠ›å’Œé²æ£’æ€§ï¼Œå¹¶æé«˜äº†ä¸´åºŠä½¿ç”¨çš„å¯é æ€§ã€‚ Extremely Subtle GGO çš„åˆ†å‰²ç»“æœå¦‚å›¾ 10-(1) æ‰€ç¤ºã€‚\n2) Texture feature è§‚å¯Ÿä¸¤ä¸ªæ•°æ®é›†ä¸­â€œTextureâ€ç‰¹å¾çš„æµ‹è¯•ç»“æœå¯ä»¥å‘ç°ï¼Œåœ¨Luna16æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨â€œSolid/Mixedâ€å’Œâ€œNonSolid/Mixedâ€ç±»åˆ«ä¸Šè¡¨ç°å‡ºäº†å¾ˆå¤§çš„è¿›æ­¥ï¼Œåˆ†åˆ«ä¸º2.73%ä¸æ¬¡ä¼˜æ–¹æ³•ç›¸æ¯”ï¼Œåˆ†åˆ«æé«˜äº† 1.62% å’Œ 1.62%ã€‚åœ¨ mThickSImg æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ GGO ç±»å’Œâ€œNonSolid/Mixedâ€ç±»ä¸­è¾¾åˆ°äº† 65.08% å’Œ 70.2%ï¼Œåˆ†åˆ«é¢†å…ˆæ¬¡ä¼˜ 0.35% å’Œ 1.33%ã€‚\nè™½ç„¶å¯¹äº GGO æ ·è‚ºç»“èŠ‚ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ²¡æœ‰æ˜¾ç€æ”¹è¿›ï¼Œä½†å¯¹äºå…·æœ‰æ··åˆçº¹ç†çš„ç»“èŠ‚ï¼Œæˆ‘ä»¬çš„æ–¹æ³•è¿›ä¸€æ­¥å‡è½»äº†åˆ†å‰²æŒ‘æˆ˜ã€‚å›ºä½“/æ··åˆåˆ†å‰²ç»“æœå¦‚å›¾10-ï¼ˆ3è‡³7ï¼‰æ‰€ç¤ºã€‚\n3) Maligancy feature è‰¯æ€§å’Œæ¶æ€§çš„åŒºåˆ†æ˜¯è‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡çš„å…³é”®ç‰¹å¾ã€‚è‰¯æ€§ç»“èŠ‚å¸¸å‘ˆåœ†å½¢æˆ–æ¤­åœ†å½¢ï¼Œè€Œæ¶æ€§ç»“èŠ‚å¾€å¾€ä½“ç§¯è¾ƒå¤§ï¼Œå¹¶æœ‰æ˜æ˜¾çš„é’ˆçŠ¶æˆ–åˆ†å¶çŠ¶ç‰¹å¾ã€‚ä¸¤ä¸ªæ•°æ®é›†çš„æµ‹è¯•ç»“æœè¡¨æ˜ï¼Œä¸ç¡®å®šå±æ€§çš„åˆ†å‰²ç»“æœæœ€å·®ï¼Œå…¶æ¬¡æ˜¯è‰¯æ€§ç»“èŠ‚ã€‚æˆ‘ä»¬çš„æ–¹æ³•æ”¹è¿›äº†è¿™ä¸‰ç±»å±æ€§çš„åˆ†å‰²ï¼Œä¸æ¬¡ä¼˜æ–¹æ³•ã€ä¸ç¡®å®šå’Œæ¶æ€§åˆ†å‰²ç›¸æ¯”ï¼Œåœ¨ Luna16 æ•°æ®é›†ä¸­å¢åŠ äº† 0.73%ï¼ˆè‰¯æ€§ï¼‰ã€0.28%ï¼ˆä¸ç¡®å®šï¼‰å’Œ 0.87%ï¼ˆæ¶æ€§ï¼‰å¦‚å›¾10ï¼ˆ1ã€2ï½7ï¼‰æ‰€ç¤ºã€‚åœ¨mThickSImgæµ‹è¯•é›†ä¸­ï¼Œè¯¥æ–¹æ³•çš„æ€§èƒ½æå‡æ›´ä¸ºæ˜¾ç€ï¼Œåˆ†åˆ«é¢†å…ˆ1%ï¼ˆè‰¯æ€§ï¼‰ã€0.83%ï¼ˆä¸ç¡®å®šï¼‰å’Œ0.61%ï¼ˆæ¶æ€§ï¼‰ã€‚æé«˜è‚ºç»“èŠ‚è‰¯æ€§å’Œä¸ç¡®å®šæ€§çš„åˆ†å‰²æ€§èƒ½å¯¹äºä¸´åºŠè¯Šæ–­è‡³å…³é‡è¦ã€‚é‡‡ç”¨ç›¸åŒçš„CADæ–¹æ³•å¯¹è¿™ä¸¤ç±»ç»“èŠ‚è¿›è¡Œåˆ†å‰²å¯ä»¥æœ‰æ•ˆè§‚å¯Ÿå…¶å‘å±•è¶‹åŠ¿ã€‚ä¸åŒ»ç”Ÿæ‰‹å·¥å‹¾ç”»ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•æé«˜äº†è¯Šæ–­çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚\n4) Other features é™¤äº†ä¸Šè¿°ä¸‰ç§å¸¸è§ä¸”å…·æœ‰æŒ‘æˆ˜æ€§çš„åˆ†å‰²ç‰¹å¾å¤–ï¼Œè‚ºç»“èŠ‚çš„â€œçƒå½¢â€ã€â€œè¾¹ç¼˜â€ã€â€œåˆ†å¶â€å’Œâ€œæ¯›åˆºâ€ç‰¹å¾å¯¹ä¸´åºŠè¯Šæ–­å…·æœ‰ä¸€å®šçš„æŒ‡å¯¼æ„ä¹‰ã€‚è§‚å¯Ÿâ€œçƒå½¢â€ç‰¹å¾ï¼Œå¯ä»¥å‘ç°å½“å‰æ–¹æ³•åœ¨å¸¸è§çš„â€œåµå½¢æˆ–åœ†å½¢â€å±æ€§ä¸Šè¡¨ç°å‡ºæ›´å¥½çš„æ€§èƒ½ã€‚ä¸€æ–¹é¢å®ƒæœ‰æ›´å¤šçš„è®­ç»ƒæ ·æœ¬ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ›´ç®€å•åœ°åˆ†å‰²è¯¥ç±»çš„æ ·æœ¬ã€‚æˆ‘ä»¬çš„æ–¹æ³•åœ¨ mThickSImg æ•°æ®é›†ä¸­çš„â€œçº¿æ€§â€å’Œâ€œåµå½¢/çº¿æ€§â€ç—…å˜å½¢çŠ¶å±æ€§ä¸­è¡¨ç°å‡ºæ˜¾ç€ä¼˜åŠ¿ï¼Œå¯¼è‡´â€œçº¿æ€§â€å’Œâ€œåµå½¢/çº¿æ€§â€å±æ€§ä¸­çš„ DSC æ¬¡ä¼˜ï¼Œåˆ†åˆ«ä¸º 2.74% å’Œ 1.81% ã€‚çº¿æ€§åˆ†å‰²ç»“æœå¦‚å›¾10-(6)æ‰€ç¤ºã€‚è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ Luna16 æ•°æ®é›†çš„ Margin ç‰¹å¾ä¸­çš„äº”ä¸ªå±æ€§ä¸Šæ˜¾ç¤ºå‡ºå·¨å¤§çš„æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯â€œPoorly Definedâ€å±æ€§ã€‚\nåœ¨ mThickImgs æµ‹è¯•é›†ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨äº”ä¸ªå±æ€§ä¸Šåˆ†åˆ«ä¸æ¬¡ä¼˜å€¼ç›¸å·® 0.65%ã€0.93%ã€0.7%ã€0.94% å’Œ 1.02%ï¼Œè¿™ä¹Ÿè¡¨æ˜è¾…åŠ©ç‰¹å¾å¯ä»¥å‡è½»å›¾åƒè¾¹ç•Œçš„å¤æ‚æ€§ã€‚ç—…å˜åŒºåŸŸã€‚åˆ†å¶å’Œæ¯›åˆºæ˜¯åˆ¤æ–­æ¶æ€§ç¨‹åº¦çš„é‡è¦æŒ‡æ ‡ã€‚è¿™äº›ç‰¹å¾å¯ä»¥å¸®åŠ©åŒ»ç”ŸåŒºåˆ†ç»“èŠ‚è¾¹ç¼˜çš„è§„å¾‹æ€§ï¼Œå¹¶æœ‰åŠ©äºå¯¹ç»“èŠ‚è¿›è¡Œåˆæ­¥åˆ†ç±»å’Œè§‚å¯Ÿã€‚\nå¯ä»¥çœ‹å‡ºï¼Œä¸æ¬¡ä¼˜ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ mThickImgs æ•°æ®é›†çš„æ€§èƒ½æ–¹é¢è¡¨ç°å‡ºäº†æ˜¾ç€çš„æ”¹è¿›ã€‚ç„¶è€Œï¼Œâ€œæ ‡è®°åˆ†å¶â€å’Œâ€œæ ‡è®°æ¯›åˆºâ€ç‰¹å¾å±æ€§çš„åˆ†å‰²ä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ã€‚åœ¨ä¸åŒå°ºå¯¸çš„ç»“èŠ‚ä¸­ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨åˆ†å‰²3åˆ°6mmèŒƒå›´å†…çš„å®æ€§ç»“èŠ‚æ–¹é¢ä¹Ÿè¡¨ç°å‡ºäº†ä¸€å®šçš„æ€§èƒ½æ”¹è¿›ã€‚\nä¸æ¬¡ä¼˜æ–¹æ³•ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸¤ä¸ªæµ‹è¯•é›†ä¸­åˆ†åˆ«æé«˜äº† 0.73% å’Œ 1.39%ã€‚ç„¶è€Œï¼Œåœ¨â€œSubSolidâ€ä¸­ï¼Œå¤§å¤šæ•°æ–¹æ³•æ²¡æœ‰è¡¨ç°å‡ºæ˜¾ç€å·®å¼‚ã€‚\nCONCLUSION æˆ‘ä»¬æå‡ºäº†ä¸€ç§ç®€å•æœ‰æ•ˆçš„åŒåˆ†æ”¯ç½‘ç»œåˆ†å‰²æ–¹æ³•ã€‚äº”æŠ˜äº¤å‰éªŒè¯çš„ç»“æœè¡¨æ˜ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿæœ‰æ•ˆã€ç¨³å®šåœ°æ‰§è¡Œåˆ†å‰²ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯¹å¤§å¤šæ•°è‚ºç»“èŠ‚çš„ç‰¹å¾ç‰¹å¾å’Œå¤æ‚æ•°æ®æ ·æœ¬çš„åˆ†å‰²å…·æœ‰ä¸€å®šçš„é€‚ç”¨æ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç»†å¾®çš„ã€çº¹ç†æ··åˆçš„ã€è¾¹ç•Œæ¨¡ç³Šçš„ã€è‰¯æ€§çš„å’Œä¸ç¡®å®šçš„ç»“èŠ‚ï¼Œå¯ä»¥å¤§å¤§é™ä½ä¸´åºŠåº”ç”¨çš„éš¾åº¦ï¼Œå¹¶æä¾›ä¸ºåŒ»ç”Ÿæä¾›æ›´å¯é çš„å‚è€ƒã€‚\nè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ã€‚é¦–å…ˆï¼Œè™½ç„¶æ··åˆç‰¹å¾è®¾è®¡ä¿ç•™äº†è¾¹ç•Œå’Œå¯¹æ¯”åº¦ä¿¡æ¯ï¼Œä½†å®ƒé—´æ¥å¼•å…¥äº†é¢å¤–çš„å™ªå£°ï¼Œè¿™å¯èƒ½ä¼šå¹²æ‰°ç½‘ç»œçš„ç‰¹å¾å­¦ä¹ ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨â€œSubsolidâ€å°ç»“èŠ‚çš„åˆ†å‰²æ–¹é¢æ²¡æœ‰è¡¨ç°å‡ºæ˜¾ç€çš„æ€§èƒ½æ”¹è¿›ï¼Œæœªæ¥å¯èƒ½ä¼šå°è¯•æ›´æ·±æˆ–æ›´è¯¦ç»†çš„å¤šå°ºåº¦è®¾è®¡æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚å¦å¤–ï¼Œç”±äºå®éªŒæ•´ä½“é‡‡ç”¨å¤šä½åŒ»å¸ˆæ ‡æ³¨çš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆçš„GTï¼Œä¸€å®šç¨‹åº¦ä¸Šä¿è¯äº†ç»“æœçš„å‡†ç¡®æ€§ã€‚ä½†ä¹Ÿå¯èƒ½å¯¼è‡´æœ€ç»ˆçš„GTä¸å®é™…æƒ…å†µå­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´åŒºåŸŸä¸å®Œæ•´æˆ–æœ‰åˆºçŠ¶ç­‰è¯¦ç»†ä¿¡æ¯ä¸¢å¤±ï¼Œå¦‚å›¾10-(7)æ‰€ç¤ºï¼Œå¯¹â€œMarked Lobulationâ€çš„åˆ†å‰²æå‡ºæŒ‘æˆ˜â€å’Œâ€œæ ‡è®°æ¯›åˆºâ€å±æ€§ã€‚æœªæ¥ï¼Œå¯èƒ½ä¼šå¼€å‘å¤šç½®ä¿¡åŒºåŸŸæ–¹æ³•æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚\nè¯»å®Œçš„ç¬¬ä¸€æ„Ÿè§‰ï¼š å¤ªé•¿äº†\u0026hellip;.\n","permalink":"https://swimmingliu.cn/posts/papernotes/2023-dbnet/","summary":"\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eè‚ºç™Œæ˜¯å…¨çƒæœ€è‡´å‘½çš„ç™Œç—‡ä¹‹ä¸€ï¼Œæ—©æœŸè¯Šæ–­å¯¹äºæ‚£è€…çš„ç”Ÿå­˜è‡³å…³é‡è¦ã€‚\u003cstrong\u003eè‚ºç»“èŠ‚\u003c/strong\u003eæ˜¯\u003cstrong\u003eæ—©æœŸè‚ºç™Œçš„ä¸»è¦è¡¨ç°\u003c/strong\u003eï¼Œé€šå¸¸é€šè¿‡ \u003cstrong\u003eCT æ‰«æ\u003c/strong\u003eè¿›è¡Œè¯„ä¼°ã€‚å¦‚ä»Šï¼Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿè¢«å¹¿æ³›ç”¨äºè¾…åŠ©åŒ»ç”Ÿè¿›è¡Œç–¾ç—…è¯Šæ–­ã€‚\u003cstrong\u003eè‚ºç»“èŠ‚çš„å‡†ç¡®åˆ†å‰²\u003c/strong\u003eå—åˆ°\u003cstrong\u003eå†…éƒ¨å¼‚è´¨æ€§å’Œå¤–éƒ¨æ•°æ®\u003c/strong\u003eå› ç´ çš„å½±å“ã€‚ä¸ºäº†å…‹æœ\u003cstrong\u003eç»“èŠ‚çš„ç»†å¾®ã€æ··åˆã€ç²˜é™„å‹ã€è‰¯æ€§å’Œä¸ç¡®å®šç±»åˆ«\u003c/strong\u003eçš„åˆ†å‰²æŒ‘æˆ˜ï¼Œæå‡ºäº†ä¸€ç§æ–°çš„\u003cstrong\u003eæ··åˆæ‰‹åŠ¨ç‰¹å¾ç½‘ç»œ\u003c/strong\u003eï¼Œå¯\u003cstrong\u003eå¢å¼ºçµæ•åº¦å’Œå‡†ç¡®æ€§\u003c/strong\u003eã€‚è¯¥æ–¹æ³•é€šè¿‡\u003cstrong\u003eåŒåˆ†æ”¯ç½‘ç»œæ¡†æ¶å’Œå¤šç»´èåˆæ¨¡å—\u003c/strong\u003eé›†æˆ\u003cstrong\u003eç‰¹å¾ä¿¡æ¯\u003c/strong\u003eã€‚é€šè¿‡ä½¿ç”¨\u003cstrong\u003eå¤šä¸ªæ•°æ®æºå’Œä¸åŒæ•°æ®è´¨é‡\u003c/strong\u003eè¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ \u003cstrong\u003eLUNA16\u003c/strong\u003eã€\u003cstrong\u003eå¤šåšåº¦åˆ‡ç‰‡å›¾åƒæ•°æ®é›† (Multi-thickness Slice Image dataset)\u003c/strong\u003eã€\u003cstrong\u003eLIDC\u003c/strong\u003e å’Œ \u003cstrong\u003eUniToChest\u003c/strong\u003e ä¸Šè¡¨ç°å‡ºé¢†å…ˆçš„æ€§èƒ½ï¼ŒDice ç›¸ä¼¼ç³»æ•°è¾¾åˆ° 86.89%ã€75.72%ã€84.12% å’Œ 80.74åˆ†åˆ«è¶…è¿‡äº†å½“å‰å¤§å¤šæ•°è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ã€‚æˆ‘ä»¬çš„æ–¹æ³•è¿›ä¸€æ­¥æé«˜äº†è‚ºç»“èŠ‚åˆ†å‰²ä»»åŠ¡çš„\u003cstrong\u003eå‡†ç¡®æ€§ã€å¯é æ€§å’Œç¨³å®šæ€§\u003c/strong\u003eï¼Œå³ä½¿æ˜¯åœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„ CT æ‰«æä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æœ¬ç ”ç©¶ä¸­ä½¿ç”¨çš„ä»£ç å‘å¸ƒåœ¨ GitHub ä¸Šï¼Œå¯é€šè¿‡ä»¥ä¸‹ URL (\u003ca href=\"https://github.com/BITEWKRER/DBNet\"\u003ehttps://github.com/BITEWKRER/DBNet\u003c/a\u003e) è·å–ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eè‚ºç™Œæ˜¯å…¨çƒç™Œç—‡ç›¸å…³æ­»äº¡çš„ä¸»è¦åŸå› [1]ã€‚ä»…åœ¨ç¾å›½ï¼Œé¢„è®¡ 2023 å¹´å°†æœ‰ 127,070 äººæ­»äºè‚ºç™Œï¼Œå æ‰€æœ‰ç™Œç—‡æ­»äº¡çš„ 21% [2]ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¶…è¿‡ 50% çš„è‚ºç™Œç—…ä¾‹å‘ç”Ÿåœ¨å‘å±•ä¸­å›½å®¶æˆ–ä¸å‘è¾¾å›½å®¶ï¼Œä¸å‘è¾¾å›½å®¶ç›¸æ¯”ï¼Œè¿™äº›å›½å®¶çš„åŒ»ç–—èµ„æºæœ‰é™[3]ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºäº†å¢åŠ ç”Ÿå­˜æœºä¼šï¼Œæ—©æœŸè¯Šæ–­å’Œæ²»ç–—è‚ºç™Œä»ç„¶è‡³å…³é‡è¦ã€‚åœ¨ä¸­å›½ï¼Œç ”ç©¶è¡¨æ˜ï¼Œ\u003cstrong\u003eå°äº1å˜ç±³çš„IæœŸè‚ºç™Œçš„5å¹´ç”Ÿå­˜ç‡ä¸º92%\u003c/strong\u003eã€‚ç„¶è€Œï¼Œ\u003cstrong\u003eæ™šæœŸè‚ºç™Œçš„5å¹´ç”Ÿå­˜ç‡ä½å¾—å¤š\u003c/strong\u003eï¼Œä»…ä¸º\u003cstrong\u003e7.0%\u003c/strong\u003e[4]ã€‚\u003cstrong\u003eåˆ©ç”¨è®¡ç®—æœºæ–­å±‚æ‰«æ (CT) è¿›è¡Œè‚ºç™Œç­›æŸ¥å·²æ˜¾ç¤ºå‡ºå¯å¤§å¹…é™ä½æ­»äº¡ç‡çš„æ½œåŠ›\u003c/strong\u003e [5]ã€[6]ã€‚ä½å‰‚é‡CTæ˜¯ç›®å‰è‚ºç™Œç­›æŸ¥æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œç§»åŠ¨CTçš„å¼•å…¥æœ‰åŠ©äºè§£å†³æ¬ å‘è¾¾å›½å®¶å’Œåè¿œåœ°åŒºç¼ºä¹CTæ‰«æä»ªçš„é—®é¢˜[6]ã€‚ç”±äºå¯èƒ½æ²¡æœ‰æ˜æ˜¾çš„ç—‡çŠ¶ï¼Œæ£€æµ‹æ—©æœŸè‚ºç™Œçš„å­˜åœ¨å¯èƒ½ä¼šå¸¦æ¥é‡å¤§æŒ‘æˆ˜ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eè¿™ç§åŒ»å­¦èƒŒæ™¯æ•°æ®å¯ä»¥ç›´æ¥å€Ÿé‰´ï¼ŒChatgptæ¶¦è‰²æ”¹å†™å°±å®Œäº‹å„¿\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨ \u003cstrong\u003eCT å›¾åƒä¸Šè¯†åˆ«è‚ºç»“èŠ‚æä¾›äº†ç–¾ç—…çš„å…³é”®æŒ‡æ ‡\u003c/strong\u003e [1], [3]ã€‚è¿™äº›ç»“èŠ‚ä»£è¡¨\u003cstrong\u003eåœ†å½¢å¼‚å¸¸\u003c/strong\u003eï¼Œå…¶\u003cstrong\u003eå¤§å°å„å¼‚\u003c/strong\u003eï¼Œç›´å¾„èŒƒå›´ä¸º \u003cstrong\u003e3 è‡³ 30 æ¯«ç±³\u003c/strong\u003e [7]ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç ”ç©¶è‚ºç»“èŠ‚ï¼Œç¾å›½å›½å®¶ç™Œç—‡ç ”ç©¶æ‰€ç»„è£…äº†â€œè‚ºéƒ¨å›¾åƒæ•°æ®åº“è”ç›Ÿå’Œå›¾åƒæ•°æ®åº“èµ„æºè®¡åˆ’ï¼ˆLIDCï¼‰â€æ•°æ®é›†[8]ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ¬ å‘è¾¾åœ°åŒºè®¾å¤‡ä¸è¶³ã€äººå‘˜ä¸è¶³ï¼Œå¯¼è‡´åŒ»ç”Ÿçš„è¯Šæ–­å’Œæ²»ç–—æ—¶é—´æœ‰é™\u003c/strong\u003e[9]ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ\u003cstrong\u003eåŒ»ç”Ÿçš„å·¥ä½œé‡å¾ˆå¤§ã€é‡å¤ä¸”è€—æ—¶\u003c/strong\u003e[10]ã€[5]ã€‚æ­¤å¤–ï¼Œç”±äºä¸CTåˆ‡ç‰‡ç›¸æ¯”ï¼Œ\u003cstrong\u003eè‚ºéƒ¨ç»“èŠ‚æ€§ç—…å˜\u003c/strong\u003eå æ®ç›¸å¯¹\u003cstrong\u003eè¾ƒå°çš„é¢ç§¯\u003c/strong\u003eï¼Œ\u003cstrong\u003eé•¿æ—¶é—´å’Œå¯†é›†çš„CTç­›æŸ¥\u003c/strong\u003eå¯èƒ½ä¼šå¯¼è‡´\u003cstrong\u003eæ¼æ£€å°çš„ã€ç»†å¾®çš„æˆ– GGO\u003c/strong\u003e (è‚ºç£¨ç»ç’ƒç»“èŠ‚) [3]ï¼Œ[6]ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿï¼ˆCADï¼‰å‡ºç°å¹¶å¾—åˆ°äº†å¿«é€Ÿå‘å±•ï¼Œç‰¹åˆ«æ˜¯éšç€åŸºäºæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¯Šæ–­æ–¹æ³•çš„è¿›æ­¥ã€‚ \u003cstrong\u003eCADç³»ç»Ÿå¤§å¤§å‡è½»äº†åŒ»ç”Ÿçš„å·¥ä½œé‡ï¼Œæœ€å¤§é™åº¦åœ°é™ä½äº†æœªå‘ç°ç»“èŠ‚çš„é£é™©ï¼Œå¹¶æé«˜äº†è‚ºç»“èŠ‚è¯Šæ–­çš„æ•ˆç‡å’Œå¯é æ€§\u003c/strong\u003eã€‚ç„¶è€Œï¼Œå½“å‰ç”¨äºè‚ºç»“èŠ‚åˆ†å‰²çš„ CAD ç³»ç»Ÿä»ç„¶é¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸‹é¢è¯¦ç»†é˜è¿°äº†è‚ºç»“èŠ‚åˆ†å‰²çš„å‡ ä¸ªç°æœ‰æŒ‘æˆ˜ï¼Œå¯ä»¥ä»è¿™äº›æŒ‘æˆ˜å…¥æ‰‹\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eé¦–å…ˆï¼Œ\u003cstrong\u003eæ”¾å°„ç§‘åŒ»ç”Ÿæ ‡è®°çš„è‚ºç»“èŠ‚\u003c/strong\u003eåŒ…å«\u003cstrong\u003eä¹ä¸ªè¯Šæ–­ç‰¹å¾\u003c/strong\u003e[11]ï¼Œ\u003cstrong\u003eå¼‚è´¨æ€§è¡¨å‹\u003c/strong\u003eé˜»ç¢äº†\u003cstrong\u003eè‚ºç»“èŠ‚åˆ†å‰²çš„å‘å±•\u003c/strong\u003eã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œ\u003cstrong\u003eå®å¿ƒç»“èŠ‚ï¼ˆaï¼Œbï¼‰å…·æœ‰æ¸…æ™°çš„å½¢çŠ¶å’Œè¾¹ç•Œ\u003c/strong\u003eï¼Œè€Œ\u003cstrong\u003eå¾®å¦™çš„GGOç»“èŠ‚ï¼ˆeï¼‰å…·æœ‰ä½å¯¹æ¯”åº¦å’Œæ¨¡ç³Šçš„è¾¹ç•Œ\u003c/strong\u003e[4]ï¼Œä½¿å¾—ç½‘ç»œå¾ˆå®¹æ˜“å°†\u003cstrong\u003eå®ƒä»¬åˆ†ç±»ä¸ºèƒŒæ™¯åŒºåŸŸ\u003c/strong\u003eã€‚\u003cstrong\u003eç©ºæ´ï¼ˆgï¼‰ç»“èŠ‚é™ä½äº†ç½‘ç»œåˆ†å‰²çš„æ•æ„Ÿæ€§\u003c/strong\u003eï¼Œå¹¶ä¸”ç”±äº\u003cstrong\u003eèƒŒæ™¯å’Œåˆ†å‰²ç›®æ ‡ä¹‹é—´çš„æåº¦ä¸å¹³è¡¡ï¼Œå°ç»“èŠ‚å¾ˆå®¹æ˜“è¢«é—æ¼\u003c/strong\u003e[12]ã€‚\u003c/p\u003e\n\u003cp\u003eç”±äºå‘¨å›´å¤šä½™çš„ç»„ç»‡ç»“æ„ï¼Œ\u003cstrong\u003eè¡€ç®¡æ—æˆ–èƒ¸è†œæ—ï¼ˆcã€dã€fï¼‰å¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œåˆ†ç±»é”™è¯¯\u003c/strong\u003e[13]ã€‚æ­¤å¤–ï¼Œ\u003cstrong\u003eéƒ¨åˆ†å®æ€§ç»“èŠ‚ï¼ˆhï¼‰æ¯”çº¯GGOæ›´è‡´å¯†\u003c/strong\u003eï¼Œäº§ç”Ÿæ›´\u003cstrong\u003eå¤æ‚çš„å¼‚è´¨çº¹ç†ï¼Œæ›´å®¹æ˜“å‘å±•æˆæ¶æ€§ç»“èŠ‚\u003c/strong\u003e[14]ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240303102609243\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/262f8e71-d931-11ee-b68c-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå…¶æ¬¡ï¼Œè‚ºç»“èŠ‚å†…éƒ¨å› ç´ é€ æˆçš„åˆ†å‰²å›°éš¾åœ¨äº\u003cstrong\u003eåŒ»ç”Ÿæ³¨é‡Šã€å±‚åšã€æ•°æ®æ¥æºå’Œæ•°æ®è´¨é‡\u003c/strong\u003eã€‚\u003cstrong\u003eæ•°æ®è´¨é‡å·®\u003c/strong\u003eæˆ–\u003cstrong\u003eä¸åŒåŒ»ç”Ÿçš„ç»éªŒ\u003c/strong\u003eå¯èƒ½ä¼šå¯¼è‡´\u003cstrong\u003eä¸åŒçš„æ³¨é‡Šå’Œæ³¨é‡Šè€…æ•°é‡\u003c/strong\u003eã€‚ç”±\u003cstrong\u003eå¤šååŒ»ç”Ÿæ³¨é‡Šçš„ç—…å˜åŒºåŸŸ\u003c/strong\u003eé€šå¸¸æ›´\u003cstrong\u003eå¯é \u003c/strong\u003eï¼Œå‡å°‘äº†æ½œåœ¨çš„ä¸´åºŠé£é™©ã€‚\u003cstrong\u003eåœ¨èµ„æºæœ‰é™çš„åœ°åŒº\u003c/strong\u003eï¼Œç”±äº \u003cstrong\u003eCT æ‰«æä»ªçŸ­ç¼ºå’Œæˆåƒè®¾å¤‡é™ˆæ—§\u003c/strong\u003eï¼Œ\u003cstrong\u003eCT æ‰«æè´¨é‡å·®çš„æƒ…å†µå¾ˆå¸¸è§\u003c/strong\u003eã€‚\u003cstrong\u003eè¾ƒåšçš„åˆ‡ç‰‡\u003c/strong\u003eæ›´æœ‰å¯èƒ½äº§ç”Ÿâ€œ\u003cstrong\u003eä½“ç§¯å¹³å‡æ•ˆåº”â€å’Œä¼ªå½±\u003c/strong\u003eï¼Œä½¿åŒ»ç”Ÿ\u003cstrong\u003eéš¾ä»¥è¾¾æˆä¸€è‡´çš„è¯Šæ–­\u003c/strong\u003eã€‚å³ä½¿ä½¿ç”¨\u003cstrong\u003eç§»åŠ¨ CT æ‰«æä»ª\u003c/strong\u003eä¹Ÿå¯èƒ½\u003cstrong\u003eæ— æ³•æä¾›å®Œæ•´çš„è¯Šæ–­è¯¦ç»†ä¿¡æ¯\u003c/strong\u003eã€‚æœ€åï¼Œç›®å‰\u003cstrong\u003eå¤§å¤šæ•°è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•\u003c/strong\u003eéƒ½æ˜¯åŸºäº\u003cstrong\u003e2Då›¾åƒ\u003c/strong\u003eï¼Œä½†è¿™äº›æ–¹æ³•å¿½ç•¥äº†\u003cstrong\u003eç©ºé—´å…³ç³»\u003c/strong\u003eï¼Œå› æ­¤æå‡ºä¸€ç§æœ‰æ•ˆçš„\u003cstrong\u003e3Dè‚ºç»“èŠ‚åˆ†å‰²æ¨¡å‹\u003c/strong\u003eæ¥\u003cstrong\u003eæ•è·è‚ºç»“èŠ‚çš„ç©ºé—´ä½ç½®\u003c/strong\u003eã€\u003cstrong\u003eçº¹ç†å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯å˜å¾—è¶Šæ¥è¶Šé‡è¦ä»¥é¿å…è¯¯è¯Šå’Œæ¼è¯Š\u003c/strong\u003eã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eChallenge\u003c/strong\u003e:\u003c/p\u003e","title":"A Dual-Branch Framework with Prior Knowledge for Precise Segmentation of Lung Nodules in Challenging CT Scans"},{"content":"Abstract å¦‚ä»Šçš„æ·±åº¦å­¦ä¹ æ–¹æ³•ä¸»è¦å…³æ³¨å¦‚ä½•è®¾è®¡æœ€åˆé€‚çš„ç›®æ ‡å‡½æ•°ï¼Œä½¿æ¨¡å‹çš„é¢„æµ‹ç»“æœèƒ½å¤Ÿæœ€æ¥è¿‘çœŸå®æƒ…å†µã€‚åŒæ—¶ï¼Œå¿…é¡»è®¾è®¡ä¸€ä¸ªé€‚å½“çš„æ¶æ„ï¼Œå¯ä»¥å¸®åŠ©è·å–è¶³å¤Ÿçš„ä¿¡æ¯è¿›è¡Œé¢„æµ‹ã€‚ç°æœ‰æ–¹æ³•å¿½ç•¥äº†ä¸€ä¸ªäº‹å®ï¼Œå³å½“è¾“å…¥æ•°æ®ç»è¿‡é€å±‚ç‰¹å¾æå–å’Œç©ºé—´å˜æ¢æ—¶ï¼Œå¤§é‡ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚æœ¬æ–‡å°†æ·±å…¥ç ”ç©¶æ•°æ®é€šè¿‡æ·±åº¦ç½‘ç»œä¼ è¾“æ—¶æ•°æ®ä¸¢å¤±çš„é‡è¦é—®é¢˜ï¼Œå³ä¿¡æ¯ç“¶é¢ˆå’Œå¯é€†å‡½æ•°ã€‚æˆ‘ä»¬æå‡ºäº†å¯ç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ï¼ˆPGIï¼‰çš„æ¦‚å¿µæ¥åº”å¯¹æ·±åº¦ç½‘ç»œå®ç°å¤šä¸ªç›®æ ‡æ‰€éœ€çš„å„ç§å˜åŒ–ã€‚ PGIå¯ä»¥ä¸ºç›®æ ‡ä»»åŠ¡è®¡ç®—ç›®æ ‡å‡½æ•°æä¾›å®Œæ•´çš„è¾“å…¥ä¿¡æ¯ï¼Œä»è€Œè·å¾—å¯é çš„æ¢¯åº¦ä¿¡æ¯æ¥æ›´æ–°ç½‘ç»œæƒå€¼ã€‚æ­¤å¤–ï¼Œè¿˜è®¾è®¡äº†ä¸€ç§åŸºäºæ¢¯åº¦è·¯å¾„è§„åˆ’çš„æ–°å‹è½»é‡çº§ç½‘ç»œæ¶æ„â€”â€”é€šç”¨é«˜æ•ˆå±‚èšåˆç½‘ç»œï¼ˆGELANï¼‰ã€‚GELANçš„æ¶æ„è¯å®äº†PGIåœ¨è½»é‡çº§æ¨¡å‹ä¸Šå–å¾—äº†ä¼˜å¼‚çš„ç»“æœã€‚æˆ‘ä»¬åœ¨åŸºäº MS COCO æ•°æ®é›†çš„ç›®æ ‡æ£€æµ‹ä¸ŠéªŒè¯äº†æ‰€æå‡ºçš„ GELAN å’Œ PGIã€‚ç»“æœè¡¨æ˜ï¼Œä¸åŸºäºæ·±åº¦å·ç§¯å¼€å‘çš„æœ€å…ˆè¿›æ–¹æ³•ç›¸æ¯”ï¼ŒGELAN ä»…ä½¿ç”¨ä¼ ç»Ÿçš„å·ç§¯ç®—å­å³å¯å®ç°æ›´å¥½çš„å‚æ•°åˆ©ç”¨ç‡ã€‚ PGI å¯ç”¨äºä»è½»å‹åˆ°å¤§å‹çš„å„ç§æ¨¡å‹ã€‚å®ƒå¯ä»¥ç”¨æ¥è·å–å®Œæ•´çš„ä¿¡æ¯ï¼Œä½¿å¾—train-from-scratch (ä»é›¶å¼€å§‹è®­ç»ƒ) æ¨¡å‹èƒ½å¤Ÿæ¯”ä½¿ç”¨å¤§æ•°æ®é›†é¢„è®­ç»ƒçš„state-of-theartæ¨¡å‹è·å¾—æ›´å¥½çš„ç»“æœï¼Œå¯¹æ¯”ç»“æœå¦‚å›¾1æ‰€ç¤ºã€‚æºä»£ç ä½äºï¼šhttpsï¼š //github.com/WongKinYiu/yolov9ã€‚\næ ¸å¿ƒåˆ›æ–°ç‚¹: ä¾ç„¶æ˜¯ç½‘ç»œç»“æ„çš„åˆ›æ–°\nProgrammable Gradient Information (PGI) Generalized Efficient Layer Aggregation Networkï¼ˆGELANï¼‰ Introduction åŸºäºæ·±åº¦å­¦ä¹ çš„æ¨¡å‹åœ¨è®¡ç®—æœºè§†è§‰ã€è¯­è¨€å¤„ç†å’Œè¯­éŸ³è¯†åˆ«ç­‰å„ä¸ªé¢†åŸŸéƒ½è¡¨ç°å‡ºäº†æ¯”è¿‡å»çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿæ›´å¥½çš„æ€§èƒ½ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ é¢†åŸŸçš„ç ”ç©¶äººå‘˜ä¸»è¦å…³æ³¨å¦‚ä½•å¼€å‘æ›´å¼ºå¤§çš„ç³»ç»Ÿæ¶æ„å’Œå­¦ä¹ æ–¹æ³•ï¼Œä¾‹å¦‚CNNï¼ŒTransformers[8,9,40] ã€41ã€60ã€69ã€70]ï¼ŒPerceivers[26ã€26ã€32ã€52ã€56ã€81ã€81]å’ŒMambas[17ã€38ã€80]ã€‚æ­¤å¤–ï¼Œä¸€äº›ç ”ç©¶äººå‘˜å°è¯•å¼€å‘æ›´é€šç”¨çš„ç›®æ ‡å‡½æ•°ï¼Œä¾‹å¦‚æŸå¤±å‡½æ•°[5,45,46,50,77,78]ï¼Œæ ‡ç­¾åˆ†é…[10,12,33,67,79]å’Œè¾…åŠ©ç›‘ç£[18] ã€20ã€24ã€28ã€29ã€51ã€54ã€68ã€76]ã€‚ä¸Šè¿°ç ”ç©¶éƒ½è¯•å›¾ç²¾ç¡®åœ°æ‰¾åˆ°è¾“å…¥å’Œç›®æ ‡ä»»åŠ¡ä¹‹é—´çš„æ˜ å°„ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°è¿‡å»çš„æ–¹æ³•éƒ½å¿½ç•¥äº†è¾“å…¥æ•°æ®åœ¨å‰é¦ˆè¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿä¸å¯å¿½ç•¥çš„ä¿¡æ¯ä¸¢å¤±é‡ã€‚è¿™ç§ä¿¡æ¯ä¸¢å¤±å¯èƒ½ä¼šå¯¼è‡´æœ‰åå·®çš„æ¢¯åº¦æµï¼Œéšåç”¨äºæ›´æ–°æ¨¡å‹ã€‚ä¸Šè¿°é—®é¢˜å¯èƒ½å¯¼è‡´æ·±åº¦ç½‘ç»œåœ¨ç›®æ ‡å’Œè¾“å…¥ä¹‹é—´å»ºç«‹ä¸æ­£ç¡®çš„å…³è”ï¼Œå¯¼è‡´è®­ç»ƒåçš„æ¨¡å‹äº§ç”Ÿä¸æ­£ç¡®çš„é¢„æµ‹ã€‚\nåœ¨æ·±åº¦ç½‘ç»œä¸­ï¼Œè¾“å…¥æ•°æ®åœ¨å‰é¦ˆè¿‡ç¨‹ä¸­ä¸¢å¤±ä¿¡æ¯çš„ç°è±¡ä¿—ç§°ä¿¡æ¯ç“¶é¢ˆ[59]ï¼Œå…¶ç¤ºæ„å›¾å¦‚å›¾2æ‰€ç¤ºã€‚ç›®å‰å¯ä»¥ç¼“è§£è¿™ç§ç°è±¡çš„ä¸»è¦æ–¹æ³•æœ‰ï¼šï¼ˆ1ï¼‰å¯é€†æ¶æ„çš„ä½¿ç”¨[3,16,19]ï¼šè¯¥æ–¹æ³•ä¸»è¦ä½¿ç”¨é‡å¤çš„è¾“å…¥æ•°æ®ï¼Œå¹¶ä»¥æ˜¾å¼çš„æ–¹å¼ç»´æŠ¤è¾“å…¥æ•°æ®çš„ä¿¡æ¯ï¼› ï¼ˆ2ï¼‰ä½¿ç”¨Maskedå»ºæ¨¡[1,6,9,27,71,73]ï¼šä¸»è¦åˆ©ç”¨é‡æ„æŸå¤±ï¼Œé‡‡ç”¨éšå¼æ–¹å¼æœ€å¤§åŒ–æå–ç‰¹å¾å¹¶ä¿ç•™è¾“å…¥ä¿¡æ¯ï¼› ï¼ˆ3ï¼‰å¼•å…¥æ·±åº¦ç›‘ç£æ¦‚å¿µ[28,51,54,68]ï¼šå®ƒåˆ©ç”¨æ²¡æœ‰ä¸¢å¤±å¤ªå¤šé‡è¦ä¿¡æ¯çš„æµ…å±‚ç‰¹å¾æ¥é¢„å…ˆå»ºç«‹ä»ç‰¹å¾åˆ°ç›®æ ‡çš„æ˜ å°„ï¼Œä»¥ç¡®ä¿é‡è¦ä¿¡æ¯èƒ½å¤Ÿè¢«ä¼ é€’åˆ°æ›´æ·±çš„å±‚æ¬¡ã€‚ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•åœ¨è®­ç»ƒè¿‡ç¨‹å’Œæ¨ç†è¿‡ç¨‹ä¸­éƒ½å­˜åœ¨ä¸åŒçš„ç¼ºç‚¹ã€‚ä¾‹å¦‚ï¼Œå¯é€†æ¶æ„éœ€è¦é¢å¤–çš„å±‚æ¥ç»„åˆé‡å¤é¦ˆé€çš„è¾“å…¥æ•°æ®ï¼Œè¿™å°†æ˜¾ç€å¢åŠ æ¨ç†æˆæœ¬ã€‚å¦å¤–ï¼Œç”±äºè¾“å…¥æ•°æ®å±‚åˆ°è¾“å‡ºå±‚ä¸èƒ½æœ‰å¤ªæ·±çš„è·¯å¾„ï¼Œè¿™ç§é™åˆ¶å°†å¯¼è‡´åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éš¾ä»¥å¯¹é«˜é˜¶è¯­ä¹‰ä¿¡æ¯è¿›è¡Œå»ºæ¨¡ã€‚å¯¹äº Masked å»ºæ¨¡ï¼Œå…¶é‡å»ºæŸå¤±æœ‰æ—¶ä¸ç›®æ ‡æŸå¤±ç›¸å†²çªã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°æ©ç æœºåˆ¶è¿˜ä¼šäº§ç”Ÿä¸æ•°æ®çš„ä¸æ­£ç¡®å…³è”ã€‚ å¯¹äºæ·±å±‚ç›‘ç£æœºåˆ¶æ¥è¯´ï¼Œä¼šäº§ç”Ÿè¯¯å·®ç´¯ç§¯ï¼Œå¦‚æœæµ…å±‚ç›‘ç£åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸¢å¤±ä¿¡æ¯ï¼Œåç»­å±‚å°†æ— æ³•æ£€ç´¢åˆ°æ‰€éœ€ä¿¡æ¯ã€‚ä¸Šè¿°ç°è±¡åœ¨å›°éš¾ä»»åŠ¡å’Œå°æ¨¡å‹ä¸Šä¼šæ›´åŠ æ˜¾ç€ã€‚\né’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå³å¯ç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ï¼ˆPGIï¼‰ã€‚å…¶æ¦‚å¿µæ˜¯é€šè¿‡è¾…åŠ©å¯é€†åˆ†æ”¯ç”Ÿæˆå¯é çš„æ¢¯åº¦ï¼Œä½¿å¾—æ·±å±‚ç‰¹å¾ä»ç„¶èƒ½å¤Ÿä¿æŒæ‰§è¡Œç›®æ ‡ä»»åŠ¡çš„å…³é”®ç‰¹å¾ã€‚\nè¾…åŠ©å¯é€†åˆ†æ”¯çš„è®¾è®¡å¯ä»¥é¿å…ä¼ ç»Ÿçš„èåˆå¤šè·¯å¾„ç‰¹å¾çš„æ·±åº¦ç›‘ç£è¿‡ç¨‹å¯èƒ½é€ æˆçš„è¯­ä¹‰æŸå¤±ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸åŒè¯­ä¹‰å±‚é¢ä¸Šç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ä¼ æ’­ï¼Œä»è€Œè¾¾åˆ°æœ€ä½³çš„è®­ç»ƒç»“æœã€‚ PGIçš„å¯é€†æ¶æ„å»ºç«‹åœ¨è¾…åŠ©åˆ†æ”¯ä¸Šï¼Œå› æ­¤æ²¡æœ‰é¢å¤–çš„æˆæœ¬ã€‚ç”±äºPGIå¯ä»¥è‡ªç”±é€‰æ‹©é€‚åˆç›®æ ‡ä»»åŠ¡çš„æŸå¤±å‡½æ•°ï¼Œå› æ­¤ä¹Ÿå…‹æœäº†Maskedå»ºæ¨¡é‡åˆ°çš„é—®é¢˜ã€‚æ‰€æå‡ºçš„PGIæœºåˆ¶å¯ä»¥åº”ç”¨äºå„ç§è§„æ¨¡çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼Œå¹¶ä¸”æ¯”ä»…é€‚ç”¨äºéå¸¸æ·±çš„ç¥ç»ç½‘ç»œçš„æ·±åº¦ç›‘ç£æœºåˆ¶æ›´é€šç”¨ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è¿˜åŸºäºELAN[65]è®¾è®¡äº†å¹¿ä¹‰ELANï¼ˆGELANï¼‰ï¼ŒGELANçš„è®¾è®¡åŒæ—¶è€ƒè™‘äº†å‚æ•°é‡ã€è®¡ç®—å¤æ‚åº¦ã€å‡†ç¡®æ€§å’Œæ¨ç†é€Ÿåº¦ã€‚è¿™ç§è®¾è®¡å…è®¸ç”¨æˆ·é’ˆå¯¹ä¸åŒçš„æ¨ç†è®¾å¤‡ä»»æ„é€‰æ‹©åˆé€‚çš„è®¡ç®—å—ã€‚æˆ‘ä»¬å°†æå‡ºçš„PGIå’ŒGELANç»“åˆèµ·æ¥ï¼Œç„¶åè®¾è®¡äº†æ–°ä¸€ä»£YOLOç³»åˆ—ç‰©ä½“æ£€æµ‹ç³»ç»Ÿï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºYOLOv9ã€‚æˆ‘ä»¬ä½¿ç”¨MS COCOæ•°æ®é›†è¿›è¡Œå®éªŒï¼Œå®éªŒç»“æœéªŒè¯äº†æˆ‘ä»¬æå‡ºçš„YOLOv9åœ¨æ‰€æœ‰æ¯”è¾ƒä¸­éƒ½å–å¾—äº†é¡¶å°–çš„æ€§èƒ½ã€‚\næˆ‘ä»¬æ€»ç»“æœ¬æ–‡çš„è´¡çŒ®å¦‚ä¸‹ï¼š\næˆ‘ä»¬ä»å¯é€†å‡½æ•°çš„è§’åº¦å¯¹ç°æœ‰çš„æ·±åº¦ç¥ç»ç½‘ç»œæ¶æ„è¿›è¡Œäº†ç†è®ºåˆ†æï¼Œé€šè¿‡è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬æˆåŠŸåœ°è§£é‡Šäº†è®¸å¤šè¿‡å»éš¾ä»¥è§£é‡Šçš„ç°è±¡ã€‚æˆ‘ä»¬è¿˜åŸºäºæ­¤åˆ†æè®¾è®¡äº†PGIå’Œè¾…åŠ©å¯é€†åˆ†æ”¯ï¼Œå¹¶å–å¾—äº†ä¼˜å¼‚çš„ç»“æœã€‚\næˆ‘ä»¬è®¾è®¡çš„PGIè§£å†³äº†æ·±åº¦ç›‘ç£åªèƒ½ç”¨äºææ·±çš„ç¥ç»ç½‘ç»œæ¶æ„çš„é—®é¢˜ï¼Œä»è€Œè®©æ–°çš„è½»é‡çº§æ¶æ„çœŸæ­£åº”ç”¨äºæ—¥å¸¸ç”Ÿæ´»ä¸­ã€‚\næˆ‘ä»¬è®¾è®¡çš„GELANä»…ä½¿ç”¨å¸¸è§„å·ç§¯æ¥å®ç°æ¯”åŸºäºæœ€å…ˆè¿›æŠ€æœ¯çš„æ·±åº¦å·ç§¯è®¾è®¡æ›´é«˜çš„å‚æ•°åˆ©ç”¨ç‡ï¼ŒåŒæ—¶è¡¨ç°å‡ºè½»ã€å¿«é€Ÿã€å‡†ç¡®çš„å·¨å¤§ä¼˜åŠ¿ã€‚\nç»“åˆæ‰€æå‡ºçš„PGIå’ŒGELANï¼ŒYOLOv9åœ¨MS COCOæ•°æ®é›†ä¸Šçš„ç›®æ ‡æ£€æµ‹æ€§èƒ½åœ¨å„ä¸ªæ–¹é¢éƒ½å¤§å¤§è¶…è¿‡äº†ç°æœ‰çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ã€‚\nProgrammable Gradient Information (PGI)ï¼š\nè‡ªç”±é€‰æ‹©é€‚åˆç›®æ ‡ä»»åŠ¡çš„æŸå¤±å‡½æ•°\nå¯é€†ç»“æ„å»ºç«‹è¾…åŠ©åˆ†æ”¯ï¼Œä¸å¢åŠ æ¨ç†æˆæœ¬\né€‚ç”¨äºå„ç§è§„æ¨¡çš„æ·±åº¦ç¥ç»ç½‘ç»œ\nGELANï¼š\nè½»ã€å¿«é€Ÿã€å‡†ç¡® é‡‡ç”¨å¸¸è§„å·ç§¯åŠæ‰“å…¶ä»–æ–°é¢–å·ç§¯ Related work 2.1 Real-time Object Detectors ç›®å‰ä¸»æµçš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨æ˜¯YOLOç³»åˆ—[2,7,13â€“15,25,30,31,47â€“49,61â€“63,74,75]ï¼Œè¿™äº›æ¨¡å‹å¤§å¤šæ•°ä½¿ç”¨CSPNet[64]æˆ– ELAN [65] åŠå…¶å˜ä½“ä½œä¸ºä¸»è¦è®¡ç®—å•å…ƒã€‚åœ¨ç‰¹å¾é›†æˆæ–¹é¢ï¼Œé€šå¸¸ä½¿ç”¨æ”¹è¿›çš„PAN[37]æˆ–FPN[35]ä½œä¸ºå·¥å…·ï¼Œç„¶åä½¿ç”¨æ”¹è¿›çš„YOLOv3å¤´[49]æˆ–FCOSå¤´[57, 58]ä½œä¸ºé¢„æµ‹å¤´ã€‚æœ€è¿‘ä¹Ÿæå‡ºäº†ä¸€äº›å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ï¼Œä¾‹å¦‚ RT DETR [43]ï¼Œå…¶åŸºç¡€æ˜¯ DETR [4]ã€‚ç„¶è€Œï¼Œç”±äºDETRç³»åˆ—ç›®æ ‡æ£€æµ‹å™¨åœ¨æ²¡æœ‰ç›¸åº”é¢†åŸŸé¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µä¸‹å¾ˆéš¾åº”ç”¨äºæ–°é¢†åŸŸï¼Œå› æ­¤ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ä»ç„¶æ˜¯YOLOç³»åˆ—ã€‚æœ¬æ–‡é€‰æ‹© YOLOv7 [63] ä½œä¸ºå¼€å‘è¯¥æ–¹æ³•çš„åŸºç¡€ï¼Œè¯¥æ–¹æ³•å·²åœ¨å„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡å’Œå„ç§åœºæ™¯ä¸­è¢«è¯æ˜æœ‰æ•ˆã€‚\næˆ‘ä»¬ä½¿ç”¨ GELAN æ¥æ”¹è¿›æ‰€æå‡ºçš„ PGI çš„æ¶æ„å’Œè®­ç»ƒè¿‡ç¨‹ã€‚ä¸Šè¿°æ–°é¢–æ–¹æ³•ä½¿æ‰€æå‡ºçš„ YOLOv9 æˆä¸ºæ–°ä¸€ä»£é¡¶çº§å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ã€‚\n2.2 Reversible Architectures å¯é€†æ¶æ„[3,16,19]çš„è¿ç®—å•å…ƒå¿…é¡»ä¿æŒå¯é€†è½¬æ¢çš„ç‰¹æ€§ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ¯å±‚è¿ç®—å•å…ƒçš„è¾“å‡ºç‰¹å¾å›¾éƒ½èƒ½ä¿ç•™å®Œæ•´çš„åŸå§‹ä¿¡æ¯ã€‚ä¹‹å‰ï¼ŒRevCol[3]å°†ä¼ ç»Ÿçš„å¯é€†å•å…ƒæ¨å¹¿åˆ°å¤šä¸ªå±‚æ¬¡ï¼Œè¿™æ ·åšå¯ä»¥æ‰©å±•ä¸åŒå±‚å•å…ƒè¡¨è¾¾çš„è¯­ä¹‰å±‚æ¬¡ã€‚é€šè¿‡å¯¹å„ç§ç¥ç»ç½‘ç»œæ¶æ„çš„æ–‡çŒ®å›é¡¾ï¼Œæˆ‘ä»¬å‘ç°æœ‰è®¸å¤šé«˜æ€§èƒ½æ¶æ„å…·æœ‰ä¸åŒç¨‹åº¦çš„å¯é€†ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼ŒRes2Netæ¨¡å—[11]ä»¥åˆ†å±‚æ–¹å¼å°†ä¸åŒçš„è¾“å…¥åˆ†åŒºä¸ä¸‹ä¸€ä¸ªåˆ†åŒºç»„åˆèµ·æ¥ï¼Œå¹¶åœ¨å‘åä¼ é€’ä¹‹å‰è¿æ¥æ‰€æœ‰è½¬æ¢åçš„åˆ†åŒºã€‚ CBNet [34, 39]é€šè¿‡å¤åˆä¸»å¹²ç½‘é‡æ–°å¼•å…¥åŸå§‹è¾“å…¥æ•°æ®ä»¥è·å¾—å®Œæ•´çš„åŸå§‹ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å„ç§ç»„åˆæ–¹æ³•è·å¾—ä¸åŒçº§åˆ«çš„å¤šçº§å¯é€†ä¿¡æ¯ã€‚è¿™äº›ç½‘ç»œæ¶æ„é€šå¸¸å…·æœ‰å‡ºè‰²çš„å‚æ•°åˆ©ç”¨ç‡ï¼Œä½†é¢å¤–çš„å¤åˆå±‚å¯¼è‡´æ¨ç†é€Ÿåº¦ç¼“æ…¢ã€‚ DynamicDet [36]ç»“åˆäº†CBNet [34]å’Œé«˜æ•ˆå®æ—¶ç›®æ ‡æ£€æµ‹å™¨YOLOv7 [63]ï¼Œåœ¨é€Ÿåº¦ã€å‚æ•°æ•°é‡å’Œç²¾åº¦ä¹‹é—´å®ç°äº†éå¸¸å¥½çš„æƒè¡¡ã€‚æœ¬æ–‡ä»‹ç»äº† DynamicDet æ¶æ„ä½œä¸ºè®¾è®¡å¯é€†åˆ†æ”¯çš„åŸºç¡€ã€‚æ­¤å¤–ï¼Œå¯é€†ä¿¡æ¯è¢«è¿›ä¸€æ­¥å¼•å…¥åˆ°æ‰€æå‡ºçš„PGIä¸­ã€‚æ‰€æå‡ºçš„æ–°æ¶æ„åœ¨æ¨ç†è¿‡ç¨‹ä¸­ä¸éœ€è¦é¢å¤–çš„è¿æ¥ï¼Œå› æ­¤å¯ä»¥å……åˆ†ä¿ç•™é€Ÿåº¦ã€å‚æ•°é‡å’Œå‡†ç¡®æ€§çš„ä¼˜åŠ¿ã€‚\n2.3 Auxiliary Supervision æ·±åº¦ç›‘ç£[28,54,68]æ˜¯æœ€å¸¸è§çš„è¾…åŠ©ç›‘ç£æ–¹æ³•ï¼Œå®ƒé€šè¿‡åœ¨ä¸­é—´å±‚æ’å…¥é¢å¤–çš„é¢„æµ‹å±‚æ¥è¿›è¡Œè®­ç»ƒã€‚å°¤å…¶æ˜¯åŸºäºTransformerçš„æ–¹æ³•ä¸­å¼•å…¥çš„å¤šå±‚è§£ç å™¨çš„åº”ç”¨æ˜¯æœ€å¸¸è§çš„ä¸€ç§ã€‚\nå¦ä¸€ç§å¸¸è§çš„è¾…åŠ©ç›‘ç£æ–¹æ³•æ˜¯åˆ©ç”¨ç›¸å…³å…ƒä¿¡æ¯æ¥æŒ‡å¯¼ä¸­é—´å±‚äº§ç”Ÿçš„ç‰¹å¾å›¾ï¼Œå¹¶ä½¿å®ƒä»¬å…·æœ‰ç›®æ ‡ä»»åŠ¡æ‰€éœ€çš„å±æ€§[18,20,24,29,76]ã€‚è¿™ç§ç±»å‹çš„ç¤ºä¾‹åŒ…æ‹¬ä½¿ç”¨åˆ†å‰²æŸå¤±æˆ–æ·±åº¦æŸå¤±æ¥æé«˜å¯¹è±¡æ£€æµ‹å™¨çš„å‡†ç¡®æ€§ã€‚\næœ€è¿‘ï¼Œæ–‡çŒ®[53,67,82]ä¸­æœ‰è®¸å¤šæŠ¥å‘Šä½¿ç”¨ä¸åŒçš„æ ‡ç­¾åˆ†é…æ–¹æ³•æ¥ç”Ÿæˆä¸åŒçš„è¾…åŠ©ç›‘ç£æœºåˆ¶ï¼Œä»¥åŠ å¿«æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ï¼ŒåŒæ—¶æé«˜é²æ£’æ€§ã€‚ç„¶è€Œï¼Œè¾…åŠ©ç›‘ç£æœºåˆ¶é€šå¸¸åªé€‚ç”¨äºå¤§å‹æ¨¡å‹ï¼Œå› æ­¤å½“å…¶åº”ç”¨äºè½»é‡çº§æ¨¡å‹æ—¶ï¼Œå¾ˆå®¹æ˜“é€ æˆæ¬ å‚æ•°åŒ–ç°è±¡ï¼Œä»è€Œä½¿æ€§èƒ½å˜å·®ã€‚æˆ‘ä»¬æå‡ºçš„PGIè®¾è®¡äº†ä¸€ç§é‡æ–°ç¼–ç¨‹å¤šçº§è¯­ä¹‰ä¿¡æ¯çš„æ–¹æ³•ï¼Œè¿™ç§è®¾è®¡è®©è½»é‡çº§æ¨¡å‹ä¹Ÿå—ç›Šäºè¾…åŠ©ç›‘ç£æœºåˆ¶ã€‚\nProblem Statement é€šå¸¸ï¼Œäººä»¬å°†æ·±åº¦ç¥ç»ç½‘ç»œæ”¶æ•›é—®é¢˜çš„å›°éš¾å½’å› äºæ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦é¥±å’Œç­‰å› ç´ ï¼Œè€Œè¿™äº›ç°è±¡åœ¨ä¼ ç»Ÿæ·±åº¦ç¥ç»ç½‘ç»œä¸­ç¡®å®å­˜åœ¨ã€‚ç„¶è€Œï¼Œç°ä»£æ·±åº¦ç¥ç»ç½‘ç»œå·²ç»é€šè¿‡è®¾è®¡å„ç§å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œä»ç„¶å­˜åœ¨æ”¶æ•›é€Ÿåº¦æ…¢æˆ–æ”¶æ•›ç»“æœå·®çš„é—®é¢˜ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ¢è®¨ä¸Šè¿°é—®é¢˜çš„æœ¬è´¨ã€‚é€šè¿‡å¯¹ä¿¡æ¯ç“¶é¢ˆçš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬æ¨æ–­å‡ºè¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯åŸæœ¬æ¥è‡ªå¾ˆæ·±ç½‘ç»œçš„åˆå§‹æ¢¯åº¦åœ¨ä¼ è¾“åå¾ˆå¿«å°±ä¸¢å¤±äº†å®ç°ç›®æ ‡æ‰€éœ€çš„å¤§é‡ä¿¡æ¯ã€‚ä¸ºäº†è¯å®è¿™ä¸€æ¨è®ºï¼Œæˆ‘ä»¬å°†ä¸åŒæ¶æ„çš„æ·±åº¦ç½‘ç»œå‰é¦ˆäº†åˆå§‹æƒé‡ï¼Œç„¶åå°†å…¶å¯è§†åŒ–å¹¶åœ¨å›¾2ä¸­è¿›è¡Œè¯´æ˜ã€‚æ˜¾ç„¶ï¼ŒPlainNetä¸¢å¤±äº†æ·±å±‚ç‰©ä½“æ£€æµ‹æ‰€éœ€çš„å¤§é‡é‡è¦ä¿¡æ¯ã€‚è‡³äºResNetã€CSPNetã€GELANèƒ½å¤Ÿä¿ç•™é‡è¦ä¿¡æ¯çš„æ¯”ä¾‹ï¼Œç¡®å®ä¸è®­ç»ƒåèƒ½å¤Ÿè·å¾—çš„å‡†ç¡®ç‡å‘ˆæ­£ç›¸å…³ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†åŸºäºå¯é€†ç½‘ç»œçš„æ–¹æ³•æ¥è§£å†³ä¸Šè¿°é—®é¢˜çš„åŸå› ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†è¯¦ç»†é˜è¿°å¯¹ä¿¡æ¯ç“¶é¢ˆåŸç†å’Œå¯é€†å‡½æ•°çš„åˆ†æã€‚\n3.1. Information Bottleneck Principle æ ¹æ®ä¿¡æ¯ç“¶é¢ˆåŸç†ï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®Xåœ¨è¿›è¡Œå˜æ¢æ—¶å¯èƒ½ä¼šé€ æˆä¿¡æ¯ä¸¢å¤±ï¼Œå¦‚å¼(1)æ‰€ç¤ºã€‚\nå…¶ä¸­ $I$ è¡¨ç¤ºç›¸äº’ä¿¡æ¯ï¼Œ$f$ å’Œ $g$ æ˜¯å˜æ¢å‡½æ•°ï¼Œ$Î¸$ å’Œ $Ï•$ åˆ†åˆ«æ˜¯ $f$ å’Œ $g$ çš„å‚æ•°ã€‚\nåœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œ$f_Î¸ (Â·)$ å’Œ $g_Ïˆ (Â·)$ åˆ†åˆ«è¡¨ç¤ºæ·±åº¦ç¥ç»ç½‘ç»œä¸­ä¸¤ä¸ªè¿ç»­å±‚çš„æ“ä½œã€‚ä»æ–¹ç¨‹ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥é¢„æµ‹**ï¼Œéšç€ç½‘ç»œå±‚æ•°è¶Šæ·±ï¼ŒåŸå§‹æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§å°±è¶Šå¤§**ã€‚ç„¶è€Œæ·±åº¦ç¥ç»ç½‘ç»œçš„å‚æ•°æ˜¯åŸºäºç½‘ç»œçš„è¾“å‡ºä»¥åŠç»™å®šçš„ç›®æ ‡ï¼Œç„¶åé€šè¿‡è®¡ç®—æŸå¤±å‡½æ•°ç”Ÿæˆæ–°çš„æ¢¯åº¦åæ›´æ–°ç½‘ç»œã€‚\nå¯ä»¥æƒ³è±¡**ï¼Œæ›´æ·±çš„ç¥ç»ç½‘ç»œçš„è¾“å‡ºä¸å¤ªèƒ½å¤Ÿä¿ç•™æœ‰å…³é¢„æµ‹ç›®æ ‡çš„å®Œæ•´ä¿¡æ¯**ã€‚è¿™å°†ä½¿å¾—åœ¨ç½‘ç»œè®­ç»ƒæœŸé—´ä½¿ç”¨ä¸å®Œæ•´çš„ä¿¡æ¯æˆä¸ºå¯èƒ½ï¼Œä»è€Œå¯¼è‡´æ¢¯åº¦ä¸å¯é å’Œæ”¶æ•›æ€§å·®ã€‚\nè§£å†³ä¸Šè¿°é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥å¢åŠ æ¨¡å‹çš„å°ºå¯¸ã€‚å½“æˆ‘ä»¬ä½¿ç”¨å¤§é‡çš„å‚æ•°æ¥æ„å»ºæ¨¡å‹æ—¶ï¼Œå®ƒæ›´æœ‰èƒ½åŠ›å¯¹æ•°æ®è¿›è¡Œæ›´å®Œæ•´çš„è½¬æ¢ã€‚ä¸Šè¿°æ–¹æ³•ä½¿å¾—å³ä½¿åœ¨æ•°æ®å‰é¦ˆè¿‡ç¨‹ä¸­ä¿¡æ¯ä¸¢å¤±ï¼Œä»ç„¶æœ‰æœºä¼šä¿ç•™è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ‰§è¡Œåˆ°ç›®æ ‡çš„æ˜ å°„ã€‚ä¸Šè¿°ç°è±¡è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨å¤§å¤šæ•°ç°ä»£æ¨¡å‹ä¸­å®½åº¦æ¯”æ·±åº¦æ›´é‡è¦ã€‚ç„¶è€Œï¼Œä¸Šè¿°ç»“è®ºå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³éå¸¸æ·±çš„ç¥ç»ç½‘ç»œä¸­æ¢¯åº¦ä¸å¯é çš„é—®é¢˜ã€‚\nä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨å¯é€†å‡½æ•°æ¥è§£å†³é—®é¢˜å¹¶è¿›è¡Œç›¸å…³åˆ†æã€‚\n3.2. Reversible Functions å½“å‡½æ•° $r$ æœ‰ä¸€ä¸ªé€†å˜æ¢å‡½æ•° $v$ æ—¶ï¼Œæˆ‘ä»¬ç§°è¯¥å‡½æ•°ä¸ºå¯é€†å‡½æ•°ï¼Œå¦‚å¼(2)æ‰€ç¤ºã€‚\nå…¶ä¸­ $Ïˆ$ å’Œ $Î¶$ åˆ†åˆ«æ˜¯ $r$ å’Œ $v$ çš„å‚æ•°ã€‚æ•°æ® $X$ é€šè¿‡å¯é€†å‡½æ•°è½¬æ¢è€Œä¸ä¼šä¸¢å¤±ä¿¡æ¯ï¼Œå¦‚å¼(3)æ‰€ç¤ºã€‚\nå½“ç½‘ç»œçš„å˜æ¢å‡½æ•°ç”±å¯é€†å‡½æ•°ç»„æˆæ—¶ï¼Œå¯ä»¥è·å¾—æ›´å¯é çš„æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹ã€‚å½“ä»Šæµè¡Œçš„æ·±åº¦å­¦ä¹ æ–¹æ³•å‡ ä¹éƒ½æ˜¯ç¬¦åˆå¯é€†æ€§è´¨çš„æ¶æ„ï¼Œä¾‹å¦‚å¼ï¼ˆ4ï¼‰ã€‚\nå…¶ä¸­ $l$ è¡¨ç¤º PreAct ResNet çš„ç¬¬ $l$ å±‚ï¼Œ$f$ æ˜¯ç¬¬ $l$ å±‚çš„å˜æ¢å‡½æ•°ã€‚ PreAct ResNet [22] ä»¥æ˜¾å¼æ–¹å¼é‡å¤å°†åŸå§‹æ•°æ® X ä¼ é€’åˆ°åç»­å±‚ã€‚è¿™æ ·çš„è®¾è®¡è™½ç„¶å¯ä»¥è®©ä¸€åƒå¤šå±‚çš„æ·±åº¦ç¥ç»ç½‘ç»œæ”¶æ•›å¾—å¾ˆå¥½ï¼Œä½†å´ç ´åäº†æˆ‘ä»¬éœ€è¦æ·±åº¦ç¥ç»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦åŸå› ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå›°éš¾çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾ˆéš¾ç›´æ¥æ‰¾åˆ°ç®€å•çš„æ˜ å°„å‡½æ•°å°†æ•°æ®æ˜ å°„åˆ°ç›®æ ‡ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå½“å±‚æ•°è¾ƒå°‘æ—¶ï¼ŒPreAct ResNet çš„æ€§èƒ½æ¯” ResNet [21] å·®ã€‚\nã€Remindã€‘PreAct ResNet å’Œ ResNet ç»“æ„å›¾æ¯”è¾ƒä¸€ä¸‹\næ­¤å¤–ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨Maskedå»ºæ¨¡ï¼Œä½¿ Transformer æ¨¡å‹å–å¾—é‡å¤§çªç ´ã€‚æˆ‘ä»¬ä½¿ç”¨è¿‘ä¼¼æ–¹æ³•ï¼Œä¾‹å¦‚æ–¹ç¨‹ (5) å°è¯•æ±‚ $r$ çš„é€†å˜æ¢ $v$ï¼Œä½¿å¾—å˜æ¢åçš„ç‰¹å¾èƒ½å¤Ÿåˆ©ç”¨ç¨€ç–ç‰¹å¾ä¿ç•™è¶³å¤Ÿçš„ä¿¡æ¯ã€‚æ–¹ç¨‹(5) å¦‚ä¸‹ï¼š\nå…¶ä¸­ $M$ æ˜¯åŠ¨æ€äºŒè¿›åˆ¶æ©ç ã€‚å…¶ä»–å¸¸ç”¨äºæ‰§è¡Œä¸Šè¿°ä»»åŠ¡çš„æ–¹æ³•æ˜¯æ‰©æ•£æ¨¡å‹å’Œå¯å˜åŒ–è‡ªåŠ¨ç¼–ç å™¨ï¼Œå®ƒä»¬éƒ½å…·æœ‰æŸ¥æ‰¾åå‡½æ•°çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å°†ä¸Šè¿°æ–¹æ³•åº”ç”¨äºè½»é‡çº§æ¨¡å‹æ—¶ï¼Œå°±ä¼šå­˜åœ¨ç¼ºé™·ï¼Œå› ä¸ºè½»é‡çº§æ¨¡å‹å¯¹å¤§é‡åŸå§‹æ•°æ®çš„å‚æ•°åŒ–ä¸è¶³ã€‚ç”±äºä¸Šè¿°åŸå› ï¼Œå°†æ•°æ® $X$ æ˜ å°„åˆ°ç›®æ ‡ $Y$ çš„é‡è¦ä¿¡æ¯ $I(Yï¼ŒX)$ ä¹Ÿä¼šé¢ä¸´åŒæ ·çš„é—®é¢˜ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¿¡æ¯ç“¶é¢ˆçš„æ¦‚å¿µæ¥æ¢è®¨å®ƒ[59]ã€‚ä¿¡æ¯ç“¶é¢ˆçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\nä¸€èˆ¬æ¥è¯´ï¼Œ$I(Y,X)$ åªä¼šå æ® $I(X,X)$ çš„å¾ˆå°ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œè¿™å¯¹äºç›®æ ‡ä»»åŠ¡è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œå³ä½¿å‰é¦ˆé˜¶æ®µä¸¢å¤±çš„ä¿¡æ¯é‡å¹¶ä¸å¤§ï¼Œåªè¦è¦†ç›–äº† $I(Y,X)$ï¼Œè®­ç»ƒæ•ˆæœå°±ä¼šå—åˆ°å¾ˆå¤§å½±å“ã€‚è½»é‡çº§æ¨¡å‹æœ¬èº«å¤„äºæ¬ å‚æ•°åŒ–çŠ¶æ€ï¼Œå› æ­¤åœ¨å‰é¦ˆé˜¶æ®µå¾ˆå®¹æ˜“ä¸¢å¤±å¾ˆå¤šé‡è¦ä¿¡æ¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è½»é‡çº§æ¨¡å‹çš„ç›®æ ‡æ˜¯å¦‚ä½•ä» $I(X, X)$ ä¸­å‡†ç¡®è¿‡æ»¤å‡º $I(Y, X)$ã€‚è‡³äºå®Œå…¨ä¿ç•™ $X$ çš„ä¿¡æ¯ï¼Œè¿™æ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚åŸºäºä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å¸Œæœ›æå‡ºä¸€ç§æ–°çš„æ·±åº¦ç¥ç»ç½‘ç»œè®­ç»ƒæ–¹æ³•ï¼Œä¸ä»…èƒ½å¤Ÿç”Ÿæˆå¯é çš„æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹ï¼Œè€Œä¸”é€‚ç”¨äºæµ…å±‚å’Œè½»é‡çº§ç¥ç»ç½‘ç»œã€‚\nMethodology 4.1 Programmable Gradient Information ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„è¾…åŠ©ç›‘ç£æ¡†æ¶ï¼Œç§°ä¸ºå¯ç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ï¼ˆPGIï¼‰ï¼Œå¦‚å›¾3ï¼ˆdï¼‰æ‰€ç¤ºã€‚ PGIä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå³ï¼ˆ1ï¼‰ä¸»åˆ†æ”¯ï¼Œï¼ˆ2ï¼‰è¾…åŠ©å¯é€†åˆ†æ”¯ï¼Œï¼ˆ3ï¼‰å¤šçº§è¾…åŠ©ä¿¡æ¯ã€‚ä»å›¾3(d)ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒPGIçš„æ¨ç†è¿‡ç¨‹ä»…ä½¿ç”¨ä¸»åˆ†æ”¯ï¼Œå› æ­¤ä¸éœ€è¦ä»»ä½•é¢å¤–çš„æ¨ç†æˆæœ¬ã€‚\nè‡³äºå…¶ä»–ä¸¤ä¸ªç»„ä»¶ï¼Œå®ƒä»¬ç”¨äºè§£å†³æˆ–å‡ç¼“æ·±åº¦å­¦ä¹ æ–¹æ³•ä¸­çš„å‡ ä¸ªé‡è¦é—®é¢˜ã€‚å…¶ä¸­ï¼Œè¾…åŠ©å¯é€†åˆ†æ”¯æ˜¯ä¸ºäº†å¤„ç†ç¥ç»ç½‘ç»œåŠ æ·±å¸¦æ¥çš„é—®é¢˜è€Œè®¾è®¡çš„ã€‚ç½‘ç»œåŠ æ·±ä¼šé€ æˆä¿¡æ¯ç“¶é¢ˆï¼Œå¯¼è‡´æŸå¤±å‡½æ•°æ— æ³•ç”Ÿæˆå¯é çš„æ¢¯åº¦ã€‚å¯¹äºå¤šçº§è¾…åŠ©ä¿¡æ¯ï¼Œæ—¨åœ¨å¤„ç†æ·±åº¦ç›‘ç£å¸¦æ¥çš„è¯¯å·®ç´¯ç§¯é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å¤šä¸ªé¢„æµ‹åˆ†æ”¯çš„æ¶æ„å’Œè½»é‡çº§æ¨¡å‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€æ­¥ä»‹ç»è¿™ä¸¤ä¸ªç»„ä»¶ã€‚\n4.1.1 Auxiliary Reversible Branch åœ¨PGIä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†è¾…åŠ©å¯é€†åˆ†æ”¯æ¥ç”Ÿæˆå¯é çš„æ¢¯åº¦å¹¶æ›´æ–°ç½‘ç»œå‚æ•°ã€‚é€šè¿‡æä¾›ä»æ•°æ®æ˜ å°„åˆ°ç›®æ ‡çš„ä¿¡æ¯ï¼ŒæŸå¤±å‡½æ•°å¯ä»¥æä¾›æŒ‡å¯¼å¹¶é¿å…ä»ä¸ç›®æ ‡ä¸å¤ªç›¸å…³çš„ä¸å®Œæ•´å‰é¦ˆç‰¹å¾ä¸­å‘ç°é”™è¯¯ç›¸å…³æ€§çš„å¯èƒ½æ€§ã€‚æˆ‘ä»¬æå‡ºé€šè¿‡å¼•å…¥å¯é€†æ¶æ„æ¥ç»´æŠ¤å®Œæ•´ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨å¯é€†æ¶æ„ä¸­æ·»åŠ ä¸»åˆ†æ”¯ä¼šæ¶ˆè€—å¤§é‡çš„æ¨ç†æˆæœ¬ã€‚\næˆ‘ä»¬åˆ†æäº†å›¾3(b)çš„æ¶æ„ï¼Œå‘ç°å½“æ·»åŠ ä»æ·±å±‚åˆ°æµ…å±‚çš„é¢å¤–è¿æ¥æ—¶ï¼Œæ¨ç†æ—¶é—´å°†å¢åŠ 20%ã€‚å½“æˆ‘ä»¬åå¤å°†è¾“å…¥æ•°æ®æ·»åŠ åˆ°ç½‘ç»œçš„**é«˜åˆ†è¾¨ç‡è®¡ç®—å±‚ï¼ˆé»„è‰²æ¡†ï¼‰**æ—¶ï¼Œæ¨ç†æ—¶é—´ç”šè‡³è¶…è¿‡äº†ä¸¤å€ã€‚\nç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨å¯é€†æ¶æ„æ¥è·å¾—å¯é çš„æ¢¯åº¦ï¼Œå› æ­¤**â€œå¯é€†â€å¹¶ä¸æ˜¯æ¨ç†é˜¶æ®µçš„å”¯ä¸€å¿…è¦æ¡ä»¶**ã€‚é‰´äºæ­¤ï¼Œæˆ‘ä»¬å°†å¯é€†åˆ†æ”¯è§†ä¸ºæ·±åº¦ç›‘ç£åˆ†æ”¯çš„æ‰©å±•ï¼Œç„¶åè®¾è®¡è¾…åŠ©å¯é€†åˆ†æ”¯ï¼Œå¦‚å›¾3(d)æ‰€ç¤ºã€‚å¯¹äºç”±äºä¿¡æ¯ç“¶é¢ˆè€Œä¸¢å¤±é‡è¦ä¿¡æ¯çš„ä¸»åˆ†æ”¯æ·±åº¦ç‰¹å¾ï¼Œå®ƒä»¬å°†èƒ½å¤Ÿä»è¾…åŠ©å¯é€†åˆ†æ”¯æ¥æ”¶å¯é çš„æ¢¯åº¦ä¿¡æ¯ã€‚\nè¿™äº›æ¢¯åº¦ä¿¡æ¯å°†é©±åŠ¨å‚æ•°å­¦ä¹ æ¥ååŠ©æå–æ­£ç¡®ä¸”é‡è¦çš„ä¿¡æ¯ï¼Œä¸Šè¿°åŠ¨ä½œå¯ä»¥ä½¿ä¸»åˆ†æ”¯è·å¾—å¯¹ç›®æ ‡ä»»åŠ¡æ›´æœ‰æ•ˆçš„ç‰¹å¾ã€‚æ­¤å¤–ï¼Œå¯é€†æ¶æ„åœ¨æµ…å±‚ç½‘ç»œä¸Šçš„è¡¨ç°æ¯”åœ¨ä¸€èˆ¬ç½‘ç»œä¸Šå·®ï¼Œå› ä¸ºå¤æ‚çš„ä»»åŠ¡éœ€è¦åœ¨æ›´æ·±çš„ç½‘ç»œä¸­è¿›è¡Œè½¬æ¢ã€‚æˆ‘ä»¬æå‡ºçš„æ–¹æ³•å¹¶ä¸å¼ºè¿«ä¸»åˆ†æ”¯ä¿ç•™å®Œæ•´çš„åŸå§‹ä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡è¾…åŠ©ç›‘ç£æœºåˆ¶ç”Ÿæˆæœ‰ç”¨çš„æ¢¯åº¦æ¥æ›´æ–°å®ƒã€‚è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹æ˜¯æ‰€æå‡ºçš„æ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨äºè¾ƒæµ…çš„ç½‘ç»œã€‚\næœ€åï¼Œç”±äºåœ¨æ¨ç†é˜¶æ®µå¯ä»¥å»é™¤è¾…åŠ©å¯é€†åˆ†æ”¯ï¼Œå› æ­¤å¯ä»¥ä¿ç•™åŸå§‹ç½‘ç»œçš„æ¨ç†èƒ½åŠ›ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©PGIä¸­çš„ä»»æ„å¯é€†æ¶æ„æ¥èµ·åˆ°è¾…åŠ©å¯é€†åˆ†æ”¯çš„ä½œç”¨ã€‚\n4.1.2 Multi-level Auxiliary Information åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¤šçº§è¾…åŠ©ä¿¡æ¯å¦‚ä½•å·¥ä½œã€‚åŒ…æ‹¬å¤šä¸ªé¢„æµ‹åˆ†æ”¯çš„æ·±åº¦ç›‘ç£æ¶æ„å¦‚å›¾ 3 (c) æ‰€ç¤ºã€‚å¯¹äºç›®æ ‡æ£€æµ‹ï¼Œä¸åŒçš„ç‰¹å¾é‡‘å­—å¡”å¯ç”¨äºæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä¾‹å¦‚å®ƒä»¬ä¸€èµ·å¯ä»¥æ£€æµ‹ä¸åŒå¤§å°çš„ç›®æ ‡ã€‚å› æ­¤ï¼Œè¿æ¥åˆ°æ·±åº¦ç›‘ç£åˆ†æ”¯åï¼Œä¼šå¼•å¯¼æµ…å±‚ç‰¹å¾å­¦ä¹ å°ç‰©ä½“æ£€æµ‹æ‰€éœ€çš„ç‰¹å¾ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå°†å…¶ä»–å°ºå¯¸çš„ç‰©ä½“çš„ä½ç½®è§†ä¸ºèƒŒæ™¯ã€‚ç„¶è€Œï¼Œä¸Šè¿°è¡Œä¸ºä¼šå¯¼è‡´æ·±å±‚ç‰¹å¾é‡‘å­—å¡”ä¸¢å¤±å¤§é‡é¢„æµ‹ç›®æ ‡å¯¹è±¡æ‰€éœ€çš„ä¿¡æ¯ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è®¤ä¸ºæ¯ä¸ªç‰¹å¾é‡‘å­—å¡”éƒ½éœ€è¦æ¥æ”¶æ‰€æœ‰ç›®æ ‡å¯¹è±¡çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åç»­çš„ä¸»åˆ†æ”¯å¯ä»¥ä¿ç•™å®Œæ•´çš„ä¿¡æ¯æ¥å­¦ä¹ å¯¹å„ç§ç›®æ ‡çš„é¢„æµ‹ã€‚\nè¾…åŠ©å¯é€†åˆ†æ”¯ï¼š (1) å¯ä»¥è¿˜åŸæ‰€æœ‰çš„ç‰¹å¾ä¿¡æ¯ ï¼ˆ2ï¼‰æ¨ç†çš„æ—¶å€™ï¼Œä¸ä¼šé¢å¤–å¢åŠ è®¡ç®—é‡\nå¤šçº§è¾…åŠ©ä¿¡æ¯ï¼š ä¸åˆ†å¤§ã€ä¸­ã€å°ç›®æ ‡ï¼ŒæŠŠæ‰€æœ‰ç‰©ä½“çš„ç‰¹å¾éƒ½æ±‡èšåœ¨ä¸€èµ·\n4.2. Generalized ELAN åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°æ‰€æå‡ºçš„æ–°ç½‘ç»œæ¶æ„â€”â€”GELANã€‚é€šè¿‡ç»“åˆé‡‡ç”¨æ¢¯åº¦è·¯å¾„è§„åˆ’è®¾è®¡çš„ä¸¤ç§ç¥ç»ç½‘ç»œæ¶æ„CSPNet [64]å’ŒELAN [65]ï¼Œæˆ‘ä»¬è®¾è®¡äº†å…¼é¡¾è½»é‡çº§ã€æ¨ç†é€Ÿåº¦å’Œå‡†ç¡®æ€§çš„å¹¿ä¹‰é«˜æ•ˆå±‚èšåˆç½‘ç»œï¼ˆGELANï¼‰ã€‚å…¶æ•´ä½“æ¶æ„å¦‚å›¾ 4 æ‰€ç¤ºã€‚æˆ‘ä»¬å°†æœ€åˆä»…ä½¿ç”¨å·ç§¯å±‚å †å çš„ ELAN [65] çš„åŠŸèƒ½æ¨å¹¿åˆ°å¯ä»¥ä½¿ç”¨ä»»ä½•è®¡ç®—å—çš„æ–°æ¶æ„ã€‚\nELAN å’Œ GELAN çš„åŒºåˆ«ï¼š\nELANä½¿ç”¨çš„æ˜¯å¸¸è§„çš„å·ç§¯æ“ä½œ\nGELANæ˜¯æŠŠå·ç§¯æ¢æˆäº†ä»»æ„çš„æ¨¡å—ï¼Œæœ€åè½¬åˆ°ç›¸åŒçš„é€šé“æ•°ã€ç›¸åŒç»´åº¦å¤§å°å³å¯\nExperiments å®éªŒæ˜¯ä¸€ç¯‡è®ºæ–‡ï¼Œå®¡ç¨¿äººçœ‹çš„æ¯”è¾ƒä»”ç»†çš„åœ°æ–¹ã€‚å­¦ä¹ ä¸€ä¸‹åˆ«äººçš„å†™æ³•\né™„å½•å¯ä»¥ç»™å®¡ç¨¿äººå’Œè¯»è€…ï¼Œæ›´ç›´è§‚çš„çœ‹åˆ°å®ç°çš„ç»†èŠ‚\n5.1. Experimental Setup æˆ‘ä»¬ä½¿ç”¨ MS COCO æ•°æ®é›†éªŒè¯äº†æ‰€æå‡ºçš„æ–¹æ³•ã€‚\næ‰€æœ‰å®éªŒè®¾ç½®å‡éµå¾ª YOLOv7 AF [63]ï¼Œè€Œæ•°æ®é›†ä¸º MS COCO 2017 åˆ†å‰²ã€‚æˆ‘ä»¬æåˆ°çš„æ‰€æœ‰æ¨¡å‹éƒ½æ˜¯ä½¿ç”¨ä»å¤´å¼€å§‹è®­ç»ƒç­–ç•¥è¿›è¡Œè®­ç»ƒçš„ï¼Œæ€»è®­ç»ƒæ¬¡æ•°ä¸º 500 epochã€‚åœ¨è®¾ç½®å­¦ä¹ ç‡æ—¶ï¼Œæˆ‘ä»¬åœ¨å‰ä¸‰ä¸ªepochä¸­ä½¿ç”¨çº¿æ€§é¢„çƒ­ï¼Œéšåçš„epochæ ¹æ®æ¨¡å‹è§„æ¨¡è®¾ç½®ç›¸åº”çš„è¡°å‡æ–¹å¼ã€‚è‡³äºæœ€å 15 ä¸ªæ—¶æœŸï¼Œæˆ‘ä»¬å…³é—­é©¬èµ›å…‹æ•°æ®å¢å¼ºã€‚æ›´å¤šè®¾ç½®è¯·å‚è€ƒé™„å½•ã€‚\n5.2 Implementation Details æˆ‘ä»¬åˆ†åˆ«åŸºäº YOLOv7 [63] å’Œ Dynamic YOLOv7 [36] æ„å»ºäº† YOLOv9 çš„é€šç”¨ç‰ˆæœ¬å’Œæ‰©å±•ç‰ˆæœ¬ã€‚\nåœ¨ç½‘ç»œæ¶æ„çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ CSPNet å— [64] å’Œè®¡åˆ’çš„ RepConv [63] ä½œä¸ºè®¡ç®—å—ï¼Œç”¨ GELAN æ›¿æ¢äº† ELAN [65]ã€‚æˆ‘ä»¬è¿˜ç®€åŒ–äº†ä¸‹é‡‡æ ·æ¨¡å—å¹¶ä¼˜åŒ–äº†æ— é”šé¢„æµ‹å¤´ã€‚è‡³äºPGIçš„è¾…åŠ©æŸå¤±éƒ¨åˆ†ï¼Œæˆ‘ä»¬å®Œå…¨éµå¾ªYOLOv7çš„è¾…åŠ©å¤´è®¾ç½®ã€‚è¯¦æƒ…è¯·å‚é˜…é™„å½•ã€‚\n5.3 Comparison with state-of-the-arts è¡¨ 1 åˆ—å‡ºäº†æˆ‘ä»¬æå‡ºçš„ YOLOv9 ä¸å…¶ä»–ä»å¤´å¼€å§‹è®­ç»ƒçš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨çš„æ¯”è¾ƒã€‚æ€»ä½“è€Œè¨€ï¼Œç°æœ‰æ–¹æ³•ä¸­æ€§èƒ½æœ€å¥½çš„æ–¹æ³•æ˜¯ç”¨äºè½»é‡çº§æ¨¡å‹çš„ YOLO MS-S [7]ã€ç”¨äºä¸­å‹æ¨¡å‹çš„ YOLO MS [7]ã€ç”¨äºé€šç”¨æ¨¡å‹çš„ YOLOv7 AF [63] å’Œç”¨äºå¤§å‹æ¨¡å‹çš„ YOLOv8-X [15]ã€‚ä¸è½»é‡çº§å’Œä¸­å‹æ¨¡å‹YOLO MS[7]ç›¸æ¯”ï¼ŒYOLOv9çš„å‚æ•°å‡å°‘äº†çº¦10%ï¼Œè®¡ç®—é‡å‡å°‘äº†5âˆ¼15%ï¼Œä½†APä»ç„¶æœ‰0.4âˆ¼0.6%çš„æå‡ã€‚ä¸YOLOv7 AFç›¸æ¯”ï¼ŒYOLOv9-Cçš„å‚æ•°å‡å°‘äº†42%ï¼Œè®¡ç®—é‡å‡å°‘äº†21%ï¼Œä½†è¾¾åˆ°äº†ç›¸åŒçš„APï¼ˆ53%ï¼‰ã€‚ä¸YOLOv8-Xç›¸æ¯”ï¼ŒYOLOv9-Xå‚æ•°å‡å°‘15%ï¼Œè®¡ç®—é‡å‡å°‘25%ï¼ŒAPæ˜¾ç€æå‡1.7%ã€‚ä¸Šè¿°å¯¹æ¯”ç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬æå‡ºçš„YOLOv9ä¸ç°æœ‰æ–¹æ³•ç›¸æ¯”åœ¨å„æ–¹é¢éƒ½æœ‰æ˜¾ç€æ”¹è¿›ã€‚\nå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå°†ImageNeté¢„è®­ç»ƒæ¨¡å‹çº³å…¥å¯¹æ¯”ï¼Œç»“æœå¦‚å›¾5æ‰€ç¤ºã€‚æˆ‘ä»¬åˆ†åˆ«æ ¹æ®å‚æ•°å’Œè®¡ç®—é‡è¿›è¡Œæ¯”è¾ƒã€‚å°±å‚æ•°æ•°é‡è€Œè¨€ï¼Œæ€§èƒ½æœ€å¥½çš„å¤§å‹æ¨¡å‹æ˜¯ RT DETR [43]ã€‚ä»å›¾5ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ä¼ ç»Ÿå·ç§¯çš„YOLOv9åœ¨å‚æ•°åˆ©ç”¨ç‡ä¸Šç”šè‡³æ¯”ä½¿ç”¨æ·±åº¦å·ç§¯çš„YOLO MSè¿˜è¦å¥½ã€‚è‡³äºå¤§å‹æ¨¡å‹çš„å‚æ•°åˆ©ç”¨ç‡ï¼Œä¹Ÿå¤§å¤§è¶…è¿‡äº†ä½¿ç”¨ImageNeté¢„è®­ç»ƒæ¨¡å‹çš„RT DETRã€‚æ›´æ£’çš„æ˜¯ï¼Œåœ¨æ·±åº¦æ¨¡å‹ä¸­ï¼ŒYOLOv9å±•ç¤ºäº†ä½¿ç”¨PGIçš„å·¨å¤§ä¼˜åŠ¿ã€‚é€šè¿‡å‡†ç¡®ä¿ç•™å’Œæå–å°†æ•°æ®æ˜ å°„åˆ°ç›®æ ‡æ‰€éœ€çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•ä»…éœ€è¦ 64% çš„å‚æ•°ï¼ŒåŒæ—¶ä¿æŒ RT DETR-X çš„ç²¾åº¦ã€‚\nè‡³äºè®¡ç®—é‡ï¼Œç°æœ‰æœ€å¥½çš„æ¨¡å‹ä»æœ€å°åˆ°æœ€å¤§ä¾æ¬¡æ˜¯YOLO MS [7]ã€PP YOLOE [74]å’ŒRT DETR [43]ã€‚ä»å›¾5ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒYOLOv9åœ¨è®¡ç®—å¤æ‚åº¦æ–¹é¢è¿œè¿œä¼˜äºä»å¤´å¼€å§‹è®­ç»ƒçš„æ–¹æ³•ã€‚å¦å¤–ï¼Œå¦‚æœä¸åŸºäºæ·±åº¦å·ç§¯å’ŒåŸºäºImageNetçš„é¢„è®­ç»ƒæ¨¡å‹ç›¸æ¯”ï¼ŒYOLOv9ä¹Ÿå¾ˆæœ‰ç«äº‰åŠ›ã€‚\n5.4 Ablation Studies 5.4.1 Generalized ELAN å¯¹äº GELANï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹è®¡ç®—æ¨¡å—è¿›è¡Œæ¶ˆèç ”ç©¶ã€‚æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨Reså—[21]ã€Darkå—[49]å’ŒCSPå—[64]è¿›è¡Œå®éªŒã€‚è¡¨2è¡¨æ˜ï¼Œç”¨ä¸åŒçš„è®¡ç®—å—æ›¿æ¢ELANä¸­çš„å·ç§¯å±‚åï¼Œç³»ç»Ÿå¯ä»¥ä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚ç”¨æˆ·ç¡®å®å¯ä»¥è‡ªç”±æ›´æ¢è®¡ç®—å—å¹¶åœ¨å„è‡ªçš„æ¨ç†è®¾å¤‡ä¸Šä½¿ç”¨å®ƒä»¬ã€‚åœ¨ä¸åŒçš„è®¡ç®—å—æ›¿æ¢ä¸­ï¼ŒCSP å—çš„æ€§èƒ½ç‰¹åˆ«å¥½ã€‚å®ƒä»¬ä¸ä»…å‡å°‘äº†å‚æ•°é‡å’Œè®¡ç®—é‡ï¼Œè€Œä¸”å°† AP æé«˜äº† 0.7%ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©CSPELANä½œä¸ºYOLOv9ä¸­GELANçš„ç»„æˆå•å…ƒã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹ä¸åŒå°ºå¯¸çš„GELANè¿›è¡ŒELANå—æ·±åº¦å’ŒCSPå—æ·±åº¦å®éªŒï¼Œå¹¶å°†ç»“æœæ˜¾ç¤ºåœ¨è¡¨3ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“ELANçš„æ·±åº¦ä»1å¢åŠ åˆ°2æ—¶ï¼Œç²¾åº¦æ˜¾ç€æé«˜ã€‚ä½†å½“æ·±åº¦å¤§äºç­‰äº2æ—¶ï¼Œæ— è®ºæ˜¯æé«˜ELANæ·±åº¦è¿˜æ˜¯CSPæ·±åº¦ï¼Œå‚æ•°æ•°é‡ã€è®¡ç®—é‡å’Œç²¾åº¦æ€»æ˜¯å‘ˆç°çº¿æ€§å…³ç³»ã€‚è¿™æ„å‘³ç€ GELAN å¯¹æ·±åº¦ä¸æ•æ„Ÿã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·å¯ä»¥ä»»æ„ç»„åˆGELANä¸­çš„ç»„ä»¶æ¥è®¾è®¡ç½‘ç»œæ¶æ„ï¼Œæ— éœ€ç‰¹æ®Šè®¾è®¡å³å¯æ‹¥æœ‰æ€§èƒ½ç¨³å®šçš„æ¨¡å‹ã€‚åœ¨è¡¨3ä¸­ï¼Œå¯¹äºYOLOv9-{S,M,C}ï¼Œæˆ‘ä»¬å°†ELANæ·±åº¦å’ŒCSPæ·±åº¦çš„é…å¯¹è®¾ç½®ä¸º{{2, 3}, {2, 1}, {2, 1}}ã€‚\n5.4.2 Programmable Gradient Information åœ¨PGIæ–¹é¢ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹backboneå’Œneckçš„è¾…åŠ©å¯é€†åˆ†æ”¯å’Œå¤šçº§è¾…åŠ©ä¿¡æ¯è¿›è¡Œäº†æ¶ˆèç ”ç©¶ã€‚æˆ‘ä»¬è®¾è®¡äº†è¾…åŠ©å¯é€†åˆ†æ”¯ICNæ¥ä½¿ç”¨DHLC[34]é“¾æ¥æ¥è·å–å¤šçº§å¯é€†ä¿¡æ¯ã€‚å¯¹äºå¤šçº§è¾…åŠ©ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨FPNå’ŒPANè¿›è¡Œæ¶ˆèç ”ç©¶ï¼ŒPFHçš„ä½œç”¨ç›¸å½“äºä¼ ç»Ÿçš„æ·±åº¦ç›‘ç£ã€‚æ‰€æœ‰å®éªŒçš„ç»“æœåˆ—äºè¡¨4ä¸­ã€‚ä»è¡¨4ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒPFHä»…åœ¨æ·±åº¦æ¨¡å‹ä¸­æœ‰æ•ˆï¼Œè€Œæˆ‘ä»¬æå‡ºçš„PGIå¯ä»¥åœ¨ä¸åŒç»„åˆä¸‹æé«˜ç²¾åº¦ã€‚å°¤å…¶æ˜¯ä½¿ç”¨ICNæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç¨³å®šä¸”æ›´å¥½çš„ç»“æœã€‚æˆ‘ä»¬è¿˜å°è¯•å°†YOLOv7[63]ä¸­æå‡ºçš„lead-headæŒ‡å¯¼åˆ†é…åº”ç”¨äºPGIçš„è¾…åŠ©ç›‘ç£ï¼Œå¹¶å–å¾—äº†æ›´å¥½çš„æ€§èƒ½ã€‚\næˆ‘ä»¬è¿›ä¸€æ­¥å°†PGIå’Œæ·±åº¦ç›‘ç£çš„æ¦‚å¿µåº”ç”¨åˆ°ä¸åŒè§„æ¨¡çš„æ¨¡å‹ä¸Šï¼Œå¹¶æ¯”è¾ƒç»“æœï¼Œç»“æœå¦‚è¡¨5æ‰€ç¤ºã€‚æ­£å¦‚ä¸€å¼€å§‹åˆ†æçš„é‚£æ ·ï¼Œæ·±åº¦ç›‘ç£çš„å¼•å…¥ä¼šå¯¼è‡´æµ…å±‚æ¨¡å‹ç²¾åº¦çš„æŸå¤±ã€‚å¯¹äºä¸€èˆ¬æ¨¡å‹æ¥è¯´ï¼Œå¼•å…¥æ·±åº¦ç›‘ç£ä¼šå¯¼è‡´æ€§èƒ½ä¸ç¨³å®šï¼Œè€Œæ·±åº¦ç›‘ç£çš„è®¾è®¡ç†å¿µåªèƒ½åœ¨ææ·±çš„æ¨¡å‹ä¸­å¸¦æ¥æ”¶ç›Šã€‚æ‰€æå‡ºçš„PGIå¯ä»¥æœ‰æ•ˆå¤„ç†ä¿¡æ¯ç“¶é¢ˆå’Œä¿¡æ¯ç ´ç¢ç­‰é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥å…¨é¢æé«˜ä¸åŒè§„æ¨¡æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚ PGI çš„æ¦‚å¿µå¸¦æ¥äº†ä¸¤ä¸ªå®è´µçš„è´¡çŒ®ã€‚ç¬¬ä¸€ä¸ªæ˜¯è®©è¾…åŠ©ç›‘ç£æ–¹æ³•é€‚ç”¨äºæµ…å±‚æ¨¡å‹ï¼Œç¬¬äºŒä¸ªæ˜¯è®©æ·±å±‚æ¨¡å‹è®­ç»ƒè¿‡ç¨‹è·å¾—æ›´å¯é çš„æ¢¯åº¦ã€‚è¿™äº›æ¢¯åº¦ä½¿æ·±åº¦æ¨¡å‹èƒ½å¤Ÿä½¿ç”¨æ›´å‡†ç¡®çš„ä¿¡æ¯æ¥å»ºç«‹æ•°æ®å’Œç›®æ ‡ä¹‹é—´çš„æ­£ç¡®ç›¸å…³æ€§\næœ€åï¼Œæˆ‘ä»¬åœ¨è¡¨ä¸­æ˜¾ç¤ºäº†ä»åŸºçº¿ YOLOv7 åˆ° YOLOv9E é€æ¸å¢åŠ ç»„ä»¶çš„ç»“æœã€‚æˆ‘ä»¬æå‡ºçš„GELANå’ŒPGIç»™æ¨¡å‹å¸¦æ¥äº†å…¨é¢çš„æ”¹è¿›ã€‚\n5.5 Visualization æœ¬èŠ‚å°†æ¢è®¨ä¿¡æ¯ç“¶é¢ˆé—®é¢˜å¹¶å°†å…¶å¯è§†åŒ–ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†å¯è§†åŒ–æ‰€æå‡ºçš„ PGI å¦‚ä½•ä½¿ç”¨å¯é çš„æ¢¯åº¦æ¥æ‰¾åˆ°æ•°æ®å’Œç›®æ ‡ä¹‹é—´çš„æ­£ç¡®ç›¸å…³æ€§ã€‚åœ¨å›¾6ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†åœ¨ä¸åŒæ¶æ„ä¸‹ä½¿ç”¨éšæœºåˆå§‹æƒé‡ä½œä¸ºå‰é¦ˆè·å¾—çš„ç‰¹å¾å›¾çš„å¯è§†åŒ–ç»“æœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œéšç€å±‚æ•°çš„å¢åŠ ï¼Œæ‰€æœ‰æ¶æ„çš„åŸå§‹ä¿¡æ¯é€æ¸å‡å°‘ã€‚ä¾‹å¦‚ï¼Œåœ¨PlainNetçš„ç¬¬50å±‚ï¼Œå¾ˆéš¾çœ‹åˆ°ç‰©ä½“çš„ä½ç½®ï¼Œå¹¶ä¸”æ‰€æœ‰å¯åŒºåˆ†çš„ç‰¹å¾å°†åœ¨ç¬¬100å±‚ä¸¢å¤±ã€‚å¯¹äºResNetï¼Œè™½ç„¶åœ¨ç¬¬50å±‚ä»ç„¶å¯ä»¥çœ‹åˆ°ç‰©ä½“çš„ä½ç½®ï¼Œä½†è¾¹ç•Œä¿¡æ¯å·²ç»ä¸¢å¤±ã€‚å½“æ·±åº¦è¾¾åˆ°ç¬¬100å±‚æ—¶ï¼Œæ•´ä¸ªå›¾åƒå˜å¾—æ¨¡ç³Šã€‚ CSPNet å’Œæå‡ºçš„ GELAN éƒ½è¡¨ç°å¾—éå¸¸å¥½ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½å¯ä»¥ä¿æŒæ”¯æŒæ¸…æ™°è¯†åˆ«å¯¹è±¡çš„ç‰¹å¾ç›´åˆ°ç¬¬ 200 å±‚ã€‚å¯¹æ¯”ä¸­ï¼ŒGELANç»“æœæ›´ç¨³å®šï¼Œè¾¹ç•Œä¿¡æ¯æ›´æ¸…æ™°\nå›¾7ç”¨äºå±•ç¤ºPGIæ˜¯å¦å¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æä¾›æ›´å¯é çš„æ¢¯åº¦ï¼Œä½¿å¾—ç”¨äºæ›´æ–°çš„å‚æ•°èƒ½å¤Ÿæœ‰æ•ˆæ•è·è¾“å…¥æ•°æ®ä¸ç›®æ ‡ä¹‹é—´çš„å…³ç³»ã€‚å›¾7æ˜¾ç¤ºäº†GELANå’ŒYOLOv9ï¼ˆGELAN + PGIï¼‰çš„ç‰¹å¾å›¾åœ¨PANåç½®é¢„çƒ­ä¸­çš„å¯è§†åŒ–ç»“æœã€‚ä»å›¾7ï¼ˆbï¼‰å’Œï¼ˆcï¼‰çš„æ¯”è¾ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°PGIå‡†ç¡®è€Œç®€æ´åœ°æ•è·äº†åŒ…å«å¯¹è±¡çš„åŒºåŸŸ**ã€‚å¯¹äºä¸ä½¿ç”¨PGIçš„GELANï¼Œæˆ‘ä»¬å‘ç°å®ƒåœ¨æ£€æµ‹ç‰©ä½“è¾¹ç•Œæ—¶å­˜åœ¨å‘æ•£**ï¼Œå¹¶ä¸”åœ¨æŸäº›èƒŒæ™¯åŒºåŸŸä¹Ÿäº§ç”Ÿäº†æ„æƒ³ä¸åˆ°çš„å“åº”ã€‚è¿™ä¸ªå®éªŒè¯å®äº†PGIç¡®å®å¯ä»¥æä¾›æ›´å¥½çš„æ¢¯åº¦æ¥æ›´æ–°å‚æ•°ï¼Œå¹¶ä½¿ä¸»åˆ†æ”¯çš„å‰é¦ˆé˜¶æ®µèƒ½å¤Ÿä¿ç•™æ›´é‡è¦çš„ç‰¹å¾ã€‚\nConclusions åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºä½¿ç”¨PGIæ¥è§£å†³ä¿¡æ¯ç“¶é¢ˆé—®é¢˜ä»¥åŠæ·±åº¦ç›‘ç£æœºåˆ¶ä¸é€‚åˆè½»é‡çº§ç¥ç»ç½‘ç»œçš„é—®é¢˜ã€‚æˆ‘ä»¬è®¾è®¡äº† GELANï¼Œä¸€ä¸ªé«˜æ•ˆã€è½»é‡çº§çš„ç¥ç»ç½‘ç»œã€‚åœ¨ç‰©ä½“æ£€æµ‹æ–¹é¢ï¼ŒGELANåœ¨ä¸åŒçš„è®¡ç®—å—å’Œæ·±åº¦è®¾ç½®ä¸‹éƒ½å…·æœ‰å¼ºå¤§ä¸”ç¨³å®šçš„æ€§èƒ½ã€‚å®ƒç¡®å®å¯ä»¥å¹¿æ³›æ‰©å±•ä¸ºé€‚åˆå„ç§æ¨ç†è®¾å¤‡çš„æ¨¡å‹ã€‚é’ˆå¯¹ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ï¼ŒPGIçš„å¼•å…¥ä½¿å¾—è½»é‡çº§æ¨¡å‹å’Œæ·±åº¦æ¨¡å‹éƒ½è·å¾—äº†ç²¾åº¦çš„æ˜¾ç€æå‡ã€‚ PGIå’ŒGELANç›¸ç»“åˆè®¾è®¡çš„YOLOv9å·²ç»å±•ç°å‡ºå¼ºå¤§çš„ç«äº‰åŠ›ã€‚å…¶å‡ºè‰²çš„è®¾è®¡ä½¿å¾—æ·±åº¦æ¨¡å‹ç›¸æ¯”YOLOv8å‡å°‘äº†49%çš„å‚æ•°æ•°é‡å’Œ43%çš„è®¡ç®—é‡ï¼Œä½†åœ¨MS COCOæ•°æ®é›†ä¸Šä»ç„¶æœ‰0.6%çš„APæå‡ã€‚\n","permalink":"https://swimmingliu.cn/posts/papernotes/2024-yolov9/","summary":"\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå¦‚ä»Šçš„æ·±åº¦å­¦ä¹ æ–¹æ³•ä¸»è¦å…³æ³¨å¦‚ä½•è®¾è®¡\u003cstrong\u003eæœ€åˆé€‚çš„ç›®æ ‡å‡½æ•°\u003c/strong\u003eï¼Œä½¿æ¨¡å‹çš„é¢„æµ‹ç»“æœèƒ½å¤Ÿæœ€æ¥è¿‘çœŸå®æƒ…å†µã€‚åŒæ—¶ï¼Œå¿…é¡»è®¾è®¡ä¸€ä¸ª\u003cstrong\u003eé€‚å½“çš„æ¶æ„\u003c/strong\u003eï¼Œå¯ä»¥å¸®åŠ©\u003cstrong\u003eè·å–è¶³å¤Ÿçš„ä¿¡æ¯è¿›è¡Œé¢„æµ‹\u003c/strong\u003eã€‚ç°æœ‰æ–¹æ³•å¿½ç•¥äº†ä¸€ä¸ªäº‹å®ï¼Œå³\u003cstrong\u003eå½“è¾“å…¥æ•°æ®ç»è¿‡é€å±‚ç‰¹å¾æå–å’Œç©ºé—´å˜æ¢æ—¶\u003c/strong\u003eï¼Œ\u003cstrong\u003eå¤§é‡ä¿¡æ¯å°†ä¼šä¸¢å¤±\u003c/strong\u003eã€‚æœ¬æ–‡å°†æ·±å…¥ç ”ç©¶æ•°æ®é€šè¿‡\u003cstrong\u003eæ·±åº¦ç½‘ç»œä¼ è¾“æ—¶æ•°æ®ä¸¢å¤±çš„é‡è¦é—®é¢˜\u003c/strong\u003eï¼Œå³\u003cstrong\u003eä¿¡æ¯ç“¶é¢ˆå’Œå¯é€†å‡½æ•°\u003c/strong\u003eã€‚æˆ‘ä»¬æå‡ºäº†\u003cstrong\u003eå¯ç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ï¼ˆPGIï¼‰\u003cstrong\u003eçš„æ¦‚å¿µæ¥åº”å¯¹æ·±åº¦ç½‘ç»œå®ç°\u003c/strong\u003eå¤šä¸ªç›®æ ‡æ‰€éœ€çš„å„ç§å˜åŒ–\u003c/strong\u003eã€‚\nPGIå¯ä»¥ä¸º\u003cstrong\u003eç›®æ ‡ä»»åŠ¡è®¡ç®—ç›®æ ‡å‡½æ•°\u003c/strong\u003eæä¾›\u003cstrong\u003eå®Œæ•´çš„è¾“å…¥ä¿¡æ¯\u003c/strong\u003eï¼Œä»è€Œè·å¾—\u003cstrong\u003eå¯é çš„æ¢¯åº¦ä¿¡æ¯æ¥æ›´æ–°ç½‘ç»œæƒå€¼\u003c/strong\u003eã€‚æ­¤å¤–ï¼Œè¿˜è®¾è®¡äº†ä¸€ç§åŸºäº\u003cstrong\u003eæ¢¯åº¦è·¯å¾„è§„åˆ’çš„æ–°å‹è½»é‡çº§ç½‘ç»œæ¶æ„\u003c/strong\u003eâ€”â€”\u003cstrong\u003eé€šç”¨é«˜æ•ˆå±‚èšåˆç½‘ç»œï¼ˆGELANï¼‰\u003c/strong\u003eã€‚GELANçš„æ¶æ„è¯å®äº†PGIåœ¨è½»é‡çº§æ¨¡å‹ä¸Šå–å¾—äº†ä¼˜å¼‚çš„ç»“æœã€‚æˆ‘ä»¬åœ¨åŸºäº MS COCO æ•°æ®é›†çš„ç›®æ ‡æ£€æµ‹ä¸ŠéªŒè¯äº†æ‰€æå‡ºçš„ GELAN å’Œ PGIã€‚ç»“æœè¡¨æ˜ï¼Œä¸åŸºäºæ·±åº¦å·ç§¯å¼€å‘çš„æœ€å…ˆè¿›æ–¹æ³•ç›¸æ¯”ï¼ŒGELAN ä»…ä½¿ç”¨\u003cstrong\u003eä¼ ç»Ÿçš„å·ç§¯ç®—å­\u003c/strong\u003eå³å¯å®ç°æ›´å¥½çš„å‚æ•°åˆ©ç”¨ç‡ã€‚ PGI å¯ç”¨äºä»è½»å‹åˆ°å¤§å‹çš„å„ç§æ¨¡å‹ã€‚å®ƒå¯ä»¥ç”¨æ¥è·å–å®Œæ•´çš„ä¿¡æ¯ï¼Œä½¿å¾—\u003cstrong\u003etrain-from-scratch (ä»é›¶å¼€å§‹è®­ç»ƒ) æ¨¡å‹èƒ½å¤Ÿæ¯”ä½¿ç”¨å¤§æ•°æ®é›†é¢„è®­ç»ƒ\u003c/strong\u003eçš„state-of-theartæ¨¡å‹è·å¾—æ›´å¥½çš„ç»“æœï¼Œå¯¹æ¯”ç»“æœå¦‚å›¾1æ‰€ç¤ºã€‚æºä»£ç ä½äºï¼šhttpsï¼š //github.com/WongKinYiu/yolov9ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eæ ¸å¿ƒåˆ›æ–°ç‚¹:  ä¾ç„¶æ˜¯ç½‘ç»œç»“æ„çš„åˆ›æ–°\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eProgrammable Gradient Information (PGI)\u003c/li\u003e\n\u003cli\u003eGeneralized Efficient Layer Aggregation Networkï¼ˆGELANï¼‰\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240301113226341\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/f6b3ea45-d79d-11ee-a66b-c858c0c1debd\"\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåŸºäºæ·±åº¦å­¦ä¹ çš„æ¨¡å‹åœ¨è®¡ç®—æœºè§†è§‰ã€è¯­è¨€å¤„ç†å’Œè¯­éŸ³è¯†åˆ«ç­‰å„ä¸ªé¢†åŸŸéƒ½è¡¨ç°å‡ºäº†æ¯”è¿‡å»çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿæ›´å¥½çš„æ€§èƒ½ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ é¢†åŸŸçš„ç ”ç©¶äººå‘˜ä¸»è¦å…³æ³¨å¦‚ä½•å¼€å‘æ›´å¼ºå¤§çš„ç³»ç»Ÿæ¶æ„å’Œå­¦ä¹ æ–¹æ³•ï¼Œä¾‹å¦‚CNNï¼ŒTransformers[8,9,40] ã€41ã€60ã€69ã€70]ï¼ŒPerceivers[26ã€26ã€32ã€52ã€56ã€81ã€81]å’ŒMambas[17ã€38ã€80]ã€‚æ­¤å¤–ï¼Œä¸€äº›ç ”ç©¶äººå‘˜å°è¯•å¼€å‘æ›´é€šç”¨çš„ç›®æ ‡å‡½æ•°ï¼Œä¾‹å¦‚æŸå¤±å‡½æ•°[5,45,46,50,77,78]ï¼Œæ ‡ç­¾åˆ†é…[10,12,33,67,79]å’Œè¾…åŠ©ç›‘ç£[18] ã€20ã€24ã€28ã€29ã€51ã€54ã€68ã€76]ã€‚ä¸Šè¿°ç ”ç©¶éƒ½è¯•å›¾ç²¾ç¡®åœ°æ‰¾åˆ°\u003cstrong\u003eè¾“å…¥å’Œç›®æ ‡ä»»åŠ¡ä¹‹é—´çš„æ˜ å°„\u003c/strong\u003eã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°è¿‡å»çš„æ–¹æ³•éƒ½å¿½ç•¥äº†\u003cstrong\u003eè¾“å…¥æ•°æ®åœ¨å‰é¦ˆè¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿä¸å¯å¿½ç•¥çš„ä¿¡æ¯ä¸¢å¤±é‡\u003c/strong\u003eã€‚è¿™ç§\u003cstrong\u003eä¿¡æ¯ä¸¢å¤±\u003c/strong\u003eå¯èƒ½ä¼šå¯¼è‡´\u003cstrong\u003eæœ‰åå·®çš„æ¢¯åº¦æµ\u003c/strong\u003eï¼Œéšåç”¨äºæ›´æ–°æ¨¡å‹ã€‚ä¸Šè¿°é—®é¢˜å¯èƒ½å¯¼è‡´æ·±åº¦ç½‘ç»œ\u003cstrong\u003eåœ¨ç›®æ ‡å’Œè¾“å…¥ä¹‹é—´å»ºç«‹ä¸æ­£ç¡®çš„å…³è”\u003c/strong\u003eï¼Œå¯¼è‡´è®­ç»ƒåçš„æ¨¡å‹äº§ç”Ÿä¸æ­£ç¡®çš„é¢„æµ‹ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æ·±åº¦ç½‘ç»œä¸­ï¼Œ\u003cstrong\u003eè¾“å…¥æ•°æ®åœ¨å‰é¦ˆè¿‡ç¨‹ä¸­ä¸¢å¤±ä¿¡æ¯çš„ç°è±¡\u003c/strong\u003eä¿—ç§°\u003cstrong\u003eä¿¡æ¯ç“¶é¢ˆ\u003c/strong\u003e[59]ï¼Œå…¶ç¤ºæ„å›¾å¦‚å›¾2æ‰€ç¤ºã€‚ç›®å‰å¯ä»¥ç¼“è§£è¿™ç§ç°è±¡çš„ä¸»è¦æ–¹æ³•æœ‰ï¼šï¼ˆ1ï¼‰\u003cstrong\u003eå¯é€†æ¶æ„\u003c/strong\u003eçš„ä½¿ç”¨[3,16,19]ï¼šè¯¥æ–¹æ³•ä¸»è¦\u003cstrong\u003eä½¿ç”¨é‡å¤çš„è¾“å…¥æ•°æ®ï¼Œå¹¶ä»¥æ˜¾å¼çš„æ–¹å¼ç»´æŠ¤è¾“å…¥æ•°æ®çš„ä¿¡æ¯\u003c/strong\u003eï¼› ï¼ˆ2ï¼‰ä½¿ç”¨\u003cstrong\u003eMaskedå»ºæ¨¡\u003c/strong\u003e[1,6,9,27,71,73]ï¼šä¸»è¦åˆ©ç”¨é‡æ„æŸå¤±ï¼Œé‡‡ç”¨\u003cstrong\u003eéšå¼æ–¹å¼æœ€å¤§åŒ–æå–ç‰¹å¾å¹¶ä¿ç•™è¾“å…¥ä¿¡æ¯\u003c/strong\u003eï¼› ï¼ˆ3ï¼‰å¼•å…¥\u003cstrong\u003eæ·±åº¦ç›‘ç£\u003c/strong\u003eæ¦‚å¿µ[28,51,54,68]ï¼šå®ƒåˆ©ç”¨\u003cstrong\u003eæ²¡æœ‰ä¸¢å¤±å¤ªå¤šé‡è¦ä¿¡æ¯çš„æµ…å±‚ç‰¹å¾æ¥é¢„å…ˆå»ºç«‹ä»ç‰¹å¾åˆ°ç›®æ ‡çš„æ˜ å°„\u003c/strong\u003eï¼Œä»¥ç¡®ä¿\u003cstrong\u003eé‡è¦ä¿¡æ¯èƒ½å¤Ÿè¢«ä¼ é€’åˆ°æ›´æ·±çš„å±‚æ¬¡\u003c/strong\u003eã€‚ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•åœ¨è®­ç»ƒè¿‡ç¨‹å’Œæ¨ç†è¿‡ç¨‹ä¸­éƒ½å­˜åœ¨ä¸åŒçš„ç¼ºç‚¹ã€‚ä¾‹å¦‚ï¼Œ\u003cstrong\u003eå¯é€†æ¶æ„éœ€è¦é¢å¤–çš„å±‚æ¥ç»„åˆé‡å¤é¦ˆé€çš„è¾“å…¥æ•°æ®\u003c/strong\u003eï¼Œè¿™å°†æ˜¾ç€å¢åŠ æ¨ç†æˆæœ¬ã€‚å¦å¤–ï¼Œç”±äº\u003cstrong\u003eè¾“å…¥æ•°æ®å±‚åˆ°è¾“å‡ºå±‚ä¸èƒ½æœ‰å¤ªæ·±çš„è·¯å¾„\u003c/strong\u003eï¼Œè¿™ç§é™åˆ¶å°†å¯¼è‡´\u003cstrong\u003eåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éš¾ä»¥å¯¹é«˜é˜¶è¯­ä¹‰ä¿¡æ¯è¿›è¡Œå»ºæ¨¡\u003c/strong\u003eã€‚å¯¹äº \u003cstrong\u003eMasked å»ºæ¨¡\u003c/strong\u003eï¼Œå…¶\u003cstrong\u003eé‡å»ºæŸå¤±æœ‰æ—¶ä¸ç›®æ ‡æŸå¤±ç›¸å†²çª\u003c/strong\u003eã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°\u003cstrong\u003eæ©ç æœºåˆ¶è¿˜ä¼šäº§ç”Ÿä¸æ•°æ®çš„ä¸æ­£ç¡®å…³è”\u003c/strong\u003eã€‚ å¯¹äº\u003cstrong\u003eæ·±å±‚ç›‘ç£\u003c/strong\u003eæœºåˆ¶æ¥è¯´ï¼Œä¼šäº§ç”Ÿ\u003cstrong\u003eè¯¯å·®ç´¯ç§¯\u003c/strong\u003eï¼Œå¦‚æœ\u003cstrong\u003eæµ…å±‚ç›‘ç£åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸¢å¤±ä¿¡æ¯\u003c/strong\u003eï¼Œ\u003cstrong\u003eåç»­å±‚å°†æ— æ³•æ£€ç´¢åˆ°æ‰€éœ€ä¿¡æ¯\u003c/strong\u003eã€‚ä¸Šè¿°ç°è±¡åœ¨\u003cstrong\u003eå›°éš¾ä»»åŠ¡\u003c/strong\u003eå’Œ\u003cstrong\u003eå°æ¨¡å‹ä¸Š\u003c/strong\u003eä¼šæ›´åŠ \u003cstrong\u003eæ˜¾ç€\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eé’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå³\u003cstrong\u003eå¯ç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ï¼ˆPGIï¼‰\u003c/strong\u003eã€‚å…¶æ¦‚å¿µæ˜¯é€šè¿‡\u003cstrong\u003eè¾…åŠ©å¯é€†åˆ†æ”¯ç”Ÿæˆå¯é çš„æ¢¯åº¦\u003c/strong\u003eï¼Œä½¿å¾—\u003cstrong\u003eæ·±å±‚ç‰¹å¾ä»ç„¶èƒ½å¤Ÿä¿æŒæ‰§è¡Œç›®æ ‡ä»»åŠ¡çš„å…³é”®ç‰¹å¾\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè¾…åŠ©å¯é€†åˆ†æ”¯çš„è®¾è®¡\u003c/strong\u003eå¯ä»¥é¿å…ä¼ ç»Ÿçš„\u003cstrong\u003eèåˆå¤šè·¯å¾„ç‰¹å¾çš„æ·±åº¦ç›‘ç£è¿‡ç¨‹\u003c/strong\u003eå¯èƒ½é€ æˆçš„\u003cstrong\u003eè¯­ä¹‰æŸå¤±\u003c/strong\u003eã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åœ¨\u003cstrong\u003eä¸åŒè¯­ä¹‰å±‚é¢ä¸Šç¼–ç¨‹æ¢¯åº¦ä¿¡æ¯ä¼ æ’­\u003c/strong\u003eï¼Œä»è€Œè¾¾åˆ°æœ€ä½³çš„è®­ç»ƒç»“æœã€‚ PGIçš„\u003cstrong\u003eå¯é€†æ¶æ„å»ºç«‹åœ¨è¾…åŠ©åˆ†æ”¯ä¸Š\u003c/strong\u003eï¼Œå› æ­¤\u003cstrong\u003eæ²¡æœ‰é¢å¤–çš„æˆæœ¬\u003c/strong\u003eã€‚ç”±äºPGIå¯ä»¥\u003cstrong\u003eè‡ªç”±é€‰æ‹©é€‚åˆç›®æ ‡ä»»åŠ¡çš„æŸå¤±å‡½æ•°\u003c/strong\u003eï¼Œå› æ­¤ä¹Ÿå…‹æœäº†\u003cstrong\u003eMaskedå»ºæ¨¡\u003c/strong\u003eé‡åˆ°çš„é—®é¢˜ã€‚æ‰€æå‡ºçš„\u003cstrong\u003ePGIæœºåˆ¶\u003c/strong\u003eå¯ä»¥åº”ç”¨äºå„ç§è§„æ¨¡çš„\u003cstrong\u003eæ·±åº¦ç¥ç»ç½‘ç»œ\u003c/strong\u003eï¼Œå¹¶ä¸”æ¯”ä»…é€‚ç”¨äº\u003cstrong\u003eéå¸¸æ·±çš„ç¥ç»ç½‘ç»œ\u003c/strong\u003eçš„\u003cstrong\u003eæ·±åº¦ç›‘ç£æœºåˆ¶æ›´é€šç”¨\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è¿˜åŸºäºELAN[65]è®¾è®¡äº†\u003cstrong\u003eå¹¿ä¹‰ELANï¼ˆGELANï¼‰\u003c/strong\u003eï¼ŒGELANçš„è®¾è®¡åŒæ—¶\u003cstrong\u003eè€ƒè™‘äº†å‚æ•°é‡ã€è®¡ç®—å¤æ‚åº¦ã€å‡†ç¡®æ€§å’Œæ¨ç†é€Ÿåº¦\u003c/strong\u003eã€‚è¿™ç§è®¾è®¡å…è®¸ç”¨æˆ·\u003cstrong\u003eé’ˆå¯¹ä¸åŒçš„æ¨ç†è®¾å¤‡ä»»æ„é€‰æ‹©åˆé€‚çš„è®¡ç®—å—\u003c/strong\u003eã€‚æˆ‘ä»¬å°†æå‡ºçš„PGIå’ŒGELANç»“åˆèµ·æ¥ï¼Œç„¶åè®¾è®¡äº†æ–°ä¸€ä»£YOLOç³»åˆ—ç‰©ä½“æ£€æµ‹ç³»ç»Ÿï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºYOLOv9ã€‚æˆ‘ä»¬ä½¿ç”¨MS COCOæ•°æ®é›†è¿›è¡Œå®éªŒï¼Œå®éªŒç»“æœéªŒè¯äº†æˆ‘ä»¬æå‡ºçš„YOLOv9åœ¨æ‰€æœ‰æ¯”è¾ƒä¸­éƒ½å–å¾—äº†é¡¶å°–çš„æ€§èƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æ€»ç»“æœ¬æ–‡çš„è´¡çŒ®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eæˆ‘ä»¬ä»\u003cstrong\u003eå¯é€†å‡½æ•°çš„è§’åº¦\u003c/strong\u003eå¯¹\u003cstrong\u003eç°æœ‰çš„æ·±åº¦ç¥ç»ç½‘ç»œæ¶æ„è¿›è¡Œäº†ç†è®ºåˆ†æ\u003c/strong\u003eï¼Œé€šè¿‡è¿™ä¸ªè¿‡ç¨‹\u003cstrong\u003eæˆ‘ä»¬æˆåŠŸåœ°è§£é‡Šäº†è®¸å¤šè¿‡å»éš¾ä»¥è§£é‡Šçš„ç°è±¡\u003c/strong\u003eã€‚æˆ‘ä»¬è¿˜åŸºäºæ­¤åˆ†æ\u003cstrong\u003eè®¾è®¡äº†PGIå’Œè¾…åŠ©å¯é€†åˆ†æ”¯\u003c/strong\u003eï¼Œå¹¶å–å¾—äº†ä¼˜å¼‚çš„ç»“æœã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæˆ‘ä»¬è®¾è®¡çš„PGIè§£å†³äº†\u003cstrong\u003eæ·±åº¦ç›‘ç£\u003c/strong\u003eåªèƒ½ç”¨äº\u003cstrong\u003eææ·±çš„ç¥ç»ç½‘ç»œæ¶æ„çš„é—®é¢˜\u003c/strong\u003eï¼Œä»è€Œè®©\u003cstrong\u003eæ–°çš„è½»é‡çº§æ¶æ„çœŸæ­£åº”ç”¨äºæ—¥å¸¸ç”Ÿæ´»ä¸­\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæˆ‘ä»¬è®¾è®¡çš„GELANä»…ä½¿ç”¨\u003cstrong\u003eå¸¸è§„å·ç§¯\u003c/strong\u003eæ¥å®ç°æ¯”åŸºäºæœ€å…ˆè¿›æŠ€æœ¯çš„\u003cstrong\u003eæ·±åº¦å·ç§¯è®¾è®¡æ›´é«˜çš„å‚æ•°åˆ©ç”¨ç‡\u003c/strong\u003eï¼ŒåŒæ—¶è¡¨ç°å‡º\u003cstrong\u003eè½»ã€å¿«é€Ÿã€å‡†ç¡®\u003c/strong\u003eçš„å·¨å¤§ä¼˜åŠ¿ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç»“åˆæ‰€æå‡ºçš„PGIå’ŒGELANï¼ŒYOLOv9åœ¨MS COCOæ•°æ®é›†ä¸Šçš„ç›®æ ‡æ£€æµ‹æ€§èƒ½åœ¨å„ä¸ªæ–¹é¢éƒ½å¤§å¤§è¶…è¿‡äº†ç°æœ‰çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\u003c/blockquote\u003e\n\u003cp\u003eProgrammable Gradient Information (PGI)ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eè‡ªç”±é€‰æ‹©é€‚åˆç›®æ ‡ä»»åŠ¡çš„æŸå¤±å‡½æ•°\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¯é€†ç»“æ„å»ºç«‹è¾…åŠ©åˆ†æ”¯ï¼Œä¸å¢åŠ æ¨ç†æˆæœ¬\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé€‚ç”¨äºå„ç§è§„æ¨¡çš„æ·±åº¦ç¥ç»ç½‘ç»œ\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eGELANï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eè½»ã€å¿«é€Ÿã€å‡†ç¡®\u003c/li\u003e\n\u003cli\u003eé‡‡ç”¨å¸¸è§„å·ç§¯åŠæ‰“å…¶ä»–æ–°é¢–å·ç§¯\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"related-work\"\u003eRelated work\u003c/h2\u003e\n\u003ch3 id=\"21-real-time-object-detectors\"\u003e2.1 Real-time Object Detectors\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eç›®å‰ä¸»æµçš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨æ˜¯YOLOç³»åˆ—[2,7,13â€“15,25,30,31,47â€“49,61â€“63,74,75]ï¼Œè¿™äº›æ¨¡å‹å¤§å¤šæ•°ä½¿ç”¨CSPNet[64]æˆ– ELAN [65] åŠå…¶å˜ä½“ä½œä¸ºä¸»è¦è®¡ç®—å•å…ƒã€‚åœ¨ç‰¹å¾é›†æˆæ–¹é¢ï¼Œé€šå¸¸ä½¿ç”¨æ”¹è¿›çš„PAN[37]æˆ–FPN[35]ä½œä¸ºå·¥å…·ï¼Œç„¶åä½¿ç”¨æ”¹è¿›çš„YOLOv3å¤´[49]æˆ–FCOSå¤´[57, 58]ä½œä¸ºé¢„æµ‹å¤´ã€‚æœ€è¿‘ä¹Ÿæå‡ºäº†ä¸€äº›å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ï¼Œä¾‹å¦‚ RT DETR [43]ï¼Œå…¶åŸºç¡€æ˜¯ DETR [4]ã€‚ç„¶è€Œï¼Œç”±äºDETRç³»åˆ—ç›®æ ‡æ£€æµ‹å™¨åœ¨æ²¡æœ‰ç›¸åº”é¢†åŸŸé¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µä¸‹å¾ˆéš¾åº”ç”¨äºæ–°é¢†åŸŸï¼Œå› æ­¤ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ä»ç„¶æ˜¯YOLOç³»åˆ—ã€‚æœ¬æ–‡é€‰æ‹© YOLOv7 [63] ä½œä¸ºå¼€å‘è¯¥æ–¹æ³•çš„åŸºç¡€ï¼Œè¯¥æ–¹æ³•å·²åœ¨å„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡å’Œå„ç§åœºæ™¯ä¸­è¢«è¯æ˜æœ‰æ•ˆã€‚\u003c/p\u003e","title":"YOLOv9: Learning What You Want to Learn Using Programmable Gradient Information"},{"content":"Introduction YOLOSHOW is a graphical user interface (GUI) application embed with YOLOv5 YOLOv7 YOLOv8 YOLOv9 YOLOv10 YOLOv11 RT-DETR SAM MobileSAM FastSAM algorithm.\nEnglish \u0026nbsp; | \u0026nbsp; ç®€ä½“ä¸­æ–‡ Demo Video YOLOSHOW v1.x : YOLOSHOW-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\nYOLOSHOW v2.x : YOLOSHOWv2.0-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\nTodo List Add YOLOv9 YOLOv10 RT-DETR YOLOv11 SAM MobileSAM FastSAM Algorithm Support Instance Segmentation ï¼ˆ YOLOv5 YOLOv8 YOLOv11 SAM MobileSAM FastSAMï¼‰ Support Pose Estimation ï¼ˆ YOLOv8 YOLOv11ï¼‰ Support Oriented Bounding Boxes ( YOLOv8 YOLOv11 ) Support Http Protocol in RTSP Function ( Single Mode ) Add Model Comparison Modeï¼ˆVS Modeï¼‰ Support Dragging File Input Tracking \u0026amp; Counting ( Industrialization ) Functions 1. Support Image / Video / Webcam / Folder (Batch) / IPCam Object Detection Choose Image / Video / Webcam / Folder (Batch) / IPCam in the menu bar on the left to detect objects.\n2. Change Models / Hyper Parameters dynamically When the program is running to detect targets, you can change models / hyper Parameters\nSupport changing model in YOLOv5 / YOLOv7 / YOLOv8 / YOLOv9 / YOLOv10 / YOLOv11 / RTDETR / YOLOv5-seg / YOLOv8-seg YOLOv11-seg / YOLOv8-pose / YOLOv11-pose / YOLOv8-obb / YOLOv11-obb / SAM / MobileSAM / FastSAM dynamically Support changing IOU / Confidence / Delay time / line thickness dynamically 3. Loading Model Automatically Our program will automatically detect pt files including YOLOv5 Models / YOLOv7 Models / YOLOv8 Models / YOLOv9 Models / YOLOv10 Models / YOLOv11 Models / RT-DETR Models / SAM Models / MobileSAM Models / FastSAM Models that were previously added to the ptfiles folder.\nIf you need add the new pt file, please click Import Model button in Settings box to select your pt file. Then our program will put it into ptfiles folder.\nNotice :\nAll pt files are named including yolov5 / yolov7 / yolov8 / yolov9 / yolov10 / yolo11 / rtdetr / sam / samv2 / mobilesam / fastsam. (e.g. yolov8-test.pt) If it is a pt file of segmentation mode, please name it including yolov5n-seg / yolov8s-seg / yolo11-seg . (e.g. yolov8n-seg-test.pt) If it is a pt file of pose estimation mode, please name it including yolov8n-pose / yolo11n-pose . (e.g. yolov8n-pose-test.pt) If it is a pt file of oriented bounding box mode, please name it including yolov8n-obb / yolo11n-obb . (e.g. yolov8n-obb-test.pt) 4. Loading Configures After startup, the program will automatically loading the last configure parameters. After closedown, the program will save the changed configure parameters. 5. Save Results If you need Save results, please click Save Mode before detection. Then you can save your detection results in selected path.\n6. Support Object Detection, Instance Segmentation and Pose Estimation From YOLOSHOW v3.0ï¼Œour work supports both Object Detection , Instance Segmentation, Pose Estimation and Oriented Bounding Box. Meanwhile, it also supports task switching between different versionsï¼Œsuch as switching from YOLOv5 Object Detection task to YOLOv8 Instance Segmentation task.\n7. Support Model Comparison among Object Detection, Instance Segmentation, Pose Estimation and Oriented Bounding Box From YOLOSHOW v3.0ï¼Œour work supports compare model performance among Object Detection, Instance Segmentation, Pose Estimation and Oriented Bounding Box.\nPreparation Experimental environment OS : Windows 11 CPU : Intel(R) Core(TM) i7-10750H CPU @2.60GHz 2.59 GHz GPU : NVIDIA GeForce GTX 1660Ti 6GB 1. Create virtual environment create a virtual environment equipped with python version 3.9, then activate environment.\nconda create -n yoloshow python=3.9 conda activate yoloshow 2. Install Pytorch frame Windows: pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118 Linux: pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118 Change other pytorch version in 3. Install dependency package Switch the path to the location of the program\ncd {the location of the program} Install dependency package of program\npip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple 4. Add Font Windows User Copy all font files *.ttf in fonts folder into C:\\Windows\\Fonts\nLinux User mkdir -p ~/.local/share/fonts sudo cp fonts/Shojumaru-Regular.ttf ~/.local/share/fonts/ sudo fc-cache -fv MacOS User The MacBook is so expensive that I cannot afford it, please install .ttf by yourself. ğŸ˜‚\n5. Run Program python main.py Frames Reference YOLO Algorithm YOLOv5 YOLOv7 YOLOv8 / YOLOv11 / RT-DETR / SAM / MobileSAM / FastSAM YOLOv9 YOLOv10\nYOLO Graphical User Interface YOLOSIDE\tPyQt-Fluent-Widgets\n","permalink":"https://swimmingliu.cn/posts/diary/yoloshow/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003eYOLOSHOW\u003c/strong\u003e\u003c/em\u003e is a graphical user interface (GUI) application embed with \u003ccode\u003eYOLOv5\u003c/code\u003e \u003ccode\u003eYOLOv7\u003c/code\u003e \u003ccode\u003eYOLOv8\u003c/code\u003e \u003ccode\u003eYOLOv9\u003c/code\u003e \u003ccode\u003eYOLOv10\u003c/code\u003e \u003ccode\u003eYOLOv11\u003c/code\u003e  \u003ccode\u003eRT-DETR\u003c/code\u003e \u003ccode\u003eSAM\u003c/code\u003e \u003ccode\u003eMobileSAM\u003c/code\u003e \u003ccode\u003eFastSAM\u003c/code\u003e algorithm.\u003c/p\u003e\n \u003cp align=\"center\"\u003e \n  English \u0026nbsp; | \u0026nbsp; \u003ca href=\"https://github.com/SwimmingLiu/YOLOSHOW/blob/master/README_cn.md\"\u003eç®€ä½“ä¸­æ–‡\u003c/a\u003e\n \u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"YOLOSHOW-Screen\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/YOLOSHOW-SNAPSHOT.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"demo-video\"\u003eDemo Video\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eYOLOSHOW v1.x\u003c/code\u003e : \u003ca href=\"https://www.bilibili.com/video/BV1BC411x7fW\"\u003eYOLOSHOW-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eYOLOSHOW v2.x\u003c/code\u003e : \u003ca href=\"https://www.bilibili.com/video/BV1ZD421E7m3\"\u003eYOLOSHOWv2.0-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"todo-list\"\u003eTodo List\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Add \u003ccode\u003eYOLOv9\u003c/code\u003e \u003ccode\u003eYOLOv10\u003c/code\u003e  \u003ccode\u003eRT-DETR\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003e  \u003ccode\u003eSAM\u003c/code\u003e  \u003ccode\u003eMobileSAM\u003c/code\u003e  \u003ccode\u003eFastSAM\u003c/code\u003e Algorithm\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Support Instance Segmentation ï¼ˆ \u003ccode\u003eYOLOv5\u003c/code\u003e  \u003ccode\u003eYOLOv8\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003e \u003ccode\u003eSAM\u003c/code\u003e  \u003ccode\u003eMobileSAM\u003c/code\u003e  \u003ccode\u003eFastSAM\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Support Pose Estimation ï¼ˆ \u003ccode\u003eYOLOv8\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Support Oriented Bounding Boxes ( \u003ccode\u003eYOLOv8\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003e )\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Support Http Protocol in \u003ccode\u003eRTSP\u003c/code\u003e Function ( \u003ccode\u003eSingle\u003c/code\u003e Mode )\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Add Model Comparison Modeï¼ˆVS Modeï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e Support Dragging File Input\u003c/li\u003e\n\u003cli\u003e\u003cinput disabled=\"\" type=\"checkbox\"\u003e Tracking \u0026amp; Counting ( \u003ccode\u003eIndustrialization\u003c/code\u003e )\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"functions\"\u003eFunctions\u003c/h2\u003e\n\u003ch3 id=\"1-support-image--video--webcam--folder-batch--ipcam-object-detection\"\u003e1. Support Image / Video / Webcam / Folder (Batch) / IPCam Object Detection\u003c/h3\u003e\n\u003cp\u003eChoose Image / Video / Webcam / Folder (Batch) / IPCam in the menu bar on the left to detect objects.\u003c/p\u003e","title":"YOLOSHOW - YOLOv5/YOLOv7/YOLOv8/YOLOv9/RTDETR GUI based on Pyside6"},{"content":"ä»‹ç» YOLOSHOW æ˜¯ä¸€æ¬¾é›†åˆäº† YOLOv5 YOLOv7 YOLOv8 YOLOv9 YOLOv10 YOLOv11 RT-DETR SAM MobileSAM FastSAM çš„å›¾å½¢åŒ–ç•Œé¢ç¨‹åº\nEnglish \u0026nbsp; | \u0026nbsp; ç®€ä½“ä¸­æ–‡ æ¼”ç¤ºè§†é¢‘ YOLOSHOW v1.x : YOLOSHOW-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\nYOLOSHOW v2.x : YOLOSHOWv2.0-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\nå¾…åšæ¸…å• åŠ å…¥ YOLOv9 YOLOv10 RT-DETR YOLOv11 SAM MobileSAM FastSAMç®—æ³• æ”¯æŒå®ä¾‹åˆ†å‰² ï¼ˆ YOLOv5 YOLOv8 YOLOv11 SAM MobileSAM FastSAMï¼‰ æ”¯æŒå§¿æ€ä¼°è®¡ ï¼ˆYOLOv8 YOLOv11ï¼‰ æ”¯æŒæ—‹è½¬æ¡† (YOLOv8 YOLOv11) RTSP åŠŸèƒ½ æ”¯æŒ Http åè®® ( Single Mode ) æ”¯æŒæ¨¡å‹å¯¹æ¯”æ¨¡å¼ï¼ˆVS Modeï¼‰ æ”¯æŒæ‹–æ‹½æ–‡ä»¶è¾“å…¥ è¿½è¸ªå’Œè®¡æ•°æ¨¡å‹ ( å·¥ä¸šåŒ– ) åŠŸèƒ½ 1. æ”¯æŒ å›¾ç‰‡ / è§†é¢‘ / æ‘„åƒå¤´ / æ–‡ä»¶å¤¹ï¼ˆæ‰¹é‡ï¼‰/ ç½‘ç»œæ‘„åƒå¤´ ç›®æ ‡æ£€æµ‹ é€‰æ‹©å·¦ä¾§èœå•æ çš„å›¾ç‰‡ / è§†é¢‘ / æ‘„åƒå¤´ / æ–‡ä»¶å¤¹ï¼ˆæ‰¹é‡ï¼‰/ ç½‘ç»œæ‘„åƒå¤´ è¿›è¡Œç›®æ ‡æ£€æµ‹\n2. åŠ¨æ€åˆ‡æ¢æ¨¡å‹ / è°ƒæ•´è¶…å‚æ•° ç¨‹åºå¼€å§‹æ£€æµ‹æ—¶ï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢æ¨¡å‹ / è°ƒæ•´è¶…å‚æ•°\næ”¯æŒåŠ¨æ€åˆ‡æ¢ YOLOv5 / YOLOv7 / YOLOv8 / YOLOv9 / YOLOv10 / YOLOv11 / RTDETR / YOLOv5-seg / YOLOv8-seg YOLOv11-seg / YOLOv8-pose / YOLOv11-pose / YOLOv8-obb / YOLOv11-obb / SAM / MobileSAM / FastSAM æ¨¡å‹ æ”¯æŒåŠ¨æ€ä¿®æ”¹ IOU / Confidence / Delay time / line thickness è¶…å‚æ•° 3. åŠ¨æ€åŠ è½½æ¨¡å‹ ç¨‹åºå¯ä»¥è‡ªåŠ¨æ£€æµ‹ptfiles æ–‡ä»¶å¤¹ä¸­åŒ…å« YOLOv5 Models / YOLOv7 Models / YOLOv8 Models / YOLOv9 Models / YOLOv10 Models / YOLOv11 Models / RT-DETR Models / SAM Models / MobileSAM Models / FastSAM Models pt æ¨¡å‹.\nå¦‚æœä½ éœ€è¦å¯¼å…¥æ–°çš„ pt æ–‡ä»¶, è¯·ç‚¹å‡» Settings æ¡†ä¸­çš„ Import Model æŒ‰é’® æ¥é€‰æ‹©éœ€è¦å¯¼å…¥çš„ pt æ–‡ä»¶. ç„¶åç¨‹åºä¼šæŠŠè¯¥æ–‡ä»¶å¤åˆ¶åˆ° ptfiles æ–‡ä»¶å¤¹ä¸‹.\nNotice :\næ‰€æœ‰çš„ pt æ¨¡å‹æ–‡ä»¶å‘½åå¿…é¡»åŒ…å« yolov5 / yolov7 / yolov8 / yolov9 / yolov10 / yolo11 / rtdetr / sam / samv2 / mobilesam / fastsam ä¸­çš„ä»»æ„ä¸€ä¸ªç‰ˆæœ¬. (å¦‚ yolov8-test.pt) å¦‚æœæ˜¯åˆ†å‰²ç±»å‹çš„ pt æ–‡ä»¶, å‘½åä¸­åº”åŒ…å« yolov5n-seg / yolov8s-seg / yolo11-seg ä¸­çš„ä»»æ„ä¸€ä¸ªç‰ˆæœ¬. (å¦‚ yolov8n-seg-test.pt) å¦‚æœæ˜¯å§¿æ€æ£€æµ‹ç±»å‹çš„ pt æ–‡ä»¶, å‘½åä¸­åº”åŒ…å« yolov8n-pose / yolo11n-pose ä¸­çš„ä»»æ„ä¸€ä¸ªç‰ˆæœ¬. (å¦‚ yolov8n-pose-test.pt) å¦‚æœæ˜¯æ—‹è½¬æ¡†ç±»å‹çš„ pt æ–‡ä»¶, å‘½åä¸­åº”åŒ…å« yolov8n-obb / yolo11n-obb ä¸­çš„ä»»æ„ä¸€ä¸ªç‰ˆæœ¬. (e.g. yolov8n-obb-test.pt) 4. åŠ è½½è¶…å‚æ•°é…ç½® ç¨‹åºå¯åŠ¨å, è‡ªåŠ¨åŠ è½½æœ€è¿‘ä¿å­˜çš„è¶…å‚æ•°é…ç½®. ç¨‹åºå…³é—­å, è‡ªåŠ¨ä¿å­˜æœ€è¿‘ä¿®æ”¹çš„è¶…å‚æ•°é…ç½®. 5. ä¿å­˜æ£€æµ‹ç»“æœ å¦‚æœéœ€è¦ä¿å­˜æ£€æµ‹ç»“æœï¼Œè¯·åœ¨æ£€æµ‹å‰ç‚¹å‡» Save Mode . ç„¶åç­‰å¾…æ£€æµ‹å®Œæ¯•ï¼Œé€‰æ‹©éœ€è¦ä¿å­˜çš„è·¯å¾„è¿›è¡Œç»“æœä¿å­˜.\n6. åŒæ—¶æ”¯æŒç›®æ ‡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²å’Œå§¿æ€ä¼°è®¡ ä» YOLOSHOW v3.0 èµ· ï¼Œæ”¯æŒç›®æ ‡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²ã€å§¿æ€ä¼°è®¡å’Œæ—‹è½¬æ¡†å¤šç§ä»»åŠ¡ã€‚åŒæ—¶æ”¯æŒä¸åŒç‰ˆæœ¬çš„ä»»åŠ¡åˆ‡æ¢ï¼Œå¦‚ä»YOLOv5 ç›®æ ‡æ£€æµ‹ä»»åŠ¡ åˆ‡æ¢åˆ° YOLOv8 å®ä¾‹åˆ†å‰²ä»»åŠ¡ã€‚\n7. æ”¯æŒç›®æ ‡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²ã€å§¿æ€ä¼°è®¡å’Œæ—‹è½¬æ¡†æ¨¡å‹å¯¹æ¯”æ¨¡å¼ ä» YOLOSHOW v3.0 èµ·ï¼Œæ”¯æŒç›®æ ‡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²ã€å§¿æ€ä¼°è®¡å’Œæ—‹è½¬æ¡†æ¨¡å‹å¯¹æ¯”æ¨¡å¼ã€‚\nè¿è¡Œå‡†å¤‡å·¥ä½œ å®éªŒç¯å¢ƒ OS : Windows 11 CPU : Intel(R) Core(TM) i7-10750H CPU @2.60GHz 2.59 GHz GPU : NVIDIA GeForce GTX 1660Ti 6GB 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ åˆ›å»ºå†…ç½®Python 3.9çš„condaè™šæ‹Ÿç¯å¢ƒ, ç„¶åæ¿€æ´»è¯¥ç¯å¢ƒ.\nconda create -n yoloshow python=3.9 conda activate yoloshow 2. å®‰è£…Pytorchæ¡†æ¶ Windows: pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118 Linux: pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118 å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ Pytorch : 3. å®‰è£…ä¾èµ–åŒ… åˆ‡æ¢åˆ°YOLOSHOWç¨‹åºæ‰€åœ¨çš„è·¯å¾„\ncd {YOLOSHOWç¨‹åºæ‰€åœ¨çš„è·¯å¾„} å®‰è£…ç¨‹åºæ‰€éœ€è¦çš„ä¾èµ–åŒ…\npip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple 4. æ·»åŠ å­—ä½“ Windows ç”¨æˆ· æŠŠæ‰€æœ‰çš„fonts æ–‡ä»¶å¤¹ä¸­çš„å­—ä½“æ–‡ä»¶ *.ttf å¤åˆ¶åˆ° C:\\Windows\\Fonts\nLinux ç”¨æˆ· mkdir -p ~/.local/share/fonts sudo cp fonts/Shojumaru-Regular.ttf ~/.local/share/fonts/ sudo fc-cache -fv MacOS ç”¨æˆ· MacBookå®åœ¨å¤ªè´µäº†ï¼Œæˆ‘ä¹°ä¸èµ·ã€‚ä½ ä»¬è‡ªå·±æƒ³åŠæ³•å®‰è£…å§~ğŸ˜‚\n5. è¿è¡Œç¨‹åº python main.py ä½¿ç”¨æ¡†æ¶ å‚è€ƒæ–‡çŒ® YOLO ç®—æ³• YOLOv5 YOLOv7 YOLOv8 / YOLOv11 / RT-DETR / SAM / MobileSAM / FastSAM YOLOv9 YOLOv10\nYOLO å›¾å½¢åŒ–ç•Œé¢ YOLOSIDE\tPyQt-Fluent-Widgets\n","permalink":"https://swimmingliu.cn/posts/diary/yoloshow-cn/","summary":"\u003ch2 id=\"ä»‹ç»\"\u003eä»‹ç»\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003eYOLOSHOW\u003c/strong\u003e\u003c/em\u003e æ˜¯ä¸€æ¬¾é›†åˆäº† \u003ccode\u003eYOLOv5\u003c/code\u003e \u003ccode\u003eYOLOv7\u003c/code\u003e \u003ccode\u003eYOLOv8\u003c/code\u003e \u003ccode\u003eYOLOv9\u003c/code\u003e \u003ccode\u003eYOLOv10\u003c/code\u003e \u003ccode\u003eYOLOv11\u003c/code\u003e  \u003ccode\u003eRT-DETR\u003c/code\u003e \u003ccode\u003eSAM\u003c/code\u003e \u003ccode\u003eMobileSAM\u003c/code\u003e \u003ccode\u003eFastSAM\u003c/code\u003e çš„å›¾å½¢åŒ–ç•Œé¢ç¨‹åº\u003c/p\u003e\n\u003cp align=\"center\"\u003e \n  \u003ca href=\"https://github.com/SwimmingLiu/YOLOSHOW/blob/master/README.md\"\u003e English\u003c/a\u003e \u0026nbsp; | \u0026nbsp; ç®€ä½“ä¸­æ–‡\u003c/a\u003e\n \u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"YOLOSHOW-Screen\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/YOLOSHOW-SNAPSHOT.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"æ¼”ç¤ºè§†é¢‘\"\u003eæ¼”ç¤ºè§†é¢‘\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eYOLOSHOW v1.x\u003c/code\u003e : \u003ca href=\"https://www.bilibili.com/video/BV1BC411x7fW\"\u003eYOLOSHOW-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eYOLOSHOW v2.x\u003c/code\u003e : \u003ca href=\"https://www.bilibili.com/video/BV1ZD421E7m3\"\u003eYOLOSHOWv2.0-YOLOv9/YOLOv8/YOLOv7/YOLOv5/RTDETR GUI\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"å¾…åšæ¸…å•\"\u003eå¾…åšæ¸…å•\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e åŠ å…¥ \u003ccode\u003eYOLOv9\u003c/code\u003e \u003ccode\u003eYOLOv10\u003c/code\u003e  \u003ccode\u003eRT-DETR\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003e  \u003ccode\u003eSAM\u003c/code\u003e  \u003ccode\u003eMobileSAM\u003c/code\u003e  \u003ccode\u003eFastSAM\u003c/code\u003eç®—æ³•\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e æ”¯æŒå®ä¾‹åˆ†å‰² ï¼ˆ \u003ccode\u003eYOLOv5\u003c/code\u003e  \u003ccode\u003eYOLOv8\u003c/code\u003e  \u003ccode\u003eYOLOv11\u003c/code\u003e \u003ccode\u003eSAM\u003c/code\u003e  \u003ccode\u003eMobileSAM\u003c/code\u003e  \u003ccode\u003eFastSAM\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e æ”¯æŒå§¿æ€ä¼°è®¡ ï¼ˆ\u003ccode\u003eYOLOv8\u003c/code\u003e \u003ccode\u003eYOLOv11\u003c/code\u003eï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e æ”¯æŒæ—‹è½¬æ¡† (\u003ccode\u003eYOLOv8\u003c/code\u003e \u003ccode\u003eYOLOv11\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e \u003ccode\u003eRTSP\u003c/code\u003e åŠŸèƒ½ æ”¯æŒ Http åè®® ( Single Mode )\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e æ”¯æŒæ¨¡å‹å¯¹æ¯”æ¨¡å¼ï¼ˆVS Modeï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cinput checked=\"\" disabled=\"\" type=\"checkbox\"\u003e æ”¯æŒæ‹–æ‹½æ–‡ä»¶è¾“å…¥\u003c/li\u003e\n\u003cli\u003e\u003cinput disabled=\"\" type=\"checkbox\"\u003e è¿½è¸ªå’Œè®¡æ•°æ¨¡å‹ ( \u003ccode\u003eå·¥ä¸šåŒ–\u003c/code\u003e )\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"åŠŸèƒ½\"\u003eåŠŸèƒ½\u003c/h2\u003e\n\u003ch3 id=\"1-æ”¯æŒ-å›¾ç‰‡--è§†é¢‘--æ‘„åƒå¤´--æ–‡ä»¶å¤¹æ‰¹é‡-ç½‘ç»œæ‘„åƒå¤´-ç›®æ ‡æ£€æµ‹\"\u003e1. æ”¯æŒ å›¾ç‰‡ / è§†é¢‘ / æ‘„åƒå¤´ / æ–‡ä»¶å¤¹ï¼ˆæ‰¹é‡ï¼‰/ ç½‘ç»œæ‘„åƒå¤´ ç›®æ ‡æ£€æµ‹\u003c/h3\u003e\n\u003cp\u003eé€‰æ‹©å·¦ä¾§èœå•æ çš„å›¾ç‰‡ / è§†é¢‘ / æ‘„åƒå¤´ / æ–‡ä»¶å¤¹ï¼ˆæ‰¹é‡ï¼‰/ ç½‘ç»œæ‘„åƒå¤´ è¿›è¡Œç›®æ ‡æ£€æµ‹\u003c/p\u003e","title":"YOLOSHOW ä¸­æ–‡ç‰ˆ - YOLOv5/YOLOv7/YOLOv8/YOLOv9/RTDETR GUI based on Pyside6"},{"content":"å®‰è£… Xshell å’Œ Xftp https://www.netsarang.com/en/xshell-download/ # Xshellä¸‹è½½è¿æ¥ https://blog.csdn.net/m0_67400972/article/details/125346023 # å®‰è£…æ•™ç¨‹ æ·»åŠ Xshellè¿æ¥ å…¶ä¸­ server.ip ä¸ºæœåŠ¡å™¨å…¬ç½‘ipåœ°å€ï¼Œç«¯å£ä¸º 6969\nå®‰è£…Anaconda3 æ¯ä¸ªç”¨æˆ·å‡è¢«åˆ†é… AnacondaAnaconda3-2023.07-1-Linux-x86_64.sh äºä¸»ç›®å½•\nbash AnacondaAnaconda3-2023.07-1-Linux-x86_64.sh # å®‰è£…anaconda3 è¾“å…¥ yes åï¼Œ å†æŒ‰å›è½¦é”® å³å¯\nåˆå§‹åŒ–Anaconda3 conda init bash\t# åˆå§‹åŒ–conda ç„¶åé‡æ–°ä½¿ç”¨Xshell è¿æ¥å³å¯\nMagic Network ä¸‹è½½å¤–ç½‘æ–‡ä»¶ã€å…‹éš†Githubé¡¹ç›®ç­‰æ“ä½œï¼Œå¿…é¡»ä½¿ç”¨Magic Network\nexport http_proxy=http://127.0.0.1:7890 export https_proxy=http://127.0.0.1:7890 å–æ¶ˆMagic Network\nunset http_proxy unset https_proxy å¦‚æœä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œä¸èƒ½è¿æ¥Google. éœ€è¦è¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œæ‰“å¼€CFW (é»˜è®¤æ˜¯æ‰“å¼€çš„)\nnohup bash /home/dell/LYJ/Clash/cfw \u0026gt; cfw.out å›½å†…é•œåƒä¸‹è½½ pip æ¸…åæºä¸‹è½½\npip install -i https://pypi.tuna.tsinghua.edu.cn/simple packge # packgeä¸ºåŒ…å conda é…ç½®é•œåƒ\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ # ä»¥ä¸Šä¸¤æ¡æ˜¯Anacondaå®˜æ–¹åº“çš„é•œåƒ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/ # ä»¥ä¸Šæ˜¯Anacondaç¬¬ä¸‰æ–¹åº“ Conda Forgeçš„é•œåƒ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/ # ä»¥ä¸Šæ˜¯Pytorchçš„Anacondaç¬¬ä¸‰æ–¹é•œåƒ è¿œç¨‹æ¡Œé¢è¿æ¥ è¿œç¨‹è¿æ¥ç›´æ¥æ‰¾å¸ˆå…„é—® å‘æ—¥è‘µ å’Œ Teamviewer å¯†ç ï¼Œè¿æ¥å³å¯\næ³¨æ„äº‹é¡¹ å»ºè®®éå¿…è¦ä¸ä½¿ç”¨è¿œç¨‹è¿æ¥ï¼ˆç”±äºåœ¨åŒä¸€æ—¶é—´æ®µå†…ï¼Œè¿œç¨‹è¿æ¥åªèƒ½å•ç”¨æˆ·ä½¿ç”¨ï¼‰ ä½¿ç”¨è¿œç¨‹è¿æ¥ï¼Œè¯·å…ˆé˜…è¯»æœåŠ¡å™¨å£çº¸ä¸Šçš„æ³¨æ„äº‹é¡¹ å¦‚éœ€ä¸Šä¼ æ–‡ä»¶ï¼Œå°½é‡ä½¿ç”¨ç§»åŠ¨ç¡¬ç›˜ï¼Œåˆ°918å®éªŒå®¤æ‹·è´è‡³æœåŠ¡å™¨ä¸Š ","permalink":"https://swimmingliu.cn/posts/diary/zstu_server_manuscript/","summary":"\u003ch2 id=\"å®‰è£…-xshell-å’Œ-xftp\"\u003eå®‰è£… Xshell å’Œ Xftp\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://www.netsarang.com/en/xshell-download/ \u003cspan class=\"c1\"\u003e# Xshellä¸‹è½½è¿æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://blog.csdn.net/m0_67400972/article/details/125346023 \u003cspan class=\"c1\"\u003e# å®‰è£…æ•™ç¨‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"æ·»åŠ xshellè¿æ¥\"\u003eæ·»åŠ Xshellè¿æ¥\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105113129928\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/B6xRW.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­ \u003ccode\u003eserver.ip\u003c/code\u003e ä¸ºæœåŠ¡å™¨å…¬ç½‘ipåœ°å€ï¼Œç«¯å£ä¸º \u003ccode\u003e6969\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"å®‰è£…anaconda3\"\u003eå®‰è£…Anaconda3\u003c/h2\u003e\n\u003cp\u003eæ¯ä¸ªç”¨æˆ·å‡è¢«åˆ†é… \u003ccode\u003eAnacondaAnaconda3-2023.07-1-Linux-x86_64.sh \u003c/code\u003e äºä¸»ç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebash AnacondaAnaconda3-2023.07-1-Linux-x86_64.sh \u003cspan class=\"c1\"\u003e# å®‰è£…anaconda3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20240105113942737\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/B6KTv.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¾“å…¥ \u003ccode\u003eyes\u003c/code\u003e åï¼Œ å†æŒ‰å›è½¦é”® å³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105114146047\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/B6one.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"åˆå§‹åŒ–anaconda3\"\u003eåˆå§‹åŒ–Anaconda3\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda init bash\t\u003cspan class=\"c1\"\u003e# åˆå§‹åŒ–conda\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åé‡æ–°ä½¿ç”¨Xshell è¿æ¥å³å¯\u003c/p\u003e\n\u003ch2 id=\"magic-network\"\u003eMagic Network\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½å¤–ç½‘æ–‡ä»¶ã€å…‹éš†Githubé¡¹ç›®ç­‰æ“ä½œï¼Œå¿…é¡»ä½¿ç”¨Magic Network\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttps_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå–æ¶ˆMagic Network\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eunset\u003c/span\u003e http_proxy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eunset\u003c/span\u003e https_proxy\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œä¸èƒ½è¿æ¥Google. éœ€è¦è¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œæ‰“å¼€CFW (é»˜è®¤æ˜¯æ‰“å¼€çš„)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enohup bash /home/dell/LYJ/Clash/cfw \u0026gt; cfw.out\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20240105115600487\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/B6So3.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"å›½å†…é•œåƒä¸‹è½½\"\u003eå›½å†…é•œåƒä¸‹è½½\u003c/h2\u003e\n\u003cp\u003epip æ¸…åæºä¸‹è½½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install -i https://pypi.tuna.tsinghua.edu.cn/simple packge      \u003cspan class=\"c1\"\u003e# packgeä¸ºåŒ…å\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003econda é…ç½®é•œåƒ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä»¥ä¸Šä¸¤æ¡æ˜¯Anacondaå®˜æ–¹åº“çš„é•œåƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä»¥ä¸Šæ˜¯Anacondaç¬¬ä¸‰æ–¹åº“ Conda Forgeçš„é•œåƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä»¥ä¸Šæ˜¯Pytorchçš„Anacondaç¬¬ä¸‰æ–¹é•œåƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"è¿œç¨‹æ¡Œé¢è¿æ¥\"\u003eè¿œç¨‹æ¡Œé¢è¿æ¥\u003c/h2\u003e\n\u003cp\u003eè¿œç¨‹è¿æ¥ç›´æ¥æ‰¾å¸ˆå…„é—® å‘æ—¥è‘µ å’Œ Teamviewer å¯†ç ï¼Œè¿æ¥å³å¯\u003c/p\u003e","title":"ZSTUæœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹ (Yang Li Lab)"},{"content":"FRPé…ç½® è·³æ¿æœº # frps.ini é…ç½® [common] bind_port = 7000 #frpsæœåŠ¡ç›‘å¬çš„ç«¯å£ token = 123 # é“¾æ¥å£ä»¤ ./frps -c frps.ini # å¯åŠ¨frps æœåŠ¡å™¨ # frpc.ini [common] server_addr = x.x.x.x # æ­¤å¤„ä¸º è·³æ¿æœº çš„å…¬ç½‘ip server_port = 7000 # è·³æ¿æœºä¸ŠfrpsæœåŠ¡ç›‘å¬çš„ç«¯å£ token = 123 # é“¾æ¥å£ä»¤ [ssh] type = tcp local_ip = 127.0.0.1 local_port = 22 # éœ€è¦æš´éœ²çš„å†…ç½‘æœºå™¨çš„ç«¯å£ remote_port = 6000 # æš´éœ²çš„å†…ç½‘æœºå™¨çš„ç«¯å£åœ¨vpsä¸Šçš„ç«¯å£ SSHè¿æ¥ ssh -p 6000 swimmingliu@server.ip # æ™®é€šssh è¿æ¥ ssh swimmingliu@server.ip 6000\t# xshell sshè¿æ¥ ç”¨æˆ·ç®¡ç† æ·»åŠ ç”¨æˆ· sudo adduser xxx åˆ é™¤ç”¨æˆ· sudo deluser xxx Magic Network export http_proxy=http://127.0.0.1:7890 export https_proxy=http://127.0.0.1:7890 Anaconda3 å®‰è£…å’Œé…ç½® å®‰è£…Anaconda3 wget --user-agent=\u0026#34;Mozilla\u0026#34; https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.07-1-Linux-x86_64.sh bash Anaconda3-2023.07-1-Linux-x86_64.sh # https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive æ¸…åæº é…ç½®ä¹‹å‰çš„envs cp -r old_envs_path anaconda/envs/\t#è¿ç§»ä¹‹å‰çš„envsç¯å¢ƒ å®Œç»“æ’’èŠ±â€â€â€ ","permalink":"https://swimmingliu.cn/posts/diary/zstu_server_management/","summary":"\u003ch2 id=\"frpé…ç½®\"\u003eFRPé…ç½®\u003c/h2\u003e\n\u003ch3 id=\"è·³æ¿æœº\"\u003eè·³æ¿æœº\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# frps.ini é…ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ecommon\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebind_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e7000\u003c/span\u003e \u003cspan class=\"c1\"\u003e#frpsæœåŠ¡ç›‘å¬çš„ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003etoken\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e123\u003c/span\u003e \u003cspan class=\"c1\"\u003e# é“¾æ¥å£ä»¤\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./frps -c frps.ini \u003cspan class=\"c1\"\u003e# å¯åŠ¨frps\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"æœåŠ¡å™¨\"\u003eæœåŠ¡å™¨\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# frpc.ini\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ecommon\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eserver_addr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e x.x.x.x \u003cspan class=\"c1\"\u003e# æ­¤å¤„ä¸º è·³æ¿æœº çš„å…¬ç½‘ip\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eserver_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e7000\u003c/span\u003e \u003cspan class=\"c1\"\u003e# è·³æ¿æœºä¸ŠfrpsæœåŠ¡ç›‘å¬çš„ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003etoken\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e123\u003c/span\u003e \u003cspan class=\"c1\"\u003e# é“¾æ¥å£ä»¤\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003essh\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e tcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elocal_ip\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 127.0.0.1 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elocal_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e22\u003c/span\u003e \u003cspan class=\"c1\"\u003e# éœ€è¦æš´éœ²çš„å†…ç½‘æœºå™¨çš„ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eremote_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e6000\u003c/span\u003e \u003cspan class=\"c1\"\u003e# æš´éœ²çš„å†…ç½‘æœºå™¨çš„ç«¯å£åœ¨vpsä¸Šçš„ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"sshè¿æ¥\"\u003eSSHè¿æ¥\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh -p \u003cspan class=\"m\"\u003e6000\u003c/span\u003e swimmingliu@server.ip \u003cspan class=\"c1\"\u003e# æ™®é€šssh è¿æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh swimmingliu@server.ip 6000\t  \u003cspan class=\"c1\"\u003e# xshell sshè¿æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ç”¨æˆ·ç®¡ç†\"\u003eç”¨æˆ·ç®¡ç†\u003c/h2\u003e\n\u003ch3 id=\"æ·»åŠ ç”¨æˆ·\"\u003eæ·»åŠ ç”¨æˆ·\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo adduser xxx\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åˆ é™¤ç”¨æˆ·\"\u003eåˆ é™¤ç”¨æˆ·\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo deluser xxx\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"magic-network\"\u003eMagic Network\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttps_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"anaconda3-å®‰è£…å’Œé…ç½®\"\u003eAnaconda3 å®‰è£…å’Œé…ç½®\u003c/h2\u003e\n\u003ch3 id=\"å®‰è£…anaconda3\"\u003eå®‰è£…Anaconda3\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget --user-agent\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Mozilla\u0026#34;\u003c/span\u003e https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.07-1-Linux-x86_64.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebash Anaconda3-2023.07-1-Linux-x86_64.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive æ¸…åæº\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"é…ç½®ä¹‹å‰çš„envs\"\u003eé…ç½®ä¹‹å‰çš„envs\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -r old_envs_path anaconda/envs/\t\t\u003cspan class=\"c1\"\u003e#è¿ç§»ä¹‹å‰çš„envsç¯å¢ƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å®Œç»“æ’’èŠ±\"\u003eå®Œç»“æ’’èŠ±â€â€â€\u003c/h2\u003e","title":"ZSTU Server Management"},{"content":"Introduction åŸºäºçŸ¥è¯†å›¾è°±å’Œneo4jå›¾æ•°æ®åº“çš„ç”µå½±çŸ¥è¯†é—®ç­”ç³»ç»Ÿ\nWorkflow DataBase çˆ¬å–è±†ç“£TOP1000ç”µå½±ä¿¡æ¯æ•°æ®\nFrontend è·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ ï¼ˆè¯­éŸ³è¾“å…¥ / æ–‡æœ¬è¾“å…¥ï¼‰ å‘ç”µå½±çŸ¥è¯†é—®ç­”åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚ è·å–è¿”å›ç»“æœ (æˆåŠŸ -\u0026gt; 4 / å¤±è´¥ -\u0026gt; 5) å¦‚æœè¿”å›ç»“æœåŒ…å«imageä¿¡æ¯ï¼Œåˆ™æ˜¾ç¤ºå›¾ç‰‡å’Œæ–‡å­—ï¼Œå¦åˆ™åªæ˜¾ç¤ºæ–‡å­— è¯·æ±‚åŸºäºgptçš„AIæ¨¡å‹æœåŠ¡å™¨ï¼Œå¹¶æ˜¾ç¤ºè¿”å›ç»“æœ Backend â€‹\t[å‡†å¤‡å·¥ä½œ] è®­ç»ƒ TF-IDF å‘é‡ç®—æ³•å’Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼Œç”¨äºé¢„æµ‹ç”¨æˆ·æ–‡æœ¬æ‰€å±çš„é—®é¢˜ç±»åˆ«\næ¥å—å‰ç«¯è¯·æ±‚ï¼Œè·å–ç”¨æˆ·è¾“å…¥ä¿¡æ¯ ä½¿ç”¨åˆ†è¯åº“è§£æç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è¯æ€§ï¼Œæå–å…³é”®è¯ æ ¹æ®è´å¶æ–¯åˆ†ç±»å™¨ï¼Œåˆ†ç±»å‡ºç”¨æˆ·æ–‡æœ¬çš„é—®é¢˜ç±»å‹ ç»“åˆå…³é”®è¯ä¸é—®é¢˜ç±»åˆ«ï¼Œåœ¨ Neo4j ä¸­æŸ¥è¯¢é—®é¢˜çš„ç­”æ¡ˆ è¿”å›æŸ¥è¯¢ç»“æœ ï¼ˆè‹¥é—®é¢˜ç±»å‹ä¸º æ¼”å‘˜ä¿¡æ¯ / ç”µå½±ä»‹ç»ï¼Œåˆ™é™„åŠ å›¾ç‰‡urlï¼‰ WorkFlow Graph Frame DataBase Frontend Backend Reference Frontend å¾®ä¿¡å°ç¨‹åºï¼šå¾®ä¿¡èŠå¤©æœºå™¨äºº\nBackEnd åŸºäºçŸ¥è¯†å›¾è°±çš„ç”µå½±çŸ¥è¯†é—®ç­”ç³»ç»Ÿ\nç”µå½±çŸ¥è¯†åº“é—®ç­”æœºå™¨äºº\n","permalink":"https://swimmingliu.cn/posts/diary/2023-moviekgqa/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eåŸºäºçŸ¥è¯†å›¾è°±å’Œneo4jå›¾æ•°æ®åº“çš„ç”µå½±çŸ¥è¯†é—®ç­”ç³»ç»Ÿ\u003c/p\u003e\n\u003cdiv style=\"display:flex; justify-content: space-around; \"\u003e\r\n\u003cimg src=\"https://i.imgs.ovh/2023/12/12/mM4uR.png\" alt=\"image-20231212102658908\" style=\"box-shadow: 0 0 10px rgba(200, 200, 200);\" width=30% height:300px/\u003e\r\n\u003cimg src=\"https://i.imgs.ovh/2023/12/12/mM58p.png\" alt=\"image-20231212102738360\" style=\"box-shadow: 0 0 10px rgba(200, 200, 200);\" width=30% height:300px/\u003e\r\n\u003cimg src=\"https://i.imgs.ovh/2023/12/12/mMdFT.png\" alt=\"image-20231212103113278\" style=\"\" width=30% height:300px/\u003e\r\n\u003c/div\u003e\r\n\u003ch2 id=\"workflow\"\u003eWorkflow\u003c/h2\u003e\n\u003ch3 id=\"database\"\u003eDataBase\u003c/h3\u003e\n\u003cp\u003eçˆ¬å–è±†ç“£TOP1000ç”µå½±ä¿¡æ¯æ•°æ®\u003c/p\u003e\n\u003ch3 id=\"frontend\"\u003eFrontend\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eè·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ ï¼ˆè¯­éŸ³è¾“å…¥ / æ–‡æœ¬è¾“å…¥ï¼‰\u003c/li\u003e\n\u003cli\u003eå‘ç”µå½±çŸ¥è¯†é—®ç­”åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚\u003c/li\u003e\n\u003cli\u003eè·å–è¿”å›ç»“æœ  (æˆåŠŸ -\u0026gt; 4 / å¤±è´¥ -\u0026gt; 5)\u003c/li\u003e\n\u003cli\u003eå¦‚æœè¿”å›ç»“æœåŒ…å«imageä¿¡æ¯ï¼Œåˆ™æ˜¾ç¤ºå›¾ç‰‡å’Œæ–‡å­—ï¼Œå¦åˆ™åªæ˜¾ç¤ºæ–‡å­—\u003c/li\u003e\n\u003cli\u003eè¯·æ±‚åŸºäºgptçš„AIæ¨¡å‹æœåŠ¡å™¨ï¼Œå¹¶æ˜¾ç¤ºè¿”å›ç»“æœ\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"backend\"\u003eBackend\u003c/h3\u003e\n\u003cp\u003eâ€‹\t[å‡†å¤‡å·¥ä½œ]  è®­ç»ƒ TF-IDF å‘é‡ç®—æ³•å’Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼Œç”¨äºé¢„æµ‹ç”¨æˆ·æ–‡æœ¬æ‰€å±çš„é—®é¢˜ç±»åˆ«\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæ¥å—å‰ç«¯è¯·æ±‚ï¼Œè·å–ç”¨æˆ·è¾“å…¥ä¿¡æ¯\u003c/li\u003e\n\u003cli\u003eä½¿ç”¨åˆ†è¯åº“è§£æç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è¯æ€§ï¼Œæå–å…³é”®è¯\u003c/li\u003e\n\u003cli\u003eæ ¹æ®è´å¶æ–¯åˆ†ç±»å™¨ï¼Œåˆ†ç±»å‡ºç”¨æˆ·æ–‡æœ¬çš„é—®é¢˜ç±»å‹\u003c/li\u003e\n\u003cli\u003eç»“åˆå…³é”®è¯ä¸é—®é¢˜ç±»åˆ«ï¼Œåœ¨ Neo4j ä¸­æŸ¥è¯¢é—®é¢˜çš„ç­”æ¡ˆ\u003c/li\u003e\n\u003cli\u003eè¿”å›æŸ¥è¯¢ç»“æœ ï¼ˆè‹¥é—®é¢˜ç±»å‹ä¸º æ¼”å‘˜ä¿¡æ¯ / ç”µå½±ä»‹ç»ï¼Œåˆ™é™„åŠ å›¾ç‰‡urlï¼‰\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"workflow-graph\"\u003eWorkFlow Graph\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"workflow graph\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/0IEuW.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"frame\"\u003eFrame\u003c/h2\u003e\n\u003ch3 id=\"database-1\"\u003eDataBase\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://neo4j.com/\"\u003e\u003cimg alt=\"Neo4j\" loading=\"lazy\" src=\"https://img.shields.io/badge/neo4j-test?style=for-the-badge\u0026logo=neo4j\u0026logoColor=white\u0026color=blue\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"frontend-1\"\u003eFrontend\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://developers.weixin.qq.com/\"\u003e\u003cimg alt=\"wechat mini programs\" loading=\"lazy\" src=\"https://img.shields.io/badge/wechat%20mini%20programs-test?style=for-the-badge\u0026logo=wechat\u0026logoColor=white\u0026color=%2320B2AA\"\u003e\u003c/a\u003e\u003c/p\u003e","title":"MovieKGQA: åŸºäºçŸ¥è¯†å›¾è°±å’Œneo4jå›¾æ•°æ®åº“çš„ç”µå½±çŸ¥è¯†é—®ç­”ç³»ç»Ÿ"},{"content":"Abstract åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† U-Net v2ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„æ–°çš„ç¨³å¥ä¸”é«˜æ•ˆçš„ U-Net å˜ä½“ã€‚å®ƒçš„ç›®çš„æ˜¯å¢å¼ºè¯­ä¹‰ä¿¡æ¯åœ¨ä½çº§ç‰¹å¾ä¸­çš„æ³¨å…¥ï¼ŒåŒæ—¶ç”¨æ›´ç²¾ç»†çš„ç»†èŠ‚æ¥ç»†åŒ–é«˜çº§ç‰¹å¾ã€‚å¯¹äºè¾“å…¥å›¾åƒï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œç¼–ç å™¨æå–å¤šçº§ç‰¹å¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æ³¨å…¥æ¥è‡ªæ›´é«˜çº§åˆ«ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯å¹¶é€šè¿‡ Hadamard ä¹˜ç§¯é›†æˆæ¥è‡ªè¾ƒä½çº§åˆ«ç‰¹å¾çš„æ›´ç²¾ç»†çš„ç»†èŠ‚æ¥å¢å¼ºæ¯ä¸ªçº§åˆ«çš„ç‰¹å¾å›¾ã€‚æˆ‘ä»¬æ–°é¢–çš„è·³è·ƒè¿æ¥èµ‹äºˆæ‰€æœ‰çº§åˆ«çš„åŠŸèƒ½ä»¥ä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾å’Œå¤æ‚çš„ç»†èŠ‚ã€‚æ”¹è¿›åçš„ç‰¹å¾éšåè¢«ä¼ è¾“åˆ°è§£ç å™¨ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†å’Œåˆ†å‰²ã€‚æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ— ç¼é›†æˆåˆ°ä»»ä½•ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œä¸­ã€‚æˆ‘ä»¬åœ¨å‡ ä¸ªå…¬å…±åŒ»å­¦å›¾åƒåˆ†å‰²æ•°æ®é›†ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„æ–¹æ³•ï¼Œç”¨äºçš®è‚¤ç—…å˜åˆ†å‰²å’Œæ¯è‚‰åˆ†å‰²ï¼Œå®éªŒç»“æœè¯æ˜äº†æˆ‘ä»¬çš„æ–°æ–¹æ³•ç›¸å¯¹äºæœ€å…ˆè¿›çš„æ–¹æ³•çš„åˆ†å‰²å‡†ç¡®æ€§ï¼ŒåŒæ—¶ä¿ç•™äº†å†…å­˜å’Œè®¡ç®—æ•ˆç‡ã€‚ä»£ç ä½äºï¼šhttps://github.com/yaoppeng/U-Net_v2ã€‚\nä¸»è¦å·¥ä½œå°±åœ¨äºä¸­é—´çš„skip-connection\nIntroduction éšç€ç°ä»£æ·±åº¦ç¥ç»ç½‘ç»œçš„è¿›æ­¥ï¼Œè¯­ä¹‰å›¾åƒåˆ†å‰²å–å¾—äº†é‡å¤§è¿›å±•ã€‚è¯­ä¹‰å›¾åƒåˆ†å‰²çš„å…¸å‹èŒƒä¾‹æ¶‰åŠå…·æœ‰è·³è·ƒè¿æ¥çš„ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œ[1]ã€‚åœ¨æ­¤æ¡†æ¶ä¸­ï¼Œç¼–ç å™¨ä»è¾“å…¥å›¾åƒä¸­æå–å±‚æ¬¡å’ŒæŠ½è±¡ç‰¹å¾ï¼Œè€Œè§£ç å™¨è·å–ç¼–ç å™¨ç”Ÿæˆçš„ç‰¹å¾å›¾å¹¶é‡å»ºåƒç´ çº§åˆ†å‰²æ©æ¨¡æˆ–å›¾ï¼Œä¸ºè¾“å…¥å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ åˆ†é…ç±»æ ‡ç­¾ã€‚äººä»¬è¿›è¡Œäº†ä¸€ç³»åˆ—ç ”ç©¶[2, 3]ï¼Œå°†å…¨å±€ä¿¡æ¯çº³å…¥ç‰¹å¾å›¾ä¸­å¹¶å¢å¼ºå¤šå°ºåº¦ç‰¹å¾ï¼Œä»è€Œå¤§å¤§æé«˜äº†åˆ†å‰²æ€§èƒ½ã€‚ åœ¨åŒ»å­¦å›¾åƒåˆ†æé¢†åŸŸï¼Œç²¾ç¡®çš„å›¾åƒåˆ†å‰²åœ¨è®¡ç®—æœºè¾…åŠ©è¯Šæ–­å’Œåˆ†æä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ U-Net [4] æœ€åˆæ˜¯ä¸ºäº†åŒ»å­¦å›¾åƒåˆ†å‰²è€Œå¼•å…¥çš„ï¼Œåˆ©ç”¨è·³è·ƒè¿æ¥æ¥è¿æ¥æ¯ä¸ªçº§åˆ«çš„ç¼–ç å™¨å’Œè§£ç å™¨é˜¶æ®µã€‚è·³è·ƒè¿æ¥ä½¿è§£ç å™¨èƒ½å¤Ÿè®¿é—®æ—©æœŸç¼–ç å™¨é˜¶æ®µçš„ç‰¹å¾ï¼Œä»è€Œä¿ç•™é«˜çº§è¯­ä¹‰ä¿¡æ¯å’Œç»†ç²’åº¦ç©ºé—´ç»†èŠ‚ã€‚è¿™ç§æ–¹æ³•æœ‰åŠ©äºç²¾ç¡®æç»˜å¯¹è±¡è¾¹ç•Œå¹¶æå–åŒ»å­¦å›¾åƒä¸­çš„å°ç»“æ„ã€‚æ­¤å¤–ï¼Œè¿˜åº”ç”¨äº†å¯†é›†è¿æ¥æœºåˆ¶ï¼Œé€šè¿‡è¿æ¥æ‰€æœ‰çº§åˆ«å’Œæ‰€æœ‰é˜¶æ®µçš„ç‰¹å¾æ¥å‡å°‘ç¼–ç å™¨å’Œè§£ç å™¨ä¸­ç‰¹å¾ä¹‹é—´çš„å·®å¼‚[5]ã€‚è®¾è®¡äº†ä¸€ç§æœºåˆ¶æ¥é€šè¿‡è¿æ¥è¾ƒé«˜å’Œè¾ƒä½çº§åˆ«çš„ä¸åŒå°ºåº¦çš„ç‰¹å¾æ¥å¢å¼ºç‰¹å¾[6]ã€‚ ç„¶è€Œï¼ŒåŸºäº U-Net çš„æ¨¡å‹ä¸­çš„è¿™äº›è¿æ¥åœ¨é›†æˆä½çº§å’Œé«˜çº§ç‰¹å¾æ–¹é¢å¯èƒ½ä¸å¤Ÿæœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œåœ¨ ResNet [7] ä¸­ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œæ˜¯ä½œä¸ºå¤šä¸ªæµ…å±‚ç½‘ç»œçš„é›†åˆè€Œå½¢æˆçš„ï¼Œå¹¶ä¸”æ˜¾å¼æ·»åŠ çš„æ®‹å·®è¿æ¥è¡¨æ˜ï¼Œå³ä½¿åœ¨ç™¾ä¸‡è§„æ¨¡çš„è®­ç»ƒä¸­ï¼Œç½‘ç»œä¹Ÿå¾ˆéš¾å­¦ä¹ æ’ç­‰æ˜ å°„å‡½æ•°å›¾åƒæ•°æ®é›†ã€‚\nå¯¹äºç¼–ç å™¨æå–çš„ç‰¹å¾ï¼Œä½çº§ç‰¹å¾é€šå¸¸ä¿ç•™æ›´å¤šç»†èŠ‚ï¼Œä½†ç¼ºä¹è¶³å¤Ÿçš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«ä¸éœ€è¦çš„å™ªå£°ã€‚ç›¸åï¼Œé«˜çº§ç‰¹å¾åŒ…å«æ›´å¤šè¯­ä¹‰ä¿¡æ¯ï¼Œä½†ç”±äºåˆ†è¾¨ç‡æ˜¾ç€é™ä½è€Œç¼ºä¹ç²¾ç¡®çš„ç»†èŠ‚ï¼ˆä¾‹å¦‚å¯¹è±¡è¾¹ç•Œï¼‰ã€‚é€šè¿‡ä¸²è”ç®€å•åœ°èåˆç‰¹å¾å°†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºç½‘ç»œçš„å­¦ä¹ èƒ½åŠ›ï¼Œè¿™é€šå¸¸ä¸è®­ç»ƒæ•°æ®é›†çš„å¤§å°æˆæ­£æ¯”ã€‚è¿™æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ»å­¦æˆåƒé¢†åŸŸï¼Œé€šå¸¸å—åˆ°æœ‰é™æ•°æ®çš„é™åˆ¶ã€‚è¿™ç§ä¿¡æ¯èåˆæ˜¯é€šè¿‡å¯†é›†è¿æ¥è·¨å¤šä¸ªçº§åˆ«è¿æ¥ä½çº§å’Œé«˜çº§ç‰¹å¾æ¥å®ç°çš„ï¼Œå¯èƒ½ä¼šé™åˆ¶æ¥è‡ªä¸åŒçº§åˆ«çš„ä¿¡æ¯çš„è´¡çŒ®å¹¶å¯èƒ½å¼•å…¥å™ªå£°ã€‚å¦ä¸€æ–¹é¢ï¼Œå°½ç®¡å¼•å…¥çš„é¢å¤–å·ç§¯å¹¶æ²¡æœ‰æ˜¾ç€å¢åŠ å‚æ•°æ•°é‡ï¼Œä½† GPU å†…å­˜æ¶ˆè€—å°†ä¼šå¢åŠ ï¼Œå› ä¸ºå¿…é¡»å­˜å‚¨æ‰€æœ‰ä¸­é—´ç‰¹å¾å›¾å’Œç›¸åº”çš„æ¢¯åº¦ä»¥è¿›è¡Œå‰å‘ä¼ é€’å’Œåå‘æ¢¯åº¦è®¡ç®—ã€‚è¿™ä¼šå¯¼è‡´ GPU å†…å­˜ä½¿ç”¨é‡å’Œæµ®ç‚¹è¿ç®— (FLOP) å¢åŠ ã€‚\n(a) U-Net v2 æ¨¡å‹çš„æ•´ä½“æ¶æ„ï¼Œç”±ç¼–ç å™¨ã€SDIï¼ˆè¯­ä¹‰å’Œç»†èŠ‚æ³¨å…¥ï¼‰æ¨¡å—å’Œè§£ç å™¨ç»„æˆã€‚ (b) SDIæ¨¡å—çš„æ¶æ„ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»…æ˜¾ç¤ºç¬¬ä¸‰çº§ç‰¹å¾çš„ç»†åŒ–ï¼ˆl = 3ï¼‰ã€‚ SmoothConv è¡¨ç¤ºç”¨äºç‰¹å¾å¹³æ»‘çš„ 3 Ã— 3 å·ç§¯ã€‚$\\bigotimes$ è¡¨ç¤ºå“ˆè¾¾ç›ç§¯ã€‚\nåœ¨[8]ä¸­ï¼Œåˆ©ç”¨åå‘æ³¨æ„åŠ›æ¥æ˜ç¡®åœ°å»ºç«‹å¤šå°ºåº¦ç‰¹å¾ä¹‹é—´çš„è”ç³»ã€‚åœ¨[9]ä¸­ï¼ŒReLUæ¿€æ´»åº”ç”¨äºè¾ƒé«˜çº§åˆ«çš„ç‰¹å¾ï¼Œå¹¶å°†æ¿€æ´»çš„ç‰¹å¾ä¸è¾ƒä½çº§åˆ«çš„ç‰¹å¾ç›¸ä¹˜ã€‚æ­¤å¤–ï¼Œåœ¨[10]ä¸­ï¼Œä½œè€…æå‡ºåˆ†åˆ«ä» CNN å’Œ Transformer æ¨¡å‹ä¸­æå–ç‰¹å¾ï¼Œåœ¨å¤šä¸ªçº§åˆ«ä¸Šç»„åˆæ¥è‡ª CNN å’Œ Transformer åˆ†æ”¯çš„ç‰¹å¾æ¥å¢å¼ºç‰¹å¾å›¾ã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•éƒ½å¾ˆå¤æ‚ï¼Œè€Œä¸”å®ƒä»¬çš„æ€§èƒ½ä»ç„¶ä¸æ˜¯å¾ˆä»¤äººæ»¡æ„ï¼Œå› æ­¤éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº† U-Net v2ï¼Œè¿™æ˜¯ä¸€ç§åŸºäº U-Net çš„æ–°åˆ†å‰²æ¡†æ¶ï¼Œå…·æœ‰ç®€å•ä¸”é«˜æ•ˆçš„è·³è·ƒè¿æ¥ã€‚æˆ‘ä»¬çš„æ¨¡å‹é¦–å…ˆä½¿ç”¨ CNN æˆ– Transformer ç¼–ç å™¨æå–å¤šçº§ç‰¹å¾å›¾ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹äºç¬¬ i å±‚çš„ç‰¹å¾å›¾ï¼Œæˆ‘ä»¬é€šè¿‡ç®€å•çš„å“ˆè¾¾ç›ä¹˜ç§¯æ“ä½œæ˜¾å¼åœ°æ³¨å…¥é«˜å±‚ç‰¹å¾ï¼ˆåŒ…å«æ›´å¤šè¯­ä¹‰ä¿¡æ¯ï¼‰å’Œä½å±‚ç‰¹å¾ï¼ˆæ•è·æ›´ç²¾ç»†çš„ç»†èŠ‚ï¼‰ï¼Œä»è€Œå¢å¼ºè¯­ä¹‰å’Œç»†èŠ‚ç¬¬ i çº§ç‰¹å¾ã€‚éšåï¼Œç»†åŒ–çš„ç‰¹å¾è¢«ä¼ è¾“åˆ°è§£ç å™¨è¿›è¡Œåˆ†è¾¨ç‡é‡å»ºå’Œåˆ†å‰²ã€‚æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ— ç¼é›†æˆåˆ°ä»»ä½•ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œä¸­ã€‚\næˆ‘ä»¬ä½¿ç”¨å…¬å¼€çš„æ•°æ®é›†åœ¨ä¸¤ä¸ªåŒ»å­¦å›¾åƒåˆ†å‰²ä»»åŠ¡ï¼ˆçš®è‚¤ç—…å˜åˆ†å‰²å’Œæ¯è‚‰åˆ†å‰²ï¼‰ä¸Šè¯„ä¼°æˆ‘ä»¬çš„æ–°æ–¹æ³•ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„ U-Net v2 åœ¨è¿™äº›åˆ†å‰²ä»»åŠ¡ä¸­å§‹ç»ˆä¼˜äºæœ€å…ˆè¿›çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¿æŒ FLOP å’Œ GPU å†…å­˜æ•ˆç‡ã€‚\nMethod 2.1 Overall Architecture æˆ‘ä»¬çš„ U-Net v2 çš„æ•´ä½“æ¶æ„å¦‚å›¾ 1ï¼ˆaï¼‰æ‰€ç¤ºã€‚å®ƒåŒ…æ‹¬ä¸‰ä¸ªä¸»è¦æ¨¡å—ï¼šç¼–ç å™¨ã€SDIï¼ˆè¯­ä¹‰å’Œç»†èŠ‚æ³¨å…¥ï¼‰æ¨¡å—å’Œè§£ç å™¨ã€‚ç»™å®šè¾“å…¥å›¾åƒ Iï¼Œå…¶ä¸­ I âˆˆ $R^{HÃ—WÃ—C}$ ï¼Œç¼–ç å™¨äº§ç”Ÿ M ä¸ªçº§åˆ«çš„ç‰¹å¾ã€‚æˆ‘ä»¬å°†ç¬¬ i çº§ç‰¹å¾è¡¨ç¤ºä¸º$ f^0_i$ , 1 â‰¤ i â‰¤ Mã€‚è¿™äº›æ”¶é›†åˆ°çš„ç‰¹å¾ï¼Œ{$ f^0_1$ ,$ f^0_2$,â€¦ , $ f^0_M$}ï¼Œç„¶åä¼ è¾“åˆ° SDI æ¨¡å—è¿›è¡Œè¿›ä¸€æ­¥ç»†åŒ–ã€‚\n2.2 Semantics and Detail Infusion (SDI) Module åˆ©ç”¨ç¼–ç å™¨ç”Ÿæˆçš„åˆ†å±‚ç‰¹å¾å›¾ï¼Œæˆ‘ä»¬é¦–å…ˆå°†ç©ºé—´å’Œé€šé“æ³¨æ„æœºåˆ¶[11]åº”ç”¨äºæ¯ä¸ªçº§åˆ« i çš„ç‰¹å¾ $ f^0_i$ã€‚æ­¤è¿‡ç¨‹ä½¿ç‰¹å¾èƒ½å¤Ÿé›†æˆå±€éƒ¨ç©ºé—´ä¿¡æ¯å’Œå…¨å±€é€šé“ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nå…¶ä¸­$f^1_i$è¡¨ç¤ºç¬¬ i å±‚å¤„ç†åçš„ç‰¹å¾å›¾ï¼Œ$Ï†^s_i$ å’Œ $\\phi^c_i$ åˆ†åˆ«è¡¨ç¤ºç¬¬ i å±‚ç©ºé—´æ³¨æ„åŠ›å’Œé€šé“æ³¨æ„åŠ›çš„å‚æ•°ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åº”ç”¨ 1 Ã— 1 å·ç§¯å°†$f^1_i$çš„é€šé“å‡å°‘åˆ° cï¼Œå…¶ä¸­ c æ˜¯è¶…å‚æ•°ã€‚å¾—åˆ°çš„ç‰¹å¾å›¾è¡¨ç¤ºä¸º$f^2_i$ï¼Œå…¶ä¸­ $f^2_i$ âˆˆ $R^{H_i Ã— W_i Ã— c}$ ï¼Œå…¶ä¸­$H_i$ã€$W_i$ å’Œ c åˆ†åˆ«è¡¨ç¤º $f^2_i$ çš„å®½åº¦ã€é«˜åº¦å’Œé€šé“ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†ç²¾ç‚¼åçš„ç‰¹å¾å›¾å‘é€åˆ°è§£ç å™¨ã€‚åœ¨æ¯ä¸ªè§£ç å™¨çº§åˆ« iï¼Œæˆ‘ä»¬ä½¿ç”¨ $f^2_i$ ä½œä¸ºç›®æ ‡å‚è€ƒã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒæ•´æ¯ä¸ªç¬¬ j å±‚çš„ç‰¹å¾å›¾çš„å¤§å°ï¼Œä»¥åŒ¹é…ä¸ $f^2_i$ ç›¸åŒçš„åˆ†è¾¨ç‡ï¼Œå…¬å¼ä¸ºï¼š\nå…¶ä¸­ D ã€ I å’Œ U åˆ†åˆ«è¡¨ç¤ºè‡ªé€‚åº”å¹³å‡æ± åŒ–ã€æ’ç­‰æ˜ å°„å’ŒåŒçº¿æ€§æ’å€¼ $f^2_i$ åˆ° $H_i$ã€$W_i$ çš„åˆ†è¾¨ç‡ï¼Œå…¶ä¸­ 1 â‰¤ iï¼Œj â‰¤ Mã€‚\nç„¶åï¼Œåº”ç”¨ 3 Ã— 3 å·ç§¯æ¥å¹³æ»‘æ¯ä¸ªè°ƒæ•´å¤§å°çš„ç‰¹å¾å›¾ $f^3_{ij}$ ï¼Œå…¬å¼ä¸ºï¼š\nå…¶ä¸­$Î¸_{ij}$è¡¨ç¤ºå¹³æ»‘å·ç§¯çš„å‚æ•°ï¼Œ $f^4_{ij}$ æ˜¯ç¬¬iå±‚çš„ç¬¬jä¸ªå¹³æ»‘ç‰¹å¾å›¾ã€‚\nå°†æ‰€æœ‰ç¬¬ i çº§ç‰¹å¾å›¾è°ƒæ•´ä¸ºç›¸åŒçš„åˆ†è¾¨ç‡åï¼Œæˆ‘ä»¬å°†å…ƒç´ çº§å“ˆè¾¾ç›ç§¯åº”ç”¨äºæ‰€æœ‰è°ƒæ•´å¤§å°çš„ç‰¹å¾å›¾ï¼Œä»¥é€šè¿‡æ›´å¤šè¯­ä¹‰ä¿¡æ¯å’Œæ›´ç²¾ç»†çš„ç»†èŠ‚æ¥å¢å¼ºç¬¬ i çº§ç‰¹å¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nå…¶ä¸­$H(Â·)$è¡¨ç¤ºå“ˆè¾¾ç›ç§¯ (è§å›¾1(b))ã€‚ç„¶åï¼Œ$f^5_i$ è¢«åˆ†æ´¾åˆ°ç¬¬içº§è§£ç å™¨ä»¥è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†è¾¨ç‡é‡å»ºå’Œåˆ†å‰²ã€‚\nExperiments 3.1 Datasets æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ•°æ®é›†è¯„ä¼°æ–°çš„ U-Net v2ã€‚ ISIC æ•°æ®é›†ï¼šä½¿ç”¨ä¸¤ä¸ªçš®è‚¤ç—…å˜åˆ†å‰²æ•°æ®é›†ï¼šISIC 2017 [15, 16]ï¼Œå…¶ä¸­åŒ…å« 2050 ä¸ªçš®è‚¤é•œå›¾åƒï¼ŒISIC 2018 [15]ï¼Œå…¶ä¸­åŒ…å« 2694 ä¸ªçš®è‚¤é•œå›¾åƒã€‚ä¸ºäº†å…¬å¹³æ¯”è¾ƒï¼Œæˆ‘ä»¬éµå¾ª[13]ä¸­æ¦‚è¿°çš„è®­ç»ƒ/æµ‹è¯•åˆ†å‰²ç­–ç•¥ã€‚ æ¯è‚‰åˆ†å‰²æ•°æ®é›†ï¼šä½¿ç”¨äº”ä¸ªæ•°æ®é›†ï¼šKvasir-SEG [17]ã€ClinicDB [18]ã€ColonDB [19]ã€Endoscene [20] å’Œ ETIS [21]ã€‚ä¸ºäº†å…¬å¹³æ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨[8]ä¸­çš„è®­ç»ƒ/æµ‹è¯•åˆ†å‰²ç­–ç•¥ã€‚å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨æ¥è‡ª ClinicDB çš„ 900 å¼ å›¾åƒå’Œæ¥è‡ª Kvasir-SEG çš„ 548 å¼ å›¾åƒä½œä¸ºè®­ç»ƒé›†ï¼Œå…¶ä½™å›¾åƒä½œä¸ºæµ‹è¯•é›†ã€‚\n3.2 Experimental Setup æˆ‘ä»¬ä½¿ç”¨ PyTorch åœ¨ NVIDIA P100 GPU ä¸Šè¿›è¡Œå®éªŒã€‚æˆ‘ä»¬çš„ç½‘ç»œä½¿ç”¨ Adam ä¼˜åŒ–å™¨è¿›è¡Œä¼˜åŒ–ï¼Œåˆå§‹å­¦ä¹ ç‡ = 0.001ï¼ŒÎ²1 = 0.9ï¼ŒÎ²2 = 0.999ã€‚\næˆ‘ä»¬é‡‡ç”¨å¹‚ä¸º 0.9 çš„å¤šé¡¹å¼å­¦ä¹ ç‡è¡°å‡ã€‚è®­ç»ƒæ—¶æœŸçš„æœ€å¤§æ•°é‡è®¾ç½®ä¸º 300ã€‚è¶…å‚æ•° c è®¾ç½®ä¸º 32ã€‚æŒ‰ç…§[13]ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æŠ¥å‘Š ISIC æ•°æ®é›†çš„ DSCï¼ˆéª°å­ç›¸ä¼¼ç³»æ•°ï¼‰å’Œ IoUï¼ˆå¹¶é›†äº¤é›†ï¼‰åˆ†æ•°ã€‚å¯¹äºæ¯è‚‰æ•°æ®é›†ï¼Œæˆ‘ä»¬æŠ¥å‘Š DSCã€IoU å’Œ MAEï¼ˆå¹³å‡ç»å¯¹è¯¯å·®ï¼‰åˆ†æ•°ã€‚æ¯ä¸ªå®éªŒè¿è¡Œ 5 æ¬¡ï¼Œå¹¶æŠ¥å‘Šå¹³å‡ç»“æœã€‚æˆ‘ä»¬ä½¿ç”¨é‡‘å­—å¡”è§†è§‰å˜æ¢å™¨ï¼ˆPVTï¼‰[22]ä½œä¸ºç‰¹å¾æå–çš„ç¼–ç å™¨ã€‚\n3.3 Results and Analysis è¡¨ 1 åˆ—å‡ºäº† ISIC æ•°æ®é›†ä¸Šæœ€å…ˆè¿›æ–¹æ³•çš„æ¯”è¾ƒç»“æœã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æå‡ºçš„ UNet v2 å°† DSC åˆ†æ•°æé«˜äº† 1.44% å’Œ 2.48%ï¼ŒIoU åˆ†æ•°æé«˜äº† 2.36% å’Œ 3.90%ã€‚åˆ†åˆ«æ˜¯ ISIC 2017 å’Œ ISIC 2018 æ•°æ®é›†ã€‚è¿™äº›æ”¹è¿›è¯æ˜äº†æˆ‘ä»¬æå‡ºçš„å°†è¯­ä¹‰ä¿¡æ¯å’Œæ›´ç²¾ç»†çš„ç»†èŠ‚æ³¨å…¥æ¯ä¸ªç‰¹å¾å›¾çš„æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚\nè¡¨ 2 åˆ—å‡ºäº†æ¯è‚‰åˆ†å‰²æ•°æ®é›†ä¸Šæœ€å…ˆè¿›æ–¹æ³•çš„æ¯”è¾ƒç»“æœã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æå‡ºçš„ U-Net v2 åœ¨ Kavasir-SEGã€ClinicDBã€ColonDB å’Œ ETIS ä¸Šä¼˜äº Poly-PVT [14]æ•°æ®é›†ï¼ŒDSC å¾—åˆ†åˆ†åˆ«æé«˜äº† 1.1%ã€0.7%ã€0.4% å’Œ 0.3%ã€‚è¿™å¼ºè°ƒäº†æˆ‘ä»¬æå‡ºçš„æ–¹æ³•åœ¨å°†è¯­ä¹‰ä¿¡æ¯å’Œæ›´ç²¾ç»†çš„ç»†èŠ‚æ³¨å…¥æ¯ä¸ªçº§åˆ«çš„ç‰¹å¾å›¾ä¸­çš„ä¸€è‡´æœ‰æ•ˆæ€§ã€‚\n3.4 Ablation Study æˆ‘ä»¬ä½¿ç”¨ ISIC 2017 å’Œ ColonDB æ•°æ®é›†è¿›è¡Œæ¶ˆèç ”ç©¶ï¼Œä»¥æ£€æŸ¥ U-Net v2 çš„æœ‰æ•ˆæ€§ï¼Œå¦‚è¡¨ 3 æ‰€ç¤ºã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ PVT [22] æ¨¡å‹ä½œä¸º UNet++ [5] çš„ç¼–ç å™¨ã€‚è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬çš„ SDI æ¨¡å—è¢«ç§»é™¤æ—¶ï¼ŒU-Net v2 å°†æ¢å¤ä¸ºå…·æœ‰ PVT ä¸»å¹²çš„æ™®é€š U-Netã€‚ **SC è¡¨ç¤º SDI æ¨¡å—å†…çš„ç©ºé—´å’Œé€šé“å…³æ³¨ç‚¹ã€‚**ä»è¡¨ 3 å¯ä»¥çœ‹å‡ºï¼Œä¸ä¸å¸¦ SDI çš„ U-Net v2ï¼ˆå³å¸¦ PVT ç¼–ç å™¨çš„ U-Netï¼‰ç›¸æ¯”ï¼ŒUNet++ çš„æ€§èƒ½ç•¥æœ‰ä¸‹é™ã€‚\nè¿™ç§ä¸‹é™å¯èƒ½å½’å› äºå¯†é›†è¿æ¥ç”Ÿæˆçš„å¤šçº§ç‰¹å¾çš„ç®€å•ä¸²è”ï¼Œè¿™å¯èƒ½ä¼šæ··æ·†æ¨¡å‹å¹¶å¼•å…¥å™ªå£°ã€‚è¡¨ 3 è¡¨æ˜ SDI æ¨¡å—å¯¹æ•´ä½“æ€§èƒ½è´¡çŒ®æœ€å¤§ï¼Œçªå‡ºæ˜¾ç¤ºæˆ‘ä»¬æå‡ºçš„è·³è·ƒè¿æ¥ï¼ˆå³ SDIï¼‰æŒç»­å¸¦æ¥æ€§èƒ½æ”¹è¿›ã€‚\n3.5 Qualitative Results å›¾ 2 ç»™å‡ºäº† ISIC 2017 æ•°æ®é›†çš„ä¸€äº›å®šæ€§ç¤ºä¾‹ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬çš„ U-Net v2 èƒ½å¤Ÿå°†è¯­ä¹‰ä¿¡æ¯å’Œæ›´ç²¾ç»†çš„ç»†èŠ‚åˆå¹¶åˆ°æ¯ä¸ªçº§åˆ«çš„ç‰¹å¾å›¾ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„åˆ†å‰²æ¨¡å‹å¯ä»¥æ•è·å¯¹è±¡è¾¹ç•Œçš„æ›´ç²¾ç»†çš„ç»†èŠ‚ã€‚\n3.6 Computation, GPU Memory, and Inference Time ä¸ºäº†æ£€æŸ¥ U-Net v2 çš„è®¡ç®—å¤æ‚æ€§ã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µå’Œæ¨ç†æ—¶é—´ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº†æˆ‘ä»¬çš„æ–¹æ³• U-Net [4] çš„å‚æ•°ã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€FLOP å’Œ FPSï¼ˆæ¯ç§’å¸§æ•°ï¼‰ï¼Œä»¥åŠè¡¨ 4 ä¸­çš„ UNet++ [5]ã€‚å®éªŒä½¿ç”¨ float32 ä½œä¸ºæ•°æ®ç±»å‹ï¼Œè¿™å¯¼è‡´æ¯ä¸ªå˜é‡ä½¿ç”¨ 4B çš„å†…å­˜ã€‚ GPUå†…å­˜ä½¿ç”¨è®°å½•äº†å‰å‘/åå‘ä¼ é€’è¿‡ç¨‹ä¸­å­˜å‚¨çš„å‚æ•°å’Œä¸­é—´å˜é‡çš„å¤§å°ã€‚\n(1, 3, 256, 256) è¡¨ç¤ºè¾“å…¥å›¾åƒçš„å¤§å°ã€‚æ‰€æœ‰æµ‹è¯•å‡åœ¨ NVIDIA P100 GPU ä¸Šè¿›è¡Œã€‚\nä»è¡¨4ä¸­å¯ä»¥çœ‹å‡ºï¼ŒUNet++å¼•å…¥äº†æ›´å¤šçš„å‚æ•°ï¼Œå¹¶ä¸”ç”±äºåœ¨å¯†é›†å‰å‘è¿‡ç¨‹ä¸­å­˜å‚¨ä¸­é—´å˜é‡ï¼ˆä¾‹å¦‚ç‰¹å¾å›¾ï¼‰ï¼Œå…¶GPUå†…å­˜ä½¿ç”¨é‡æ›´å¤§ã€‚é€šå¸¸ï¼Œæ­¤ç±»ä¸­é—´å˜é‡æ¯”å‚æ•°æ¶ˆè€—æ›´å¤šçš„ GPU å†…å­˜ã€‚\næ­¤å¤–ï¼ŒU-Net v2 çš„ FLOPs å’Œ FPS ä¹Ÿä¼˜äº UNet++ã€‚ä¸ U-Net (PVT) ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„ U-Net v2 çš„ FPS é™ä½æ˜¯æœ‰é™çš„ã€‚\nConclusion å¼•å…¥äº†æ–°çš„ U-Net å˜ä½“ U-Net v2ï¼Œå®ƒé‡‡ç”¨æ–°é¢–ä¸”ç®€å•çš„è·³è·ƒè¿æ¥è®¾è®¡ï¼Œä»¥æ”¹è¿›åŒ»å­¦å›¾åƒåˆ†å‰²ã€‚è¯¥è®¾è®¡æ˜ç¡®åœ°å°†æ¥è‡ªè¾ƒé«˜çº§åˆ«ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯å’Œæ¥è‡ªè¾ƒä½çº§åˆ«ç‰¹å¾çš„æ›´ç²¾ç»†ç»†èŠ‚é›†æˆåˆ°ç¼–ç å™¨ä½¿ç”¨ Hadamard ä¹˜ç§¯ç”Ÿæˆçš„æ¯ä¸ªçº§åˆ«çš„ç‰¹å¾æ˜ å°„ä¸­ã€‚åœ¨çš®è‚¤ç—…å˜å’Œæ¯è‚‰åˆ†å‰²æ•°æ®é›†ä¸Šè¿›è¡Œçš„å®éªŒéªŒè¯äº†æˆ‘ä»¬çš„ UNet v2 çš„æœ‰æ•ˆæ€§ã€‚å¤æ‚æ€§åˆ†æè¡¨æ˜ U-Net v2 åœ¨ FLOP å’Œ GPU å†…å­˜ä½¿ç”¨æ–¹é¢ä¹Ÿå¾ˆé«˜æ•ˆ\nè¿™ç¯‡æ–‡ç« æ¯”è¾ƒç®€å•ï¼Œæ•´ä½“çš„è¡Œæ–‡é£æ ¼ä¸€çœ‹å°±æ˜¯ä¼šè®®è®ºæ–‡ã€‚æ ¸å¿ƒåˆ›æ–°ç‚¹å°±ä¸€ä¸ªSDIï¼ˆSemantic and Detail Infusionï¼‰æ¨¡å—ã€‚SDIæ¨¡å—ä½œç”¨å°±æ˜¯ è¿æ¥é«˜çº§ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯å’Œä½çº§ç‰¹å¾çš„ç»†èŠ‚ä¿¡æ¯ã€‚é¦–å…ˆé€šè¿‡é€šé“å’Œç‰¹å¾æ³¨æ„åŠ›æœºåˆ¶ï¼Œåˆ†åˆ«å…³æ³¨ä¸åŒçº§åˆ«çš„é€šé“å’Œç©ºé—´ä¿¡æ¯ã€‚ç„¶åå°†æ‰€æœ‰çš„é€šé“éƒ½ padding / scaling åˆ°å’Œç¬¬içº§åˆ«ç›¸åŒçš„é€šé“æ•°ï¼Œç„¶åé€šè¿‡åŒçº¿æ€§æ’å€¼ / è‡ªé€‚åº”å¹³å‡æ± åŒ–åˆ°ç›¸åŒå¤§å°çš„å°ºå¯¸ã€‚æœ€åï¼Œä½¿ç”¨å“ˆè¾¾ç ä¹˜ç§¯è¿›è¡Œç‰¹å¾èåˆã€‚ å¯¹ï¼Œæ²¡é”™å°±è¿™ä¹ˆç®€å•ï¼ï¼ï¼\nï¼ˆæ€è€ƒ: èƒ½ä¸èƒ½ç”¨å‡æ³•å•å…ƒæ¥èåˆå·®å¼‚æ€§ï¼Ÿï¼Ÿï¼Ÿï¼‰\n","permalink":"https://swimmingliu.cn/posts/papernotes/2023-unet_v2/","summary":"\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† U-Net v2ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„æ–°çš„ç¨³å¥ä¸”é«˜æ•ˆçš„ U-Net å˜ä½“ã€‚å®ƒçš„ç›®çš„æ˜¯\u003cstrong\u003eå¢å¼ºè¯­ä¹‰ä¿¡æ¯åœ¨ä½çº§ç‰¹å¾ä¸­çš„æ³¨å…¥\u003c/strong\u003eï¼ŒåŒæ—¶\u003cstrong\u003eç”¨æ›´ç²¾ç»†çš„ç»†èŠ‚æ¥ç»†åŒ–é«˜çº§ç‰¹å¾\u003c/strong\u003eã€‚å¯¹äºè¾“å…¥å›¾åƒï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨\u003cstrong\u003eæ·±åº¦ç¥ç»ç½‘ç»œç¼–ç å™¨æå–å¤šçº§ç‰¹å¾\u003c/strong\u003eã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡\u003cstrong\u003eæ³¨å…¥æ¥è‡ªæ›´é«˜çº§åˆ«ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯\u003c/strong\u003eå¹¶é€šè¿‡ \u003cstrong\u003eHadamard ä¹˜ç§¯\u003c/strong\u003eé›†æˆæ¥è‡ª\u003cstrong\u003eè¾ƒä½çº§åˆ«ç‰¹å¾çš„æ›´ç²¾ç»†çš„ç»†èŠ‚\u003c/strong\u003eæ¥\u003cstrong\u003eå¢å¼ºæ¯ä¸ªçº§åˆ«çš„ç‰¹å¾å›¾\u003c/strong\u003eã€‚æˆ‘ä»¬æ–°é¢–çš„\u003cstrong\u003eè·³è·ƒè¿æ¥\u003c/strong\u003eèµ‹äºˆ\u003cstrong\u003eæ‰€æœ‰çº§åˆ«çš„åŠŸèƒ½\u003c/strong\u003eä»¥\u003cstrong\u003eä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾å’Œå¤æ‚çš„ç»†èŠ‚\u003c/strong\u003eã€‚\u003cstrong\u003eæ”¹è¿›åçš„ç‰¹å¾éšåè¢«ä¼ è¾“åˆ°è§£ç å™¨\u003c/strong\u003eä»¥è¿›è¡Œ\u003cstrong\u003eè¿›ä¸€æ­¥å¤„ç†å’Œåˆ†å‰²\u003c/strong\u003eã€‚æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥\u003cstrong\u003eæ— ç¼é›†æˆåˆ°ä»»ä½•ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œä¸­\u003c/strong\u003eã€‚æˆ‘ä»¬åœ¨å‡ ä¸ªå…¬å…±åŒ»å­¦å›¾åƒåˆ†å‰²æ•°æ®é›†ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„æ–¹æ³•ï¼Œç”¨äºçš®è‚¤ç—…å˜åˆ†å‰²å’Œæ¯è‚‰åˆ†å‰²ï¼Œå®éªŒç»“æœè¯æ˜äº†æˆ‘ä»¬çš„æ–°æ–¹æ³•ç›¸å¯¹äºæœ€å…ˆè¿›çš„æ–¹æ³•çš„åˆ†å‰²å‡†ç¡®æ€§ï¼ŒåŒæ—¶\u003cstrong\u003eä¿ç•™äº†å†…å­˜å’Œè®¡ç®—æ•ˆç‡\u003c/strong\u003eã€‚ä»£ç ä½äºï¼šhttps://github.com/yaoppeng/U-Net_v2ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸»è¦å·¥ä½œå°±åœ¨äºä¸­é—´çš„skip-connection\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eéšç€ç°ä»£æ·±åº¦ç¥ç»ç½‘ç»œçš„è¿›æ­¥ï¼Œè¯­ä¹‰å›¾åƒåˆ†å‰²å–å¾—äº†é‡å¤§è¿›å±•ã€‚è¯­ä¹‰å›¾åƒåˆ†å‰²çš„å…¸å‹èŒƒä¾‹æ¶‰åŠå…·æœ‰\u003cstrong\u003eè·³è·ƒè¿æ¥çš„ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œ[\u003cstrong\u003e1]ã€‚åœ¨æ­¤æ¡†æ¶ä¸­ï¼Œç¼–ç å™¨ä»\u003c/strong\u003eè¾“å…¥å›¾åƒä¸­æå–å±‚æ¬¡å’ŒæŠ½è±¡ç‰¹å¾\u003c/strong\u003eï¼Œè€Œè§£ç å™¨è·å–\u003cstrong\u003eç¼–ç å™¨ç”Ÿæˆçš„ç‰¹å¾å›¾å¹¶é‡å»ºåƒç´ çº§åˆ†å‰²æ©æ¨¡æˆ–å›¾\u003c/strong\u003eï¼Œ\u003cstrong\u003eä¸ºè¾“å…¥å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ åˆ†é…ç±»æ ‡ç­¾\u003c/strong\u003eã€‚äººä»¬è¿›è¡Œäº†ä¸€ç³»åˆ—ç ”ç©¶[2, 3]ï¼Œ\u003cstrong\u003eå°†å…¨å±€ä¿¡æ¯çº³å…¥ç‰¹å¾å›¾\u003c/strong\u003eä¸­å¹¶å¢å¼ºå¤šå°ºåº¦ç‰¹å¾ï¼Œä»è€Œå¤§å¤§æé«˜äº†åˆ†å‰²æ€§èƒ½ã€‚\nåœ¨åŒ»å­¦å›¾åƒåˆ†æé¢†åŸŸï¼Œ\u003cstrong\u003eç²¾ç¡®çš„å›¾åƒåˆ†å‰²\u003c/strong\u003eåœ¨è®¡ç®—æœºè¾…åŠ©è¯Šæ–­å’Œåˆ†æä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ U-Net [4] æœ€åˆæ˜¯ä¸ºäº†\u003cstrong\u003eåŒ»å­¦å›¾åƒåˆ†å‰²\u003c/strong\u003eè€Œå¼•å…¥çš„ï¼Œåˆ©ç”¨\u003cstrong\u003eè·³è·ƒè¿æ¥\u003c/strong\u003eæ¥è¿æ¥æ¯ä¸ªçº§åˆ«çš„\u003cstrong\u003eç¼–ç å™¨å’Œè§£ç å™¨é˜¶æ®µ\u003c/strong\u003eã€‚\u003cstrong\u003eè·³è·ƒè¿æ¥\u003c/strong\u003eä½¿è§£ç å™¨èƒ½å¤Ÿè®¿é—®\u003cstrong\u003eæ—©æœŸç¼–ç å™¨é˜¶æ®µ\u003c/strong\u003eçš„ç‰¹å¾ï¼Œä»è€Œä¿ç•™\u003cstrong\u003eé«˜çº§è¯­ä¹‰ä¿¡æ¯\u003c/strong\u003eå’Œ\u003cstrong\u003eç»†ç²’åº¦ç©ºé—´ç»†èŠ‚\u003c/strong\u003eã€‚è¿™ç§æ–¹æ³•æœ‰åŠ©äº\u003cstrong\u003eç²¾ç¡®æç»˜å¯¹è±¡è¾¹ç•Œ\u003c/strong\u003eå¹¶æå–\u003cstrong\u003eåŒ»å­¦å›¾åƒä¸­çš„å°ç»“æ„\u003c/strong\u003eã€‚æ­¤å¤–ï¼Œè¿˜åº”ç”¨äº†\u003cstrong\u003eå¯†é›†è¿æ¥æœºåˆ¶\u003c/strong\u003eï¼Œé€šè¿‡\u003cstrong\u003eè¿æ¥æ‰€æœ‰çº§åˆ«\u003c/strong\u003eå’Œ\u003cstrong\u003eæ‰€æœ‰é˜¶æ®µçš„ç‰¹å¾\u003c/strong\u003eæ¥å‡å°‘\u003cstrong\u003eç¼–ç å™¨å’Œè§£ç å™¨ä¸­ç‰¹å¾ä¹‹é—´çš„å·®å¼‚\u003c/strong\u003e[5]ã€‚è®¾è®¡äº†ä¸€ç§æœºåˆ¶æ¥\u003cstrong\u003eé€šè¿‡è¿æ¥è¾ƒé«˜å’Œè¾ƒä½çº§åˆ«\u003c/strong\u003eçš„\u003cstrong\u003eä¸åŒå°ºåº¦çš„ç‰¹å¾\u003c/strong\u003eæ¥\u003cstrong\u003eå¢å¼ºç‰¹å¾\u003c/strong\u003e[6]ã€‚\nç„¶è€Œï¼ŒåŸºäº U-Net çš„æ¨¡å‹ä¸­çš„è¿™äº›è¿æ¥åœ¨\u003cstrong\u003eé›†æˆä½çº§å’Œé«˜çº§ç‰¹å¾æ–¹é¢\u003c/strong\u003eå¯èƒ½\u003cstrong\u003eä¸å¤Ÿæœ‰æ•ˆ\u003c/strong\u003eã€‚ä¾‹å¦‚ï¼Œåœ¨ ResNet [7] ä¸­ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œæ˜¯ä½œä¸º\u003cstrong\u003eå¤šä¸ªæµ…å±‚ç½‘ç»œçš„é›†åˆ\u003c/strong\u003eè€Œå½¢æˆçš„ï¼Œå¹¶ä¸”\u003cstrong\u003eæ˜¾å¼æ·»åŠ çš„æ®‹å·®è¿æ¥\u003c/strong\u003eè¡¨æ˜ï¼Œå³ä½¿åœ¨ç™¾ä¸‡è§„æ¨¡çš„è®­ç»ƒä¸­ï¼Œç½‘ç»œä¹Ÿå¾ˆéš¾å­¦ä¹ \u003cstrong\u003eæ’ç­‰æ˜ å°„å‡½æ•°å›¾åƒ\u003c/strong\u003eæ•°æ®é›†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¯¹äºç¼–ç å™¨æå–çš„ç‰¹å¾ï¼Œä½çº§ç‰¹å¾é€šå¸¸ä¿ç•™æ›´å¤šç»†èŠ‚ï¼Œä½†ç¼ºä¹è¶³å¤Ÿçš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«ä¸éœ€è¦çš„å™ªå£°\u003c/strong\u003eã€‚ç›¸åï¼Œ\u003cstrong\u003eé«˜çº§ç‰¹å¾åŒ…å«æ›´å¤šè¯­ä¹‰ä¿¡æ¯ï¼Œä½†ç”±äºåˆ†è¾¨ç‡æ˜¾ç€é™ä½è€Œç¼ºä¹ç²¾ç¡®çš„ç»†èŠ‚ï¼ˆä¾‹å¦‚å¯¹è±¡è¾¹ç•Œï¼‰\u003c/strong\u003eã€‚é€šè¿‡\u003cstrong\u003eä¸²è”ç®€å•åœ°èåˆç‰¹å¾\u003c/strong\u003eå°†åœ¨\u003cstrong\u003eå¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºç½‘ç»œçš„å­¦ä¹ èƒ½åŠ›\u003c/strong\u003eï¼Œè¿™\u003cstrong\u003eé€šå¸¸ä¸è®­ç»ƒæ•°æ®é›†çš„å¤§å°æˆæ­£æ¯”\u003c/strong\u003eã€‚è¿™æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ»å­¦æˆåƒé¢†åŸŸï¼Œ\u003cstrong\u003eé€šå¸¸å—åˆ°æœ‰é™æ•°æ®çš„é™åˆ¶\u003c/strong\u003eã€‚è¿™ç§ä¿¡æ¯èåˆæ˜¯\u003cstrong\u003eé€šè¿‡å¯†é›†è¿æ¥è·¨å¤šä¸ªçº§åˆ«è¿æ¥ä½çº§å’Œé«˜çº§ç‰¹å¾\u003c/strong\u003eæ¥å®ç°çš„ï¼Œå¯èƒ½ä¼šé™åˆ¶æ¥è‡ª\u003cstrong\u003eä¸åŒçº§åˆ«çš„ä¿¡æ¯çš„è´¡çŒ®\u003c/strong\u003eå¹¶å¯èƒ½å¼•å…¥å™ªå£°ã€‚å¦ä¸€æ–¹é¢ï¼Œå°½ç®¡\u003cstrong\u003eå¼•å…¥çš„é¢å¤–å·ç§¯å¹¶æ²¡æœ‰æ˜¾ç€å¢åŠ å‚æ•°æ•°é‡\u003c/strong\u003eï¼Œä½† \u003cstrong\u003eGPU å†…å­˜æ¶ˆè€—å°†ä¼šå¢åŠ \u003c/strong\u003eï¼Œå› ä¸ºå¿…é¡»\u003cstrong\u003eå­˜å‚¨æ‰€æœ‰ä¸­é—´ç‰¹å¾å›¾å’Œç›¸åº”çš„æ¢¯åº¦\u003c/strong\u003eä»¥è¿›è¡Œå‰å‘ä¼ é€’å’Œåå‘æ¢¯åº¦è®¡ç®—ã€‚è¿™ä¼šå¯¼è‡´ \u003cstrong\u003eGPU å†…å­˜ä½¿ç”¨é‡\u003c/strong\u003eå’Œ\u003cstrong\u003eæµ®ç‚¹è¿ç®— (FLOP) å¢åŠ \u003c/strong\u003eã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231211193109745\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/mCdvu.png\"\u003e\u003c/p\u003e\n\u003cp\u003e(a) U-Net v2 æ¨¡å‹çš„æ•´ä½“æ¶æ„ï¼Œç”±\u003cstrong\u003eç¼–ç å™¨ã€SDIï¼ˆè¯­ä¹‰å’Œç»†èŠ‚æ³¨å…¥ï¼‰æ¨¡å—å’Œè§£ç å™¨\u003c/strong\u003eç»„æˆã€‚ (b) SDIæ¨¡å—çš„æ¶æ„ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»…æ˜¾ç¤ºç¬¬ä¸‰çº§ç‰¹å¾çš„ç»†åŒ–ï¼ˆl = 3ï¼‰ã€‚ \u003cstrong\u003eSmoothConv è¡¨ç¤ºç”¨äºç‰¹å¾å¹³æ»‘çš„ 3 Ã— 3 å·ç§¯\u003c/strong\u003eã€‚$\\bigotimes$ è¡¨ç¤ºå“ˆè¾¾ç›ç§¯ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨[8]ä¸­ï¼Œåˆ©ç”¨\u003cstrong\u003eåå‘æ³¨æ„åŠ›\u003c/strong\u003eæ¥æ˜ç¡®åœ°å»ºç«‹\u003cstrong\u003eå¤šå°ºåº¦ç‰¹å¾ä¹‹é—´\u003c/strong\u003eçš„è”ç³»ã€‚åœ¨[9]ä¸­ï¼ŒReLUæ¿€æ´»åº”ç”¨äº\u003cstrong\u003eè¾ƒé«˜çº§åˆ«\u003c/strong\u003eçš„ç‰¹å¾ï¼Œå¹¶\u003cstrong\u003eå°†æ¿€æ´»çš„ç‰¹å¾ä¸è¾ƒä½çº§åˆ«çš„ç‰¹å¾ç›¸ä¹˜\u003c/strong\u003eã€‚æ­¤å¤–ï¼Œåœ¨[10]ä¸­ï¼Œä½œè€…æå‡ºåˆ†åˆ«ä» \u003cstrong\u003eCNN å’Œ Transformer æ¨¡å‹\u003c/strong\u003eä¸­æå–ç‰¹å¾ï¼Œåœ¨å¤šä¸ªçº§åˆ«ä¸Šç»„åˆ\u003cstrong\u003eæ¥è‡ª CNN å’Œ Transformer åˆ†æ”¯\u003c/strong\u003eçš„ç‰¹å¾æ¥\u003cstrong\u003eå¢å¼ºç‰¹å¾å›¾\u003c/strong\u003eã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•\u003cstrong\u003eéƒ½å¾ˆå¤æ‚\u003c/strong\u003eï¼Œè€Œä¸”å®ƒä»¬çš„\u003cstrong\u003eæ€§èƒ½ä»ç„¶ä¸æ˜¯å¾ˆä»¤äººæ»¡æ„\u003c/strong\u003eï¼Œå› æ­¤éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº† U-Net v2ï¼Œè¿™æ˜¯ä¸€ç§åŸºäº U-Net çš„æ–°åˆ†å‰²æ¡†æ¶ï¼Œå…·æœ‰\u003cstrong\u003eç®€å•ä¸”é«˜æ•ˆçš„è·³è·ƒè¿æ¥\u003c/strong\u003eã€‚æˆ‘ä»¬çš„æ¨¡å‹é¦–å…ˆ\u003cstrong\u003eä½¿ç”¨ CNN æˆ– Transformer ç¼–ç å™¨\u003c/strong\u003eæå–\u003cstrong\u003eå¤šçº§ç‰¹å¾å›¾\u003c/strong\u003eã€‚æ¥ä¸‹æ¥ï¼Œ\u003cstrong\u003eå¯¹äºç¬¬ i å±‚çš„ç‰¹å¾å›¾\u003c/strong\u003eï¼Œæˆ‘ä»¬é€šè¿‡\u003cstrong\u003eç®€å•çš„å“ˆè¾¾ç›ä¹˜ç§¯æ“ä½œ\u003c/strong\u003eæ˜¾å¼åœ°æ³¨å…¥\u003cstrong\u003eé«˜å±‚ç‰¹å¾ï¼ˆåŒ…å«æ›´å¤šè¯­ä¹‰ä¿¡æ¯ï¼‰\u003cstrong\u003eå’Œ\u003c/strong\u003eä½å±‚ç‰¹å¾ï¼ˆæ•è·æ›´ç²¾ç»†çš„ç»†èŠ‚ï¼‰\u003c/strong\u003eï¼Œä»è€Œ\u003cstrong\u003eå¢å¼ºè¯­ä¹‰å’Œç»†èŠ‚ç¬¬ i çº§ç‰¹å¾\u003c/strong\u003eã€‚éšåï¼Œ\u003cstrong\u003eç»†åŒ–çš„ç‰¹å¾\u003c/strong\u003eè¢«ä¼ è¾“åˆ°è§£ç å™¨è¿›è¡Œ\u003cstrong\u003eåˆ†è¾¨ç‡é‡å»ºå’Œåˆ†å‰²\u003c/strong\u003eã€‚æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ— ç¼é›†æˆåˆ°ä»»ä½•ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œä¸­ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä½¿ç”¨å…¬å¼€çš„æ•°æ®é›†åœ¨ä¸¤ä¸ªåŒ»å­¦å›¾åƒåˆ†å‰²ä»»åŠ¡ï¼ˆçš®è‚¤ç—…å˜åˆ†å‰²å’Œæ¯è‚‰åˆ†å‰²ï¼‰ä¸Šè¯„ä¼°æˆ‘ä»¬çš„æ–°æ–¹æ³•ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„ U-Net v2 åœ¨è¿™äº›åˆ†å‰²ä»»åŠ¡ä¸­å§‹ç»ˆä¼˜äºæœ€å…ˆè¿›çš„æ–¹æ³•ï¼Œ\u003cstrong\u003eåŒæ—¶ä¿æŒ FLOP å’Œ GPU å†…å­˜æ•ˆç‡\u003c/strong\u003eã€‚\u003c/p\u003e","title":"U-NET V2: RETHINKING THE SKIP CONNECTIONS OF U-NET FOR MEDICAL IMAGE SEGMENTATION"},{"content":"Abstract æ”¾å°„ç§‘åŒ»ç”Ÿæ‹¥æœ‰ä¸åŒçš„åŸ¹è®­å’Œä¸´åºŠç»éªŒï¼Œå¯¼è‡´è‚ºç»“èŠ‚çš„åˆ†å‰²æ³¨é‡Šå­˜åœ¨å·®å¼‚ï¼Œä»è€Œå¯¼è‡´åˆ†å‰²çš„ä¸ç¡®å®šæ€§ã€‚ä¼ ç»Ÿæ–¹æ³•é€šå¸¸é€‰æ‹©å•ä¸ªæ³¨é‡Šä½œä¸ºå­¦ä¹ ç›®æ ‡æˆ–å°è¯•å­¦ä¹ åŒ…å«å¤šä¸ªæ³¨é‡Šçš„æ½œåœ¨ç©ºé—´ã€‚\nç„¶è€Œï¼Œè¿™äº›æ–¹æ³•æ— æ³•åˆ©ç”¨å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„å…±è¯†å’Œåˆ†æ­§æ‰€å›ºæœ‰çš„æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ³¨æ„æœºåˆ¶ï¼ˆUAAMï¼‰ï¼Œå®ƒåˆ©ç”¨å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„å…±è¯†å’Œåˆ†æ­§æ¥ä¿ƒè¿›æ›´å¥½çš„åˆ†å‰²ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†å¤šç½®ä¿¡åº¦æ©æ¨¡ï¼ˆMCMï¼‰ï¼Œå®ƒç»“åˆäº†ä½ç½®ä¿¡åº¦ï¼ˆLCï¼‰æ©æ¨¡å’Œé«˜ç½®ä¿¡åº¦ï¼ˆHCï¼‰æ©æ¨¡ã€‚ LC æ©æ¨¡è¡¨ç¤ºåˆ†å‰²ç½®ä¿¡åº¦è¾ƒä½çš„åŒºåŸŸï¼Œæ”¾å°„ç§‘åŒ»ç”Ÿå¯èƒ½æœ‰ä¸åŒçš„åˆ†å‰²é€‰æ‹©ã€‚ç»§UAAMä¹‹åï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ä¸€ä¸ªä¸ç¡®å®šæ€§å¼•å¯¼å¤šç½®ä¿¡åˆ†å‰²ç½‘ç»œï¼ˆUGMCS-Netï¼‰ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼šä¸€ä¸ªæ•è·è‚ºç»“èŠ‚ä¸€èˆ¬ç‰¹å¾çš„ç‰¹å¾æå–æ¨¡å—ï¼Œä¸€ä¸ªä¸ºè‚ºç»“èŠ‚äº§ç”Ÿä¸‰ä¸ªç‰¹å¾çš„ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—ã€‚æ³¨é‡Šçš„å¹¶é›†ã€äº¤é›†å’Œæ³¨é‡Šé›†ï¼Œä»¥åŠä¸€ä¸ªäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—ï¼Œè¯¥æ¨¡å—ä½¿ç”¨ä¸‰ä¸ªç‰¹å¾ä¹‹é—´çš„è·ç¦»æ¥å¹³è¡¡æœ€ç»ˆåˆ†å‰²å’Œ MCM çš„é¢„æµ‹ã€‚ä¸ºäº†å…¨é¢å±•ç¤ºæˆ‘ä»¬æ–¹æ³•çš„æ€§èƒ½ï¼Œæˆ‘ä»¬æå‡ºäº† LIDC-IDRI ä¸Šçš„å¤æ‚ç»“èŠ‚éªŒè¯ï¼Œå®ƒæµ‹è¯•äº† UGMCS-Net å¯¹ä½¿ç”¨å¸¸è§„æ–¹æ³•éš¾ä»¥åˆ†å‰²çš„è‚ºç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ˜¾ç€æé«˜ä¼ ç»Ÿæ–¹æ³•éš¾ä»¥åˆ†å‰²çš„ç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚\nINTRODUCTION è‚ºç»“èŠ‚åˆ†å‰²åœ¨è‚ºç™Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ (CAD) ç³»ç»Ÿä¸­è‡³å…³é‡è¦ [1]ï¼Œå¯æä¾›ç»“èŠ‚å¤§å°ã€å½¢çŠ¶å’Œå…¶ä»–é‡è¦åŒ»å­¦ç‰¹å¾ç­‰å…³é”®ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¯¹äºæ·±åº¦å­¦ä¹ æ–¹æ³•çš„ä¸€èˆ¬è®­ç»ƒå’Œæµ‹è¯•èŒƒä¾‹ï¼Œæ¯ä¸ªç»“èŠ‚å›¾åƒæ•°æ®åªæœ‰ä¸€ä¸ªç”±ä¸€åæ”¾å°„ç§‘åŒ»ç”Ÿæç»˜çš„æ³¨é‡Šæ©æ¨¡[2]-[6]ã€‚å› æ­¤ï¼Œç½‘ç»œæ¯æ¬¡åªèƒ½æä¾›ç»“èŠ‚åŒºåŸŸçš„å•ä¸ªé¢„æµ‹ã€‚\nç„¶è€Œï¼Œåœ¨ä¸´åºŠå®è·µä¸­ï¼Œä¸åŒçš„æ”¾å°„ç§‘åŒ»ç”Ÿç”±äºå…¶ä¸åŒçš„åŸ¹è®­å’Œä¸´åºŠç»éªŒå¯èƒ½ä¼šä¸ºè‚ºç»“èŠ‚æä¾›ä¸åŒçš„åˆ†å‰²æ³¨é‡Š[7]-[9]ã€‚\nå› æ­¤ï¼ŒåŸºäºå•ä¸€æ³¨é‡Šçš„ä¼ ç»Ÿæ–¹æ³•æ— æ³•åæ˜ ä¸´åºŠç»éªŒçš„å¤šæ ·æ€§ï¼Œé™åˆ¶äº†æ·±åº¦å­¦ä¹ æ–¹æ³•çš„åº”ç”¨ã€‚\nè§£å†³æ”¾å°„ç§‘åŒ»ç”Ÿä¹‹é—´æ³¨é‡Šä¸åŒé—®é¢˜çš„ä¸€ä¸ªç›´æ¥è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºæ¯ä¸ªè‚ºç»“èŠ‚å›¾åƒåˆå¹¶å¤šä¸ªæ³¨é‡Šã€‚è¿™å¯¼è‡´äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªæ³¨é‡Šä¸å¯é¿å…åœ°ä¼šå¸¦æ¥ä¸ç¡®å®šæ€§å’Œå†²çªï¼Œå› ä¸ºæ”¾å°„ç§‘åŒ»ç”Ÿå¯èƒ½ä¼šå¯¹åŒä¸€åŒºåŸŸè¿›è¡Œä¸åŒçš„æ³¨é‡Šã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼ŒKohl ç­‰äººåœ¨ 2018 å¹´æå‡ºäº†ä¸€ç§æ¦‚ç‡ U-Netï¼Œå®ƒåˆ©ç”¨æ¡ä»¶å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨å°†å¤šä¸ªåˆ†å‰²å˜ä½“ç¼–ç åˆ°ä½ç»´æ½œåœ¨ç©ºé—´ä¸­ [8]ã€[10]ã€‚é€šè¿‡ä»è¯¥ç©ºé—´é‡‡æ ·ï¼Œç½‘ç»œå¯ä»¥å½±å“ç›¸åº”çš„åˆ†å‰²å›¾ã€‚åŸºäºè¿™é¡¹ç ”ç©¶ï¼ŒHuç­‰äººæå‡ºå°†çœŸå®ä¸ç¡®å®šæ€§ä¸æ¦‚ç‡UNetç›¸ç»“åˆï¼Œè¿™å¯ä»¥æé«˜é¢„æµ‹ä¸ç¡®å®šæ€§ä¼°è®¡ã€æ ·æœ¬å‡†ç¡®æ€§å’Œæ ·æœ¬å¤šæ ·æ€§[7]ã€‚è¿™äº›æ–¹æ³•ä¾èµ–äºæ½œåœ¨ç©ºé—´å’Œè¯¥ç©ºé—´ä¸­çš„éšæœºæ ·æœ¬ã€‚å› æ­¤ï¼Œè¿™äº›æ–¹æ³•åªèƒ½é€šè¿‡å¤šæ¬¡é¢„æµ‹æ¥æä¾›ä¸ç¡®å®šåŒºåŸŸã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªè®ºç‚¹ï¼Œå³å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„ä¸ç¡®å®šæ€§éµå¾ªç‰¹å®šçš„æ¨¡å¼ã€‚\nä¸ºäº†æ¼”ç¤ºè¿™ç§ç°è±¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†å¤šé‡ç½®ä¿¡æ©ç  (MCM)ï¼Œå®ƒç»“åˆäº†é«˜ç½®ä¿¡åº¦ (HC) æ©ç å’Œä½ç½®ä¿¡åº¦ (LC) æ©ç ï¼Œå¦‚å›¾ 1 æ‰€ç¤ºã€‚ A. äº¤å‰æ©ç ç­‰äº HC maskï¼Œä»£è¡¨æ‰€æœ‰æ³¨é‡Šçš„äº¤é›†ã€‚\nè”åˆæ©ç æ˜¯æ‰€æœ‰æ³¨é‡Šçš„è”åˆã€‚ LCæ©æ¨¡æ˜¯äº¤é›†æ©æ¨¡å’Œå¹¶é›†æ©æ¨¡ä¹‹é—´çš„å·®å¼‚ã€‚å½“åœ¨ LIDC-IDRI æ•°æ®é›† [11] ä¸Šè®¡ç®— HC å’Œ LC çš„ Hounsfield å•ä½ (HU) æ ¸ä¼°è®¡æ—¶ï¼Œå¦‚å›¾ 1.B æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ° LC å’Œ HC æ©æ¨¡ä¹‹é—´çš„ HU åˆ†å¸ƒå­˜åœ¨æ˜æ˜¾åŒºåˆ«ã€‚å…·ä½“åœ°ï¼ŒLCåŒºåŸŸå…·æœ‰æ¯”HCåŒºåŸŸæ›´ä½çš„HUå€¼ã€‚ä»åƒç´ åˆ†å¸ƒæ¥çœ‹ï¼ŒHUå€¼è¶Šä½ï¼Œå¯¹åº”åŒºåŸŸçš„å¯†åº¦è¶Šä½ã€‚å°±CTå›¾åƒç‰¹å¾è€Œè¨€ï¼ŒLCåŒºåŸŸä¸»è¦ç”±ç»“èŠ‚è¾¹ç¼˜ã€æ¯›åˆºå’Œç£¨ç»ç’ƒç‰¹å¾ç­‰è¾¹ç•Œç›¸å…³ç‰¹å¾ç»„æˆï¼Œè€ŒHCåŒºåŸŸä¸»è¦åˆ†å¸ƒåœ¨ç»“èŠ‚æ ¸å¿ƒå†…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†è¿™æ ·çš„å‡è®¾ï¼šå¯¼è‡´æ”¾å°„ç§‘åŒ»ç”Ÿä¹‹é—´å·®å¼‚çš„åŒºåŸŸä¸»è¦ä¸ä½å¯†åº¦ç»„ç»‡å’Œè¾¹ç•Œç›¸å…³ç‰¹å¾æœ‰å…³ã€‚\nä¸å…¶ä»–æ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬å»ºè®®åˆ©ç”¨ MCM (å¤šé‡ç½®ä¿¡æ©ç ) ** å’Œæ³¨é‡Šé›†ä½œä¸ºå…·æœ‰ä¸åŒåˆ†å‰²ç¡®å®šæ€§çš„ç‰¹å¾çš„å­¦ä¹ æŒ‡å¯¼**ï¼Œæœ‰åŠ©äºæ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚æˆ‘ä»¬å°†è¿™ç§è®­ç»ƒç§°ä¸ºUncertaintyAware Attention Mechanismï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚æŒ‰ç…§è¿™ç§æœºåˆ¶ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ç”¨äºè‚ºç»“èŠ‚åˆ†å‰²çš„Uncertainty-Guide Multi-Confidence Segmentation Networkï¼ˆUGMCS-Netï¼‰ã€‚\nUGMCS-Net åŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼šåŸºäº U-Net çš„ç‰¹å¾æå–æ¨¡å—ã€ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—å’Œäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—ã€‚\né¦–å…ˆï¼Œæ ‡ç­¾åˆ†ä¸ºäº¤é›†æ ‡ç­¾( $L_\\cap$ )ã€å¹¶é›†æ ‡ç­¾ ( $L_\\cup$ )ã€åŸå§‹æ ‡ç­¾ (L)ã€‚\nå…¶æ¬¡ï¼ŒHC (consensus) è¡¨ç¤º $L_\\cap$ ã€ LCï¼ˆdisagreementï¼‰è¡¨ç¤º $L_\\cup$ - $L_\\cap$ã€‚\nMCM (Multi Confidence Mask) è¡¨ç¤º HC å’Œ LCçš„ç»Ÿç§°\né¦–å…ˆï¼Œç‰¹å¾æå–æ¨¡å—ä»è¾“å…¥çš„CTå›¾åƒä¸­æå–é€šç”¨ç‰¹å¾å›¾Rã€‚å…¶æ¬¡ï¼Œä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—åœ¨æ ‡ç­¾çš„äº¤é›†ã€å¹¶é›†ã€å’ŒåŸæ ‡ç­¾çš„æŒ‡å¯¼ä¸‹ï¼Œå°†é€šç”¨ç‰¹å¾å›¾Rè½¬æ¢ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„ç‰¹å¾å›¾$R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ã€‚ $R_{LC}$ã€$R_{HC}$ç”¨äºé¢„æµ‹å¹¶é›†æ©ç å’Œäº¤é›†æ©ç ï¼Œå¹¶å°†ç»“æœç»„åˆä¸ºMCMã€‚$R_{Uni}$ç”¨äºé¢„æµ‹åˆæ­¥åˆ†å‰²ç»“æœã€‚æˆ‘ä»¬ç¨åä½¿ç”¨ $\\cup(X)$, $\\cap(X)$, $X_{Uni}$ æ¥è¡¨ç¤ºé¢„æµ‹çš„å¹¶é›†æ©ç ã€äº¤é›†æ©ç å’Œåˆæ­¥åˆ†å‰²ç»“æœã€‚ç¬¬ä¸‰ï¼Œçº¦æŸæ¨¡å—ä½¿ç”¨æ¥è‡ª$R_{LC}$ã€$R_{HC}$ å’Œ $R_{Uni}$çš„ç‰¹å¾æ„ŸçŸ¥æ³¨æ„å—æ•è·é¦–é€‰ç‰¹å¾ï¼Œç„¶åç”¨ç‰¹å¾è·ç¦»çº¦æŸæœ€ç»ˆé¢„æµ‹$X_S$ï¼Œç¡®ä¿åˆ†å‰²ç»“æœä»¥åˆç†çš„æ–¹å¼å—åˆ°çº¦æŸã€‚ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨å¤šä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†å¤šæ³¨é‡ŠèåˆæŸå¤±æ¥ä¼˜åŒ– $X_{Uni}$å’Œ $X_S$ï¼Œå®ƒè®¡ç®—é¢„æµ‹å’Œæ‰€æœ‰æ³¨é‡Šä¹‹é—´çš„å¹³å‡ BCE æŸå¤±ã€‚\nè¯¥æ–¹æ³•å…·æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ä¼˜ç‚¹ï¼š ï¼ˆ1ï¼‰ä¸å­¦ä¹ æ½œåœ¨ç©ºé—´çš„ä¼ ç»ŸåŸºäº VAE çš„æ–¹æ³•ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•å…·æœ‰ç‰¹å®šçš„å­¦ä¹ ç›®æ ‡ï¼Œä½¿å…¶èƒ½å¤Ÿæä¾›ä¸ç¡®å®šç»“èŠ‚åŒºåŸŸçš„ç¨³å®šé¢„æµ‹ã€‚ ï¼ˆ2ï¼‰è¯¥æ–¹æ³•åˆ©ç”¨æ‰€æœ‰æ³¨é‡Šæ¥ä¼˜åŒ–é¢„æµ‹ï¼Œä»¥ç¡®ä¿æœ€ç»ˆé¢„æµ‹å¹³è¡¡ä¸åŒæ¡ä»¶ï¼Œå……åˆ†åˆ©ç”¨å¯ç”¨ä¿¡æ¯ã€‚\næˆ‘ä»¬åœ¨ä¹‹å‰çš„å‡ºç‰ˆç‰©ä¸­æŠ¥å‘Šäº†è¿™é¡¹å·¥ä½œçš„åˆæ­¥ç‰ˆæœ¬[12]ã€‚æœ¬æ–‡çš„æ–°è´¡çŒ®å¯æ¦‚æ‹¬å¦‚ä¸‹: ï¼ˆ1ï¼‰ä¸€ç§ç§°ä¸ºä¸ç¡®å®šæ€§æ„ŸçŸ¥æ³¨æ„æœºåˆ¶ï¼ˆUAAMï¼‰çš„æ–°é¢–æœºåˆ¶ï¼šUAAM æœ€å¤§é™åº¦åœ°åˆ©ç”¨å¤šä¸ªæ³¨é‡Šï¼Œå¹¶é‡‡ç”¨å¤šé‡ç½®ä¿¡æ©ç ï¼ˆMCMï¼‰æ¥æŒ‡å¯¼ä½ç½®ä¿¡åº¦å’Œé«˜ç½®ä¿¡åº¦ç‰¹å¾çš„å­¦ä¹ ã€‚\nï¼ˆ2ï¼‰å‡çº§åçš„Uncertainty-Guide Multi-Confidence Segmentation Network (UGMCS-Net)ï¼šåŸºäºè¯¥æœºåˆ¶ï¼Œæˆ‘ä»¬å°†UGS-Netæ›´æ–°ä¸ºUGMCSNetï¼Œå…¶ä¸­åŒ…å«ç‰¹å¾æå–æ¨¡å—ã€ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—å’Œæ–°çš„äº¤å¹¶é›†çº¦æŸæ¨¡å—ã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨å¤šä¸ªæ³¨é‡Šï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†å¤šæ³¨é‡ŠèåˆæŸå¤±ã€‚æ‰€æå‡ºçš„æ¨¡å—æ˜¯å³æ’å³ç”¨çš„ï¼Œå¯ä»¥åº”ç”¨äºä¸åŒæƒ…å†µä¸‹çš„å…¶ä»–åˆ†å‰²ç½‘ç»œã€‚\nï¼ˆ3ï¼‰å…¨é¢éªŒè¯ï¼šæˆ‘ä»¬æå‡ºäº†ComplexNodule Validationï¼Œæµ‹è¯•UGMCS-Netå¯¹U-Netéš¾ä»¥åˆ†å‰²çš„è‚ºç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚å®éªŒè¡¨æ˜ï¼Œå¯¹äºUNetä¸ŠDSCåˆ†æ•°ä½äº60ï¼…çš„ç»“èŠ‚ï¼Œæˆ‘ä»¬ç½‘ç»œçš„DSCåˆ†æ•°å¯ä»¥æé«˜11.03ï¼…ï¼Œæˆ‘ä»¬ç½‘ç»œçš„IoUåˆ†æ•°å¯ä»¥æé«˜11.88ï¼…ã€‚æˆ‘ä»¬è¿˜ä¸ºä¸åŒçš„æ¨¡å—ã€ä¸»å¹²å’Œæ¨¡å‹è®¾ç½®æä¾›è¶³å¤Ÿçš„æ¶ˆèç ”ç©¶ã€‚\nRelated Work 2.1 Lung Nodule Segmentation è‚ºç»“èŠ‚åˆ†å‰²å¯¹äºè‚ºç»“èŠ‚è®¡ç®—æœºè¾…åŠ©æ£€æµ‹ (CAD) ç³»ç»Ÿè‡³å…³é‡è¦ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯å‡†ç¡®åœ°æç»˜ç›®æ ‡ç»“èŠ‚çš„è¾¹ç•Œï¼Œä»¥æä¾›å…¶ç›´å¾„ã€å¤§å°å’Œè¯­ä¹‰ç‰¹å¾ç­‰ç»†èŠ‚[13]-[16]ã€‚è¿™é¡¹ä»»åŠ¡çš„ä¸»è¦æŒ‘æˆ˜æ˜¯è‚ºç»“èŠ‚å…·æœ‰å„ç§å½¢çŠ¶ã€å¤§å°å’Œå¾®å¦™çš„ç‰¹å¾ã€‚æ—©å¹´ï¼Œç ”ç©¶äººå‘˜æä¾›äº†å¤šç§è‚ºç»“èŠ‚åˆ†å‰²æ–¹æ³•ï¼Œä¾‹å¦‚åŸºäºå½¢æ€å­¦çš„æ–¹æ³•å’ŒåŸºäºåŒºåŸŸç”Ÿé•¿çš„æ–¹æ³•[17]ï¼Œ[18]ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ å·²æˆä¸ºè¯¥é¢†åŸŸæœ€æµè¡Œçš„æ–¹æ³•ã€‚\n2017å¹´ï¼ŒWangç­‰äººæå‡ºäº†ä¸€ç§ç”¨äºè‚ºç»“èŠ‚åˆ†å‰²çš„å¤šè§†å›¾å·ç§¯ç½‘ç»œã€‚æ‰€æå‡ºçš„ç½‘ç»œåŒæ—¶ä» CT å›¾åƒçš„è½´å‘ã€å† çŠ¶å’ŒçŸ¢çŠ¶è§†å›¾ä¸­æ•è·äº†ä¸€ç»„ä¸åŒçš„ç»“èŠ‚æ•æ„Ÿç‰¹å¾ã€‚ä½¿ç”¨å¤šåˆ†æ”¯ CNN ç½‘ç»œå¯¹è¿™äº›ç‰¹å¾è¿›è¡Œåˆ†æï¼Œå¹³å‡ DSC ç›¸ä¼¼ç³»æ•° (DSC) ä¸º 77.67% [19]ã€‚æ­¤å¤–ï¼ŒWang ç­‰äººåœ¨ 2017 å¹´æå‡ºäº†ä¸€ç§å…·æœ‰ä¸­å¿ƒæ± å±‚çš„ä¸­å¿ƒèšç„¦å·ç§¯ç¥ç»ç½‘ç»œï¼Œå¯ä»¥å½»åº•åˆ†æ 2D å’Œ 3D ç»“èŠ‚ [1]ã€‚ 2020å¹´ï¼ŒCaoç­‰äººè®¾è®¡äº†å¸¦æœ‰å¼ºåº¦æ± å±‚çš„åŒåˆ†æ”¯æ®‹å·®ç½‘ç»œï¼Œå¢å¼ºäº†å¼ºåº¦ä¿¡æ¯çš„å­¦ä¹ ï¼Œå¹¶å°†DSCæé«˜åˆ°82.74ï¼…[20]ã€‚ 2021å¹´ï¼ŒPezzanoç­‰äººæ¨å‡ºäº†ä¸€ç§CNNç½‘ç»œï¼Œå¯ä»¥é€šè¿‡ç”Ÿæˆä¸¤ä¸ªä»£è¡¨CTä¸­æ‰€æœ‰èƒŒæ™¯å’Œæ¬¡è¦é‡è¦å…ƒç´ çš„æ©æ¨¡æ¥å­¦ä¹ ç»“èŠ‚çš„èƒŒæ™¯ï¼Œä»è€Œä½¿ç½‘ç»œå¯ä»¥æ›´å¥½åœ°åŒºåˆ†ç»“èŠ‚ç‰¹å¾[15]ã€‚åæ¥åœ¨2022å¹´ï¼ŒShariatyç­‰äººè¿›ä¸€æ­¥æå‡ºäº†çº¹ç†ç‰¹å¾æå–å’Œç‰¹å¾é€‰æ‹©ç®—æ³•æ¥æ”¹è¿›åˆ†å‰²ï¼Œå®ç°äº†84.75%çš„DSC[2]ã€‚\næ ¹æ®ä¸Šè¿°ç ”ç©¶çš„è§‚å¯Ÿç»“æœï¼Œæ˜¾ç„¶ç°æœ‰æ–¹æ³•ä¸»è¦ä¼˜å…ˆè€ƒè™‘å®ç°æ›´ç²¾ç¡®çš„åˆ†å‰²ï¼Œè€Œå¿½ç•¥äº†ä¸åŒæ”¾å°„ç§‘åŒ»ç”Ÿå¯¹å¦‚ä½•åˆ†å‰²åŒä¸€è‚ºç»“èŠ‚å¯èƒ½æŒæœ‰ä¸åŒæ„è§çš„äº‹å®ã€‚åœ¨è¿™é¡¹ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºæ³¨é‡Šä¹‹é—´çš„åˆ†æ­§ä¹Ÿå…·æœ‰è¯Šæ–­ä»·å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ—¨åœ¨ç”Ÿæˆä¸€ä¸ªåˆ†å‰²ï¼Œé€šè¿‡ä»æ³¨é‡Šé›†å­¦ä¹ å¹¶è¯†åˆ«å…·æœ‰ä¸åŒåˆ†å‰²ç¡®å®šæ€§çš„åŒºåŸŸæ¥æœ‰æ•ˆåœ°å¹³è¡¡æ‰€æœ‰æ³¨é‡Šã€‚\n2.2 Uncertainty in Lung Nodule Segmentation è®¸å¤šåŒ»å­¦å›¾åƒè§†è§‰é—®é¢˜éƒ½å­˜åœ¨æ¨¡ç³Šæ€§ã€‚åœ¨ä¸´åºŠæƒ…å†µä¸‹ï¼Œä»…é€šè¿‡ CT æ‰«æå¯èƒ½æ— æ³•æ˜ç¡®å“ªä¸ªç‰¹å®šåŒºåŸŸæ˜¯ç™Œç»„ç»‡ [10]ã€[21]ã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯ç»éªŒä¸°å¯Œçš„åŒ»ç”Ÿå’Œæ”¾å°„ç§‘åŒ»ç”Ÿä¹Ÿå¯èƒ½å¯¹ç›¸åŒçš„ç»„ç»‡æˆ–è‚¿ç˜¤æä¾›ä¸åŒçš„åˆ†å‰²ã€‚\n2018 å¹´ï¼ŒKohl ç­‰äººæå‡ºå°†æ­¤ä»»åŠ¡å»ºæ¨¡ä¸ºå­¦ä¹ è‚ºç»“èŠ‚å¤šæ ·åŒ–ä½†åˆç†çš„åˆ†å‰²ä¸Šçš„åˆ†å¸ƒã€‚åŸºäº U-Net [5]ï¼Œä»–ä»¬å¼•å…¥äº†æ¦‚ç‡ U-Netï¼Œå®ƒæ˜¯ UNet å’Œæ¡ä»¶ VAE çš„ç»„åˆï¼Œå¯ä»¥äº§ç”Ÿæ— é™æ•°é‡çš„åˆç†åˆ†å‰²ã€‚ 2019å¹´æ™šäº›æ—¶å€™ï¼ŒKohlç­‰äººè¿›ä¸€æ­¥æå‡ºäº†ä¸€ç§åˆ†å±‚æ¦‚ç‡U-Netï¼Œå®ƒä½¿ç”¨åˆ†å±‚æ½œåœ¨ç©ºé—´åˆ†è§£æ¥åˆ¶å®šé«˜ä¿çœŸåº¦åˆ†å‰²çš„é‡‡æ ·å’Œé‡å»º[8]ã€‚åŒæ ·åœ¨ 2019 å¹´ï¼ŒHu ç­‰äººåˆ†æäº†ä¸¤ç§ç±»å‹çš„ä¸ç¡®å®šæ€§ï¼šä»»æ„çš„å’Œè®¤çŸ¥çš„ [7]ã€‚ä»–ä»¬åˆ©ç”¨å¤šä¸ªæ³¨é‡Šçš„å¯å˜æ€§ä½œä¸ºâ€œground truthâ€ä»»æ„ä¸ç¡®å®šæ€§çš„æ¥æºï¼Œå°†è¿™ç§ä¸ç¡®å®šæ€§ä¸æ¦‚ç‡ UNet ç»“åˆèµ·æ¥ï¼Œå¹¶å°è¯•å®šé‡åˆ†æåˆ†å‰²ä¸ç¡®å®šæ€§ã€‚ 2021å¹´ï¼ŒLongç­‰äººå°†[7]ä¸­çš„æ¦‚å¿µæ‰©å±•åˆ°V-Netå’Œ3Dè‚ºç»“èŠ‚CTå›¾åƒã€‚ä½œä¸ºåŒ…å« 1000 å¤šä¸ªè‚ºç»“èŠ‚çš„å¤šä¸ªæ³¨é‡Šçš„ç†æƒ³æ•°æ®é›†ï¼Œæ‰€æœ‰è¿™äº›ç ”ç©¶ [7]-[10] éƒ½åˆ†æäº† LIDC-IDRIã€‚\nä¸åŸºäºVAEçš„ç½‘ç»œä¸åŒï¼Œæˆ‘ä»¬çš„å·¥ä½œæ›´å…³æ³¨å¯¼è‡´å„ç§æ ‡æ³¨çš„åŸå› ï¼Œè¡¨ç°ä¸ºåˆ†å‰²åˆ†æ­§ã€‚æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§ä¸“é—¨é’ˆå¯¹ä¸ç¡®å®šæ€§åŒºåŸŸçš„æ›¿ä»£æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹ä¸ç¡®å®šçš„ç»“èŠ‚åŒºåŸŸå’Œæ•´ä½“è‚ºç»“èŠ‚åˆ†å‰²åšå‡ºç¨³å®šçš„é¢„æµ‹ã€‚è¿™ç§æ–¹æ³•ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ·±å…¥äº†è§£åˆ†å‰²å·®å¼‚çš„æ ¹æœ¬åŸå› ï¼Œå¹¶åœ¨ä¸ç¡®å®šçš„è‚ºç»“èŠ‚åŒºåŸŸä¸­äº§ç”Ÿæ›´å¯é çš„ç»“æœã€‚\nåœ¨åŒ»å­¦å›¾åƒå¤„ç†ä¸­ï¼Œ\u0026ldquo;æ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆConditional Variational Autoencoder, CVAEï¼‰\u0026ldquo;æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒç»“åˆäº†å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVAEï¼‰çš„ç‰¹æ€§å’Œæ¡ä»¶ç”Ÿæˆçš„èƒ½åŠ›ã€‚VAEæ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œèƒ½å¤Ÿå­¦ä¹ è¾“å…¥æ•°æ®çš„æ½œåœ¨è¡¨ç¤ºï¼Œç„¶åä»è¿™äº›è¡¨ç¤ºä¸­ç”Ÿæˆæ–°çš„æ•°æ®å®ä¾‹ã€‚CVAEåœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†æ¡ä»¶å˜é‡ï¼Œä½¿å¾—ç”Ÿæˆçš„è¿‡ç¨‹å¯ä»¥ä¾èµ–äºæŸäº›æ¡ä»¶æˆ–æ ‡ç­¾ã€‚\nå¯¹äºåŒ»å­¦å›¾åƒï¼ŒCVAEå¯ä»¥ç”¨äºå¤šç§ä»»åŠ¡ï¼Œå¦‚ç”Ÿæˆç‰¹å®šç±»å‹çš„åŒ»å­¦å›¾åƒï¼ˆä¾‹å¦‚ï¼Œæ ¹æ®ç‰¹å®šç–¾ç—…çŠ¶æ€ç”ŸæˆCTæˆ–MRIå›¾åƒï¼‰ï¼Œæ•°æ®å¢å¼ºï¼ˆç”Ÿæˆæ–°çš„è®­ç»ƒæ ·æœ¬ï¼‰ï¼Œä»¥åŠç‰¹å¾æå–å’Œè¡¨ç¤ºå­¦ä¹ ç­‰ã€‚é€šè¿‡å°†æ¡ä»¶ä¿¡æ¯ï¼ˆå¦‚ç–¾ç—…æ ‡ç­¾ã€å›¾åƒç±»å‹æˆ–æ‚£è€…ä¿¡æ¯ï¼‰èå…¥åˆ°ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼ŒCVAEèƒ½å¤Ÿç”Ÿæˆæ›´ç¬¦åˆç‰¹å®šæ¡ä»¶çš„å›¾åƒï¼Œä»è€Œåœ¨ç‰¹å®šåŒ»å­¦åº”ç”¨ä¸­å‘æŒ¥ä½œç”¨ã€‚\nMethod 3.1 Uncertainty-Guided Multi-Confidence Segmentation Network åœ¨å›¾ 3 ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº† UncertaintyGuided Multi-Confidence Segmentation Network (UGMCSNet) çš„æ¶æ„ã€‚è¯¥ç½‘ç»œä»¥è‚ºç»“èŠ‚ CT å›¾åƒä½œä¸ºè¾“å…¥ï¼Œå¹¶äº§ç”Ÿä¸¤ä¸ªè¾“å‡ºï¼šé¢„æµ‹çš„å¤šç½®ä¿¡åº¦æ©æ¨¡ï¼ˆMCMï¼‰å’Œæœ€ç»ˆçš„åˆ†å‰² $X_S$ã€‚ MCM ç»“åˆäº†é¢„æµ‹çš„å¹¶é›† $\\cup(X)$ å’Œäº¤é›† $\\cap(X)$ã€‚ç½‘ç»œçš„å­¦ä¹ ç›®æ ‡æ˜¯æ³¨é‡Šé›† GTï¼Œä»¥åŠå®ƒä»¬çš„ Union Mask $\\cup(GT)$ å’Œ Intersection Mask $\\cap(GT)$ã€‚è¾“å…¥å›¾åƒåŠå…¶ç›¸åº”çš„æ©æ¨¡çš„å°ºå¯¸ä¸º 50 Ã— 50 åƒç´ ï¼Œé€šè¿‡ä»å¸¦æœ‰å®˜æ–¹æ³¨é‡Šçš„ LIDC-IDRI æ•°æ®é›†è£å‰ªè·å¾—ã€‚åœ¨è¾“å…¥ç½‘ç»œä¹‹å‰ï¼Œè¾“å…¥å›¾åƒå’Œæ©æ¨¡çš„å¤§å°è¢«è°ƒæ•´ä¸º 3 Ã— 64 Ã— 64 åƒç´ çš„å°ºå¯¸ã€‚\nUGMCS-Net åŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼š(1) ç‰¹å¾æå–æ¨¡å—ï¼Œ(2) ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—ï¼Œ(3) äº¤å¹¶å¹¶çº¦æŸæ¨¡å—ã€‚ç‰¹å¾æå–æ¨¡å—å¯ä»¥ä½¿ç”¨ä»»ä½•åŸºäºUNetç»“æ„çš„åˆ†å‰²ç½‘ç»œï¼Œåˆæ­¥è·å¾—å½¢çŠ¶ä¸º32Ã—64Ã—64çš„ç‰¹å¾å›¾Rã€‚æœ¬æ–‡ä½¿ç”¨å…·æœ‰äº”ä¸ªä¸‹é‡‡æ ·å’Œä¸Šé‡‡æ ·å±‚çš„Attention U-Net [4] ã€‚æ¯ä¸ªä¸Šé‡‡æ ·å±‚ç”±ä¸¤ä¸ªå·ç§¯å±‚å’Œä¸€ä¸ªæ³¨æ„åŠ›å—ç»„æˆã€‚ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—åˆ†æ R å¹¶ç”Ÿæˆ$R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ã€‚ç„¶åå°†è¿™äº›ç‰¹å¾å›¾è¾“å…¥ MCM BCE Loss Block å’Œ Multiple Annotation Loss Blockï¼Œç”Ÿæˆåˆå§‹çš„ $\\cup(X)$ã€$\\cap(X)$ å’Œåˆç†çš„åˆ†å‰² $X_{Uni}$ã€‚è®¡ç®—å¹¶é›†ä»¥ $\\cup(X)$ã€$\\cap(X)$è·å¾— MCMã€‚ Intersection-Union Constraining Module å­¦ä¹  $R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$çš„ä¸åŒç‰¹å¾ï¼Œå¹¶å°†è¿™ä¸‰ä¸ªç‰¹å¾èåˆåˆ°$R_{final}$ ä¸­ã€‚ç„¶åè¯¥æ¨¡å—é€šè¿‡åˆ†æRF ianlæä¾›æ›´åˆç†çš„æœ€ç»ˆåˆ†å‰²$X_S$ã€‚\n3.2 Uncertainty-Aware Module å¼•å…¥ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—ï¼ˆUAMï¼‰ï¼Œé€šè¿‡å­¦ä¹ $\\cup(GT)$ã€$\\cap(GT)$ å’Œ GTæ¥å……åˆ†åˆç†åœ°åˆ©ç”¨æ‰€æœ‰æ³¨é‡Šä¿¡æ¯ã€‚è¯¥æ¨¡å—æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼šï¼ˆ1ï¼‰ä»ä½ç½®ä¿¡åº¦ï¼ˆLCï¼‰åŒºåŸŸã€é«˜ç½®ä¿¡åº¦ï¼ˆHCï¼‰åŒºåŸŸå’Œæ‰€æœ‰æ³¨é‡Šä¸­æ•è·ä¸åŒçš„ç‰¹å¾ï¼› (2) ç”Ÿæˆå¤šé‡ç½®ä¿¡æ©æ¨¡ (MCM) çš„åˆå§‹é¢„æµ‹å’Œä¸€èˆ¬åˆ†å‰²ã€‚\nå¦‚å›¾3æ‰€ç¤ºï¼ŒUAMé‡‡ç”¨ä¸‰åˆ†æ”¯CNNç½‘ç»œä½œä¸ºéª¨å¹²ã€‚å®ƒä»¥ R (32 Ã— 64 Ã— 64) ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä½¿ç”¨å†…æ ¸å¤§å°ä¸º 1Ã—1 çš„ä¸‰ä¸ªä¸åŒå·ç§¯å±‚æå– $R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ã€‚ $R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$çš„å¤§å°ç›¸åŒï¼Œå‡ä¸º 32 Ã— 64 Ã— 64ã€‚ MCM BCE Loss Block æ¥æ”¶ $R_{LC}$ã€$R_{HC}$ ï¼Œç”¨ä¸‰ä¸ªä¸åŒçš„å·ç§¯å±‚ç”Ÿæˆ $\\cup(X)$ å’Œ $\\cap(X)$ ï¼Œå†…æ ¸å¤§å°ä¸º 3Ã— 3. BCEæŸå¤±è®¡ç®—$\\cup(X)$ å’Œ $\\cup(GT)$çš„æŸå¤±ä»¥åŠ$\\cap(X)$ å’Œ $\\cap(GT)$ã€‚ $\\cup(X)$å’Œ$\\cap(X)$é€šè¿‡å½’ä¸€åŒ–æ“ä½œNormal($\\cup(X)$+$\\cap(X)$)ç»„åˆä¸ºMCM\u0026rsquo;ï¼Œåæ˜ äº†ä¸åŒåŒºåŸŸçš„ä¸ç¡®å®šæ€§ç¨‹åº¦ã€‚ä¸æˆ‘ä»¬ä¹‹å‰çš„å·¥ä½œ [12] ä¸åŒï¼Œ$R_{Uni}$ çš„åˆ†æ”¯æ˜¯é€šè¿‡å¤šé‡æ³¨é‡ŠæŸå¤±å—è¿›è¡Œä¼˜åŒ–çš„ï¼Œè¿™å°†åœ¨ç¨åè®¨è®ºã€‚æ­¤å¤–ï¼Œå…·æœ‰ç›¸åŒå½¢çŠ¶çš„ 1 Ã— 64 Ã— 64 çš„ç‰¹å¾å›¾ $R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ å°†è¢«è¾“å…¥åˆ°ä¸‹ä¸€ä¸ªæ¨¡å—ä¸­è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚\nä¸»è¦è¿˜æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªMCM\n3.3 Intersection-Union Constraining Module å¦‚ä¸Šæ‰€è¿°ï¼Œ$\\cup(GT)$å’Œ$\\cap(GT)$ æ˜¯UAMçš„å­¦ä¹ ç›®æ ‡ã€‚å…·ä½“åœ°ï¼Œ$\\cup(GT)$è¡¨ç¤ºæ‰€æœ‰å¯èƒ½æ˜¯ç»“èŠ‚ç»„ç»‡çš„åŒºåŸŸï¼Œè¡¨ç¤ºç½®$\\cap(GT)$ä¿¡åº¦æœ€é«˜çš„ç»“èŠ‚åŒºåŸŸã€‚ä¸ºäº†åœ¨æç«¯æƒ…å†µä¹‹é—´å®ç°å¹³è¡¡ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å¼€å‘äº†ä¸€ä¸ªæ–°æ¨¡å—ï¼Œç§°ä¸ºäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—ï¼ˆIUCMï¼‰ã€‚\nè¯¥æ¨¡å—æ—¨åœ¨æ•è·æ‰€æœ‰ä¸‰ä¸ªå­¦ä¹ ç›®æ ‡çš„ç‰¹å¾ï¼Œå¹¶äº§ç”Ÿæ›´åˆç†çš„åˆ†å‰²é¢„æµ‹ï¼Œå¯ä»¥åœ¨æç«¯æƒ…å†µä¹‹é—´å–å¾—å¹³è¡¡ã€‚\nå¦‚å›¾ 4 æ‰€ç¤ºï¼ŒIUCM å°† $R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å¯¹åº”çš„ $R_{LC}^{\\prime}$ã€$R_{HC}^{\\prime}$å’Œ$R_{Uni}^{\\prime}$ä¸ç‰¹å¾æ„ŸçŸ¥æ³¨æ„å— (FAAB) å¯¹åº”ã€‚ $R_{LC}^{\\prime}$ã€$R_{HC}^{\\prime}$å’Œ$R_{Uni}^{\\prime}$çš„å°ºå¯¸ç›¸åŒï¼Œå‡ä¸º 32 Ã— 32 Ã— 32ã€‚FAAB æ˜¯åŸºäºè‡ªæ³¨æ„åŠ›å— [22] å’Œç‰¹å¾æ„ŸçŸ¥æ»¤æ³¢å™¨æ„å»ºçš„ã€‚\nè¿™äº›æ³¨æ„åŠ›å—ä½¿ç”¨ä¸åŒçš„ç‰¹å¾æ„ŸçŸ¥æ»¤æ³¢å™¨å¤„ç†$R_{LC}$ã€$R_{HC}$å’Œ$R_{Uni}$ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿé’ˆå¯¹ä¸åŒçš„å­¦ä¹ ç›®æ ‡åˆ¶å®šä¸åŒçš„å­¦ä¹ åå¥½ï¼Œå¹¶è·å¾—æ›´å¤šæœ‰åŠ©äºåˆ†å‰²çš„å›¾åƒç‰¹å¾[23]ã€[24]ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå‡è®¾è¾“å…¥$R_z$ï¼ŒFAABçš„è¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š\nå…¶ä¸­ z âˆˆ {Uni, LC, HC},Aè¡¨ç¤ºè‡ªæ³¨æ„åŠ›æ¶æ„ã€‚ Ğ“æ˜¯ä¸€ä¸ªç‰¹å¾æ„ŸçŸ¥æ»¤æ³¢å™¨ï¼Œåœ¨æœ¬ç ”ç©¶ä¸­ï¼Œ$R_{Uni}$å’Œ$R_{LC}$çš„Ğ“æ˜¯Gabor[25]ï¼Œ$R_{HC}$çš„Ğ“æ˜¯Otsu[26]ã€‚ Î“(A($R_z$)) ä¸$R_z$é€åƒç´ ç›¸åŠ ï¼Œä»¥ä¾¿ç½‘ç»œå¯ä»¥ä»è¾“å…¥ä¸­ä¿ç•™æ›´å¤šä¿¡æ¯ã€‚\né€šè¿‡å¯¹æ•°æ®é›†å’ŒHounsfield Unit Kernel Estimationsçš„è§‚å¯Ÿï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ$R_{HC}$ä¸»è¦æ˜¯å¯†åº¦è¾ƒé«˜çš„å®æ€§ç»“èŠ‚ï¼Œè€Œ$R_{LC}$åˆ™åŒ…æ‹¬æ›´å¤šçš„ä½å¯†åº¦ç»„ç»‡ï¼ˆå¦‚æ¯›åˆºï¼‰ï¼Œä¸»è¦åˆ†å¸ƒåœ¨ç»“èŠ‚çš„è¾¹ç¼˜ã€‚ Otsuå¯¹å¯†åº¦ç‰¹å¾æ•æ„Ÿï¼Œå¯ä»¥å¸®åŠ©ç½‘ç»œæ›´å‡†ç¡®åœ°è¯†åˆ«é«˜å¯†åº¦ç»„ç»‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”ç”¨ Otsu ä» $R_{HC}$ ä¸­æå– $R_{HC}^{\\prime}$ã€‚åŒæ—¶ï¼ŒGaborå¯¹å›¾åƒè¾¹ç¼˜æ•æ„Ÿï¼Œèƒ½å¤Ÿæä¾›è‰¯å¥½çš„æ–¹å‘é€‰æ‹©å’Œå°ºåº¦é€‰æ‹©ç‰¹å¾ï¼Œä»è€Œèƒ½å¤Ÿæ•è·å›¾åƒå±€éƒ¨åŒºåŸŸå¤šä¸ªæ–¹å‘çš„å±€éƒ¨ç»“æ„ç‰¹å¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©Gaborä»$R_{LC}$å’Œ$R_{Uni}$ä¸­æå–$R_{LC}^{\\prime}$å’Œ$R_{Uni}^{\\prime}$ã€‚å…³äºè¿‡æ»¤å™¨é€‰æ‹©çš„æ¶ˆèç ”ç©¶å°†åœ¨ç¬¬å››èŠ‚ä¸­æä¾›ã€‚\nå¾—åˆ° $R_{LC}^{\\prime}$ã€$R_{HC}^{\\prime}$å’Œ$R_{Uni}^{\\prime}$åï¼ŒIUCM å¾—åˆ° $S_z$ = d{$R_Z$,$R$},dæ˜¯è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦çš„è¿ç®—ã€‚\nIUCM çš„è¾“å‡ºä¸º $R_{Aug}$ = Concat($S_{Uni}$Ã— $R_{Uni}^{\\prime}$ ; $S_{LC}$Ã— $R_{LC}^{\\prime}$; $S_{HC}$Ã— $R_{HC}^{\\prime}$ )ã€‚$R_{Aug}$å°†ä¸æ¥è‡ªç‰¹å¾æå–æ¨¡å—çš„ R è¿æ¥ï¼Œè¾“å…¥åˆ°å·ç§¯å±‚ï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„åˆ†å‰²é¢„æµ‹ $X_S$ã€‚ R å’Œ $R_{Aug}$ çš„ä¸²è”ä¿ç•™äº†æ¥è‡ª CT è¾“å…¥çš„æ›´å¤šä¿¡æ¯ã€‚\n3.4 Loss Function åœ¨å›¾ 3 ä¸­ï¼ŒUGMCS-Net åŒ…å«ä¸¤ä¸ªä¼˜åŒ–ï¼šMCM BCE æŸå¤±å—å’Œå¤šæ³¨é‡ŠæŸå¤±å—ã€‚\nMCM BCE Loss Block è®¡ç®—$\\cup(X)$ å’Œ $\\cup(GT)$ä¹‹é—´; $\\cap(X)$ å’Œ$\\cap{(GT)}$ä¹‹é—´çš„ BCE æŸå¤±å¯è¡¨ç¤ºä¸ºï¼š\næˆ‘ä»¬ä½¿ç”¨å¤šæ³¨é‡ŠèåˆæŸå¤±æ¥ä¼˜åŒ–å¤šæ³¨é‡ŠæŸå¤±å—ä¸­çš„$X_{Uni}$å’Œ$X_S$ï¼Œè¡¨ç¤ºä¸ºÎ¦ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰çš„å·¥ä½œä¸­ï¼Œåªé€‰æ‹©äº†ä¸€ç»„æ³¨é‡Šæ¥ä¼˜åŒ–$X_{Uni}$å’Œ$X_S$ï¼Œè¿™å¯¼è‡´å…¶ä»–æ³¨é‡Šä¸­æœ‰ä»·å€¼çš„ä¿¡æ¯ä¸¢å¤±ã€‚\næœ¬ç ”ç©¶å¼•å…¥äº†å¤šé‡æ³¨é‡ŠèåˆæŸå¤±ï¼Œå®ƒå°†é¢„æµ‹ä¸æ‰€æœ‰å¯èƒ½çš„æ³¨é‡Šè¿›è¡Œæ¯”è¾ƒã€‚\né¦–å…ˆï¼Œ$R_{Uni}$å’Œ$R_F$æœ€ç»ˆäº§ç”Ÿ$X_{Uni}$å’Œ$X_S$ã€‚å…¶æ¬¡ï¼Œå¦‚å›¾ 5 æ‰€ç¤ºï¼Œå¤šæ³¨é‡ŠèåˆæŸå¤±å‡½æ•°è®¡ç®—ä¼˜åŒ–å¯¹è±¡ï¼ˆ$X_{Uni}$å’Œ$X_S$ï¼‰ä¸æ³¨é‡Šé›†ä¹‹é—´çš„ BCE æŸå¤±ï¼Œå¹¶åˆå¹¶è¿™äº›æŸå¤±çš„å¹³å‡å€¼ã€‚æ ¹æ®æˆ‘ä»¬çš„è®¾è®¡ï¼Œ$X_{Uni}$åº”è¯¥å€¾å‘äºæ•´ä¸ªæ³¨é‡Šé›†ï¼ŒXSåº”è¯¥ä»æ³¨é‡Šé›†ä¸­å­¦ä¹ è¶³å¤Ÿçš„ä¿¡æ¯å¹¶äº§ç”Ÿå¹³è¡¡æ‰€æœ‰æ³¨é‡Šçš„åˆ†å‰²ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨å¤šæ³¨é‡ŠèåˆæŸå¤±æ¥ä¼˜åŒ–$X_{Uni}$å’Œ$X_S$ã€‚æˆ‘ä»¬æœ‰ï¼š\nç½‘ç»œçš„æŸå¤±èåˆå¯ä»¥å®šä¹‰ä¸ºï¼š\nå…¶ä¸­ Î±1ã€Î±2 å’Œ Î±3 æ˜¯é¢„å®šä¹‰å‚æ•°ã€‚æ ¹æ®ç»éªŒï¼Œæœ¬æ–‡ä¸­Î±1è®¾ç½®ä¸º0.5ï¼ŒÎ±2è®¾ç½®ä¸º0.5ï¼ŒÎ±3è®¾ç½®ä¸º1ã€‚é‡é‡é€‰æ‹©çš„æ¶ˆèç ”ç©¶å°†åœ¨ç¬¬å››èŠ‚ä¸­æ˜¾ç¤ºã€‚\nEXPERIMENT 4.1 Dataset and Experimental Settings åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ LIDC-IDRI æ•°æ®é›† [11] è¯„ä¼°æ‰€æå‡ºçš„ç½‘ç»œï¼Œè¯¥æ•°æ®é›†ç”± 1018 ä¸ªç ”ç©¶å®ä¾‹å’Œè¶…è¿‡ 2600 ä¸ªç»“èŠ‚ç»„æˆã€‚åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº† 1860 ä¸ªç›´å¾„ä¸º 3-30mm ä¸”å…·æœ‰å¤šä¸ªæ³¨é‡Šçš„è‚ºç»“èŠ‚ã€‚æ¯ä¸ªç»“èŠ‚æ•°æ®è‡³å°‘æœ‰ä¸¤ä¸ªæ³¨é‡Šï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è·å¾—å…¶CTå›¾åƒã€å¤šä¸ªæ³¨é‡Šé›†GTã€å®ƒä»¬çš„å¹¶é›†$\\cup(GT)$å’Œäº¤é›†$\\cap(GT)$ã€‚è¾“å…¥å›¾åƒåŠå…¶æ©æ¨¡å‡ä¸º 50 Ã— 50 åƒç´ ï¼Œæ ¹æ®å®˜æ–¹æ³¨é‡Šä» LIDC-IDRI æ•°æ®é›†ä¸­è£å‰ªã€‚æ¯ä¸ªåƒç´ åæ˜  CT å›¾åƒçš„äº¨æ–¯è²å°”å¾·å•ä½ã€‚\nåœ¨è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬å°† CT å›¾åƒçš„å¼ºåº¦å€¼è£å‰ªåˆ°èŒƒå›´ [1000,1000] å¹¶å°†æ‰€æœ‰å¼ºåº¦å€¼å½’ä¸€åŒ–åˆ°èŒƒå›´ [0, 1]ã€‚æ•°æ®å¤„ç†çš„ä»£ç åœ¨ç½‘ç«™ https://github.com/qiuliwang/LIDCIDRI-Toolbox-python ä¸Šæä¾›ã€‚\næˆ‘ä»¬åœ¨è¿è¡Œ Ubuntu 18.04ã€Tesla V100 GPU çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œå®éªŒï¼Œä½¿ç”¨ CUDA 11.2ï¼ŒGPU å†…å­˜çº¦ä¸º 16Gã€‚è¯¥ç½‘ç»œä½¿ç”¨PyTorch-v1.0.1å’ŒPython3.7å®ç°ã€‚æˆ‘ä»¬ä½¿ç”¨äº”é‡éªŒè¯æ¥è¯„ä¼°ç½‘ç»œçš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿æ•°æ®åˆ†å‰²çš„ç¨³å¥æ€§ã€‚æˆ‘ä»¬ä½¿ç”¨çƒ­é‡å¯éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDRï¼‰ä½œä¸ºä¼˜åŒ–å™¨ï¼Œåˆå§‹å­¦ä¹ ç‡ï¼ˆLRï¼‰ä¸º0.00001ï¼Œæ‰¹é‡å¤§å°ä¸º32ï¼ŒåŠ¨é‡ä¸º0.9ï¼Œæƒé‡è¡°å‡ç‡ä¸º0.0001ã€‚æ¯ä¸ªç½‘ç»œéƒ½è®­ç»ƒ 200 ä¸ª epochï¼Œå­¦ä¹ ç‡æ¯ 50 ä¸ª epoch æ›´æ–°ä¸€æ¬¡ã€‚ UGMCS-Netçš„æºä»£ç ã€åŸå§‹USGNetä»¥åŠæ‰€æœ‰å®éªŒè®¾ç½®å°†ä¸Šä¼ åˆ°https://github.com/yanghan-yh/UGS-Netã€‚\n4.2 Performance of Lung Nodule Segmentation æ¯ä¸ªç»“èŠ‚çš„ç›¸å…³æ³¨é‡ŠLabel1ï¼Œå®ƒæ˜¯æ³¨é‡Šé›†ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ Probabilistic U-Netæ˜¯ä¸€ç§åŸºäºVAEçš„æ¨¡ç³Šåˆ†å‰²æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å–å…¶å››ä¸ªæ ·æœ¬çš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆçš„åˆ†å‰²ç»“æœã€‚æœ¬ç ”ç©¶ä½¿ç”¨ä¸‰ä¸ªæŒ‡æ ‡æ¥è¯„ä¼°ç½‘ç»œå¯¹ç—…å˜åŒºåŸŸçš„é¢„æµ‹èƒ½åŠ›ï¼šå¹³å‡ Dice ç›¸ä¼¼ç³»æ•°ï¼ˆDSCï¼‰ã€äº¤é›†äº¤é›†ï¼ˆIoUï¼‰å’Œå½’ä¸€åŒ–è¡¨é¢ Diceï¼ˆNSDï¼‰[35]ã€‚åœ¨è¡¨ I ä¸­ï¼Œæ‰€æœ‰æ–¹æ³•å‡ä½¿ç”¨ Label1 è¿›è¡Œè¯„ä¼°ã€‚\nè¿™å®éªŒæ•°æ®å¤ªä¸°å¯Œäº†æŠŠï¼ï¼ï¼\nè¡¨Iæ˜¾ç¤ºUGMCS-Netåœ¨DSCã€IoUå’ŒNSDæ–¹é¢å–å¾—äº†æœ€é«˜åˆ†æ•°ï¼Œåˆ†åˆ«ä¸º87.65%ï¼ˆÂ±0.56%ï¼‰ã€78.78%ï¼ˆÂ±0.83%ï¼‰å’Œ95.62%ï¼ˆÂ±0.59%ï¼‰ã€‚ä¸ U-Net ç›¸æ¯”ï¼ŒUGMCS-Net åœ¨ä¸‰ä¸ªæŒ‡æ ‡ä¸Šåˆ†åˆ«æé«˜äº† 1.39%ã€1.99% å’Œ 1.16%ã€‚åŒæ ·ï¼Œä¸ Attention U-Net ç›¸æ¯”ï¼ŒUGMCS-Net åœ¨å„ä¸ªæŒ‡æ ‡ä¸Šå®ç°äº† 0.98%ã€1.45% å’Œ 0.68% çš„å¢å¼ºã€‚è¿™äº›ç»“æœå‡¸æ˜¾äº† UGMCS-Net å“è¶Šçš„åˆ†å‰²æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯ NSD åˆ†æ•°çš„å¤§å¹…æé«˜ï¼Œè¡¨æ˜å…¶å¼ºå¤§çš„è¾¹ç•Œç‰¹å¾åˆ†å‰²èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œä¸ UGSNet ç›¸æ¯”ï¼ŒUGMCS-Net åœ¨æ‰€æœ‰æŒ‡æ ‡ä¸Šéƒ½è¡¨ç°å‡ºäº†ç›¸å½“å¤§çš„è¿›æ­¥ï¼ŒDSC åˆ†æ•°æé«˜äº† 0.49%ï¼ŒIoU åˆ†æ•°æé«˜äº† 0.74%ï¼ŒNSD åˆ†æ•°æé«˜äº† 0.34%ã€‚æ­¤å¤–ï¼Œä» UGMCS-Net çš„äº”é‡äº¤å‰éªŒè¯ä¸­è·å¾—çš„ä¸‰ä¸ªæŒ‡æ ‡çš„æ–¹å·®å§‹ç»ˆå°äº UGS-Net çš„æ–¹å·®ï¼Œè¡¨æ˜é€šè¿‡é›†æˆå¤šé‡æ³¨é‡ŠèåˆæŸå¤±å’Œçº¦æŸæ“ä½œå¢å¼ºäº†ç½‘ç»œç¨³å®šæ€§ã€‚ nnU-Net æ˜¯ç”¨äºåˆ†å‰²ä»»åŠ¡çš„æµè¡Œç½‘ç»œã€‚ç„¶è€Œï¼Œå®ƒåœ¨ DSC ä¸­ä»…è¾¾åˆ° 84.60%ï¼Œåœ¨ IoU ä¸­ä»…è¾¾åˆ° 74.45%ã€‚è¿™æ˜¯å› ä¸ºnnU-Netçš„è®­ç»ƒéœ€è¦å¾ˆå¤§çš„æ•°æ®é›†ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨æ­¤ä»»åŠ¡ä¸­åªæœ‰ 1860 ä¸ªç»“èŠ‚å›¾åƒã€‚\nå›¾6æ˜¾ç¤ºäº†ä¸Šè¿°æ–¹æ³•çš„éƒ¨åˆ†åˆ†å‰²ç»“æœã€‚è¾“å…¥åˆ—ä¸­çš„çº¢è‰²æ¡†è¡¨ç¤ºæ„Ÿå…´è¶£çš„åŒºåŸŸæˆ–ç»“èŠ‚å®¹æ˜“å‡ºé”™çš„åˆ†å‰²ä½ç½®ã€‚ç»“èŠ‚(a)-(c)åŒ…å«è®¸å¤šä½å¯†åº¦åŒºåŸŸï¼Œç»“èŠ‚(d)-(f)åœ¨å…¶è¾¹ç•Œå¤„å…·æœ‰ä¸è§„åˆ™å½¢çŠ¶ï¼Œä¾‹å¦‚æ¯›åˆºè¿¹è±¡ï¼Œå¹¶ä¸”ç»“èŠ‚(g)-(h)å…·æœ‰ç©ºè…”ã€‚ UGMCS-Net å¯¹è¿™äº›åŒºåŸŸçš„åˆ†å‰²æ˜æ˜¾æ¯”å…¶ä»–æ–¹æ³•æ›´ç¬¦åˆç—…ç¶çš„å®é™…å½¢çŠ¶ã€‚\nå¯¹æ¯”å®éªŒç»“æœçš„å¥—è¯ ï¼ˆå¯ä»¥å­¦ä¹ ä¸€ä¸‹ï¼‰\nï¼ˆU-Netã€Attention U-Netã€R2U-Netã€Channel U-Netã€Nested U-Netã€UGS-Net å’Œ UGMCS-Net çš„åˆ†å‰²ç»“æœã€‚è¾“å…¥åˆ—å¯¹åº”çš„çº¢è‰²æ¡†è¡¨ç¤ºåˆ†å‰²æ—¶åº”æ³¨æ„çš„ç‰¹å¾æˆ–ç»“èŠ‚å®¹æ˜“å‡ºé”™çš„ä½ç½®ã€‚ UGMCS-Net åˆ—ä¸­çš„çº¢è‰²æ¡†è¡¨ç¤º UGMCS-Net åœ¨è¿™äº›ä½ç½®çš„åˆ†å‰²ç»†èŠ‚ã€‚ç»¿è‰²æ¡†è¡¨ç¤ºæ¬¡ä¼˜åˆ†å‰²ç»“æœçš„ä¸è¶³ä¹‹å¤„ã€‚æœ€åä¸€æ æ˜¯ç›¸åº”ç»“èŠ‚çš„ç›´å¾„ï¼Œå•ä½ä¸ºæ¯«ç±³ï¼‰\nè¿™ä¸ªå®šæ€§ç»“æœçš„å¯¹æ¯”æ–¹æ³•ï¼Œå€¼å¾—å­¦ä¹ ã€‚\nå›¾ 6 å’Œè¡¨ I è¡¨æ˜ï¼šï¼ˆ1ï¼‰ä»æ³¨é‡Šé›†åŠå…¶å¹¶é›†å’Œäº¤é›†ä¸­å­¦ä¹ ï¼Œä¸ºåˆ†å‰²ä»»åŠ¡æä¾›äº†æ›´ä¸°å¯Œçš„è§†è§‰ä¿¡æ¯ã€‚\n(2)ä»LCåŒºåŸŸå­¦ä¹ æé«˜äº†ç½‘ç»œè¯†åˆ«ä½å¯†åº¦åŒºåŸŸçš„èƒ½åŠ›ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå›¾6ï¼ˆgï¼‰-ï¼ˆhï¼‰ä¸­ï¼Œæ ‡æ³¨ä¸­æ²¡æœ‰ç©ºæ´ï¼Œä½†UGMCS-Netå¾—åˆ°çš„åˆ†å‰²ç»“æœåæ˜ äº†ç©ºæ´ç‰¹å¾ã€‚æˆ‘ä»¬é€‰æ‹©ä¿ç•™è¿™äº›ç‰¹å¾æœ‰ä¸¤ä¸ªåŸå› ï¼šï¼ˆ1ï¼‰å¸¸è§ç»“èŠ‚ç»„ç»‡çš„å¯†åº¦é«˜äºè‚ºå®è´¨ã€‚ä½†è‚ºç»“èŠ‚å†…çš„ç©ºè…”å¯†åº¦æä½ï¼Œç”šè‡³æ˜¯ç©ºçš„ã€‚\næˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬è§†ä¸ºç»“èŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ä¸è§†ä¸ºç»“èŠ‚çš„ä¸€éƒ¨åˆ†ã€‚ (2) åˆ†å‰²å›¾åº”æä¾›æ›´å¤šæœ‰å…³ç»“èŠ‚ç‰¹å¾çš„ä¿¡æ¯ã€‚ç©ºè…”æ˜¯é‡è¦çš„ç‰¹å¾ï¼Œå› æ­¤ä¿ç•™è¿™äº›ç©ºè…”æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ cv2.findContours ç­‰æ–¹æ³•è½»æ¾å»é™¤é¢„æµ‹ä¸­çš„ç©ºæ´ã€‚\nè¡¨IIï¼ŒUGMCS-Netå¯¹äºU-Netã€Attention UNetã€UGS-Netåœ¨Diceå’ŒIoUåˆ†æ•°ä¸­çš„på€¼è¿œå°äº0.05ï¼Œå¹¶ä¸”tå€¼çš„ç»å¯¹å€¼è¾ƒå¤§ï¼Œè¡¨æ˜UGMCS-Netåœ¨æ€§èƒ½ä¸Šæ˜æ˜¾ä¼˜äºU-Netã€Attention U-Netå’ŒUGS-Netã€‚\nPå€¼ (P-value)ï¼šåœ¨ç»Ÿè®¡åˆ†æä¸­ï¼ŒPå€¼ç”¨äºé‡åŒ–ç»“æœå‘ç”Ÿçš„æ¦‚ç‡ï¼Œå‡è®¾é›¶å‡è®¾ï¼ˆé€šå¸¸æ˜¯æ— æ•ˆå‡è®¾ï¼Œå¦‚ä¸¤ç»„ä¹‹é—´æ— å·®å¼‚ï¼‰ä¸ºçœŸã€‚åœ¨åŒ»å­¦å›¾åƒåˆ†æçš„ç ”ç©¶ä¸­ï¼Œå¦‚æœæ¶‰åŠåˆ°ç»Ÿè®¡æ£€éªŒï¼ˆä¾‹å¦‚ï¼Œæ¯”è¾ƒä¸¤ç§åˆ†å‰²æ–¹æ³•çš„æ€§èƒ½ï¼‰ï¼ŒPå€¼å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¿™ç§æ¯”è¾ƒçš„æ˜¾è‘—æ€§æ°´å¹³ã€‚ Vå€¼ï¼šè¿™ä¸ªæœ¯è¯­åœ¨åŒ»å­¦å›¾åƒåˆ†æä¸­ä¸å¸¸è§ï¼Œå¯èƒ½æŒ‡çš„æ˜¯ç‰¹å®šç ”ç©¶æˆ–æŠ€æœ¯ä¸­ä½¿ç”¨çš„ä¸€ä¸ªç‰¹å®šå‚æ•°æˆ–åº¦é‡ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä»£è¡¨ä½“ç§¯ï¼ˆVolumeï¼‰çš„åº¦é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†æå™¨å®˜å¤§å°æˆ–è‚¿ç˜¤ä½“ç§¯æ—¶ã€‚åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒå¯èƒ½æœ‰ä¸åŒçš„å«ä¹‰ã€‚ ä¸Šé¢çš„å®éªŒæ˜¯åŸºäºæ³¨é‡Šé›†ä¸­çš„ç¬¬ä¸€ä¸ªæ³¨é‡ŠLabel1 ã€‚ä¸ºäº†æ¶ˆé™¤æ©ç é€‰æ‹©çš„å½±å“ï¼Œæˆ‘ä»¬è¿˜æä¾›äº† U-Netã€Attention U-Netã€UGS-Net å’Œ UGMCS-Net åœ¨æ ‡æ³¨é›†ä¸­çš„ç¬¬äºŒä¸ªæ ‡ç­¾ Label2 ä¸Šçš„æ€§èƒ½ã€‚è¡¨IIIä¸­åˆ—å‡ºçš„å®éªŒç»“æœè¡¨æ˜UGMCS-Netåœ¨Label2ä¸Šä¿æŒäº†å…¶ä¼˜è¶Šçš„æ€§èƒ½ã€‚è¿™æ„å‘³ç€æ‰€æå‡ºçš„æ–¹æ³•å¯ä»¥åœ¨ä¸åŒçš„æ©æ¨¡é€‰æ‹©ä¸Šä¿æŒç¨³å®šçš„æ€§èƒ½ã€‚åœ¨ä¼ ç»Ÿçš„è®­ç»ƒæ–¹æ³•ä¸­ï¼Œæ¯ä¸ªç»“èŠ‚éƒ½è¢«åˆ†é…ä¸€ä¸ªå•ä¸€çš„æ©æ¨¡ï¼Œæ— æ³•ä¸ºå…·æœ‰å¤æ‚ç»“æ„ç‰¹å¾çš„ç»“èŠ‚æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚\nåœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼Œæ¯ä¸ªç»“èŠ‚ä¸ 2-4 ä¸ªæ©æ¨¡ç›¸å…³è”ã€‚é€šè¿‡æ•´åˆå¤šé‡æ³¨é‡ŠèåˆæŸå¤±ï¼Œæˆ‘ä»¬å°†æ›´å…¨é¢çš„ä¿¡æ¯æ³¨å…¥åˆ°å­¦ä¹ è¿‡ç¨‹ä¸­ã€‚å®ƒå¯¹äºåˆ†å‰²å…·æœ‰å¤æ‚ç»“æ„å’Œä½å¯†åº¦çº¹ç†çš„ç»“èŠ‚ç‰¹åˆ«æœ‰ç›Šã€‚å› æ­¤ï¼Œå¤šé‡æ³¨é‡ŠèåˆæŸå¤±æ˜¾ç€æé«˜äº†æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…·æœ‰å¤æ‚ç»“æ„çš„ç»“èŠ‚ã€‚\n4.3 Uncertain Region Prediction é™¤äº†èƒ½å¤Ÿåˆ†å‰²ç»“èŠ‚ä¹‹å¤–ï¼ŒUGMCS-Net è¿˜å¯ä»¥é¢„æµ‹æ›´æœ‰å¯èƒ½æ˜¯ç»“èŠ‚ç»„ç»‡çš„åŒºåŸŸå’Œå¯èƒ½æ€§è¾ƒä½çš„åŒºåŸŸã€‚å›¾ 7 è¯´æ˜äº†é¢„æµ‹ç»“æœ $\\cup(X)$å’Œ$\\cap(X)$ã€æœ€ç»ˆåˆ†å‰²ç»“æœ $X_S$ ä»¥åŠç”Ÿæˆçš„ MCMâ€™ã€‚åœ¨MCMâ€™å’ŒMCM+UGSNetä¸­ï¼Œçº¢è‰²è¡¨ç¤ºé«˜ç½®ä¿¡åº¦åŒºåŸŸï¼Œè“è‰²è¡¨ç¤ºä½ç½®ä¿¡åº¦åŒºåŸŸï¼Œç»¿è‰²å¯¹åº”äºæœ€ç»ˆåˆ†å‰²$X_S$ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ$X_S$åº”æœ‰æ•ˆåœ°åœ¨é«˜ç½®ä¿¡åº¦å’Œä½ç½®ä¿¡åº¦åŒºåŸŸä¹‹é—´å–å¾—å¹³è¡¡ã€‚\nï¼ˆé¢„æµ‹äº¤é›†$\\cap(X)$ã€é¢„æµ‹å¹¶é›†$\\cup(X)$ã€æœ€ç»ˆåˆ†å‰²$X_S$ å’Œ MCM ç”± UGMCS-Net ç”Ÿæˆã€‚ MCM ä¸­çš„é¢œè‰²ç”¨äºæ›´å¥½çš„å¯è§†åŒ–ï¼Œçº¢è‰²è¡¨ç¤º$\\cap(X)$ï¼Œè“è‰²è¡¨ç¤º$\\cup(X)$ã€‚æ­¤å¤–ï¼Œæœ€ç»ˆçš„åˆ†å‰²åœ¨ MCM ä¸­è¡¨ç¤ºå¹¶æ ‡è®°ä¸ºç»¿è‰²ä»¥æ–¹ä¾¿æ¯”è¾ƒã€‚çº¢è‰²æ¡†è¡¨ç¤ºä¸æ˜“åŒºåˆ†çš„ç»“èŠ‚åŒºåŸŸæˆ–ç‰¹å¾ã€‚æœ€åä¸€æ æ˜¯ç›¸åº”ç»“èŠ‚çš„ç›´å¾„ï¼ˆä»¥æ¯«ç±³ä¸ºå•ä½ï¼‰)\næ ¹æ®å›¾ 7ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆåˆ†å‰²ç»“æœä½äºé«˜ç½®ä¿¡åº¦åŒºåŸŸå’Œä½ç½®ä¿¡åº¦åŒºåŸŸè¿™ä¸¤ç§æç«¯æƒ…å†µä¹‹é—´ã€‚è¿™äº›ä¸­é—´ç»“æœè¡¨æ˜ï¼ˆ1ï¼‰æˆ‘ä»¬çš„é¢„æµ‹è®¤è¯†åˆ°æ‰€æœ‰æ½œåœ¨çš„æ³¨é‡Šï¼Œå¹¶ä¸”ï¼ˆ2ï¼‰é¢„æµ‹è¢«é™åˆ¶åœ¨$\\cap(X)$å’Œ$\\cup(X)$ä¹‹é—´ã€‚\nå…·ä½“æ¥è¯´ï¼Œåœ¨è‚ºç»“èŠ‚ç‰¹å¾åˆ†å‰²ä¸­ä½¿ç”¨MCMå…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼Œå¯ä»¥æ›´å¥½åœ°æ˜¾ç¤ºç»“èŠ‚çš„è¯­ä¹‰ç‰¹å¾ï¼šï¼ˆ1ï¼‰MCMå¯ä»¥æ›´å¥½åœ°çªå‡ºç»“èŠ‚çš„æ˜¾ç€ç©ºè…”ç‰¹å¾ï¼ˆå›¾7.ï¼ˆgï¼‰ï¼ˆhï¼‰ï¼‰ã€‚ä¸å…¶ä»–æ–¹æ³•ç›¸æ¯”ï¼ŒUGMCS-Net çš„é¢„æµ‹æ©æ¨¡ä¸Šçš„ç»“èŠ‚è…”ç‰¹å¾æ›´åŠ æ˜æ˜¾ã€‚è¿™æ˜¯ç”±äºUGMCS-Netèƒ½å¤Ÿåœ¨äº¤å‰æ©æ¨¡$\\cap(GT)$å’Œè”åˆæ©æ¨¡$\\cup(GT)$çš„æŒ‡å¯¼ä¸‹æ•è·ç»“èŠ‚ç»„ç»‡çš„å¯†åº¦å·®å¼‚ï¼Œè¿™æœ‰åŠ©äºä¿ç•™ç»“èŠ‚è…”çš„æ›´å¤šç‰¹å¾ã€‚\n(2)MCMå¯ä»¥æ›´å¥½åœ°åˆ†å‰²æ¯›åˆºå¾è±¡ï¼Œè¿™æ˜¯è¯Šæ–­è‰¯æ¶æ€§è‚ºç»“èŠ‚çš„é‡è¦ç‰¹å¾(å›¾7.(a)-(f))ã€‚é’ˆçŠ¶ç»“æ„æ˜¯ç”±ç»“èŠ‚ä¾µå…¥å‘¨å›´ç»„ç»‡å¼•èµ·çš„æ˜ŸçŠ¶å˜å½¢ï¼Œé€šå¸¸æ˜¯ä½å¯†åº¦çš„å¹¶åˆ†å¸ƒåœ¨ç»“èŠ‚è¾¹ç¼˜å‘¨å›´ã€‚è¿™ä¸€ç‰¹å¾æ˜¯ä¼ ç»Ÿæ·±åº¦å­¦ä¹ æ–¹æ³•éš¾ä»¥åˆ†å‰²çš„ã€‚ UGMCS-Netåœ¨union mask $\\cup(GT)$çš„æŒ‡å¯¼ä¸‹å¯ä»¥æ›´åŠ å…³æ³¨ç»“èŠ‚è¾¹ç•Œç‰¹å¾ï¼Œä»è€Œå¯¹åˆ†å¸ƒåœ¨ç»“èŠ‚è¾¹ç•Œçš„æ¯›åˆºæœ‰æ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚\nï¼ˆ3ï¼‰MCMå¯ä»¥æ›´å¥½åœ°åˆ†å‰²ç»“èŠ‚çš„ä½å¯†åº¦ç»„ç»‡ï¼ˆå›¾7.ï¼ˆiï¼‰-ï¼ˆlï¼‰ï¼‰ï¼Œè¯¥åŒºåŸŸå¸¸è§äºç£¨ç»ç’ƒç»“èŠ‚ï¼Œæ˜¯é€ æˆä¸“å®¶æ ‡è®°å·®å¼‚çš„ä¸»è¦åŒºåŸŸã€‚ UGMCSNeté€šè¿‡å¯¹æ³¨é‡Šé›†GTå’Œunion mask $\\cup(GT)$çš„ç ”ç©¶ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°è¯†åˆ«ä½å¯†åº¦ç»„ç»‡ï¼Œè¿™å¯¹äºç£¨ç»ç’ƒç»“èŠ‚çš„è¯Šæ–­å¾ˆæœ‰å¸®åŠ©ã€‚\nç”±äºLCæ©æ¨¡å°ºå¯¸è¾ƒå°ï¼Œä¼ ç»Ÿçš„å®šé‡è¯„ä¼°æŒ‡æ ‡å¦‚DSCå’ŒIoUä¸è¶³ä»¥è¡¡é‡MCMçš„é¢„æµ‹è´¨é‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†é¢„æµ‹çš„ HC å’Œ LC æ©æ¨¡çš„ HU åˆ†å¸ƒä¸å®é™…çš„ HC å’Œ LC æ©æ¨¡è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬å‡è®¾UGMCS-Netèƒ½å¤Ÿåˆç†åœ°é¢„æµ‹ä¸åŒåŒºåŸŸçš„ä¸ç¡®å®šæ€§ç¨‹åº¦ã€‚å› æ­¤ï¼Œé¢„æµ‹çš„ HC å’Œ LC æ©æ¨¡çš„ HU å€¼åˆ†å¸ƒåº”ä¸å®é™…åˆ†å¸ƒç›¸ä¼¼ã€‚å›¾8æ˜¾ç¤ºé¢„æµ‹æ›²çº¿ä¸å®é™…æ›²çº¿å»åˆè¾ƒå¥½ï¼Œè¡¨æ˜æˆ‘ä»¬é¢„æµ‹çš„åŒºåŸŸä¸ç¡®å®šæ€§æ°´å¹³åœ¨ç»Ÿè®¡ä¸Šæ˜¯å¯é çš„ã€‚\n4.4 Ablation Study æˆ‘çœŸçš„è¦è¢«è¿™ä¸ªå·¥ä½œé‡ç»™å“é¼ äº†ï¼Œå¤ªèƒ½åšå®éªŒäº†æŠŠ\næ¨¡å—çš„æ¶ˆèç ”ç©¶ï¼šå¦‚æœä¸æŒ‡å‡ºå®ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¯ä¸ªéƒ¨åˆ†è¿›è¡Œäº”å€éªŒè¯ã€‚ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨å¤šä¸ªæ³¨é‡Šçš„ä¿¡æ¯å¹¶å¢å¼º $R_{LC}$ ã€ $R_{HC}$ å’Œ $R{final}$ ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬ç”¨å¤šæ³¨é‡ŠèåˆæŸå¤±å’Œäº¤å‰è”åˆçº¦æŸæ¨¡å—æ›´æ–°äº† UGMCS-Netã€‚ä¸ºäº†è¿›ä¸€æ­¥è¯æ˜è¿™ä¸¤ä¸ªæ¨¡å—çš„è´¡çŒ®ï¼Œæˆ‘ä»¬åŸºäº UGMCS-Net æ„å»ºäº† UGMCS-$Î¦_a$ã€UGMCS-$Î¦_b$ã€UGMCS-$Î¦_a$+$Î¦_b$ å’Œ UGMCS-IUCM è¿›è¡Œæ¶ˆèå®éªŒã€‚åœ¨UGMCS-$Î¦_a$ä¸­ï¼Œå¤šæ³¨é‡ŠèåˆæŸå¤±ä»…åº”ç”¨äº$\\cup(X)$;åœ¨UGMCS-$Î¦_b$ä¸­ï¼ŒMultiple Annotation Fusion Lossä»…åº”ç”¨äºç½‘ç»œXSçš„æœ€ç»ˆè¾“å‡ºï¼›åœ¨UGMCS-$Î¦_a$+$Î¦_b$ ä¸­ï¼Œå¤šé‡æ³¨é‡ŠèåˆæŸå¤±åº”ç”¨äº$\\cup(X)$å’Œ$X_S$ï¼›åœ¨UGMCS-IUCMä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨USG-Netä¸­çš„Intersection-Unionçº¦æŸæ¨¡å—ï¼Œä½†æ²¡æœ‰å¤šé‡æ³¨é‡ŠèåˆæŸå¤±ã€‚\næˆ‘ä»¬çš„ UGMCS-Net åŠå…¶å››ç§å˜ä½“çš„æ€§èƒ½åˆ—äºè¡¨ IVï¼Œâ€œ-â€è¡¨ç¤º Attention U-Netã€‚ V1æ˜¯æŒ‡æ²¡æœ‰IUCMå’Œå¤šé‡æ³¨é‡ŠèåˆæŸå¤±çš„UGS-Netï¼Œå®ƒä½œä¸ºå…¶ä»–å˜ä½“çš„åŸºç¡€ç½‘ç»œã€‚\nç»“æœè¡¨æ˜ï¼šï¼ˆ1ï¼‰UGMCS-$Î¦_a$ã€UGMCS-$Î¦_b$ç½‘ç»œç›¸å¯¹äºUGMCS-Netçš„æ€§èƒ½æ”¹è¿›è¡¨æ˜ï¼Œæ‰€æœ‰æ ‡æ³¨ä¿¡æ¯çš„èåˆå¯ä»¥ä½¿ç½‘ç»œæ›´å‡†ç¡®åœ°æ•è·ç»“èŠ‚åŒºåŸŸå¹¶è·å¾—æ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚ (2) UGMCS-$Î¦_a$+$Î¦_b$ ç½‘ç»œçš„ DSCã€IoU å’Œ NSD é«˜äº UGMCS-$Î¦_a$ã€UGMCS-$Î¦_b$ç½‘ç»œï¼Œè¡¨æ˜åŒæ—¶å¯¹ UAM å’Œæœ€ç»ˆè¾“å‡ºä½¿ç”¨å¤šé‡æ³¨é‡ŠèåˆæŸå¤±ä¼˜äºå•ç‹¬ä½¿ç”¨å…¶ä¸­ä¹‹ä¸€ã€‚ (3) æˆ‘ä»¬çš„ UGMCS-Net ä¼˜äºUGMCS-$Î¦_a$+$Î¦_b$å’Œ UGMCS-IUCMï¼Œè¯æ˜äº†äº¤é›†å¹¶é›†çº¦æŸæ¨¡å—çš„æœ‰æ•ˆæ€§ã€‚å°½ç®¡ä»…æ·»åŠ äº¤é›†-å¹¶é›†çº¦æŸæ¨¡å—ï¼ˆUGMCS-IUCMï¼‰æ—¶ç½‘ç»œçš„å®šé‡æ€§èƒ½ç•¥æœ‰ä¸‹é™ï¼Œä½†è§‚å¯Ÿåˆ°äº†æ˜¾ç€çš„å®šæ€§æ”¹è¿›ï¼Œè¿™å°†åœ¨åé¢è®¨è®ºã€‚æ­¤å¤–ï¼ŒUGMCS-Netçš„ä¼˜è¶Šæ€§èƒ½è¡¨æ˜ï¼Œå¤šé‡æ³¨é‡ŠèåˆæŸå¤±å’Œäº¤å‰è”åˆçº¦æŸæ¨¡å—å¯ä»¥ç›¸äº’å¢å¼ºï¼Œçº¦æŸä¸ç¡®å®šæ€§å¹¶ä¿ƒè¿›æ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚\nä¸ºäº†è¿›ä¸€æ­¥éªŒè¯å¤šæ³¨é‡ŠèåˆæŸå¤±å’Œäº¤å‰è”åˆçº¦æŸæ¨¡å—çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬åœ¨å›¾ 9 ä¸­ä½¿ç”¨ Grad-CAM [36]ã€[37] æ¼”ç¤ºäº†ç‰¹å¾å›¾å¯è§†åŒ–ã€‚æ¯ç§æƒ…å†µä¸‹çš„ç»“æœä»£è¡¨äº†ç½‘ç»œçš„æœ€ç»ˆé¢„æµ‹ã€‚ M3ã€M2å’ŒM1åˆ†åˆ«è¡¨ç¤ºä¸åŒç½‘ç»œé…ç½®ä¸‹å€’æ•°ç¬¬ä¸‰ä¸ªã€ç¬¬äºŒä¸ªå’Œç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„è§†è§‰ç‰¹å¾å›¾ã€‚åŸºäºå›¾9ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼šï¼ˆ1ï¼‰å½“å°†å¤šé‡æ³¨é‡ŠèåˆæŸå¤±åº”ç”¨äº$\\cup(X)$æˆ–$X_S$æ—¶ï¼Œç½‘ç»œå¯¹ä½å¯†åº¦ç»„ç»‡çš„è¯†åˆ«èƒ½åŠ›æ˜¾ç€æé«˜ï¼ˆUGMCS-$Î¦_a$å’ŒUGMCS-$Î¦_b$ï¼Œç»“èŠ‚A-D)ï¼› ï¼ˆ2ï¼‰$\\cup(X)$æˆ–$X_S$ä¸­åŒæ—¶ä½¿ç”¨Multiple Annotation Fusion Lossï¼Œå¯ä»¥åœ¨æé«˜å¯¹ä½å¯†åº¦ç»„ç»‡çš„æ•æ„Ÿæ€§çš„åŸºç¡€ä¸Šï¼Œä½¿ç½‘ç»œå‹¾å‹’å‡ºç»“èŠ‚è¾¹ç•Œæ›´åŠ æ¸…æ™°ï¼ˆUGMCS-$Î¦_a$+$Î¦_b$ç½‘ç»œï¼Œç»“èŠ‚A-Dï¼‰ã€‚ (3) IntersectionUnion Constraining Moduleä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ æ›´å¤šçš„è¾¹ç•Œç‰¹å¾ï¼Œä¾‹å¦‚spiculationï¼ˆæ¯›åˆºï¼‰ï¼ˆUGMCS-IUCMç½‘ç»œï¼ŒNodule A-Cï¼‰ã€‚ ï¼ˆ4ï¼‰å½“åŒæ—¶ä½¿ç”¨Multiple Annotation Fusion Losså’ŒIntersection-Union Constraining Moduleæ—¶ï¼Œç½‘ç»œæ³¨æ„åŠ›è½¬ç§»åˆ°ç»“èŠ‚è¾¹ç•Œï¼Œå‹¾ç”»å‡ºæ›´åŠ åˆç†å®Œæ•´çš„ç»“èŠ‚åŒºåŸŸï¼ˆUGMCS-Netï¼ŒNodule A-Eï¼‰ã€‚\nå¦‚å›¾9æ‰€ç¤ºï¼Œåœ¨IUCMçš„å¸®åŠ©ä¸‹ï¼Œç½‘ç»œå¯ä»¥é’ˆå¯¹å¤æ‚ç»“èŠ‚è·å¾—æ›´è¯­ä¹‰åŒ–ã€æ›´åˆç†çš„åˆ†å‰²ç»“æœã€‚ç„¶è€Œï¼Œå¦‚è¡¨IVæ‰€ç¤ºï¼Œä¸UGMCS-$Î¦_a$+$Î¦_b$ç›¸æ¯”ï¼ŒUGMCS-Netåœ¨DSCã€IoUå’ŒNSDä¸Šçš„æ€§èƒ½å¢ç›Šè¾ƒå¼±ã€‚æˆ‘ä»¬è®¤ä¸ºé€ æˆè¿™ç§ç°è±¡çš„åŸå› æœ‰3ä¸ªï¼šï¼ˆ1ï¼‰IUCMä¸“æ³¨äºæé«˜å¤æ‚ç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ï¼Œä¸æµ‹é‡ä¸Šçš„æ”¹è¿›ç›¸æ¯”ï¼ŒIUCMä½¿å¾—æ¨¡å‹å¯¹åˆ†å‰²ç»“æœçš„æ€§èƒ½æå‡æ›´åŠ æ˜¾ç€ï¼ˆè¿›ä¸€æ­¥éªŒè¯åœ¨ç¬¬ IV-E èŠ‚ï¼‰ã€‚\nï¼ˆ2ï¼‰å¤æ‚ç»“èŠ‚ä»…å ç»“èŠ‚æ€»æ•°çš„ä¸€å°éƒ¨åˆ†ï¼Œå› æ­¤IUCMæ— æ³•æ˜¾ç€æé«˜æ¨¡å‹åœ¨å„é¡¹æŒ‡æ ‡ä¸Šçš„å¾—åˆ†ã€‚ (3)æ•°æ®é›†ä¸­ä»ç„¶å­˜åœ¨ä¸€äº›å¤±è´¥æ¡ˆä¾‹ã€‚å¦‚å›¾10æ‰€ç¤ºï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒUGMCS-IUCMå’ŒUGMCS-Netè·å¾—çš„åˆ†å‰²æ©æ¨¡åŒ…å«æ›´å¤šçš„ç»“èŠ‚ç»„ç»‡å¹¶ä¸”æ˜¯æ›´å‡†ç¡®çš„ç—…å˜åŒºåŸŸï¼Œä½†å®ƒä»¬çš„DSCåˆ†æ•°è¾ƒä½ã€‚\nç”±äºä¸åŒåŒ»ç”Ÿé¢†åŸŸçš„çŸ¥è¯†åå·®ä¼šå½±å“groundtruthï¼Œå› æ­¤å¯¹äºåˆ†å‰²ä»»åŠ¡æ¥è¯´ï¼Œè·å¾—æ›´å‡†ç¡®ã€æ›´åˆç†çš„åˆ†å‰²æ©æ¨¡é€šå¸¸æ¯”æ›´é«˜çš„åº¦é‡åˆ†æ•°æ›´æœ‰æ„ä¹‰ã€‚\nè¡¨Væ˜¾ç¤ºäº†åŠ å…¥UAMå’ŒIUCMåæ¨¡å‹å¤æ‚åº¦çš„å¢åŠ ã€‚æ˜¾ç„¶ï¼ŒUAM å’Œ IUCM å¯ä»¥ä½¿æ¨¡å‹ä»¥å¾ˆå°‘çš„è®¡ç®—æˆæœ¬è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚\nBackbone çš„æ¶ˆèç ”ç©¶ï¼šæˆ‘ä»¬æµ‹è¯• U-Net å’Œ R2U-Net ä½œä¸ºä¸‰ä¸ªæ¨¡å—çš„éª¨å¹²ã€‚å¦‚è¡¨å…­æ‰€ç¤ºï¼Œä»¥U-Netä¸ºéª¨å¹²çš„æ¨¡å‹åœ¨DSCã€IoUå’ŒNSDä¸Šåˆ†åˆ«è·å¾—äº†87.04%ã€78.07%å’Œ94.50%çš„åˆ†æ•°ã€‚\nä»¥R2U-Netä¸ºéª¨å¹²çš„æ¨¡å‹åœ¨DSCã€IoUå’ŒNSDä¸Šåˆ†åˆ«è·å¾—äº†86.20%ã€76.82%å’Œ93.75%çš„ç»“æœã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæ‰€æå‡ºçš„ç‰¹å¾æå–æ¨¡å—ã€ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—å’Œäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—æ˜¯å³æ’å³ç”¨çš„ã€‚\næˆ‘ä»¬ä¹‹å‰çš„å·¥ä½œè¯„ä¼°äº† nnU-Net [22] ä½œä¸ºéª¨å¹²ç½‘ç»œã€‚\nè¿™ä¸ªç½‘ç»œåœ¨è¿™ä¸ªä»»åŠ¡ä¸­æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼šï¼ˆ1ï¼‰å®ƒå ç”¨äº†å¤ªå¤šçš„è®¡ç®—èµ„æºï¼Œï¼ˆ2ï¼‰æˆ‘ä»¬åªæœ‰ 1860 ä¸ªç»“èŠ‚ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è¿‡åº¦æ‹Ÿåˆã€‚ä¸ºäº†å¹³è¡¡è®¡ç®—èµ„æºå’Œæ€§èƒ½å¢ç›Šï¼Œæˆ‘ä»¬åœ¨æœ¬å·¥ä½œä¸­é€‰æ‹© Attention U-Netã€‚\näº¤å‰ç‚¹è”åˆçº¦æŸæ¨¡å—ä¸­æ»¤æ³¢å™¨çš„æ¶ˆèç ”ç©¶ï¼šåœ¨ç¬¬ III-C èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº† Otsu å¯¹å¯†åº¦ç‰¹å¾çš„æ•æ„Ÿæ€§ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«é«˜å¯†åº¦ç»„ç»‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ©ç”¨ Otsu çš„æ–¹æ³•æ¥æå– $R_{HC}$ çš„ç‰¹å¾ã€‚ç›¸åï¼ŒGaborå¯¹å›¾åƒè¾¹ç¼˜æ•æ„Ÿå¹¶æä¾›æœ‰æ•ˆçš„æ–¹å‘å’Œå°ºåº¦é€‰æ‹©ç‰¹å¾ï¼Œè¢«é€‰æ‹©ç”¨äº $R_{LC}$çš„ç‰¹å¾æå–ã€‚åœ¨è¿™äº›éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ¶‰åŠ Fold1 ä¸Š IntersectionUnion çº¦æŸæ¨¡å—å†…çš„äº”ä¸ªè¿‡æ»¤å™¨è®¾ç½®çš„å®éªŒã€‚è¡¨ VII æ¦‚è¿°äº†è¿™äº›è®¾ç½®ã€‚å¦‚è¡¨ VII æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„æœ€ç»ˆé…ç½®äº§ç”Ÿäº†æœ€é«˜çš„ DSC åˆ†æ•°ã€‚\næˆ‘ä»¬åœ¨å›¾ 11 ä¸­æä¾›äº† $R_{LC}^{\\prime}$ å’Œ $R_{HC}^{\\prime}$ çš„ç‰¹å¾å¯è§†åŒ–ã€‚å¯ä»¥çœ‹å‡ºï¼Œ $R_{LC}^{\\prime}$ çš„å¯è§†åŒ–æ›´å¤šåœ°é›†ä¸­åœ¨ç»“èŠ‚çš„è¾¹ç¼˜ï¼Œå…¶ä¸­åŒ…å«æ›´å¤šçš„ä½ç½®ä¿¡åº¦åŒºåŸŸã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ $R_{HC}^{\\prime}$ çš„å¯è§†åŒ–æ›´å…³æ³¨ç»“èŠ‚çš„æ ¸å¿ƒï¼Œå…·æœ‰æ›´é«˜çš„åˆ†å‰²ç½®ä¿¡åº¦ã€‚è¿™äº›å¯è§†åŒ–ç»“æœé‡æ–°è¯æ˜äº†æˆ‘ä»¬è¿‡æ»¤å™¨è®¾è®¡çš„æœ‰æ•ˆæ€§ã€‚\nå‚æ•°æ¶ˆèç ”ç©¶ï¼šåœ¨æ–¹ç¨‹ 4 ä¸­ï¼Œå­˜åœ¨ä¸‰ä¸ªæ‰‹åŠ¨è®¾ç½®çš„å‚æ•°ï¼šÎ±1 æŒ‡å®šä¸º 0.5ï¼ŒÎ±2 æŒ‡å®šä¸º 0.5ï¼ŒÎ±3 æŒ‡å®šä¸º 1ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº”é‡éªŒè¯å¹¶è¯´æ˜è¿™äº›å‚æ•°é€‰æ‹©èƒŒåçš„åŸºæœ¬åŸç†ã€‚\nå¦‚è¡¨VIIIæ‰€ç¤ºï¼Œå½“Î±1è®¾ç½®ä¸º0.5ï¼ŒÎ±2è®¾ç½®ä¸º0.5ï¼ŒÎ±3è®¾ç½®ä¸º1æ—¶ï¼Œæ‰€æå‡ºçš„æ–¹æ³•è¾¾åˆ°å…¶å³°å€¼æ€§èƒ½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒÎ±3ä»£è¡¨æœ€ç»ˆåˆ†å‰²çš„æƒé‡ï¼Œè¿™æ„å‘³ç€XSåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬å¯¹ä¸‰ä¸ªåˆ†æ”¯çš„æ¦‚ç‡å›¾åŠ æƒå¹³å‡èåˆè¿›è¡Œäº†å®éªŒï¼Œå¸Œæœ›ç½‘ç»œèƒ½å¤Ÿä¸ºIUCMä¸­çš„æ¯ä¸ªåˆ†æ”¯é€‰æ‹©åˆé€‚çš„æƒé‡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸ $R_{Uni}$ å¯¹åº”çš„åˆ†æ”¯å¯ä»¥ä¸ºç»“èŠ‚åˆ†å‰²æä¾›æ›´é€šç”¨çš„ç‰¹å¾ï¼Œå¹¶ä¸”æ¯”å…¶ä»–ä¸¤ä¸ªåˆ†æ”¯æ˜¾å¾—â€œæ›´å¼ºâ€ã€‚å› æ­¤ï¼Œå…¶ä»–ä¸¤ä¸ªåˆ†æ”¯çš„æƒé‡å¾€å¾€ä¼šå‡å°‘åˆ° 0ã€‚æ ¹æ®è¿™äº›è§‚å¯Ÿç»“æœï¼Œæˆ‘ä»¬é€‰æ‹©ç›´æ¥èåˆæ¦‚ç‡å›¾ã€‚\n4.5 Complex-Nodule Validation UGMCS-Net ä»å¯èƒ½å¯¼è‡´åˆ†å‰²ä¸ç¡®å®šæ€§çš„åŒºåŸŸå­¦ä¹ ç‰¹å¾ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°åˆ†å‰²å…·æœ‰å¤§çš„ä½å¯†åº¦åŒºåŸŸæˆ–å¤æ‚ç»“æ„çš„ç»“èŠ‚ã€‚ä¸ºäº†æ›´å¥½åœ°è¯æ˜å…¶å¯¹ U-Net éš¾ä»¥åˆ†å‰²çš„ç»“èŠ‚çš„æ”¹è¿›ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª Complex Nodule Validationã€‚åŸºäºäº”é‡éªŒè¯U-Netï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥é€‰æ‹©äº†DSCåˆ†æ•°ä½äº60ï¼…ã€70ï¼…å’Œ80ï¼…çš„ä¸‰ç»„ç»“èŠ‚ã€‚ç„¶åä½¿ç”¨ç›¸åŒçš„æ•°æ®è®¾ç½®è®­ç»ƒ Attention U-Netã€UGMCS-$Î¦_a$+$Î¦_b$ã€UGMCS-IUCM å’Œ UGMCS-Netï¼Œä»¥å†æ¬¡æµ‹è¯•è¿™äº›ç»“èŠ‚å¹¶æ¯”è¾ƒ DSC å’Œ IoU åˆ†æ•°ã€‚\nUGMCS-Net åœ¨å¤æ‚ç»“èŠ‚ä¸Šçš„æ€§èƒ½æå‡æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ä¸Attention U-Netç›¸æ¯”ï¼Œå¯¹äºU-Netä¸ŠDSCåˆ†æ•°ä½äº60%çš„ç»“èŠ‚ï¼ŒUGMCS-$Î¦_a$+$Î¦_b$å¯¼è‡´å¹³å‡DSCåˆ†æ•°æé«˜1.58%ï¼ŒUGMCS-IUCMä½¿å¹³å‡DSCåˆ†æ•°æé«˜5.12%ï¼ŒUGMCS-å¹³å‡ DSC å¾—åˆ†å‡€äº§é‡å¢åŠ äº† 5.45%ã€‚å¯¹äº U-Net ä¸Š DSC å¾—åˆ†åœ¨ 60% åˆ° 70% ä¹‹é—´çš„ç»“èŠ‚ï¼ŒUGMCS-$Î¦_a$+$Î¦_b$ã€UGMCS-IUCM å’Œ UGMCS-Net çš„å¹³å‡ DSC å¾—åˆ†åˆ†åˆ«æé«˜äº† 0.69%ã€3.11% å’Œ 5.07%ã€‚åŒæ ·ï¼Œå¯¹äº U-Net ä¸Š DSC åˆ†æ•°åœ¨ 70% è‡³ 80% ä¹‹é—´çš„ç»“èŠ‚ï¼ŒUGMCS-$Î¦_a$+$Î¦_b$ã€UGMCS-IUCM å’Œ UGMCS-Net çš„å¹³å‡ DSC åˆ†æ•°ç›¸åº”æé«˜äº† 0.14%ã€1.52% å’Œ 1.64%ã€‚ä»ä¸Šè¿°å·®å¼‚å¯ä»¥çœ‹å‡ºï¼ŒUGMCS-IUCMå¯¹äºå¤æ‚ç»“èŠ‚æœ‰å¾ˆå¤§ç¨‹åº¦çš„æ€§èƒ½æå‡ã€‚æ ¹æ®è¡¨ä¸€ï¼Œæˆ‘ä»¬çš„ç½‘ç»œåœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šä»…å°† DSC æé«˜äº† 0.89%ï¼Œä½†ç›¸å¯¹äº U-Net ä¸Š DSC åˆ†æ•°ä½äº 60% çš„ç»“èŠ‚è€Œè¨€ï¼Œç›¸å¯¹äº Attention U-Net å…·æœ‰å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚è¿™æ˜¯å› ä¸ºå…·æœ‰å¤æ‚ç»“æ„çš„ç»“èŠ‚ä»…å æ‰€æœ‰æ•°æ®çš„ä¸€å°éƒ¨åˆ†ã€‚\nå›¾12æ˜¾ç¤ºäº†ä¸€äº›å¤æ‚ç»“èŠ‚çš„åˆ†å‰²ç»“æœã€‚çº¢è‰²ä¸‹æ ‡æ˜¯UGMCS-Netçš„åˆ†æ®µDSCï¼Œé»‘è‰²ä¸‹æ ‡æ˜¯UNetçš„DSCã€‚å¯ä»¥çœ‹å‡ºï¼ŒU-Netåˆ†å‰²DSCå¾—åˆ†ä½äº60%çš„ç»“èŠ‚æ˜¯ä¸€äº›ä½å¯†åº¦æˆ–æ¯›ç»ç’ƒç»„ç»‡ã€‚ UGMCS-Netåœ¨è¿™äº›ç»“èŠ‚ä¸­çš„æ˜¾ç€æ”¹è¿›è¡¨æ˜UGMCS-Netå¯ä»¥æ›´å¥½åœ°å­¦ä¹ ç»“èŠ‚ä½å¯†åº¦ç»„ç»‡çš„ç‰¹å¾å¹¶æ›´å‡†ç¡®åœ°åˆ†å‰²ä½å¯†åº¦ç»“èŠ‚ç—…å˜åŒºåŸŸã€‚å½“U-Netåˆ†å‰²DSCå¾—åˆ†ä½äº70%æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°é™¤äº†ä¸€äº›ä½å¯†åº¦ç»“èŠ‚å¤–ï¼Œä¸€äº›ç»“èŠ‚è¿˜å­˜åœ¨ä¸è§„åˆ™ç©ºæ´ã€æ¯›åˆºã€ç»„ç»‡å†…çªç„¶å‡ºç°äº®ç‚¹æˆ–è‚ºå£è¿‡äº®ã€‚ UGMCS-Netåœ¨è¿™äº›ç»“èŠ‚ä¸Šä»¤äººä¿¡æœçš„åˆ†å‰²æ€§èƒ½åæ˜ äº†UGMCS-Netå¯¹è¾¹ç•Œç‰¹å¾ã€å¯†åº¦å·®å¼‚çš„å­¦ä¹ èƒ½åŠ›ä»¥åŠè‰¯å¥½çš„æŠ—å™ªå£°èƒ½åŠ›ã€‚å½“U-Netåˆ†å‰²DSCå¾—åˆ†ä½äº80%æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°è®¸å¤šæ–°ç»“èŠ‚å…·æœ‰æ›´å¤šçš„å®ä½“ç»„ç»‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒUGMCS-Netå¯ä»¥å‡†ç¡®åœ°ç¡®å®šç»“èŠ‚åŒºåŸŸã€‚æ­¤å¤–ï¼Œå¯¹äºå¤§å¤šæ•°ç»“èŠ‚ï¼ŒUGMCS-Netçš„åˆ†å‰²ç»“æœåæ˜ äº†æ›´å¤šçš„è¯­ä¹‰ç‰¹å¾ï¼Œå…·æœ‰æ›´å¼ºçš„å¯è§£é‡Šæ€§ã€‚\nå¤æ‚ç»“èŠ‚éªŒè¯ä¸­çš„åˆ†å‰²æ€§èƒ½åˆ†æã€‚ UGMCS-$Î¦_a$+$Î¦_b$ã€UGMCS-IUCM å’Œ UGMCS-Net å¹³å‡ DSC å’Œ IoU åé¢æ˜¯ä¸ Attention U-Net ç›¸åº”åº¦é‡çš„å·®å€¼ï¼ˆç»¿è‰²æ•°å­—ï¼‰ã€‚æ‰€æœ‰æŒ‡æ ‡å‡ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚\nï¼ˆå¤æ‚ç»“èŠ‚éªŒè¯ï¼šè¯¥éªŒè¯æµ‹è¯•äº† UGMCS-Net å¯¹ U-Net éš¾ä»¥åˆ†å‰²çš„è‚ºç»“èŠ‚è¿›è¡Œä¸‰ä¸ªçº§åˆ«çš„åˆ†å‰²æ€§èƒ½ã€‚æ¯å¼ CTå›¾åƒçš„æœ€åä¸¤ä¸ªæ©æ¨¡åˆ†åˆ«æ˜¯UGMCS-Netå’ŒU-Netçš„åˆ†å‰²ç»“æœã€‚U-Netçš„åˆ†å‰²ç»“æœä»¥é»‘è‰²æ˜¾ç¤ºï¼ŒUGMCS-Netä»¥çº¢è‰²æ˜¾ç¤ºã€‚æ‰€æœ‰æŒ‡æ ‡å‡ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚ï¼‰\nDISCUSSIONS é•¿æœŸä»¥æ¥ï¼Œè‚ºç»“èŠ‚åˆ†å‰²çš„ä»»åŠ¡ä¸€ç›´è‡´åŠ›äºå®ç°é«˜ç²¾åº¦ï¼Œå…¶ä¸­ DSC æˆ– IoU æ˜¯ä¸»è¦ç›®æ ‡ã€‚ç„¶è€Œï¼Œè€ƒè™‘åˆ°è‚ºç»“èŠ‚å°ºå¯¸å°ä¸”ç»“æ„å¤æ‚ï¼Œå¦‚æœåˆ†å‰²ç»“æœä»¥ä¸åŒç½®ä¿¡åº¦çªå‡ºæ˜¾ç¤ºåŒºåŸŸï¼Œå¯èƒ½å¯¹æ”¾å°„ç§‘åŒ»ç”Ÿæ›´æœ‰å¸®åŠ©ã€‚é«˜ç½®ä¿¡åº¦åŒºåŸŸæä¾›äº†ç»“èŠ‚æˆ–è‚¿ç˜¤ç»„ç»‡çš„ä¸»è¦éƒ¨åˆ†ï¼Œè€Œä½ç½®ä¿¡åº¦åŒºåŸŸåˆ™åŒ…å«é‡è¦çš„ä½å¯†åº¦ç‰¹å¾ï¼Œä¾‹å¦‚æ¯›ç»ç’ƒçŠ¶å’Œæ¯›åˆºå¾ï¼Œæ”¾å°„ç§‘åŒ»ç”Ÿä¹Ÿåº”æ³¨æ„è¿™äº›ç‰¹å¾ã€‚\næ‰€æå‡ºçš„æ–¹æ³•æ—¨åœ¨æä¾›å¯¹ä¸´åºŠè¯Šæ–­æ›´æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æ”¹è¿› DSCã€‚å®ƒå¹¶ä¸å¯»æ±‚å–ä»£åŒ»ç”Ÿçš„ä¸´åºŠä½œç”¨ï¼Œè€Œæ˜¯é€šè¿‡å…è®¸ä»–ä»¬åˆ©ç”¨äººå·¥æ™ºèƒ½æ–¹æ³•çš„ä¼˜åŠ¿æ¥è¡¥å……åŒ»ç”Ÿçš„ä¸´åºŠä½œç”¨ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œè¿™æ˜¯å°†äººå·¥æ™ºèƒ½èå…¥ä¸´åºŠå®è·µçš„æ›´å¥½æ–¹æ³•ã€‚\n5.1 Data Requirement æˆ‘ä»¬çš„æ–¹æ³•å¹¶ä¸éœ€è¦æ¯ä¸ªæ”¾å°„ç§‘åŒ»ç”Ÿéƒ½å¯¹æ‰€æœ‰ç»“èŠ‚è¿›è¡Œæ³¨é‡Šã€‚å¦‚ [11] æ‰€ç¤ºï¼Œé¡¹ç›®æœŸé—´å…±æœ‰ 12 åæ”¾å°„ç§‘åŒ»ç”Ÿå‚ä¸äº†æ‰€æœ‰äº”ä¸ªç«™ç‚¹çš„å›¾åƒæ³¨é‡Šç¨‹åºã€‚é‰´äºå¤§å¤šæ•°ç»“èŠ‚ç”± 1-4 åæ”¾å°„ç§‘åŒ»ç”Ÿè¿›è¡Œæ³¨é‡Šï¼Œå¯ä»¥æƒ³è±¡ç»“èŠ‚å¯èƒ½ç”±ä¸åŒçš„æ”¾å°„ç§‘åŒ»ç”Ÿè¿›è¡Œæ³¨é‡Šã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œä¸åŒæ”¾å°„ç§‘åŒ»ç”Ÿå‚ä¸æ³¨é‡Šç»“èŠ‚ä¸ä¼šå¦¨ç¢æˆ‘ä»¬æ–¹æ³•çš„é€‚ç”¨æ€§ã€‚å°½ç®¡ä¸åŒæ”¾å°„ç§‘åŒ»ç”Ÿä¹‹é—´çš„æ³¨é‡Šé£æ ¼å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè®­ç»ƒæœ‰ç´ çš„æ”¾å°„ç§‘åŒ»ç”Ÿéµå¾ªæ—¢å®šçš„ç»“èŠ‚æ³¨é‡Šæ ‡å‡†ï¼Œä¾‹å¦‚[38]ã€‚è¿™äº›æ ‡å‡†ç¡®ä¿ä¸åŒç»„çš„æ”¾å°„ç§‘åŒ»ç”Ÿæä¾›å¤šæ ·åŒ–ä½†åŸºæœ¬ä¸€è‡´çš„æ³¨é‡Šã€‚\n5.2 Limitation æˆ‘ä»¬ç ”ç©¶çš„ä¸€ä¸ªå±€é™æ€§æ˜¯æˆ‘ä»¬ä»…åœ¨ LIDC-IDRI æ•°æ®é›†ä¸Šæµ‹è¯•æˆ‘ä»¬æå‡ºçš„æ–¹æ³•ï¼Œè¯¥æ•°æ®é›†æ˜¯ç›®å‰å”¯ä¸€å…¬å¼€å¯ç”¨çš„è‚ºç»“èŠ‚å®Œæ•´æ³¨é‡Šæ•°æ®é›†ã€‚å°½ç®¡å·²æœ‰åå¤šå¹´çš„å†å²ï¼Œè¯¥æ•°æ®é›†ä»ç„¶æä¾›äº†è®¸å¤šç ”ç©¶æœºä¼šã€‚ç„¶è€Œï¼Œå¯¹å¤šä¸ªæ³¨é‡Šçš„éœ€æ±‚å¯èƒ½ä¼šé™åˆ¶æˆ‘ä»¬çš„æ–¹æ³•åœ¨ç°å®ä¸´åºŠç¯å¢ƒä¸­çš„å®ç”¨æ€§ï¼Œå…¶ä¸­è·å¾—å¤šä¸ªæ³¨é‡Šå¯èƒ½å¹¶ä¸æ€»æ˜¯å¯è¡Œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬è®¡åˆ’æ¢ç´¢èƒ½å¤ŸåŸºäºå•ä¸ªæ³¨é‡Šè‡ªåŠ¨è¯†åˆ«é«˜ç½®ä¿¡åº¦å’Œä½ç½®ä¿¡åº¦åŒºåŸŸçš„æŠ€æœ¯ï¼Œä»è€Œæé«˜æˆ‘ä»¬æ–¹æ³•çš„å¯è¡Œæ€§å’Œé€‚ç”¨æ€§ã€‚\nCONCLUSIONS å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„åè®®ï¼Œä»¥æ”¹è¿›åˆ†å‰²å¹¶è¯†åˆ«åˆ†å‰²ç½®ä¿¡åº¦è¾ƒä½çš„åŒºåŸŸã€‚UAAM ä»å¤šç½®ä¿¡åº¦æ¨¡æ¿ (MCM) ä¸­æ•è·ç‰¹å¾ï¼Œå¤šç½®ä¿¡åº¦æ¨¡æ¿æ˜¯ä½ç½®ä¿¡åº¦ (LC) æ¨¡æ¿å’Œé«˜ç½®ä¿¡åº¦ (HC) æ¨¡æ¿çš„ç»„åˆã€‚åŸºäºUAAMï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ä¸ç¡®å®šæ€§å¼•å¯¼åˆ†å‰²ç½‘ç»œï¼ˆUGMCS-Netï¼‰ï¼Œå…¶ä¸­åŒ…å«ç‰¹å¾æå–æ¨¡å—ã€ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—å’Œäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—ã€‚è¿™äº›æ¨¡å—å…±åŒä»å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„å…±è¯†æˆ–åˆ†æ­§ä¸­å­¦ä¹ æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œæä¾›å…·æœ‰é«˜å’Œä½åˆ†å‰²ç½®ä¿¡åº¦çš„åŒºåŸŸï¼Œä»¥åŠå¯ä»¥å¹³è¡¡æ‰€æœ‰å¯èƒ½æ€§çš„åˆ†å‰²ç»“æœã€‚é™¤äº†ä¼ ç»Ÿçš„éªŒè¯æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æå‡ºäº† LIDC-IDRI ä¸Šçš„å¤æ‚ç»“èŠ‚éªŒè¯ï¼Œæµ‹è¯• UGMCS-Net å¯¹ U-Net éš¾ä»¥åˆ†å‰²çš„è‚ºç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚\nå®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ˜¾ç€æé«˜ U-Net åˆ†å‰²æ•ˆæœä¸ä½³çš„ç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚\næ€»ç»“ï¼šç‰›é€¼ç‰›é€¼ç‰›é€¼ï¼ï¼ï¼ ç¡®å®ç‰›é€¼ï¼ ä¸æ„§æ˜¯ä¸€åŒºé¡¶åˆŠ\n","permalink":"https://swimmingliu.cn/posts/papernotes/2023-uncertainty-aware-attentionmechanism/","summary":"\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ”¾å°„ç§‘åŒ»ç”Ÿæ‹¥æœ‰ä¸åŒçš„åŸ¹è®­å’Œä¸´åºŠç»éªŒï¼Œå¯¼è‡´\u003cstrong\u003eè‚ºç»“èŠ‚çš„åˆ†å‰²æ³¨é‡Š\u003c/strong\u003eå­˜åœ¨\u003cstrong\u003eå·®å¼‚\u003c/strong\u003eï¼Œä»è€Œå¯¼\u003cstrong\u003eè‡´åˆ†å‰²çš„ä¸ç¡®å®šæ€§\u003c/strong\u003eã€‚ä¼ ç»Ÿæ–¹æ³•é€šå¸¸é€‰æ‹©\u003cstrong\u003eå•ä¸ªæ³¨é‡Š\u003c/strong\u003eä½œä¸ºå­¦ä¹ ç›®æ ‡æˆ–å°è¯•å­¦ä¹ åŒ…å«\u003cstrong\u003eå¤šä¸ªæ³¨é‡Š\u003c/strong\u003eçš„\u003cstrong\u003eæ½œåœ¨ç©ºé—´\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç„¶è€Œï¼Œè¿™äº›æ–¹æ³•æ— æ³•\u003cstrong\u003eåˆ©ç”¨å¤šä¸ªæ³¨é‡Šä¹‹é—´çš„å…±è¯†å’Œåˆ†æ­§æ‰€å›ºæœ‰çš„æœ‰ä»·å€¼çš„ä¿¡æ¯\u003c/strong\u003eã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§\u003cstrong\u003eä¸ç¡®å®šæ€§æ„ŸçŸ¥æ³¨æ„æœºåˆ¶\u003c/strong\u003eï¼ˆUAAMï¼‰ï¼Œå®ƒåˆ©ç”¨å¤šä¸ª\u003cstrong\u003eæ³¨é‡Šä¹‹é—´çš„å…±è¯†\u003c/strong\u003eå’Œåˆ†æ­§æ¥ä¿ƒè¿›æ›´å¥½çš„åˆ†å‰²ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†\u003cstrong\u003eå¤šç½®ä¿¡åº¦æ©æ¨¡\u003c/strong\u003eï¼ˆMCMï¼‰ï¼Œå®ƒç»“åˆäº†\u003cstrong\u003eä½ç½®ä¿¡åº¦ï¼ˆLCï¼‰æ©æ¨¡\u003c/strong\u003eå’Œé«˜ç½®ä¿¡åº¦ï¼ˆHCï¼‰æ©æ¨¡ã€‚ \u003cstrong\u003eLC æ©æ¨¡\u003c/strong\u003eè¡¨ç¤º\u003cstrong\u003eåˆ†å‰²ç½®ä¿¡åº¦è¾ƒä½çš„åŒºåŸŸ\u003c/strong\u003eï¼Œ\u003cstrong\u003eæ”¾å°„ç§‘åŒ»ç”Ÿå¯èƒ½æœ‰ä¸åŒçš„åˆ†å‰²é€‰æ‹©\u003c/strong\u003eã€‚ç»§\u003cstrong\u003eUAAM\u003c/strong\u003eä¹‹åï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ä¸€ä¸ª\u003cstrong\u003eä¸ç¡®å®šæ€§å¼•å¯¼å¤šç½®ä¿¡åˆ†å‰²ç½‘ç»œ\u003c/strong\u003eï¼ˆUGMCS-Netï¼‰ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼š\u003cstrong\u003eä¸€ä¸ªæ•è·è‚ºç»“èŠ‚ä¸€èˆ¬ç‰¹å¾çš„ç‰¹å¾æå–æ¨¡å—\u003c/strong\u003eï¼Œ\u003cstrong\u003eä¸€ä¸ªä¸ºè‚ºç»“èŠ‚äº§ç”Ÿä¸‰ä¸ªç‰¹å¾çš„ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—\u003c/strong\u003eã€‚\u003cstrong\u003eæ³¨é‡Šçš„å¹¶é›†ã€äº¤é›†å’Œæ³¨é‡Šé›†ï¼Œä»¥åŠä¸€ä¸ªäº¤é›†å¹¶é›†çº¦æŸæ¨¡å—\u003c/strong\u003eï¼Œè¯¥æ¨¡å—ä½¿ç”¨\u003cstrong\u003eä¸‰ä¸ªç‰¹å¾ä¹‹é—´çš„è·ç¦»æ¥å¹³è¡¡æœ€ç»ˆåˆ†å‰²å’Œ MCM çš„é¢„æµ‹\u003c/strong\u003eã€‚ä¸ºäº†å…¨é¢å±•ç¤ºæˆ‘ä»¬æ–¹æ³•çš„æ€§èƒ½ï¼Œæˆ‘ä»¬æå‡ºäº† LIDC-IDRI ä¸Šçš„å¤æ‚ç»“èŠ‚éªŒè¯ï¼Œå®ƒæµ‹è¯•äº† UGMCS-Net å¯¹ä½¿ç”¨å¸¸è§„æ–¹æ³•éš¾ä»¥åˆ†å‰²çš„è‚ºç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æ˜¾ç€æé«˜ä¼ ç»Ÿæ–¹æ³•éš¾ä»¥åˆ†å‰²çš„ç»“èŠ‚çš„åˆ†å‰²æ€§èƒ½ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"introduction\"\u003eINTRODUCTION\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eè‚ºç»“èŠ‚åˆ†å‰²\u003c/strong\u003eåœ¨\u003cstrong\u003eè‚ºç™Œè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ (CAD)\u003c/strong\u003e ç³»ç»Ÿä¸­è‡³å…³é‡è¦ [1]ï¼Œå¯æä¾›\u003cstrong\u003eç»“èŠ‚å¤§å°ã€å½¢çŠ¶å’Œå…¶ä»–é‡è¦åŒ»å­¦ç‰¹å¾\u003c/strong\u003eç­‰å…³é”®ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¯¹äºæ·±åº¦å­¦ä¹ æ–¹æ³•çš„\u003cstrong\u003eä¸€èˆ¬è®­ç»ƒå’Œæµ‹è¯•èŒƒä¾‹\u003c/strong\u003eï¼Œæ¯ä¸ªç»“èŠ‚å›¾åƒæ•°æ®åªæœ‰ä¸€ä¸ªç”±\u003cstrong\u003eä¸€åæ”¾å°„ç§‘åŒ»ç”Ÿ\u003c/strong\u003eæç»˜çš„æ³¨é‡Šæ©æ¨¡[2]-[6]ã€‚å› æ­¤ï¼Œ\u003cstrong\u003eç½‘ç»œæ¯æ¬¡åªèƒ½æä¾›ç»“èŠ‚åŒºåŸŸ\u003c/strong\u003eçš„å•ä¸ªé¢„æµ‹ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶è€Œï¼Œåœ¨ä¸´åºŠå®è·µä¸­ï¼Œä¸åŒçš„æ”¾å°„ç§‘åŒ»ç”Ÿ\u003cstrong\u003eç”±äºå…¶ä¸åŒçš„åŸ¹è®­å’Œä¸´åºŠç»éªŒ\u003c/strong\u003eå¯èƒ½ä¼šä¸ºè‚ºç»“èŠ‚æä¾›\u003cstrong\u003eä¸åŒçš„åˆ†å‰²æ³¨é‡Š\u003c/strong\u003e[7]-[9]ã€‚\u003c/p\u003e\n\u003cp\u003eå› æ­¤ï¼ŒåŸºäº\u003cstrong\u003eå•ä¸€æ³¨é‡Šçš„ä¼ ç»Ÿæ–¹æ³•\u003c/strong\u003eæ— æ³•åæ˜ \u003cstrong\u003eä¸´åºŠç»éªŒçš„å¤šæ ·æ€§\u003c/strong\u003eï¼Œé™åˆ¶äº†æ·±åº¦å­¦ä¹ æ–¹æ³•çš„åº”ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè§£å†³æ”¾å°„ç§‘åŒ»ç”Ÿä¹‹é—´æ³¨é‡Šä¸åŒé—®é¢˜\u003c/strong\u003eçš„ä¸€ä¸ªç›´æ¥è§£å†³æ–¹æ¡ˆæ˜¯ä¸º\u003cstrong\u003eæ¯ä¸ªè‚ºç»“èŠ‚å›¾åƒåˆå¹¶å¤šä¸ªæ³¨é‡Š\u003c/strong\u003eã€‚è¿™å¯¼è‡´äº†å¦ä¸€ä¸ªé—®é¢˜ï¼š\u003cstrong\u003eå¤šä¸ªæ³¨é‡Šä¸å¯é¿å…åœ°ä¼šå¸¦æ¥ä¸ç¡®å®šæ€§å’Œå†²çª\u003c/strong\u003eï¼Œå› ä¸ºæ”¾å°„ç§‘åŒ»ç”Ÿ\u003cstrong\u003eå¯èƒ½ä¼šå¯¹åŒä¸€åŒºåŸŸè¿›è¡Œä¸åŒçš„æ³¨é‡Š\u003c/strong\u003eã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼ŒKohl ç­‰äººåœ¨ 2018 å¹´æå‡ºäº†ä¸€ç§æ¦‚ç‡ U-Netï¼Œå®ƒ\u003cstrong\u003eåˆ©ç”¨æ¡ä»¶å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨\u003c/strong\u003eå°†\u003cstrong\u003eå¤šä¸ªåˆ†å‰²å˜ä½“ç¼–ç \u003c/strong\u003eåˆ°\u003cstrong\u003eä½ç»´æ½œåœ¨ç©ºé—´\u003c/strong\u003eä¸­ [8]ã€[10]ã€‚é€šè¿‡ä»è¯¥ç©ºé—´é‡‡æ ·ï¼Œç½‘ç»œå¯ä»¥å½±å“ç›¸åº”çš„åˆ†å‰²å›¾ã€‚åŸºäºè¿™é¡¹ç ”ç©¶ï¼ŒHuç­‰äººæå‡ºå°†\u003cstrong\u003eçœŸå®ä¸ç¡®å®šæ€§\u003c/strong\u003eä¸\u003cstrong\u003eæ¦‚ç‡UNet\u003c/strong\u003eç›¸ç»“åˆï¼Œè¿™å¯ä»¥\u003cstrong\u003eæé«˜é¢„æµ‹ä¸ç¡®å®šæ€§ä¼°è®¡\u003c/strong\u003eã€\u003cstrong\u003eæ ·æœ¬å‡†ç¡®æ€§å’Œæ ·æœ¬å¤šæ ·æ€§\u003c/strong\u003e[7]ã€‚è¿™äº›æ–¹æ³•ä¾èµ–äº\u003cstrong\u003eæ½œåœ¨ç©ºé—´å’Œè¯¥ç©ºé—´ä¸­çš„éšæœºæ ·æœ¬\u003c/strong\u003eã€‚å› æ­¤ï¼Œè¿™äº›æ–¹æ³•åªèƒ½é€šè¿‡å¤šæ¬¡é¢„æµ‹æ¥æä¾›ä¸ç¡®å®šåŒºåŸŸã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªè®ºç‚¹ï¼Œå³\u003cstrong\u003eå¤šä¸ªæ³¨é‡Šä¹‹é—´çš„ä¸ç¡®å®šæ€§éµå¾ªç‰¹å®šçš„æ¨¡å¼\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºäº†æ¼”ç¤ºè¿™ç§ç°è±¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†\u003cstrong\u003eå¤šé‡ç½®ä¿¡æ©ç \u003c/strong\u003e (MCM)ï¼Œå®ƒç»“åˆäº†\u003cstrong\u003eé«˜ç½®ä¿¡åº¦ (HC) æ©ç \u003c/strong\u003eå’Œä½ç½®ä¿¡åº¦ (LC) æ©ç ï¼Œå¦‚å›¾ 1 æ‰€ç¤ºã€‚ A. äº¤å‰æ©ç ç­‰äº \u003cstrong\u003eHC mask\u003c/strong\u003eï¼Œä»£è¡¨\u003cstrong\u003eæ‰€æœ‰æ³¨é‡Šçš„äº¤é›†\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè”åˆæ©ç æ˜¯æ‰€æœ‰æ³¨é‡Šçš„è”åˆ\u003c/strong\u003eã€‚ \u003cstrong\u003eLCæ©æ¨¡æ˜¯äº¤é›†æ©æ¨¡å’Œå¹¶é›†æ©æ¨¡ä¹‹é—´çš„å·®å¼‚\u003c/strong\u003eã€‚å½“åœ¨ LIDC-IDRI æ•°æ®é›† [11] ä¸Šè®¡ç®— HC å’Œ LC çš„ Hounsfield å•ä½ (HU) æ ¸ä¼°è®¡æ—¶ï¼Œ\u003cstrong\u003eå¦‚å›¾ 1.B æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ° LC å’Œ HC æ©æ¨¡ä¹‹é—´çš„ HU åˆ†å¸ƒå­˜åœ¨æ˜æ˜¾åŒºåˆ«\u003c/strong\u003eã€‚å…·ä½“åœ°ï¼ŒLCåŒºåŸŸå…·æœ‰æ¯”HCåŒºåŸŸæ›´ä½çš„HUå€¼ã€‚ä»åƒç´ åˆ†å¸ƒæ¥çœ‹ï¼Œ\u003cstrong\u003eHUå€¼è¶Šä½ï¼Œå¯¹åº”åŒºåŸŸçš„å¯†åº¦è¶Šä½\u003c/strong\u003eã€‚å°±CTå›¾åƒç‰¹å¾è€Œè¨€ï¼ŒLCåŒºåŸŸ\u003cstrong\u003eä¸»è¦ç”±ç»“èŠ‚è¾¹ç¼˜ã€æ¯›åˆºå’Œç£¨ç»ç’ƒç‰¹å¾ç­‰è¾¹ç•Œç›¸å…³ç‰¹å¾ç»„æˆ\u003c/strong\u003eï¼Œè€Œ\u003cstrong\u003eHCåŒºåŸŸä¸»è¦åˆ†å¸ƒåœ¨ç»“èŠ‚æ ¸å¿ƒå†…\u003c/strong\u003eã€‚å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†è¿™æ ·çš„å‡è®¾ï¼šå¯¼è‡´æ”¾å°„ç§‘åŒ»ç”Ÿä¹‹é—´å·®å¼‚çš„åŒºåŸŸä¸»è¦ä¸\u003cstrong\u003eä½å¯†åº¦ç»„ç»‡å’Œè¾¹ç•Œç›¸å…³ç‰¹å¾\u003c/strong\u003eæœ‰å…³ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231130203343980\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/327b2.png\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸å…¶ä»–æ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬å»ºè®®åˆ©ç”¨ \u003cstrong\u003eMCM (å¤šé‡ç½®ä¿¡æ©ç ) ** å’Œæ³¨é‡Šé›†ä½œä¸ºå…·æœ‰\u003c/strong\u003eä¸åŒåˆ†å‰²ç¡®å®šæ€§çš„ç‰¹å¾çš„å­¦ä¹ æŒ‡å¯¼**ï¼Œæœ‰åŠ©äºæ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚æˆ‘ä»¬å°†è¿™ç§è®­ç»ƒç§°ä¸º\u003cstrong\u003eUncertaintyAware Attention Mechanism\u003c/strong\u003eï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚æŒ‰ç…§è¿™ç§æœºåˆ¶ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ç”¨äºè‚ºç»“èŠ‚åˆ†å‰²çš„\u003cstrong\u003eUncertainty-Guide Multi-Confidence Segmentation Network\u003c/strong\u003eï¼ˆUGMCS-Netï¼‰ã€‚\u003c/p\u003e","title":"Uncertainty-Aware Attention Mechanism:åˆ©ç”¨ä¸ç¡®å®šæ€§æ„ŸçŸ¥æ³¨æ„æœºåˆ¶è¿›è¡Œè‚ºç»“èŠ‚åˆ†å‰²å’Œä¸ç¡®å®šåŒºåŸŸé¢„æµ‹"},{"content":"ç¨‹åºè®¾è®¡ä½œä¸šæ¥å£æ–‡æ¡£ ç»Ÿä¸€è¿”å›æ ¼å¼\n{ code: ...,\t# çŠ¶æ€ç  msg: ...,\t# æè¿°ä¿¡æ¯ data: { # æ•°æ® ... } } code = { 200 == æˆåŠŸ, 500 == å¤±è´¥, } msg = { success == æˆåŠŸ fail == å¤±è´¥ ... } data = { key : value } å‰ç«¯ è™šæ‹Ÿæ¢è¡£åŠŸèƒ½ @è¯·æ±‚æ ¼å¼ ï¼ˆè¯·æ±‚åç«¯ï¼‰ # å‰åç«¯éœ€ç»Ÿä¸€æ ·ä¾‹å›¾ç‰‡id { userId: ...\u0026lt;int\u0026gt;,\t# æ ‡è¯†å“ªä¸ªç”¨æˆ·çš„è¯·æ±‚ isUploadCloth: ...\u0026lt;bool\u0026gt;, # è‹¥ä¸Šä¼ è¡£æœå›¾ç‰‡ä½¿ç”¨base64ï¼Œå¦åˆ™ç”¨id isUploadPerson: ...\u0026lt;bool\u0026gt;, # è‹¥ä¸Šä¼ äººç‰©å›¾ç‰‡ä½¿ç”¨base64ï¼Œå¦åˆ™ç”¨id clothData: ...\u0026lt;base64||null\u0026gt;, # è¡£æœå›¾ç‰‡base64ç¼–ç  personData: ...\u0026lt;base64||null\u0026gt;,\t# äººç‰©å›¾ç‰‡base64ç¼–ç  exampleClothId: ...\u0026lt;int\u0026gt;,\t# è¡£æœæ ·ä¾‹å›¾ç‰‡id examplePersonId: ...\u0026lt;int\u0026gt;\t# ä»»åŠ¡æ ·ä¾‹å›¾ç‰‡id } åŠ¨æ¼«å¤´åƒåŠŸèƒ½ @è¯·æ±‚æ ¼å¼ ï¼ˆè¯·æ±‚åç«¯ï¼‰ { userId: ...\u0026lt;int\u0026gt;, # æ ‡è¯†å“ªä¸ªç”¨æˆ·çš„è¯·æ±‚ imgData: ...\u0026lt;base64\u0026gt; # éœ€è¦åŠ¨æ¼«åŒ–çš„å›¾ç‰‡ } åç«¯ è™šæ‹Ÿæ¢è¡£åŠŸèƒ½ å‰ç«¯è¯·æ±‚API: https://talented-civet-separately.ngrok-free.app/tryon/ @è¿”å›æ ¼å¼ (è¿”å›å‰ç«¯) { code: ...\u0026lt;int\u0026gt;, # çŠ¶æ€ç  (200è¡¨ç¤ºæˆåŠŸ, 500è¡¨ç¤ºå¤±è´¥) msg: ...\u0026lt;string\u0026gt;,\t# æ¶ˆæ¯ (success / fail) data: { tryon_result : ...\u0026lt;url\u0026gt;, # å¤„ç†åçš„å›¾ç‰‡url } } åŠ¨æ¼«å¤´åƒåŠŸèƒ½ å‰ç«¯è¯·æ±‚API: https://talented-civet-separately.ngrok-free.app/anime/ @è¿”å›æ ¼å¼ (è¿”å›å‰ç«¯) { code: ...\u0026lt;int\u0026gt;, # çŠ¶æ€ç  (200è¡¨ç¤ºæˆåŠŸ, 500è¡¨ç¤ºå¤±è´¥) msg : ...\u0026lt;string\u0026gt;, # æ¶ˆæ¯ (success / fail) data: { anime_result : ...\u0026lt;url\u0026gt;, # å¤„ç†åçš„å›¾ç‰‡url } } æ¨¡å‹ç«¯ è™šæ‹Ÿæ¢è¡£åŠŸèƒ½ åç«¯è¯·æ±‚API: https://certain-ideally-foal.ngrok-free.app/tryon/predict/ @è¯·æ±‚æ ¼å¼\t(åç«¯å‘å‡ºè¯·æ±‚) { userid : ...\u0026lt;int\u0026gt;, # ç”¨æˆ·id cloth : ...\u0026lt;url\u0026gt;, # è¡£æœå›¾ç‰‡urlé“¾æ¥ person : ...\u0026lt;url\u0026gt;\t# äººç‰©å›¾ç‰‡urlé“¾æ¥ } @è¿”å›æ ¼å¼\tï¼ˆè¿”å›åç«¯ï¼‰ { code: ...\u0026lt;int\u0026gt;, # çŠ¶æ€ç  (200è¡¨ç¤ºæˆåŠŸ, 500è¡¨ç¤ºå¤±è´¥) msg: ...\u0026lt;string\u0026gt;,\t# æ¶ˆæ¯ (success / fail) data: { image_value : ...\u0026lt;base64\u0026gt;, # å¤„ç†åçš„å›¾ç‰‡base64ç¼–ç  } } åŠ¨æ¼«å¤´åƒåŠŸèƒ½ åç«¯è¯·æ±‚API: https://certain-ideally-foal.ngrok-free.app/anime/predict/ @è¯·æ±‚æ ¼å¼ { userid : ...\u0026lt;int\u0026gt;, # ç”¨æˆ·id origin_image : ...\u0026lt;url\u0026gt;, # åŸå›¾ç‰‡urlé“¾æ¥ } @è¿”å›æ ¼å¼ { code: ...\u0026lt;int\u0026gt;, # çŠ¶æ€ç  (200è¡¨ç¤ºæˆåŠŸ, 500è¡¨ç¤ºå¤±è´¥) msg: ...\u0026lt;string\u0026gt;,\t# æ¶ˆæ¯ (success / fail) data: { image_value : ...\u0026lt;base64\u0026gt;, # å¤„ç†åçš„å›¾ç‰‡base64ç¼–ç  } } ","permalink":"https://swimmingliu.cn/posts/diary/2023-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%BD%9C%E4%B8%9A%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/","summary":"\u003ch1 id=\"ç¨‹åºè®¾è®¡ä½œä¸šæ¥å£æ–‡æ¡£\"\u003eç¨‹åºè®¾è®¡ä½œä¸šæ¥å£æ–‡æ¡£\u003c/h1\u003e\n\u003cp\u003eç»Ÿä¸€è¿”å›æ ¼å¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecode:\u003c/span\u003e \u003cspan class=\"err\"\u003e...,\u003c/span\u003e\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eçŠ¶æ€ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003emsg:\u003c/span\u003e \u003cspan class=\"err\"\u003e...,\u003c/span\u003e\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæè¿°ä¿¡æ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003edata:\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e     \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ•°æ®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \t\u003cspan class=\"err\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003ecode\u003c/span\u003e \u003cspan class=\"err\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003e200\u003c/span\u003e \u003cspan class=\"err\"\u003e==\u003c/span\u003e \u003cspan class=\"err\"\u003eæˆåŠŸ,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003e500\u003c/span\u003e \u003cspan class=\"err\"\u003e==\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤±è´¥,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003emsg\u003c/span\u003e \u003cspan class=\"err\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003esuccess\u003c/span\u003e \u003cspan class=\"err\"\u003e==\u003c/span\u003e \u003cspan class=\"err\"\u003eæˆåŠŸ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003efail\u003c/span\u003e    \u003cspan class=\"err\"\u003e==\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤±è´¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003edata\u003c/span\u003e \u003cspan class=\"err\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ekey\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003evalue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å‰ç«¯\"\u003eå‰ç«¯\u003c/h2\u003e\n\u003ch3 id=\"è™šæ‹Ÿæ¢è¡£åŠŸèƒ½\"\u003eè™šæ‹Ÿæ¢è¡£åŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e@è¯·æ±‚æ ¼å¼\u003c/span\u003e  \u003cspan class=\"err\"\u003eï¼ˆè¯·æ±‚åç«¯ï¼‰\u003c/span\u003e  \t \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eå‰åç«¯éœ€ç»Ÿä¸€æ ·ä¾‹å›¾ç‰‡id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003euserId:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e\t\t\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ ‡è¯†å“ªä¸ªç”¨æˆ·çš„è¯·æ±‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eisUploadCloth:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;bool\u0026gt;,\u003c/span\u003e           \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eè‹¥ä¸Šä¼ è¡£æœå›¾ç‰‡ä½¿ç”¨base64ï¼Œå¦åˆ™ç”¨id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eisUploadPerson:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;bool\u0026gt;,\u003c/span\u003e          \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eè‹¥ä¸Šä¼ äººç‰©å›¾ç‰‡ä½¿ç”¨base64ï¼Œå¦åˆ™ç”¨id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eclothData:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;base64||null\u0026gt;,\u003c/span\u003e \t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eè¡£æœå›¾ç‰‡base64ç¼–ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003epersonData:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;base64||null\u0026gt;,\u003c/span\u003e\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eäººç‰©å›¾ç‰‡base64ç¼–ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eexampleClothId:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e\t\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eè¡£æœæ ·ä¾‹å›¾ç‰‡id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eexamplePersonId:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;\u003c/span\u003e\t\t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eä»»åŠ¡æ ·ä¾‹å›¾ç‰‡id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åŠ¨æ¼«å¤´åƒåŠŸèƒ½\"\u003eåŠ¨æ¼«å¤´åƒåŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e@è¯·æ±‚æ ¼å¼\u003c/span\u003e \u003cspan class=\"err\"\u003eï¼ˆè¯·æ±‚åç«¯ï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003euserId:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e    \t        \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ ‡è¯†å“ªä¸ªç”¨æˆ·çš„è¯·æ±‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eimgData:\u003c/span\u003e  \u003cspan class=\"err\"\u003e...\u0026lt;base64\u0026gt;\u003c/span\u003e \t        \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eéœ€è¦åŠ¨æ¼«åŒ–çš„å›¾ç‰‡\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"åç«¯\"\u003eåç«¯\u003c/h2\u003e\n\u003ch3 id=\"è™šæ‹Ÿæ¢è¡£åŠŸèƒ½-1\"\u003eè™šæ‹Ÿæ¢è¡£åŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eå‰ç«¯è¯·æ±‚API:\u003c/span\u003e \u003cspan class=\"err\"\u003ehttps:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//talented-civet-separately.ngrok-free.app/tryon/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e@è¿”å›æ ¼å¼\u003c/span\u003e \u003cspan class=\"err\"\u003e(è¿”å›å‰ç«¯)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecode:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e \t                \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eçŠ¶æ€ç \u003c/span\u003e \u003cspan class=\"err\"\u003e(200è¡¨ç¤ºæˆåŠŸ,\u003c/span\u003e \u003cspan class=\"err\"\u003e500è¡¨ç¤ºå¤±è´¥)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003emsg:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;string\u0026gt;,\u003c/span\u003e\t                \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ¶ˆæ¯\u003c/span\u003e \u003cspan class=\"err\"\u003e(success\u003c/span\u003e \u003cspan class=\"err\"\u003e/\u003c/span\u003e \u003cspan class=\"err\"\u003efail)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003edata:\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"err\"\u003etryon_result\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;url\u0026gt;,\u003c/span\u003e  \t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤„ç†åçš„å›¾ç‰‡url\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åŠ¨æ¼«å¤´åƒåŠŸèƒ½-1\"\u003eåŠ¨æ¼«å¤´åƒåŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eå‰ç«¯è¯·æ±‚API:\u003c/span\u003e \u003cspan class=\"err\"\u003ehttps:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//talented-civet-separately.ngrok-free.app/anime/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e@è¿”å›æ ¼å¼\u003c/span\u003e \u003cspan class=\"err\"\u003e(è¿”å›å‰ç«¯)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecode:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e  \t                \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eçŠ¶æ€ç \u003c/span\u003e \u003cspan class=\"err\"\u003e(200è¡¨ç¤ºæˆåŠŸ,\u003c/span\u003e \u003cspan class=\"err\"\u003e500è¡¨ç¤ºå¤±è´¥)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003emsg\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;string\u0026gt;,\u003c/span\u003e \t                \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ¶ˆæ¯\u003c/span\u003e \u003cspan class=\"err\"\u003e(success\u003c/span\u003e \u003cspan class=\"err\"\u003e/\u003c/span\u003e \u003cspan class=\"err\"\u003efail)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003edata:\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \t\u003cspan class=\"err\"\u003eanime_result\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e  \u003cspan class=\"err\"\u003e...\u0026lt;url\u0026gt;,\u003c/span\u003e \t\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤„ç†åçš„å›¾ç‰‡url\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"æ¨¡å‹ç«¯\"\u003eæ¨¡å‹ç«¯\u003c/h2\u003e\n\u003ch3 id=\"è™šæ‹Ÿæ¢è¡£åŠŸèƒ½-2\"\u003eè™šæ‹Ÿæ¢è¡£åŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eåç«¯è¯·æ±‚API:\u003c/span\u003e \u003cspan class=\"err\"\u003ehttps:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//certain-ideally-foal.ngrok-free.app/tryon/predict/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e@è¯·æ±‚æ ¼å¼\u003c/span\u003e\t\u003cspan class=\"err\"\u003e(åç«¯å‘å‡ºè¯·æ±‚)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003euserid\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e              \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eç”¨æˆ·id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecloth\u003c/span\u003e  \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;url\u0026gt;,\u003c/span\u003e \t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eè¡£æœå›¾ç‰‡urlé“¾æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eperson\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;url\u0026gt;\u003c/span\u003e\t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eäººç‰©å›¾ç‰‡urlé“¾æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e@è¿”å›æ ¼å¼\u003c/span\u003e\t\u003cspan class=\"err\"\u003eï¼ˆè¿”å›åç«¯ï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecode:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e \t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eçŠ¶æ€ç \u003c/span\u003e \u003cspan class=\"err\"\u003e(200è¡¨ç¤ºæˆåŠŸ,\u003c/span\u003e \u003cspan class=\"err\"\u003e500è¡¨ç¤ºå¤±è´¥)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003emsg:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;string\u0026gt;,\u003c/span\u003e\t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ¶ˆæ¯\u003c/span\u003e \u003cspan class=\"err\"\u003e(success\u003c/span\u003e \u003cspan class=\"err\"\u003e/\u003c/span\u003e \u003cspan class=\"err\"\u003efail)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003edata:\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"err\"\u003eimage_value\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;base64\u0026gt;,\u003c/span\u003e  \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤„ç†åçš„å›¾ç‰‡base64ç¼–ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"åŠ¨æ¼«å¤´åƒåŠŸèƒ½-2\"\u003eåŠ¨æ¼«å¤´åƒåŠŸèƒ½\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eåç«¯è¯·æ±‚API:\u003c/span\u003e \u003cspan class=\"err\"\u003ehttps:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//certain-ideally-foal.ngrok-free.app/anime/predict/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e@è¯·æ±‚æ ¼å¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003euserid\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e  \t   \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eç”¨æˆ·id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003eorigin_image\u003c/span\u003e  \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;url\u0026gt;,\u003c/span\u003e \t   \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eåŸå›¾ç‰‡urlé“¾æ¥\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e@è¿”å›æ ¼å¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003ecode:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;int\u0026gt;,\u003c/span\u003e \t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eçŠ¶æ€ç \u003c/span\u003e \u003cspan class=\"err\"\u003e(200è¡¨ç¤ºæˆåŠŸ,\u003c/span\u003e \u003cspan class=\"err\"\u003e500è¡¨ç¤ºå¤±è´¥)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003emsg:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;string\u0026gt;,\u003c/span\u003e\t            \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eæ¶ˆæ¯\u003c/span\u003e \u003cspan class=\"err\"\u003e(success\u003c/span\u003e \u003cspan class=\"err\"\u003e/\u003c/span\u003e \u003cspan class=\"err\"\u003efail)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"err\"\u003edata:\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"err\"\u003eimage_value\u003c/span\u003e \u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e...\u0026lt;base64\u0026gt;,\u003c/span\u003e  \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"err\"\u003eå¤„ç†åçš„å›¾ç‰‡base64ç¼–ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ç¨‹åºè®¾è®¡ä½œä¸šæ¥å£æ–‡æ¡£"},{"content":"Prior Attention Network: ç”¨äºåŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„é¢„å…ˆæ³¨æ„ç½‘ç»œ Abstract åŒ»å­¦å›¾åƒä¸­é‚»è¿‘ç»„ç»‡çš„å¤šç§ç±»å‹ç—…å˜çš„å‡†ç¡®åˆ†å‰²åœ¨ä¸´åºŠå®è·µä¸­å…·æœ‰é‡è¦æ„ä¹‰ã€‚åŸºäºä»ç²—åˆ°ç²¾ç­–ç•¥çš„å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å·²å¹¿æ³›åº”ç”¨äºè¯¥é¢†åŸŸã€‚ç„¶è€Œï¼Œç”±äºç»„ç»‡çš„å¤§å°ã€å¯¹æ¯”åº¦å’Œé«˜ç±»é—´ç›¸ä¼¼æ€§çš„ä¸ç¡®å®šæ€§ï¼Œå¤šç—…ç¶åˆ†å‰²ä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ã€‚æ­¤å¤–ï¼Œæ™®éé‡‡ç”¨çš„çº§è”ç­–ç•¥å¯¹ç¡¬ä»¶è¦æ±‚è¾ƒé«˜ï¼Œé™åˆ¶äº†ä¸´åºŠéƒ¨ç½²çš„æ½œåŠ›ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„å…ˆéªŒæ³¨æ„ç½‘ç»œï¼ˆPANetï¼‰ï¼Œå®ƒéµå¾ªä»ç²—åˆ°ç»†çš„ç­–ç•¥æ¥åœ¨åŒ»å­¦å›¾åƒä¸­æ‰§è¡Œå¤šç—…ç¶åˆ†å‰²ã€‚æ‰€æå‡ºçš„ç½‘ç»œé€šè¿‡åœ¨ç½‘ç»œä¸­æ’å…¥ä¸ç—…å˜ç›¸å…³çš„ç©ºé—´æ³¨æ„æœºåˆ¶ï¼Œåœ¨å•ä¸ªç½‘ç»œä¸­å®ç°äº†ä¸¤ä¸ªæ­¥éª¤çš„åˆ†å‰²ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æå‡ºäº†ä¸­é—´ç›‘ç£ç­–ç•¥ï¼Œç”¨äºç”Ÿæˆä¸ç—…å˜ç›¸å…³çš„æ³¨æ„åŠ›æ¥è·å–æ„Ÿå…´è¶£åŒºåŸŸï¼ˆROIï¼‰ï¼Œè¿™åŠ é€Ÿäº†æ”¶æ•›å¹¶æ˜æ˜¾æé«˜äº†åˆ†å‰²æ€§èƒ½ã€‚æˆ‘ä»¬åœ¨ä¸¤ä¸ªåº”ç”¨ä¸­ç ”ç©¶äº†æ‰€æå‡ºçš„åˆ†å‰²æ¡†æ¶ï¼šè‚ºéƒ¨ CT åˆ‡ç‰‡ä¸­å¤šå‘æ€§è‚ºéƒ¨æ„ŸæŸ“çš„ 2D åˆ†å‰²å’Œè„‘ MRI ä¸­å¤šå‘æ€§ç—…å˜çš„ 3D åˆ†å‰²ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œä¸çº§è”ç½‘ç»œç›¸æ¯”ï¼Œåœ¨ 2D å’Œ 3D åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æå‡ºçš„ç½‘ç»œä»¥æ›´å°‘çš„è®¡ç®—æˆæœ¬å®ç°äº†æ›´å¥½çš„æ€§èƒ½ã€‚æ‰€æå‡ºçš„ç½‘ç»œå¯ä»¥è¢«è§†ä¸º 2D å’Œ 3D ä»»åŠ¡ä¸­å¤šç—…ç¶åˆ†å‰²çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚æºä»£ç å¯åœ¨ https://github.com/hsiangyuzhao/PANet è·å–\né—®é¢˜å¯¼å‘ï¼š\nâ‘ ç»„ç»‡çš„å¤§å°ã€å¯¹æ¯”åº¦å’Œé«˜ç±»é—´ç›¸ä¼¼æ€§çš„ä¸ç¡®å®šæ€§\nâ‘¡å¤šç±»åˆ«ç—…ç¶åˆ†å‰²\nâ‘¢æ™®éé‡‡ç”¨çš„çº§è”ç­–ç•¥å¯¹ç¡¬ä»¶è¦æ±‚è¾ƒé«˜\nIntroduction åŒ»å­¦å›¾åƒåˆ†å‰²å¯¹äºç–¾ç—…çš„å‡†ç¡®ç­›æŸ¥å’Œæ‚£è€…çš„é¢„åå…·æœ‰é‡è¦æ„ä¹‰ã€‚åŸºäºç—…ç¶åˆ†å‰²çš„ç—…ç¶è¯„ä¼°æä¾›äº†ç–¾ç—…è¿›å±•çš„ä¿¡æ¯ï¼Œå¸®åŠ©åŒ»ç”Ÿæé«˜ä¸´åºŠè¯Šæ–­å’Œæ²»ç–—çš„è´¨é‡ã€‚ç„¶è€Œï¼Œæ‰‹åŠ¨ç—…å˜åˆ†å‰²ç›¸å½“ä¸»è§‚ä¸”è´¹åŠ›ï¼Œè¿™é™åˆ¶äº†å…¶æ½œåœ¨çš„ä¸´åºŠåº”ç”¨ã€‚è¿‘å¹´æ¥ï¼Œéšç€äººå·¥æ™ºèƒ½çš„å¿«é€Ÿå‘å±•ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„ç®—æ³•å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå¹¶åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹é¢å–å¾—äº†æœ€å…ˆè¿›çš„æ€§èƒ½[1]ã€‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ç”±äºå…¶é«˜åˆ†å‰²è´¨é‡è€Œåœ¨åŒ»å­¦å›¾åƒä¸­çš„ç—…å˜åˆ†å‰²ä¸­å¾ˆå—æ¬¢è¿ã€‚æ­¤ç±»ç®—æ³•é€šå¸¸å…·æœ‰æ·±åº¦ç¼–ç å™¨ï¼Œå¯ä»è¾“å…¥å›¾åƒä¸­è‡ªåŠ¨æå–ç‰¹å¾ï¼Œå¹¶é€šè¿‡ä»¥ä¸‹æ“ä½œç”Ÿæˆå¯†é›†é¢„æµ‹ã€‚ä¾‹å¦‚ï¼ŒLongç­‰äºº[2]æå‡ºäº†ä¸€ç§ç”¨äºå›¾åƒè¯­ä¹‰åˆ†å‰²çš„å…¨å·ç§¯ç½‘ç»œï¼Œè¯¥ç½‘ç»œé¢‡å…·å½±å“åŠ›ï¼Œå¹¶å¯å‘äº†åæ¥çš„åŒ»å­¦åˆ†å‰²ä¸­çš„ç«¯åˆ°ç«¯æ¡†æ¶ã€‚ Ronnebergerç­‰äºº[3]æå‡ºäº†ä¸€ç§ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„Uå½¢ç½‘ç»œï¼ˆU-Netï¼‰ï¼Œè¯¥ç½‘ç»œåœ¨åŒ»å­¦åˆ†å‰²çš„è®¸å¤šé¢†åŸŸéƒ½æ˜¾ç¤ºå‡ºäº†å¯å–œçš„ç»“æœï¼Œå¹¶å·²æˆä¸ºè®¸å¤šåŒ»å­¦åˆ†å‰²ä»»åŠ¡çš„è™šæ‹ŸåŸºå‡†ã€‚\nè¿™ä¸€æ®µéƒ½å¯ä»¥å½“æˆç»å…¸åŒ»å­¦å›¾åƒåˆ†å‰²çš„èƒŒæ™¯å¼•å…¥\nç„¶è€Œï¼Œå°½ç®¡åŒ»å­¦åˆ†å‰²å–å¾—äº†è¿™äº›çªç ´ï¼Œä½†ç›®å‰çš„åŒ»å­¦åˆ†å‰²æ–¹æ³•ä¸»è¦é›†ä¸­åœ¨ç—…ç¶çš„äºŒå…ƒåˆ†å‰²ä¸Šï¼Œå³åŒºåˆ†ç—…ç¶ï¼ˆå‰æ™¯ï¼‰å’Œå…¶ä»–ä¸€åˆ‡ï¼ˆèƒŒæ™¯ï¼‰ã€‚å°½ç®¡äºŒå…ƒåˆ†å‰²ç¡®å®æœ‰åŠ©äºéš”ç¦»æŸäº›æ„Ÿå…´è¶£åŒºåŸŸå¹¶å…è®¸å¯¹åŒ»å­¦å›¾åƒè¿›è¡Œç²¾ç¡®åˆ†æï¼Œä½†åœ¨æŸäº›éœ€è¦å¯¹ç—…å˜è¿›è¡Œå¤šç±»åˆ†å‰²çš„åœºæ™¯ä¸­ï¼ŒäºŒå…ƒåˆ†å‰²è¿˜ä¸å¤Ÿã€‚ä¸äºŒå…ƒåˆ†å‰²ç›¸æ¯”ï¼Œç”±äºç»„ç»‡çš„ç±»é—´ç›¸ä¼¼æ€§ï¼Œè¿™ç§æƒ…å†µè¦å›°éš¾å¾—å¤šï¼Œå› ä¸ºä¸åŒç±»å‹çš„ç—…å˜åœ¨çº¹ç†ã€å¤§å°å’Œå½¢çŠ¶ä¸Šå¯èƒ½ç›¸ä¼¼ã€‚å…·æœ‰ä»ç²—åˆ°ç»†ç­–ç•¥çš„çº§è”ç½‘ç»œå·²å¹¿æ³›åº”ç”¨äºæ­¤ç±»åœºæ™¯ï¼Œä¾‹å¦‚è‚è„å’Œç—…å˜çš„åˆ†å‰²ã€è„‘è‚¿ç˜¤åˆ†å‰²[4]ã€[5][6]ã€[7]ã€‚\næ­¤ç±»ç½‘ç»œé€šå¸¸ç”±ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œç»„æˆï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªç½‘ç»œæ‰§è¡Œç²—åˆ†å‰²ï¼Œç¬¬äºŒä¸ªç½‘ç»œåŸºäºä»ç¬¬ä¸€ä¸ªç½‘ç»œåˆ†å‰²çš„ ROI ç»†åŒ–åˆ†å‰²ã€‚ç„¶è€Œï¼Œå°½ç®¡çº§è”ç½‘ç»œå·²å¹¿æ³›åº”ç”¨äºåŒ»å­¦å›¾åƒçš„å¤šç—…ç¶åˆ†å‰²ï¼Œä½†çº§è”ç­–ç•¥ä¹Ÿæœ‰å…¶ç¼ºç‚¹ã€‚ç”±äºçº§è”ç½‘ç»œç”±ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œç»„æˆï¼Œå‚æ•°é‡å’Œæ˜¾å­˜å ç”¨é€šå¸¸æ˜¯å•ä¸ªç½‘ç»œçš„ä¸¤å€ï¼Œè¿™å¯¹ç¡¬ä»¶è¦æ±‚è¾ƒé«˜ï¼Œé™åˆ¶äº†å…¶åœ¨ä¸´åºŠä½¿ç”¨çš„æ½œåŠ›ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç”±äºçº§è”ç½‘ç»œä¸­çš„ä¸¤ä¸ªç½‘ç»œé€šå¸¸æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤çº§è”ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹æœ‰æ—¶æ¯”å•ä¸ªç½‘ç»œæ›´å›°éš¾ï¼Œè¿™å¯èƒ½å¯¼è‡´æ¬ æ‹Ÿåˆã€‚\nçº§è”ç½‘ç»œï¼šå‚æ•°é‡å¤§ã€å®¹æ˜“æ¬ æ‹Ÿåˆã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§åä¸ºå…ˆéªŒæ³¨æ„ç½‘ç»œï¼ˆPANetï¼‰çš„æ–°å‹ç½‘ç»œç»“æ„ï¼Œç”¨äºåœ¨åŒ»å­¦å›¾åƒä¸­æ‰§è¡Œå¤šç—…ç¶åˆ†å‰²ã€‚æ‰€æå‡ºçš„ç½‘ç»œç”±ä¸€ä¸ªç”¨äºç‰¹å¾æå–çš„ç¼–ç å™¨å’Œä¸¤ä¸ªåˆ†åˆ«ç”Ÿæˆç—…å˜åŒºåŸŸæ³¨æ„åŠ›å’Œæœ€ç»ˆé¢„æµ‹çš„è§£ç å™¨ç»„æˆã€‚è¯¥ç½‘ç»œä¸æ³¨æ„åŠ›æœºåˆ¶ç»“åˆåœ¨ä¸€èµ·ã€‚ä¸ºäº†å‡å°‘å‚æ•°å¤§å°å’Œç¡¬ä»¶å ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ç½‘ç»œç¼–ç å™¨çš„æ·±å±‚ã€è¯­ä¹‰ä¸°å¯Œçš„ç‰¹å¾æ¥ç”Ÿæˆç—…å˜åŒºåŸŸçš„ç©ºé—´æ³¨æ„åŠ›ã€‚\nç„¶åï¼Œç¼–ç å™¨ç”Ÿæˆçš„ç‰¹å¾è¡¨ç¤ºé€šè¿‡ç©ºé—´æ³¨æ„åŠ›è¿›è¡Œç»†åŒ–ï¼Œå¹¶å°†å…¶å‘é€åˆ°è§£ç å™¨ä»¥è¿›è¡Œæœ€ç»ˆçš„å¤šç±»é¢„æµ‹ã€‚ä¸ºäº†æé«˜åˆ†å‰²æ€§èƒ½å¹¶åŠ é€Ÿæ”¶æ•›ï¼Œæˆ‘ä»¬è¿˜åœ¨ç½‘ç»œç»“æ„ä¸­å¼•å…¥äº†ä¸­é—´ç›‘ç£å’Œæ·±åº¦ç›‘ç£ã€‚é€šè¿‡è¿™äº›æ”¹è¿›ï¼Œä¸ä¼ ç»Ÿçš„çº§è”ç½‘ç»œç›¸æ¯”ï¼Œæ‰€æå‡ºçš„ç½‘ç»œä»¥æ˜¾ç€é™ä½çš„å‚æ•°å¤§å°å’Œè®¡ç®—æˆæœ¬å®ç°äº†æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚\nåˆ©ç”¨ç½‘ç»œç¼–ç å™¨çš„æ·±å±‚ã€ç‰¹å¾ä¿¡æ¯æ¥ç”Ÿæˆç©ºé—´æ³¨æ„åŠ›ï¼ˆWTF ???ï¼‰\nä¸­é—´ç›‘ç£ã€æ·±åº¦ç›‘ç£ ï¼ˆä¸é”™ä¸é”™ï¼Œ å¥½å¤šä¸€åŒºå’Œé¡¶ä¼šçš„æ–‡ç« éƒ½ç”¨æ·±åº¦ç›‘ç£ï¼‰\nè¿™é¡¹å·¥ä½œçš„è´¡çŒ®ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„ç½‘ç»œæ¶æ„ï¼Œé€šè¿‡å°†ä¼ ç»Ÿçº§è”ç½‘ç»œä¸­çš„ä¸¤ä¸ªåˆ†å‰²æ­¥éª¤ç»“åˆåœ¨å•ä¸ªç½‘ç»œä¸­ï¼Œéµå¾ª 2D å’Œ 3D åŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„ä»ç²—åˆ°ç»†çš„ç­–ç•¥ã€‚ä¸çº§è”ç½‘ç»œç›¸æ¯”ï¼Œæ‰€æå‡ºçš„æ¶æ„ä»¥æ›´å°‘çš„é¢å¤–è®¡ç®—æˆæœ¬å®ç°äº†æœ‰ç«äº‰åŠ›çš„åˆ†å‰²æ€§èƒ½ï¼Œæ›´å®¹æ˜“è®­ç»ƒå’Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç›‘ç£ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼Œå°†ç—…å˜åŒºåŸŸçš„æ³¨æ„åŠ›ä¸ç½‘ç»œæå–çš„ç‰¹å¾ç›¸ç»“åˆï¼Œå°†å¤šç—…å˜åˆ†å‰²åˆ†è§£ä¸ºä¸¤ä¸ªæ›´å®¹æ˜“çš„é˜¶æ®µï¼Œå¹¶ä¸”ä¸å½“å‰åŸºäºæ³¨æ„åŠ›çš„æ–¹æ³•ç›¸æ¯”å…·æœ‰æ›´å¥½çš„å¯è§£é‡Šæ€§ã€‚ç¬¬ä¸‰ï¼Œæ‰€æå‡ºçš„ç½‘ç»œå·²åœ¨ä¸¤ä¸ªå®é™…åº”ç”¨ä¸­å¾—åˆ°éªŒè¯ï¼ŒåŒ…æ‹¬è‚ºéƒ¨ CT åˆ‡ç‰‡ä¸­çš„ COVID-19 ç—…å˜çš„ 2D åˆ†å‰²å’Œå¤šæ¨¡æ€ MRI ä¸­çš„è„‘è‚¿ç˜¤çš„ 3D åˆ†å‰²ã€‚æ‰€æå‡ºçš„ç½‘ç»œåœ¨ 2D å’Œ 3D ä»»åŠ¡ä¸­éƒ½ä¼˜äºå‰æ²¿æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨å‚æ•°å’Œè®¡ç®—æˆæœ¬æ–¹é¢æ¯”å½“å‰ç½‘ç»œæ›´é«˜æ•ˆã€‚\nä¸€ä¸ªç½‘ç»œã€ç›‘ç£ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ã€å‚æ•°å’Œè®¡ç®—æˆæœ¬æ–¹é¢æ¯”å½“å‰ç½‘ç»œæ›´é«˜æ•ˆã€‚\nRelated Work 1ï¼‰å›¾åƒåˆ†å‰²çš„ç½‘ç»œç»“æ„ï¼šç”¨äºå›¾åƒåˆ†å‰²çš„å…¸å‹å·ç§¯ç¥ç»ç½‘ç»œé€šå¸¸ç”±ä¸€ä¸ªå·ç§¯ç‰¹å¾æå–å™¨ç»„æˆï¼Œå…¶æ‹“æ‰‘ç±»ä¼¼äºå¸¸è§çš„åˆ†ç±»ç½‘ç»œï¼Œè‡ªåŠ¨ä»è¾“å…¥å›¾åƒä¸­æå–ç‰¹å¾ï¼Œå¹¶è¿›è¡ŒåŸºäºå·ç§¯çš„æ“ä½œä»¥ç”Ÿæˆæœ€ç»ˆçš„å¯†é›†é¢„æµ‹ã€‚åœ¨è‡ªç„¶å›¾åƒåˆ†å‰²é¢†åŸŸï¼ŒFCN [2]ã€DeepLab [8]ã€PSPNet [9] å’Œ SegNet [10] å› å…¶æ€§èƒ½å’Œæ•ˆç‡è€Œé¢‡å—æ¬¢è¿ã€‚å¯¹äºåŒ»å­¦åˆ†å‰²ï¼ŒU-Net [3] åœ¨è®¸å¤šä»»åŠ¡ä¸­ç›¸å½“æµè¡Œï¼Œå¹¶ä¸”å·²è¢«ä¿®æ”¹ä¸ºè®¸å¤šæ”¹è¿›ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Attention U-Net [11]ã€U-Net++ [12]ã€V-Net [13] å’ŒH-DenseUNet [14]åœ¨æŸäº›é¢†åŸŸè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚\n2ï¼‰çº§è”ç½‘ç»œåœ¨åŒ»å­¦åˆ†å‰²ä¸­çš„åº”ç”¨ï¼šçº§è”ç½‘ç»œå·²å¹¿æ³›åº”ç”¨äºæ­£å¸¸ç»„ç»‡å’Œç—…å˜çš„åˆ†å‰²ä»¥åŠä¸åŒç±»å‹ç—…å˜çš„åˆ†å‰²ï¼ŒåŒ…æ‹¬è‚è„ç—…å˜ã€è„‘è‚¿ç˜¤ã€ç¡¬åŒ–ç—…å˜å’Œå‰åˆ—è…ºç™Œçš„åˆ†å‰²[4] ï¼Œ[15][5]ï¼Œ[16]ã€‚ä¾‹å¦‚ï¼ŒAwad ç­‰äºº[17]æå‡ºäº†ä¸€ä¸ªåä¸º CU-Net çš„çº§è”æ¡†æ¶ï¼Œç”¨äºåœ¨ CT æ‰«æä¸­å¯¹è‚è„å’Œç—…å˜è¿›è¡Œè‡ªåŠ¨åˆ†å‰²ã€‚ä»–ä»¬è¿˜æä¾›äº†å¯ä»¥æŒ‡å¯¼ä¸´åºŠæ²»ç–—çš„æœ‰ç”¨ä¿¡æ¯å’Œè§£é‡Šã€‚ Xiç­‰äºº[18]æå‡ºäº†ä¸€ç§çº§è”U-ResNetsï¼Œå®ƒéµå¾ªä¸€ç§æ–°é¢–çš„å‚ç›´çº§è”ç­–ç•¥ï¼Œå¹¶åœ¨ä»–ä»¬çš„å·¥ä½œä¸­è¯„ä¼°äº†ä¸åŒç±»å‹çš„æŸå¤±å‡½æ•°ã€‚é™¤äº†è‚è„ç—…ç¶åˆ†å‰²ä¹‹å¤–ï¼Œçº§è”ç­–ç•¥åœ¨ BraTS æŒ‘æˆ˜ä¸­ä¹Ÿå¾ˆæµè¡Œã€‚ä¾‹å¦‚ï¼ŒBraTS 2019æŒ‘æˆ˜èµ›çš„Top-2è§£å†³æ–¹æ¡ˆ[6]ã€[7]éƒ½æ˜¯å…·æœ‰ä¸åŒçº§è”ç­–ç•¥çš„çº§è”ç½‘ç»œã€‚\n3ï¼‰ç¥ç»ç½‘ç»œä¸­çš„æ³¨æ„åŠ›ï¼šæ³¨æ„åŠ›æœºåˆ¶å—åˆ°äººç±»æ„ŸçŸ¥å’Œè§†è§‰è®¤çŸ¥çš„å¯å‘ï¼Œå¹¶å·²æ™®éåº”ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­[19]ï¼Œ[20][11]ï¼Œ[21]ã€‚è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­çš„æ³¨æ„åŠ›æœºåˆ¶æ˜¯åœ¨ç¥ç»ç½‘ç»œæå–çš„ç‰¹å¾è¡¨ç¤ºä¸Šç”Ÿæˆç©ºé—´æˆ–é€šé“æƒé‡å›¾ã€‚ä¾‹å¦‚ï¼ŒWooç­‰äºº[20]å¼€å‘äº†ä¸€ä¸ªå·ç§¯å—æ³¨æ„åŠ›æ¨¡å—ï¼ˆCBAMï¼‰æ¥å¼•å…¥ä¸€ç§èåˆæ³¨æ„åŠ›æœºåˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬é€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›ã€‚è¿™ç§æ³¨æ„åŠ›æ¨¡å—å¯ä»¥æ’å…¥åˆ°å¸¸ç”¨çš„åˆ†ç±»æˆ–åˆ†å‰²ç½‘ç»œä¸­ã€‚Oktayç­‰äºº[11]åœ¨Attention U-Netä¸­æå‡ºäº†ä¸€ç§æ–°é¢–çš„æ³¨æ„åŠ›é—¨ï¼Œç”¨äºç»†åŒ–ç½‘ç»œç¼–ç å™¨æå–çš„ç‰¹å¾è¡¨ç¤ºï¼Œä»¥ä¿ƒè¿›ç½‘ç»œä¸“æ³¨äºROIã€‚æœ€è¿‘ï¼Œé¦–å…ˆåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­æå‡ºçš„å˜å‹å™¨[22]å·²è¢«å¼•å…¥åˆ°åŒ»å­¦åˆ†å‰²ä»»åŠ¡ä¸­ã€‚ä¾‹å¦‚ï¼ŒWang ç­‰äºº [23] æå‡ºäº†ä¸€ç§ TransBTSï¼Œç”¨äºä»å¤šæ¨¡æ€è„‘ MRI ä¸­æ‰§è¡Œè„‘è‚¿ç˜¤åˆ†å‰²ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œæ³¨æ„åŠ›æœºåˆ¶å·²è¢«å¹¿æ³›ç”¨äºçªå‡ºROIå¹¶æŠ‘åˆ¶ä¸ç›¸å…³ä¿¡æ¯ï¼Œä½†ç›®å‰åŸºäºæ³¨æ„åŠ›çš„æ–¹æ³•çš„ç ”ç©¶å¹¶æ²¡æœ‰å¯¹æ³¨æ„åŠ›å¦‚ä½•äº§ç”Ÿä»¥åŠç½‘ç»œä¸ºä½•å…³æ³¨æŸäº›åŒºåŸŸæä¾›æ¸…æ™°çš„è§£é‡Šï¼Œè¿™ä½¿å¾—é™åˆ¶äº†æ³¨æ„åŠ›æœºåˆ¶çš„å¯è§£é‡Šæ€§ã€‚\nMethod åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»æ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œæ¶æ„ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ¦‚è¿°æ‰€æè®®çš„ç½‘ç»œã€‚ç„¶åï¼Œæˆ‘ä»¬ç›¸åº”åœ°æä¾›æœ‰å…³å…·æœ‰ä¸­é—´ç›‘ç£ã€å‚æ•°åŒ–è·³è·ƒè¿æ¥å’Œå…·æœ‰æ·±åº¦ç›‘ç£çš„å¤šç±»è§£ç å™¨çš„æ‰€æå‡ºçš„æ³¨æ„å¼•å¯¼è§£ç å™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚\n3.1 . Overview of Network Architecture åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬æå‡ºçš„ç½‘ç»œæ˜¯åŸºäº U-Net [3] æ¶æ„è¿›è¡Œä¿®æ”¹çš„ï¼Œè¯¥æ¶æ„å…·æœ‰ U å½¢æ‹“æ‰‘ä»¥åŠç¼–ç å™¨å’Œè§£ç å™¨ä¹‹é—´çš„è·³è·ƒè¿æ¥ã€‚åœ¨æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œä¸­ï¼Œä¸€ç§æ–°é¢–çš„æ³¨æ„å¼•å¯¼è§£ç å™¨æ¨¡å—è¢«é›†æˆåˆ°ç½‘ç»œçš„è·³è·ƒè¿æ¥ä¸­ï¼Œä»¥é€šè¿‡ç©ºé—´æ³¨æ„æ¥ç»†åŒ–ç‰¹å¾è¡¨ç¤ºã€‚ç½‘ç»œä¸­è¿˜å¼•å…¥äº†ä¸€ç§æ–°é¢–çš„å‚æ•°åŒ–è·³è·ƒè¿æ¥ï¼Œä»¥æŒ‡å¯¼ç½‘ç»œå­¦ä¹ æ™®é€šç‰¹å¾å›¾å’Œç²¾ç‚¼ç‰¹å¾å›¾ä¹‹é—´çš„æ¯”ç‡ã€‚æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨ä»ç¼–ç å™¨è·å–ä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾å¹¶ç”Ÿæˆç©ºé—´æ³¨æ„åŠ›å›¾æ¥æŒ‡å¯¼æ¥ä¸‹æ¥çš„å¤šç±»åˆ†å‰²ã€‚ä¸ºäº†äº§ç”Ÿä¸æŠ•èµ„å›æŠ¥ç‡ç›¸å…³çš„æ³¨æ„åŠ›ï¼Œæ¡†æ¶ä¸­ä½¿ç”¨äº†ä¸­é—´ç›‘ç£ç­–ç•¥ã€‚ç„¶åå°†ç»†åŒ–çš„ç‰¹å¾å›¾å‘é€åˆ°å¤šç±»è§£ç å™¨ä»¥è¿›è¡Œæœ€ç»ˆçš„å¯†é›†é¢„æµ‹ã€‚\nå¤šç±»è§£ç å™¨é‡‡ç”¨æ·±åº¦ç›‘ç£ç­–ç•¥ä»¥è·å¾—æ›´å¥½çš„æ”¶æ•›æ€§å¹¶æé«˜åˆ†å‰²æ€§èƒ½ã€‚è¿™ç§ç½‘ç»œæ‹“æ‰‘é€šè¿‡æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨ç”Ÿæˆçš„æ³¨æ„åŠ›å›¾åœ¨å•ä¸ªç½‘ç»œä¸­å®ç°äº†ä¼ ç»Ÿçº§è”ç½‘ç»œçš„ä¸¤ä¸ªæ­¥éª¤ã€‚ç»„ç½‘æ–¹æ¡ˆå¦‚å›¾2æ‰€ç¤ºã€‚\n3.2 Attention Guiding Decoder åœ¨å…¸å‹çš„çº§è”ç½‘ç»œä¸­ï¼Œåˆ†å‰²çš„ç¬¬ä¸€æ­¥æ˜¯æ‰§è¡Œç²—åˆ†å‰²å¹¶æ‰¾åˆ°è¾“å…¥å›¾åƒä¸­çš„ ROIã€‚åœ¨æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ³¨æ„å¼•å¯¼è§£ç å™¨æ¥æ‰§è¡Œè¯¥è¿‡ç¨‹ã€‚æ‰€æå‡ºçš„æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨è¢«é›†æˆåˆ°ç½‘ç»œä¸­ä»¥ç”Ÿæˆä¸ ROI ç›¸å…³çš„æ³¨æ„åŠ›å›¾ï¼Œç„¶ååˆ©ç”¨è¿™äº›å›¾æ¥ç»†åŒ–ç‰¹å¾è¡¨ç¤ºå¹¶æé«˜å¤šç±»åˆ†å‰²æ€§èƒ½ã€‚\n1ï¼‰æ¨¡å—æ‹“æ‰‘ï¼šæ‰€æå‡ºçš„æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„åŸºæœ¬æ‹“æ‰‘åŸºäºFCN [2]ä¸­æå‡ºçš„ç‰¹å¾èåˆã€‚ä»ç½‘ç»œè§£ç å™¨æœ€æ·±ä¸‰å±‚æå–çš„ç‰¹å¾è¡¨ç¤ºè¢«é¦ˆé€åˆ°è¯¥æ¨¡å—ã€‚ç”±äºç‰¹å¾å›¾çš„ç©ºé—´å¤§å°ä¸åŒï¼Œå› æ­¤é¦–å…ˆæ‰§è¡Œçº¿æ€§æ’å€¼ä»¥å¯¹ç‰¹å¾å›¾è¿›è¡Œä¸Šé‡‡æ ·ã€‚ç„¶åå¯¹ç‰¹å¾è¿›è¡Œå‹ç¼©ï¼ŒæŠ‘åˆ¶é€šé“ç»´åº¦ä¸­çš„ä¸ç›¸å…³ä¿¡æ¯ï¼Œé™ä½è®¡ç®—æˆæœ¬ã€‚ç„¶åå°†å‹ç¼©åçš„ç‰¹å¾åˆ†åˆ«åœ¨é€šé“ç»´åº¦ä¸Šè¿æ¥èµ·æ¥ä»¥è¿›è¡Œç‰¹å¾èåˆã€‚(torch.cat) æœ€åï¼Œèåˆä¸‰ä¸ªç‰¹å¾å›¾ä»¥è·å¾—æœ€ç»ˆçš„é¢„æµ‹ã€‚\nä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ 2D åˆ†å‰²æ¥è¯´æ˜æ³¨æ„åŠ›å›¾çš„è®¡ç®—ã€‚æˆ‘ä»¬ä½¿ç”¨ Xi âˆˆ R Ci Ã— Hi Ã— Wi,i âˆˆ (3, 4, 5) è¡¨ç¤ºä»ç½‘ç»œç¼–ç å™¨æå–çš„ç‰¹å¾å›¾ï¼Œå…¶ä¸­ X5 è¡¨ç¤ºæœ€æ·±çš„ç‰¹å¾ã€‚ç‰¹å¾å‹ç¼©å’Œèåˆè®¡ç®—å¦‚ä¸‹ï¼š\nå…¶ä¸­Z5 âˆˆ R C4 Ã— H4 Ã— W4è¡¨ç¤ºX5å’ŒX4çš„èåˆç‰¹å¾ï¼ŒZ4 âˆˆ R C3 Ã— H3 Ã— W3è¡¨ç¤ºX4å’ŒX3çš„èåˆç‰¹å¾ï¼ŒWc5 âˆˆRC5Ã—C4å’ŒWc4 âˆˆRC4Ã—C3è¡¨ç¤ºç›¸åº”çš„å‹ç¼©å·ç§¯ï¼Œ W4 âˆˆ RC4Ã—C4 è¡¨ç¤ºèåˆ X5 å’Œ X4 çš„èåˆå·ç§¯ï¼ŒâŠ• è¡¨ç¤ºç‰¹å¾ä¸²è”ã€‚\næ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„è¾“å‡ºè®¡ç®—å¦‚ä¸‹ï¼š\nå…¶ä¸­ W3 âˆˆ R C3Ã—C3 è¡¨ç¤ºèåˆ X4 å’Œ X3 çš„èåˆå·ç§¯ï¼ŒWout âˆˆ R C3 Ã— 1 è¡¨ç¤ºè¾“å‡ºå·ç§¯ï¼ŒÏƒ åˆ†åˆ«è¡¨ç¤º Sigmoid æ¿€æ´»ã€‚\n2ï¼‰ä¸­é—´ç›‘ç£ï¼šè®¡ç®—æœºè§†è§‰ä¸­çš„ä¼ ç»Ÿæ³¨æ„åŠ›æœºåˆ¶è‡ªåŠ¨ç”Ÿæˆæ³¨æ„åŠ›å›¾ï¼Œä½†æ³¨æ„åŠ›ç”Ÿæˆçš„è¿‡ç¨‹é€šå¸¸æ˜¯äººç±»æ— æ³•è§£é‡Šçš„ï¼Œå¹¶ä¸”ç½‘ç»œå…³æ³¨çš„åŒºåŸŸå¯èƒ½ä¸äººç±»å…³æ³¨çš„åŒºåŸŸä¸åŒã€‚\nè¿™ç§å·®è·ä¼šé™åˆ¶æ³¨æ„åŠ›æœºåˆ¶çš„æ€§èƒ½å’Œå¯è§£é‡Šæ€§ï¼Œæœ‰æ—¶è¿˜ä¼šå¯¼è‡´ç½‘ç»œå®¹é‡çš„æ¶åŒ–ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ç½‘ç»œä¸­å¼•å…¥äº†ä¸­é—´ç›‘ç£ç­–ç•¥ã€‚åœ¨éµå¾ªä»ç²—åˆ°ç»†çš„æ–¹å¼çš„å¤šç—…ç¶åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”Ÿæˆä¸€ä¸ªäºŒå…ƒGround Truthï¼Œå…¶ä¸­å‰æ™¯è¡¨ç¤ºæ‰€æœ‰ç±»å‹çš„ç—…ç¶ï¼ŒèƒŒæ™¯è¡¨ç¤ºå…¶ä»–ä¸€åˆ‡ã€‚åœ¨å…·æœ‰ C ç§ç—…å˜çš„å¤šç—…å˜åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Gi,i âˆˆ (1,\u0026hellip;,C) è¡¨ç¤ºç¬¬ i ç±»ç—…å˜çš„äºŒå…ƒåŸºæœ¬äº‹å®ï¼Œå…¶ä¸­å‰æ™¯è¡¨ç¤ºç‰¹å®šç—…å˜èƒŒæ™¯ä»£è¡¨å…¶ä»–ä¸€åˆ‡ã€‚äºŒè¿›åˆ¶çœŸå®å€¼ Gb è®¡ç®—å¦‚ä¸‹ï¼š\nç„¶ååˆ©ç”¨äºŒå…ƒæŸå¤±å‡½æ•°æ¥è®¡ç®—äºŒå…ƒçœŸå®å€¼ yb å’Œæ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨ç”Ÿæˆçš„æ³¨æ„åŠ›å›¾ Y ä¹‹é—´çš„äºŒå…ƒæŸå¤± lï¼š\nå…¶ä¸­ Lb è¡¨ç¤ºäºŒå…ƒæŸå¤±å‡½æ•°ã€‚ç„¶ååˆ©ç”¨è®¡ç®—å‡ºçš„æŸå¤± l æ¥ç›‘ç£æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„å‚æ•°æ›´æ–°ã€‚\nè¿™ä¸ªåœ°æ–¹çš„ä¸­é—´ç›‘ç£ä¸»è¦æ˜¯ è¦è®©ä¸­é—´çš„æ³¨æ„åŠ›æœºåˆ¶èµ·ä½œç”¨ï¼Œä¸èƒ½éšä¾¿ç”Ÿæˆã€‚\né€šè¿‡å¼•å…¥ä¸­é—´ç›‘ç£ï¼Œç”Ÿæˆçš„æ³¨æ„åŠ›ç”±è¾“å…¥å›¾åƒçš„äºŒå…ƒçœŸå®å€¼è¿›è¡Œç›‘ç£ã€‚è¿™æ ·ï¼Œç½‘ç»œè¢«è¿«å­¦ä¹ å¤šç—…ç¶åˆ†å‰²ä»»åŠ¡çš„åˆ†è§£ï¼Œå³é¦–å…ˆæå–ç—…ç¶åŒºåŸŸï¼Œç„¶åå¯¹ç—…ç¶åŒºåŸŸè¿›è¡Œç»†ç²’åº¦åˆ†ç±»ã€‚è¿™ç§åˆ†è§£é™ä½äº†å¤šç—…ç¶åˆ†å‰²çš„éš¾åº¦ï¼Œå¹¶ä¸”ä¸å½“å‰åœ¨â€œé»‘åŒ£å­â€ä¸­ç”Ÿæˆæ³¨æ„åŠ›çš„åŸºäºæ³¨æ„åŠ›çš„åŒ»å­¦åˆ†å‰²æ–¹æ³•ç›¸æ¯”ï¼Œå…·æœ‰æ›´å¥½çš„å¯è§£é‡Šæ€§ã€‚\n3.3 Parameterized Skip Connections è·³è·ƒè¿æ¥å·²å¹¿æ³›åº”ç”¨äºæµè¡Œçš„å·ç§¯ç½‘ç»œä¸­ï¼ŒåŒ…æ‹¬U-Net [3]ã€ResNet [24]ç­‰ã€‚å—[11]çš„å¯å‘ï¼Œæˆ‘ä»¬å»ºè®®å°†æ³¨æ„åŠ›å›¾é›†æˆåˆ°è¿æ¥ç½‘ç»œç¼–ç å™¨å’Œå¤šç½‘ç»œçš„è·³è·ƒè¿æ¥ä¸­ï¼Œå½¢æˆå¤šçº§è§£ç å™¨ã€‚åœ¨è·³è·ƒè¿æ¥ä¸­ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†é¢å¤–çš„æ®‹å·®è·¯å¾„æ¥æ¢å¤æ™®é€šç‰¹å¾å›¾å¹¶è¿›ä¸€æ­¥æé«˜åˆ†å‰²æ€§èƒ½ã€‚ä¸ä¼ ç»Ÿçš„æ®‹å·®è·¯å¾„ç›¸æ¯”ï¼Œæ®‹å·®è·¯å¾„çš„å¹…å€¼å› å­Î±i,i âˆˆ (1, 2,â€¦, 5)è¢«è®¾ç½®ä¸ºç½‘ç»œçš„å¯å­¦ä¹ å‚æ•°ï¼Œå¹¶åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­æ›´æ–°ã€‚æˆ‘ä»¬ç›¸ä¿¡è¿™æ ·çš„è®¾ç½®å¯ä»¥ä¸ºç½‘ç»œå¢åŠ é¢å¤–çš„éçº¿æ€§èƒ½åŠ›å¹¶å¢å¼ºè·³è¿‡è¿æ¥çš„æœ‰æ•ˆæ€§ã€‚\næˆ‘ä»¬ä½¿ç”¨ Fi,i âˆˆ (1, 2,\u0026hellip;, 5) è¡¨ç¤ºæ¥è‡ªç½‘ç»œç¼–ç å™¨çš„æ™®é€šç‰¹å¾å›¾ï¼ŒY è¡¨ç¤ºæ³¨æ„åŠ›å›¾ï¼Œç²¾ç‚¼åçš„ç‰¹å¾å›¾ Fri,i âˆˆ (1, 2,. .., 5) å¤šç±»è§£ç å™¨æ¥æ”¶çš„ä¿¡æ¯è®¡ç®—å¦‚ä¸‹ï¼š\nç„¶åå°†ç»†åŒ–çš„ç‰¹å¾å›¾å‘é€åˆ°å¤šç±»è§£ç å™¨ä»¥è¿›è¡Œæœ€ç»ˆçš„å¤šç±»é¢„æµ‹ã€‚\n3.4 Multi-Class Decoder With Deep Supervision Uå½¢åˆ†å‰²ç½‘ç»œä¸­çš„è§£ç å™¨ç”¨äºæ¥æ”¶ç¼–ç å™¨å‘é€çš„ç‰¹å¾å›¾ï¼Œéšç€è§£ç å™¨ä¸­çš„ç‰¹å¾é€šé“æ•°é‡çš„å‡å°‘å’Œç©ºé—´åˆ†è¾¨ç‡çš„å¢åŠ ï¼Œåˆ†å‰²æ€§èƒ½é€æ­¥ç»†åŒ–ã€‚ç„¶è€Œï¼Œéšç€ç½‘ç»œå˜æ·±ï¼Œæœ€æ·±çš„è§£ç å™¨å—å˜å¾—éš¾ä»¥è®­ç»ƒï¼Œè¿™å¯èƒ½ä¼šé™åˆ¶æœ€ç»ˆçš„åˆ†å‰²æ€§èƒ½ã€‚æ·±åº¦ç›‘ç£ç­–ç•¥å·²ç»è¢«æå‡ºæ¥è®­ç»ƒæ·±åº¦å·ç§¯ç½‘ç»œ[25]ã€[26]ã€‚åœ¨æ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œä¸­ï¼Œè¾…åŠ©é¢„æµ‹æ˜¯ä»ä¸åŒçº§åˆ«çš„è§£ç å™¨å—ä¸­æå–çš„ï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„åŸºæœ¬äº‹å®è¿›è¡Œç›‘ç£ã€‚æˆ‘ä»¬ä½¿ç”¨ Pi,i âˆˆ (1, 2, 3) è¡¨ç¤ºæ¥è‡ªå¤šç±»è§£ç å™¨çš„è¾…åŠ©é¢„æµ‹ï¼ŒPm è¡¨ç¤ºæœ€ç»ˆçš„å¤šç±»é¢„æµ‹ï¼Œg è¡¨ç¤ºçœŸå®å€¼ï¼ŒLm è¡¨ç¤ºå¤šç±»æŸå¤±å‡½æ•°ã€‚æœ€ç»ˆçš„å¤šç±»æŸå¤±è®¡ç®—å¦‚ä¸‹ï¼š\næ‰€æå‡ºçš„å¤šç±»è§£ç å™¨çš„è§£ç å™¨å—ä¹Ÿä¸å½“å‰ç½‘ç»œè®¾ç½®å…·æœ‰å…±åŒçš„è®¾ç½®ï¼Œå³å·ç§¯å±‚ã€å½’ä¸€åŒ–å±‚å’Œéçº¿æ€§æ¿€æ´»å•å…ƒçš„å †æ ˆã€‚\næ€»ç»“ä¸€ä¸‹ï¼š\nâ‘  æ³¨æ„åŠ›æœºåˆ¶ + ä¸­é—´ç›‘ç£ï¼šæœ€åä¸‰å±‚ç‰¹å¾èåˆ + è¿™ä¸€éƒ¨åˆ†åšæ·±åº¦ç›‘ç£ï¼ˆåŸæ¥è¿™æ ·ä¹Ÿå«åˆ›æ–°ï¼‰\nâ‘¡ è·³è·ƒè¿æ¥çš„éƒ¨åˆ†åŠ äº†ä¸€ä¸ªÎ±å› å­ ï¼ˆæ„Ÿè§‰åƒæƒé‡ä¸€æ ·çš„ä¸œè¥¿ ï¼‰\nâ‘¢ å¤šé˜¶æ®µçš„æ·±åº¦ç›‘ç£ ï¼ˆè¿™ä¸ªå°±ç®—ä¸€ä¸ªtrickå§ï¼Œå¤§å®¶éƒ½åœ¨ç”¨ï¼‰ï¼Œ ä¸è¿‡è¿™é‡Œå˜æˆäº†å¤šç±»åˆ«\nExperiments 4.1 Strong Baselines and Evaluation Metrics ä¸ºäº†ç ”ç©¶ç½‘ç»œæ¶æ„çš„æ€§èƒ½å·®å¼‚ï¼Œæˆ‘ä»¬å°†æ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œä¸åŒ»å­¦åˆ†å‰²ä¸­æœ€æµè¡Œçš„æ–¹æ³•è¿›è¡Œäº†æ¯”è¾ƒï¼ŒåŒ…æ‹¬ U-Net [3]ã€Attention U-Net [11] å’Œçº§è” U-Netï¼Œåœ¨ä¸¤ä¸ª 2D ä¸­å’Œ 3D åˆ†å‰²ä»»åŠ¡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ä»–ä»¬è®ºæ–‡ä¸­æå‡ºçš„åŸå§‹ç‰ˆæœ¬ç›¸æ¯”ï¼ŒåŸºçº¿æ–¹æ³•æ ¹æ®ç½‘ç»œæ‹“æ‰‘æ–¹é¢çš„æŸäº›ä»»åŠ¡è¿›è¡Œäº†ä¿®æ”¹å’Œä¼˜åŒ–ï¼Œä»¥è·å¾—æ€§èƒ½æå‡ã€‚æˆ‘ä»¬å°†æ®‹å·®è¿æ¥[24]ã€æ‰¹é‡å½’ä¸€åŒ–[30]å’Œæ¥è‡ª ImageNet çš„é¢„è®­ç»ƒç¼–ç å™¨å¼•å…¥åˆ° 2D COVIDlesion åˆ†å‰²ä»»åŠ¡çš„åŸºçº¿æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å°†æ®‹å·®è¿æ¥ã€å®ä¾‹å½’ä¸€åŒ–å’Œ PReLU æ¿€æ´»å¼•å…¥åˆ° 3D è„‘è‚¿ç˜¤åˆ†å‰²ä»»åŠ¡ä¸­ã€‚é™¤äº†ç½‘ç»œæ‹“æ‰‘ä¹‹å¤–ï¼ŒåŸºçº¿æ–¹æ³•ä¸æ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œå…±äº«ç›¸åŒçš„æ•°æ®å¢å¼ºå’Œè®­ç»ƒé…ç½®ã€‚\nå¯¹äº COVID-19 ç—…å˜çš„ 2D åˆ†å‰²ï¼Œæˆ‘ä»¬ä½¿ç”¨ Dice æŒ‡æ•°ã€ç²¾åº¦åˆ†æ•°å’Œå¬å›åˆ†æ•°æ¥è¯„ä¼°æ‰€æå‡ºçš„ç½‘ç»œçš„æ€§èƒ½ã€‚ DiceæŒ‡æ•°æ˜¯ä¸€ç§ç”¨æ¥è¡¡é‡ä¸¤ä¸ªæ ·æœ¬ç›¸ä¼¼åº¦çš„ç»Ÿè®¡é‡ï¼Œå·²å¹¿æ³›ç”¨äºåˆ†å‰²ç®—æ³•çš„è¯„ä¼°ã€‚ç²¾ç¡®ç‡è¡¡é‡çš„æ˜¯å®é™…æ­£ç¡®çš„é˜³æ€§è¯†åˆ«çš„æ¯”ä¾‹ï¼Œå¬å›ç‡è¡¡é‡çš„æ˜¯ç®—æ³•å¯¹é˜³æ€§æ ·æœ¬çš„æ•æ„Ÿåº¦ã€‚å¯¹äº BraTS 2020 æŒ‘æˆ˜èµ›çš„ 3D åˆ†å‰²ï¼Œåœ¨åœ¨çº¿é—¨æˆ·ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œå¹¶æ ¹æ® Dice æŒ‡æ•°å’Œ 95% Hausdorff è·ç¦»ï¼ˆHDï¼‰å¯¹ç®—æ³•è¿›è¡Œæ’åã€‚\næˆ‘ä»¬ä½¿ç”¨ G è¡¨ç¤ºground truthï¼ŒP è¡¨ç¤ºå¯†é›†é¢„æµ‹ï¼ŒTP è¡¨ç¤ºæ­£ç¡®é¢„æµ‹çš„æ­£æ ·æœ¬ï¼ŒFP è¡¨ç¤ºé”™è¯¯é¢„æµ‹çš„æ­£æ ·æœ¬ï¼ŒTN è¡¨ç¤ºæ­£ç¡®é¢„æµ‹çš„å‰¯æ ·æœ¬ï¼ŒFN è¡¨ç¤ºé”™è¯¯é¢„æµ‹çš„å‰¯æ ·æœ¬ã€‚è¿™äº›æŒ‡æ ‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š\nè¿™ä¸ªHDï¼ˆHausdorff ï¼‰ä¹Ÿæ˜¯ä¸€ç§è¯„ä¼°åˆ†å‰²ç»“æœçš„æ–¹å¼ ï¼ˆalright åˆå¤šäº†ä¸€ç§æŒ‡æ ‡ï¼‰\n4.2 è‚ºéƒ¨ CT åˆ‡ç‰‡ä¸­çš„ COVID-19 ç—…ç¶çš„ 2D å¤šç—…ç¶åˆ†å‰² 1ï¼‰æ•°æ®ï¼šç”±äºå¯ç”¨çš„å¼€æºCOVID-19 CTåˆ†å‰²æ•°æ®é›†é€šå¸¸å¾ˆå°ï¼Œå› æ­¤åˆ©ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„å…¬å¼€å¯ç”¨æ•°æ®é›†ï¼Œå³COVID-19 CTåˆ†å‰²æ•°æ®é›†[27]å’ŒCC-CCIIæ•°æ®é›†[28]æ¥éªŒè¯æ‰€æå‡ºçš„æ–¹æ³•äºŒç»´åˆ†å‰²ä»»åŠ¡ä¸­çš„æ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªæ•°æ®é›†åŒ…å«æ¥è‡ª 40 å¤šåæ‚£è€…çš„ 100 ä¸ªè½´å‘ CT åˆ‡ç‰‡ï¼Œè¿™äº›åˆ‡ç‰‡å·²é‡æ–°ç¼©æ”¾è‡³ 512 Ã— 512 åƒç´ å¹¶è¿›è¡Œç°åº¦åŒ–ã€‚æ‰€æœ‰åˆ‡ç‰‡å‡ç”±æ”¾å°„ç§‘åŒ»ç”Ÿç”¨ä¸åŒçš„æ ‡ç­¾è¿›è¡Œåˆ†å‰²ï¼Œä»¥è¯†åˆ«ä¸åŒç±»å‹çš„è‚ºéƒ¨æ„ŸæŸ“ã€‚ç¬¬äºŒä¸ªæ•°æ®é›†ç”± 150 å COVID-19 æ‚£è€…çš„ 750 å¼  CT åˆ‡ç‰‡ç»„æˆï¼Œè¿™äº›åˆ‡ç‰‡è¢«æ‰‹åŠ¨åˆ†å‰²ä¸ºèƒŒæ™¯ã€è‚ºé‡ã€æ¯›ç»ç’ƒæ··æµŠå’Œå®å˜ã€‚ç”±äºå¹¶éæ‰€æœ‰ 750 ä¸ªåˆ‡ç‰‡éƒ½åŒ…å«ç—…å˜ï¼Œæˆ‘ä»¬æœ€ç»ˆä½¿ç”¨äº† 150 åæ‚£è€…çš„ 549 ä¸ªå¸¦æ³¨é‡Šçš„åˆ‡ç‰‡ã€‚å¯¹äºè¿™ä¸¤ä¸ªæ•°æ®é›†ï¼Œåˆ©ç”¨ 5 å€äº¤å‰éªŒè¯æ¥è¯„ä¼°æ‰€æå‡ºæ¨¡å‹çš„æ€§èƒ½ã€‚\næŠ˜å ä¹‹é—´çš„æ•°æ®æ ¹æ®æ‚£è€…è¿›è¡Œåˆ†å‰²ï¼Œä»¥é¿å…æ½œåœ¨çš„æ•°æ®æ³„æ¼ã€‚æœ€ç»ˆçš„æ ‡ç­¾å’Œåˆ†å‰²å›¾åŒ…å« 3 ä¸ªç±»åˆ«ï¼ŒåŒ…æ‹¬èƒŒæ™¯ã€æ¯›ç»ç’ƒä¸é€æ˜åº¦ (GGO) å’Œåˆå¹¶ (CON.)ã€‚\n2ï¼‰å®ç°ç»†èŠ‚ï¼šaï¼‰æ¨¡å‹è®¾ç½®å’ŒæŸå¤±å‡½æ•°ï¼šå¯¹äºé¢„è®­ç»ƒç½‘ç»œç¼–ç å™¨ï¼Œæˆ‘ä»¬é‡‡ç”¨æ¥è‡ªImageNetçš„é¢„è®­ç»ƒResNeXt-50ï¼ˆ32 Ã— 4dï¼‰[31]ä½œä¸ºåŸºçº¿æ–¹æ³•å’Œæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œçš„ç¼–ç å™¨ã€‚å¯¹äºè§£ç å™¨ä¸­çš„ä¸Šé‡‡æ ·ï¼Œé‡‡ç”¨åŒçº¿æ€§æ’å€¼ï¼Œæ¯”ä¾‹å› å­ä¸º2ã€‚å¯¹äºä¸­é—´ç›‘ç£å’Œçº§è”U-Netç¬¬ä¸€é˜¶æ®µçš„äºŒå…ƒæŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨Dice Loss [13]å’ŒFocalçš„çº¿æ€§ç»„åˆæŸå¤±[32]ä½œä¸ºæŸå¤±å‡½æ•°ã€‚å¯¹äºæœ€ç»ˆè¾“å‡ºçš„å¤šç±»æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨Focal Tversky Loss [33]ä½œä¸ºæŸå¤±å‡½æ•°ã€‚\nb) è®­ç»ƒç»†èŠ‚ï¼šæˆ‘ä»¬çš„æ¨¡å‹æ˜¯åœ¨ Ubuntu 16.04 æœåŠ¡å™¨ä¸Šä½¿ç”¨ PyTorch 1.7.1 æ¡†æ¶å®ç°çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ NVIDIA RTX 2080 Ti GPU æ¥åŠ é€Ÿæˆ‘ä»¬çš„è®­ç»ƒè¿‡ç¨‹ã€‚åœ¨æˆ‘ä»¬çš„è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨Albumentations [34] è¿›è¡Œæ•°æ®å¢å¼ºï¼Œä»¥å‡å°‘è¿‡åº¦æ‹Ÿåˆå¹¶æé«˜æ³›åŒ–èƒ½åŠ›ã€‚é¦–å…ˆï¼Œå°†æ‰€æœ‰è¾“å…¥å›¾åƒé‡æ–°ç¼©æ”¾ä¸º 560 Ã— 560ï¼Œç„¶åè¿›è¡Œéšæœºäº®åº¦å’Œå¯¹æ¯”åº¦åç§»ä»¥åŠéšæœºä»¿å°„å˜æ¢ã€‚ç„¶åå°†å›¾åƒéšæœºè£å‰ªä¸º 512 Ã— 512ï¼Œç„¶åè¿›è¡Œéšæœºå¼¹æ€§å˜æ¢ï¼Œæœ€åè¾“å…¥ç½‘ç»œã€‚è¯¥æ¨¡å‹ç”± Adam ä¼˜åŒ–å™¨ä¼˜åŒ–ï¼ŒÎ²1 = 0.9ã€Î²2 = 0.999ã€Î³ = 1e âˆ’ 8ã€‚L2 æ­£åˆ™åŒ–ä¹Ÿç”¨äºå‡å°‘è¿‡åº¦æ‹Ÿåˆã€‚æˆ‘ä»¬å°†æ¨¡å‹æƒé‡è¡°å‡è®¾ç½®ä¸º 1e âˆ’ 5ã€‚åˆå§‹å­¦ä¹ ç‡è®¾ç½®ä¸º 1e âˆ’4 å¹¶é™ä½ï¼Œç„¶åé‡‡ç”¨ä½™å¼¦é€€ç«ç­–ç•¥ã€‚æ‰¹é‡å¤§å°è®¾ç½®ä¸º 4ï¼Œæ¨¡å‹è®­ç»ƒ 40 è½®ã€‚è¯¥æ¨¡å‹ä½¿ç”¨ 5 å€äº¤å‰éªŒè¯è¿›è¡Œè¯„ä¼°ã€‚\n3ï¼‰å®šé‡ç»“æœï¼šæˆ‘ä»¬åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šçš„å®éªŒä¸­ä¸åŒæ¨¡å‹çš„è¯¦ç»†æ¯”è¾ƒåˆ†åˆ«å¦‚è¡¨ä¸€å’Œè¡¨äºŒæ‰€ç¤ºã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æå‡ºçš„ç½‘ç»œåœ¨æ¯›ç»ç’ƒä¸é€æ˜åº¦å’Œå›ºç»“çš„ Dice åˆ†æ•°æ–¹é¢ä¼˜äº U-Netã€Attention U-Netã€‚æ‰€æå‡ºçš„ PANet ä»¥æ›´å°‘çš„å‚æ•°å’Œè®¡ç®—æˆæœ¬å®ç°äº†ä¸çº§è” U-Net ç«äº‰çš„ç»“æœã€‚ç”±äºè¿™äº›æ¨¡å‹åœ¨æ¨¡å‹ä¸»å¹²å’Œè®­ç»ƒç­–ç•¥ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ‰€æå‡ºçš„æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨ã€ä¸­é—´ç›‘ç£å’Œæ·±åº¦ç›‘ç£çš„ç»„åˆå¯¹åˆ†å‰²æ€§èƒ½æœ‰å¾ˆå¤§è´¡çŒ®ã€‚æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„åˆ©ç”¨æœ‰åŠ©äºæ¨¡å‹æ›´å‡†ç¡®åœ°æ£€æµ‹æ„ŸæŸ“ç»„ç»‡å¹¶ç”Ÿæˆä¸æ„ŸæŸ“ç›¸å…³çš„æ³¨æ„åŠ›å›¾ï¼Œä»è€Œæœ‰åˆ©äºè§£ç å™¨ä¸­çš„å¤šç±»åˆ†å‰²ã€‚\næ­¤å¤–ï¼Œä¸­é—´ç›‘ç£å’Œæ·±åº¦ç›‘ç£çš„å¼•å…¥ä¿ƒè¿›äº†ç½‘ç»œçš„æ”¶æ•›ï¼Œè¿™ä¹Ÿæœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚\nå¥½å¥½å¥½ï¼Œè¿™å“¥ä»¬å„¿ï¼Œçç€çœ¼ç›è¯´çè¯æ˜¯å§ï¼ˆè¿™Unetæ˜æ˜æ¯”ä½ ä½å•Šï¼Œç²¾åº¦ä¹Ÿæ²¡å·®å¤šå°‘å•Šï¼‰\n4ï¼‰å®šæ€§ç»“æœï¼šä¸åŒæ¨¡å‹åœ¨ 2D COVID-19 åˆ‡ç‰‡ä¸Šçš„è§†è§‰æ¯”è¾ƒå¦‚å›¾ 4 æ‰€ç¤ºã€‚ç”±äºæ¨¡å‹åœ¨ Dice åˆ†æ•°æ–¹é¢éå¸¸æ¥è¿‘ï¼Œå› æ­¤ä¹ä¸€çœ‹è¿™äº›æ¨¡å‹çš„è¡¨ç°ç›¸ä¼¼ã€‚ä½†ä¸ U-Net å’Œ Attention U-Net ç›¸æ¯”ï¼Œæ‰€æå‡ºçš„ PANet åœ¨å®å˜å’Œå¾®å°ç—…å˜çš„åˆ†å‰²ä¸Šè¡¨ç°æ›´å¥½ã€‚\nä¸ U-Net å’Œ Attention U-Net ç›¸æ¯”ï¼ŒPANet äº§ç”Ÿæ›´å‡†ç¡®çš„åˆ†å‰²æ©æ¨¡ï¼Œå¹¶ä¸”ä¸ Cascaded U-Net ç›¸æ¯”ï¼Œæ‰€æå‡ºçš„ç½‘ç»œä»¥æ›´å°‘çš„è®¡ç®—æˆæœ¬å®ç°äº†æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚\né¢ åªè¦å®šé‡ç»“æœä¸Šå»äº†ï¼Œå¥½åƒå®šæ€§ç»“æœéƒ½æ˜¯æŒ‘å¥½çš„è¯´å§ï¼Ÿ\n) æ¶ˆèå®éªŒï¼šè¿›è¡Œäº†å‡ æ¬¡æ¶ˆèå®éªŒæ¥è¯„ä¼°æˆ‘ä»¬æ¨¡å‹ä¸­ç»„ä»¶çš„æ€§èƒ½ï¼Œå¦‚è¡¨ III æ‰€ç¤ºã€‚ aï¼‰å…·æœ‰æ·±åº¦ç›‘ç£çš„å¤šç±»è§£ç å™¨çš„æœ‰æ•ˆæ€§ï¼šä¸ºäº†æ¢ç´¢æ·±åº¦ç›‘ç£ç­–ç•¥çš„è´¡çŒ®ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸¤ä¸ªå®éªŒï¼šNo.1ï¼ˆU-Netï¼‰å’ŒNo.2ï¼ˆU-Net + DSï¼‰ã€‚è¡¨ä¸‰çš„ç»“æœè¡¨æ˜ï¼Œæ·±åº¦ç›‘ç£åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹ç»©æ•ˆæœ‰æ‰€è´¡çŒ®ã€‚\nbï¼‰æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„æœ‰æ•ˆæ€§ï¼šæˆ‘ä»¬é€šè¿‡æ„å»ºå®éªŒ 3ï¼ˆU-Net + AGD w/o ISï¼‰æ¥ç ”ç©¶æ‰€æå‡ºçš„ç½‘ç»œä¸­æ‰€æå‡ºçš„æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„æœ‰æ•ˆæ€§ã€‚å¦‚è¡¨IIIæ‰€ç¤ºï¼Œä¸å®éªŒ1ç›¸æ¯”ï¼Œæ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„å¼•å…¥æä¾›äº†æ˜¾ç€çš„æ€§èƒ½æå‡ã€‚è¿™è¡¨æ˜æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨åœ¨æ‰€æå‡ºçš„ç½‘ç»œä¸­æä¾›äº†æœ‰æ•ˆçš„æ³¨æ„åŠ›å›¾ï¼Œä»è€ŒæŒ‡å¯¼è§£ç å™¨ä¸­çš„å¤šç±»åˆ†å‰²ã€‚\ncï¼‰å‚æ•°åŒ–è·³è·ƒè¿æ¥çš„æœ‰æ•ˆæ€§ï¼šä¸ºäº†æ¢ç´¢æ‰€æå‡ºçš„å‚æ•°åŒ–è·³è·ƒè¿æ¥çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸¤ä¸ªå®éªŒ4ï¼ˆU-Net + AGD*ï¼‰å’Œ5ï¼ˆU-Net + AGDï¼‰ã€‚å¼•å…¥å‚æ•°åŒ–è·³è·ƒè¿æ¥åï¼Œåˆ†å‰²æ€§èƒ½å¾—åˆ°äº†æé«˜ï¼Œå‡ ä¹æ²¡æœ‰é¢å¤–çš„å‚æ•°æˆ–è®¡ç®—æˆæœ¬ã€‚\ndï¼‰ä¸­é—´ç›‘ç£çš„æœ‰æ•ˆæ€§ï¼šä¸ºäº†ç ”ç©¶æ‰€æå‡ºçš„ PANet ä¸­ä¸­é—´ç›‘ç£ç­–ç•¥çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†ç¬¬ 3 å·ï¼ˆU-Net + AGD w/o ISï¼‰å’Œç¬¬ 5 å·ï¼ˆU-Net + AGDï¼‰ã€‚å¦‚è¡¨ III æ‰€ç¤ºï¼Œä¸ç¬¬ 3 ç§ç›¸æ¯”ï¼Œå…·æœ‰ä¸­é—´ç›‘ç£çš„ç½‘ç»œè·å¾—äº†é¢å¤–çš„æ”¹è¿›ã€‚æ­¤å¤–ï¼Œåœ¨æ¯”è¾ƒç¬¬ 6 ç§ï¼ˆU-Net + DS + AGD w/o ISï¼‰å’Œç¬¬ 7 ç§ï¼ˆPANetï¼‰æ—¶ä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°æ”¹è¿›ã€‚ ï¼‰å°½ç®¡æ”¹è¿›ç›¸å¯¹è¾ƒå°ã€‚å¯ä»¥çœ‹å‡ºï¼Œæ·±åº¦ç›‘ç®¡çš„å¼•å…¥ä¹Ÿå¯¹ç»©æ•ˆäº§ç”Ÿäº†æå‡ï¼Œå› æ­¤ä¸­çº§ç›‘ç®¡å¯¹ç»©æ•ˆçš„æå‡å¹¶ä¸åƒä»¥å‰é‚£ä¹ˆæ˜¾ç€ã€‚\n4.3 3D Multi-Lesion Segmentation of Brain Tumor From Multi-Modality Brain MRIs 1ï¼‰æ•°æ®ï¼šæˆ‘ä»¬ä½¿ç”¨æ¥è‡ª BraTS 2020 æŒ‘æˆ˜èµ›çš„å¼€æºå¤šæ¨¡æ€ MRI æ•°æ®é›† [29]ã€[36] [37]ã€‚è®­ç»ƒé›†ç”± 369 ä¸ªå¤šå¯¹æ¯” MRI æ‰«æç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ‰«æåŒ…å«å››ç§æ¨¡å¼ï¼Œå³åŸç”Ÿ T1 åŠ æƒã€å¯¹æ¯”å T1 åŠ æƒ (T1Gd)ã€T2 åŠ æƒ (T2) å’Œ T2 æµä½“è¡°å‡åè½¬æ¢å¤ (FLAIR) ï¼‰ã€‚\næ¯æ¬¡æ‰«æéƒ½æœ‰ç›¸åº”çš„ 4 ç±»æ ‡ç­¾ï¼šèƒŒæ™¯ï¼ˆæ ‡ç­¾ 0ï¼‰ã€GD å¢å¼ºè‚¿ç˜¤ï¼ˆETï¼Œæ ‡ç­¾ 4ï¼‰ã€ç˜¤å‘¨æ°´è‚¿ï¼ˆEDï¼Œæ ‡ç­¾ 2ï¼‰ä»¥åŠåæ­»å’Œéå¢å¼ºè‚¿ç˜¤æ ¸å¿ƒï¼ˆNET/ NCRï¼Œæ ‡ç­¾ 1)ã€‚éªŒè¯é›†ç”± 125 ä¸ªå¤šé‡å¯¹æ¯” MRI æ‰«æç»„æˆï¼Œå…¶æ¨¡å¼ä¸è®­ç»ƒé›†å’Œéšè—çš„åŸºæœ¬äº‹å®ç›¸åŒã€‚æ‰€æœ‰ MRI æ‰«æå‡å»é™¤é¢…éª¨ï¼Œä¸ç›¸åŒçš„å¤§è„‘æ¨¡æ¿ (SRI24) å¯¹é½ï¼Œå¹¶æ’å€¼è‡³ 1mm3 åˆ†è¾¨ç‡ã€‚éªŒè¯é˜¶æ®µé€šè¿‡åœ¨çº¿é—¨æˆ·è¿›è¡Œï¼Œç®—æ³•æ ¹æ® 3 ä¸ªé‡å è‚¿ç˜¤åŒºåŸŸçš„æ€§èƒ½è¿›è¡Œæ’åï¼Œå³å¢å¼ºè‚¿ç˜¤ (ET)ã€è‚¿ç˜¤æ ¸å¿ƒ (ET + NET/NCR) å’Œæ•´ä¸ªè‚¿ç˜¤ (ET) + NET/NCR + EDï¼‰\n2ï¼‰å®ç°ç»†èŠ‚ï¼šaï¼‰æ¨¡å‹è®¾ç½®å’ŒæŸå¤±å‡½æ•°ï¼šå¯¹äº3Dåˆ†å‰²ï¼Œç”±äºç¼ºä¹å¼€æºé¢„è®­ç»ƒç¼–ç å™¨ï¼Œæ‰€æœ‰æ¨¡å‹éƒ½æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒçš„ã€‚ä¸‹é‡‡æ ·é€šè¿‡è·¨æ­¥ 3 Ã— 3 Ã— 3 å¡«å……å·ç§¯æ‰§è¡Œï¼Œä¸Šé‡‡æ ·é€šè¿‡ä¸‰çº¿æ€§æ’å€¼å®ç°ã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜åœ¨BraTSæ•°æ®é›†ä¸Šçš„æ€§èƒ½ï¼Œæˆ‘ä»¬é‡‡ç”¨åŸºäºåŒºåŸŸçš„è®­ç»ƒç­–ç•¥ï¼ˆç›´æ¥åœ¨é‡å åŒºåŸŸè€Œä¸æ˜¯ç‹¬ç«‹æ ‡ç­¾ä¸Šä¼˜åŒ–ï¼‰å¹¶å¢å¼ºè‚¿ç˜¤æŠ‘åˆ¶ï¼ˆå¦‚æœå¢å¼ºè‚¿ç˜¤çš„é¢„æµ‹ä½“ç§¯ä¸ºï¼Œåˆ™ç”¨åæ­»æ›¿æ¢é¢„æµ‹çš„å¢å¼ºè‚¿ç˜¤ï¼‰å°äºæŸä¸ªé˜ˆå€¼ï¼‰åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ã€‚å¯¹äºæŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨ Dice Loss [13] å’Œ Cross Entropy Loss çš„çº¿æ€§ç»„åˆä½œä¸ºç½‘ç»œä¸­äºŒåˆ†ç±»å’Œå¤šåˆ†ç±»é˜¶æ®µçš„æŸå¤±å‡½æ•°ã€‚\nb) è®­ç»ƒç»†èŠ‚ï¼šæˆ‘ä»¬çš„æ¨¡å‹æ˜¯åœ¨ Ubuntu æœåŠ¡å™¨ä¸Šä½¿ç”¨ PyTorch 1.7.1 æ¡†æ¶å®ç°çš„ã€‚ç”±äº3Dåˆ†å‰²çš„è®­ç»ƒï¼Œå°¤å…¶æ˜¯çº§è”U-Netå¯¹æ˜¾å­˜çš„è¦æ±‚è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨NVIDIA RTX 2080 Ti GPUå’ŒNVIDIA RTX 3090 GPUåˆ†åˆ«è®­ç»ƒå•ä¸ªæ¨¡å‹å’Œçº§è”æ¨¡å‹ã€‚\nç”±äºè®­ç»ƒè¿‡ç¨‹çš„æ˜¾å­˜å ç”¨å¤§äº11Gbï¼Œæˆ‘ä»¬é‡‡ç”¨PyTorchæ¡†æ¶æä¾›çš„åŸç”Ÿæ··åˆç²¾åº¦è®­ç»ƒç¨‹åºæ¥èŠ‚çœæ˜¾å­˜ä½¿ç”¨å¹¶åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ã€‚äººå·¥æ™ºèƒ½åŒ»å­¦å¼€æ”¾ç½‘ç»œï¼ˆMONAIï¼‰é¡¹ç›®[38]å’ŒTorchIO[39]åˆ†åˆ«ç”¨äºè®­ç»ƒå’Œæ¨ç†é˜¶æ®µçš„æ•°æ®åŠ è½½è¿‡ç¨‹ã€‚æ•°æ®å¢å¼ºæ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€šè¿‡ MONAI é¡¹ç›®è¿›è¡Œçš„ã€‚\né¦–å…ˆï¼Œåˆ†åˆ«ä½¿ç”¨ z åˆ†æ•°æ ‡å‡†åŒ–å¯¹æ‰€æœ‰æ¨¡æ€è¿›è¡Œæ ‡å‡†åŒ–ã€‚ç„¶åé€šè¿‡éšæœºç¿»è½¬ã€éšæœºå¼ºåº¦åç§»ã€éšæœºå¼ºåº¦ç¼©æ”¾å’Œå¼¹æ€§å˜æ¢æ¥å¢å¼ºå›¾åƒã€‚æœ€åï¼Œæˆ‘ä»¬å°†å›¾åƒå—éšæœºè£å‰ªä¸º 128 Ã— 128 Ã— 128 å¹¶å°†å…¶è¾“å…¥ç½‘ç»œã€‚å¯¹äºæ¨ç†ï¼Œæˆ‘ä»¬è¿˜é‡‡ç”¨åŸºäºè¡¥ä¸çš„æ¨ç†ç®¡é“æ¥ç”Ÿæˆ BraTS 2020 éªŒè¯é›†çš„é¢„æµ‹ã€‚é¢ç‰‡å¤§å°è®¾ç½®ä¸º 128 Ã— 128 Ã— 128ï¼Œé¢ç‰‡ä¹‹é—´çš„é‡å è®¾ç½®ä¸º 75%ã€‚é‡å åŒºåŸŸä¸­çš„é¢„æµ‹æ˜¯é‡å å—çš„å¹³å‡å€¼ã€‚è¿™ç§é‡å é…ç½®å¯ä»¥è¢«è§†ä¸ºè‡ªé›†æˆå¹¶äº§ç”Ÿæ›´å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚å¯¹äºæ¨¡å‹è¯„ä¼°ï¼Œæˆ‘ä»¬è¿›è¡Œäº† 2 ä¸ªå•ç‹¬çš„è¯„ä¼°ç¨‹åºæ¥æ¯”è¾ƒåˆ†å‰²æ¨¡å‹çš„æ€§èƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹ BraTS 2020 è®­ç»ƒé›†è¿›è¡Œ 5 å€äº¤å‰éªŒè¯ï¼Œä»¥æ¯”è¾ƒç¦»æ•£åŒºåŸŸï¼ˆå¢å¼ºè‚¿ç˜¤ã€ç˜¤å‘¨æ°´è‚¿å’Œéå¢å¼ºè‚¿ç˜¤æ ¸å¿ƒï¼‰ä¸Šçš„åˆ†å‰²æ€§èƒ½ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯¹ BraTS 2020 éªŒè¯é›†è¿›è¡Œè¯„ä¼°ï¼Œä»¥æ¯”è¾ƒé‡å åŒºåŸŸï¼ˆå¢å¼ºè‚¿ç˜¤ã€è‚¿ç˜¤æ ¸å¿ƒå’Œæ•´ä¸ªè‚¿ç˜¤ï¼‰çš„åˆ†å‰²æ€§èƒ½ï¼Œå…¶ä¸­æˆ‘ä»¬å¯ä»¥å°†æ‰€æå‡ºçš„æ–¹æ³•ä¸æœ€å…ˆè¿›çš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒBraTS æŒ‘æˆ˜ã€‚\n3ï¼‰å®šé‡ç»“æœï¼šBraTS 2020 è®­ç»ƒé›†çš„äº¤å‰éªŒè¯æ€§èƒ½å·²åœ¨è¡¨ IV ä¸­æŠ¥å‘Šã€‚\næ‰€æå‡ºçš„ PANet åœ¨ Dice åˆ†æ•°å’Œ Hausdorff è·ç¦»æ–¹é¢ä¼˜äºæ‰€æœ‰å…¶ä»–ç½‘ç»œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ BraTS 2020 éªŒè¯é›†ä¸Šå¯¹è®­ç»ƒåçš„æ¨¡å‹è¿›è¡Œäº†éªŒè¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å°†æ‰€æå‡ºçš„ç½‘ç»œä¸æ¨¡æ€é…å¯¹å­¦ä¹ ï¼ˆBraTS 2020 ä¸­çš„ Top-2 è§£å†³æ–¹æ¡ˆï¼‰[35] å’Œç ”ç©¶ä¸­çš„ Transformer TransBTS [23] è¿›è¡Œäº†æ¯”è¾ƒï¼Œé™¤äº†åŸºäº U çš„å¸¸ç”¨ç½‘ç»œä¹‹å¤–-ç½‘ã€‚\næ€§èƒ½åˆ—äºè¡¨äº”ä¸­ã€‚æˆ‘ä»¬æå‡ºçš„ PANet åœ¨ BraTS 2020 éªŒè¯é›†ä¸Šä¼˜äº U-Netã€Attention U-Netã€çº§è” U-Net å’Œ TransBTSã€‚æ­¤å¤–ï¼Œæ‰€æå‡ºçš„ PANet åœ¨ BraTS 2020 ä¸Šå®ç°äº†ä¸ Top2 è§£å†³æ–¹æ¡ˆç±»ä¼¼çš„ Dice åˆ†æ•°ï¼Œå¹¶ä¸”å…·æœ‰æ›´å¥½çš„ Hausdorff è·ç¦»ã€‚å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ U-Net ç›¸æ¯”ï¼Œæ‰€æå‡ºçš„ PANet ä»…å¢åŠ äº† 3.9% çš„é¢å¤– GFlopsï¼Œå¹¶ä¸”ä»¥æ›´å°‘çš„è®¡ç®—æˆæœ¬å®ç°äº†æ¯”çº§è” U-Net æ›´å¥½çš„æ€§èƒ½ã€‚è¿™äº›ç»“æœè¡¨æ˜ï¼Œæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œåœ¨ BraTS 2020 æ•°æ®é›†ä¸Šçš„åˆ†å‰²æ€§èƒ½å’Œè®¡ç®—æ•ˆç‡ä¹‹é—´å–å¾—äº†å¤æ‚çš„å¹³è¡¡ã€‚\n4ï¼‰å®šæ€§ç»“æœï¼šæˆ‘ä»¬å¯è§†åŒ–å…·æœ‰ä¸åŒåˆ†å‰²éš¾åº¦çš„ 3 å¹… MRI å›¾åƒï¼Œä»¥å±•ç¤ºä¸åŒæ¨¡å‹çš„æ€§èƒ½ã€‚å¯¹äºæœ€ç®€å•çš„æƒ…å†µï¼ˆBraTS20_Validation_077ï¼‰ï¼Œæ‰€æœ‰æ¨¡å‹éƒ½èƒ½å¤Ÿåˆ†å‰²ç—…å˜ï¼Œè€Œæ‰€æå‡ºçš„ PANet è·å¾—æœ€é«˜çš„åˆ†å‰² Dice åˆ†æ•°ã€‚å¯¹äºæœ‰ä¸€å®šéš¾åº¦çš„ç—…ä¾‹ï¼ˆBraTS20_Validation_028ï¼‰ï¼ŒAttention U-Netå’Œçº§è”U-Netåœ¨æ°´è‚¿åˆ†å‰²æ–¹é¢éƒ½äº§ç”Ÿäº†ä¸¥é‡çš„è¯¯æŠ¥ï¼Œå¯¼è‡´æ•´ä¸ªè‚¿ç˜¤çš„Diceè¯„åˆ†è¾ƒä½ã€‚å¯¹äºæœ€éš¾çš„æƒ…å†µï¼ˆBraTS20_Validation_076ï¼‰ï¼Œç”±äºå¢å¼ºè‚¿ç˜¤çš„å‡é˜³æ€§åˆ†å‰²ï¼ŒU-Netã€Attention U-Net å’Œçº§è” U-Net çš„æ€§èƒ½å¹¶ä¸ä¹è§‚ï¼Œè€Œæ‰€æå‡ºçš„ PANet äº§ç”Ÿäº†æœ€å¥½çš„åˆ†å‰²æ€§èƒ½ã€‚æ‰€æå‡ºçš„ PANet çš„æˆåŠŸå½’åŠŸäºå…·æœ‰ä¸­é—´ç›‘ç£çš„æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨ï¼Œç‰¹å¾å›¾é€šè¿‡ç©ºé—´æ³¨æ„åŠ›å›¾è¿›è¡Œç»†åŒ–ï¼Œè¿™å¯ä»¥é˜²æ­¢æ½œåœ¨çš„è¯¯æŠ¥é¢„æµ‹ã€‚\nå…³äºåŒ»å­¦å½±åƒä¸­çš„è½´ä½é¢ï¼ˆæ¨ªæ–­é¢ï¼‰ã€å† çŠ¶é¢ã€çŸ¢çŠ¶é¢çš„è§£é‡Š\n1.å† çŠ¶é¢ ï¼ˆCoronalï¼‰ï¼Œåˆç§°é¢çŠ¶é¢ã€‚å³ä»å·¦å³æ–¹å‘ï¼Œæ²¿äººä½“çš„é•¿è½´å°†äººä½“çºµåˆ‡ä¸ºå‰ã€åä¸¤éƒ¨åˆ†çš„åˆ‡é¢ã€‚è¿™ç§ææ³•åªæ˜¯ä¸ºäº†åœ¨ä¸´åºŠä¸­å°†å™¨å®˜ä½ç½®æè¿°çš„æ›´å…·ä½“ï¼Œè‹±æ–‡åç§°æ˜¯ï¼šCoronal sectionï¼›\n2.çŸ¢çŠ¶é¢ (Sagittal)å°±æ˜¯æŠŠäººä½“åˆ†æˆå·¦å³ä¸¤é¢çš„è§£å‰–é¢ï¼Œäºè¿™ä¸ªé¢å¹³è¡Œçš„ä¹Ÿæ˜¯çŸ¢çŠ¶é¢ã€‚å‡ºäºè¿™ä¸ªä½ç½®çš„å«çŸ¢çŠ¶ä½ã€‚çŸ¢çŠ¶ä½çš„è‹±æ–‡åç§°æ˜¯ï¼šMedian sagittal sectionï¼›\n3.æ°´å¹³ä½ (Axial)åˆç§°æ¨ªæ–­ä½ï¼Œå³å·¦å³ã€å‰åæ„æˆçš„é¢ä¸ºæ°´å¹³ä½ï¼Œè‹±æ–‡åç§°æ˜¯:Transverse sectionã€‚\n5ï¼‰æ¶ˆèåˆ†æï¼šåœ¨ BraTS 2020 éªŒè¯æ•°æ®é›†ä¸Šä¹Ÿè¿›è¡Œäº†ä¸ 2D åˆ†å‰²ç±»ä¼¼çš„æ¶ˆèå®éªŒï¼Œä»¥è¯„ä¼°æˆ‘ä»¬æ¨¡å‹ä¸­å‘ˆç°çš„ç»„ä»¶çš„æœ‰æ•ˆæ€§ï¼Œå¦‚è¡¨å…­æ‰€ç¤ºã€‚\naï¼‰å…·æœ‰æ·±åº¦ç›‘ç£çš„å¤šç±»è§£ç å™¨çš„æœ‰æ•ˆæ€§ï¼šæˆ‘ä»¬é€šè¿‡å‘ç½‘ç»œè§£ç å™¨å¼•å…¥æ·±åº¦ç›‘ç£æ¥æ„å»ºå®éªŒ2ï¼ˆU-Net + DSï¼‰ã€‚ä¸åŸºçº¿ï¼ˆNo.1ï¼‰ç›¸æ¯”ï¼Œå®éªŒNo.2åœ¨å¢å¼ºè‚¿ç˜¤ã€è‚¿ç˜¤æ ¸å¿ƒå’Œæ•´ä¸ªè‚¿ç˜¤çš„åˆ†å‰²æ€§èƒ½æ–¹é¢æä¾›äº†ä¸€å®šç¨‹åº¦çš„æ€§èƒ½æå‡ã€‚æ­¤å¤–ï¼Œå½“å¼•å…¥æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ€§èƒ½çš„æé«˜ï¼ˆç¬¬3å’Œç¬¬6ï¼‰ã€‚\nb) æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„æœ‰æ•ˆæ€§ï¼šæˆ‘ä»¬æ„å»ºå®éªŒ 3ï¼ˆU-Net + AGD w/o ISï¼‰æ¥ç ”ç©¶æ‰€æå‡ºçš„ç½‘ç»œä¸­æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨çš„æœ‰æ•ˆæ€§ã€‚ä¸åŸºçº¿ç›¸æ¯”ï¼Œæ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨åœ¨å¢å¼ºè‚¿ç˜¤å’Œè‚¿ç˜¤æ ¸å¿ƒçš„åˆ†å‰²æ€§èƒ½æ–¹é¢äº§ç”Ÿäº†æ˜¾ç€çš„æ”¹å–„ã€‚è¿™è¡¨æ˜æ³¨æ„åŠ›å¼•å¯¼è§£ç å™¨å¯¹ä»ç¼–ç å™¨æå–çš„ç‰¹å¾å›¾äº§ç”Ÿæœ‰æ•ˆçš„æ³¨æ„åŠ›ï¼Œä»è€Œæ›´å®¹æ˜“åŒºåˆ†ç—…å˜ã€‚\ncï¼‰å‚æ•°åŒ–è·³è·ƒè¿æ¥çš„æœ‰æ•ˆæ€§ï¼šæˆ‘ä»¬å»ºç«‹äº†ä¸¤ä¸ªå®éªŒNo.4ï¼ˆU-Net + AGD*ï¼‰å’ŒNo.5ï¼ˆUNet + AGDï¼‰æ¥æ¢ç´¢æ‰€æå‡ºçš„å‚æ•°åŒ–è·³è·ƒè¿æ¥çš„æœ‰æ•ˆæ€§ã€‚å¼•å…¥å‚æ•°åŒ–è·³è·ƒè¿æ¥åï¼Œåœ¨å¢å¼ºè‚¿ç˜¤å’Œè‚¿ç˜¤æ ¸å¿ƒæ–¹é¢åˆ†å‰²æ€§èƒ½æœ‰æ‰€æé«˜ï¼Œä½†æ•´ä¸ªè‚¿ç˜¤çš„åˆ†å‰²æ€§èƒ½ç•¥æœ‰ä¸‹é™ã€‚\ndï¼‰ä¸­é—´ç›‘ç£çš„æœ‰æ•ˆæ€§ï¼šæˆ‘ä»¬é€šè¿‡æ¯”è¾ƒè¡¨å…­ä¸­çš„ç¬¬3å·å’Œç¬¬5å·æ¥è°ƒæŸ¥ä¸­é—´ç›‘ç£ç­–ç•¥çš„æœ‰æ•ˆæ€§ã€‚åœ¨No.5ï¼ˆU-Net + AGDï¼‰ä¸­ï¼Œé€šè¿‡å¼•å…¥ä¸­é—´ç›‘ç£ï¼Œå¢å¼ºè‚¿ç˜¤å’Œè‚¿ç˜¤æ ¸å¿ƒçš„Diceå¾—åˆ†æ˜¾ç€æé«˜ã€‚ä½†æ˜¯å½“å¼•å…¥æ·±åº¦ç›‘ç£æ—¶ï¼Œä¸­é—´ç›‘ç£çš„æ€§èƒ½æå‡å¹¶ä¸åƒä»¥å‰é‚£ä¹ˆæ˜¾ç€ï¼ˆç¬¬6å’Œç¬¬7ï¼‰ï¼Œè¿™ä¸2Dåˆ†å‰²æƒ…å†µç±»ä¼¼ã€‚\nDISCUSSION AND CONCLUSION å¤šç—…ç¶åˆ†å‰²åœ¨ä¸´åºŠåœºæ™¯ä¸­å…·æœ‰é‡è¦æ„ä¹‰ï¼Œå› ä¸ºæŸç§ç–¾ç—…å¯èƒ½åŒæ—¶å‘ç”Ÿå¤šç§ç±»å‹çš„æ„ŸæŸ“ï¼Œä¸åŒæ„ŸæŸ“é˜¶æ®µçš„æ‚£è€…å¯èƒ½ä¼šå‡ºç°ä¸åŒç±»å‹çš„ç—…ç¶ã€‚ä¾‹å¦‚ï¼Œç£¨ç»ç’ƒæ ·æ··æµŠï¼ˆGGOï¼‰å’Œå®å˜ï¼ˆCON.ï¼‰æ˜¯COVID-19æ‚£è€…å…¸å‹çš„è‚ºéƒ¨ç—…å˜ï¼Œå‰è€…é€šå¸¸å‘ç”Ÿåœ¨æ—©æœŸæ‚£è€…ï¼Œè€Œåè€…çš„å¢åŠ å¯èƒ½è¡¨æ˜ç—…æƒ…æ¶åŒ–ã€‚èƒ¶è´¨ç˜¤å¯åˆ†ä¸ºä½çº§åˆ«èƒ¶è´¨ç˜¤ï¼ˆLGGï¼‰å’Œèƒ¶è´¨æ¯ç»†èƒç˜¤ï¼Œå³é«˜çº§åˆ«èƒ¶è´¨ç˜¤ï¼ˆGBM/HGGï¼‰ï¼Œå¹¶ä¸”åœ¨å‘ç”ŸHGGçš„æ‚£è€…ä¸­æ›´æœ‰å¯èƒ½å‘ç°å¼ºåŒ–è‚¿ç˜¤ã€‚å› æ­¤ï¼Œå¤šç—…ç¶åˆ†å‰²åœ¨æ‚£è€…çš„ç­›æŸ¥å’Œé¢„åæ–¹é¢å…·æœ‰å·¨å¤§çš„æ½œåŠ›ã€‚\nå¤šç—…ç¶åˆ†å‰²é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºç²—åˆ†å‰²å’Œç»†åˆ†å‰²ï¼Œç²—åˆ†å‰²æ˜¯å¯¹ç—…ç¶è¿›è¡Œç²—ç•¥åˆ†å‰²ï¼Œè€Œç»†åˆ†å‰²åˆ™åŸºäºå‰ä¸€åˆ†å‰²ï¼Œä»¥äº§ç”Ÿæœ€ç»ˆçš„åˆ†å‰²å›¾ã€‚çº§è”ç½‘ç»œå¹¿æ³›ç”¨äºå¤šç—…å˜åˆ†å‰²ä»»åŠ¡ï¼Œå› ä¸ºè¿™äº›ç®—æ³•èƒŒåçš„é€»è¾‘éå¸¸è‡ªç„¶ã€‚ç„¶è€Œï¼Œçº§è”ç½‘ç»œåœ¨æ½œåœ¨çš„ä¸´åºŠéƒ¨ç½²ä¸­å—åˆ°é™åˆ¶ï¼Œå› ä¸ºå®ƒä»¬ç¼ºä¹çµæ´»æ€§å¹¶ä¸”å¯¹è®¡ç®—èµ„æºçš„è¦æ±‚å¾ˆé«˜ã€‚ä¸ç°æœ‰çš„çº§è”ç½‘ç»œç›¸æ¯”ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ç§å…ˆéªŒæ³¨æ„ç½‘ç»œï¼Œå®ƒå°†ç²—åˆ†å‰²å’Œç»†åˆ†å‰²é›†æˆåˆ°ä¸€ä¸ªç½‘ç»œä¸­ã€‚æˆ‘ä»¬æå‡ºçš„ç½‘ç»œæ¶æ„çš„ä¼˜ç‚¹æ˜¯åˆ†å‰²æ€§èƒ½å’Œè®¡ç®—æ•ˆç‡çš„å¹³è¡¡ã€‚é€šè¿‡å°†åˆ†å‰²çš„ä¸¤ä¸ªæ­¥éª¤ç»“åˆåœ¨ä¸€ä¸ªç½‘ç»œä¸­ï¼Œæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œèƒ½å¤Ÿå®ç°å¤šç—…ç¶åˆ†å‰²çš„ç«¯åˆ°ç«¯è®­ç»ƒï¼Œåœ¨è®­ç»ƒå’Œæ¨ç†æ–¹é¢éƒ½å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶ä¸”åœ¨ä¸´åºŠéƒ¨ç½²ä¸­å…·æœ‰æ›´å¤§çš„æ½œåŠ›ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è®¾æ³•ä¿æŒæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œçš„æ€§èƒ½ï¼Œåœ¨åˆ†å‰²æ€§èƒ½å’Œè¿è¡Œæ•ˆç‡ä¹‹é—´å®ç°å¤æ‚çš„å¹³è¡¡ã€‚\nä¸çº§è” U-Net ç›¸æ¯”ï¼Œæˆ‘ä»¬æå‡ºçš„å…ˆéªŒæ³¨æ„åŠ›ç½‘ç»œåœ¨ 2D å’Œ 3D ä»»åŠ¡ä¸­éƒ½å®ç°äº†æ›´å¥½çš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚\næ€»ä¹‹ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„åˆ†å‰²ç½‘ç»œï¼Œå³å…ˆéªŒæ³¨æ„ç½‘ç»œï¼Œç”¨äºåŒ»å­¦å›¾åƒä¸­çš„å¤šç—…ç¶åˆ†å‰²ã€‚å—æµè¡Œçš„ä»ç²—åˆ°ç»†ç­–ç•¥çš„å¯å‘ï¼Œæˆ‘ä»¬é€šè¿‡ç©ºé—´æ³¨æ„æœºåˆ¶å°†çº§è”ç½‘ç»œçš„ä¸¤ä¸ªæ­¥éª¤èšåˆæˆä¸€ä¸ªç½‘ç»œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§æ–°é¢–çš„ä¸­é—´ç›‘ç£æœºåˆ¶æ¥æŒ‡å¯¼ä¸ç—…å˜ç›¸å…³çš„æ³¨æ„å›¾çš„ç”Ÿæˆï¼Œè¿™å¯ä»¥æŒ‡å¯¼è§£ç å™¨ä¸­çš„åç»­å¤šç±»åˆ†å‰²ã€‚æ‰€æå‡ºçš„ç½‘ç»œåœ¨ 2D å’Œ 3D åŒ»å­¦å›¾åƒï¼ˆåŒ…æ‹¬ CT æ‰«æå’Œå¤šæ¨¡æ€ MRIï¼‰ä¸Šè¿›è¡Œè¯„ä¼°ã€‚å¯¹äº 2D åˆ†å‰²ï¼Œä¸çº§è” U-Net ç›¸æ¯”ï¼Œæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„åŠ›ç½‘ç»œä»¥æ›´å°‘çš„è®¡ç®—æˆæœ¬è·å¾—äº†æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚å¯¹äº 3D è„‘è‚¿ç˜¤åˆ†å‰²ï¼Œæ‰€æå‡ºçš„å…ˆéªŒæ³¨æ„ç½‘ç»œåœ¨ BraTS 2020 éªŒè¯æ•°æ®é›†ä¸Šäº§ç”Ÿäº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œå¹¶ä¸”ä¼˜äºåŸºäº U-Net çš„å…¶ä»–åŸºçº¿æ–¹æ³•ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œè¯¥æ–¹æ³•åœ¨åŒ»å­¦å½±åƒä¸­çš„è®¸å¤šå¤šç—…ç¶åˆ†å‰²ä»»åŠ¡ä¸­å…·æœ‰å·¨å¤§çš„åº”ç”¨æ½œåŠ›ï¼Œä¸äºŒå…ƒåˆ†å‰²ç›¸æ¯”å¯ä»¥æä¾›æ›´å¤šä¿¡æ¯ï¼Œå¹¶æœ‰åŠ©äºåŒ»ç”Ÿæœªæ¥çš„ä¸´åºŠè¯Šæ–­ã€‚\n","permalink":"https://swimmingliu.cn/posts/papernotes/2022-priorattentionnetwork/","summary":"\u003ch1 id=\"prior-attention-network-ç”¨äºåŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„é¢„å…ˆæ³¨æ„ç½‘ç»œ\"\u003ePrior Attention Network: ç”¨äºåŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„é¢„å…ˆæ³¨æ„ç½‘ç»œ\u003c/h1\u003e\n\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåŒ»å­¦å›¾åƒä¸­é‚»è¿‘ç»„ç»‡çš„å¤šç§ç±»å‹ç—…å˜çš„å‡†ç¡®åˆ†å‰²åœ¨ä¸´åºŠå®è·µä¸­å…·æœ‰é‡è¦æ„ä¹‰ã€‚åŸºäºä»\u003cstrong\u003eç²—åˆ°ç²¾ç­–ç•¥çš„å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰\u003cstrong\u003eå·²å¹¿æ³›åº”ç”¨äºè¯¥é¢†åŸŸã€‚ç„¶è€Œï¼Œç”±äº\u003c/strong\u003eç»„ç»‡çš„å¤§å°ã€å¯¹æ¯”åº¦å’Œé«˜ç±»é—´ç›¸ä¼¼æ€§çš„ä¸ç¡®å®šæ€§\u003c/strong\u003eï¼Œå¤šç—…ç¶åˆ†å‰²ä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ã€‚æ­¤å¤–ï¼Œ\u003cstrong\u003eæ™®éé‡‡ç”¨çš„çº§è”ç­–ç•¥\u003c/strong\u003eå¯¹\u003cstrong\u003eç¡¬ä»¶è¦æ±‚è¾ƒé«˜\u003c/strong\u003eï¼Œé™åˆ¶äº†ä¸´åºŠéƒ¨ç½²çš„æ½œåŠ›ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„å…ˆéªŒæ³¨æ„ç½‘ç»œï¼ˆPANetï¼‰ï¼Œå®ƒ\u003cstrong\u003eéµå¾ªä»ç²—åˆ°ç»†çš„ç­–ç•¥\u003c/strong\u003eæ¥åœ¨åŒ»å­¦å›¾åƒä¸­æ‰§è¡Œå¤šç—…ç¶åˆ†å‰²ã€‚æ‰€æå‡ºçš„ç½‘ç»œé€šè¿‡åœ¨ç½‘ç»œä¸­\u003cstrong\u003eæ’å…¥ä¸ç—…å˜ç›¸å…³çš„ç©ºé—´æ³¨æ„æœºåˆ¶\u003c/strong\u003eï¼Œåœ¨å•ä¸ªç½‘ç»œä¸­å®ç°äº†\u003cstrong\u003eä¸¤ä¸ªæ­¥éª¤çš„åˆ†å‰²\u003c/strong\u003eã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æå‡ºäº†\u003cstrong\u003eä¸­é—´ç›‘ç£ç­–ç•¥\u003c/strong\u003eï¼Œç”¨äº\u003cstrong\u003eç”Ÿæˆä¸ç—…å˜ç›¸å…³çš„æ³¨æ„åŠ›\u003c/strong\u003eæ¥è·å–\u003cstrong\u003eæ„Ÿå…´è¶£åŒºåŸŸï¼ˆROIï¼‰\u003c/strong\u003eï¼Œè¿™åŠ é€Ÿäº†æ”¶æ•›å¹¶æ˜æ˜¾æé«˜äº†åˆ†å‰²æ€§èƒ½ã€‚æˆ‘ä»¬åœ¨ä¸¤ä¸ªåº”ç”¨ä¸­ç ”ç©¶äº†æ‰€æå‡ºçš„åˆ†å‰²æ¡†æ¶ï¼š\u003cstrong\u003eè‚ºéƒ¨ CT åˆ‡ç‰‡\u003c/strong\u003eä¸­å¤šå‘æ€§\u003cstrong\u003eè‚ºéƒ¨æ„ŸæŸ“çš„ 2D åˆ†å‰²\u003c/strong\u003eå’Œ\u003cstrong\u003eè„‘ MRI ä¸­å¤šå‘æ€§ç—…å˜çš„ 3D åˆ†å‰²\u003c/strong\u003eã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œä¸çº§è”ç½‘ç»œç›¸æ¯”ï¼Œåœ¨ 2D å’Œ 3D åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æå‡ºçš„ç½‘ç»œä»¥æ›´å°‘çš„è®¡ç®—æˆæœ¬å®ç°äº†æ›´å¥½çš„æ€§èƒ½ã€‚æ‰€æå‡ºçš„ç½‘ç»œå¯ä»¥è¢«è§†ä¸º 2D å’Œ 3D ä»»åŠ¡ä¸­å¤šç—…ç¶åˆ†å‰²çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚æºä»£ç å¯åœ¨ \u003ca href=\"https://github.com/hsiangyuzhao/PANet\"\u003ehttps://github.com/hsiangyuzhao/PANet\u003c/a\u003e è·å–\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eé—®é¢˜å¯¼å‘ï¼š\u003c/p\u003e\n\u003cp\u003eâ‘ \u003cstrong\u003eç»„ç»‡çš„å¤§å°ã€å¯¹æ¯”åº¦å’Œé«˜ç±»é—´ç›¸ä¼¼æ€§çš„ä¸ç¡®å®šæ€§\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eâ‘¡å¤šç±»åˆ«ç—…ç¶åˆ†å‰²\u003c/p\u003e\n\u003cp\u003eâ‘¢\u003cstrong\u003eæ™®éé‡‡ç”¨çš„çº§è”ç­–ç•¥\u003c/strong\u003eå¯¹\u003cstrong\u003eç¡¬ä»¶è¦æ±‚è¾ƒé«˜\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eåŒ»å­¦å›¾åƒåˆ†å‰²å¯¹äºç–¾ç—…çš„å‡†ç¡®ç­›æŸ¥å’Œæ‚£è€…çš„é¢„åå…·æœ‰é‡è¦æ„ä¹‰ã€‚åŸºäºç—…ç¶åˆ†å‰²çš„ç—…ç¶è¯„ä¼°æä¾›äº†ç–¾ç—…è¿›å±•çš„ä¿¡æ¯ï¼Œå¸®åŠ©åŒ»ç”Ÿæé«˜ä¸´åºŠè¯Šæ–­å’Œæ²»ç–—çš„è´¨é‡ã€‚ç„¶è€Œï¼Œæ‰‹åŠ¨ç—…å˜åˆ†å‰²ç›¸å½“ä¸»è§‚ä¸”è´¹åŠ›ï¼Œè¿™é™åˆ¶äº†å…¶æ½œåœ¨çš„ä¸´åºŠåº”ç”¨ã€‚è¿‘å¹´æ¥ï¼Œéšç€äººå·¥æ™ºèƒ½çš„å¿«é€Ÿå‘å±•ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„ç®—æ³•å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå¹¶åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹é¢å–å¾—äº†æœ€å…ˆè¿›çš„æ€§èƒ½[1]\u003c/strong\u003eã€‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ç”±äºå…¶é«˜åˆ†å‰²è´¨é‡è€Œåœ¨åŒ»å­¦å›¾åƒä¸­çš„ç—…å˜åˆ†å‰²ä¸­å¾ˆå—æ¬¢è¿ã€‚æ­¤ç±»ç®—æ³•é€šå¸¸å…·æœ‰\u003cstrong\u003eæ·±åº¦ç¼–ç å™¨\u003c/strong\u003eï¼Œå¯ä»è¾“å…¥å›¾åƒä¸­è‡ªåŠ¨æå–ç‰¹å¾ï¼Œå¹¶é€šè¿‡ä»¥ä¸‹æ“ä½œ\u003cstrong\u003eç”Ÿæˆå¯†é›†é¢„æµ‹\u003c/strong\u003eã€‚ä¾‹å¦‚ï¼ŒLongç­‰äºº[2]æå‡ºäº†ä¸€ç§ç”¨äºå›¾åƒè¯­ä¹‰åˆ†å‰²çš„å…¨å·ç§¯ç½‘ç»œï¼Œè¯¥ç½‘ç»œé¢‡å…·å½±å“åŠ›ï¼Œå¹¶å¯å‘äº†åæ¥çš„åŒ»å­¦åˆ†å‰²ä¸­çš„ç«¯åˆ°ç«¯æ¡†æ¶ã€‚ Ronnebergerç­‰äºº[3]æå‡ºäº†ä¸€ç§ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„Uå½¢ç½‘ç»œï¼ˆU-Netï¼‰ï¼Œè¯¥ç½‘ç»œåœ¨åŒ»å­¦åˆ†å‰²çš„è®¸å¤šé¢†åŸŸéƒ½æ˜¾ç¤ºå‡ºäº†å¯å–œçš„ç»“æœï¼Œå¹¶å·²æˆä¸ºè®¸å¤šåŒ»å­¦åˆ†å‰²ä»»åŠ¡çš„è™šæ‹ŸåŸºå‡†ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eè¿™ä¸€æ®µéƒ½å¯ä»¥å½“æˆç»å…¸åŒ»å­¦å›¾åƒåˆ†å‰²çš„èƒŒæ™¯å¼•å…¥\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eç„¶è€Œï¼Œå°½ç®¡åŒ»å­¦åˆ†å‰²å–å¾—äº†è¿™äº›çªç ´ï¼Œä½†ç›®å‰çš„\u003cstrong\u003eåŒ»å­¦åˆ†å‰²æ–¹æ³•ä¸»è¦é›†ä¸­åœ¨ç—…ç¶çš„äºŒå…ƒåˆ†å‰²ä¸Š\u003c/strong\u003eï¼Œå³\u003cstrong\u003eåŒºåˆ†ç—…ç¶ï¼ˆå‰æ™¯ï¼‰å’Œå…¶ä»–ä¸€åˆ‡ï¼ˆèƒŒæ™¯ï¼‰\u003c/strong\u003eã€‚å°½ç®¡äºŒå…ƒåˆ†å‰²ç¡®å®æœ‰åŠ©äº\u003cstrong\u003eéš”ç¦»æŸäº›æ„Ÿå…´è¶£åŒºåŸŸ\u003c/strong\u003eå¹¶å…è®¸å¯¹\u003cstrong\u003eåŒ»å­¦å›¾åƒè¿›è¡Œç²¾ç¡®åˆ†æ\u003c/strong\u003eï¼Œä½†åœ¨æŸäº›éœ€è¦\u003cstrong\u003eå¯¹ç—…å˜è¿›è¡Œå¤šç±»åˆ†å‰²çš„åœºæ™¯ä¸­ï¼ŒäºŒå…ƒåˆ†å‰²è¿˜ä¸å¤Ÿ\u003c/strong\u003eã€‚ä¸äºŒå…ƒåˆ†å‰²ç›¸æ¯”ï¼Œç”±äº\u003cstrong\u003eç»„ç»‡çš„ç±»é—´ç›¸ä¼¼æ€§ï¼Œè¿™ç§æƒ…å†µè¦å›°éš¾å¾—å¤š\u003c/strong\u003eï¼Œå› ä¸º\u003cstrong\u003eä¸åŒç±»å‹çš„ç—…å˜åœ¨çº¹ç†ã€å¤§å°å’Œå½¢çŠ¶ä¸Šå¯èƒ½ç›¸ä¼¼\u003c/strong\u003eã€‚å…·æœ‰ä»ç²—åˆ°ç»†ç­–ç•¥çš„çº§è”ç½‘ç»œå·²å¹¿æ³›åº”ç”¨äºæ­¤ç±»åœºæ™¯ï¼Œä¾‹å¦‚\u003cstrong\u003eè‚è„å’Œç—…å˜çš„åˆ†å‰²ã€è„‘è‚¿ç˜¤åˆ†å‰²\u003c/strong\u003e[4]ã€[5][6]ã€[7]ã€‚\u003c/p\u003e\n\u003cp\u003eæ­¤ç±»ç½‘ç»œé€šå¸¸ç”±ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œç»„æˆï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª\u003cstrong\u003eç½‘ç»œæ‰§è¡Œç²—åˆ†å‰²ï¼Œç¬¬äºŒä¸ªç½‘ç»œåŸºäºä»ç¬¬ä¸€ä¸ªç½‘ç»œåˆ†å‰²çš„ ROI ç»†åŒ–åˆ†å‰²\u003c/strong\u003eã€‚ç„¶è€Œï¼Œå°½ç®¡\u003cstrong\u003eçº§è”ç½‘ç»œ\u003c/strong\u003eå·²å¹¿æ³›åº”ç”¨äºåŒ»å­¦å›¾åƒçš„\u003cstrong\u003eå¤šç—…ç¶åˆ†å‰²\u003c/strong\u003eï¼Œä½†çº§è”ç­–ç•¥ä¹Ÿæœ‰å…¶ç¼ºç‚¹ã€‚ç”±äº\u003cstrong\u003eçº§è”ç½‘ç»œç”±ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œç»„æˆ\u003c/strong\u003eï¼Œ\u003cstrong\u003eå‚æ•°é‡å’Œæ˜¾å­˜å ç”¨é€šå¸¸æ˜¯å•ä¸ªç½‘ç»œçš„ä¸¤å€\u003c/strong\u003eï¼Œè¿™å¯¹ç¡¬ä»¶è¦æ±‚è¾ƒé«˜ï¼Œé™åˆ¶äº†å…¶åœ¨ä¸´åºŠä½¿ç”¨çš„æ½œåŠ›ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç”±äºçº§è”ç½‘ç»œä¸­çš„ä¸¤ä¸ªç½‘ç»œé€šå¸¸æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤\u003cstrong\u003eçº§è”ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹æœ‰æ—¶æ¯”å•ä¸ªç½‘ç»œæ›´å›°éš¾\u003c/strong\u003eï¼Œè¿™å¯èƒ½å¯¼è‡´æ¬ æ‹Ÿåˆã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eçº§è”ç½‘ç»œï¼šå‚æ•°é‡å¤§ã€å®¹æ˜“æ¬ æ‹Ÿåˆã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§åä¸ºå…ˆéªŒæ³¨æ„ç½‘ç»œï¼ˆPANetï¼‰çš„æ–°å‹ç½‘ç»œç»“æ„ï¼Œç”¨äºåœ¨åŒ»å­¦å›¾åƒä¸­æ‰§è¡Œ\u003cstrong\u003eå¤šç—…ç¶åˆ†å‰²\u003c/strong\u003eã€‚æ‰€æå‡ºçš„ç½‘ç»œç”±\u003cstrong\u003eä¸€ä¸ª\u003c/strong\u003eç”¨äº\u003cstrong\u003eç‰¹å¾æå–çš„ç¼–ç å™¨\u003c/strong\u003eå’Œ\u003cstrong\u003eä¸¤ä¸ªåˆ†åˆ«ç”Ÿæˆç—…å˜åŒºåŸŸæ³¨æ„åŠ›å’Œæœ€ç»ˆé¢„æµ‹çš„è§£ç å™¨ç»„æˆ\u003c/strong\u003eã€‚è¯¥ç½‘ç»œä¸\u003cstrong\u003eæ³¨æ„åŠ›æœºåˆ¶\u003c/strong\u003eç»“åˆåœ¨ä¸€èµ·ã€‚ä¸ºäº†\u003cstrong\u003eå‡å°‘å‚æ•°å¤§å°å’Œç¡¬ä»¶\u003c/strong\u003eå ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨\u003cstrong\u003eç½‘ç»œç¼–ç å™¨çš„æ·±å±‚ã€è¯­ä¹‰ä¸°å¯Œçš„ç‰¹å¾\u003c/strong\u003eæ¥\u003cstrong\u003eç”Ÿæˆç—…å˜åŒºåŸŸçš„ç©ºé—´æ³¨æ„åŠ›\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åï¼Œ\u003cstrong\u003eç¼–ç å™¨ç”Ÿæˆçš„ç‰¹å¾\u003c/strong\u003eè¡¨ç¤ºé€šè¿‡\u003cstrong\u003eç©ºé—´æ³¨æ„åŠ›\u003c/strong\u003eè¿›è¡Œç»†åŒ–ï¼Œå¹¶å°†å…¶å‘é€åˆ°è§£ç å™¨ä»¥è¿›è¡Œ\u003cstrong\u003eæœ€ç»ˆçš„å¤šç±»é¢„æµ‹\u003c/strong\u003eã€‚ä¸ºäº†\u003cstrong\u003eæé«˜åˆ†å‰²æ€§èƒ½å¹¶åŠ é€Ÿæ”¶æ•›\u003c/strong\u003eï¼Œæˆ‘ä»¬è¿˜åœ¨ç½‘ç»œç»“æ„ä¸­å¼•å…¥äº†\u003cstrong\u003eä¸­é—´ç›‘ç£å’Œæ·±åº¦ç›‘ç£\u003c/strong\u003eã€‚é€šè¿‡è¿™äº›æ”¹è¿›ï¼Œä¸ä¼ ç»Ÿçš„çº§è”ç½‘ç»œç›¸æ¯”ï¼Œæ‰€æå‡ºçš„ç½‘ç»œä»¥\u003cstrong\u003eæ˜¾ç€é™ä½çš„å‚æ•°å¤§å°å’Œè®¡ç®—æˆæœ¬\u003c/strong\u003eå®ç°äº†æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eåˆ©ç”¨ç½‘ç»œç¼–ç å™¨çš„æ·±å±‚ã€ç‰¹å¾ä¿¡æ¯æ¥ç”Ÿæˆç©ºé—´æ³¨æ„åŠ›ï¼ˆWTF ???ï¼‰\u003c/p\u003e\n\u003cp\u003eä¸­é—´ç›‘ç£ã€æ·±åº¦ç›‘ç£ ï¼ˆä¸é”™ä¸é”™ï¼Œ å¥½å¤šä¸€åŒºå’Œé¡¶ä¼šçš„æ–‡ç« éƒ½ç”¨æ·±åº¦ç›‘ç£ï¼‰\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eè¿™é¡¹å·¥ä½œçš„è´¡çŒ®ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ã€‚\u003cstrong\u003eé¦–å…ˆ\u003c/strong\u003eï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„ç½‘ç»œæ¶æ„ï¼Œé€šè¿‡å°†ä¼ ç»Ÿçº§è”ç½‘ç»œä¸­çš„ä¸¤ä¸ªåˆ†å‰²æ­¥éª¤ç»“åˆåœ¨\u003cstrong\u003eå•ä¸ªç½‘ç»œ\u003c/strong\u003eä¸­ï¼Œéµå¾ª 2D å’Œ 3D åŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„\u003cstrong\u003eä»ç²—åˆ°ç»†çš„ç­–ç•¥\u003c/strong\u003eã€‚ä¸çº§è”ç½‘ç»œç›¸æ¯”ï¼Œæ‰€æå‡ºçš„æ¶æ„ä»¥æ›´å°‘çš„é¢å¤–è®¡ç®—æˆæœ¬å®ç°äº†æœ‰ç«äº‰åŠ›çš„åˆ†å‰²æ€§èƒ½ï¼Œæ›´å®¹æ˜“è®­ç»ƒå’Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\u003cstrong\u003eå…¶æ¬¡\u003c/strong\u003eï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§\u003cstrong\u003eç›‘ç£ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶\u003c/strong\u003eï¼Œå°†\u003cstrong\u003eç—…å˜åŒºåŸŸçš„æ³¨æ„åŠ›ä¸ç½‘ç»œæå–çš„ç‰¹å¾ç›¸ç»“åˆ\u003c/strong\u003eï¼Œå°†å¤šç—…å˜åˆ†å‰²åˆ†è§£ä¸º\u003cstrong\u003eä¸¤ä¸ªæ›´å®¹æ˜“çš„é˜¶æ®µ\u003c/strong\u003eï¼Œå¹¶ä¸”ä¸å½“å‰\u003cstrong\u003eåŸºäºæ³¨æ„åŠ›çš„æ–¹æ³•ç›¸æ¯”å…·æœ‰æ›´å¥½çš„å¯è§£é‡Šæ€§\u003c/strong\u003eã€‚\u003cstrong\u003eç¬¬ä¸‰\u003c/strong\u003eï¼Œæ‰€æå‡ºçš„ç½‘ç»œå·²åœ¨ä¸¤ä¸ªå®é™…åº”ç”¨ä¸­å¾—åˆ°éªŒè¯ï¼Œ\u003cstrong\u003eåŒ…æ‹¬è‚ºéƒ¨ CT åˆ‡ç‰‡ä¸­çš„ COVID-19 ç—…å˜çš„ 2D åˆ†å‰²å’Œå¤šæ¨¡æ€ MRI ä¸­çš„è„‘è‚¿ç˜¤çš„ 3D åˆ†å‰²\u003c/strong\u003eã€‚æ‰€æå‡ºçš„ç½‘ç»œåœ¨ 2D å’Œ 3D ä»»åŠ¡ä¸­éƒ½ä¼˜äºå‰æ²¿æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨å‚æ•°å’Œè®¡ç®—æˆæœ¬æ–¹é¢æ¯”å½“å‰ç½‘ç»œæ›´é«˜æ•ˆã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸€ä¸ªç½‘ç»œã€ç›‘ç£ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ã€å‚æ•°å’Œè®¡ç®—æˆæœ¬æ–¹é¢æ¯”å½“å‰ç½‘ç»œæ›´é«˜æ•ˆã€‚\u003c/p\u003e\n\u003ch2 id=\"related-work\"\u003eRelated Work\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e1ï¼‰å›¾åƒåˆ†å‰²çš„ç½‘ç»œç»“æ„ï¼šç”¨äºå›¾åƒåˆ†å‰²çš„å…¸å‹å·ç§¯ç¥ç»ç½‘ç»œé€šå¸¸ç”±ä¸€ä¸ªå·ç§¯ç‰¹å¾æå–å™¨ç»„æˆï¼Œå…¶æ‹“æ‰‘ç±»ä¼¼äºå¸¸è§çš„åˆ†ç±»ç½‘ç»œï¼Œè‡ªåŠ¨ä»è¾“å…¥å›¾åƒä¸­æå–ç‰¹å¾ï¼Œå¹¶è¿›è¡ŒåŸºäºå·ç§¯çš„æ“ä½œä»¥ç”Ÿæˆæœ€ç»ˆçš„å¯†é›†é¢„æµ‹ã€‚åœ¨è‡ªç„¶å›¾åƒåˆ†å‰²é¢†åŸŸï¼ŒFCN [2]ã€DeepLab [8]ã€PSPNet [9] å’Œ SegNet [10] å› å…¶æ€§èƒ½å’Œæ•ˆç‡è€Œé¢‡å—æ¬¢è¿ã€‚å¯¹äºåŒ»å­¦åˆ†å‰²ï¼ŒU-Net [3] åœ¨è®¸å¤šä»»åŠ¡ä¸­ç›¸å½“æµè¡Œï¼Œå¹¶ä¸”å·²è¢«ä¿®æ”¹ä¸ºè®¸å¤šæ”¹è¿›ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Attention U-Net [11]ã€U-Net++ [12]ã€V-Net [13] å’ŒH-DenseUNet [14]åœ¨æŸäº›é¢†åŸŸè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚\u003c/p\u003e","title":"Prior Attention Network: ç”¨äºåŒ»å­¦å›¾åƒä¸­å¤šç—…ç¶åˆ†å‰²çš„é¢„å…ˆæ³¨æ„ç½‘ç»œ"},{"content":"åœ°å¤§æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹ 1. æœåŠ¡å™¨ç¯å¢ƒä»‹ç» NVIDIA RTX 3090 (24GB) NVIDIA RTX 2080 Ti (11GB) 2. é…ç½®å®éªŒç¯å¢ƒ 2.1 Condaç¯å¢ƒå®‰è£… æ¯ä½åŒå­¦éƒ½ä¼šåˆ†é…ä¸ªäººç”¨æˆ·ï¼Œå¤§å®¶åœ¨è‡ªå·±çš„ç”¨æˆ·ä¸Šä½¿ç”¨Condaè¿›è¡Œç¯å¢ƒé…ç½®ã€‚\nCondaå®‰è£…æ•™ç¨‹ï¼šhttps://blog.csdn.net/JineD/article/details/129507719\nå¤§å®¶æŒ‰ç…§æ•™ç¨‹æ­¥éª¤å®‰è£…å³å¯, ç”±äºå®‰è£…æ—¶é—´è¾ƒé•¿, è§†é¢‘ä¸­æš‚ä¸è¿›è¡Œæ¼”ç¤ºã€‚\n2.2 Condaç¯å¢ƒé…ç½® ï¼ˆä»¥YOLOv8ä¸ºä¾‹ï¼‰ # åˆ›å»ºcondaç¯å¢ƒ åä¸ºyolov8_lyj pythonç‰ˆæœ¬ä¸º3.9 conda create -n yolov8_lyj python=3.9 # æ¿€æ´»ç¯å¢ƒ conda activate yolov8_lyj # é€‰æ‹©åˆé€‚çš„è·¯å¾„ï¼Œå…‹éš†githubé¡¹ç›®ä»£ç  git clone https://github.com/ultralytics/ultralytics # è¿›å…¥åˆ°é¡¹ç›®è·¯å¾„ä¸‹ cd ultralytics/ # å®‰è£…ç›¸å…³ä¾èµ–åŒ… pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple 2.3 å‡†å¤‡æ•°æ®é›† ä¸‹è½½éœ€è¦è®­ç»ƒçš„æ•°æ®é›† ï¼ˆæœ€å¥½æ‰¾é¡¶åˆŠ/é¡¶ä¼šè®ºæ–‡ä¸­çš„å…¬å¼€æ•°æ®é›†ï¼‰\næŒ‰ç…§ç®—æ³•æŒ‡å®šçš„æ•°æ®é›†æ ¼å¼ï¼Œå¯¹æ•°æ®é›†æ ¼å¼è¿›è¡Œè°ƒæ•´ã€‚\nâ€‹\tç›®æ ‡æ£€æµ‹ä¸­æ•°æ®é›†æ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼šï¼ˆVOCã€COCOã€YOLOæ ¼å¼ï¼‰\nâ€‹\thttps://zhuanlan.zhihu.com/p/461488682\n2.4 å¼€å§‹å®éªŒ åœ¨ç®—æ³•ä¸­æŒ‡å®šæ•°æ®é›†çš„å­˜æ”¾è·¯å¾„ ï¼ˆç›¸å¯¹/ç»å¯¹è·¯å¾„å‡å¯ï¼‰\nåˆå§‹åŒ–ç®—æ³•çš„å‚æ•°\nbatch-size æ‰¹å¤„ç†å¤§å°ï¼šæ¯ä¸€æ¬¡å¤„ç†å›¾ç‰‡çš„ä¸ªæ•°ï¼Œæ ¹æ®æ˜¾å¡å†…å­˜è¿›è¡Œè°ƒæ•´\repochs\tè¿­ä»£æ¬¡æ•°ï¼šç®—æ³•æ€»å…±éœ€è¦è®­ç»ƒçš„è½®æ¬¡\rworkers è½½å…¥æ•°æ®è¿›ç¨‹æ•°ï¼šæ¯ä¸€æ¬¡è°ƒç”¨å¤šå°‘ä¸ªè¿›ç¨‹æ¥è½½å…¥æ•°æ®\rdevice é€‰æ‹©æ˜¾å¡è®¾å¤‡ï¼š \u0026#39;0\u0026#39;ä½¿ç”¨3090ï¼Œ\u0026#39;1\u0026#39;ä½¿ç”¨2080tiï¼Œ\u0026#39;0,1\u0026#39;ä½¿ç”¨ä¸¤å¼ å¡ å¼€å§‹è®­ç»ƒ # è¿è¡Œè®­ç»ƒä»£ç  python mian.py (æ³¨ï¼šä½¿ç”¨å‘æ—¥è‘µçš„åŒå­¦ï¼Œå¯ä»¥ç›´æ¥åœ¨Pycharmå½“ä¸­è¿è¡Œ)\n3. æ³¨æ„äº‹é¡¹ 1. æŸ¥çœ‹æ˜¾å¡ä½¿ç”¨æƒ…å†µ ä¸¤ç§åŠæ³•ï¼š\n# ç¬¬ä¸€ç§ ä½¿ç”¨nividaé©±åŠ¨ç›´æ¥æŸ¥çœ‹\rnvidia-smi\r# ç¬¬äºŒç§ ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ gpustatåŠ¨æ€æŸ¥çœ‹\r# å…ˆå®‰è£…ç¬¬ä¸‰æ–¹åº“\rpip install gpustat -i https://pypi.tuna.tsinghua.edu.cn/simple\r# æ¯ä¸¤ç§’åˆ·æ–°ä¸€æ¬¡ åŠ¨æ€æŸ¥çœ‹æ˜¾å­˜ä½¿ç”¨æƒ…å†µ\rwatch -n2 gpustat 2. Magic Network ä½¿ç”¨å‘æ—¥è‘µçš„åŒå­¦ï¼Œå¯ä»¥ä½¿ç”¨Magic Networkè¿›è¡Œgithubä»“åº“å…‹éš†ã€googleç½‘ç›˜æ•°æ®é›†ä¸‹è½½ç­‰\nä½¿ç”¨æ–¹æ³•ï¼š\nexport http_proxy=http://127.0.0.1:7890\rexport https_proxy=http://127.0.0.1:7890 é¢„ç¥å¤§å®¶ç§‘ç ”é¡ºåˆ©ï¼Œç¡•æœç´¯ç´¯ï¼Œofferæ‹¿åˆ°æ‰‹è½¯ï¼ï¼ï¼\nåšå®¢åœ°å€ï¼š SwimmingLiu.cn\n","permalink":"https://swimmingliu.cn/posts/diary/2023-%E5%9C%B0%E5%A4%A7%E6%9C%8D%E5%8A%A1%E5%99%A8/","summary":"\u003ch1 id=\"åœ°å¤§æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹\"\u003eåœ°å¤§æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹\u003c/h1\u003e\n\u003ch2 id=\"1-æœåŠ¡å™¨ç¯å¢ƒä»‹ç»\"\u003e1. æœåŠ¡å™¨ç¯å¢ƒä»‹ç»\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNVIDIA RTX \u003cspan class=\"m\"\u003e3090\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e24GB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNVIDIA RTX \u003cspan class=\"m\"\u003e2080\u003c/span\u003e Ti \u003cspan class=\"o\"\u003e(\u003c/span\u003e11GB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20231120113601423\" loading=\"lazy\" src=\"https://oss.swimmingliu.cn/HoBnO.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2-é…ç½®å®éªŒç¯å¢ƒ\"\u003e2. é…ç½®å®éªŒç¯å¢ƒ\u003c/h2\u003e\n\u003ch3 id=\"21-condaç¯å¢ƒå®‰è£…\"\u003e2.1 Condaç¯å¢ƒå®‰è£…\u003c/h3\u003e\n\u003cp\u003eæ¯ä½åŒå­¦éƒ½ä¼šåˆ†é…ä¸ªäººç”¨æˆ·ï¼Œå¤§å®¶åœ¨è‡ªå·±çš„ç”¨æˆ·ä¸Šä½¿ç”¨Condaè¿›è¡Œç¯å¢ƒé…ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eCondaå®‰è£…æ•™ç¨‹ï¼šhttps://blog.csdn.net/JineD/article/details/129507719\u003c/p\u003e\n\u003cp\u003eå¤§å®¶æŒ‰ç…§æ•™ç¨‹æ­¥éª¤å®‰è£…å³å¯, ç”±äºå®‰è£…æ—¶é—´è¾ƒé•¿, è§†é¢‘ä¸­æš‚ä¸è¿›è¡Œæ¼”ç¤ºã€‚\u003c/p\u003e\n\u003ch3 id=\"22-condaç¯å¢ƒé…ç½®-ä»¥yolov8ä¸ºä¾‹\"\u003e2.2 Condaç¯å¢ƒé…ç½® ï¼ˆä»¥YOLOv8ä¸ºä¾‹ï¼‰\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åˆ›å»ºcondaç¯å¢ƒ åä¸ºyolov8_lyj pythonç‰ˆæœ¬ä¸º3.9\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda create -n yolov8_lyj \u003cspan class=\"nv\"\u003epython\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3.9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ¿€æ´»ç¯å¢ƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econda activate yolov8_lyj\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# é€‰æ‹©åˆé€‚çš„è·¯å¾„ï¼Œå…‹éš†githubé¡¹ç›®ä»£ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/ultralytics/ultralytics\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¿›å…¥åˆ°é¡¹ç›®è·¯å¾„ä¸‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ultralytics/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å®‰è£…ç›¸å…³ä¾èµ–åŒ…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"23-å‡†å¤‡æ•°æ®é›†\"\u003e2.3 å‡†å¤‡æ•°æ®é›†\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eä¸‹è½½éœ€è¦è®­ç»ƒçš„æ•°æ®é›† ï¼ˆæœ€å¥½æ‰¾é¡¶åˆŠ/é¡¶ä¼šè®ºæ–‡ä¸­çš„å…¬å¼€æ•°æ®é›†ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæŒ‰ç…§ç®—æ³•æŒ‡å®šçš„æ•°æ®é›†æ ¼å¼ï¼Œå¯¹æ•°æ®é›†æ ¼å¼è¿›è¡Œè°ƒæ•´ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eâ€‹\t\tç›®æ ‡æ£€æµ‹ä¸­æ•°æ®é›†æ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼šï¼ˆVOCã€COCOã€YOLOæ ¼å¼ï¼‰\u003c/p\u003e\n\u003cp\u003eâ€‹\t\thttps://zhuanlan.zhihu.com/p/461488682\u003c/p\u003e\n\u003ch3 id=\"24-å¼€å§‹å®éªŒ\"\u003e2.4 å¼€å§‹å®éªŒ\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eåœ¨ç®—æ³•ä¸­æŒ‡å®šæ•°æ®é›†çš„å­˜æ”¾è·¯å¾„ ï¼ˆç›¸å¯¹/ç»å¯¹è·¯å¾„å‡å¯ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåˆå§‹åŒ–ç®—æ³•çš„å‚æ•°\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ebatch-size  æ‰¹å¤„ç†å¤§å°ï¼šæ¯ä¸€æ¬¡å¤„ç†å›¾ç‰‡çš„ä¸ªæ•°ï¼Œæ ¹æ®æ˜¾å¡å†…å­˜è¿›è¡Œè°ƒæ•´\r\nepochs\t   è¿­ä»£æ¬¡æ•°ï¼šç®—æ³•æ€»å…±éœ€è¦è®­ç»ƒçš„è½®æ¬¡\r\nworkers     è½½å…¥æ•°æ®è¿›ç¨‹æ•°ï¼šæ¯ä¸€æ¬¡è°ƒç”¨å¤šå°‘ä¸ªè¿›ç¨‹æ¥è½½å…¥æ•°æ®\r\ndevice      é€‰æ‹©æ˜¾å¡è®¾å¤‡ï¼š \u0026#39;0\u0026#39;ä½¿ç”¨3090ï¼Œ\u0026#39;1\u0026#39;ä½¿ç”¨2080tiï¼Œ\u0026#39;0,1\u0026#39;ä½¿ç”¨ä¸¤å¼ å¡\n\u003c/code\u003e\u003c/pre\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eå¼€å§‹è®­ç»ƒ\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¿è¡Œè®­ç»ƒä»£ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epython mian.py\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e(æ³¨ï¼šä½¿ç”¨å‘æ—¥è‘µçš„åŒå­¦ï¼Œå¯ä»¥ç›´æ¥åœ¨Pycharmå½“ä¸­è¿è¡Œ)\u003c/p\u003e","title":"åœ°å¤§æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹"},{"content":"ACC-UNet: A Completely Convolutional UNet model for the 2020s (MICCAI2023) 1. Abstract ç”±äºViT ï¼ˆVision Transformerï¼‰çš„å¼•å…¥ï¼ŒUNetå’ŒTransformerèåˆå·²æˆä¸ºå¤§è¶‹åŠ¿ã€‚æœ€è¿‘ï¼Œåˆæœ‰å¾ˆå¤šç ”ç©¶äººå‘˜å¼€å§‹é‡æ–°æ€è€ƒå·ç§¯æ¨¡å‹ï¼Œæ¯”å¦‚å°†ConvNextåµŒå…¥åˆ°ResNetï¼Œèƒ½å¤Ÿè¾¾åˆ°Swin Transformerçš„æ°´å¹³ã€‚å—æ­¤å¯å‘ï¼Œä½œè€…æå‡ºäº†ä¸€ä¸ªçº¯ç²¹çš„å·ç§¯UNETæ¨¡å‹ ï¼ˆACC-UNetï¼‰ï¼Œå¹¶ä¸”è¶…è¶ŠåŸºäºTransfomerçš„æ¨¡å‹(å¦‚Swin-UNETæˆ–UCTransNet)ã€‚ ä½œè€…ç ”ç©¶äº†åŸºäºTransfomerçš„UNETæ¨¡å‹ä¼˜ç‚¹ï¼šé•¿èŒƒå›´ä¾èµ–å…³ç³»å’Œè·¨çº§åˆ«è·³è¿‡è¿æ¥ã€‚ ACC-UNetç»“åˆäº†å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvNetsï¼‰çš„å†…åœ¨å½’çº³åå·®å’ŒTransformerçš„è®¾è®¡å†³ç­– å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvNetsï¼‰çš„å†…åœ¨å½’çº³åå·®ï¼šå·ç§¯ç¥ç»ç½‘ç»œå…·æœ‰å¤©ç”Ÿçš„å½’çº³åå·®ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å¤„ç†å›¾åƒç­‰æ•°æ®æ—¶å…·æœ‰ä¸€äº›å›ºæœ‰çš„å‡è®¾å’Œç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œå·ç§¯ç¥ç»ç½‘ç»œæ“…é•¿å¤„ç†å±€éƒ¨ç‰¹å¾ã€å¹³ç§»ä¸å˜æ€§ç­‰ï¼Œè¿™äº›ç‰¹ç‚¹ä½¿å®ƒä»¬åœ¨å›¾åƒå¤„ç†ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ã€‚ Transformerçš„è®¾è®¡å†³ç­–ï¼šTransformeræ˜¯ä¸€ç§ä¸åŒçš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå®ƒé‡‡ç”¨äº†ä¸€äº›ç‹¬ç‰¹çš„è®¾è®¡å†³ç­–ï¼Œä¾‹å¦‚è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œä½ç½®ç¼–ç ç­‰ã€‚è¿™äº›è®¾è®¡å†³ç­–ä½¿å¾—Transformeråœ¨å¤„ç†é•¿è·ç¦»ä¾èµ–æ€§ã€å…¨å±€å…³ç³»ç­‰æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œé€‚åˆå¤„ç†åºåˆ—æ•°æ®å’Œå…·æœ‰è¿œç¨‹ä¾èµ–çš„ä»»åŠ¡ã€‚ ACC-UNet åœ¨ 5 ä¸ªä¸åŒçš„åŒ»å­¦å›¾åƒåˆ†å‰²åŸºå‡†ä¸Šè¿›è¡Œäº†è¯„ä¼°ï¼Œå¹¶ä¸”å§‹ç»ˆä¼˜äºå·ç§¯ç½‘ç»œã€TransfomeråŠå…¶æ··åˆç½‘ç»œã€‚\n2.Introduction è¯­ä¹‰åˆ†å‰²æ˜¯è®¡ç®—æœºè¾…åŠ©åŒ»å­¦å›¾åƒåˆ†æçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯è¯†åˆ«å¹¶çªå‡ºæ˜¾ç¤ºå„ç§è¯Šæ–­ä»»åŠ¡ä¸­æ„Ÿå…´è¶£çš„åŒºåŸŸã€‚ç„¶è€Œï¼Œç”±äºæ¶‰åŠå›¾åƒæ¨¡æ€å’Œé‡‡é›†ä»¥åŠç—…ç†å’Œç”Ÿç‰©å˜åŒ–çš„å„ç§å› ç´ ï¼Œè¿™é€šå¸¸å˜å¾—å¤æ‚[18]ã€‚æ·±åº¦å­¦ä¹ åœ¨è¿™ä¸€é¢†åŸŸçš„åº”ç”¨æ— ç–‘åœ¨è¿™æ–¹é¢å—ç›ŠåŒªæµ…ã€‚æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè‡ªæ¨å‡ºä»¥æ¥ï¼ŒUNet æ¨¡å‹ [19] åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹é¢è¡¨ç°å‡ºäº†æƒŠäººçš„åŠŸæ•ˆã€‚ç»“æœï¼ŒUNet åŠå…¶è¡ç”Ÿå“å·²æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†[25]ã€‚\nå­¦ä¹ ä¸€ä¸‹è¿™é‡Œçš„èƒŒæ™¯æè¿°\nåŸå§‹çš„ UNet æ¨¡å‹åŒ…å«å¯¹ç§°çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼ˆå›¾ 1aï¼‰å¹¶é‡‡ç”¨è·³è·ƒè¿æ¥ï¼Œè¿™ä¸ºè§£ç å™¨æä¾›äº†åœ¨ç¼–ç å™¨çš„æ± åŒ–æ“ä½œæœŸé—´å¯èƒ½ä¸¢å¤±çš„ç©ºé—´ä¿¡æ¯ã€‚å°½ç®¡é€šè¿‡ç®€å•ä¸²è”çš„ä¿¡æ¯ä¼ æ’­æé«˜äº†æ€§èƒ½ï¼Œä½†ç¼–ç å™¨-è§£ç å™¨ç‰¹å¾å›¾ä¹‹é—´å¯èƒ½å­˜åœ¨è¯­ä¹‰å·®è·ã€‚è¿™å¯¼è‡´äº†ç¬¬äºŒç±» UNet çš„å‘å±•ï¼ˆå›¾ 1bï¼‰ã€‚ U-Net++ [26] åˆ©ç”¨å¯†é›†è¿æ¥ï¼Œè€Œ MultiResUNet [11] åœ¨è·³è¿‡è¿æ¥ä¸Šæ·»åŠ äº†é¢å¤–çš„å·ç§¯å—ä½œä¸ºæ½œåœ¨çš„è¡¥æ•‘æªæ–½ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒUNet çš„å†å²ä¸Šæ‰€æœ‰åˆ›æ–°éƒ½æ˜¯ä½¿ç”¨ CNN è¿›è¡Œçš„ã€‚ç„¶è€Œï¼Œ2020 å¹´çš„åå¹´ç»™è®¡ç®—æœºè§†è§‰é¢†åŸŸå¸¦æ¥äº†æ ¹æœ¬æ€§çš„å˜åŒ–ã€‚ CNN åœ¨è§†è§‰é¢†åŸŸçš„é•¿æœŸä¸»å¯¼åœ°ä½è¢«è§†è§‰è½¬æ¢å™¨æ‰“ç ´äº† [7]ã€‚ Swin Transformers [15] è¿›ä¸€æ­¥é’ˆå¯¹ä¸€èˆ¬è§†è§‰åº”ç”¨è°ƒæ•´äº†å˜å‹å™¨ã€‚å› æ­¤ï¼ŒUNet æ¨¡å‹å¼€å§‹é‡‡ç”¨ Transformer [5]ã€‚ Swin-Unet [9] ç”¨ Swin Transformer å—å–ä»£äº†å·ç§¯å—ï¼Œä»è€Œå¼€åˆ›äº†ä¸€ç±»æ–°çš„æ¨¡å‹ï¼ˆå›¾ 1cï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒCNN åœ¨å›¾åƒåˆ†å‰²æ–¹é¢ä»ç„¶å…·æœ‰å„ç§ä¼˜ç‚¹ï¼Œå¯¼è‡´äº†èåˆè¿™ä¸¤è€…çš„å‘å±•[2]ã€‚è¿™ç§æ··åˆç±» UNet æ¨¡å‹ï¼ˆå›¾ 1dï¼‰åœ¨ç¼–ç å™¨-è§£ç å™¨ä¸­é‡‡ç”¨å·ç§¯å—ï¼Œå¹¶æ²¿è·³è·ƒè¿æ¥ä½¿ç”¨å˜æ¢å™¨å±‚ã€‚ UCTransNet [22]å’ŒMCTrans[24]æ˜¯æ­¤ç±»çš„ä¸¤ä¸ªä»£è¡¨æ€§æ¨¡å‹ã€‚æœ€åï¼Œè¿˜å°è¯•å¼€å‘å…¨å˜å‹å™¨ UNet æ¶æ„ï¼ˆå›¾ 1eï¼‰ï¼Œä¾‹å¦‚ï¼ŒSMESwin Unet [27] åœ¨ç¼–ç å™¨-è§£ç å™¨å—å’Œè·³è·ƒè¿æ¥ä¸­éƒ½ä½¿ç”¨å˜å‹å™¨ã€‚\nä» UNetå‡ºå‘ï¼Œç„¶åé€æ­¥ä»‹ç»ä»–çš„å˜ä½“ï¼ˆUNet++ç­‰ï¼‰ã€‚éšåä»‹ç»Transformerå’ŒUNetçš„å„ç§ç»“åˆä½“ï¼Œä¸ºåç»­å¯¹æ¯”å®éªŒåšé“ºå«ã€‚æœ€åç»“åˆä¸€å¼ å‘å±•å›¾ï¼Œç®€æ˜æ‰¼è¦æè¿°UNetçš„åˆ›æ–°å†ç¨‹ã€‚\næœ€è¿‘ï¼Œé‰´äº Transformer å¸¦æ¥çš„è¿›æ­¥ï¼Œç ”ç©¶å¼€å§‹é‡æ–°å‘ç° CNN çš„æ½œåŠ›ã€‚è¿™æ–¹é¢çš„å¼€åˆ›æ€§å·¥ä½œæ˜¯â€œA ConvNet for the 2020sâ€[16]ï¼Œå®ƒæ¢è®¨äº† Transformer å¼•å…¥çš„å„ç§æƒ³æ³•åŠå…¶åœ¨å·ç§¯ç½‘ç»œä¸­çš„é€‚ç”¨æ€§ã€‚é€šè¿‡é€æ¸èåˆè®­ç»ƒåè®®å’Œå¾®è§‚-å®è§‚è®¾è®¡é€‰æ‹©çš„æ€æƒ³ï¼Œè¿™é¡¹å·¥ä½œä½¿ ResNet æ¨¡å‹çš„æ€§èƒ½ä¼˜äº Swin Transformer æ¨¡å‹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åœ¨ UNet æ¨¡å‹çš„èƒŒæ™¯ä¸‹æå‡ºäº†åŒæ ·çš„é—®é¢˜ã€‚æˆ‘ä»¬ç ”ç©¶ä»…åŸºäºå·ç§¯çš„ UNet æ¨¡å‹æ˜¯å¦å¯ä»¥ä¸åŸºäº Transformer çš„ UNet ç«äº‰ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä» Transformer æ¶æ„ä¸­è·å¾—åŠ¨åŠ›å¹¶å¼€å‘äº†çº¯å·ç§¯ UNet æ¨¡å‹ã€‚æˆ‘ä»¬æå‡ºäº†ä¸€ç§åŸºäºè¡¥ä¸çš„ä¸Šä¸‹æ–‡èšåˆï¼Œä¸åŸºäºçª—å£çš„è‡ªæ³¨æ„åŠ›ç›¸åã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é€šè¿‡èåˆæ¥è‡ªå¤šä¸ªçº§åˆ«ç¼–ç å™¨çš„ç‰¹å¾å›¾æ¥åˆ›æ–°è·³è·ƒè¿æ¥ã€‚å¯¹ 5 ä¸ªåŸºå‡†æ•°æ®é›†çš„å¹¿æ³›å®éªŒè¡¨æ˜ï¼Œæˆ‘ä»¬æå‡ºçš„ä¿®æ”¹æœ‰å¯èƒ½æ”¹è¿› UNet æ¨¡å‹ã€‚\né€šè¿‡ä»‹ç»CONvNetçš„é‡è¦æ€§ï¼Œå¼•å…¥æœ¬æ–‡é‡ç‚¹ ï¼ˆçº¯å·ç§¯æ¨¡å—çš„UNetï¼‰ã€‚\n3. Method 3.1 A high-level view of transformers in UNet Transformers æ˜¾ç„¶åœ¨ä¸¤ä¸ªä¸åŒæ–¹é¢æ”¹è¿›äº† UNet æ¨¡å‹:\n1.åˆ©ç”¨è‡ªæ³¨æ„åŠ›çš„è¿œç¨‹ä¾èµ–æ€§: Transformer å¯ä»¥é€šè¿‡ä½¿ç”¨ï¼ˆçª—å£å¼ï¼‰è‡ªæ³¨æ„åŠ›ï¼Œä»æ›´å¤§çš„ä¸Šä¸‹æ–‡è§†å›¾ä¸­è®¡ç®—ç‰¹å¾ã€‚æ­¤å¤–ï¼Œä»–ä»¬è¿˜é€šè¿‡é‡‡ç”¨åå‘ç“¶é¢ˆï¼ˆå³å¢åŠ  MLP å±‚ä¸­çš„ç¥ç»å…ƒï¼‰æ¥æé«˜è¡¨è¾¾èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œå®ƒä»¬åŒ…å«å¿«æ·è¿æ¥ï¼Œè¿™æœ‰åŠ©äºå­¦ä¹ ã€‚ 2.é€šè¿‡é€šé“æ³¨æ„åŠ›çš„è‡ªé€‚åº”å¤šçº§ç‰¹å¾ç»„åˆ: åŸºäº Transformer çš„ UNet ä½¿ç”¨é€šé“æ³¨æ„åŠ›è‡ªé€‚åº”åœ°èåˆæ¥è‡ªå¤šä¸ªç¼–ç å™¨çº§åˆ«çš„ç‰¹å¾å›¾ã€‚ä¸å—å½“å‰çº§åˆ«ä¿¡æ¯é™åˆ¶çš„ç®€å•è·³è·ƒè¿æ¥ç›¸æ¯”ï¼Œç”±äºæ¥è‡ªä¸åŒçº§åˆ«çš„å„ç§æ„Ÿå…´è¶£åŒºåŸŸçš„ç»„åˆï¼Œè¿™ä¼šç”Ÿæˆä¸°å¯Œçš„ç‰¹å¾ã€‚\nä¸»è¦å°±ä¸¤ä¸ªç‚¹ï¼š\nè‡ªä¸»æ³¨æ„åŠ›åœ¨UNetçš„ç¼–ç å’Œè§£ç é˜¶æ®µéƒ½èƒ½å¤Ÿå¿«é€Ÿã€å‡†ç¡®åœ°æ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯æå–ç‰¹å¾ã€‚\nè‡ªæ³¨æ„åŠ›æœºåˆ¶å¯ä»¥ç”¨æ¥è¿æ¥encoderé˜¶æ®µä¸åŒstageçš„ç‰¹å¾å›¾ã€‚\nçŒœæƒ³ï¼šæŠŠæ–°å‡ºçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶åŠ åœ¨ACC-Unetæ˜¯ä¸æ˜¯ä¹Ÿä¼šæœ‰æå‡å‘¢ï¼Ÿ\n3.2 Hierarchical Aggregation of Neighborhood Context (HANC) æˆ‘ä»¬é¦–å…ˆæ¢ç´¢å¼•å…¥è¿œç¨‹ä¾èµ–æ€§å¹¶æé«˜å·ç§¯å—çš„è¡¨è¾¾èƒ½åŠ›çš„å¯èƒ½æ€§ã€‚æˆ‘ä»¬ä»…ä½¿ç”¨é€ç‚¹å’Œæ·±åº¦å·ç§¯æ¥é™ä½è®¡ç®—å¤æ‚åº¦ã€‚ä¸ºäº†å¢åŠ è¡¨è¾¾èƒ½åŠ›ï¼Œæˆ‘ä»¬å»ºè®®åœ¨å·ç§¯å—ä¸­åŒ…å«åå‘ç“¶é¢ˆ[16]ï¼Œè¿™å¯ä»¥é€šè¿‡ä½¿ç”¨é€ç‚¹å·ç§¯å°†é€šé“æ•°ä» cin å¢åŠ åˆ° cinv = cin * inv_f ctr æ¥å®ç°ã€‚ç”±äºè¿™äº›é¢å¤–çš„é€šé“ä¼šå¢åŠ æ¨¡å‹å¤æ‚åº¦ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨3Ã—3æ·±åº¦å·ç§¯æ¥è¡¥å¿ã€‚è¾“å…¥ç‰¹å¾å›¾ xin âˆˆ R cin,n,m è¢«è½¬æ¢ä¸º x1 âˆˆ R cinv,n,m ï¼ˆå›¾ 2bï¼‰\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å·ç§¯å—ä¸­æ¨¡æ‹Ÿè‡ªæ³¨æ„åŠ›ï¼Œå…¶æ ¸å¿ƒæ˜¯å°†ä¸€ä¸ªåƒç´ ä¸å…¶é‚»åŸŸä¸­çš„å…¶ä»–åƒç´ è¿›è¡Œæ¯”è¾ƒ[15]ã€‚é€šè¿‡å°†åƒç´ å€¼ä¸å…¶é‚»åŸŸçš„å¹³å‡å€¼å’Œæœ€å¤§å€¼è¿›è¡Œæ¯”è¾ƒå¯ä»¥ç®€åŒ–è¿™ç§æ¯”è¾ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é™„åŠ ç›¸é‚»åƒç´ ç‰¹å¾çš„å¹³å‡å€¼å’Œæœ€å¤§å€¼æ¥æä¾›é‚»åŸŸæ¯”è¾ƒçš„è¿‘ä¼¼æ¦‚å¿µã€‚å› æ­¤ï¼Œè¿ç»­é€ç‚¹å·ç§¯å¯ä»¥è€ƒè™‘è¿™äº›å¹¶æ•è·å¯¹æ¯”è§†å›¾ã€‚\nç”±äºåˆ†å±‚åˆ†æå¯¹å›¾åƒæœ‰ç›Š[23]ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨å•ä¸ªå¤§çª—å£ä¸­è®¡ç®—è¿™ç§èšåˆï¼Œè€Œæ˜¯åœ¨å¤šä¸ªçº§åˆ«ä¸­åˆ†å±‚è®¡ç®—ï¼Œä¾‹å¦‚ 2 Ã— 2, 2 ^2 Ã— 2^ 2 , Â· Â· Â· , 2^(kâˆ’ 1) Ã— 2^(kâˆ’1) ä¸ªè¡¥ä¸ã€‚å½“ k = 1 æ—¶ï¼Œè¿™å°†æ˜¯æ™®é€šçš„å·ç§¯è¿ç®—ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¢åŠ  k çš„å€¼æ—¶ï¼Œå°†æä¾›æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œç»•è¿‡å¯¹æ›´å¤§å·ç§¯æ ¸çš„éœ€è¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºçš„åˆ†å±‚é‚»åŸŸä¸Šä¸‹æ–‡èšåˆé€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸°å¯Œäº†ç‰¹å¾å›¾ x1 âˆˆ R cinv,n,m ä½œä¸º x2 âˆˆ R cinv*(2kâˆ’1),n,m ï¼ˆå›¾ 2bï¼‰ï¼Œå…¶ä¸­ ||å¯¹åº”äºæ²¿é€šé“ç»´åº¦çš„ä¸²è”ã€‚\nä¸‹é¢ä¸Transfomerç±»ä¼¼ï¼Œæˆ‘ä»¬åœ¨å·ç§¯å—ä¸­åŒ…å«ä¸€ä¸ªå¿«æ·è¿æ¥ï¼Œä»¥å®ç°æ›´å¥½çš„æ¢¯åº¦ä¼ æ’­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰§è¡Œå¦ä¸€ä¸ªé€ç‚¹å·ç§¯ä»¥å‡å°‘ cin çš„é€šé“æ•°å¹¶ä¸è¾“å…¥ç‰¹å¾å›¾ç›¸åŠ ã€‚å› æ­¤ï¼Œx2 âˆˆ R cinv*(2kâˆ’1),n,m å˜ä¸º x3 âˆˆ R cin,n,m ï¼ˆå›¾ 2bï¼‰\næœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨é€ç‚¹å·ç§¯å°†æ»¤æ³¢å™¨çš„æ•°é‡æ›´æ”¹ä¸ºcoutä½œä¸ºè¾“å‡º\n\u0026ldquo;inverted bottlenecks\u0026rdquo;ï¼ˆåå‘ç“¶é¢ˆï¼‰ ï¼šå°†Bottleneckæ”¾åœ¨å·ç§¯å—çš„å¼€å§‹ï¼Œè€Œä¸æ˜¯ç»“æŸã€‚å®ƒå…ˆä½¿ç”¨1x1å·ç§¯æ¥å‡å°‘é€šé“æ•°ï¼Œç„¶åæ‰æ˜¯è¾ƒå¤§çš„å·ç§¯å±‚ã€‚\n3.3 Multi Level Feature Compilation (MLFC) æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç ”ç©¶å¤šçº§ç‰¹å¾ç»„åˆçš„å¯è¡Œæ€§ï¼Œè¿™æ˜¯ä½¿ç”¨åŸºäº Transformer çš„ UNet çš„å¦ä¸€ä¸ªä¼˜ç‚¹ã€‚\nåŸºäº Transformer çš„è·³è·ƒè¿æ¥å·²ç»è¯æ˜äº†æ‰€æœ‰ç¼–ç å™¨çº§åˆ«çš„æœ‰æ•ˆç‰¹å¾èåˆä»¥åŠå„ä¸ªè§£ç å™¨ä»ç¼–è¯‘çš„ç‰¹å¾å›¾ä¸­è¿›è¡Œçš„é€‚å½“è¿‡æ»¤[24,22,27]ã€‚è¿™æ˜¯é€šè¿‡è¿æ¥ä¸åŒçº§åˆ«çš„æŠ•å½±ä»¤ç‰Œæ¥æ‰§è¡Œçš„[22]ã€‚æŒ‰ç…§è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬è°ƒæ•´ä»ä¸åŒç¼–ç å™¨çº§åˆ«è·å¾—çš„å·ç§¯ç‰¹å¾å›¾çš„å¤§å°ï¼Œä»¥ä½¿å®ƒä»¬å‡è¡¡å¹¶è¿æ¥å®ƒä»¬ã€‚è¿™ä¸ºæˆ‘ä»¬æä¾›äº†è·¨ä¸åŒè¯­ä¹‰çº§åˆ«çš„ç‰¹å¾å›¾çš„æ¦‚è¿°ã€‚æˆ‘ä»¬åº”ç”¨é€ç‚¹å·ç§¯è¿ç®—æ¥æ€»ç»“è¿™ç§è¡¨ç¤ºå¹¶ä¸ç›¸åº”çš„ç¼–ç å™¨ç‰¹å¾å›¾åˆå¹¶ã€‚æ•´ä½“ä¿¡æ¯å’Œä¸ªä½“ä¿¡æ¯çš„èåˆé€šè¿‡å¦ä¸€ä¸ªå·ç§¯ä¼ é€’ï¼Œæˆ‘ä»¬å‡è®¾å®ƒç”¨æ¥è‡ªå…¶ä»–çº§åˆ«ç‰¹å¾çš„ä¿¡æ¯ä¸°å¯Œäº†å½“å‰çº§åˆ«ç‰¹å¾ã€‚\nå¯¹äºæ¥è‡ª 4 ä¸ªä¸åŒçº§åˆ«çš„ç‰¹å¾ x1ã€x2ã€x3ã€x4ï¼Œç‰¹å¾å›¾å¯ä»¥é€šè¿‡å¤šçº§ä¿¡æ¯æ¥ä¸°å¯Œï¼ˆå›¾ 2dï¼‰\nè¿™é‡Œï¼Œ resizei(xj ) æ˜¯å°† xj çš„å¤§å°è°ƒæ•´ä¸º xi çš„å¤§å°ä¸” ctot = c1 + c2 + c3 + c4 çš„æ“ä½œã€‚æ­¤æ“ä½œé’ˆå¯¹æ‰€æœ‰ä¸åŒçº§åˆ«å•ç‹¬å®Œæˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†å¦ä¸€ä¸ªåä¸ºå¤šçº§ç‰¹å¾ç¼–è¯‘ï¼ˆMLFCï¼‰çš„æ–°é¢–å—ï¼Œå®ƒèšåˆæ¥è‡ªå¤šä¸ªç¼–ç å™¨çº§åˆ«çš„ä¿¡æ¯å¹¶ä¸°å¯Œå„ä¸ªç¼–ç å™¨ç‰¹å¾å›¾ã€‚è¯¥å—å¦‚å›¾ 2d æ‰€ç¤ºã€‚\næ€»ç»“ï¼š æŠŠå„stageçš„ç‰¹å¾è”åˆèµ·æ¥è¿›è¡Œé€ç‚¹å·ç§¯ï¼Œç„¶åå„stageå¾—åˆ°æ–°çš„ç‰¹å¾ä¿¡æ¯\n3.4 ACC-UNet å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºå…¨å·ç§¯ACC-UNetï¼ˆå›¾2aï¼‰ã€‚æˆ‘ä»¬ä»æ™®é€šçš„ UNet æ¨¡å‹å¼€å§‹ï¼Œå¹¶å°†æ»¤æ³¢å™¨çš„æ•°é‡å‡å°‘äº†ä¸€åŠã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨æˆ‘ä»¬æå‡ºçš„ HANC å—æ›¿æ¢äº†ç¼–ç å™¨å’Œè§£ç å™¨ä¸­çš„å·ç§¯å—ã€‚æˆ‘ä»¬è€ƒè™‘ inv_f ctr = 3ï¼Œè€Œä¸æ˜¯ç¬¬ 3 çº§çš„æœ€åä¸€ä¸ªè§£ç å™¨å— (inv_f ctr = 34)ï¼Œä»¥æ¨¡æ‹Ÿ Swin Transformer ç¬¬ 3 é˜¶æ®µçš„æ‰©å±•ã€‚ k = 3ï¼Œæœ€å¤šè€ƒè™‘ 4 Ã— 4 ä¸ªè¡¥ä¸ï¼Œè¢«é€‰æ‹©ç”¨äºé™¤ç“¶é¢ˆçº§åˆ« (k = 1) åŠå…¶æ—è¾¹çš„çº§åˆ« (k = 2) ä¹‹å¤–çš„æ‰€æœ‰çº§åˆ«ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ®‹å·®å—ï¼ˆå›¾ 2cï¼‰æ¥ä¿®æ”¹è·³è·ƒè¿æ¥ä»¥å‡å°‘è¯­ä¹‰é—´éš™ [11] å¹¶å †å  3 ä¸ª MLFC å—ã€‚æ‰€æœ‰å·ç§¯å±‚å‡ç»è¿‡æ‰¹é‡å½’ä¸€åŒ– [12]ï¼Œç”± Leaky-RELU [17] æ¿€æ´»ï¼Œå¹¶é€šè¿‡æŒ¤å‹å’Œæ¿€åŠ± [10] é‡æ–°æ ¡å‡†ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œåœ¨ UNet æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ç”¨æˆ‘ä»¬æå‡ºçš„ HANC å—æ›¿æ¢äº†ç»å…¸çš„å·ç§¯å—ï¼Œè¯¥ HANC å—æ‰§è¡Œè¿‘ä¼¼ç‰ˆæœ¬çš„è‡ªæ³¨æ„åŠ›ï¼Œå¹¶ä¿®æ”¹äº†ä¸ MLFC å—çš„è·³è·ƒè¿æ¥ï¼ŒMLFC å—è€ƒè™‘æ¥è‡ªä¸åŒç¼–ç å™¨çº§åˆ«çš„ç‰¹å¾å›¾ã€‚æ‰€æå‡ºçš„æ¨¡å‹æœ‰ 16.77 M ä¸ªå‚æ•°ï¼Œæ¯”æ™®é€š UNet æ¨¡å‹å¤§çº¦å¢åŠ äº† 2Mã€‚\n4.Experiments 4.1 Datasets ä¸ºäº†è¯„ä¼° ACC-UNetï¼Œæˆ‘ä»¬åœ¨ 5 ä¸ªè·¨ä¸åŒä»»åŠ¡å’Œæ¨¡å¼çš„å…¬å…±æ•°æ®é›†ä¸Šè¿›è¡Œäº†å®éªŒã€‚æˆ‘ä»¬ä½¿ç”¨ ISIC-2018 [6,21]ï¼ˆçš®è‚¤é•œæ£€æŸ¥ï¼Œ2594 å¼ å›¾åƒï¼‰ã€BUSI [3]ï¼ˆä¹³è…ºè¶…å£°ï¼Œä½¿ç”¨ç±»ä¼¼äº [13] çš„ 437 å¼ è‰¯æ€§å›¾åƒå’Œ 210 å¼ æ¶æ€§å›¾åƒï¼‰ã€CVC-ClinicDB [4]ï¼ˆç»“è‚ é•œæ£€æŸ¥ï¼Œ612 å¼ å›¾åƒï¼‰ ï¼‰ã€COVID [1]ï¼ˆè‚ºç‚ç—…ç¶åˆ†å‰²ï¼Œ100 å¼ å›¾åƒï¼‰å’Œ GlaS [20]ï¼ˆè…ºä½“åˆ†å‰²ï¼Œ85 å¼ è®­ç»ƒå›¾åƒå’Œ 80 å¼ æµ‹è¯•å›¾åƒï¼‰ã€‚æ‰€æœ‰å›¾åƒå’Œæ©æ¨¡çš„å¤§å°éƒ½è°ƒæ•´ä¸º224Ã—224ã€‚å¯¹äºGlaSæ•°æ®é›†ï¼Œæˆ‘ä»¬å°†åŸå§‹æµ‹è¯•åˆ†å‰²ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œå¯¹äºå…¶ä»–æ•°æ®é›†ï¼Œæˆ‘ä»¬éšæœºé€‰æ‹©20ï¼…çš„å›¾åƒä½œä¸ºæµ‹è¯•æ•°æ®ã€‚\nå‰©ä½™çš„ 60% å’Œ 20% å›¾åƒç”¨äºè®­ç»ƒå’ŒéªŒè¯ï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„éšæœºæ”¹ç»„é‡å¤å®éªŒ 3 æ¬¡ã€‚\nISIC-2018ã€BUSIã€ CVC-ClinicDBã€COVIDã€GlaS äº”ä¸ªæ•°æ®é›†\n4.2 Comparison Experiments 4.3 Ablation Study 4.4 Qualitative Results ","permalink":"https://swimmingliu.cn/posts/papernotes/2023-acc-unet/","summary":"\u003ch1 id=\"acc-unet-a-completely-convolutional-unet-model-for-the-2020s-miccai2023\"\u003eACC-UNet: A Completely Convolutional UNet model for the 2020s (MICCAI2023)\u003c/h1\u003e\n\u003ch2 id=\"1-abstract\"\u003e1. Abstract\u003c/h2\u003e\n\u003cp\u003eç”±äºViT ï¼ˆVision Transformerï¼‰çš„å¼•å…¥ï¼ŒUNetå’ŒTransformerèåˆå·²æˆä¸ºå¤§è¶‹åŠ¿ã€‚æœ€è¿‘ï¼Œåˆæœ‰å¾ˆå¤šç ”ç©¶äººå‘˜å¼€å§‹é‡æ–°æ€è€ƒå·ç§¯æ¨¡å‹ï¼Œæ¯”å¦‚å°†ConvNextåµŒå…¥åˆ°ResNetï¼Œèƒ½å¤Ÿè¾¾åˆ°Swin Transformerçš„æ°´å¹³ã€‚å—æ­¤å¯å‘ï¼Œä½œè€…æå‡ºäº†ä¸€ä¸ªçº¯ç²¹çš„å·ç§¯UNETæ¨¡å‹ ï¼ˆACC-UNetï¼‰ï¼Œå¹¶ä¸”è¶…è¶ŠåŸºäºTransfomerçš„æ¨¡å‹(å¦‚Swin-UNETæˆ–UCTransNet)ã€‚\nä½œè€…ç ”ç©¶äº†åŸºäºTransfomerçš„UNETæ¨¡å‹ä¼˜ç‚¹ï¼šé•¿èŒƒå›´ä¾èµ–å…³ç³»å’Œè·¨çº§åˆ«è·³è¿‡è¿æ¥ã€‚\nACC-UNetç»“åˆäº†\u003cstrong\u003eå·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvNetsï¼‰çš„å†…åœ¨å½’çº³åå·®\u003c/strong\u003eå’Œ\u003cstrong\u003eTransformerçš„è®¾è®¡å†³ç­–\u003c/strong\u003e\n\u003cstrong\u003eå·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvNetsï¼‰çš„å†…åœ¨å½’çº³åå·®\u003c/strong\u003eï¼šå·ç§¯ç¥ç»ç½‘ç»œå…·æœ‰å¤©ç”Ÿçš„å½’çº³åå·®ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å¤„ç†å›¾åƒç­‰æ•°æ®æ—¶å…·æœ‰ä¸€äº›å›ºæœ‰çš„å‡è®¾å’Œç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œå·ç§¯ç¥ç»ç½‘ç»œæ“…é•¿å¤„ç†å±€éƒ¨ç‰¹å¾ã€å¹³ç§»ä¸å˜æ€§ç­‰ï¼Œè¿™äº›ç‰¹ç‚¹ä½¿å®ƒä»¬åœ¨å›¾åƒå¤„ç†ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ã€‚\n\u003cstrong\u003eTransformerçš„è®¾è®¡å†³ç­–\u003c/strong\u003eï¼šTransformeræ˜¯ä¸€ç§ä¸åŒçš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå®ƒé‡‡ç”¨äº†ä¸€äº›ç‹¬ç‰¹çš„è®¾è®¡å†³ç­–ï¼Œä¾‹å¦‚è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œä½ç½®ç¼–ç ç­‰ã€‚è¿™äº›è®¾è®¡å†³ç­–ä½¿å¾—Transformeråœ¨å¤„ç†é•¿è·ç¦»ä¾èµ–æ€§ã€å…¨å±€å…³ç³»ç­‰æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œé€‚åˆå¤„ç†åºåˆ—æ•°æ®å’Œå…·æœ‰è¿œç¨‹ä¾èµ–çš„ä»»åŠ¡ã€‚\nACC-UNet åœ¨ 5 ä¸ªä¸åŒçš„åŒ»å­¦å›¾åƒåˆ†å‰²åŸºå‡†ä¸Šè¿›è¡Œäº†è¯„ä¼°ï¼Œå¹¶ä¸”å§‹ç»ˆä¼˜äºå·ç§¯ç½‘ç»œã€TransfomeråŠå…¶æ··åˆç½‘ç»œã€‚\u003c/p\u003e\n\u003ch2 id=\"2introduction\"\u003e2.Introduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eè¯­ä¹‰åˆ†å‰²æ˜¯è®¡ç®—æœºè¾…åŠ©åŒ»å­¦å›¾åƒåˆ†æçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯è¯†åˆ«å¹¶çªå‡ºæ˜¾ç¤ºå„ç§è¯Šæ–­ä»»åŠ¡ä¸­æ„Ÿå…´è¶£çš„åŒºåŸŸã€‚ç„¶è€Œï¼Œç”±äºæ¶‰åŠå›¾åƒæ¨¡æ€å’Œé‡‡é›†ä»¥åŠç—…ç†å’Œç”Ÿç‰©å˜åŒ–çš„å„ç§å› ç´ ï¼Œè¿™é€šå¸¸å˜å¾—å¤æ‚[18]ã€‚æ·±åº¦å­¦ä¹ åœ¨è¿™ä¸€é¢†åŸŸçš„åº”ç”¨æ— ç–‘åœ¨è¿™æ–¹é¢å—ç›ŠåŒªæµ…ã€‚æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè‡ªæ¨å‡ºä»¥æ¥ï¼ŒUNet æ¨¡å‹ [19] åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹é¢è¡¨ç°å‡ºäº†æƒŠäººçš„åŠŸæ•ˆã€‚ç»“æœï¼ŒUNet åŠå…¶è¡ç”Ÿå“å·²æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†[25]ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eå­¦ä¹ ä¸€ä¸‹è¿™é‡Œçš„èƒŒæ™¯æè¿°\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåŸå§‹çš„ UNet æ¨¡å‹åŒ…å«å¯¹ç§°çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼ˆå›¾ 1aï¼‰å¹¶é‡‡ç”¨è·³è·ƒè¿æ¥ï¼Œè¿™ä¸ºè§£ç å™¨æä¾›äº†åœ¨ç¼–ç å™¨çš„æ± åŒ–æ“ä½œæœŸé—´å¯èƒ½ä¸¢å¤±çš„ç©ºé—´ä¿¡æ¯ã€‚å°½ç®¡é€šè¿‡ç®€å•ä¸²è”çš„ä¿¡æ¯ä¼ æ’­æé«˜äº†æ€§èƒ½ï¼Œä½†ç¼–ç å™¨-è§£ç å™¨ç‰¹å¾å›¾ä¹‹é—´å¯èƒ½å­˜åœ¨è¯­ä¹‰å·®è·ã€‚è¿™å¯¼è‡´äº†ç¬¬äºŒç±» UNet çš„å‘å±•ï¼ˆå›¾ 1bï¼‰ã€‚ U-Net++ [26] åˆ©ç”¨å¯†é›†è¿æ¥ï¼Œè€Œ MultiResUNet [11] åœ¨è·³è¿‡è¿æ¥ä¸Šæ·»åŠ äº†é¢å¤–çš„å·ç§¯å—ä½œä¸ºæ½œåœ¨çš„è¡¥æ•‘æªæ–½ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒUNet çš„å†å²ä¸Šæ‰€æœ‰åˆ›æ–°éƒ½æ˜¯ä½¿ç”¨ CNN è¿›è¡Œçš„ã€‚ç„¶è€Œï¼Œ2020 å¹´çš„åå¹´ç»™è®¡ç®—æœºè§†è§‰é¢†åŸŸå¸¦æ¥äº†æ ¹æœ¬æ€§çš„å˜åŒ–ã€‚ CNN åœ¨è§†è§‰é¢†åŸŸçš„é•¿æœŸä¸»å¯¼åœ°ä½è¢«è§†è§‰è½¬æ¢å™¨æ‰“ç ´äº† [7]ã€‚ Swin Transformers [15] è¿›ä¸€æ­¥é’ˆå¯¹ä¸€èˆ¬è§†è§‰åº”ç”¨è°ƒæ•´äº†å˜å‹å™¨ã€‚å› æ­¤ï¼ŒUNet æ¨¡å‹å¼€å§‹é‡‡ç”¨ Transformer [5]ã€‚ Swin-Unet [9] ç”¨ Swin Transformer å—å–ä»£äº†å·ç§¯å—ï¼Œä»è€Œå¼€åˆ›äº†ä¸€ç±»æ–°çš„æ¨¡å‹ï¼ˆå›¾ 1cï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒCNN åœ¨å›¾åƒåˆ†å‰²æ–¹é¢ä»ç„¶å…·æœ‰å„ç§ä¼˜ç‚¹ï¼Œå¯¼è‡´äº†èåˆè¿™ä¸¤è€…çš„å‘å±•[2]ã€‚è¿™ç§æ··åˆç±» UNet æ¨¡å‹ï¼ˆå›¾ 1dï¼‰åœ¨ç¼–ç å™¨-è§£ç å™¨ä¸­é‡‡ç”¨å·ç§¯å—ï¼Œå¹¶æ²¿è·³è·ƒè¿æ¥ä½¿ç”¨å˜æ¢å™¨å±‚ã€‚ UCTransNet [22]å’ŒMCTrans[24]æ˜¯æ­¤ç±»çš„ä¸¤ä¸ªä»£è¡¨æ€§æ¨¡å‹ã€‚æœ€åï¼Œè¿˜å°è¯•å¼€å‘å…¨å˜å‹å™¨ UNet æ¶æ„ï¼ˆå›¾ 1eï¼‰ï¼Œä¾‹å¦‚ï¼ŒSMESwin Unet [27] åœ¨ç¼–ç å™¨-è§£ç å™¨å—å’Œè·³è·ƒè¿æ¥ä¸­éƒ½ä½¿ç”¨å˜å‹å™¨ã€‚\u003c/p\u003e","title":"ACC-UNet: A Completely Convolutional UNet model for the 2020s (MICCAI2023)"},{"content":"(2023) M2SNet: æ–°é¢–å¤šå°ºåº¦æ¨¡å— + æ™ºèƒ½æŸå¤±å‡½æ•° = é€šç”¨å›¾åƒåˆ†å‰²SOTAç½‘ç»œ Abstract å‡†ç¡®çš„åŒ»å­¦å›¾åƒåˆ†å‰²å¯¹äºæ—©æœŸåŒ»å­¦è¯Šæ–­è‡³å…³é‡è¦ã€‚å¤§å¤šæ•°ç°æœ‰æ–¹æ³•åŸºäºUå½¢ç»“æ„ï¼Œå¹¶ä½¿ç”¨é€å…ƒç´ åŠ æ³•æˆ–ä¸²è”åœ¨è§£ç å™¨ä¸­é€æ­¥èåˆä¸åŒçº§åˆ«çš„ç‰¹å¾ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ“ä½œéƒ½å®¹æ˜“äº§ç”Ÿå¤§é‡å†—ä½™ä¿¡æ¯ï¼Œä»è€Œå‰Šå¼±ä¸åŒçº§åˆ«ç‰¹å¾ä¹‹é—´çš„äº’è¡¥æ€§ï¼Œå¯¼è‡´ç—…ç¶å®šä½ä¸å‡†ç¡®å’Œè¾¹ç¼˜æ¨¡ç³Šã€‚ä¸ºäº†åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§é€šç”¨çš„å¤šå°ºåº¦å‡æ³•ç½‘ç»œï¼ˆM2SNetï¼‰æ¥å®ŒæˆåŒ»å­¦å›¾åƒçš„å¤šæ ·åŒ–åˆ†å‰²ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬é¦–å…ˆè®¾è®¡ä¸€ä¸ªåŸºæœ¬å‡æ³•å•å…ƒï¼ˆSUï¼‰æ¥äº§ç”Ÿç¼–ç å™¨ä¸­ç›¸é‚»çº§åˆ«ä¹‹é—´çš„å·®å¼‚ç‰¹å¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å•å°ºåº¦ SU æ‰©å±•åˆ°å±‚å†…å¤šå°ºåº¦ SUï¼Œå®ƒå¯ä»¥ä¸ºè§£ç å™¨æä¾›åƒç´ çº§å’Œç»“æ„çº§å·®å¼‚ä¿¡æ¯ã€‚\nç„¶åï¼Œæˆ‘ä»¬é‡‘å­—å¡”å¼åœ°ä¸ºä¸åŒå±‚æ¬¡çš„å¤šå°ºåº¦SUé…å¤‡ä¸åŒçš„æ„Ÿå—é‡ï¼Œä»è€Œå®ç°å±‚é—´å¤šå°ºåº¦ç‰¹å¾èšåˆå¹¶è·å¾—ä¸°å¯Œçš„å¤šå°ºåº¦å·®å¼‚ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå…è®­ç»ƒç½‘ç»œâ€œLossNetâ€æ¥å…¨é¢ç›‘ç£ä»åº•å±‚åˆ°é¡¶å±‚çš„ä»»åŠ¡æ„ŸçŸ¥ç‰¹å¾ï¼Œè¿™é©±åŠ¨æˆ‘ä»¬çš„å¤šå°ºåº¦å‡æ³•ç½‘ç»œåŒæ—¶æ•è·ç»†èŠ‚å’Œç»“æ„çº¿ç´¢ã€‚\næ²¡æœ‰èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸åŒçš„è¯„ä¼°æŒ‡æ ‡ä¸‹ï¼Œåœ¨ä¸åŒå›¾åƒæ¨¡æ€çš„å››ç§ä¸åŒåŒ»å­¦å›¾åƒåˆ†å‰²ä»»åŠ¡çš„ 11 ä¸ªæ•°æ®é›†ä¸Šè¡¨ç°ä¼˜äºå¤§å¤šæ•°æœ€å…ˆè¿›çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å½©è‰²ç»“è‚ é•œæˆåƒã€è¶…å£°æˆåƒã€è®¡ç®—æœºæ–­å±‚æ‰«æ (CT) ï¼‰å’Œå…‰å­¦ç›¸å¹²æ–­å±‚æ‰«æï¼ˆOCTï¼‰ã€‚\nä¸¤ä¸ªä¸»è¦åˆ›æ–°ç‚¹ï¼šå¤šå°ºåº¦é‡‘å­—å¡”å‡æ³•å•å…ƒ ï¼ˆç¡®å®ç‰›é€¼ï¼‰+ LossNetï¼ˆä¸ºäº†åˆ›æ–°è€Œåˆ›æ–°çš„æŸå¤±å‡½æ•°ï¼‰\nIntroduction ä½œä¸ºè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿä¸­çš„é‡è¦ä½œç”¨ï¼Œç²¾ç¡®çš„åŒ»å­¦å›¾åƒåˆ†å‰²æŠ€æœ¯å¯ä»¥ä¸ºåŒ»ç”Ÿåšå‡ºä¸´åºŠå†³ç­–æä¾›é‡è¦æŒ‡å¯¼ã€‚ç²¾ç¡®åˆ†å‰²å­˜åœ¨ä¸‰ä¸ªæ™®éçš„æŒ‘æˆ˜ï¼šé¦–å…ˆï¼ŒUå½¢ç»“æ„[1]ã€[2]ç”±äºå…¶åˆ©ç”¨å¤šçº§ä¿¡æ¯é‡å»ºé«˜åˆ†è¾¨ç‡ç‰¹å¾å›¾çš„èƒ½åŠ›è€Œå—åˆ°äº†ç›¸å½“å¤šçš„å…³æ³¨ã€‚åœ¨UNet [2]ä¸­ï¼Œä¸Šé‡‡æ ·çš„ç‰¹å¾å›¾ä¸ä»ç¼–ç å™¨è·³è¿‡çš„ç‰¹å¾å›¾è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶åœ¨ä¸Šé‡‡æ ·æ­¥éª¤ä¹‹é—´æ·»åŠ å·ç§¯å’Œéçº¿æ€§ï¼Œå¦‚å›¾1ï¼ˆaï¼‰æ‰€ç¤ºã€‚åç»­åŸºäºUNetçš„æ–¹æ³•é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶[3]ã€[4]ã€é—¨æœºåˆ¶[5]ã€[6]ã€å˜å‹å™¨æŠ€æœ¯[7]ã€[8]è®¾è®¡ä¸åŒçš„ç‰¹å¾å¢å¼ºæ¨¡å—ï¼Œå¦‚å›¾1ï¼ˆbï¼‰æ‰€ç¤ºã€‚ UNet++[9]ä½¿ç”¨åµŒå¥—å’Œå¯†é›†çš„è·³è·ƒè¿æ¥æ¥å‡å°‘ç¼–ç å™¨å’Œè§£ç å™¨çš„ç‰¹å¾å›¾ä¹‹é—´çš„è¯­ä¹‰å·®è·ï¼Œå¦‚å›¾1ï¼ˆcï¼‰æ‰€ç¤ºã€‚\nå…ˆè¯´åŒ»å­¦åˆ†å‰²åœ¨åŒ»å­¦é¢†åŸŸé‡è¦\u0026hellip;(balabala) ç„¶åå½“å‰é¢†åŸŸå­˜åœ¨xxxæŒ‘æˆ˜\u0026hellip;(balabala)\nè¿™é‡Œæ˜¯ä»¥åŒ»å­¦å›¾åƒåˆ†å‰²æŒ‘æˆ˜çš„è§†è§’ï¼Œä»‹ç»UNetå‘å±•çš„æƒ…å†µã€‚ç„¶ååœ¨æè¿°ä¸åŒUNetå˜ä½“å‘å±•è¿‡ç¨‹ä¸­è§£å†³çš„ä¸åŒé—®é¢˜ï¼ˆæ„Ÿè§‰å¯ä»¥å€Ÿé‰´ï¼‰\nä¸€èˆ¬æ¥è¯´ï¼Œç¼–ç å™¨ä¸­ä¸åŒçº§åˆ«çš„ç‰¹å¾æœ‰ä¸åŒçš„ç‰¹å¾ã€‚é«˜çº§åˆ«å…·æœ‰æ›´å¤šçš„è¯­ä¹‰ä¿¡æ¯ï¼Œæœ‰åŠ©äºå®šä½å¯¹è±¡ï¼Œè€Œä½çº§åˆ«å…·æœ‰æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥æ•æ‰å¯¹è±¡çš„å¾®å¦™è¾¹ç•Œã€‚è§£ç å™¨åˆ©ç”¨ç‰¹å®šçº§åˆ«å’Œè·¨çº§åˆ«ç‰¹å¾æ¥ç”Ÿæˆæœ€ç»ˆçš„é«˜åˆ†è¾¨ç‡é¢„æµ‹ã€‚ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•ç›´æ¥ä½¿ç”¨é€å…ƒç´ åŠ æ³•æˆ–ä¸²è”æ¥èåˆæ¥è‡ªç¼–ç å™¨çš„ä»»æ„ä¸¤çº§ç‰¹å¾å¹¶å°†å®ƒä»¬ä¼ è¾“åˆ°è§£ç å™¨ã€‚è¿™äº›ç®€å•çš„æ“ä½œå¹¶æ²¡æœ‰æ›´å¤šåœ°å…³æ³¨ä¸åŒå±‚æ¬¡ä¹‹é—´çš„å·®å¼‚ä¿¡æ¯ã€‚è¿™ä¸€ç¼ºç‚¹ä¸ä»…ä¼šäº§ç”Ÿå†—ä½™ä¿¡æ¯æ¥ç¨€é‡ŠçœŸæ­£æœ‰ç”¨çš„ç‰¹å¾ï¼Œè¿˜ä¼šå‰Šå¼±ç‰¹å®šäºçº§åˆ«çš„ç‰¹å¾çš„ç‰¹æ€§ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ— æ³•å¹³è¡¡ç²¾ç¡®å®šä½å’Œå¾®å¦™çš„è¾¹ç•Œç»†åŒ–ã€‚å…¶æ¬¡ï¼Œç”±äºæ„Ÿå—é‡æœ‰é™ï¼Œå•å°ºåº¦å·ç§¯æ ¸å¾ˆéš¾æ•è·å¤§å°å˜åŒ–ç‰©ä½“çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¸€äº›æ–¹æ³•[1]ã€[2]ã€[9]-[11]ä¾èµ–äºå±‚é—´å¤šå°ºåº¦ç‰¹å¾ï¼Œå¹¶é€æ­¥æ•´åˆæ¥è‡ªä¸åŒå°ºåº¦è¡¨ç¤ºçš„è¯­ä¹‰ä¸Šä¸‹æ–‡å’Œçº¹ç†ç»†èŠ‚ã€‚å…¶ä»–äºº[6]ã€[12]-[15]ä¸“æ³¨äºåŸºäºç½‘ç»œä¸­çš„ç©ºæ´ç©ºé—´é‡‘å­—å¡”æ± åŒ–æ¨¡å—[16]ï¼ˆASPPï¼‰æˆ–DenseASPP [17]æå–å±‚å†…å¤šå°ºåº¦ä¿¡æ¯ã€‚ç„¶è€Œï¼Œç±»ä¼¼ASPPçš„å¤šå°ºåº¦å·ç§¯æ¨¡å—ä¼šäº§ç”Ÿè®¸å¤šé¢å¤–çš„å‚æ•°å’Œè®¡ç®—ã€‚è®¸å¤šæ–¹æ³•[5]ã€[18]-[21]é€šå¸¸å°†å¤šä¸ªASPPæ¨¡å—å®‰è£…åˆ°ä¸åŒçº§åˆ«çš„ç¼–ç å™¨/è§£ç å™¨å—ä¸­ï¼Œè€Œæœ‰äº›æ–¹æ³•[13]ã€[14]ã€[22]ã€[23]å°†å…¶å®‰è£…åœ¨ä¸åŒçº§åˆ«çš„ç¼–ç å™¨/è§£ç å™¨å—ä¸­ã€‚æœ€é«˜çº§åˆ«çš„ç¼–ç å™¨å—ã€‚ç¬¬ä¸‰ï¼ŒæŸå¤±å‡½æ•°çš„å½¢å¼ç›´æ¥ä¸ºç½‘ç»œçš„æ¢¯åº¦ä¼˜åŒ–æä¾›äº†æ–¹å‘ã€‚åœ¨åˆ†å‰²é¢†åŸŸï¼Œæå‡ºäº†è®¸å¤šæŸå¤±å‡½æ•°æ¥ç›‘ç£ä¸åŒçº§åˆ«çš„é¢„æµ‹ï¼Œä¾‹å¦‚åƒç´ çº§åˆ«çš„L1æŸå¤±ã€äº¤å‰ç†µæŸå¤±å’ŒåŠ æƒäº¤å‰ç†µæŸå¤±[24]ï¼ŒSSIM[25]æŸå¤±åŒºåŸŸå±‚é¢çš„ä¸ç¡®å®šæ€§æŸå¤±[26]ï¼Œå…¨å±€å±‚é¢çš„IoUæŸå¤±ã€DiceæŸå¤±å’Œä¸€è‡´æ€§å¢å¼ºæŸå¤±[11]ã€‚å°½ç®¡è¿™äº›åŸºæœ¬æŸå¤±å‡½æ•°åŠå…¶å˜ä½“å…·æœ‰ä¸åŒçš„ä¼˜åŒ–ç‰¹æ€§ï¼Œä½†å¤æ‚çš„æ‰‹åŠ¨æ•°å­¦å½¢å¼çš„è®¾è®¡å¯¹äºè®¸å¤šç ”ç©¶æ¥è¯´ç¡®å®éå¸¸è€—æ—¶ã€‚ä¸ºäº†è·å¾—ç»¼åˆæ€§èƒ½ï¼Œæ¨¡å‹é€šå¸¸ä¼šé›†æˆå¤šç§æŸå¤±å‡½æ•°ï¼Œè¿™å¯¹ç ”ç©¶äººå‘˜çš„è®­ç»ƒæŠ€èƒ½æå‡ºäº†å¾ˆé«˜çš„è¦æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºæœ‰å¿…è¦å¼•å…¥ä¸€ç§æ— éœ€å¤æ‚äººå·¥è®¾è®¡çš„æ™ºèƒ½æŸå¤±å‡½æ•°æ¥å…¨é¢ç›‘ç£åˆ†å‰²é¢„æµ‹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”¨äºä¸€èˆ¬åŒ»å­¦å›¾åƒåˆ†å‰²çš„æ–°å‹å¤šå°ºåº¦å‡æ³•ç½‘ç»œï¼ˆM2SNetï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå‡æ³•å•å…ƒï¼ˆSUï¼‰å¹¶å°†å…¶åº”ç”¨äºæ¯å¯¹ç›¸é‚»çš„çº§åˆ«ç‰¹å¾ã€‚ SUçªå‡ºäº†ç‰¹å¾ä¹‹é—´æœ‰ç”¨çš„å·®å¼‚ä¿¡æ¯ï¼Œå¹¶æ¶ˆé™¤äº†å†—ä½™éƒ¨åˆ†çš„å¹²æ‰°ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å€ŸåŠ©æ‰€æå‡ºçš„å¤šå°ºåº¦å‡æ³•æ¨¡å—æ”¶é›†æç«¯å¤šå°ºåº¦ä¿¡æ¯ã€‚\nå¯¹äºå±‚é—´å¤šå°ºåº¦ä¿¡æ¯ï¼Œæˆ‘ä»¬ä»¥é‡‘å­—å¡”æ–¹å¼è¿æ¥å¤šä¸ªå‡æ³•å•å…ƒæ¥æ•è·å¤§è·¨åº¦çš„è·¨å±‚ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬èšåˆç‰¹å®šäºçº§åˆ«çš„ç‰¹å¾å’Œå¤šè·¯å¾„è·¨çº§åˆ«å·®åˆ†ç‰¹å¾ï¼Œç„¶ååœ¨è§£ç å™¨ä¸­ç”Ÿæˆæœ€ç»ˆé¢„æµ‹ã€‚å¯¹äºå±‚å†…å¤šå°ºåº¦ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ç»„ä¸åŒå†…æ ¸å¤§å°çš„full oneæ»¤æ³¢å™¨å°†å•å°ºåº¦å‡æ³•å•å…ƒæ”¹è¿›ä¸ºå¤šå°ºåº¦å‡æ³•å•å…ƒï¼Œå¯ä»¥è‡ªç„¶åœ°å®ç°å¤šå°ºåº¦å‡æ³•èšåˆï¼Œè€Œæ— éœ€å¼•å…¥é¢å¤–çš„å‚æ•°ã€‚å¦‚å›¾1æ‰€ç¤ºï¼ŒMSNeté…å¤‡äº†å±‚é—´å¤šå°ºåº¦å‡æ³•æ¨¡å—ï¼ŒM2SNetåŒæ—¶å…·æœ‰å±‚é—´å’Œå±‚å†…å¤šå°ºåº¦å‡æ³•ç»“æ„ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªLossNetæ¥è‡ªåŠ¨ç›‘ç£ä»åº•å±‚åˆ°é¡¶å±‚æå–çš„ç‰¹å¾å›¾ï¼Œå®ƒå¯ä»¥é€šè¿‡ç®€å•çš„L2æŸå¤±å‡½æ•°ä¼˜åŒ–ä»ç»†èŠ‚åˆ°ç»“æ„çš„åˆ†å‰²ã€‚\nå¤šå°ºåº¦å‡æ³•å•å…ƒå¯ä»¥å»ç‰¹å¾ä¹‹é—´çš„å·®å¼‚ä¿¡æ¯ï¼Œæ¶ˆé™¤å†—ä½™å¹²æ‰°ã€‚\nï¼ˆä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨è¿™ç§åŠæ³•æ›¿æ¢æ³¨æ„åŠ›æœºåˆ¶ï¼‰\nRELATED WORK Medical Image Segmentation Network æ ¹æ®ä¸åŒå™¨å®˜æˆ–ç—…å˜çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°†ç°æœ‰çš„åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹æ³•åˆ†ä¸ºä¸¤ç±»ï¼šåŒ»å­¦é€šç”¨çš„å’ŒåŒ»å­¦ä¸“ç”¨çš„ã€‚éšç€U-Net[2]åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²é¢†åŸŸå–å¾—ç¨³å®šçš„æ€§èƒ½ï¼Œå¸¦æœ‰ç¼–ç å™¨-è§£ç å™¨çš„Uå½¢ç»“æ„å·²æˆä¸ºåŸºæœ¬çš„åˆ†å‰²åŸºçº¿ã€‚ U-Net++[9]é›†æˆäº†é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå¯ä»¥å‡å°‘ç¼–ç å™¨å’Œè§£ç å™¨å­ç½‘ç»œçš„ç‰¹å¾å›¾ä¹‹é—´çš„è¯­ä¹‰å·®è·ã€‚å¯¹äºæ³¨æ„åŠ› U-Net [28]ï¼Œæ³¨æ„åŠ›é—¨åµŒå…¥åœ¨ç¼–ç å™¨å’Œè§£ç å™¨å—ä¹‹é—´çš„æ¯ä¸ªè¿‡æ¸¡å±‚ä¸­ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å­¦ä¹ å…³æ³¨ä¸åŒå½¢çŠ¶å’Œå¤§å°çš„ç›®æ ‡ç»“æ„ã€‚æœ€è¿‘ï¼ŒTransformer [29]æ¶æ„åœ¨è®¸å¤šè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­å–å¾—äº†æˆåŠŸã€‚ä¸€äº›ä½œå“[7]ã€[8]æ¢è®¨äº†å…¶å¯¹åŒ»å­¦è§†è§‰ä»»åŠ¡çš„æœ‰æ•ˆæ€§ã€‚ UTNet [7] æ˜¯ä¸€ç§ç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„æ··åˆå˜å‹å™¨æ¶æ„ï¼Œå®ƒåœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¸­åº”ç”¨è‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œä»¥æœ€å°çš„å¼€é”€æ•è·ä¸åŒè§„æ¨¡çš„è¿œç¨‹ä¾èµ–å…³ç³»ã€‚å¦ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„åŸºäº Transformer çš„æ¨¡å‹æ˜¯ TransUNet [8]ï¼Œå®ƒé€šè¿‡å°†å›¾åƒç‰¹å¾è§†ä¸ºåºåˆ—æ¥ç¼–ç å¼ºå…¨å±€ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡ U å½¢æ··åˆæ¶æ„è®¾è®¡åˆ©ç”¨ä½çº§ CNN ç‰¹å¾ã€‚\nåŒ»å­¦ç‰¹å®šæ–¹æ³•ã€‚åœ¨æ¯è‚‰åˆ†å‰²ä»»åŠ¡ä¸­ï¼ŒSFA [30]å’ŒPraNet [4]ä¸“æ³¨äºæ¢å¤æ¯è‚‰ä¸å…¶å‘¨å›´ç²˜è†œä¹‹é—´çš„æ¸…æ™°è¾¹ç•Œã€‚å‰è€…æå‡ºäº†å…±äº«ç¼–ç å™¨å’Œä¸¤ä¸ªç›¸äº’çº¦æŸçš„è§£ç å™¨ä¸‹çš„é€‰æ‹©æ€§ç‰¹å¾èšåˆç»“æ„å’Œè¾¹ç•Œæ•æ„ŸæŸå¤±å‡½æ•°ã€‚åè€…åˆ©ç”¨åå‘æ³¨æ„æ¨¡å—æ¥å»ºç«‹åŒºåŸŸå’Œè¾¹ç•Œçº¿ç´¢ä¹‹é—´çš„å…³ç³»ã€‚æ­¤å¤–ï¼ŒJiç­‰äºº[31]åˆ©ç”¨æ—¶ç©ºä¿¡æ¯æ„å»ºè§†é¢‘æ¯è‚‰åˆ†å‰²æ¨¡å‹ã€‚åœ¨COVID-19è‚ºéƒ¨æ„ŸæŸ“ä»»åŠ¡ä¸­ï¼ŒPaluruç­‰äºº[32]æå‡ºäº†ä¸€ç§åŸºäºå˜å½¢æ·±åº¦åµŒå…¥çš„è½»é‡çº§CNNæ¥åˆ†å‰²COVID-19èƒ¸éƒ¨CTå›¾åƒä¸­çš„å¼‚å¸¸ã€‚ Inf-Net [33] æ„å»ºéšå¼åå‘æ³¨æ„åŠ›å’Œæ˜¾å¼è¾¹ç¼˜æ³¨æ„åŠ›æ¥å¯¹è¾¹ç•Œè¿›è¡Œå»ºæ¨¡ã€‚ BCS-Net [34]å…·æœ‰ä¸‰ä¸ªæ¸è¿›è¾¹ç•Œä¸Šä¸‹æ–‡è¯­ä¹‰é‡å»ºå—ï¼Œå¯ä»¥å¸®åŠ©è§£ç å™¨æ•è·è‚ºéƒ¨æ„ŸæŸ“çš„é›¶æ•£åŒºåŸŸã€‚åœ¨ä¹³è…ºåˆ†å‰²ä»»åŠ¡ä¸­ï¼ŒByraç­‰äºº[35]é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å¼€å‘äº†é€‰æ‹©æ€§æ ¸æ¥è°ƒæ•´U-Netçš„æ„Ÿå—é‡ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜ä¹³è…ºè‚¿ç˜¤çš„åˆ†å‰²ç²¾åº¦ã€‚ Chen ç­‰äºº [36] æå‡ºäº†ä¸€ç§åµŒå¥— U ç½‘ï¼Œé€šè¿‡åˆ©ç”¨ä¸åŒçš„æ·±åº¦å’Œå…±äº«æƒé‡æ¥å®ç°ä¹³è…ºè‚¿ç˜¤çš„ç¨³å¥è¡¨ç¤ºã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŒ»å­¦é€šç”¨æ–¹æ³•é€šå¸¸é’ˆå¯¹é€šç”¨æŒ‘æˆ˜ï¼ˆå³ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºã€å¤šå°ºåº¦ä¿¡æ¯æå–å’Œè·¨çº§åˆ«ç‰¹å¾èšåˆï¼‰ã€‚å¹¶ä¸”ï¼ŒåŒ»å­¦ç‰¹å¼‚æ€§æ–¹æ³•æ ¹æ®å½“å‰å™¨å®˜æˆ–ç—…å˜çš„ç‰¹å¾æå‡ºæœ‰é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚è®¾è®¡ä¸€ç³»åˆ—æ³¨æ„åŠ›æœºåˆ¶ã€è¾¹ç¼˜å¢å¼ºæ¨¡å—ã€ä¸ç¡®å®šæ€§ä¼°è®¡ç­‰ã€‚ç„¶è€Œï¼Œé€šç”¨åŒ»å­¦æ¨¡å‹å’ŒåŒ»å­¦ç‰¹å¼‚æ€§æ¨¡å‹éƒ½ä¾èµ–äºé€šè¿‡å¤§é‡çš„åŠ æ³•æˆ–ä¸²è”æ“ä½œæ¥å®ç°ç‰¹å¾èåˆï¼Œå‰Šå¼±äº†äº’è¡¥ç‰¹å¾ä¹‹é—´çš„ç‰¹æ®Šæ€§éƒ¨åˆ†ã€‚æˆ‘ä»¬æå‡ºçš„å¤šå°ºåº¦å‡æ³•æ¨¡å—è‡ªç„¶ä¸“æ³¨äºæå–å·®å¼‚ä¿¡æ¯ï¼Œä»è€Œä¸ºè§£ç å™¨æä¾›æœ‰æ•ˆçš„ç›®æ ‡ç‰¹å¾ã€‚\nä¸»è¦æ˜¯è¯´å¤§éƒ¨åˆ†ç‰¹å¾èåˆéƒ½æ˜¯ç”¨åŠ æ³•/ä¹˜æ³•/ä¸²è”å®ç°çš„ï¼Œä½†æ˜¯å‡æ³•å¯ä»¥å‰Šå¼±äº’è¡¥ç‰¹å¾ä¹‹é—´çš„ç‰¹æ®Šæ€§éƒ¨åˆ†ã€‚æ‰€ä»¥å¤šå°ºåº¦å‡æ³•æ¨¡å—æå–å·®å¼‚ä¿¡æ¯ï¼Œç„¶åå†ç”¨åŠ æ³•è¿›è¡Œç‰¹å¾èåˆã€‚\nMulti-scale Feature Extraction å°ºåº¦çº¿ç´¢åœ¨æ•æ‰å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚å—åˆ°è¢«å¹¿æ³›éªŒè¯ä¸ºæœ‰æ•ˆä¸”ç†è®ºä¸Šåˆç†çš„æ¡†æ¶çš„å°ºåº¦ç©ºé—´ç†è®ºçš„å¯å‘ï¼Œè¶Šæ¥è¶Šå¤šçš„å¤šå°ºåº¦æ–¹æ³•è¢«æå‡ºã€‚ä¸å•å°ºåº¦ç‰¹å¾ç›¸æ¯”ï¼Œå¤šå°ºåº¦ç‰¹å¾æœ‰åˆ©äºè§£å†³è‡ªç„¶å‘ç”Ÿçš„å°ºåº¦å˜åŒ–ã€‚è¿™ä¸€ç‰¹æ€§å¯ä»¥å¸®åŠ©åŒ»å­¦åˆ†å‰²æ¨¡å‹æ„ŸçŸ¥ä¸åŒå°ºåº¦çš„ç—…å˜ã€‚æ ¹æ®å½¢å¼ï¼Œå½“å‰åŸºäºå¤šå°ºåº¦çš„æ–¹æ³•å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œå³å±‚é—´å¤šå°ºåº¦ç»“æ„å’Œå±‚å†…å¤šå°ºåº¦ç»“æ„ã€‚å‰è€…åŸºäºç‰¹å¾ç¼–ç å™¨æå–çš„ä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼Œå¹¶åœ¨è§£ç å™¨ä¸­é€æ­¥èšåˆå®ƒä»¬ï¼Œä¾‹å¦‚Uå½¢[1]ã€[2]ã€[4]ã€[9]-[11]ã€[37] ï¼Œ[38]æ¶æ„ã€‚åè€…é€šå¸¸é…å¤‡å¤šå°ºåº¦å¯æ’æ‹”æ¨¡å—ï¼Œå¦‚ASPP [16]ã€DenseASPP [17]ã€FoldASPP [6]å’ŒPAFEM [12]ï¼Œæ„å»ºå…·æœ‰ä¸åŒæ‰©å¼ ç‡çš„å¹¶è¡Œå¤šåˆ†æ”¯å·ç§¯å±‚ï¼Œä»¥è·å¾—ä¸°å¯Œçš„ç»„åˆæ„Ÿå—é‡ã€‚ä¸å®ƒä»¬ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡åŒæ—¶å¼•å…¥å±‚é—´å’Œå±‚å†…å¤šå°ºåº¦ï¼Œæå‡ºäº†å…·æœ‰æç«¯å¤šå°ºåº¦ä¿¡æ¯çš„å¤šå°ºåº¦å‡æ³•æ¨¡å—ä¸­çš„å¤šå°ºåº¦ã€‚å¹¶ä¸”ï¼Œå±‚å†…å¤šå°ºåº¦å‡æ³•å•å…ƒä¸“æ³¨äºæŒ–æ˜ä»åƒç´ åˆ°åƒç´ åˆ°åŒºåŸŸåˆ°åŒºåŸŸçš„ç‰¹å¾å¯¹çš„è‡ªå·®åˆ†æ€§è´¨ã€‚ä¸å•å°ºåº¦æ“ä½œç›¸æ¯”ï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸é«˜æ•ˆï¼Œä¸éœ€è¦é¢å¤–çš„å‚æ•°ã€‚\nå¤šå°ºåº¦å‡æ³•æ¨¡å—å¯ä»¥è¶…è¶Šå…¶ä»–å·ç§¯ç±»åŠæ³•çš„å¤šå°ºåº¦ç‰¹å¾ä¿¡æ¯æå–åŠæ³•\nLoss Method å›¾åƒåˆ†å‰²ä¸­çš„å¤§å¤šæ•°æŸå¤±å‡½æ•°éƒ½æ˜¯åŸºäºäº¤å‰ç†µæˆ–é‡åˆåº¦é‡ã€‚ä¼ ç»Ÿçš„äº¤å‰ç†µæŸå¤±å¯¹ç±»åˆ«ä¿¡æ¯ä¸€è§†åŒä»ã€‚ Longç­‰äºº[24]æå‡ºäº†æ¯ä¸ªç±»åˆ«çš„åŠ æƒäº¤å‰ç†µæŸå¤±ï¼ˆWCEï¼‰ï¼Œä»¥æŠµæ¶ˆæ•°æ®ä¸­çš„ç±»åˆ«ä¸å¹³è¡¡ã€‚ Linç­‰äºº[39]å¼•å…¥äº†å›°éš¾æ ·æœ¬å’Œç®€å•æ ·æœ¬çš„æƒé‡æ¥æå‡ºç„¦ç‚¹æŸå¤±ã€‚ Dice loss[40]è¢«æå‡ºä½œä¸ºV-Netä¸­é‡åˆæµ‹é‡çš„æŸå¤±å‡½æ•°ï¼Œå¯ä»¥æœ‰æ•ˆæŠ‘åˆ¶ç±»åˆ«ä¸å¹³è¡¡å¸¦æ¥çš„é—®é¢˜ã€‚ Tversky æŸå¤±[41]æ˜¯ Dice æŸå¤±çš„æ­£åˆ™åŒ–ç‰ˆæœ¬ï¼Œç”¨äºæ§åˆ¶å‡†ç¡®ç‡å’Œå¬å›ç‡å¯¹æŸå¤±å‡½æ•°çš„è´¡çŒ®ã€‚ Wongç­‰äºº[42]é€šè¿‡DiceæŸå¤±å’ŒWCEæŸå¤±çš„åŠ æƒæ±‚å’Œæå‡ºæŒ‡æ•°å¯¹æ•°æŸå¤±ï¼ˆEL Lossï¼‰æ¥æé«˜å°ç»“æ„ç‰©ä½“çš„åˆ†å‰²ç²¾åº¦ã€‚\nTaghanakiç­‰äºº[43]å‘ç°å•ç‹¬ä½¿ç”¨åŸºäºé‡å çš„æŸå¤±å‡½æ•°å­˜åœ¨é£é™©ï¼Œå¹¶æå‡ºcomomolosså°†DiceæŸå¤±ä½œä¸ºæ­£åˆ™åŒ–é¡¹ä¸WCEæŸå¤±ç›¸ç»“åˆæ¥å¤„ç†è¾“å…¥è¾“å‡ºä¸å¹³è¡¡çš„é—®é¢˜ã€‚\nè™½ç„¶è¿™äº›å„ç§å„æ ·çš„æŸå¤±å‡½æ•°åœ¨ä¸åŒå±‚æ¬¡ä¸Šæœ‰ä¸åŒçš„æ•ˆæœï¼Œä½†æ‰‹åŠ¨è®¾è®¡è¿™äº›å¤æ‚çš„å‡½æ•°ç¡®å®è´¹æ—¶è´¹åŠ›ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†è‡ªåŠ¨ä¸”å…¨é¢çš„åˆ†å‰²æŸå¤±ç»“æ„ï¼Œç§°ä¸ºLossNetã€‚\nLossNetæƒé‡å°±0.1 ï¼ˆ æ„Ÿè§‰è¿™ä¸ªæ˜¯ä¸ºäº†åˆ›æ–°è€Œåˆ›æ–°ï¼‰\nMETHOD Encoder: Res2Net + Connection: MMSB + Decoder: Plus\nMulti-scale in Multi-scale Subtraction Module æˆ‘ä»¬ä½¿ç”¨ FA å’Œ FB æ¥è¡¨ç¤ºç›¸é‚»çº§åˆ«çš„ç‰¹å¾å›¾ã€‚\nå®ƒä»¬éƒ½å·²è¢« ReLU æ“ä½œæ¿€æ´»ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŸºæœ¬å‡æ³•å•ä½ï¼ˆSUï¼‰ï¼š\nå…¶ä¸­æ˜¯é€å…ƒç´ å‡æ³•è¿ç®—ï¼Œç„¶åè®¡ç®—ç»å¯¹å€¼ï¼ŒConv(Â·) è¡¨ç¤ºå·ç§¯å±‚ã€‚ç›´æ¥å¯¹å…ƒç´ ä½ç½®ç‰¹å¾è¿›è¡Œå•å°ºåº¦å‡æ³•åªæ˜¯ä¸ºäº†å»ºç«‹å­¤ç«‹åƒç´ çº§åˆ«ä¸Šçš„å·®å¼‚å…³ç³»ï¼Œæ²¡æœ‰è€ƒè™‘ç—…ç¶å¯èƒ½å…·æœ‰åŒºåŸŸèšç±»çš„ç‰¹å¾ã€‚ä¸å¸¦æœ‰å•å°ºåº¦å‡æ³•å•å…ƒçš„MSNet MICCAIç‰ˆæœ¬[27]ç›¸æ¯”ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå¼ºå¤§çš„å±‚å†…å¤šå°ºåº¦å‡æ³•å•å…ƒï¼ˆMSUï¼‰ï¼Œå¹¶å°†MSNetæ”¹è¿›ä¸ºM2SNetã€‚å¦‚å›¾3æ‰€ç¤ºï¼Œæˆ‘ä»¬åˆ©ç”¨å¤§å°ä¸º1Ã—1ã€3Ã—3å’Œ5Ã—5çš„å›ºå®šå…¨ä¸€æƒé‡çš„å¤šå°ºåº¦å·ç§¯æ»¤æ³¢å™¨æ ¹æ®åƒç´ -åƒç´ å’ŒåŒºåŸŸåŒºåŸŸæ¨¡å¼è®¡ç®—ç»†èŠ‚å’Œç»“æ„å·®å¼‚å€¼ã€‚ä½¿ç”¨å…·æœ‰å›ºå®šå‚æ•°çš„å¤šå°ºåº¦æ»¤æ³¢å™¨ä¸ä»…å¯ä»¥ç›´æ¥æ•è·åŒ¹é…ç©ºé—´ä½ç½®å¤„çš„åˆå§‹ç‰¹å¾å¯¹ä¹‹é—´çš„å¤šå°ºåº¦å·®å¼‚çº¿ç´¢ï¼Œè€Œä¸”å¯ä»¥åœ¨ä¸å¼•å…¥é¢å¤–å‚æ•°è´Ÿæ‹…çš„æƒ…å†µä¸‹å®ç°é«˜æ•ˆè®­ç»ƒã€‚å› æ­¤ï¼ŒM2SNetå¯ä»¥ä¿æŒä¸MSNetç›¸åŒçš„ä½è®¡ç®—é‡ï¼Œå¹¶è·å¾—æ›´é«˜ç²¾åº¦çš„æ€§èƒ½ã€‚æ•´ä¸ªå¤šå°ºåº¦å‡æ³•è¿‡ç¨‹å¯ä»¥è¡¨è¿°ä¸ºï¼š\nå…¶ä¸­ Filter(Â·) nÃ—n è¡¨ç¤ºå¤§å°ä¸º n Ã— n çš„å®Œæ•´æ»¤æ³¢å™¨ï¼ˆå·ç§¯ï¼‰ã€‚ MSUå¯ä»¥æ•è·FAå’ŒFBçš„äº’è¡¥ä¿¡æ¯ï¼Œå¹¶çªå‡ºå®ƒä»¬ä»çº¹ç†åˆ°ç»“æ„çš„å·®å¼‚ï¼Œä»è€Œä¸ºè§£ç å™¨æä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚\nä¸ºäº†è·å¾—è·¨å¤šä¸ªç‰¹å¾çº§åˆ«çš„é«˜é˜¶äº’è¡¥ä¿¡æ¯ï¼Œæˆ‘ä»¬æ°´å¹³å’Œå‚ç›´è¿æ¥å¤šä¸ªMSUæ¥è®¡ç®—ä¸€ç³»åˆ—å…·æœ‰ä¸åŒé˜¶æ•°å’Œæ„Ÿå—é‡çš„å·®åˆ†ç‰¹å¾ã€‚å¤šå°ºåº¦å‡æ³•æ¨¡å—ä¸­å¤šå°ºåº¦çš„ç»†èŠ‚å¯ä»¥åœ¨å›¾2ä¸­æ‰¾åˆ°ã€‚æˆ‘ä»¬èšåˆäº†ç›¸åº”çº§åˆ«å’Œä»»æ„çº§åˆ«ä¹‹é—´çš„ç‰¹å®šå°ºåº¦ç‰¹å¾ï¼ˆMSi 1 ï¼‰å’Œè·¨å°ºåº¦å·®åˆ†ç‰¹å¾ï¼ˆMSi n6=1ï¼‰ã€‚å…¶ä»–çº§åˆ«ç”Ÿæˆäº’è¡¥å¢å¼ºç‰¹å¾ï¼ˆCEiï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¡¨è¿°å¦‚ä¸‹ï¼š\næœ€åï¼Œæ‰€æœ‰CEiå‚ä¸è§£ç ï¼Œç„¶åå¯¹æ¯è‚‰åŒºåŸŸè¿›è¡Œåˆ†å‰²ã€‚\nè¿™é‡Œå°±æ˜¯ä»‹ç»ä¸€ä¸‹MSU\nLossNet åœ¨æ‰€æå‡ºçš„æ¨¡å‹ä¸­ï¼Œæ€»è®­ç»ƒæŸå¤±å¯ä»¥å†™ä¸ºï¼š\nå…¶ä¸­L w IoUå’ŒL w BCEè¡¨ç¤ºåŠ æƒIoUæŸå¤±å’ŒäºŒå…ƒäº¤å‰ç†µï¼ˆBCEï¼‰æŸå¤±ï¼Œå®ƒä»¬å·²åœ¨åˆ†å‰²ä»»åŠ¡ä¸­å¹¿æ³›é‡‡ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸[4]ã€[44]ã€[45]ä¸­ç›¸åŒçš„å®šä¹‰ï¼Œå®ƒä»¬çš„æœ‰æ•ˆæ€§å·²åœ¨è¿™äº›å·¥ä½œä¸­å¾—åˆ°éªŒè¯ã€‚ä¸å®ƒä»¬ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬é¢å¤–ä½¿ç”¨LossNetæ¥è¿›ä¸€æ­¥ä¼˜åŒ–ä»ç»†èŠ‚åˆ°ç»“æ„çš„åˆ†å‰²ã€‚\nå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ ImageNet é¢„è®­ç»ƒåˆ†ç±»ç½‘ç»œï¼Œä¾‹å¦‚ VGG-16ï¼Œåˆ†åˆ«æå–é¢„æµ‹å’Œåœ°é¢å®å†µçš„å¤šå°ºåº¦ç‰¹å¾ã€‚ç„¶åï¼Œå®ƒä»¬çš„ç‰¹å¾å·®å¼‚è®¡ç®—ä¸ºæŸå¤± Lf ï¼š\nä»¤ F i P å’Œ F i G åˆ†åˆ«è¡¨ç¤ºä»é¢„æµ‹å’Œåœ°é¢å®å†µä¸­æå–çš„ç¬¬ i å±‚ç‰¹å¾å›¾ã€‚ l i f è®¡ç®—ä¸ºå…¶æ¬§å‡ é‡Œå¾·è·ç¦»ï¼ˆL2-Lossï¼‰ï¼Œè¯¥è·ç¦»åœ¨åƒç´ çº§åˆ«è¿›è¡Œç›‘ç£ï¼š\nä»å›¾4ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½å±‚ç‰¹å¾å›¾åŒ…å«ä¸°å¯Œçš„è¾¹ç•Œä¿¡æ¯ï¼Œé«˜å±‚ç‰¹å¾å›¾æè¿°ä½ç½®ä¿¡æ¯ã€‚å› æ­¤ï¼ŒLossNetå¯ä»¥åœ¨ç‰¹å¾å±‚é¢äº§ç”Ÿå…¨é¢çš„ç›‘ç£ã€‚\n","permalink":"https://swimmingliu.cn/posts/papernotes/2023-m2snet/","summary":"\u003ch1 id=\"2023-m2snet-æ–°é¢–å¤šå°ºåº¦æ¨¡å—--æ™ºèƒ½æŸå¤±å‡½æ•°--é€šç”¨å›¾åƒåˆ†å‰²sotaç½‘ç»œ\"\u003e(2023) M2SNet: æ–°é¢–å¤šå°ºåº¦æ¨¡å— + æ™ºèƒ½æŸå¤±å‡½æ•° = é€šç”¨å›¾åƒåˆ†å‰²SOTAç½‘ç»œ\u003c/h1\u003e\n\u003ch2 id=\"abstract\"\u003eAbstract\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå‡†ç¡®çš„åŒ»å­¦å›¾åƒåˆ†å‰²å¯¹äºæ—©æœŸåŒ»å­¦è¯Šæ–­è‡³å…³é‡è¦ã€‚å¤§å¤šæ•°ç°æœ‰æ–¹æ³•åŸºäºUå½¢ç»“æ„ï¼Œå¹¶ä½¿ç”¨\u003cstrong\u003eé€å…ƒç´ åŠ æ³•æˆ–ä¸²è”åœ¨è§£ç å™¨ä¸­é€æ­¥èåˆä¸åŒçº§åˆ«çš„ç‰¹å¾\u003c/strong\u003eã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ“ä½œéƒ½\u003cstrong\u003eå®¹æ˜“äº§ç”Ÿå¤§é‡å†—ä½™ä¿¡æ¯\u003c/strong\u003eï¼Œä»è€Œ\u003cstrong\u003eå‰Šå¼±ä¸åŒçº§åˆ«ç‰¹å¾ä¹‹é—´çš„äº’è¡¥æ€§\u003c/strong\u003eï¼Œå¯¼è‡´\u003cstrong\u003eç—…ç¶å®šä½ä¸å‡†ç¡®å’Œè¾¹ç¼˜æ¨¡ç³Š\u003c/strong\u003eã€‚ä¸ºäº†åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§é€šç”¨çš„å¤šå°ºåº¦å‡æ³•ç½‘ç»œï¼ˆM2SNetï¼‰æ¥å®ŒæˆåŒ»å­¦å›¾åƒçš„å¤šæ ·åŒ–åˆ†å‰²ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬é¦–å…ˆè®¾è®¡ä¸€ä¸ªåŸºæœ¬\u003cstrong\u003eå‡æ³•å•å…ƒï¼ˆSUï¼‰\u003cstrong\u003eæ¥äº§ç”Ÿç¼–ç å™¨ä¸­ç›¸é‚»çº§åˆ«ä¹‹é—´çš„å·®å¼‚ç‰¹å¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å•å°ºåº¦ SU æ‰©å±•åˆ°å±‚å†…å¤šå°ºåº¦ SUï¼Œå®ƒå¯ä»¥ä¸ºè§£ç å™¨\u003c/strong\u003eæä¾›åƒç´ çº§å’Œç»“æ„çº§å·®å¼‚ä¿¡æ¯\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åï¼Œæˆ‘ä»¬é‡‘å­—å¡”å¼åœ°ä¸ºä¸åŒå±‚æ¬¡çš„å¤šå°ºåº¦SUé…å¤‡ä¸åŒçš„æ„Ÿå—é‡ï¼Œä»è€Œå®ç°å±‚é—´å¤šå°ºåº¦ç‰¹å¾èšåˆå¹¶è·å¾—ä¸°å¯Œçš„å¤šå°ºåº¦å·®å¼‚ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå…è®­ç»ƒç½‘ç»œâ€œLossNetâ€æ¥å…¨é¢ç›‘ç£ä»åº•å±‚åˆ°é¡¶å±‚çš„ä»»åŠ¡æ„ŸçŸ¥ç‰¹å¾ï¼Œè¿™é©±åŠ¨æˆ‘ä»¬çš„å¤šå°ºåº¦å‡æ³•ç½‘ç»œåŒæ—¶æ•è·ç»†èŠ‚å’Œç»“æ„çº¿ç´¢ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡æœ‰èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ä¸åŒçš„è¯„ä¼°æŒ‡æ ‡ä¸‹ï¼Œåœ¨ä¸åŒå›¾åƒæ¨¡æ€çš„å››ç§ä¸åŒåŒ»å­¦å›¾åƒåˆ†å‰²ä»»åŠ¡çš„ 11 ä¸ªæ•°æ®é›†ä¸Šè¡¨ç°ä¼˜äºå¤§å¤šæ•°æœ€å…ˆè¿›çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å½©è‰²ç»“è‚ é•œæˆåƒã€è¶…å£°æˆåƒã€è®¡ç®—æœºæ–­å±‚æ‰«æ (CT) ï¼‰å’Œå…‰å­¦ç›¸å¹²æ–­å±‚æ‰«æï¼ˆOCTï¼‰ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸¤ä¸ªä¸»è¦åˆ›æ–°ç‚¹ï¼šå¤šå°ºåº¦é‡‘å­—å¡”å‡æ³•å•å…ƒ ï¼ˆç¡®å®ç‰›é€¼ï¼‰+ LossNetï¼ˆä¸ºäº†åˆ›æ–°è€Œåˆ›æ–°çš„æŸå¤±å‡½æ•°ï¼‰\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä½œä¸ºè®¡ç®—æœºè¾…åŠ©è¯Šæ–­ç³»ç»Ÿä¸­çš„é‡è¦ä½œç”¨ï¼Œç²¾ç¡®çš„åŒ»å­¦å›¾åƒåˆ†å‰²æŠ€æœ¯å¯ä»¥ä¸ºåŒ»ç”Ÿåšå‡ºä¸´åºŠå†³ç­–æä¾›é‡è¦æŒ‡å¯¼ã€‚ç²¾ç¡®åˆ†å‰²å­˜åœ¨ä¸‰ä¸ªæ™®éçš„æŒ‘æˆ˜ï¼šé¦–å…ˆï¼ŒUå½¢ç»“æ„[1]ã€[2]ç”±äºå…¶åˆ©ç”¨å¤šçº§ä¿¡æ¯é‡å»ºé«˜åˆ†è¾¨ç‡ç‰¹å¾å›¾çš„èƒ½åŠ›è€Œå—åˆ°äº†ç›¸å½“å¤šçš„å…³æ³¨ã€‚åœ¨UNet [2]ä¸­ï¼Œä¸Šé‡‡æ ·çš„ç‰¹å¾å›¾ä¸ä»ç¼–ç å™¨è·³è¿‡çš„ç‰¹å¾å›¾è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶åœ¨ä¸Šé‡‡æ ·æ­¥éª¤ä¹‹é—´æ·»åŠ å·ç§¯å’Œéçº¿æ€§ï¼Œå¦‚å›¾1ï¼ˆaï¼‰æ‰€ç¤ºã€‚åç»­åŸºäºUNetçš„æ–¹æ³•é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶[3]ã€[4]ã€é—¨æœºåˆ¶[5]ã€[6]ã€å˜å‹å™¨æŠ€æœ¯[7]ã€[8]è®¾è®¡ä¸åŒçš„ç‰¹å¾å¢å¼ºæ¨¡å—ï¼Œå¦‚å›¾1ï¼ˆbï¼‰æ‰€ç¤ºã€‚ UNet++[9]ä½¿ç”¨åµŒå¥—å’Œå¯†é›†çš„è·³è·ƒè¿æ¥æ¥å‡å°‘ç¼–ç å™¨å’Œè§£ç å™¨çš„ç‰¹å¾å›¾ä¹‹é—´çš„è¯­ä¹‰å·®è·ï¼Œå¦‚å›¾1ï¼ˆcï¼‰æ‰€ç¤ºã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eå…ˆè¯´åŒ»å­¦åˆ†å‰²åœ¨åŒ»å­¦é¢†åŸŸé‡è¦\u0026hellip;(balabala)  ç„¶åå½“å‰é¢†åŸŸå­˜åœ¨xxxæŒ‘æˆ˜\u0026hellip;(balabala)\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œæ˜¯ä»¥åŒ»å­¦å›¾åƒåˆ†å‰²æŒ‘æˆ˜çš„è§†è§’ï¼Œä»‹ç»UNetå‘å±•çš„æƒ…å†µã€‚ç„¶ååœ¨æè¿°ä¸åŒUNetå˜ä½“å‘å±•è¿‡ç¨‹ä¸­è§£å†³çš„ä¸åŒé—®é¢˜ï¼ˆæ„Ÿè§‰å¯ä»¥å€Ÿé‰´ï¼‰\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸€èˆ¬æ¥è¯´ï¼Œç¼–ç å™¨ä¸­ä¸åŒçº§åˆ«çš„ç‰¹å¾æœ‰ä¸åŒçš„ç‰¹å¾ã€‚\u003cstrong\u003eé«˜çº§åˆ«å…·æœ‰æ›´å¤šçš„è¯­ä¹‰ä¿¡æ¯\u003c/strong\u003eï¼Œæœ‰åŠ©äºå®šä½å¯¹è±¡ï¼Œè€Œä½çº§åˆ«å…·æœ‰\u003cstrong\u003eæ›´è¯¦ç»†çš„ä¿¡æ¯\u003c/strong\u003eï¼Œå¯ä»¥æ•æ‰å¯¹è±¡çš„\u003cstrong\u003eå¾®å¦™è¾¹ç•Œ\u003c/strong\u003eã€‚è§£ç å™¨åˆ©ç”¨ç‰¹å®šçº§åˆ«å’Œè·¨çº§åˆ«ç‰¹å¾æ¥ç”Ÿæˆæœ€ç»ˆçš„\u003cstrong\u003eé«˜åˆ†è¾¨ç‡é¢„æµ‹\u003c/strong\u003eã€‚ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•\u003cstrong\u003eç›´æ¥ä½¿ç”¨é€å…ƒç´ åŠ æ³•æˆ–ä¸²è”æ¥èåˆæ¥è‡ªç¼–ç å™¨çš„ä»»æ„ä¸¤çº§ç‰¹å¾\u003c/strong\u003eå¹¶å°†å®ƒä»¬ä¼ è¾“åˆ°è§£ç å™¨ã€‚è¿™äº›ç®€å•çš„æ“ä½œå¹¶æ²¡æœ‰æ›´å¤šåœ°å…³æ³¨\u003cstrong\u003eä¸åŒå±‚æ¬¡ä¹‹é—´çš„å·®å¼‚ä¿¡æ¯ã€‚\u003cstrong\u003eè¿™ä¸€ç¼ºç‚¹ä¸ä»…ä¼šäº§ç”Ÿ\u003c/strong\u003eå†—ä½™ä¿¡æ¯æ¥ç¨€é‡ŠçœŸæ­£æœ‰ç”¨çš„ç‰¹å¾\u003c/strong\u003eï¼Œè¿˜ä¼š\u003cstrong\u003eå‰Šå¼±ç‰¹å®šäºçº§åˆ«çš„ç‰¹å¾çš„ç‰¹æ€§\u003c/strong\u003eï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ— æ³•å¹³è¡¡ç²¾ç¡®å®šä½å’Œå¾®å¦™çš„è¾¹ç•Œç»†åŒ–ã€‚å…¶æ¬¡ï¼Œç”±äº\u003cstrong\u003eæ„Ÿå—é‡æœ‰é™\u003c/strong\u003eï¼Œå•å°ºåº¦å·ç§¯æ ¸å¾ˆéš¾æ•è·å¤§å°å˜åŒ–ç‰©ä½“çš„\u003cstrong\u003eä¸Šä¸‹æ–‡ä¿¡æ¯\u003c/strong\u003eã€‚ä¸€äº›æ–¹æ³•[1]ã€[2]ã€[9]-[11]ä¾èµ–äºå±‚é—´å¤šå°ºåº¦ç‰¹å¾ï¼Œå¹¶é€æ­¥æ•´åˆæ¥è‡ªä¸åŒå°ºåº¦è¡¨ç¤ºçš„\u003cstrong\u003eè¯­ä¹‰ä¸Šä¸‹æ–‡å’Œçº¹ç†ç»†èŠ‚\u003c/strong\u003eã€‚å…¶ä»–äºº[6]ã€[12]-[15]ä¸“æ³¨äºåŸºäºç½‘ç»œä¸­çš„ç©ºæ´ç©ºé—´é‡‘å­—å¡”æ± åŒ–æ¨¡å—[16]ï¼ˆASPPï¼‰æˆ–DenseASPP [17]æå–\u003cstrong\u003eå±‚å†…å¤šå°ºåº¦ä¿¡æ¯\u003c/strong\u003eã€‚ç„¶è€Œï¼Œç±»ä¼¼ASPPçš„å¤šå°ºåº¦å·ç§¯æ¨¡å—ä¼šäº§ç”Ÿ\u003cstrong\u003eè®¸å¤šé¢å¤–çš„å‚æ•°å’Œè®¡ç®—\u003c/strong\u003eã€‚è®¸å¤šæ–¹æ³•[5]ã€[18]-[21]é€šå¸¸å°†å¤šä¸ªASPPæ¨¡å—å®‰è£…åˆ°ä¸åŒçº§åˆ«çš„ç¼–ç å™¨/è§£ç å™¨å—ä¸­ï¼Œè€Œæœ‰äº›æ–¹æ³•[13]ã€[14]ã€[22]ã€[23]å°†å…¶å®‰è£…åœ¨ä¸åŒçº§åˆ«çš„ç¼–ç å™¨/è§£ç å™¨å—ä¸­ã€‚æœ€é«˜çº§åˆ«çš„ç¼–ç å™¨å—ã€‚ç¬¬ä¸‰ï¼ŒæŸå¤±å‡½æ•°çš„å½¢å¼ç›´æ¥ä¸ºç½‘ç»œçš„æ¢¯åº¦ä¼˜åŒ–æä¾›äº†æ–¹å‘ã€‚åœ¨åˆ†å‰²é¢†åŸŸï¼Œæå‡ºäº†è®¸å¤šæŸå¤±å‡½æ•°æ¥ç›‘ç£ä¸åŒçº§åˆ«çš„é¢„æµ‹ï¼Œä¾‹å¦‚åƒç´ çº§åˆ«çš„L1æŸå¤±ã€äº¤å‰ç†µæŸå¤±å’ŒåŠ æƒäº¤å‰ç†µæŸå¤±[24]ï¼ŒSSIM[25]æŸå¤±åŒºåŸŸå±‚é¢çš„ä¸ç¡®å®šæ€§æŸå¤±[26]ï¼Œå…¨å±€å±‚é¢çš„IoUæŸå¤±ã€DiceæŸå¤±å’Œä¸€è‡´æ€§å¢å¼ºæŸå¤±[11]ã€‚å°½ç®¡è¿™äº›åŸºæœ¬æŸå¤±å‡½æ•°åŠå…¶å˜ä½“å…·æœ‰ä¸åŒçš„ä¼˜åŒ–ç‰¹æ€§ï¼Œä½†å¤æ‚çš„æ‰‹åŠ¨æ•°å­¦å½¢å¼çš„è®¾è®¡å¯¹äºè®¸å¤šç ”ç©¶æ¥è¯´ç¡®å®éå¸¸è€—æ—¶ã€‚ä¸ºäº†è·å¾—ç»¼åˆæ€§èƒ½ï¼Œæ¨¡å‹é€šå¸¸ä¼šé›†æˆå¤šç§æŸå¤±å‡½æ•°ï¼Œè¿™å¯¹ç ”ç©¶äººå‘˜çš„è®­ç»ƒæŠ€èƒ½æå‡ºäº†å¾ˆé«˜çš„è¦æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºæœ‰å¿…è¦å¼•å…¥ä¸€ç§æ— éœ€å¤æ‚äººå·¥è®¾è®¡çš„æ™ºèƒ½æŸå¤±å‡½æ•°æ¥å…¨é¢ç›‘ç£åˆ†å‰²é¢„æµ‹ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”¨äºä¸€èˆ¬åŒ»å­¦å›¾åƒåˆ†å‰²çš„æ–°å‹å¤šå°ºåº¦å‡æ³•ç½‘ç»œï¼ˆM2SNetï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå‡æ³•å•å…ƒï¼ˆSUï¼‰å¹¶å°†å…¶åº”ç”¨äº\u003cstrong\u003eæ¯å¯¹ç›¸é‚»çš„çº§åˆ«ç‰¹å¾\u003c/strong\u003eã€‚ SUçªå‡ºäº†\u003cstrong\u003eç‰¹å¾ä¹‹é—´æœ‰ç”¨çš„å·®å¼‚ä¿¡æ¯ï¼Œå¹¶æ¶ˆé™¤äº†å†—ä½™éƒ¨åˆ†çš„å¹²æ‰°\u003c/strong\u003eã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å€ŸåŠ©æ‰€æå‡ºçš„\u003cstrong\u003eå¤šå°ºåº¦å‡æ³•æ¨¡å—\u003c/strong\u003eæ”¶é›†\u003cstrong\u003eæç«¯å¤šå°ºåº¦ä¿¡æ¯\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äºå±‚é—´å¤šå°ºåº¦ä¿¡æ¯ï¼Œæˆ‘ä»¬ä»¥é‡‘å­—å¡”æ–¹å¼è¿æ¥å¤šä¸ªå‡æ³•å•å…ƒæ¥æ•è·å¤§è·¨åº¦çš„è·¨å±‚ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬\u003cstrong\u003eèšåˆç‰¹å®šäºçº§åˆ«çš„ç‰¹å¾\u003c/strong\u003eå’Œ\u003cstrong\u003eå¤šè·¯å¾„è·¨çº§åˆ«å·®åˆ†ç‰¹å¾\u003c/strong\u003eï¼Œç„¶ååœ¨è§£ç å™¨ä¸­ç”Ÿæˆæœ€ç»ˆé¢„æµ‹ã€‚å¯¹äºå±‚å†…å¤šå°ºåº¦ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ç»„ä¸åŒå†…æ ¸å¤§å°çš„full oneæ»¤æ³¢å™¨å°†å•å°ºåº¦å‡æ³•å•å…ƒ\u003cstrong\u003eæ”¹è¿›ä¸ºå¤šå°ºåº¦å‡æ³•å•å…ƒï¼Œå¯ä»¥è‡ªç„¶åœ°å®ç°å¤šå°ºåº¦å‡æ³•èšåˆï¼Œè€Œæ— éœ€å¼•å…¥é¢å¤–çš„å‚æ•°\u003c/strong\u003eã€‚å¦‚å›¾1æ‰€ç¤ºï¼ŒMSNeté…å¤‡äº†å±‚é—´å¤šå°ºåº¦å‡æ³•æ¨¡å—ï¼ŒM2SNetåŒæ—¶å…·æœ‰å±‚é—´å’Œå±‚å†…å¤šå°ºåº¦å‡æ³•ç»“æ„ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªLossNetæ¥è‡ªåŠ¨ç›‘ç£ä»åº•å±‚åˆ°é¡¶å±‚æå–çš„ç‰¹å¾å›¾ï¼Œå®ƒå¯ä»¥é€šè¿‡ç®€å•çš„L2æŸå¤±å‡½æ•°ä¼˜åŒ–ä»ç»†èŠ‚åˆ°ç»“æ„çš„åˆ†å‰²ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eå¤šå°ºåº¦å‡æ³•å•å…ƒå¯ä»¥å»ç‰¹å¾ä¹‹é—´çš„å·®å¼‚ä¿¡æ¯ï¼Œæ¶ˆé™¤å†—ä½™å¹²æ‰°ã€‚\u003c/p\u003e\n\u003cp\u003eï¼ˆä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨è¿™ç§åŠæ³•æ›¿æ¢æ³¨æ„åŠ›æœºåˆ¶ï¼‰\u003c/p\u003e\n\u003ch2 id=\"related-work\"\u003eRELATED WORK\u003c/h2\u003e\n\u003ch3 id=\"medical-image-segmentation-network\"\u003eMedical Image Segmentation Network\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ ¹æ®ä¸åŒå™¨å®˜æˆ–ç—…å˜çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°†ç°æœ‰çš„åŒ»å­¦å›¾åƒåˆ†å‰²æ–¹æ³•åˆ†ä¸ºä¸¤ç±»ï¼šåŒ»å­¦é€šç”¨çš„å’ŒåŒ»å­¦ä¸“ç”¨çš„ã€‚éšç€U-Net[2]åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²é¢†åŸŸå–å¾—ç¨³å®šçš„æ€§èƒ½ï¼Œå¸¦æœ‰ç¼–ç å™¨-è§£ç å™¨çš„Uå½¢ç»“æ„å·²æˆä¸ºåŸºæœ¬çš„åˆ†å‰²åŸºçº¿ã€‚ U-Net++[9]é›†æˆäº†\u003cstrong\u003eé•¿è¿æ¥å’ŒçŸ­è¿æ¥\u003c/strong\u003eï¼Œå¯ä»¥å‡å°‘ç¼–ç å™¨å’Œè§£ç å™¨å­ç½‘ç»œçš„ç‰¹å¾å›¾ä¹‹é—´çš„è¯­ä¹‰å·®è·ã€‚å¯¹äºæ³¨æ„åŠ› U-Net [28]ï¼Œ\u003cstrong\u003eæ³¨æ„åŠ›é—¨\u003c/strong\u003eåµŒå…¥åœ¨ç¼–ç å™¨å’Œè§£ç å™¨å—ä¹‹é—´çš„æ¯ä¸ªè¿‡æ¸¡å±‚ä¸­ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å­¦ä¹ å…³æ³¨ä¸\u003cstrong\u003eåŒå½¢çŠ¶å’Œå¤§å°çš„ç›®æ ‡ç»“æ„\u003c/strong\u003eã€‚æœ€è¿‘ï¼ŒTransformer [29]æ¶æ„åœ¨è®¸å¤šè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­å–å¾—äº†æˆåŠŸã€‚ä¸€äº›ä½œå“[7]ã€[8]æ¢è®¨äº†å…¶å¯¹åŒ»å­¦è§†è§‰ä»»åŠ¡çš„æœ‰æ•ˆæ€§ã€‚ UTNet [7] æ˜¯ä¸€ç§ç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„æ··åˆå˜å‹å™¨æ¶æ„ï¼Œå®ƒåœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¸­åº”ç”¨è‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œä»¥æœ€å°çš„å¼€é”€æ•è·ä¸åŒè§„æ¨¡çš„è¿œç¨‹ä¾èµ–å…³ç³»ã€‚å¦ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„åŸºäº Transformer çš„æ¨¡å‹æ˜¯ TransUNet [8]ï¼Œå®ƒé€šè¿‡å°†å›¾åƒç‰¹å¾è§†ä¸ºåºåˆ—æ¥ç¼–ç å¼ºå…¨å±€ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡ U å½¢æ··åˆæ¶æ„è®¾è®¡åˆ©ç”¨ä½çº§ CNN ç‰¹å¾ã€‚\u003c/p\u003e\n\u003cp\u003eåŒ»å­¦ç‰¹å®šæ–¹æ³•ã€‚åœ¨æ¯è‚‰åˆ†å‰²ä»»åŠ¡ä¸­ï¼ŒSFA [30]å’ŒPraNet [4]ä¸“æ³¨äºæ¢å¤æ¯è‚‰ä¸å…¶å‘¨å›´ç²˜è†œä¹‹é—´çš„æ¸…æ™°è¾¹ç•Œã€‚å‰è€…æå‡ºäº†å…±äº«ç¼–ç å™¨å’Œä¸¤ä¸ªç›¸äº’çº¦æŸçš„è§£ç å™¨ä¸‹çš„é€‰æ‹©æ€§ç‰¹å¾èšåˆç»“æ„å’Œè¾¹ç•Œæ•æ„ŸæŸå¤±å‡½æ•°ã€‚åè€…åˆ©ç”¨åå‘æ³¨æ„æ¨¡å—æ¥å»ºç«‹åŒºåŸŸå’Œè¾¹ç•Œçº¿ç´¢ä¹‹é—´çš„å…³ç³»ã€‚æ­¤å¤–ï¼ŒJiç­‰äºº[31]åˆ©ç”¨æ—¶ç©ºä¿¡æ¯æ„å»ºè§†é¢‘æ¯è‚‰åˆ†å‰²æ¨¡å‹ã€‚åœ¨COVID-19è‚ºéƒ¨æ„ŸæŸ“ä»»åŠ¡ä¸­ï¼ŒPaluruç­‰äºº[32]æå‡ºäº†ä¸€ç§åŸºäºå˜å½¢æ·±åº¦åµŒå…¥çš„è½»é‡çº§CNNæ¥åˆ†å‰²COVID-19èƒ¸éƒ¨CTå›¾åƒä¸­çš„å¼‚å¸¸ã€‚ Inf-Net [33] æ„å»ºéšå¼åå‘æ³¨æ„åŠ›å’Œæ˜¾å¼è¾¹ç¼˜æ³¨æ„åŠ›æ¥å¯¹è¾¹ç•Œè¿›è¡Œå»ºæ¨¡ã€‚ BCS-Net [34]å…·æœ‰ä¸‰ä¸ªæ¸è¿›è¾¹ç•Œä¸Šä¸‹æ–‡è¯­ä¹‰é‡å»ºå—ï¼Œå¯ä»¥å¸®åŠ©è§£ç å™¨æ•è·è‚ºéƒ¨æ„ŸæŸ“çš„é›¶æ•£åŒºåŸŸã€‚åœ¨ä¹³è…ºåˆ†å‰²ä»»åŠ¡ä¸­ï¼ŒByraç­‰äºº[35]é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å¼€å‘äº†é€‰æ‹©æ€§æ ¸æ¥è°ƒæ•´U-Netçš„æ„Ÿå—é‡ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜ä¹³è…ºè‚¿ç˜¤çš„åˆ†å‰²ç²¾åº¦ã€‚ Chen ç­‰äºº [36] æå‡ºäº†ä¸€ç§åµŒå¥— U ç½‘ï¼Œé€šè¿‡åˆ©ç”¨ä¸åŒçš„æ·±åº¦å’Œå…±äº«æƒé‡æ¥å®ç°ä¹³è…ºè‚¿ç˜¤çš„ç¨³å¥è¡¨ç¤ºã€‚\u003c/p\u003e","title":"M2SNet: Multi-scale in Multi-scale Subtraction Network for Medical Image Segmentation"},{"content":"EGE-UNet: an Efficient Group Enhanced UNet for skin lesion segmentation 1. Abstract ç›®å‰çš„åŒ»å­¦å›¾åƒåˆ†å‰²æ¨¡å‹å¤§å¤šæ˜¯ Transformer + Unetï¼Œè¿™äº›æ¨¡å‹çš„å¤§é‡å‚æ•°å’Œè®¡ç®—è´Ÿè½½ä½¿å¾—å®ƒä»¬ä¸é€‚åˆç§»åŠ¨å¥åº·åº”ç”¨ã€‚\nä½œè€…æå‡ºçš„EGE-UNet æ¨¡å‹è½»é‡ã€é«˜æ•ˆã€‚ï¼ˆä¸ TransFuse ç›¸æ¯”ï¼Œå‚æ•°å’Œè®¡ç®—æˆæœ¬åˆ†åˆ«é™ä½äº† 494 å€å’Œ 160 å€ï¼Œæ¨¡å‹å‚æ•°é‡åªæœ‰50KBï¼‰\nåˆ›æ–°ç‚¹ï¼šç»„å¤šè½´å“ˆè¾¾ç›äº§å“æ³¨æ„åŠ›æ¨¡å—ï¼ˆGHPAï¼‰å’Œç»„èšåˆæ¡¥æ¨¡å—ï¼ˆGABï¼‰ã€‚\n1.GHPA å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œåˆ†ç»„ï¼Œå¹¶åœ¨ä¸åŒè½´ä¸Šæ‰§è¡Œå“ˆè¾¾ç›äº§å“æ³¨æ„åŠ›æœºåˆ¶ï¼ˆHPAï¼‰ï¼Œä»¥ä»ä¸åŒè§’åº¦æå–ç—…ç†ä¿¡æ¯ã€‚\n2.GAB é€šè¿‡å¯¹ä½çº§ç‰¹å¾ã€é«˜çº§ç‰¹å¾ä»¥åŠè§£ç å™¨åœ¨æ¯ä¸ªé˜¶æ®µç”Ÿæˆçš„æ©ç è¿›è¡Œåˆ†ç»„ï¼Œæœ‰æ•ˆåœ°èåˆäº†å¤šå°ºåº¦ä¿¡æ¯ã€‚\n2. Introduction èƒŒæ™¯: æ¶æ€§é»‘è‰²ç´ ç˜¤æ˜¯ä¸–ç•Œä¸Šå¢é•¿æœ€å¿«çš„ç™Œç—‡ä¹‹ä¸€ã€‚æ®ç¾å›½ç™Œç—‡åä¼šä¼°è®¡ï¼Œ2020 å¹´çº¦æœ‰ 100,350 ä¾‹æ–°å‘ç—…ä¾‹ï¼Œè¶…è¿‡ 6,500 ä¾‹æ­»äº¡ã€‚å› æ­¤ï¼Œè‡ªåŠ¨åŒ–çš®è‚¤ç—…å˜åˆ†å‰²ç³»ç»ŸåŠ¿åœ¨å¿…è¡Œï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©åŒ»ç–—ä¸“ä¸šäººå‘˜å¿«é€Ÿè¯†åˆ«ç—…å˜åŒºåŸŸå¹¶ä¿ƒè¿›åç»­æ²»ç–—è¿‡ç¨‹ã€‚\nç›¸åŒæ–¹å¼å¯å¼•å…¥è„‘ç˜¤ã€è‚ºç™Œã€‚\nä¸ºäº†æé«˜åˆ†å‰²æ€§èƒ½ï¼Œæœ€è¿‘çš„ç ”ç©¶å€¾å‘äºé‡‡ç”¨å…·æœ‰æ›´å¤§å‚æ•°å’Œè®¡ç®—å¤æ‚åº¦çš„æ¨¡å—ï¼Œä¾‹å¦‚ç»“åˆè§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶[7]ã€‚ä¾‹å¦‚ï¼ŒSwin-UNet [4]ï¼ŒåŸºäºSwin Transformer [11]ï¼Œåˆ©ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ç‰¹å¾æå–èƒ½åŠ›æ¥æé«˜åˆ†å‰²æ€§èƒ½ã€‚ TransUNet [5] å¼€åˆ›äº†ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„ CNN å’Œ ViT çš„ä¸²è¡Œèåˆã€‚ TransFuse [26]é‡‡ç”¨åŒè·¯å¾„ç»“æ„ï¼Œåˆ©ç”¨ CNN å’Œ ViT åˆ†åˆ«æ•è·å±€éƒ¨å’Œå…¨å±€ä¿¡æ¯ã€‚UTNetV2[8]åˆ©ç”¨æ··åˆåˆ†å±‚æ¶æ„ã€é«˜æ•ˆçš„åŒå‘æ³¨æ„åŠ›å’Œè¯­ä¹‰å›¾æ¥å®ç°å…¨å±€å¤šå°ºåº¦ç‰¹å¾èåˆï¼Œç»“åˆäº†CNNå’ŒViTçš„ä¼˜ç‚¹ã€‚ TransBTS [23] å°†è‡ªæ³¨æ„åŠ›å¼•å…¥è„‘è‚¿ç˜¤åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œå¹¶ç”¨å®ƒæ¥èšåˆé«˜çº§ä¿¡æ¯ã€‚\nAbstractæåˆ°å½“å‰åŒ»å­¦åˆ†å‰²æ¨¡å‹å¤§éƒ¨åˆ†æ˜¯Transformer + Unetï¼Œè¿™é‡Œåšå‡ºå…·ä½“é˜è¿°ã€‚\nå…ˆå‰çš„å·¥ä½œé€šè¿‡å¼•å…¥å¤æ‚çš„æ¨¡å—æ¥æé«˜æ€§èƒ½ï¼Œä½†å¿½ç•¥äº†å®é™…åŒ»ç–—ç¯å¢ƒä¸­è®¡ç®—èµ„æºçš„é™åˆ¶ã€‚å› æ­¤ï¼Œè¿«åˆ‡éœ€è¦ä¸ºç§»åŠ¨åŒ»ç–—ä¸­çš„åˆ†å‰²ä»»åŠ¡è®¾è®¡ä¸€ç§ä½å‚æ•°ã€ä½è®¡ç®—è´Ÿè½½çš„æ¨¡å‹ã€‚æœ€è¿‘ï¼ŒUNeXt [22] ç»“åˆäº† UNet [18] å’Œ MLP [21] å¼€å‘äº†ä¸€ç§è½»é‡çº§æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å¯ä»¥è·å¾—ä¼˜å¼‚çš„æ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘å‚æ•°å’Œè®¡ç®—é‡ã€‚æ­¤å¤–ï¼ŒMALUNet [19]é€šè¿‡å‡å°‘æ¨¡å‹é€šé“æ•°å¹¶å¼•å…¥å¤šä¸ªæ³¨æ„åŠ›æ¨¡å—æ¥å‡å°æ¨¡å‹å¤§å°ï¼Œä»è€Œæ¯” UNeXt å…·æœ‰æ›´å¥½çš„çš®è‚¤ç—…å˜åˆ†å‰²æ€§èƒ½ã€‚ç„¶è€Œï¼Œå°½ç®¡MALUNetå¤§å¤§å‡å°‘äº†å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ï¼Œä½†å…¶åˆ†å‰²æ€§èƒ½ä»ç„¶ä½äºä¸€äº›å¤§å‹æ¨¡å‹ï¼Œä¾‹å¦‚TransFuseã€‚å› æ­¤ï¼Œåœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº† EGE-UNetï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§çš®è‚¤ç—…å˜åˆ†å‰²æ¨¡å‹ï¼Œå¯å®ç°æœ€å…ˆè¿›çš„æ•ˆæœï¼ŒåŒæ—¶æ˜¾ç€é™ä½å‚æ•°å’Œè®¡ç®—æˆæœ¬ã€‚æ­¤å¤–ï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªå°†å‚æ•°å‡å°‘åˆ°å¤§çº¦ 50KB çš„å·¥ä½œã€‚\næå‡ºé—®é¢˜ï¼šåŒ»ç–—ç¯å¢ƒä¸­è®¡ç®—èµ„æºçš„é™åˆ¶ï¼Œå¤æ‚æ¨¡å—éš¾ä»¥è½åœ° \u0026mdash;\u0026gt; è§£å†³åŠæ³•ï¼šè½»é‡åŒ–æ¨¡å‹\nå½“å‰è½»é‡åŒ–å‘å±•å†ç¨‹ \u0026mdash;\u0026gt; è½»é‡åŒ–çš„æ¨¡å‹åˆ†å‰²æ•ˆæœä¸å¥½ \u0026mdash;\u0026gt; EGE-Unet è½»é‡+åˆ†å‰²èƒ½åŠ›å¼º\nå…·ä½“æ¥è¯´ï¼ŒEGE-UNet åˆ©ç”¨ä¸¤ä¸ªå…³é”®æ¨¡å—ï¼šç¾¤ç»„å¤šè½´ Hadamard äº§å“æ³¨æ„åŠ›æ¨¡å—ï¼ˆGHPAï¼‰å’Œç¾¤ç»„èšåˆæ¡¥æ¨¡å—ï¼ˆGABï¼‰ã€‚\nä¸€æ–¹é¢ï¼Œç”±äºå¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆMHSAï¼‰ï¼Œæœ€è¿‘åŸºäº ViT [7] çš„æ¨¡å‹å·²ç»æ˜¾ç¤ºå‡ºå‰æ™¯ã€‚ MHSAå°†è¾“å…¥åˆ’åˆ†ä¸ºå¤šä¸ªheadï¼Œå¹¶åœ¨æ¯ä¸ªheadä¸­è®¡ç®—self-attentionï¼Œè¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿä»ä¸åŒçš„è§’åº¦è·å–ä¿¡æ¯ï¼Œæ•´åˆä¸åŒçš„çŸ¥è¯†ï¼Œæé«˜æ€§èƒ½ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒMHSA çš„äºŒæ¬¡å¤æ‚åº¦æå¤§åœ°å¢åŠ äº†æ¨¡å‹çš„å¤§å°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†å…·æœ‰çº¿æ€§å¤æ‚åº¦çš„å“ˆè¾¾ç›äº§å“æ³¨æ„åŠ›æœºåˆ¶ï¼ˆHPAï¼‰ã€‚HPA é‡‡ç”¨å¯å­¦ä¹ çš„æƒé‡ï¼Œå¹¶ä½¿ç”¨è¾“å…¥æ‰§è¡Œå“ˆè¾¾ç›ä¹˜ç§¯è¿ç®—ä»¥è·å¾—è¾“å‡ºã€‚éšåï¼Œå—åˆ° MHSA ä¸­å¤šå¤´æ¨¡å¼çš„å¯å‘ï¼Œæˆ‘ä»¬æå‡ºäº† GHPAï¼Œå®ƒå°†è¾“å…¥åˆ†ä¸ºä¸åŒçš„ç»„ï¼Œå¹¶åœ¨æ¯ä¸ªç»„ä¸­æ‰§è¡Œ HPAã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¸åŒç»„çš„ä¸åŒè½´ä¸Šè¿›è¡ŒHPAï¼Œè¿™æœ‰åŠ©äºè¿›ä¸€æ­¥ä»ä¸åŒçš„è§’åº¦è·å–ä¿¡æ¯ã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¯¹äºGABï¼Œç”±äºåŒ»å­¦å›¾åƒä¸­åˆ†å‰²ç›®æ ‡çš„å¤§å°å’Œå½¢çŠ¶ä¸ä¸€è‡´ï¼Œå› æ­¤è·å¾—å¤šå°ºåº¦ä¿¡æ¯è‡³å…³é‡è¦[19]ã€‚å› æ­¤ï¼ŒGABåŸºäºç»„èšåˆèåˆä¸åŒå¤§å°çš„é«˜å±‚å’Œä½å±‚ç‰¹å¾ï¼Œå¹¶é¢å¤–å¼•å…¥æ©æ¨¡ä¿¡æ¯æ¥è¾…åŠ©ç‰¹å¾èåˆã€‚é€šè¿‡å°†ä¸Šè¿°ä¸¤ä¸ªæ¨¡å—ä¸UNetç›¸ç»“åˆï¼Œæˆ‘ä»¬æå‡ºäº†EGE-UNetï¼Œå®ƒä»¥æä½çš„å‚æ•°å’Œè®¡ç®—é‡å®ç°äº†å‡ºè‰²çš„åˆ†å‰²æ€§èƒ½ã€‚ä¸ä»¥å‰ä»…æ³¨é‡æé«˜æ€§èƒ½çš„æ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬çš„æ¨¡å‹è¿˜ä¼˜å…ˆè€ƒè™‘ç°å®ç¯å¢ƒä¸­çš„å¯ç”¨æ€§ã€‚å›¾ 1 æ˜¾ç¤ºäº† EGEUNet ä¸å…¶ä»–ç½‘ç»œçš„æ¸…æ™°æ¯”è¾ƒã€‚\nå…·ä½“ä»‹ç»ä¸ºä»€ä¹ˆå¼•å…¥ä¸¤ä¸ªåˆ›æ–°æ¨¡å—ï¼ˆGHPAã€GABï¼‰ã€ä»¥åŠæ¨¡å—æ˜¯åŸºäºä»€ä¹ˆè®ºæ–‡ã€‚ï¼ˆæ¨¡å—èƒŒæ™¯+åˆ›æ–°æ–¹æ³•ï¼‰\n(1)æå‡ºäº†GHPAå’ŒGABï¼Œå‰è€…æœ‰æ•ˆåœ°è·å–å’Œé›†æˆå¤šè§†è§’ä¿¡æ¯ï¼Œåè€…æ¥å—ä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼Œä»¥åŠç”¨äºé«˜æ•ˆå¤šå°ºåº¦ç‰¹å¾èåˆçš„è¾…åŠ©æ©æ¨¡ã€‚\n(2)æˆ‘ä»¬æå‡ºäº†EGEUNetï¼Œè¿™æ˜¯ä¸€ç§ä¸“ä¸ºçš®è‚¤ç—…å˜åˆ†å‰²è€Œè®¾è®¡çš„æå…¶è½»é‡çº§çš„æ¨¡å‹ã€‚\n(3) æˆ‘ä»¬è¿›è¡Œäº†å¹¿æ³›çš„å®éªŒï¼Œè¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•åœ¨ä»¥æ˜¾ç€é™ä½çš„èµ„æºéœ€æ±‚å®ç°æœ€å…ˆè¿›æ€§èƒ½æ–¹é¢çš„æœ‰æ•ˆæ€§ã€‚\nä¸»è¦è´¡çŒ®ï¼šï¼ˆ1ï¼‰å†™æ¨¡å—ä½œç”¨ ï¼ˆ2ï¼‰å†™æ•´ä½“ç½‘ç»œä¼˜åŠ¿ ï¼ˆ3ï¼‰å®éªŒæ•ˆæœ\n3. Method 3.1EGE-Unetç½‘ç»œç»“æ„ EGE-UNetç”±å¯¹ç§°ç¼–ç å™¨-è§£ç å™¨éƒ¨åˆ†ç»„æˆçš„ U å½¢æ¶æ„ä¹‹ä¸Šã€‚\nç¼–ç å™¨ç”±å…­çº§ç»„æˆï¼Œæ¯çº§é€šé“æ•°ä¸º{8,16,24,32,48,64}ã€‚è§£ç å™¨åŒç†\nå‰ä¸‰ä¸ªé˜¶æ®µé‡‡ç”¨å†…æ ¸å¤§å°ä¸º 3 çš„æ™®é€šå·ç§¯ï¼Œåä¸‰ä¸ªé˜¶æ®µåˆ©ç”¨æå‡ºçš„ GHPA ä»ä¸åŒçš„è§’åº¦æå–è¡¨ç¤ºä¿¡æ¯ã€‚\nä¸ UNet ä¸­çš„ç®€å•è·³è·ƒè¿æ¥ç›¸æ¯”ï¼ŒEGE-UNet åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¹‹é—´çš„æ¯ä¸ªé˜¶æ®µéƒ½é‡‡ç”¨äº† GABã€‚\nåˆ©ç”¨æ·±åº¦ç›‘ç£ç”Ÿæˆä¸åŒè§„æ¨¡çš„æ©æ¨¡é¢„æµ‹ï¼Œè¿™äº›é¢„æµ‹ç”¨äºæŸå¤±å‡½æ•°å¹¶ä½œä¸º GAB çš„è¾“å…¥ä¹‹ä¸€ã€‚\né€šè¿‡é›†æˆè¿™äº›é«˜çº§æ¨¡å—ï¼ŒEGE-UNet æ˜¾ç€å‡å°‘äº†å‚æ•°å’Œè®¡ç®—è´Ÿè½½ï¼ŒåŒæ—¶ä¸ä¹‹å‰çš„æ–¹æ³•ç›¸æ¯”å¢å¼ºäº†åˆ†å‰²æ€§èƒ½ã€‚\n3.2 GHPA (Group multi-axis Hadamard Product Attention module) ä¸ºäº†å…‹æœ MHSA å¸¦æ¥çš„äºŒæ¬¡å¤æ‚åº¦é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†å…·æœ‰çº¿æ€§å¤æ‚åº¦çš„ HPAã€‚ç»™å®šè¾“å…¥ x å’Œéšæœºåˆå§‹åŒ–çš„å¯å­¦ä¹ å¼ é‡ pï¼Œé¦–å…ˆä½¿ç”¨åŒçº¿æ€§æ’å€¼æ¥è°ƒæ•´ p çš„å¤§å°ä»¥åŒ¹é… x çš„å¤§å°ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ p ä¸Šé‡‡ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼ˆDWï¼‰[10][20]ï¼Œç„¶ååœ¨ x å’Œ p ä¹‹é—´è¿›è¡Œå“ˆè¾¾ç›ä¹˜ç§¯è¿ç®—ä»¥è·å¾—è¾“å‡ºã€‚ç„¶è€Œï¼Œä»…åˆ©ç”¨ç®€å•çš„HPAä¸è¶³ä»¥ä»å¤šä¸ªè§’åº¦æå–ä¿¡æ¯ï¼Œå¯¼è‡´ç»“æœä¸ç†æƒ³ã€‚å— MHSA ä¸­å¤šå¤´æ¨¡å¼çš„å¯å‘ï¼Œæˆ‘ä»¬å¼•å…¥äº†åŸºäº HPA çš„ GHPAï¼Œå¦‚ç®—æ³• 1 æ‰€ç¤ºã€‚æˆ‘ä»¬å°†è¾“å…¥æ²¿é€šé“ç»´åº¦å¹³å‡åˆ†ä¸ºå››ç»„ï¼Œå¹¶åœ¨é«˜åº¦-å®½åº¦ã€é€šé“-é«˜åº¦å’Œé€šé“ä¸Šæ‰§è¡Œ HPA - åˆ†åˆ«ä¸ºå‰ä¸‰ç»„çš„å®½åº¦è½´ã€‚å¯¹äºæœ€åä¸€ç»„ï¼Œæˆ‘ä»¬åªåœ¨ç‰¹å¾å›¾ä¸Šä½¿ç”¨DWã€‚æœ€åï¼Œæˆ‘ä»¬æ²¿ç€é€šé“ç»´åº¦è¿æ¥å››ç»„ï¼Œå¹¶åº”ç”¨å¦ä¸€ä¸ªæ•°æ®ä»“åº“æ¥æ•´åˆä¸åŒè§’åº¦çš„ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼ŒDW ä¸­ä½¿ç”¨çš„æ‰€æœ‰å†…æ ¸å¤§å°å‡ä¸º 3ã€‚\né¦–å…ˆå¯¹è¾“å…¥çš„ç‰¹å¾åˆ†ä¸ºå››ç»„è¿›è¡Œå¤„ç†ï¼šé«˜åº¦-å®½åº¦ã€é€šé“-é«˜åº¦ã€é€šé“-å®½åº¦ã€æ·±åº¦å¯åˆ†ç¦»å·ç§¯\nç„¶åè¿æ¥4ç»„ç‰¹å¾ï¼Œè¿›è¡Œå¯åˆ†ç¦»å·ç§¯èåˆç‰¹å¾ã€‚\nå…·ä½“è¿‡ç¨‹ï¼š\nç¬¬ä¸€æ­¥ï¼ŒæŒ‰é€šé“æ•°å°†è¾“å…¥å¼ é‡åˆ†ä¸ºå››ç»„ã€‚ï¼ˆx1, x2, x3, x4ï¼‰\nè®¾ç½®åˆå§‹åŒ–ä¸‰ä¸ªå…¨ä¸€å¼ é‡ï¼Œåˆ†åˆ«ä¸ºé«˜åº¦-å®½åº¦ã€é€šé“-é«˜åº¦ã€é€šé“-å®½åº¦ï¼ˆPxy, Pzx, Pzyï¼‰ã€‚\nç¬¬äºŒæ­¥ï¼Œå°† x1, x2, x3 çš„å¯¹åº”åˆ‡ç‰‡åˆ†åˆ«ä½¿ç”¨åŒçº¿æ’å€¼æ³•ï¼ˆbilinearï¼‰åœ¨Pxy, Pzx, Pzyä¸­è¿›è¡Œæ’å€¼ã€‚\nç¬¬ä¸‰æ­¥ï¼Œå¯¹æ’å€¼åçš„Pxy, Pzx, Pzyï¼Œè¿›è¡Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼Œç„¶ååˆ†åˆ«å’Œx1, x2, x3è¿›è¡Œå“ˆè¾¾ç›ä¹˜ç§¯\nç¬¬å››æ­¥ï¼Œè¿æ¥4ç»„ç‰¹å¾ä¿¡æ¯ï¼Œç„¶åç»è¿‡æ·±åº¦å¯åˆ†ç¦»å·ç§¯èåˆç‰¹å¾ã€‚\n3.3 GAB (Group Aggregation Bridge module) å¤šå°ºåº¦ä¿¡æ¯çš„è·å–è¢«è®¤ä¸ºå¯¹äºå¯†é›†é¢„æµ‹ä»»åŠ¡ï¼ˆä¾‹å¦‚åŒ»å­¦å›¾åƒåˆ†å‰²ï¼‰è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºï¼Œæˆ‘ä»¬å¼•å…¥äº† GABï¼Œå®ƒæ¥å—ä¸‰ä¸ªè¾“å…¥ï¼šä½çº§ç‰¹å¾ã€é«˜çº§ç‰¹å¾å’Œæ©ç ã€‚é¦–å…ˆï¼Œé‡‡ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼ˆDWï¼‰å’ŒåŒçº¿æ€§æ’å€¼æ¥è°ƒæ•´é«˜å±‚ç‰¹å¾çš„å¤§å°ï¼Œä»¥åŒ¹é…ä½å±‚ç‰¹å¾çš„å¤§å°ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬æ²¿é€šé“ç»´åº¦å°†ä¸¤ä¸ªç‰¹å¾æ˜ å°„åˆ†ä¸ºå››ç»„ï¼Œå¹¶å°†ä¸€ç»„ä½çº§ç‰¹å¾ä¸ä¸€ç»„é«˜çº§ç‰¹å¾è¿æ¥èµ·æ¥ï¼Œä»¥è·å¾—å››ç»„èåˆç‰¹å¾ã€‚å¯¹äºæ¯ç»„èåˆç‰¹å¾ï¼Œæ©ç è¢«è¿æ¥èµ·æ¥ã€‚æ¥ä¸‹æ¥ï¼Œå°†å†…æ ¸å¤§å°ä¸º3å’Œä¸åŒæ‰©å¼ ç‡{1,2,5,7}çš„æ‰©å¼ å·ç§¯[25]åº”ç”¨äºä¸åŒçš„ç»„ï¼Œä»¥æå–ä¸åŒå°ºåº¦çš„ä¿¡æ¯ã€‚æœ€åï¼Œå°†å››ç»„æ²¿é€šé“ç»´åº¦è¿æ¥èµ·æ¥ï¼Œç„¶ååº”ç”¨å†…æ ¸å¤§å°ä¸º 1 çš„æ™®é€šå·ç§¯ï¼Œä»¥å®ç°ä¸åŒå°ºåº¦çš„ç‰¹å¾ä¹‹é—´çš„äº¤äº’ã€‚\nGABæ¨¡å—ä½œç”¨ï¼š å°†é«˜çº§ç‰¹å¾ã€ä½çº§ç‰¹å¾ã€ä½çº§ç‰¹å¾çš„é¢„æµ‹æ©ç è¿›è¡Œç‰¹å¾èåˆï¼Œä½œä¸ºæ–°çš„è¾“å…¥ç‰¹å¾è¿›è¡Œè§£ç ã€‚\nå…·ä½“è¿‡ç¨‹ï¼š é«˜çº§ç‰¹å¾ã€ä½çº§ç‰¹å¾ã€ä½çº§ç‰¹å¾çš„é¢„æµ‹æ©ç  (xhã€xl ã€Mask)\né¦–å…ˆï¼Œé‡‡ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼ˆDWï¼‰å’ŒåŒçº¿æ€§æ’å€¼æ¥è°ƒæ•´é«˜å±‚ç‰¹å¾ (xh) çš„å¤§å°ï¼Œä»¥åŒ¹é…ä½å±‚ç‰¹å¾ (xl) çš„å¤§å°ã€‚\nå…¶æ¬¡ï¼Œæ²¿é€šé“ç»´åº¦å°†ä¸¤ä¸ªç‰¹å¾æ˜ å°„åˆ†ä¸ºå››ç»„ã€‚ï¼ˆå¯¹åº”ä¸åŒç©ºæ´å·ç§¯çš„æ‰©å¼ ç‡ï¼šd1 = 1, d2 = 2, d3 = 5, d4 = 7ï¼‰\nå¹¶å°†æ¯ä¸€ç»„çš„ä½çº§ç‰¹ã€é«˜çº§ç‰¹å¾å’Œæ©ç è¿æ¥èµ·æ¥ï¼Œæ€»å…±å››ç»„èåˆç‰¹å¾ã€‚\næœ€åï¼Œå°†å››ç»„ç‰¹å¾è¿›è¡Œè¿æ¥ï¼Œå¹¶è¿›è¡Œ1x1å·ç§¯å¾—åˆ°è¾“å‡ºã€‚\n3.4 Loss Function åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œç”±äºä¸åŒçš„GABéœ€è¦ä¸åŒå°ºåº¦çš„æ©æ¨¡ä¿¡æ¯ï¼Œå› æ­¤é‡‡ç”¨æ·±åº¦ç›‘ç£æ¥è®¡ç®—ä¸åŒé˜¶æ®µçš„æŸå¤±å‡½æ•°ï¼Œä»¥ç”Ÿæˆæ›´å‡†ç¡®çš„æ©æ¨¡ä¿¡æ¯ã€‚æˆ‘ä»¬çš„æŸå¤±å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºæ–¹ç¨‹ï¼ˆ1ï¼‰å’Œï¼ˆ2ï¼‰ã€‚å…¶ä¸­ Bce å’Œ Dice è¡¨ç¤ºäºŒå…ƒäº¤å‰ç†µå’ŒdiceæŸå¤±ã€‚ Î»iæ˜¯ä¸åŒé˜¶æ®µçš„æƒé‡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é»˜è®¤å°†i=0åˆ°i=5ä¹‹é—´çš„Î»iè®¾ç½®ä¸º1ã€0.5ã€0.4ã€0.3ã€0.2ã€0.1ã€‚\nåˆ†ä¸º6ä¸ªé˜¶æ®µï¼Œé€ä¸€è®¡ç®—æ¯ä¸ªé˜¶æ®µçš„æŸå¤±ã€‚ç„¶åæŒ‰ç…§æƒé‡å¯¹æŸå¤±è¿›è¡Œæ±‚å’Œã€‚\n4.Experiments 4.1 Datasets and Implementation details ä¸ºäº†è¯„ä¼°æˆ‘ä»¬æ¨¡å‹çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸¤ä¸ªå…¬å…±çš®è‚¤ç—…å˜åˆ†å‰²æ•°æ®é›†ï¼Œå³ ISIC2017 [1][3] å’Œ ISIC2018 [2][6]ï¼Œåˆ†åˆ«åŒ…å« 2150 ä¸ªå’Œ 2694 ä¸ªçš®è‚¤é•œå›¾åƒã€‚ä¸ä¹‹å‰çš„ç ”ç©¶[19]ä¸€è‡´ï¼Œæˆ‘ä»¬ä»¥ 7:3 çš„æ¯”ä¾‹å°†æ•°æ®é›†éšæœºåˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚\nEGE-UNetæ˜¯ç”±Pytorch[17]æ¡†æ¶å¼€å‘çš„ã€‚æ‰€æœ‰å®éªŒå‡åœ¨å•ä¸ª NVIDIA RTX A6000 GPU ä¸Šæ‰§è¡Œã€‚å›¾åƒè¢«å½’ä¸€åŒ–å¹¶è°ƒæ•´å¤§å°ä¸º 256Ã—256ã€‚æˆ‘ä»¬åº”ç”¨å„ç§æ•°æ®å¢å¼ºï¼ŒåŒ…æ‹¬æ°´å¹³ç¿»è½¬ã€å‚ç›´ç¿»è½¬å’Œéšæœºæ—‹è½¬ã€‚ AdamW [13] ç”¨ä½œä¼˜åŒ–å™¨ï¼Œä»¥ 0.001 çš„å­¦ä¹ ç‡åˆå§‹åŒ–ï¼ŒCosineAnnealingLR [12] ç”¨ä½œè°ƒåº¦å™¨ï¼Œæœ€å¤§è¿­ä»£æ¬¡æ•°ä¸º 50ï¼Œæœ€å°å­¦ä¹ ç‡ä¸º 1e-5ã€‚æ€»å…±è®­ç»ƒäº† 300 ä¸ª epochï¼Œæ‰¹é‡å¤§å°ä¸º 8ã€‚ä¸ºäº†è¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ï¼Œæˆ‘ä»¬é‡‡ç”¨å¹¶é›†å¹³å‡äº¤é›† (mIoU)ã€Dice ç›¸ä¼¼åº¦å¾—åˆ† (DSC) ä½œä¸ºæŒ‡æ ‡ï¼Œå¹¶è¿›è¡Œ 5 æ¬¡è®­ç»ƒ\nâ€‹\tåœ¨å…¬å…±çš®è‚¤ç—…å˜åˆ†å‰²æ•°æ®é›†ï¼ˆISIC2017 å’Œ ISIC2018 ï¼‰è¿›è¡Œå¯¹æ¯”å®éªŒï¼Œåœ¨ISIC2018è¿›è¡Œæ¶ˆèå®éªŒ\né‡‡ç”¨å¹¶é›†å¹³å‡äº¤é›† (mIoU)ã€Dice ç›¸ä¼¼åº¦å¾—åˆ† (DSC) ä½œä¸ºè¯„ä¼°æŒ‡æ ‡\n4.2 Comparison Experiments 4.3 Ablation Experiments 4.4 Qualitative Comparisons 5. ConClusions åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸¤ä¸ªé«˜çº§æ¨¡å—ã€‚æˆ‘ä»¬çš„ GHPA ä½¿ç”¨ä¸€ç§æ–°é¢–çš„ HPA æœºåˆ¶å°†è‡ªæ³¨æ„åŠ›çš„äºŒæ¬¡å¤æ‚åº¦ç®€åŒ–ä¸ºçº¿æ€§å¤æ‚åº¦ã€‚å®ƒè¿˜åˆ©ç”¨åˆ†ç»„æ¥å……åˆ†æ•è·æ¥è‡ªä¸åŒè§’åº¦çš„ä¿¡æ¯ã€‚æˆ‘ä»¬çš„ GAB èåˆäº†ä½çº§å’Œé«˜çº§ç‰¹å¾ï¼Œå¹¶å¼•å…¥äº†ä¸€ä¸ªæ©æ¨¡æ¥é›†æˆå¤šå°ºåº¦ä¿¡æ¯ã€‚åŸºäºè¿™äº›æ¨¡å—ï¼Œæˆ‘ä»¬æå‡ºäº†ç”¨äºçš®è‚¤ç—…å˜åˆ†å‰²ä»»åŠ¡çš„ EGE-UNetã€‚å®éªŒç»“æœè¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•åœ¨æ˜¾ç€é™ä½èµ„æºéœ€æ±‚çš„æƒ…å†µä¸‹å®ç°æœ€å…ˆè¿›çš„æ€§èƒ½çš„æœ‰æ•ˆæ€§ã€‚æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å·¥ä½œèƒ½å¤Ÿæ¿€å‘åŒ»å­¦å›¾åƒç•Œå¯¹è½»é‡çº§æ¨¡å‹çš„è¿›ä¸€æ­¥ç ”ç©¶ã€‚\nä½œè€…æå‡ºçš„EGE-UNetå®ç°äº†è½»é‡ã€å‡†ç¡®çš„çš®è‚¤ç—…å˜åˆ†å‰²ä»»åŠ¡\n","permalink":"https://swimmingliu.cn/posts/papernotes/2023-ege-unet%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/","summary":"\u003ch1 id=\"ege-unet-an-efficient-group-enhanced-unet-for-skin-lesion-segmentation\"\u003eEGE-UNet: an Efficient Group Enhanced UNet for skin lesion segmentation\u003c/h1\u003e\n\u003ch2 id=\"1-abstract\"\u003e1. Abstract\u003c/h2\u003e\n\u003cp\u003eç›®å‰çš„åŒ»å­¦å›¾åƒåˆ†å‰²æ¨¡å‹å¤§å¤šæ˜¯ Transformer + Unetï¼Œè¿™äº›æ¨¡å‹çš„å¤§é‡å‚æ•°å’Œè®¡ç®—è´Ÿè½½ä½¿å¾—å®ƒä»¬ä¸é€‚åˆç§»åŠ¨å¥åº·åº”ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eä½œè€…æå‡ºçš„EGE-UNet æ¨¡å‹è½»é‡ã€é«˜æ•ˆã€‚ï¼ˆä¸ TransFuse ç›¸æ¯”ï¼Œå‚æ•°å’Œè®¡ç®—æˆæœ¬åˆ†åˆ«é™ä½äº† 494 å€å’Œ 160 å€ï¼Œæ¨¡å‹å‚æ•°é‡åªæœ‰50KBï¼‰\u003c/p\u003e\n\u003cp\u003eåˆ›æ–°ç‚¹ï¼šç»„å¤šè½´å“ˆè¾¾ç›äº§å“æ³¨æ„åŠ›æ¨¡å—ï¼ˆGHPAï¼‰å’Œç»„èšåˆæ¡¥æ¨¡å—ï¼ˆGABï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e1.GHPA å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œåˆ†ç»„ï¼Œå¹¶åœ¨ä¸åŒè½´ä¸Šæ‰§è¡Œå“ˆè¾¾ç›äº§å“æ³¨æ„åŠ›æœºåˆ¶ï¼ˆHPAï¼‰ï¼Œä»¥ä»ä¸åŒè§’åº¦æå–ç—…ç†ä¿¡æ¯ã€‚\u003c/p\u003e\n\u003cp\u003e2.GAB é€šè¿‡å¯¹ä½çº§ç‰¹å¾ã€é«˜çº§ç‰¹å¾ä»¥åŠè§£ç å™¨åœ¨æ¯ä¸ªé˜¶æ®µç”Ÿæˆçš„æ©ç è¿›è¡Œåˆ†ç»„ï¼Œæœ‰æ•ˆåœ°èåˆäº†å¤šå°ºåº¦ä¿¡æ¯ã€‚\u003c/p\u003e\n\u003ch2 id=\"2-introduction\"\u003e2. Introduction\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eèƒŒæ™¯: æ¶æ€§é»‘è‰²ç´ ç˜¤æ˜¯ä¸–ç•Œä¸Šå¢é•¿æœ€å¿«çš„ç™Œç—‡ä¹‹ä¸€ã€‚æ®ç¾å›½ç™Œç—‡åä¼šä¼°è®¡ï¼Œ2020 å¹´çº¦æœ‰ 100,350 ä¾‹æ–°å‘ç—…ä¾‹ï¼Œè¶…è¿‡ 6,500 ä¾‹æ­»äº¡ã€‚å› æ­¤ï¼Œè‡ªåŠ¨åŒ–çš®è‚¤ç—…å˜åˆ†å‰²ç³»ç»ŸåŠ¿åœ¨å¿…è¡Œï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©åŒ»ç–—ä¸“ä¸šäººå‘˜å¿«é€Ÿè¯†åˆ«ç—…å˜åŒºåŸŸå¹¶ä¿ƒè¿›åç»­æ²»ç–—è¿‡ç¨‹ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eç›¸åŒæ–¹å¼å¯å¼•å…¥è„‘ç˜¤ã€è‚ºç™Œã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸ºäº†æé«˜åˆ†å‰²æ€§èƒ½ï¼Œæœ€è¿‘çš„ç ”ç©¶å€¾å‘äºé‡‡ç”¨å…·æœ‰æ›´å¤§å‚æ•°å’Œè®¡ç®—å¤æ‚åº¦çš„æ¨¡å—ï¼Œä¾‹å¦‚ç»“åˆè§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶[7]ã€‚ä¾‹å¦‚ï¼ŒSwin-UNet [4]ï¼ŒåŸºäºSwin Transformer [11]ï¼Œåˆ©ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ç‰¹å¾æå–èƒ½åŠ›æ¥æé«˜åˆ†å‰²æ€§èƒ½ã€‚ TransUNet [5] å¼€åˆ›äº†ç”¨äºåŒ»å­¦å›¾åƒåˆ†å‰²çš„ CNN å’Œ ViT çš„ä¸²è¡Œèåˆã€‚ TransFuse [26]é‡‡ç”¨åŒè·¯å¾„ç»“æ„ï¼Œåˆ©ç”¨ CNN å’Œ ViT åˆ†åˆ«æ•è·å±€éƒ¨å’Œå…¨å±€ä¿¡æ¯ã€‚UTNetV2[8]åˆ©ç”¨æ··åˆåˆ†å±‚æ¶æ„ã€é«˜æ•ˆçš„åŒå‘æ³¨æ„åŠ›å’Œè¯­ä¹‰å›¾æ¥å®ç°å…¨å±€å¤šå°ºåº¦ç‰¹å¾èåˆï¼Œç»“åˆäº†CNNå’ŒViTçš„ä¼˜ç‚¹ã€‚ TransBTS [23] å°†è‡ªæ³¨æ„åŠ›å¼•å…¥è„‘è‚¿ç˜¤åˆ†å‰²ä»»åŠ¡ä¸­ï¼Œå¹¶ç”¨å®ƒæ¥èšåˆé«˜çº§ä¿¡æ¯ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eAbstractæåˆ°å½“å‰åŒ»å­¦åˆ†å‰²æ¨¡å‹å¤§éƒ¨åˆ†æ˜¯Transformer + Unetï¼Œè¿™é‡Œåšå‡ºå…·ä½“é˜è¿°ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå…ˆå‰çš„å·¥ä½œé€šè¿‡å¼•å…¥å¤æ‚çš„æ¨¡å—æ¥æé«˜æ€§èƒ½ï¼Œä½†å¿½ç•¥äº†å®é™…åŒ»ç–—ç¯å¢ƒä¸­è®¡ç®—èµ„æºçš„é™åˆ¶ã€‚å› æ­¤ï¼Œè¿«åˆ‡éœ€è¦ä¸ºç§»åŠ¨åŒ»ç–—ä¸­çš„åˆ†å‰²ä»»åŠ¡è®¾è®¡ä¸€ç§ä½å‚æ•°ã€ä½è®¡ç®—è´Ÿè½½çš„æ¨¡å‹ã€‚æœ€è¿‘ï¼ŒUNeXt [22] ç»“åˆäº† UNet [18] å’Œ MLP [21] å¼€å‘äº†ä¸€ç§è½»é‡çº§æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å¯ä»¥è·å¾—ä¼˜å¼‚çš„æ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘å‚æ•°å’Œè®¡ç®—é‡ã€‚æ­¤å¤–ï¼ŒMALUNet [19]é€šè¿‡å‡å°‘æ¨¡å‹é€šé“æ•°å¹¶å¼•å…¥å¤šä¸ªæ³¨æ„åŠ›æ¨¡å—æ¥å‡å°æ¨¡å‹å¤§å°ï¼Œä»è€Œæ¯” UNeXt å…·æœ‰æ›´å¥½çš„çš®è‚¤ç—…å˜åˆ†å‰²æ€§èƒ½ã€‚ç„¶è€Œï¼Œå°½ç®¡MALUNetå¤§å¤§å‡å°‘äº†å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ï¼Œä½†å…¶åˆ†å‰²æ€§èƒ½ä»ç„¶ä½äºä¸€äº›å¤§å‹æ¨¡å‹ï¼Œä¾‹å¦‚TransFuseã€‚å› æ­¤ï¼Œåœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº† EGE-UNetï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§çš®è‚¤ç—…å˜åˆ†å‰²æ¨¡å‹ï¼Œå¯å®ç°æœ€å…ˆè¿›çš„æ•ˆæœï¼ŒåŒæ—¶æ˜¾ç€é™ä½å‚æ•°å’Œè®¡ç®—æˆæœ¬ã€‚æ­¤å¤–ï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªå°†å‚æ•°å‡å°‘åˆ°å¤§çº¦ 50KB çš„å·¥ä½œã€‚\u003c/p\u003e","title":"EGE-UNet: an Efficient Group Enhanced UNet for skin lesion segmentation"}]