<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Cozeå·¥ä½œæµåˆ†æ | SwimmingLiu&#39;s Blog</title>
<meta name="keywords" content="Java">
<meta name="description" content="Cozeå·¥ä½œæµ-QA

å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ
å·¥ä½œæµç®¡ç†

å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚

èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)
å·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹
graph TD
    subgraph &#34;å‰ç«¯Canvaså±‚&#34;
        A[Canvasç”»å¸ƒç”¨æˆ·å¯è§†åŒ–é…ç½®] --&gt; B[NodeèŠ‚ç‚¹vo.Nodeç»“æ„ä½“]
        A --&gt; C[Edgeè¿æ¥èŠ‚ç‚¹é—´å…³ç³»]
        B --&gt; D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ]
    end
    
    subgraph &#34;éªŒè¯å±‚&#34;
        E[Canvasç»“æ„éªŒè¯CanvasValidator] --&gt; F{éªŒè¯é€šè¿‡?}
        F --&gt;|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯]
        G --&gt; H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º]
    end
    
    subgraph &#34;è½¬æ¢å±‚&#34;
        I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡ŒCanvasToWorkflowSchema] --&gt; J[NodeType -&gt; èŠ‚ç‚¹Configé€šè¿‡NodeAdaptoræ¥å£]
        J --&gt; K[å‰ç«¯schema -&gt; åç«¯schemaschema.NodeSchema]
    end
    
    subgraph &#34;å®ä¾‹åŒ–å±‚&#34;
        L[èŠ‚ç‚¹å®ä¾‹åŒ–NodeBuilderæ¥å£] --&gt; M[NodeSchema.Configså®ç°NodeBuilderæ¥å£]
        M --&gt; N[åç«¯schema -&gt; èŠ‚ç‚¹å®ä¾‹å…·ä½“èŠ‚ç‚¹å¯¹è±¡]
    end
    
    subgraph &#34;æ‰§è¡Œå±‚&#34;
        O[èŠ‚ç‚¹è¿è¡ŒInvokableNodeç­‰æ¥å£] --&gt; P[ä¸šåŠ¡é€»è¾‘å…·ä½“æ‰§è¡Œé€»è¾‘]
        P --&gt; Q[ç»“æœè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœ]
    end
    
    A --&gt; E
    F --&gt;|é€šè¿‡| I
    K --&gt; L
    N --&gt; O
    
    style A fill:#e3f2fd
    style E fill:#ffebee
    style I fill:#fff3e0
    style L fill:#e8f5e8
    style O fill:#f3e5f5


1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„
å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬">
<meta name="author" content="SwimmingLiu">
<link rel="canonical" href="https://swimmingliu.cn/posts/job/coze-workflow-analysis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6ecbb0040febd20e47edd88a662c19f1ea945bf7427774b86594271d18f88faf.css" integrity="sha256-bsuwBA/r0g5H7diKZiwZ8eqUW/dCd3S4ZZQnHRj4j68=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://swimmingliu.cn/images/swimmingliu_icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://swimmingliu.cn/images/swimmingliu_icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://swimmingliu.cn/images/swimmingliu_icon.png">
<link rel="apple-touch-icon" href="https://swimmingliu.cn/images/swimmingliu_icon.png">
<link rel="mask-icon" href="https://swimmingliu.cn/images/swimmingliu_icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://swimmingliu.cn/posts/job/coze-workflow-analysis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: true }
            ],
            
            throwOnError: false
        });
    });
</script>

<meta property="og:url" content="https://swimmingliu.cn/posts/job/coze-workflow-analysis/">
  <meta property="og:site_name" content="SwimmingLiu&#39;s Blog">
  <meta property="og:title" content="Cozeå·¥ä½œæµåˆ†æ">
  <meta property="og:description" content="Cozeå·¥ä½œæµ-QA å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ
å·¥ä½œæµç®¡ç† å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚
èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)
å·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹
graph TD subgraph &#34;å‰ç«¯Canvaså±‚&#34; A[Canvasç”»å¸ƒç”¨æˆ·å¯è§†åŒ–é…ç½®] --&gt; B[NodeèŠ‚ç‚¹vo.Nodeç»“æ„ä½“] A --&gt; C[Edgeè¿æ¥èŠ‚ç‚¹é—´å…³ç³»] B --&gt; D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ] end subgraph &#34;éªŒè¯å±‚&#34; E[Canvasç»“æ„éªŒè¯CanvasValidator] --&gt; F{éªŒè¯é€šè¿‡?} F --&gt;|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯] G --&gt; H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º] end subgraph &#34;è½¬æ¢å±‚&#34; I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡ŒCanvasToWorkflowSchema] --&gt; J[NodeType -&gt; èŠ‚ç‚¹Configé€šè¿‡NodeAdaptoræ¥å£] J --&gt; K[å‰ç«¯schema -&gt; åç«¯schemaschema.NodeSchema] end subgraph &#34;å®ä¾‹åŒ–å±‚&#34; L[èŠ‚ç‚¹å®ä¾‹åŒ–NodeBuilderæ¥å£] --&gt; M[NodeSchema.Configså®ç°NodeBuilderæ¥å£] M --&gt; N[åç«¯schema -&gt; èŠ‚ç‚¹å®ä¾‹å…·ä½“èŠ‚ç‚¹å¯¹è±¡] end subgraph &#34;æ‰§è¡Œå±‚&#34; O[èŠ‚ç‚¹è¿è¡ŒInvokableNodeç­‰æ¥å£] --&gt; P[ä¸šåŠ¡é€»è¾‘å…·ä½“æ‰§è¡Œé€»è¾‘] P --&gt; Q[ç»“æœè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœ] end A --&gt; E F --&gt;|é€šè¿‡| I K --&gt; L N --&gt; O style A fill:#e3f2fd style E fill:#ffebee style I fill:#fff3e0 style L fill:#e8f5e8 style O fill:#f3e5f5 1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„ å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-07T23:27:35+08:00">
    <meta property="article:modified_time" content="2025-08-07T23:27:35+08:00">
    <meta property="article:tag" content="Java">
      <meta property="og:image" content="https://swimmingliu.cn/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://swimmingliu.cn/papermod-cover.png">
<meta name="twitter:title" content="Cozeå·¥ä½œæµåˆ†æ">
<meta name="twitter:description" content="Cozeå·¥ä½œæµ-QA

å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ
å·¥ä½œæµç®¡ç†

å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚

èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)
å·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹
graph TD
    subgraph &#34;å‰ç«¯Canvaså±‚&#34;
        A[Canvasç”»å¸ƒç”¨æˆ·å¯è§†åŒ–é…ç½®] --&gt; B[NodeèŠ‚ç‚¹vo.Nodeç»“æ„ä½“]
        A --&gt; C[Edgeè¿æ¥èŠ‚ç‚¹é—´å…³ç³»]
        B --&gt; D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ]
    end
    
    subgraph &#34;éªŒè¯å±‚&#34;
        E[Canvasç»“æ„éªŒè¯CanvasValidator] --&gt; F{éªŒè¯é€šè¿‡?}
        F --&gt;|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯]
        G --&gt; H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º]
    end
    
    subgraph &#34;è½¬æ¢å±‚&#34;
        I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡ŒCanvasToWorkflowSchema] --&gt; J[NodeType -&gt; èŠ‚ç‚¹Configé€šè¿‡NodeAdaptoræ¥å£]
        J --&gt; K[å‰ç«¯schema -&gt; åç«¯schemaschema.NodeSchema]
    end
    
    subgraph &#34;å®ä¾‹åŒ–å±‚&#34;
        L[èŠ‚ç‚¹å®ä¾‹åŒ–NodeBuilderæ¥å£] --&gt; M[NodeSchema.Configså®ç°NodeBuilderæ¥å£]
        M --&gt; N[åç«¯schema -&gt; èŠ‚ç‚¹å®ä¾‹å…·ä½“èŠ‚ç‚¹å¯¹è±¡]
    end
    
    subgraph &#34;æ‰§è¡Œå±‚&#34;
        O[èŠ‚ç‚¹è¿è¡ŒInvokableNodeç­‰æ¥å£] --&gt; P[ä¸šåŠ¡é€»è¾‘å…·ä½“æ‰§è¡Œé€»è¾‘]
        P --&gt; Q[ç»“æœè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœ]
    end
    
    A --&gt; E
    F --&gt;|é€šè¿‡| I
    K --&gt; L
    N --&gt; O
    
    style A fill:#e3f2fd
    style E fill:#ffebee
    style I fill:#fff3e0
    style L fill:#e8f5e8
    style O fill:#f3e5f5


1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„
å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“š Posts",
      "item": "https://swimmingliu.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ’» Job",
      "item": "https://swimmingliu.cn/posts/job/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Cozeå·¥ä½œæµåˆ†æ",
      "item": "https://swimmingliu.cn/posts/job/coze-workflow-analysis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Cozeå·¥ä½œæµåˆ†æ",
  "name": "Cozeå·¥ä½œæµåˆ†æ",
  "description": "Cozeå·¥ä½œæµ-QA å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ\nå·¥ä½œæµç®¡ç† å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚\nèŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)\nå·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹\ngraph TD subgraph \"å‰ç«¯Canvaså±‚\" A[Canvasç”»å¸ƒç”¨æˆ·å¯è§†åŒ–é…ç½®] --\u003e B[NodeèŠ‚ç‚¹vo.Nodeç»“æ„ä½“] A --\u003e C[Edgeè¿æ¥èŠ‚ç‚¹é—´å…³ç³»] B --\u003e D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ] end subgraph \"éªŒè¯å±‚\" E[Canvasç»“æ„éªŒè¯CanvasValidator] --\u003e F{éªŒè¯é€šè¿‡?} F --\u003e|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯] G --\u003e H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º] end subgraph \"è½¬æ¢å±‚\" I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡ŒCanvasToWorkflowSchema] --\u003e J[NodeType -\u003e èŠ‚ç‚¹Configé€šè¿‡NodeAdaptoræ¥å£] J --\u003e K[å‰ç«¯schema -\u003e åç«¯schemaschema.NodeSchema] end subgraph \"å®ä¾‹åŒ–å±‚\" L[èŠ‚ç‚¹å®ä¾‹åŒ–NodeBuilderæ¥å£] --\u003e M[NodeSchema.Configså®ç°NodeBuilderæ¥å£] M --\u003e N[åç«¯schema -\u003e èŠ‚ç‚¹å®ä¾‹å…·ä½“èŠ‚ç‚¹å¯¹è±¡] end subgraph \"æ‰§è¡Œå±‚\" O[èŠ‚ç‚¹è¿è¡ŒInvokableNodeç­‰æ¥å£] --\u003e P[ä¸šåŠ¡é€»è¾‘å…·ä½“æ‰§è¡Œé€»è¾‘] P --\u003e Q[ç»“æœè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœ] end A --\u003e E F --\u003e|é€šè¿‡| I K --\u003e L N --\u003e O style A fill:#e3f2fd style E fill:#ffebee style I fill:#fff3e0 style L fill:#e8f5e8 style O fill:#f3e5f5 1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„ å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬\n",
  "keywords": [
    "Java"
  ],
  "articleBody": "Cozeå·¥ä½œæµ-QA å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ\nå·¥ä½œæµç®¡ç† å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚\nèŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)\nå·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹\ngraph TD subgraph \"å‰ç«¯Canvaså±‚\" A[Canvasç”»å¸ƒç”¨æˆ·å¯è§†åŒ–é…ç½®] --\u003e B[NodeèŠ‚ç‚¹vo.Nodeç»“æ„ä½“] A --\u003e C[Edgeè¿æ¥èŠ‚ç‚¹é—´å…³ç³»] B --\u003e D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ] end subgraph \"éªŒè¯å±‚\" E[Canvasç»“æ„éªŒè¯CanvasValidator] --\u003e F{éªŒè¯é€šè¿‡?} F --\u003e|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯] G --\u003e H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º] end subgraph \"è½¬æ¢å±‚\" I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡ŒCanvasToWorkflowSchema] --\u003e J[NodeType -\u003e èŠ‚ç‚¹Configé€šè¿‡NodeAdaptoræ¥å£] J --\u003e K[å‰ç«¯schema -\u003e åç«¯schemaschema.NodeSchema] end subgraph \"å®ä¾‹åŒ–å±‚\" L[èŠ‚ç‚¹å®ä¾‹åŒ–NodeBuilderæ¥å£] --\u003e M[NodeSchema.Configså®ç°NodeBuilderæ¥å£] M --\u003e N[åç«¯schema -\u003e èŠ‚ç‚¹å®ä¾‹å…·ä½“èŠ‚ç‚¹å¯¹è±¡] end subgraph \"æ‰§è¡Œå±‚\" O[èŠ‚ç‚¹è¿è¡ŒInvokableNodeç­‰æ¥å£] --\u003e P[ä¸šåŠ¡é€»è¾‘å…·ä½“æ‰§è¡Œé€»è¾‘] P --\u003e Q[ç»“æœè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœ] end A --\u003e E F --\u003e|é€šè¿‡| I K --\u003e L N --\u003e O style A fill:#e3f2fd style E fill:#ffebee style I fill:#fff3e0 style L fill:#e8f5e8 style O fill:#f3e5f5 1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„ å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬\ntype Canvas struct { Nodes []*Node `json:\"nodes\"` Edges []*Edge `json:\"edges\"` Versions any `json:\"versions\"` } 1.1.1Â èŠ‚ç‚¹æ•°æ® ç”»å¸ƒä¸­çš„èŠ‚ç‚¹ä¼šè½¬æ¢ä¸ºåç«¯ä¸­Â backend/domain/workflow/entity/vo/canvas.goÂ ä¸­çš„Â NodeÂ ç»“æ„ä½“ï¼ŒÂ åç«¯å­˜å‚¨çš„ç»“æ„ä½“å¦‚ä¸‹\n// Node å·¥ä½œæµèŠ‚ç‚¹çš„å®Œæ•´å®šä¹‰ // èŠ‚ç‚¹æ˜¯å·¥ä½œæµçš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–æ“ä½œ type Node struct { // èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨ç”»å¸ƒä¸­å®šä½å’Œå¼•ç”¨èŠ‚ç‚¹ ID string `json:\"id\"` // èŠ‚ç‚¹ç±»å‹ï¼Œå†³å®šèŠ‚ç‚¹çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼ˆå¦‚LLMã€APIè°ƒç”¨ã€æ¡ä»¶åˆ¤æ–­ç­‰ï¼‰ Type BlockType `json:\"type\"` // èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…å«å‰ç«¯æ˜¾ç¤ºç›¸å…³çš„é…ç½® (å‰ç«¯çš„ä¸€äº›extendInfo) Meta any `json:\"meta\"` // èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®ï¼ŒåŒ…å«è¾“å…¥è¾“å‡ºé…ç½®å’Œå…·ä½“å‚æ•°ï¼Œä¾‹å¦‚LLMçš„é…ç½®ã€MCPçš„é…ç½®ã€å¼‚å¸¸å¤„ç† Data *Data `json:\"data\"` // å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºå¤åˆèŠ‚ç‚¹ï¼ˆå¦‚å¾ªç¯ã€æ¡ä»¶åˆ†æ”¯ï¼‰çš„åµŒå¥—ç»“æ„ Blocks []*Node `json:\"blocks,omitempty\"` // èŠ‚ç‚¹å†…éƒ¨çš„è¿çº¿ï¼Œç”¨äºå¤æ‚èŠ‚ç‚¹çš„å†…éƒ¨é€»è¾‘è¿æ¥ Edges []*Edge `json:\"edges,omitempty\"` // èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ï¼Œç”¨äºèŠ‚ç‚¹å®šä¹‰çš„ç‰ˆæœ¬æ§åˆ¶ Version string `json:\"version,omitempty\"` // çˆ¶èŠ‚ç‚¹å¼•ç”¨ï¼Œä¸åºåˆ—åŒ–åˆ°JSONï¼Œç”¨äºå†…å­˜ä¸­çš„æ ‘å½¢ç»“æ„å¯¼èˆª parent *Node } èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®Dataå¦‚ä¸‹æ‰€ç¤º\ntype Data struct { // èŠ‚ç‚¹çš„æ˜¾ç¤ºå…ƒæ•°æ®ï¼Œå¦‚æ ‡é¢˜ã€iconç­‰ Meta *NodeMeta `json:\"nodeMeta,omitempty\"` // èŠ‚ç‚¹çš„è¾“å‡ºå®šä¹‰ï¼Œå¯ä»¥æ˜¯ []*Variable æˆ– []*Param ç±»å‹ Outputs []any `json:\"outputs,omitempty\"` // èŠ‚ç‚¹çš„è¾“å…¥é…ç½®ï¼ŒåŒ…å«æ‰€æœ‰è¾“å…¥å‚æ•°å’Œè®¾ç½® Inputs *Inputs `json:\"inputs,omitempty\"` // èŠ‚ç‚¹åœ¨ç”»å¸ƒä¸Šçš„å°ºå¯¸ä¿¡æ¯ï¼Œç”¨äºå‰ç«¯æ˜¾ç¤º Size any `json:\"size,omitempty\"` } èŠ‚ç‚¹çš„è¾“å…¥å‚æ•°Â inputs\n// Inputs èŠ‚ç‚¹è¾“å…¥é…ç½®çš„ç»¼åˆç»“æ„ // è¿™æ˜¯ä¸€ä¸ªè”åˆç»“æ„ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„èŠ‚ç‚¹è¾“å…¥é…ç½®ï¼Œä¸åŒç±»å‹çš„èŠ‚ç‚¹ä½¿ç”¨ä¸åŒçš„å­—æ®µå­é›† type Inputs struct { // é€šç”¨è¾“å…¥é…ç½® InputParameters []*Param `json:\"inputParameters\"` // èŠ‚ç‚¹çš„è¾“å…¥å‚æ•°åˆ—è¡¨ï¼Œå®šä¹‰èŠ‚ç‚¹éœ€è¦çš„æ•°æ®è¾“å…¥ Content *BlockInput `json:\"content\"` // èŠ‚ç‚¹çš„ä¸»è¦å†…å®¹è¾“å…¥ï¼Œé€šå¸¸ç”¨äºæ–‡æœ¬å¤„ç†æˆ–æç¤ºè¯ TerminatePlan *TerminatePlan `json:\"terminatePlan,omitempty\"` // ç»ˆæ­¢è®¡åˆ’ï¼Œå®šä¹‰èŠ‚ç‚¹å®Œæˆåçš„è¡Œä¸º StreamingOutput bool `json:\"streamingOutput,omitempty\"` // æ˜¯å¦å¯ç”¨æµå¼è¾“å‡ºï¼Œç”¨äºå®æ—¶è¿”å›å¤„ç†ç»“æœ CallTransferVoice bool `json:\"callTransferVoice,omitempty\"` // è¯­éŸ³é€šè¯è½¬æ¥è®¾ç½®ï¼Œç”¨äºè¯­éŸ³ç›¸å…³èŠ‚ç‚¹ ChatHistoryWriting string `json:\"chatHistoryWriting,omitempty\"` // èŠå¤©å†å²è®°å½•å†™å…¥é…ç½® LLMParam any `json:\"llmParam,omitempty\"` // LLMå‚æ•°ï¼Œå¯èƒ½æ˜¯LLMParamã€IntentDetectorLLMParamæˆ–QALLMParamç±»å‹ FCParam *FCParam `json:\"fcParam,omitempty\"` // åŠŸèƒ½è°ƒç”¨å‚æ•°ï¼Œç”¨äºé…ç½®å·¥ä½œæµã€æ’ä»¶æˆ–çŸ¥è¯†åº“çš„è°ƒç”¨ SettingOnError *SettingOnError `json:\"settingOnError,omitempty\"` // é”™è¯¯å¤„ç†é…ç½®ï¼Œå®šä¹‰èŠ‚ç‚¹å‡ºé”™æ—¶çš„å¤„ç†ç­–ç•¥ // å¾ªç¯æ§åˆ¶ç›¸å…³ LoopType LoopType `json:\"loopType,omitempty\"` // å¾ªç¯ç±»å‹ï¼šæ•°ç»„å¾ªç¯ã€è®¡æ•°å¾ªç¯æˆ–æ— é™å¾ªç¯ LoopCount *BlockInput `json:\"loopCount,omitempty\"` // å¾ªç¯æ¬¡æ•°ï¼Œç”¨äºè®¡æ•°å¾ªç¯ VariableParameters []*Param `json:\"variableParameters,omitempty\"` // å¾ªç¯å˜é‡å‚æ•° // æ¡ä»¶åˆ†æ”¯ç›¸å…³ Branches []*struct { Condition struct { Logic LogicType `json:\"logic\"` // æ¡ä»¶é€»è¾‘ï¼šANDæˆ–OR Conditions []*Condition `json:\"conditions\"` // å…·ä½“çš„æ¡ä»¶åˆ—è¡¨ } `json:\"condition\"` } `json:\"branches,omitempty\"` // åˆ†æ”¯æ¡ä»¶é…ç½®ï¼Œç”¨äºæ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹ // æ‰¹å¤„ç†é…ç½® NodeBatchInfo *NodeBatch `json:\"batch,omitempty\"` // èŠ‚ç‚¹æ‰¹å¤„ç†æ¨¡å¼é…ç½® // ç‰¹å®šèŠ‚ç‚¹ç±»å‹çš„é…ç½®ï¼ˆä½¿ç”¨åµŒå…¥ç»“æ„ä½“å®ç°ç±»å‹å¤šæ€ï¼‰ *TextProcessor // æ–‡æœ¬å¤„ç†å™¨é…ç½®ï¼šæ‹¼æ¥ã€åˆ†å‰²ç­‰æ“ä½œ *SubWorkflow // å­å·¥ä½œæµé…ç½®ï¼šè°ƒç”¨å…¶ä»–å·¥ä½œæµ *IntentDetector // æ„å›¾æ£€æµ‹é…ç½®ï¼šè¯†åˆ«ç”¨æˆ·æ„å›¾ *DatabaseNode // æ•°æ®åº“æ“ä½œé…ç½®ï¼šå¢åˆ æ”¹æŸ¥ *HttpRequestNode // HTTPè¯·æ±‚é…ç½®ï¼šAPIè°ƒç”¨ *KnowledgeIndexer // çŸ¥è¯†åº“ç´¢å¼•é…ç½®ï¼šæ–‡æ¡£å¤„ç†å’Œç´¢å¼• *CodeRunner // ä»£ç æ‰§è¡Œå™¨é…ç½®ï¼šè¿è¡Œè‡ªå®šä¹‰ä»£ç  *PluginAPIParam // æ’ä»¶APIå‚æ•°é…ç½® *VariableAggregator // å˜é‡èšåˆå™¨é…ç½®ï¼šåˆå¹¶å¤šä¸ªå˜é‡ *VariableAssigner // å˜é‡èµ‹å€¼å™¨é…ç½®ï¼šè®¾ç½®å˜é‡å€¼ *QA // é—®ç­”èŠ‚ç‚¹é…ç½®ï¼šå¤„ç†é—®é¢˜å’Œç­”æ¡ˆ *Batch // æ‰¹å¤„ç†é…ç½®ï¼šæ‰¹é‡å¤„ç†æ•°æ® *Comment // æ³¨é‡ŠèŠ‚ç‚¹é…ç½®ï¼šæ·»åŠ è¯´æ˜æ–‡å­— OutputSchema string `json:\"outputSchema,omitempty\"` // è¾“å‡ºæ¨¡å¼å®šä¹‰ï¼Œæè¿°èŠ‚ç‚¹è¾“å‡ºæ•°æ®çš„ç»“æ„ } 1.1.2Â è¾¹æ•°æ® è¾¹ä¸»è¦æ˜¯åŒ…å«è¾“å…¥èŠ‚ç‚¹ã€è¾“å‡ºèŠ‚ç‚¹çš„IDï¼Œè¿˜æœ‰è¾“å…¥çš„ç«¯å£å’Œè¾“å‡ºçš„ç«¯å£Â ï¼ˆè¾“å…¥è¾“å‡ºç«¯å£éƒ½æ˜¯åªå­˜åœ¨äºä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹ä¸­ï¼‰\n// Edge å·¥ä½œæµè¿çº¿å®šä¹‰ // è¿çº¿å®šä¹‰äº†èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼Œç¡®å®šå·¥ä½œæµçš„æ‰§è¡Œé¡ºåºå’Œæ•°æ®æµå‘ type Edge struct { // æºèŠ‚ç‚¹IDï¼Œè¿çº¿çš„èµ·å§‹èŠ‚ç‚¹ SourceNodeID string `json:\"sourceNodeID\"` // ç›®æ ‡èŠ‚ç‚¹IDï¼Œè¿çº¿çš„ç»ˆæ­¢èŠ‚ç‚¹ TargetNodeID string `json:\"targetNodeID\"` // æºç«¯å£IDï¼Œç”¨äºå¤šè¾“å‡ºç«¯å£çš„èŠ‚ç‚¹ï¼ŒæŒ‡å®šå…·ä½“çš„è¾“å‡ºç«¯å£ SourcePortID string `json:\"sourcePortID,omitempty\"` // ç›®æ ‡ç«¯å£IDï¼Œç”¨äºå¤šè¾“å…¥ç«¯å£çš„èŠ‚ç‚¹ï¼ŒæŒ‡å®šå…·ä½“çš„è¾“å…¥ç«¯å£ TargetPortID string `json:\"targetPortID,omitempty\"` } 1.1.3Â å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹Â (NoteTypeLLM) LLMèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º classDiagram class Inputs { +Param[] inputParameters +SettingOnError settingOnError +NodeBatch nodeBatchInfo +any llmParam +LLM llmSpecificConfig } class LLM { +FCParam fcParam } class LLMParam { +Param[] parameters } class SimpleLLMParam { +string generationDiversity +int maxTokens +string modelName +int64 modelType +ResponseFormat responseFormat +string systemPrompt +float64 temperature +float64 topP } class Param { +string name +BlockInput input +BlockInput left +BlockInput right +BlockInput[] variables } class BlockInput { +VariableType type +AssistType assistType +any schema +BlockInputValue value } class BlockInputValue { +BlockInputValueType type +any content +any rawMeta } class BlockInputReference { +string blockID +string name +string[] path +RefSourceType source } class FCParam { +WorkflowFCParam workflowFCParam +PluginFCParam pluginFCParam +KnowledgeFCParam knowledgeFCParam } class SettingOnError { +ErrorHandlingStrategy strategy +string customMessage } class NodeBatch { +int batchSize +int concurrentSize } Inputs --\u003e LLM : \"contains\" Inputs --\u003e LLMParam : \"llmParam as\" Inputs --\u003e SimpleLLMParam : \"llmParam as\" Inputs --\u003e Param : \"contains\" Inputs --\u003e SettingOnError : \"contains\" Inputs --\u003e NodeBatch : \"contains\" LLM --\u003e FCParam : \"contains\" LLMParam --\u003e Param : \"contains\" Param --\u003e BlockInput : \"contains\" BlockInput --\u003e BlockInputValue : \"contains\" BlockInputValue --\u003e BlockInputReference : \"content as\" note for Inputs \"LLMèŠ‚ç‚¹çš„æ‰€æœ‰è¾“å…¥é…ç½®åŒ…å«é€šç”¨è¾“å…¥å’ŒLLMä¸“ç”¨é…ç½®\" note for LLMParam \"æ ‡å‡†LLMå‚æ•°åˆ—è¡¨æ¯ä¸ªå‚æ•°éƒ½æ˜¯Paramç±»å‹\" note for SimpleLLMParam \"ç®€åŒ–çš„LLMå‚æ•°ç»“æ„ç›´æ¥åŒ…å«æ‰€æœ‰LLMé…ç½®å­—æ®µ\" note for FCParam \"å‡½æ•°è°ƒç”¨èƒ½åŠ›é…ç½®LLMå¯è°ƒç”¨çš„å¤–éƒ¨å·¥å…·\" LLMå‚æ•°Â -Â SimpleLLMParam SimpleLLMParamå¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«å¤šæ ·æ€§ç¨‹åº¦ã€æœ€å¤§Tokenã€æ¨¡å‹åç§°ã€æ¨¡å‹ç±»å‹ã€å“åº”æ ¼å¼ã€ç³»ç»Ÿæç¤ºè¯ã€Temperatureæ¸©åº¦ã€TopPÂ æ ¸é‡‡æ ·å‚æ•°\nã€æ³¨æ„ã€‘generationDiversityå¤šæ ·æ€§ç¨‹åº¦Â æ˜¯é«˜å±‚çš„é¢„è®¾ç­–ç•¥ï¼ˆå¦‚\"åˆ›æ„/å¹³è¡¡/ç²¾ç¡®\"æ¨¡å¼ï¼‰ï¼Œè€ŒÂ temperatureå’ŒÂ topPæ˜¯åº•å±‚çš„å…·ä½“ç®—æ³•å‚æ•°ï¼Œå‰è€…é€šè¿‡å†…ç½®çš„å‚æ•°ç»„åˆæ¥ç®€åŒ–é…ç½®ï¼Œåè€…åˆ™æä¾›ç²¾ç¡®çš„éšæœºæ€§æ§åˆ¶ï¼ˆtemperatureè°ƒèŠ‚æ¦‚ç‡åˆ†å¸ƒå¹³æ»‘åº¦ï¼ŒtopPé™åˆ¶å€™é€‰è¯æ±‡èŒƒå›´ï¼‰ã€‚\nç®€å•è¯´ï¼šgenerationDiversityÂ =Â â€œæˆ‘è¦ä»€ä¹ˆé£æ ¼â€ï¼ŒtemperatureÂ =Â â€œè¦å¤šéšæœºâ€ï¼ŒtopPÂ =Â â€œè€ƒè™‘å¤šå°‘è¯æ±‡â€ã€‚\n// SimpleLLMParam ç®€åŒ–çš„å¤§è¯­è¨€æ¨¡å‹å‚æ•°é…ç½® // æä¾›ç›´æ¥çš„å­—æ®µæ˜ å°„æ–¹å¼é…ç½®LLMå‚æ•°ï¼Œé€‚ç”¨äºç®€å•çš„æ¨¡å‹è°ƒç”¨åœºæ™¯ type SimpleLLMParam struct { // GenerationDiversity ç”Ÿæˆå¤šæ ·æ€§é…ç½® // æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„å¤šæ ·æ€§ç¨‹åº¦ï¼Œå½±å“ç”Ÿæˆå†…å®¹çš„åˆ›æ–°æ€§ GenerationDiversity string `json:\"generationDiversity\"` // MaxTokens æœ€å¤§ç”Ÿæˆä»¤ç‰Œæ•° // é™åˆ¶æ¨¡å‹å•æ¬¡ç”Ÿæˆçš„æœ€å¤§tokenæ•°é‡ï¼Œæ§åˆ¶è¾“å‡ºé•¿åº¦ MaxTokens int `json:\"maxTokens\"` // ModelName æ¨¡å‹åç§° // æŒ‡å®šè¦ä½¿ç”¨çš„å…·ä½“æ¨¡å‹åç§°ï¼Œå¦‚gpt-3.5-turboã€gpt-4ç­‰ ModelName string `json:\"modelName\"` // ModelType æ¨¡å‹ç±»å‹æ ‡è¯† // ç”¨äºåŒºåˆ†ä¸åŒç±»å‹çš„æ¨¡å‹ï¼Œå¦‚èŠå¤©æ¨¡å‹ã€è¡¥å…¨æ¨¡å‹ç­‰ ModelType int64 `json:\"modelType\"` // ResponseFormat å“åº”æ ¼å¼é…ç½® // æŒ‡å®šæ¨¡å‹è¾“å‡ºçš„æ ¼å¼ï¼Œæ”¯æŒæ–‡æœ¬ã€JSONã€Markdownç­‰æ ¼å¼ ResponseFormat model.ResponseFormat `json:\"responseFormat\"` // SystemPrompt ç³»ç»Ÿæç¤ºè¯ // å®šä¹‰æ¨¡å‹çš„ç³»ç»Ÿçº§æŒ‡ä»¤ï¼Œè®¾å®šæ¨¡å‹çš„è§’è‰²å’Œè¡Œä¸ºè§„èŒƒ SystemPrompt string `json:\"systemPrompt\"` // Temperature æ¸©åº¦å‚æ•° // æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ï¼ŒèŒƒå›´é€šå¸¸ä¸º0.0-1.0ï¼Œå€¼è¶Šé«˜è¾“å‡ºè¶Šéšæœº // é€šè¿‡è°ƒæ•´softmaxæ¦‚ç‡åˆ†å¸ƒçš„å¹³æ»‘åº¦æ¥å½±å“è¯æ±‡é€‰æ‹©çš„ç¡®å®šæ€§ Temperature float64 `json:\"temperature\"` // TopP æ ¸é‡‡æ ·å‚æ•° // æ§åˆ¶æ¨¡å‹ç”Ÿæˆæ—¶è€ƒè™‘çš„è¯æ±‡æ¦‚ç‡è´¨é‡ï¼Œå½±å“è¾“å‡ºçš„å¤šæ ·æ€§å’Œè´¨é‡ // é€šè¿‡è®¾ç½®æ¦‚ç‡ç´¯ç§¯é˜ˆå€¼æ¥é™åˆ¶å€™é€‰è¯æ±‡çš„èŒƒå›´ï¼ŒèŒƒå›´é€šå¸¸ä¸º0.0-1.0 TopP float64 `json:\"topP\"` } LLMä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°Â **FcParam** functionCallingÂ ï¼ˆå¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹çš„â€œæŠ€èƒ½â€ï¼‰ä¸­éœ€è¦ç”¨åˆ°çš„å‚æ•°\ngraph TD A[ç”¨æˆ·è¾“å…¥é—®é¢˜] --\u003e B[LLMèŠ‚ç‚¹æ¥æ”¶] B --\u003e C{LLMåˆ†ææ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·} C --\u003e|éœ€è¦è°ƒç”¨| D[FCParam å·¥å…·é…ç½®] C --\u003e|ä¸éœ€è¦| E[ç›´æ¥ç”Ÿæˆå›ç­”] D --\u003e F[WorkflowFCParamå­å·¥ä½œæµè°ƒç”¨] D --\u003e G[PluginFCParamæ’ä»¶APIè°ƒç”¨] D --\u003e H[KnowledgeFCParamçŸ¥è¯†åº“æ£€ç´¢] F --\u003e F1[é…ç½®å¯è°ƒç”¨çš„å­å·¥ä½œæµåˆ—è¡¨] F --\u003e F2[å®šä¹‰è¯·æ±‚/å“åº”å‚æ•°] F --\u003e F3[æ‰§è¡Œå­å·¥ä½œæµ] G --\u003e G1[é…ç½®å¯è°ƒç”¨çš„æ’ä»¶APIåˆ—è¡¨] G --\u003e G2[å®šä¹‰APIå‚æ•°å’Œå“åº”æ ¼å¼] G --\u003e G3[è°ƒç”¨ç¬¬ä¸‰æ–¹æ’ä»¶æœåŠ¡] H --\u003e H1[é…ç½®çŸ¥è¯†åº“åˆ—è¡¨] H --\u003e H2[è®¾ç½®æ£€ç´¢ç­–ç•¥TopK/MinScore/æœç´¢æ¨¡å¼] H --\u003e H3[æ‰§è¡ŒçŸ¥è¯†åº“æ£€ç´¢] F3 --\u003e I[å·¥å…·æ‰§è¡Œç»“æœ] G3 --\u003e I H3 --\u003e I I --\u003e J[LLMæ•´åˆå·¥å…·ç»“æœ] J --\u003e K[ç”Ÿæˆæœ€ç»ˆå›ç­”] E --\u003e K K --\u003e L[è¿”å›ç»™ç”¨æˆ·] style A fill:#e1f5fe style D fill:#fff3e0 style F fill:#f3e5f5 style G fill:#e8f5e8 style H fill:#fce4ec style K fill:#e0f2f1 å‡½æ•°è°ƒç”¨å‚æ•°Â FcParamä¸»è¦åŒ…å«ä¸‰ç§æ¨¡å¼ï¼šå­å·¥ä½œæµè°ƒç”¨ã€æ’ä»¶APIè°ƒç”¨ã€çŸ¥è¯†åº“æ£€ç´¢\n// FCParam å‡½æ•°è°ƒç”¨å‚æ•°é…ç½® // ç”¨äºé…ç½®å·¥ä½œæµä¸­ä¸åŒç±»å‹çš„å‡½æ•°è°ƒç”¨èƒ½åŠ›ï¼ŒåŒ…æ‹¬å­å·¥ä½œæµè°ƒç”¨ã€æ’ä»¶APIè°ƒç”¨å’ŒçŸ¥è¯†åº“æ£€ç´¢è°ƒç”¨ type FCParam struct { // WorkflowFCParam å·¥ä½œæµå‡½æ•°è°ƒç”¨å‚æ•°é…ç½® // é…ç½®å½“å‰å·¥ä½œæµå¯ä»¥è°ƒç”¨çš„å­å·¥ä½œæµåˆ—è¡¨åŠå…¶å‚æ•°è®¾ç½® WorkflowFCParam *struct { // WorkflowList å¯è°ƒç”¨çš„å·¥ä½œæµåˆ—è¡¨ // æ¯ä¸ªå·¥ä½œæµé¡¹åŒ…å«å·¥ä½œæµæ ‡è¯†ã€ç‰ˆæœ¬ä¿¡æ¯å’Œå‡½æ•°è°ƒç”¨è®¾ç½® WorkflowList []struct { // WorkflowID å·¥ä½œæµå”¯ä¸€æ ‡è¯†ç¬¦ WorkflowID string `json:\"workflow_id\"` // WorkflowVersion å·¥ä½œæµç‰ˆæœ¬å· WorkflowVersion string `json:\"workflow_version\"` // PluginID å…³è”çš„æ’ä»¶IDï¼ˆå¦‚æœå·¥ä½œæµåŸºäºæ’ä»¶ï¼‰ PluginID string `json:\"plugin_id\"` // PluginVersion æ’ä»¶ç‰ˆæœ¬å· PluginVersion string `json:\"plugin_version\"` // IsDraft æ˜¯å¦ä¸ºè‰ç¨¿ç‰ˆæœ¬ IsDraft bool `json:\"is_draft\"` // FCSetting å‡½æ•°è°ƒç”¨è®¾ç½® // å®šä¹‰è°ƒç”¨è¯¥å·¥ä½œæµæ—¶çš„è¯·æ±‚å’Œå“åº”å‚æ•°ç»“æ„ FCSetting *struct { // RequestParameters è¯·æ±‚å‚æ•°åˆ—è¡¨ // å®šä¹‰è°ƒç”¨å·¥ä½œæµæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•° RequestParameters []*workflow.APIParameter `json:\"request_params\"` // ResponseParameters å“åº”å‚æ•°åˆ—è¡¨ // å®šä¹‰å·¥ä½œæµæ‰§è¡Œå®Œæˆåè¿”å›çš„å‚æ•° ResponseParameters []*workflow.APIParameter `json:\"response_params\"` } `json:\"fc_setting,omitempty\"` } `json:\"workflowList,omitempty\"` } `json:\"workflowFCParam,omitempty\"` // PluginFCParam æ’ä»¶å‡½æ•°è°ƒç”¨å‚æ•°é…ç½® // é…ç½®å½“å‰å·¥ä½œæµå¯ä»¥è°ƒç”¨çš„æ’ä»¶APIåˆ—è¡¨åŠå…¶å‚æ•°è®¾ç½® PluginFCParam *struct { // PluginList å¯è°ƒç”¨çš„æ’ä»¶åˆ—è¡¨ // æ¯ä¸ªæ’ä»¶é¡¹åŒ…å«æ’ä»¶æ ‡è¯†ã€APIä¿¡æ¯å’Œå‡½æ•°è°ƒç”¨è®¾ç½® PluginList []struct { // PluginID æ’ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ PluginID string `json:\"plugin_id\"` // ApiId APIæ¥å£å”¯ä¸€æ ‡è¯†ç¬¦ ApiId string `json:\"api_id\"` // ApiName APIæ¥å£åç§° ApiName string `json:\"api_name\"` // PluginVersion æ’ä»¶ç‰ˆæœ¬å· PluginVersion string `json:\"plugin_version\"` // IsDraft æ˜¯å¦ä¸ºè‰ç¨¿ç‰ˆæœ¬ IsDraft bool `json:\"is_draft\"` // FCSetting å‡½æ•°è°ƒç”¨è®¾ç½® // å®šä¹‰è°ƒç”¨è¯¥æ’ä»¶APIæ—¶çš„è¯·æ±‚å’Œå“åº”å‚æ•°ç»“æ„ FCSetting *struct { // RequestParameters è¯·æ±‚å‚æ•°åˆ—è¡¨ // å®šä¹‰è°ƒç”¨æ’ä»¶APIæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•° RequestParameters []*workflow.APIParameter `json:\"request_params\"` // ResponseParameters å“åº”å‚æ•°åˆ—è¡¨ // å®šä¹‰æ’ä»¶APIæ‰§è¡Œå®Œæˆåè¿”å›çš„å‚æ•° ResponseParameters []*workflow.APIParameter `json:\"response_params\"` } `json:\"fc_setting,omitempty\"` } } `json:\"pluginFCParam,omitempty\"` // KnowledgeFCParam çŸ¥è¯†åº“å‡½æ•°è°ƒç”¨å‚æ•°é…ç½® // é…ç½®å½“å‰å·¥ä½œæµçš„çŸ¥è¯†åº“æ£€ç´¢åŠŸèƒ½åŠå…¶å…¨å±€è®¾ç½® KnowledgeFCParam *struct { // GlobalSetting çŸ¥è¯†åº“æ£€ç´¢å…¨å±€è®¾ç½® // å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢çš„é€šç”¨é…ç½®å‚æ•° GlobalSetting *struct { // SearchMode æœç´¢æ¨¡å¼ // å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢ä½¿ç”¨çš„æœç´¢ç®—æ³•æ¨¡å¼ SearchMode int64 `json:\"search_mode\"` // TopK è¿”å›ç»“æœæ•°é‡ // å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢è¿”å›çš„æœ€å¤§ç»“æœæ•°é‡ TopK int64 `json:\"top_k\"` // MinScore æœ€å°ç›¸ä¼¼åº¦åˆ†æ•° // å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢ç»“æœçš„æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ MinScore float64 `json:\"min_score\"` // UseNL2SQL æ˜¯å¦å¯ç”¨è‡ªç„¶è¯­è¨€è½¬SQLåŠŸèƒ½ UseNL2SQL bool `json:\"use_nl2_sql\"` // UseRewrite æ˜¯å¦å¯ç”¨æŸ¥è¯¢é‡å†™åŠŸèƒ½ UseRewrite bool `json:\"use_rewrite\"` // UseRerank æ˜¯å¦å¯ç”¨ç»“æœé‡æ’åºåŠŸèƒ½ UseRerank bool `json:\"use_rerank\"` // NoRecallReplyCustomizePrompt æ— å¬å›ç»“æœæ—¶çš„è‡ªå®šä¹‰å›å¤æç¤ºè¯ NoRecallReplyCustomizePrompt string `json:\"no_recall_reply_customize_prompt\"` // NoRecallReplyMode æ— å¬å›ç»“æœæ—¶çš„å›å¤æ¨¡å¼ NoRecallReplyMode int64 `json:\"no_recall_reply_mode\"` } `json:\"global_setting,omitempty\"` // KnowledgeList å¯æ£€ç´¢çš„çŸ¥è¯†åº“åˆ—è¡¨ // å®šä¹‰å½“å‰å·¥ä½œæµå¯ä»¥æ£€ç´¢çš„çŸ¥è¯†åº“é›†åˆ KnowledgeList []*struct { // ID çŸ¥è¯†åº“å”¯ä¸€æ ‡è¯†ç¬¦ ID string `json:\"id\"` } `json:\"knowledgeList,omitempty\"` } `json:\"knowledgeFCParam,omitempty\"` } å­å·¥ä½œæµè°ƒç”¨ { \"workflowFCParam\": { \"workflowList\": [ { \"workflow_id\": \"7509120431183544356\", \"workflow_version\": \"v0.0.1\", \"plugin_id\": \"7509121334769795126\", \"is_draft\": false, \"fc_setting\": { \"request_params\": [...], // è°ƒç”¨å‚æ•° \"response_params\": [...] // è¿”å›å‚æ•° } } ] } } æ’ä»¶APIè°ƒç”¨ { \"pluginFCParam\": { \"pluginList\": [ { \"plugin_id\": \"7509353177339133952\", \"api_id\": \"7509353598782816256\", \"api_name\": \"å‘¨å…¬è§£æ¢¦\", \"plugin_version\": \"0\", \"fc_setting\": { \"request_params\": [ { \"name\": \"title\", \"desc\": \"æŸ¥è¯¢è§£æ¢¦æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šæ¢¦è§è›‡\", \"type\": 1, \"is_required\": true } ], \"response_params\": [...] } } ] } } çŸ¥è¯†åº“æ£€ç´¢ { \"knowledgeFCParam\": { \"knowledgeList\": [ { \"id\": \"7512369185624686592\", \"name\": \"æ—…æ¸¸æ™¯ç‚¹\" } ], \"global_setting\": { \"top_k\": 3, // \"min_score\": 0.5, \"search_mode\": 0, \"use_rerank\": true, \"use_rewrite\": true, \"use_nl2_sql\": true, \"no_recall_reply_mode\": 0, \"no_recall_reply_customize_prompt\": \"æŠ±æ­‰ï¼Œæ‚¨çš„é—®é¢˜è¶…å‡ºäº†æˆ‘çš„çŸ¥è¯†èŒƒå›´\" } } 1.1.4Â BlockInputç»“æ„ BlockInputæ˜¯å·¥ä½œæµç³»ç»Ÿä¸­çš„æ•°æ®ç»‘å®šæ ¸å¿ƒï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼šå¦‚ä½•åœ¨å·¥ä½œæµèŠ‚ç‚¹ä¹‹é—´ä¼ é€’å’Œé…ç½®æ•°æ®ã€‚BlockInputÂ =Â \"è¿™ä¸ªè¾“å…¥æ¡†é‡Œæ”¾ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œæ¥\"\ngraph TD A[BlockInput å—è¾“å…¥é…ç½®] --\u003e B[Type: æ•°æ®ç±»å‹] A --\u003e C[AssistType: è¾…åŠ©ç±»å‹] A --\u003e D[Schema: ç»“æ„å®šä¹‰] A --\u003e E[Value: è¾“å…¥å€¼é…ç½®] E --\u003e F[BlockInputValue] F --\u003e G[Type: å€¼ç±»å‹] F --\u003e H[Content: å…·ä½“å†…å®¹] F --\u003e I[RawMeta: å…ƒæ•°æ®] G --\u003e G1[literal: å­—é¢å€¼] G --\u003e G2[ref: èŠ‚ç‚¹å¼•ç”¨] G --\u003e G3[object_ref: å¯¹è±¡å¼•ç”¨] H --\u003e H1[é™æ€æ–‡æœ¬/æ•°å€¼] H --\u003e H2[BlockInputReference] H2 --\u003e J[BlockID: æºèŠ‚ç‚¹ID] H2 --\u003e K[Name: å­—æ®µåç§°] H2 --\u003e L[Path: è®¿é—®è·¯å¾„] H2 --\u003e M[Source: å¼•ç”¨æºç±»å‹] M --\u003e M1[block-output: èŠ‚ç‚¹è¾“å‡º] M --\u003e M2[global_variable_app: åº”ç”¨å˜é‡] M --\u003e M3[global_variable_system: ç³»ç»Ÿå˜é‡] M --\u003e M4[global_variable_user: ç”¨æˆ·å˜é‡] N[å®é™…ä½¿ç”¨åœºæ™¯] --\u003e N1[é™æ€é…ç½®: å›ºå®šå€¼] N --\u003e N2[åŠ¨æ€ç»‘å®š: å¼•ç”¨å…¶ä»–èŠ‚ç‚¹] N --\u003e N3[æ¨¡æ¿æ¸²æŸ“: å˜é‡æ›¿æ¢] N --\u003e N4[å¤æ‚å¯¹è±¡: åµŒå¥—ç»“æ„] style A fill:#e1f5fe style F fill:#fff3e0 style H2 fill:#f3e5f5 style N fill:#e8f5e8 BlockInputç»“æ„å¦‚ä¸‹æ‰€ç¤º\ntype BlockInput struct { Type VariableType // æ•°æ®ç±»å‹ï¼šstringã€numberã€objectç­‰ AssistType AssistType // è¾…åŠ©ç±»å‹ï¼šæ›´å…·ä½“çš„ç±»å‹æè¿° Schema any // ç»“æ„å®šä¹‰ï¼šå¤æ‚å¯¹è±¡çš„å†…éƒ¨ç»“æ„ Value *BlockInputValue // å€¼é…ç½®ï¼šå…·ä½“çš„æ•°æ®æ¥æº } ä¸‰ç§æ•°æ®æµæ¥æºï¼šå¸¸é‡literalã€èŠ‚ç‚¹å¼•ç”¨refã€å¯¹è±¡å¼•ç”¨Â ObjectÂ Ref\nå¸¸é‡literal { \"type\": \"string\", \"value\": { \"type\": \"literal\", \"content\": \"Hello World\", \"rawMeta\": {\"type\": 1} } } èŠ‚ç‚¹å¼•ç”¨refÂ (æœ€å¸¸ç”¨çš„) { \"type\": \"string\", \"value\": { \"type\": \"ref\", \"content\": { \"blockID\": \"100001\", \"name\": \"output\", \"source\": \"block-output\" } } } å¯¹è±¡å¼•ç”¨ { \"type\": \"object\", \"schema\": [{\"name\": \"name\", \"type\": \"string\"}], \"value\": { \"type\": \"object_ref\", \"content\": { \"blockID\": \"100001\", \"name\": \"person\", \"source\": \"block-output\" } } } 1.1.5Â çŸ¥è¯†åº“èŠ‚ç‚¹Â (RAG) RAGå®Œæ•´æµç¨‹å›¾ ä¸€ä¸ªå®Œæ•´çš„RAGæµç¨‹å¦‚ä¸‹ï¼š\næŸ¥è¯¢é‡å†™ä¼˜åŒ–Â ï¼ˆå°æ¨¡å‹ï¼‰-\u003eÂ è‡ªç„¶è¯­è¨€è½¬SQLÂ ï¼ˆNL2SQLï¼‰-\u003eÂ å‘é‡æ£€ç´¢Â (è¯­ä¹‰æœç´¢/æ··åˆæœç´¢/å…¨é‡æœç´¢)Â -\u003eÂ ç›¸ä¼¼åº¦è¿‡æ»¤Â (æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼)Â -\u003eÂ ç»“æœé‡æ’åºÂ (Rerank)Â -\u003eÂ TopKç»“æœæˆªå–Â -\u003eÂ æ„å»ºæ–°çš„ä¸Šä¸‹æ–‡æç¤ºè¯\ngraph LR A[ç”¨æˆ·è¾“å…¥æŸ¥è¯¢] --\u003e B[æŸ¥è¯¢é¢„å¤„ç†] B --\u003e B1[UseRewrite: æŸ¥è¯¢é‡å†™] B1 --\u003e B2[ä¼˜åŒ–æŸ¥è¯¢è¯­ä¹‰] B2 --\u003e B3[UseNL2SQL: è‡ªç„¶è¯­è¨€è½¬SQL] B3 --\u003e C[å‘é‡æ£€ç´¢é˜¶æ®µ] C --\u003e C1[æ–‡æ¡£å‘é‡åŒ–] C --\u003e C2[æŸ¥è¯¢å‘é‡åŒ–] C1 --\u003e C3[å‘é‡ç›¸ä¼¼åº¦è®¡ç®—] C2 --\u003e C3 C3 --\u003e D[SearchMode: æœç´¢ç­–ç•¥] D --\u003e D1[0: è¯­ä¹‰æœç´¢Semantic Search] D --\u003e D2[1: æ··åˆæœç´¢Hybrid Search] D --\u003e D3[20: å…¨æ–‡æœç´¢Full-text Search] D1 --\u003e E[åˆæ­¥ç»“æœç­›é€‰] D2 --\u003e E D3 --\u003e E E --\u003e E1[MinScore: ç›¸ä¼¼åº¦è¿‡æ»¤] E1 --\u003e E2[è¿‡æ»¤ä½è´¨é‡ç»“æœ] E2 --\u003e F[UseRerank: ç»“æœé‡æ’åº] F --\u003e F1[æ·±åº¦è¯­ä¹‰åŒ¹é…] F1 --\u003e F2[é‡æ–°æ’åºç»“æœ] F2 --\u003e G[TopK: ç»“æœæˆªå–] G --\u003e G1[é€‰æ‹©å‰Kä¸ªæœ€ä½³ç»“æœ] G1 --\u003e H{æ˜¯å¦æœ‰åˆé€‚ç»“æœ?} H --\u003e|æœ‰| I[æ„å»ºå¢å¼ºä¸Šä¸‹æ–‡] H --\u003e|æ— | J[NoRecallReplyModeå¤„ç†] J --\u003e J1[0: ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯] J --\u003e J2[1: å…¶ä»–å¤„ç†æ¨¡å¼] J1 --\u003e K[è¿”å›æ— ç»“æœå›å¤] J2 --\u003e K I --\u003e L[RAGç”Ÿæˆé˜¶æ®µ] L --\u003e L1[ç»„åˆæŸ¥è¯¢+æ£€ç´¢å†…å®¹] L1 --\u003e L2[LLMç”Ÿæˆå¢å¼ºå›ç­”] L2 --\u003e M[è¿”å›æœ€ç»ˆç­”æ¡ˆ] K --\u003e M style A fill:#e1f5fe style B fill:#fff3e0 style C fill:#f3e5f5 style D fill:#e8f5e8 style F fill:#fce4ec style L fill:#e0f2f1 å‘é‡æ£€ç´¢è§„åˆ™ graph TD A[ç”¨æˆ·æŸ¥è¯¢] --\u003e B{SearchModeé€‰æ‹©} B --\u003e|0: è¯­ä¹‰æœç´¢| C[Semantic Search] B --\u003e|1: æ··åˆæœç´¢| D[Hybrid Search] B --\u003e|20: å…¨æ–‡æœç´¢| E[Full-text Search] C --\u003e C1[Step1: æŸ¥è¯¢å‘é‡åŒ–] C1 --\u003e C2[Embedding Model] C2 --\u003e C3[Query Vector] C3 --\u003e C4[Step2: æ–‡æ¡£å‘é‡åŒ¹é…] C4 --\u003e C5[å‘é‡æ•°æ®åº“] C5 --\u003e C6[ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—] D --\u003e D1[Step1: å‘é‡æœç´¢è·¯å¾„] D --\u003e D2[Step2: å…³é”®è¯æœç´¢è·¯å¾„] D1 --\u003e D3[Embeddingæ£€ç´¢] D2 --\u003e D4[BM25ç®—æ³•] D3 --\u003e D5[ç»“æœèåˆç®—æ³•] D4 --\u003e D5 E --\u003e E1[Step1: åˆ†è¯å¤„ç†] E1 --\u003e E2[åˆ†è¯å™¨] E2 --\u003e E3[Step2: å€’æ’ç´¢å¼•] E3 --\u003e E4[æœç´¢å¼•æ“] E4 --\u003e E5[TF-IDFè¯„åˆ†] C6 --\u003e F[è¯­ä¹‰ç†è§£å¼º] D5 --\u003e G[å¹³è¡¡ç²¾ç¡®æ€§å’Œè¯­ä¹‰] E5 --\u003e H[å…³é”®è¯ç²¾ç¡®åŒ¹é…] F --\u003e I[æœ€ç»ˆæ£€ç´¢ç»“æœ] G --\u003e I H --\u003e I style C fill:#e1f5fe style D fill:#fff3e0 style E fill:#f3e5f5 style I fill:#e8f5e8 è¯­ä¹‰æœç´¢Â ï¼ˆå‡†ï¼‰:Â ä½¿ç”¨Â EmbeddingÂ æ¨¡å‹è®¡ç®—å‘é‡ç›¸ä¼¼åº¦ï¼Œç†è§£æ·±å±‚è¯­ä¹‰ï¼Œå¤„ç†åŒä¹‰è¯å’Œæ¦‚å¿µåŒ¹é…ã€‚\næ··åˆæœç´¢Â ï¼ˆå…¨é¢ï¼‰:Â ç»“åˆå‘é‡æœç´¢Â +Â BM25Â å…³é”®è¯æœç´¢ï¼Œå¹³è¡¡è¯­ä¹‰ç†è§£å’Œç²¾ç¡®åŒ¹é…ã€‚\nå…¨æ–‡æœç´¢Â ï¼ˆå¿«ï¼‰:Â ä¼ ç»Ÿçš„å€’æ’ç´¢å¼•å’ŒTF-IDFï¼Œç²¾ç¡®çš„å…³é”®è¯åŒ¹é…ï¼Œé€Ÿåº¦å¿«\nã€ç®—æ³•è¯´æ˜ã€‘\nEmbeddingå‘é‡æ£€ç´¢ï¼šå°†æ–‡æœ¬é€šè¿‡ç¼–ç å™¨è½¬ä¸ºå‘é‡å’ŒDBä¸­çš„å‘é‡è®¡ç®—cosç›¸ä¼¼åº¦æœ€åè¿”å›TopKçš„ç»“æœ graph TD A[æ–‡æœ¬è¾“å…¥] --\u003e B[Embeddingæ£€ç´¢æµç¨‹] B --\u003e C[ç¬¬ä¸€é˜¶æ®µ: å‘é‡åŒ–] C --\u003e C1[åˆ†è¯å’Œé¢„å¤„ç†] C1 --\u003e C2[Transformerç¼–ç å™¨] C2 --\u003e C3[æ± åŒ–æ“ä½œ] C3 --\u003e C4[å½’ä¸€åŒ–å¤„ç†] C4 --\u003e C5[ç”Ÿæˆå‘é‡è¡¨ç¤º] B --\u003e D[ç¬¬äºŒé˜¶æ®µ: ç´¢å¼•æ„å»º] D --\u003e D1[å‘é‡ç»´åº¦ä¼˜åŒ–] D1 --\u003e D2[ç´¢å¼•ç»“æ„é€‰æ‹©] D2 --\u003e D3[HNSW/IVF/LSH] D3 --\u003e D4[åˆ†å¸ƒå¼å­˜å‚¨] B --\u003e E[ç¬¬ä¸‰é˜¶æ®µ: ç›¸ä¼¼åº¦æ£€ç´¢] E --\u003e E1[æŸ¥è¯¢å‘é‡åŒ–] E1 --\u003e E2[è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢] E2 --\u003e E3[ç›¸ä¼¼åº¦è®¡ç®—] E3 --\u003e E4[TopKç»“æœè¿”å›] F[æŠ€æœ¯æ ˆ] --\u003e F1[æ¨¡å‹: BERT/Sentence-BERT] F --\u003e F2[å‘é‡DB: Pinecone/Milvus/ElasticSearch] F --\u003e F3[ç›¸ä¼¼åº¦: ä½™å¼¦/ç‚¹ç§¯/æ¬§æ°] F --\u003e F4[ç´¢å¼•: HNSW/IVF] style C fill:#e1f5fe style D fill:#fff3e0 style E fill:#f3e5f5 style F fill:#e8f5e8 å€’æ’ç´¢å¼•ï¼šå°†æ–‡æ¡£åˆ‡åˆ†æˆç‹¬ç«‹çš„è¯æ±‡å•å…ƒï¼Œå»ºç«‹ä»è¯æ±‡åˆ°æ–‡æ¡£çš„æ˜ å°„ç´¢å¼•\nTF-IDFÂ (è¯é¢‘-é€†æ–‡æ¡£é¢‘ç‡)ï¼šTFï¼ˆè¯é¢‘ï¼‰ï¼šÂ è®¡ç®—ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„è¯æ¬¡æ•°ï¼ŒÂ ç”¨äºè¡¡é‡è¯æ±‡çš„é‡è¦æ€§ã€‚IDFÂ ï¼ˆé€†æ–‡æ¡£é¢‘ç‡ï¼‰ï¼šè¡¡é‡è¯æ±‡åœ¨æ•´ä¸ªè¯­æ–™åº“ä¸­çš„é‡è¦æ€§ã€‚Â TF(t,d) = è¯æ±‡tåœ¨æ–‡æ¡£dä¸­å‡ºç°çš„æ¬¡æ•° / æ–‡æ¡£dçš„æ€»è¯æ•° IDF(t) = log(æ–‡æ¡£æ€»æ•° / åŒ…å«è¯æ±‡tçš„æ–‡æ¡£æ•°) TF-IDF = sigmoid (TF(t,d) * IDF(t)) ç¼ºç‚¹ï¼šä¸èƒ½è€ƒè™‘è¯æ±‡çš„ä½ç½®ï¼Œå¿½ç•¥äº†è¯æ±‡çš„ç›¸å…³æ€§ï¼›ä¸åˆ©äºç¨€ç–æ€§Â ï¼ˆçŸ­æ–‡æ¡£å¾ˆå¤šè¯æ±‡Â TF-IDF=0ï¼‰\nBM25Â ç®—æ³•ï¼šåœ¨Â TF-IDFÂ (è¯é¢‘-é€†æ–‡æ¡£é¢‘ç‡)Â åŸºç¡€ä¸Šï¼Œè§£å†³äº†è¯é¢‘é¥±å’Œé—®é¢˜å’Œæ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–é—®é¢˜ã€‚ ReRankÂ è§„åˆ™ Rerankå°±æ˜¯æ ¹æ®å¤šä¸ªæ£€ç´¢æ–¹å¼å¾—åˆ°çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œç„¶åæ ¹æ®RRFç®—æ³•é‡æ–°æ’åºçš„è¿‡ç¨‹\nRRF: score = 1/(rank + k) # é»˜è®¤ k = 60 rerankæ¨¡å‹çš„æ—¶åºå›¾\nsequenceDiagram participant User as ç”¨æˆ· participant RS as æ£€ç´¢æœåŠ¡RetrieveService participant QR as æŸ¥è¯¢é‡å†™QueryRewriter participant VS as å‘é‡æ£€ç´¢VectorStore participant ES as å…¨æ–‡æ£€ç´¢ElasticSearch participant NL as NL2SQLæ£€ç´¢NL2SQLEngine participant RK as é‡æ’åºå™¨Reranker participant API as Rerank APIVikingDB Note over User, API: 1. åˆå§‹åŒ–æ£€ç´¢è¯·æ±‚ User-\u003e\u003eRS: å‘èµ·æ£€ç´¢è¯·æ±‚(query, knowledgeIDs, strategy) RS-\u003e\u003eRS: æ„å»ºæ£€ç´¢ä¸Šä¸‹æ–‡(RetrieveContext) Note over User, API: 2. æŸ¥è¯¢é‡å†™ (å¯é€‰) alt å¯ç”¨æŸ¥è¯¢é‡å†™ \u0026\u0026 æœ‰å¯¹è¯å†å² RS-\u003e\u003eQR: åŸºäºå¯¹è¯å†å²é‡å†™æŸ¥è¯¢ QR--\u003e\u003eRS: è¿”å›é‡å†™åçš„æŸ¥è¯¢ end Note over User, API: 3. å¹¶è¡Œå¤šé€šé“æ£€ç´¢ par å‘é‡æ£€ç´¢ alt è¯­ä¹‰æ£€ç´¢ || æ··åˆæ£€ç´¢ RS-\u003e\u003eVS: å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ VS-\u003e\u003eVS: 1. æŸ¥è¯¢æ–‡æœ¬å‘é‡åŒ– VS-\u003e\u003eVS: 2. è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ VS-\u003e\u003eVS: 3. è¿”å›TopKç›¸ä¼¼æ–‡æ¡£ VS--\u003e\u003eRS: å‘é‡æ£€ç´¢ç»“æœ(score: 0.0-1.0) end and å…¨æ–‡æ£€ç´¢ alt å…¨æ–‡æ£€ç´¢ || æ··åˆæ£€ç´¢ RS-\u003e\u003eES: å…³é”®è¯åŒ¹é…æ£€ç´¢ ES-\u003e\u003eES: 1. åˆ†è¯å’Œç´¢å¼•åŒ¹é… ES-\u003e\u003eES: 2. è®¡ç®—BM25åˆ†æ•° ES-\u003e\u003eES: 3. è¿”å›åŒ¹é…æ–‡æ¡£ ES--\u003e\u003eRS: ESæ£€ç´¢ç»“æœ(score: BM25) end and NL2SQLæ£€ç´¢ alt å¯ç”¨NL2SQL RS-\u003e\u003eNL: è‡ªç„¶è¯­è¨€è½¬SQLæŸ¥è¯¢ NL-\u003e\u003eNL: 1. è§£ææŸ¥è¯¢æ„å›¾ NL-\u003e\u003eNL: 2. ç”ŸæˆSQLè¯­å¥ NL-\u003e\u003eNL: 3. æ‰§è¡Œç»“æ„åŒ–æŸ¥è¯¢ NL--\u003e\u003eRS: NL2SQLç»“æœ(score: ç›¸å…³æ€§åˆ†æ•°) end end Note over User, API: 4. Reranké‡æ’åº RS-\u003e\u003eRS: æ•´åˆå¤šé€šé“æ£€ç´¢ç»“æœ Note right of RS: æ ¹æ®æ£€ç´¢ç­–ç•¥æ”¶é›†ç»“æœ:- SearchTypeSemantic: ä»…å‘é‡ç»“æœ- SearchTypeFullText: ä»…ESç»“æœ- SearchTypeHybrid: å‘é‡+ESç»“æœ- å¦‚å¯ç”¨NL2SQL: é¢å¤–æ·»åŠ NL2SQLç»“æœ RS-\u003e\u003eRK: è°ƒç”¨RerankæœåŠ¡ Note right of RK: ä¼ å…¥å‚æ•°:- Query: åŸå§‹æŸ¥è¯¢æˆ–é‡å†™åæŸ¥è¯¢- Data: å¤šé€šé“æ£€ç´¢ç»“æœæ•°ç»„- TopN: æœ€ç»ˆè¿”å›æ•°é‡ alt VikingDB Reranker (æ·±åº¦å­¦ä¹ æ¨¡å‹) RK-\u003e\u003eRK: 1. æ‰å¹³åŒ–æ‰€æœ‰æ£€ç´¢ç»“æœ RK-\u003e\u003eRK: 2. æ„é€ rerankè¯·æ±‚{query, content, title} RK-\u003e\u003eAPI: HTTP POSTè¯·æ±‚/api/knowledge/service/rerank API-\u003e\u003eAPI: 1. ä½¿ç”¨base-multilingual-rerankæ¨¡å‹ API-\u003e\u003eAPI: 2. è®¡ç®—query-documentç›¸å…³æ€§åˆ†æ•° API--\u003e\u003eRK: è¿”å›æ¯ä¸ªæ–‡æ¡£çš„æ–°åˆ†æ•°{scores: [0.8, 0.6, 0.9, ...]} RK-\u003e\u003eRK: 3. æŒ‰æ–°åˆ†æ•°é™åºæ’åº RK-\u003e\u003eRK: 4. æˆªå–TopNç»“æœ else RRF Reranker (æ’åèåˆç®—æ³•) RK-\u003e\u003eRK: 1. ä¸ºæ¯ä¸ªé€šé“çš„ç»“æœæŒ‰æ’åè®¡ç®—åˆ†æ•° Note right of RK: RRFå…¬å¼: score = 1/(rank + k)å…¶ä¸­k=60ä¸ºé»˜è®¤å‚æ•° RK-\u003e\u003eRK: 2. åŒä¸€æ–‡æ¡£å–æœ€é«˜åˆ†æ•° RK-\u003e\u003eRK: 3. æŒ‰åˆ†æ•°é™åºæ’åº RK-\u003e\u003eRK: 4. æˆªå–TopNç»“æœ end RK--\u003e\u003eRS: è¿”å›é‡æ’åºç»“æœ{sortedData, tokenUsage} Note over User, API: 5. ç»“æœè¿‡æ»¤ä¸å°è£… RS-\u003e\u003eRS: 1. åº”ç”¨æœ€å°åˆ†æ•°é˜ˆå€¼è¿‡æ»¤(score \u003c minScoreçš„æ–‡æ¡£è¢«ç§»é™¤) RS-\u003e\u003eRS: 2. æ›´æ–°æ–‡æ¡£åˆ†æ•°ä¸ºrerankåˆ†æ•° RS-\u003e\u003eRS: 3. å°è£…æœ€ç»ˆæ£€ç´¢ç»“æœ RS--\u003e\u003eUser: è¿”å›æœ€ç»ˆæ£€ç´¢ç»“æœ(æŒ‰ç›¸å…³æ€§æ’åºçš„æ–‡æ¡£åˆ—è¡¨) çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„ // Knowledge çŸ¥è¯†åº“èŠ‚ç‚¹é…ç½® // ç”¨äºé…ç½®ç‹¬ç«‹çš„çŸ¥è¯†åº“æ£€ç´¢èŠ‚ç‚¹ï¼Œå®šä¹‰æ•°æ®æºå‚æ•°å’Œå¤„ç†ç­–ç•¥ // ä¸LLMèŠ‚ç‚¹ä¸­çš„KnowledgeFCParamä¸åŒï¼Œè¿™æ˜¯ä¸“é—¨çš„çŸ¥è¯†åº“æ£€ç´¢æ­¥éª¤ type Knowledge struct { // DatasetParam æ•°æ®é›†å‚æ•°é…ç½® // å®šä¹‰çŸ¥è¯†åº“çš„æ•°æ®æºé…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯ // æ¯ä¸ªParamåŒ…å«å…·ä½“çš„æ•°æ®æºé…ç½®é¡¹ DatasetParam []*Param `json:\"datasetParam,omitempty\"` // StrategyParam çŸ¥è¯†åº“å¤„ç†ç­–ç•¥å‚æ•° // å®šä¹‰æ–‡æ¡£è§£æã€åˆ†å—ã€ç´¢å¼•ç­‰å„ä¸ªç¯èŠ‚çš„å¤„ç†ç­–ç•¥å’Œå‚æ•° StrategyParam StrategyParam `json:\"strategyParam,omitempty\"` } // StrategyParam çŸ¥è¯†åº“å¤„ç†ç­–ç•¥å‚æ•°é…ç½® // å®šä¹‰çŸ¥è¯†åº“ä»æ–‡æ¡£è§£æåˆ°å‘é‡ç´¢å¼•çš„å®Œæ•´å¤„ç†æµç¨‹ç­–ç•¥ type StrategyParam struct { // ParsingStrategy æ–‡æ¡£è§£æç­–ç•¥é…ç½® // å®šä¹‰å¦‚ä½•è§£æå’Œæå–ä¸åŒç±»å‹æ–‡æ¡£çš„å†…å®¹ ParsingStrategy struct { // ParsingType è§£æç±»å‹ // å®šä¹‰æ–‡æ¡£è§£æçš„æ–¹å¼ï¼Œå¦‚è‡ªåŠ¨è¯†åˆ«ã€æ‰‹åŠ¨æŒ‡å®šç­‰ // å¸¸è§å€¼ï¼šautoï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰ã€manualï¼ˆæ‰‹åŠ¨æŒ‡å®šï¼‰ã€customï¼ˆè‡ªå®šä¹‰ï¼‰ ParsingType string `json:\"parsingType,omitempty\"` // ImageExtraction æ˜¯å¦æå–å›¾ç‰‡ // æ§åˆ¶æ˜¯å¦ä»æ–‡æ¡£ä¸­æå–å›¾ç‰‡å†…å®¹è¿›è¡Œå¤„ç† // trueè¡¨ç¤ºæå–å›¾ç‰‡ï¼Œfalseè¡¨ç¤ºå¿½ç•¥å›¾ç‰‡å†…å®¹ ImageExtraction bool `json:\"imageExtraction\"` // TableExtraction æ˜¯å¦æå–è¡¨æ ¼ // æ§åˆ¶æ˜¯å¦ä»æ–‡æ¡£ä¸­æå–è¡¨æ ¼ç»“æ„å’Œæ•°æ® // trueè¡¨ç¤ºè§£æè¡¨æ ¼ç»“æ„ï¼Œfalseè¡¨ç¤ºå°†è¡¨æ ¼è§†ä¸ºæ™®é€šæ–‡æœ¬ TableExtraction bool `json:\"tableExtraction\"` // ImageOcr æ˜¯å¦å¯ç”¨å›¾ç‰‡OCRè¯†åˆ« // æ§åˆ¶æ˜¯å¦å¯¹æå–çš„å›¾ç‰‡è¿›è¡Œå…‰å­¦å­—ç¬¦è¯†åˆ« // trueè¡¨ç¤ºå¯¹å›¾ç‰‡è¿›è¡ŒOCRæ–‡å­—è¯†åˆ«ï¼Œfalseè¡¨ç¤ºå¿½ç•¥å›¾ç‰‡ä¸­çš„æ–‡å­— ImageOcr bool `json:\"imageOcr\"` } `json:\"parsingStrategy,omitempty\"` // ChunkStrategy æ–‡æ¡£åˆ†å—ç­–ç•¥é…ç½® // å®šä¹‰å¦‚ä½•å°†é•¿æ–‡æ¡£åˆ‡åˆ†æˆé€‚åˆå‘é‡åŒ–çš„å°å— ChunkStrategy struct { // ChunkType åˆ†å—ç±»å‹ // å®šä¹‰æ–‡æ¡£åˆ†å—çš„ç­–ç•¥ç±»å‹ // å¸¸è§å€¼ï¼šfixedï¼ˆå›ºå®šé•¿åº¦ï¼‰ã€semanticï¼ˆè¯­ä¹‰åˆ†å—ï¼‰ã€sentenceï¼ˆå¥å­åˆ†å—ï¼‰ ChunkType string `json:\"chunkType,omitempty\"` // SeparatorType åˆ†éš”ç¬¦ç±»å‹ // å®šä¹‰ç”¨äºåˆ†å—çš„åˆ†éš”ç¬¦ç±»å‹ // å¸¸è§å€¼ï¼šautoï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼‰ã€newlineï¼ˆæ¢è¡Œç¬¦ï¼‰ã€paragraphï¼ˆæ®µè½ï¼‰ã€customï¼ˆè‡ªå®šä¹‰ï¼‰ SeparatorType string `json:\"separatorType,omitempty\"` // Separator è‡ªå®šä¹‰åˆ†éš”ç¬¦ // å½“SeparatorTypeä¸ºcustomæ—¶ï¼ŒæŒ‡å®šå…·ä½“çš„åˆ†éš”ç¬¦å­—ç¬¦ä¸² Separator string `json:\"separator,omitempty\"` // MaxToken æœ€å¤§ä»¤ç‰Œæ•° // å®šä¹‰æ¯ä¸ªæ–‡æ¡£å—çš„æœ€å¤§tokenæ•°é‡ï¼Œæ§åˆ¶å—çš„å¤§å° // é€šå¸¸è®¾ç½®ä¸ºæ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£å¤§å°ï¼Œå¦‚512ã€1024ç­‰ MaxToken int64 `json:\"maxToken,omitempty\"` // Overlap é‡å æ¯”ä¾‹ // å®šä¹‰ç›¸é‚»æ–‡æ¡£å—ä¹‹é—´çš„é‡å æ¯”ä¾‹ï¼Œé¿å…è¯­ä¹‰ä¿¡æ¯åœ¨è¾¹ç•Œå¤„ä¸¢å¤± // å–å€¼èŒƒå›´0.0-1.0ï¼Œå¸¸è§å€¼ä¸º0.1-0.2ï¼ˆ10%-20%é‡å ï¼‰ Overlap float64 `json:\"overlap,omitempty\"` } `json:\"chunkStrategy,omitempty\"` // IndexStrategy ç´¢å¼•ç­–ç•¥é…ç½® // å®šä¹‰å‘é‡ç´¢å¼•çš„æ„å»ºç­–ç•¥ï¼Œå¦‚ç´¢å¼•ç±»å‹ã€å‚æ•°ç­‰ // å…·ä½“ç»“æ„ä¾èµ–äºä½¿ç”¨çš„å‘é‡æ•°æ®åº“ç±»å‹ï¼ˆå¦‚HNSWã€IVFç­‰ï¼‰ IndexStrategy any `json:\"indexStrategy\"` } 1.2Â å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»ï¼Ÿå¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€ï¼Ÿ å‰ç«¯ä¼ å…¥ç”»å¸ƒçš„Â DSLè¯­è¨€ï¼ˆJSONï¼‰ç»™åç«¯ä¹‹åï¼Œä¼šè§£æä¸ºä¸Šæ–¹çš„åç«¯ç»“æ„ã€‚ç”»å¸ƒä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå˜æˆÂ canvas.goä¸­çš„Â Nodeç»“æ„ä½“ã€‚ä½†æ˜¯è½¬æ¢åçš„Â Nodeç»“æ„ä½“åªæ˜¯ä¸€ä¸ªå­˜å‚¨æ€ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œå·¥ä½œæµè¿˜éœ€è¦å°†Â Nodeç»“æ„ä½“ä»å­˜å‚¨æ€è½¬ä¸ºè¿è¡Œæ€ã€‚åç«¯Â schemaÂ çš„Â NodeSchemaç»“æ„ä½“å°±æ˜¯Â é’ˆå¯¹ç”¨äºè¡¨è¾¾å·¥ä½œæµçš„è¿è¡Œæ€çš„\n1.2.1Â è½¬æ¢æµç¨‹å›¾ graph TD A[Canvasç”»å¸ƒ] --\u003e B[CanvasToWorkflowSchema] B --\u003e C[ç§»é™¤å­¤ç«‹èŠ‚ç‚¹] C --\u003e D[éå†Canvas Nodes] D --\u003e E{èŠ‚ç‚¹ç±»å‹åˆ¤æ–­} E --\u003e|å­å·¥ä½œæµ| F[toSubWorkflowNodeSchema] E --\u003e|æ™®é€šèŠ‚ç‚¹| G[è·å–NodeAdaptor] G --\u003e H[è°ƒç”¨Adaptor.Adaptæ–¹æ³•] H --\u003e I{èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹?} I --\u003e|æ˜¯| J[é€’å½’è½¬æ¢å­èŠ‚ç‚¹] I --\u003e|å¦| K[è½¬æ¢è¾“å…¥è¾“å‡ºç±»å‹] J --\u003e L[è®¾ç½®å±‚æ¬¡å…³ç³»] L --\u003e K K --\u003e M[è®¾ç½®å¼‚å¸¸å¤„ç†é…ç½®] M --\u003e N[ç”ŸæˆNodeSchema] F --\u003e N N --\u003e O[æ”¶é›†æ‰€æœ‰NodeSchema] O --\u003e P[è½¬æ¢è¿æ¥è¾¹] P --\u003e Q[æ ‡å‡†åŒ–ç«¯å£] Q --\u003e R[æ„å»ºåˆ†æ”¯ä¿¡æ¯] R --\u003e S[WorkflowSchema] subgraph \"NodeAdaptorè½¬æ¢ç»†èŠ‚\" H1[è§£æèŠ‚ç‚¹é…ç½®] --\u003e H2[è½¬æ¢è¾“å…¥å‚æ•°] H2 --\u003e H3[è½¬æ¢è¾“å‡ºå®šä¹‰] H3 --\u003e H4[è®¾ç½®èŠ‚ç‚¹ç‰¹å®šConfig] H4 --\u003e H5[è°ƒç”¨SetInputsForNodeSchema] H5 --\u003e H6[è°ƒç”¨SetOutputTypesForNodeSchema] end H --\u003e H1 subgraph \"ç±»å‹è½¬æ¢ç»†èŠ‚\" T1[CanvasBlockInputToTypeInfo] --\u003e T2[è§£æåŸºç¡€ç±»å‹] T2 --\u003e T3[å¤„ç†å¤æ‚å¯¹è±¡ç±»å‹] T3 --\u003e T4[å¤„ç†æ•°ç»„ç±»å‹] T4 --\u003e T5[å¤„ç†æ–‡ä»¶ç±»å‹] T5 --\u003e T6[ç”ŸæˆTypeInfo] U1[CanvasBlockInputToFieldInfo] --\u003e U2[åˆ†ææ•°æ®æ¥æº] U2 --\u003e U3{æ¥æºç±»å‹} U3 --\u003e|é™æ€å€¼| U4[åˆ›å»ºLiteralFieldInfo] U3 --\u003e|èŠ‚ç‚¹å¼•ç”¨| U5[åˆ›å»ºReferenceFieldInfo] U3 --\u003e|æ¨¡æ¿å­—ç¬¦ä¸²| U6[åˆ›å»ºTemplateFieldInfo] U4 --\u003e U7[ç”ŸæˆFieldInfo] U5 --\u003e U7 U6 --\u003e U7 end K --\u003e T1 K --\u003e U1 style A fill:#e1f5fe style S fill:#c8e6c9 style H fill:#fff3e0 style N fill:#fce4ec 1.2.2Â è½¬æ¢åçš„NodeSchemaç»“æ„ // NodeSchema å·¥ä½œæµèŠ‚ç‚¹çš„ç»Ÿä¸€æè¿°å’Œé…ç½®ç»“æ„ // åŒ…å«å®ä¾‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ˜¯Canvas Nodeè½¬æ¢åçš„åç«¯æ‰§è¡Œç»“æ„ type NodeSchema struct { // Key èŠ‚ç‚¹åœ¨Einoå›¾ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ // èŠ‚ç‚¹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦è¿™ä¸ªä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š // - ä½¿ç”¨æ­¤KeyæŸ¥è¯¢å·¥ä½œæµçŠ¶æ€ä¸­å±äºå½“å‰èŠ‚ç‚¹çš„æ•°æ® Key vo.NodeKey `json:\"key\"` // Name èŠ‚ç‚¹åœ¨Canvasç”»å¸ƒä¸ŠæŒ‡å®šçš„æ˜¾ç¤ºåç§° // èŠ‚ç‚¹å¯èƒ½ä¼šåœ¨Canvasä¸Šæ˜¾ç¤ºè¿™ä¸ªåç§°ä½œä¸ºè¾“å…¥/è¾“å‡ºçš„ä¸€éƒ¨åˆ† Name string `json:\"name\"` // Type èŠ‚ç‚¹çš„ç±»å‹æ ‡è¯† // å¯¹åº”entity.NodeTypeæšä¸¾ï¼Œå†³å®šèŠ‚ç‚¹çš„å…·ä½“è¡Œä¸ºå’ŒåŠŸèƒ½ Type entity.NodeType `json:\"type\"` // Configs èŠ‚ç‚¹ç‰¹å®šçš„é…ç½®ä¿¡æ¯ // æ¯ä¸ªèŠ‚ç‚¹ç±»å‹å®šä¹‰è‡ªå·±çš„é…ç½®ç»“æ„ä½“ï¼Œä¸åŒ…å«å­—æ®µæ˜ å°„æˆ–é™æ€å€¼ä¿¡æ¯ // è¿™äº›é…ç½®æ˜¯èŠ‚ç‚¹å®ç°çš„å†…éƒ¨é…ç½®ï¼Œä¸å·¥ä½œæµç¼–æ’æ— å…³ // å®é™…ç±»å‹åº”è¯¥å®ç°ä¸¤ä¸ªæ¥å£ï¼š // - NodeAdaptor: æä¾›ä»vo.Nodeåˆ°NodeSchemaçš„è½¬æ¢ // - NodeBuilder: æä¾›ä»NodeSchemaåˆ°å®é™…èŠ‚ç‚¹å®ä¾‹çš„å®ä¾‹åŒ– Configs any `json:\"configs,omitempty\"` // InputTypes èŠ‚ç‚¹è¾“å…¥å­—æ®µçš„ç±»å‹ä¿¡æ¯æ˜ å°„ // é”®ä¸ºå­—æ®µåï¼Œå€¼ä¸ºå¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œç”¨äºç±»å‹æ£€æŸ¥å’ŒéªŒè¯ InputTypes map[string]*vo.TypeInfo `json:\"input_types,omitempty\"` // InputSources èŠ‚ç‚¹è¾“å…¥å­—æ®µçš„æ˜ å°„ä¿¡æ¯ // å®šä¹‰æ¯ä¸ªè¾“å…¥å­—æ®µçš„æ•°æ®æ¥æºï¼Œå¦‚æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¾“å‡ºæˆ–é™æ€å€¼ InputSources []*vo.FieldInfo `json:\"input_sources,omitempty\"` // OutputTypes èŠ‚ç‚¹è¾“å‡ºå­—æ®µçš„ç±»å‹ä¿¡æ¯æ˜ å°„ // é”®ä¸ºå­—æ®µåï¼Œå€¼ä¸ºå¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œç”¨äºä¸‹æ¸¸èŠ‚ç‚¹çš„ç±»å‹æ¨å¯¼ OutputTypes map[string]*vo.TypeInfo `json:\"output_types,omitempty\"` // OutputSources èŠ‚ç‚¹è¾“å‡ºå­—æ®µçš„æ˜ å°„ä¿¡æ¯ // æ³¨æ„ï¼šä»…é€‚ç”¨äºå¤åˆèŠ‚ç‚¹ï¼Œå¦‚NodeTypeBatchæˆ–NodeTypeLoop OutputSources []*vo.FieldInfo `json:\"output_sources,omitempty\"` // ExceptionConfigs èŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥é…ç½® // åŒ…å«è¶…æ—¶ã€é‡è¯•ã€é”™è¯¯å¤„ç†ç±»å‹ç­‰å¼‚å¸¸å¤„ç†ç›¸å…³è®¾ç½® ExceptionConfigs *ExceptionConfig `json:\"exception_configs,omitempty\"` // StreamConfigs èŠ‚ç‚¹çš„æµå¼å¤„ç†ç‰¹æ€§é…ç½® // å®šä¹‰èŠ‚ç‚¹æ˜¯å¦æ”¯æŒæµå¼è¾“å…¥/è¾“å‡ºç­‰æµå¤„ç†èƒ½åŠ› StreamConfigs *StreamConfig `json:\"stream_configs,omitempty\"` // SubWorkflowBasic å­å·¥ä½œæµçš„åŸºæœ¬ä¿¡æ¯ // ä»…å½“èŠ‚ç‚¹ç±»å‹ä¸ºNodeTypeSubWorkflowæ—¶ä½¿ç”¨ SubWorkflowBasic *entity.WorkflowBasic `json:\"sub_workflow_basic,omitempty\"` // SubWorkflowSchema å­å·¥ä½œæµçš„å®Œæ•´Schemaä¿¡æ¯ // ä»…å½“èŠ‚ç‚¹ç±»å‹ä¸ºNodeTypeSubWorkflowæ—¶ä½¿ç”¨ï¼ŒåŒ…å«å­å·¥ä½œæµçš„å®Œæ•´å®šä¹‰ SubWorkflowSchema *WorkflowSchema `json:\"sub_workflow_schema,omitempty\"` // FullSources èŠ‚ç‚¹è¾“å…¥å­—æ®µæ˜ å°„æ¥æºçš„å®Œæ•´ä¿¡æ¯ // åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚å­—æ®µæ˜¯å¦ä¸ºæµå¼å­—æ®µï¼Œæˆ–å­—æ®µæ˜¯å¦ä¸ºåŒ…å«å­å­—æ®µæ˜ å°„çš„å¯¹è±¡ // ç”¨äºéœ€è¦å¤„ç†æµå¼è¾“å…¥çš„èŠ‚ç‚¹ // åœ¨NodeMetaä¸­è®¾ç½®InputSourceAware = trueæ¥å¯ç”¨æ­¤åŠŸèƒ½ FullSources map[string]*SourceInfo // Lambda ç›´æ¥è®¾ç½®èŠ‚ç‚¹ä¸ºEino Lambda // æ³¨æ„ï¼šä¸å¯åºåˆ—åŒ–ï¼Œä»…ç”¨äºå†…éƒ¨æµ‹è¯• Lambda *compose.Lambda } 1.2.3Â è½¬æ¢ç»“æ„å‰åå¯¹æ¯” graph LR subgraph \"å‰ç«¯Canvasç»“æ„\" A[Canvasç”»å¸ƒ] A --\u003e B[NodeèŠ‚ç‚¹] A --\u003e C[Edgeè¿æ¥] B --\u003e D[ID: string] B --\u003e E[Type: string] B --\u003e F[Dataé…ç½®] F --\u003e G[Metaå…ƒæ•°æ®] F --\u003e H[Inputsè¾“å…¥] F --\u003e I[Outputsè¾“å‡º] H --\u003e J[InputParameterså‚æ•°åˆ—è¡¨] H --\u003e K[LLMParamæ¨¡å‹å‚æ•°] H --\u003e L[SettingOnErroré”™è¯¯å¤„ç†] J --\u003e M[Paramå‚æ•°] M --\u003e N[Name: string] M --\u003e O[Input: BlockInput] O --\u003e P[Type: VariableType] O --\u003e Q[Value: BlockInputValue] Q --\u003e R[Type: literal/ref/object_ref] Q --\u003e S[Content: any] I --\u003e T[Variableå˜é‡] T --\u003e U[Name: string] T --\u003e V[Type: VariableType] T --\u003e W[Schema: any] end subgraph \"è½¬æ¢è¿‡ç¨‹\" X[CanvasToWorkflowSchema] --\u003e Y[NodeToNodeSchema] Y --\u003e Z[NodeAdaptor.Adapt] Z --\u003e AA[SetInputsForNodeSchema] Z --\u003e BB[SetOutputTypesForNodeSchema] AA --\u003e CC[CanvasBlockInputToTypeInfo] AA --\u003e DD[CanvasBlockInputToFieldInfo] BB --\u003e EE[CanvasVariableToTypeInfo] end subgraph \"åç«¯NodeSchemaç»“æ„\" FF[WorkflowSchemaå·¥ä½œæµ] FF --\u003e GG[NodeSchemaèŠ‚ç‚¹] FF --\u003e HH[Connectionè¿æ¥] FF --\u003e II[Branchåˆ†æ”¯] GG --\u003e JJ[Key: NodeKey] GG --\u003e KK[Type: NodeTypeæšä¸¾] GG --\u003e LL[Configs: èŠ‚ç‚¹é…ç½®] GG --\u003e MM[InputTypesç±»å‹æ˜ å°„] GG --\u003e NN[InputSourcesæ¥æºæ˜ å°„] GG --\u003e OO[OutputTypesè¾“å‡ºç±»å‹] MM --\u003e PP[\"map[string]*TypeInfo\"] NN --\u003e QQ[\"[]*FieldInfo\"] OO --\u003e RR[\"map[string]*TypeInfo\"] QQ --\u003e SS[FieldInfoå­—æ®µä¿¡æ¯] SS --\u003e TT[Path: FieldPath] SS --\u003e UU[Source: æ•°æ®æ¥æº] SS --\u003e VV[Type: Literal/Reference/Template] PP --\u003e WW[TypeInfoç±»å‹ä¿¡æ¯] WW --\u003e XX[Type: DataTypeæšä¸¾] WW --\u003e YY[Properties: å¯¹è±¡å±æ€§] WW --\u003e ZZ[ElemTypeInfo: æ•°ç»„å…ƒç´ ç±»å‹] GG --\u003e AAA[ExceptionConfigså¼‚å¸¸é…ç½®] AAA --\u003e BBB[TimeoutMS: è¶…æ—¶æ—¶é—´] AAA --\u003e CCC[MaxRetry: é‡è¯•æ¬¡æ•°] AAA --\u003e DDD[ProcessType: å¤„ç†ç±»å‹] end A -.è½¬æ¢.-\u003e FF B -.é€‚é…å™¨è½¬æ¢.-\u003e GG C -.æ ‡å‡†åŒ–.-\u003e HH O -.ç±»å‹è½¬æ¢.-\u003e WW Q -.æ¥æºåˆ†æ.-\u003e SS style A fill:#e3f2fd style FF fill:#e8f5e8 style X fill:#fff3e0 style Y fill:#fff3e0 style Z fill:#fff3e0 ã€è½¬æ¢è¿‡ç¨‹ã€‘\ncanvasåˆ°Â NodeSchemaçš„è½¬æ¢è¿‡ç¨‹æ˜¯CozeÂ Studioå·¥ä½œæµç³»ç»Ÿä¸­çš„æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼Œå®ƒé€šè¿‡é€‚é…å™¨æ¨¡å¼å°†å‰ç«¯é¢å‘ç”¨æˆ·çš„å¯è§†åŒ–ç”»å¸ƒç»“æ„è½¬æ¢ä¸ºåç«¯é¢å‘æ‰§è¡Œçš„æ ‡å‡†åŒ–Â Schemaç»“æ„ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‰ç«¯çš„Â CanvasåŒ…å«äº†ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šæ‹–æ‹½é…ç½®çš„Â NodeèŠ‚ç‚¹å’ŒÂ Edgeè¿æ¥ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹åŒ…å«å­—ç¬¦ä¸²ç±»å‹çš„IDå’ŒTypeã€ç”¨æˆ·é…ç½®çš„Dataæ•°æ®ï¼ˆåŒ…æ‹¬è¾“å…¥å‚æ•°ã€è¾“å‡ºå®šä¹‰ã€å…ƒæ•°æ®ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®ä»¥çµæ´»çš„Â `anyÂ `ç±»å‹å’ŒåµŒå¥—ç»“æ„å­˜å‚¨ä»¥é€‚åº”å‰ç«¯çš„åŠ¨æ€é…ç½®éœ€æ±‚ï¼›è€Œè½¬æ¢åçš„NodeSchemaåˆ™é‡‡ç”¨å¼ºç±»å‹çš„ç»“æ„åŒ–è®¾è®¡ï¼Œå°†èŠ‚ç‚¹ç±»å‹è½¬æ¢ä¸ºæšä¸¾ã€å°†è¾“å…¥è¾“å‡ºè½¬æ¢ä¸ºÂ TypeInfoå’ŒFieldInfoçš„æ˜ å°„å…³ç³»ã€å°†æ•°æ®æ¥æºåˆ†æä¸ºå…·ä½“çš„å¼•ç”¨è·¯å¾„ï¼Œå¹¶æ·»åŠ äº†æ‰§è¡Œæ—¶éœ€è¦çš„Â å¼‚å¸¸å¤„ç†é…ç½®ã€æµå¼å¤„ç†é…ç½®ç­‰è¿è¡Œæ—¶ä¿¡æ¯ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¹‹æ‰€ä»¥å¿…è¦ï¼Œæ˜¯å› ä¸ºå‰ç«¯Canvaséœ€è¦ä¿æŒé«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§æ¥æ”¯æŒç”¨æˆ·çš„å„ç§é…ç½®æ“ä½œå’ŒUIäº¤äº’ï¼Œè€Œåç«¯æ‰§è¡Œå¼•æ“åˆ™éœ€è¦ä¸¥æ ¼çš„ç±»å‹å®‰å…¨ã€æ˜ç¡®çš„æ•°æ®æµå‘å’Œä¼˜åŒ–çš„æ‰§è¡Œæ€§èƒ½ï¼Œä¸¤è€…çš„è®¾è®¡ç›®æ ‡å’Œçº¦æŸæ¡ä»¶å®Œå…¨ä¸åŒï¼Œå› æ­¤éœ€è¦é€šè¿‡è¿™ä¸ªè½¬æ¢å±‚æ¥å®ç°å‰åç«¯çš„è§£è€¦ï¼ŒåŒæ—¶ç¡®ä¿ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šçš„æ¯ä¸€ä¸ªé…ç½®éƒ½èƒ½å‡†ç¡®æ— è¯¯åœ°è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„å·¥ä½œæµé€»è¾‘ï¼Œå¹¶ä¸”è¿™ç§è½¬æ¢è¿‡ç¨‹è¿˜æ”¯æŒå¤æ‚çš„èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚å­å·¥ä½œæµã€æ‰¹å¤„ç†èŠ‚ç‚¹ï¼‰ã€æ•°æ®ç±»å‹æ¨å¯¼ã€å­—æ®µæ˜ å°„åˆ†æç­‰é«˜çº§ç‰¹æ€§ï¼Œä¸ºæ•´ä¸ªå·¥ä½œæµç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’ŒåŠŸèƒ½æ‰©å±•æä¾›äº†åšå®çš„åŸºç¡€ã€‚\n1.3Â å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ å·¥ä½œæµæ‰§è¡Œå›¾Â (ç»†èŠ‚) graph TD A[Canvasç”»å¸ƒ] --\u003e B{ä¿å­˜/è¿è¡Œå·¥ä½œæµ} B --\u003e C[ç”»å¸ƒç»“æ„éªŒè¯] C --\u003e D[è¿æ¥å…³ç³»éªŒè¯] C --\u003e E[é—­ç¯æ£€æµ‹] C --\u003e F[èŠ‚ç‚¹é…ç½®éªŒè¯] C --\u003e G[å˜é‡å¼•ç”¨éªŒè¯] C --\u003e H[åµŒå¥—æµç¨‹éªŒè¯] C --\u003e I[å…¨å±€å˜é‡éªŒè¯] C --\u003e J[å­å·¥ä½œæµç»ˆæ­¢è®¡åˆ’éªŒè¯] D --\u003e K{éªŒè¯é€šè¿‡?} E --\u003e K F --\u003e K G --\u003e K H --\u003e K I --\u003e K J --\u003e K K --\u003e|å¦| L[è¿”å›éªŒè¯é”™è¯¯] L --\u003e M[å‰ç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯] K --\u003e|æ˜¯| N[Canvasè½¬æ¢ä¸ºWorkflowSchema] N --\u003e O[ç§»é™¤å­¤ç«‹èŠ‚ç‚¹] O --\u003e P[éå†Canvas Nodes] P --\u003e Q{èŠ‚ç‚¹ç±»å‹åˆ¤æ–­} Q --\u003e|å­å·¥ä½œæµ| R[é€’å½’è§£æå­å·¥ä½œæµCanvas] Q --\u003e|æ‰¹å¤„ç†èŠ‚ç‚¹| S[è§£ææ‰¹å¤„ç†æ¨¡å¼] Q --\u003e|æ™®é€šèŠ‚ç‚¹| T[è·å–NodeAdaptor] R --\u003e U[toSubWorkflowNodeSchema] S --\u003e V[parseBatchModeç”Ÿæˆæ‰¹å¤„ç†ç»“æ„] T --\u003e W[è°ƒç”¨Adaptor.Adaptæ–¹æ³•] U --\u003e X[è®¾ç½®å¼‚å¸¸å¤„ç†é…ç½®] V --\u003e X W --\u003e X X --\u003e Y{èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹?} Y --\u003e|æ˜¯| Z[é€’å½’è½¬æ¢å­èŠ‚ç‚¹] Y --\u003e|å¦| AA[è½¬æ¢è¾“å…¥è¾“å‡ºç±»å‹] Z --\u003e BB[è®¾ç½®å±‚æ¬¡å…³ç³»æ˜ å°„] BB --\u003e AA AA --\u003e CC[SetInputsForNodeSchema] AA --\u003e DD[SetOutputTypesForNodeSchema] CC --\u003e EE[CanvasBlockInputToTypeInfo] CC --\u003e FF[CanvasBlockInputToFieldInfo] DD --\u003e GG[CanvasVariableToTypeInfo] EE --\u003e HH[è§£æåŸºç¡€ç±»å‹] EE --\u003e II[å¤„ç†å¤æ‚å¯¹è±¡ç±»å‹] EE --\u003e JJ[å¤„ç†æ•°ç»„ç±»å‹] EE --\u003e KK[å¤„ç†æ–‡ä»¶ç±»å‹] FF --\u003e LL[åˆ†ææ•°æ®æ¥æº] LL --\u003e MM{æ¥æºç±»å‹} MM --\u003e|é™æ€å€¼| NN[åˆ›å»ºLiteralFieldInfo] MM --\u003e|èŠ‚ç‚¹å¼•ç”¨| OO[åˆ›å»ºReferenceFieldInfo] MM --\u003e|æ¨¡æ¿å­—ç¬¦ä¸²| PP[åˆ›å»ºTemplateFieldInfo] HH --\u003e QQ[ç”ŸæˆNodeSchema] II --\u003e QQ JJ --\u003e QQ KK --\u003e QQ NN --\u003e QQ OO --\u003e QQ PP --\u003e QQ GG --\u003e QQ QQ --\u003e RR[æ”¶é›†æ‰€æœ‰NodeSchema] RR --\u003e SS[è½¬æ¢è¿æ¥è¾¹EdgeToConnection] SS --\u003e TT[æ ‡å‡†åŒ–ç«¯å£normalizePorts] TT --\u003e UU[æ„å»ºåˆ†æ”¯ä¿¡æ¯BuildBranches] UU --\u003e VV[ç”Ÿæˆå®Œæ•´WorkflowSchema] VV --\u003e WW[èŠ‚ç‚¹å®ä¾‹åŒ–] WW --\u003e XX[NodeBuilder.Build] XX --\u003e YY[åˆ›å»ºå…·ä½“èŠ‚ç‚¹å®ä¾‹] YY --\u003e ZZ[å·¥ä½œæµæ‰§è¡Œå¼•æ“] subgraph \"éªŒè¯å™¨è¯¦ç»†åŠŸèƒ½\" D1[ValidateConnectionsæ£€æŸ¥èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§] E1[DetectCyclesæ£€æµ‹å·¥ä½œæµä¸­çš„å¾ªç¯ä¾èµ–] F1[èŠ‚ç‚¹é…ç½®éªŒè¯æ£€æŸ¥å¿…å¡«å­—æ®µå’Œå‚æ•°åˆæ³•æ€§] G1[CheckRefVariableéªŒè¯å˜é‡å¼•ç”¨çš„æœ‰æ•ˆæ€§] H1[ValidateNestedFlowsæ£€æŸ¥æ‰¹å¤„ç†/å¾ªç¯åµŒå¥—é™åˆ¶] I1[CheckGlobalVariableséªŒè¯å…¨å±€å˜é‡ç±»å‹åŒ¹é…] J1[CheckSubWorkFlowTerminatePlanéªŒè¯å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥] end D -.-\u003e D1 E -.-\u003e E1 F -.-\u003e F1 G -.-\u003e G1 H -.-\u003e H1 I -.-\u003e I1 J -.-\u003e J1 subgraph \"NodeAdaptorè½¬æ¢ç»†èŠ‚\" W1[è§£æèŠ‚ç‚¹ç‰¹å®šé…ç½®] --\u003e W2[è½¬æ¢è¾“å…¥å‚æ•°ç±»å‹] W2 --\u003e W3[è½¬æ¢è¾“å‡ºå®šä¹‰ç±»å‹] W3 --\u003e W4[è®¾ç½®èŠ‚ç‚¹å†…éƒ¨Config] W4 --\u003e W5[è°ƒç”¨é€šç”¨ç±»å‹è½¬æ¢å‡½æ•°] end W -.-\u003e W1 subgraph \"æ‰§è¡Œæ—¶èŠ‚ç‚¹ç±»å‹\" YY1[InvokableNodeæ™®é€šæ‰§è¡ŒèŠ‚ç‚¹] YY2[StreamableNodeæµå¼å¤„ç†èŠ‚ç‚¹] YY3[TransformableNodeæ•°æ®è½¬æ¢èŠ‚ç‚¹] YY4[CollectableNodeæ•°æ®æ”¶é›†èŠ‚ç‚¹] end YY -.-\u003e YY1 YY -.-\u003e YY2 YY -.-\u003e YY3 YY -.-\u003e YY4 style A fill:#e3f2fd style C fill:#ffebee style K fill:#fff3e0 style VV fill:#e8f5e8 style ZZ fill:#f3e5f5 style L fill:#ffcdd2 å‰ç«¯äº¤äº’å±‚ï¼šå‰ç«¯Â Canvaså±‚æ˜¯ç”¨æˆ·äº¤äº’çš„èµ·ç‚¹ï¼ŒCanvasç”»å¸ƒæ‰¿è½½ç€ç”¨æˆ·çš„å¯è§†åŒ–é…ç½®ï¼Œå…¶ä¸­åŒ…å«Â Nodeï¼ˆä»¥vo.Nodeç»“æ„ä½“è¡¨ç¤ºï¼‰å’ŒEdgeè¿æ¥å…³ç³»ï¼Œè¿™é‡Œçš„å…³é”®é—®é¢˜æ˜¯\"èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ\"ï¼Œå®é™…ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ ‡å‡†åŒ–çš„å…ƒæ•°æ®å®šä¹‰ï¼ˆå¦‚èŠ‚ç‚¹ç±»å‹ã€æ˜¾ç¤ºåç§°ã€å›¾æ ‡ç­‰å›ºå®šå­—æ®µï¼‰å’ŒåŠ¨æ€çš„é…ç½®è¡¨å•ï¼ˆæ ¹æ®èŠ‚ç‚¹ç±»å‹å±•ç¤ºä¸åŒçš„å‚æ•°é…ç½®ç•Œé¢ï¼‰ï¼Œå‰ç«¯schemaé‡‡ç”¨çµæ´»çš„JSONç»“æ„æ¥é€‚åº”å„ç§èŠ‚ç‚¹ç±»å‹çš„é…ç½®éœ€æ±‚ã€‚\néªŒè¯å±‚ï¼šéªŒè¯å±‚é€šè¿‡CanvasValidatorå¯¹ç”»å¸ƒç»“æ„è¿›è¡Œå…¨é¢æ£€æŸ¥ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§ã€å¾ªç¯ä¾èµ–æ£€æµ‹ã€é…ç½®åˆæ³•æ€§éªŒè¯ç­‰å¤šä¸ªç»´åº¦ï¼Œç¡®ä¿åªæœ‰ç»“æ„æ­£ç¡®çš„å·¥ä½œæµæ‰èƒ½è¿›å…¥åç»­çš„è½¬æ¢å’Œæ‰§è¡Œé˜¶æ®µï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œç³»ç»Ÿä¼šè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½å’Œä¿®æ­£é—®é¢˜ã€‚\nè½¬æ¢å±‚ï¼šè½¬æ¢å±‚æ˜¯æ•´ä¸ªæ¶æ„çš„æ ¸å¿ƒæ¢çº½ï¼Œè´Ÿè´£\"åç«¯ä¿å­˜ï¼Œworkflowè¿è¡Œ\"çš„å…³é”®è½¬æ¢è¿‡ç¨‹ï¼Œé€šè¿‡CanvasToWorkflowSchemaå‡½æ•°åè°ƒæ•´ä¸ªè½¬æ¢æµç¨‹ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯NodeTypeåˆ°èŠ‚ç‚¹Configçš„è½¬æ¢ï¼Œè¿™é€šè¿‡NodeAdaptoræ¥å£å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç±»å‹éƒ½æœ‰å¯¹åº”çš„é€‚é…å™¨è´Ÿè´£å°†å‰ç«¯çš„çµæ´»é…ç½®è½¬æ¢ä¸ºåç«¯çš„å¼ºç±»å‹NodeSchemaç»“æ„ï¼Œå®ç°äº†\"å‰ç«¯schemaÂ -\u003eÂ åç«¯schema\"çš„æ ‡å‡†åŒ–è½¬æ¢ã€‚\nèŠ‚ç‚¹å®ä¾‹åŒ–å±‚ï¼šå®ä¾‹åŒ–å±‚é€šè¿‡NodeBuilderæ¥å£å°†æŠ½è±¡çš„NodeSchemaè½¬æ¢ä¸ºå…·ä½“çš„å¯æ‰§è¡ŒèŠ‚ç‚¹å®ä¾‹ï¼Œè¿™é‡Œçš„å…³é”®æ˜¯NodeSchema.Configså­—æ®µå¿…é¡»å®ç°NodeBuilderæ¥å£ï¼Œä»è€Œèƒ½å¤Ÿæ ¹æ®é…ç½®ä¿¡æ¯åˆ›å»ºå®é™…çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ç°äº†\"åç«¯schemaÂ -\u003eÂ èŠ‚ç‚¹å®ä¾‹\"çš„æœ€ç»ˆè½¬æ¢ï¼Œä¸ºæ‰§è¡Œå±‚æä¾›äº†ç»Ÿä¸€çš„èŠ‚ç‚¹å®ä¾‹æ¥å£ã€‚\næ‰§è¡Œå±‚ï¼šæ‰§è¡Œå±‚æ˜¯æ•´ä¸ªæµç¨‹çš„æœ€ç»ˆç›®æ ‡ï¼ŒèŠ‚ç‚¹å®ä¾‹é€šè¿‡å®ç°InvokableNodeç­‰æ‰§è¡Œæ¥å£æ¥æä¾›å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¤„ç†èƒ½åŠ›ï¼Œå·¥ä½œæµå¼•æ“è´Ÿè´£æŒ‰ç…§æ—¢å®šçš„æ‰§è¡Œé¡ºåºè°ƒåº¦å„ä¸ªèŠ‚ç‚¹ï¼Œå¤„ç†æ•°æ®æµè½¬å’ŒçŠ¶æ€ç®¡ç†ï¼Œæœ€ç»ˆäº§ç”Ÿä¸šåŠ¡æ‰§è¡Œç»“æœå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚\nå·¥ä½œæµæ ¡éªŒ 2.1Â å·¥ä½œæµéªŒè¯æµç¨‹ 2.1.1Â æ ¸å¿ƒéªŒè¯æµç¨‹ graph LR A[ç”»å¸ƒé¢„å¤„ç†] --\u003e B[è¿æ¥éªŒè¯] --\u003e C[å¾ªç¯æ£€æµ‹] --\u003e D[åµŒå¥—éªŒè¯] --\u003e E[å˜é‡æ£€æŸ¥] --\u003e F[å…¨å±€å˜é‡] --\u003e G[ç»ˆæ­¢ç­–ç•¥] 2.1.2Â å®Œæ•´éªŒè¯æµç¨‹ %% ç‚¹å‡» â€œç»˜å›¾â€ æŒ‰é’®å³å¯é¢„è§ˆ graph LR A[\"1. ç”»å¸ƒé¢„å¤„ç†â€¢ JSONååºåˆ—åŒ–â€¢ æ¸…ç†å­¤ç«‹èŠ‚ç‚¹â€¢ åˆ›å»ºéªŒè¯å™¨å®ä¾‹\"] --\u003e H[\"2. è¿æ¥å…³ç³»éªŒè¯ValidateConnections\"] H --\u003e H1[\"â€¢ æ£€æŸ¥èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§â€¢ éªŒè¯ç«¯å£è¿æ¥æ­£ç¡®æ€§â€¢ æ£€æŸ¥åˆ†æ”¯èŠ‚ç‚¹å®Œæ•´æ€§\"] H1 --\u003e I{å‘ç°é—®é¢˜?} I --\u003e|æ˜¯| Z[\"è¿”å›éªŒè¯é”™è¯¯\"] I --\u003e|å¦| J[\"3. å¾ªç¯ä¾èµ–æ£€æµ‹DetectCycles\"] J --\u003e J1[\"â€¢ æ„å»ºä¾èµ–å…³ç³»å›¾â€¢ DFSç®—æ³•æ£€æµ‹ç¯â€¢ æ ‡è¯†å¾ªç¯è·¯å¾„\"] J1 --\u003e K{å‘ç°å¾ªç¯?} K --\u003e|æ˜¯| Z K --\u003e|å¦| L[\"4. åµŒå¥—æµç¨‹éªŒè¯ValidateNestedFlows\"] L --\u003e L1[\"â€¢ æ£€æŸ¥æ‰¹å¤„ç†èŠ‚ç‚¹åµŒå¥—â€¢ éªŒè¯å¾ªç¯èŠ‚ç‚¹åµŒå¥—â€¢ é˜²æ­¢è¿‡æ·±åµŒå¥—\"] L1 --\u003e M{åµŒå¥—è¿è§„?} M --\u003e|æ˜¯| Z M --\u003e|å¦| N[\"5. å¼•ç”¨å˜é‡æ£€æŸ¥CheckRefVariable\"] N --\u003e N1[\"â€¢ éªŒè¯å˜é‡å¯è¾¾æ€§â€¢ æ£€æŸ¥å‚æ•°åè§„èŒƒâ€¢ éªŒè¯ä½œç”¨åŸŸæ­£ç¡®æ€§\"] N1 --\u003e O{å˜é‡å¼•ç”¨é”™è¯¯?} O --\u003e|æ˜¯| Z O --\u003e|å¦| P[\"6. å…¨å±€å˜é‡éªŒè¯CheckGlobalVariables\"] P --\u003e P1[\"â€¢ éªŒè¯å˜é‡ç±»å‹åŒ¹é…â€¢ æ£€æŸ¥æ•°ç»„å…ƒç´ ç±»å‹â€¢ éªŒè¯å˜é‡å£°æ˜\"] P1 --\u003e Q{å…¨å±€å˜é‡é”™è¯¯?} Q --\u003e|æ˜¯| Z Q --\u003e|å¦| R[\"7. å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥CheckSubWorkFlowTerminatePlanType\"] R --\u003e R1[\"â€¢ éªŒè¯ç»ˆæ­¢è®¡åˆ’é…ç½®â€¢ æ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§â€¢ éªŒè¯å­å·¥ä½œæµå­˜åœ¨æ€§\"] R1 --\u003e S{ç»ˆæ­¢ç­–ç•¥é”™è¯¯?} S --\u003e|æ˜¯| Z S --\u003e|å¦| T[\"ä¸»å·¥ä½œæµéªŒè¯å®Œæˆ\"] T --\u003e U[\"å­å·¥ä½œæµé€’å½’éªŒè¯\"] U --\u003e U1[\"â€¢ è§£æç”»å¸ƒè·å–å­å·¥ä½œæµâ€¢ ç­›é€‰é¡¹ç›®çº§å·¥ä½œæµâ€¢ æ‰¹é‡è·å–å·¥ä½œæµä¿¡æ¯\"] U1 --\u003e U2[\"å¯¹æ¯ä¸ªå­å·¥ä½œæµé‡å¤éªŒè¯æµç¨‹\"] U2 --\u003e V[\"æ±‡æ€»æ‰€æœ‰éªŒè¯ç»“æœ\"] V --\u003e W[\"é”™è¯¯ä¿¡æ¯è½¬æ¢â€¢ Issue -\u003e ValidateErrorDataâ€¢ èŠ‚ç‚¹é”™è¯¯/è·¯å¾„é”™è¯¯åˆ†ç±»\"] W --\u003e X[\"è¿”å›éªŒè¯ç»“æœValidateTreeResponse\"] style A fill:#e1f5fe style H fill:#e8f5e8 style J fill:#e8f5e8 style L fill:#e8f5e8 style N fill:#e8f5e8 style P fill:#e8f5e8 style R fill:#e8f5e8 style U fill:#fff8e1 style Z fill:#ffebee 2.1.3Â å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“ CozeÂ StudioÂ çš„å·¥ä½œæµéªŒè¯é‡‡ç”¨åˆ†å±‚é€’è¿›å¼éªŒè¯æ¶æ„ï¼Œä»Â APIÂ å±‚çš„Â ValidateTreeÂ æ¥å£å¼€å§‹ï¼Œç»è¿‡åº”ç”¨æœåŠ¡å±‚çš„å‚æ•°é¢„å¤„ç†ï¼Œæœ€ç»ˆè°ƒç”¨é¢†åŸŸæœåŠ¡å±‚çš„æ ¸å¿ƒéªŒè¯å¼•æ“Â validateWorkflowTreeã€‚éªŒè¯æµç¨‹åŒ…å«ä¸ƒä¸ªå…³é”®æ­¥éª¤ï¼š\n1.Â ç”»å¸ƒé¢„å¤„ç†é˜¶æ®µÂ -Â é¦–å…ˆå°†Â JSONÂ æ ¼å¼çš„ç”»å¸ƒç»“æ„ååºåˆ—åŒ–ä¸ºå†…å­˜å¯¹è±¡ï¼Œç„¶åè°ƒç”¨Â adaptor.PruneIsolatedNodesÂ æ¸…ç†æ²¡æœ‰è¿æ¥å…³ç³»çš„å­¤ç«‹èŠ‚ç‚¹ï¼Œæœ€ååˆ›å»ºé…ç½®å®Œæ•´çš„Â CanvasValidatorÂ éªŒè¯å™¨å®ä¾‹å¹¶æ‰§è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ„å»ºèŠ‚ç‚¹é—´çš„è¿é€šå…³ç³»å›¾ã€‚\n2.Â è¿æ¥å…³ç³»éªŒè¯Â -Â ValidateConnectionsÂ æ–¹æ³•é€šè¿‡éå†æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼Œæ„å»ºå‡ºåº¦æ˜ å°„è¡¨å’Œç«¯å£æ˜ å°„è¡¨æ¥å®ç°ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ£€æŸ¥å…¶è¾“å‡ºç«¯å£æ˜¯å¦æ­£ç¡®è¿æ¥ï¼Œç‰¹åˆ«æ˜¯åˆ†æ”¯èŠ‚ç‚¹ï¼ˆå¦‚æ¡ä»¶åˆ¤æ–­ã€é”™è¯¯å¤„ç†ï¼‰å¿…é¡»ç¡®ä¿æ‰€æœ‰æœŸæœ›çš„ç«¯å£éƒ½æœ‰è¿æ¥ã€‚ç®—æ³•ä¼šé€’å½’éªŒè¯åµŒå¥—èŠ‚ç‚¹çš„è¿æ¥å…³ç³»ï¼Œç¡®ä¿æ•°æ®æµçš„å®Œæ•´æ€§ã€‚\n3.Â å¾ªç¯ä¾èµ–æ£€æµ‹Â -Â DetectCyclesÂ ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ç®—æ³•å®ç°ã€‚é¦–å…ˆæ„å»ºåå‘ä¾èµ–å…³ç³»å›¾ï¼ˆcontrolSuccessorsï¼‰ï¼Œç„¶åå¯¹æ¯ä¸ªæœªè®¿é—®çš„èŠ‚ç‚¹å¯åŠ¨Â DFSÂ éå†ã€‚åœ¨éå†è¿‡ç¨‹ä¸­ç»´æŠ¤å½“å‰è·¯å¾„æ ˆï¼Œå½“å‘ç°è·¯å¾„ä¸­å·²å­˜åœ¨çš„èŠ‚ç‚¹æ—¶ï¼Œå³æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–ï¼Œç®—æ³•ä¼šæå–å¹¶è¿”å›å®Œæ•´çš„å¾ªç¯è·¯å¾„ã€‚\n4.Â åµŒå¥—æµç¨‹éªŒè¯Â -Â ValidateNestedFlowsÂ é€šè¿‡æ£€æŸ¥å¯è¾¾æ€§åˆ†æç»“æœä¸­çš„Â nestedReachabilityÂ ç»“æ„å®ç°ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ—¢æœ‰åµŒå¥—ç»“æ„ï¼Œåˆåœ¨å…¶åµŒå¥—ç»“æ„ä¸­è¿˜æœ‰æ›´æ·±å±‚çš„åµŒå¥—ï¼ˆå³Â len(nestedReachableNodes.nestedReachability)Â \u003eÂ 0ï¼‰ï¼Œåˆ™åˆ¤å®šä¸ºè¿ååµŒå¥—è§„åˆ™ï¼Œé˜²æ­¢æ‰¹å¤„ç†å’Œå¾ªç¯èŠ‚ç‚¹çš„è¿‡åº¦åµŒå¥—å¯¼è‡´æ‰§è¡Œå¼‚å¸¸ã€‚\n5.Â å¼•ç”¨å˜é‡æ£€æŸ¥Â -Â CheckRefVariableÂ é‡‡ç”¨é€’å½’ä½œç”¨åŸŸåˆ†æç®—æ³•ã€‚å®šä¹‰å†…éƒ¨å‡½æ•°Â inputBlockVerifyÂ è§£ææ¯ä¸ªè¾“å…¥å‚æ•°çš„å¼•ç”¨ä¿¡æ¯ï¼Œæ£€æŸ¥å¼•ç”¨çš„èŠ‚ç‚¹æ˜¯å¦åœ¨å½“å‰æˆ–çˆ¶çº§ä½œç”¨åŸŸçš„å¯è¾¾èŒƒå›´å†…ã€‚é€šè¿‡Â combinedReachableÂ æ˜ å°„è¡¨åˆå¹¶å½“å‰å±‚çº§å’Œçˆ¶çº§å¯è¾¾èŠ‚ç‚¹ï¼Œå®ç°ä½œç”¨åŸŸç»§æ‰¿æœºåˆ¶ã€‚åŒæ—¶éªŒè¯å‚æ•°åç§°çš„è§„èŒƒæ€§ï¼ˆå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰ã€‚\n6.Â å…¨å±€å˜é‡éªŒè¯Â -Â CheckGlobalVariablesÂ é¦–å…ˆæ”¶é›†æ‰€æœ‰å˜é‡åˆ†é…èŠ‚ç‚¹ï¼ˆNodeTypeVariableAssignerï¼‰çš„å˜é‡å®šä¹‰ï¼Œç„¶åé€šè¿‡Â VariablesMetaGetterÂ è·å–åº”ç”¨æˆ–æ™ºèƒ½ä½“çš„å˜é‡å…ƒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚éªŒè¯åŒ…æ‹¬åŸºç¡€ç±»å‹åŒ¹é…å’Œæ•°ç»„å…ƒç´ ç±»å‹çš„æ·±åº¦æ£€æŸ¥ï¼Œç¡®ä¿å·¥ä½œæµä¸­ä½¿ç”¨çš„å…¨å±€å˜é‡ä¸ç³»ç»Ÿå®šä¹‰ä¸€è‡´ã€‚\n7.Â å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥éªŒè¯Â -Â CheckSubWorkFlowTerminatePlanTypeÂ é€šè¿‡é€’å½’æ”¶é›†æ‰€æœ‰å­å·¥ä½œæµèŠ‚ç‚¹ï¼Œåˆ†åˆ«è·å–è‰ç¨¿ç‰ˆæœ¬å’Œå·²å‘å¸ƒç‰ˆæœ¬çš„ç”»å¸ƒä¿¡æ¯ã€‚å¯¹æ¯ä¸ªå­å·¥ä½œæµï¼ŒæŸ¥æ‰¾å…¶ç»“æŸèŠ‚ç‚¹çš„ç»ˆæ­¢è®¡åˆ’é…ç½®ï¼Œä¸å½“å‰èŠ‚ç‚¹çš„ç»ˆæ­¢ç±»å‹è¿›è¡ŒåŒ¹é…éªŒè¯ï¼Œç¡®ä¿å­å·¥ä½œæµçš„è¾“å‡ºå¤„ç†ç­–ç•¥ä¸è°ƒç”¨æ–¹æœŸæœ›ä¸€è‡´ã€‚\næ•´ä¸ªéªŒè¯è¿‡ç¨‹é‡‡ç”¨å¿«é€Ÿå¤±è´¥ç­–ç•¥ï¼Œä»»ä½•æ­¥éª¤å‘ç°é—®é¢˜ç«‹å³è¿”å›é”™è¯¯ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒé€’å½’å­å·¥ä½œæµéªŒè¯ï¼Œé€šè¿‡Â getAllSubWorkflowIdentitiesÂ æå–æ‰€æœ‰å­å·¥ä½œæµæ ‡è¯†ï¼Œå¯¹æ¯ä¸ªå­å·¥ä½œæµé‡å¤æ‰§è¡Œå®Œæ•´çš„éªŒè¯æµç¨‹ï¼Œæœ€ç»ˆæ±‡æ€»æ‰€æœ‰éªŒè¯ç»“æœï¼Œç¡®ä¿æ•´ä¸ªå·¥ä½œæµæ ‘çš„ç»“æ„å®Œæ•´æ€§ã€é€»è¾‘æ­£ç¡®æ€§å’Œæ‰§è¡Œå®‰å…¨æ€§ã€‚\n",
  "wordCount" : "3254",
  "inLanguage": "en",
  "image": "https://swimmingliu.cn/papermod-cover.png","datePublished": "2025-08-07T23:27:35+08:00",
  "dateModified": "2025-08-07T23:27:35+08:00",
  "author":[{
    "@type": "Person",
    "name": "SwimmingLiu"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://swimmingliu.cn/posts/job/coze-workflow-analysis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "SwimmingLiu's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://swimmingliu.cn/images/swimmingliu_icon.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://swimmingliu.cn/" accesskey="h" title="ğ“¢ğ”€ğ“²ğ“¶ğ“¶ğ“²ğ“·ğ“°ğ“›ğ“²ğ“¾&#39;ğ“¼ ğ“‘ğ“µğ“¸ğ“° (Alt + H)">
                <img src="https://swimmingliu.cn/images/swimmingliu_icon.png" alt="" aria-label="logo"
                    height="30">ğ“¢ğ”€ğ“²ğ“¶ğ“¶ğ“²ğ“·ğ“°ğ“›ğ“²ğ“¾&#39;ğ“¼ ğ“‘ğ“µğ“¸ğ“°</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://swimmingliu.cn/index.html" title="ğŸ¡ Home">
                    <span>ğŸ¡ Home</span>
                </a>
            </li>
            <li>
                <a href="https://swimmingliu.cn/search/" title="ğŸ” Search">
                    <span>ğŸ” Search</span>
                </a>
            </li>
            <li>
                <a href="https://swimmingliu.cn/posts/" title="ğŸ—’ï¸ Posts">
                    <span>ğŸ—’ï¸ Posts</span>
                </a>
            </li>
            <li>
                <a href="https://swimmingliu.cn/archives/" title="ğŸ“ƒ Archive">
                    <span>ğŸ“ƒ Archive</span>
                </a>
            </li>
            <li>
                <a href="https://swimmingliu.cn/tags/" title="ğŸ“‘ Tags">
                    <span>ğŸ“‘ Tags</span>
                </a>
            </li>
            <li>
                <a href="https://bento.me/swimmingliu" title="ğŸ‘¨ğŸ»â€ğŸ“ About Me">
                    <span>ğŸ‘¨ğŸ»â€ğŸ“ About Me</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://www.emojisearch.app/" title="Emoji">
                    <span>Emoji</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://swimmingliu.cn/">Home</a>&nbsp;Â»&nbsp;<a href="https://swimmingliu.cn/posts/">ğŸ“š Posts</a>&nbsp;Â»&nbsp;<a href="https://swimmingliu.cn/posts/job/">ğŸ’» Job</a></div>
    <h1 class="post-title entry-hint-parent">
      Cozeå·¥ä½œæµåˆ†æ
    </h1>
    <div class="post-meta"><span title='2025-08-07 23:27:35 +0800 CST'>August 7, 2025</span>&nbsp;Â·&nbsp;16 min&nbsp;Â·&nbsp;SwimmingLiu

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#coze%e5%b7%a5%e4%bd%9c%e6%b5%81-qa" aria-label="Cozeå·¥ä½œæµ-QA">Cozeå·¥ä½œæµ-QA</a><ul>
                        
                <li>
                    <a href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%ae%a1%e7%90%86" aria-label="å·¥ä½œæµç®¡ç†">å·¥ä½œæµç®¡ç†</a><ul>
                        
                <li>
                    <a href="#11%e7%94%bb%e5%b8%83%e5%92%8c%e5%90%8e%e7%ab%af%e7%bb%93%e6%9e%84" aria-label="1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„">1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„</a><ul>
                        
                <li>
                    <a href="#111%e8%8a%82%e7%82%b9%e6%95%b0%e6%8d%ae" aria-label="1.1.1Â èŠ‚ç‚¹æ•°æ®">1.1.1Â èŠ‚ç‚¹æ•°æ®</a></li>
                <li>
                    <a href="#112%e8%be%b9%e6%95%b0%e6%8d%ae" aria-label="1.1.2Â è¾¹æ•°æ®">1.1.2Â è¾¹æ•°æ®</a></li>
                <li>
                    <a href="#113%e5%a4%a7%e8%af%ad%e8%a8%80%e6%a8%a1%e5%9e%8b%e8%8a%82%e7%82%b9notetypellm" aria-label="1.1.3Â å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹Â (NoteTypeLLM)">1.1.3Â å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹Â (NoteTypeLLM)</a><ul>
                        
                <li>
                    <a href="#llm%e8%8a%82%e7%82%b9%e7%b1%bb%e5%9b%be%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba" aria-label="LLMèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º">LLMèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º</a></li>
                <li>
                    <a href="#llm%e5%8f%82%e6%95%b0-simplellmparam" aria-label="LLMå‚æ•°Â -Â SimpleLLMParam">LLMå‚æ•°Â -Â SimpleLLMParam</a></li>
                <li>
                    <a href="#llm%e4%b8%ad%e7%9a%84%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e5%8f%82%e6%95%b0fcparam" aria-label="LLMä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°Â **FcParam**">LLMä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°Â **FcParam**</a></li></ul>
                </li>
                <li>
                    <a href="#114blockinput%e7%bb%93%e6%9e%84" aria-label="1.1.4Â BlockInputç»“æ„">1.1.4Â BlockInputç»“æ„</a></li>
                <li>
                    <a href="#115%e7%9f%a5%e8%af%86%e5%ba%93%e8%8a%82%e7%82%b9rag" aria-label="1.1.5Â çŸ¥è¯†åº“èŠ‚ç‚¹Â (RAG)">1.1.5Â çŸ¥è¯†åº“èŠ‚ç‚¹Â (RAG)</a><ul>
                        
                <li>
                    <a href="#rag%e5%ae%8c%e6%95%b4%e6%b5%81%e7%a8%8b%e5%9b%be" aria-label="RAGå®Œæ•´æµç¨‹å›¾">RAGå®Œæ•´æµç¨‹å›¾</a></li>
                <li>
                    <a href="#%e5%90%91%e9%87%8f%e6%a3%80%e7%b4%a2%e8%a7%84%e5%88%99" aria-label="å‘é‡æ£€ç´¢è§„åˆ™">å‘é‡æ£€ç´¢è§„åˆ™</a></li>
                <li>
                    <a href="#rerank%e8%a7%84%e5%88%99" aria-label="ReRankÂ è§„åˆ™">ReRankÂ è§„åˆ™</a></li>
                <li>
                    <a href="#%e7%9f%a5%e8%af%86%e5%ba%93%e8%8a%82%e7%82%b9%e7%bb%93%e6%9e%84" aria-label="çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„">çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#12%e5%a6%82%e4%bd%95%e4%bb%8e%e7%94%bb%e5%b8%83%e8%bd%ac%e6%8d%a2%e4%b8%ba%e5%90%8e%e7%ab%af%e7%b1%bb%e5%a6%82%e4%bd%95%e8%bd%ac%e6%8d%a2%e4%b8%ba%e6%89%a7%e8%a1%8c%e6%80%81" aria-label="1.2Â å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»ï¼Ÿå¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€ï¼Ÿ">1.2Â å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»ï¼Ÿå¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€ï¼Ÿ</a><ul>
                        
                <li>
                    <a href="#121%e8%bd%ac%e6%8d%a2%e6%b5%81%e7%a8%8b%e5%9b%be" aria-label="1.2.1Â è½¬æ¢æµç¨‹å›¾">1.2.1Â è½¬æ¢æµç¨‹å›¾</a></li>
                <li>
                    <a href="#122%e8%bd%ac%e6%8d%a2%e5%90%8e%e7%9a%84nodeschema%e7%bb%93%e6%9e%84" aria-label="1.2.2Â è½¬æ¢åçš„NodeSchemaç»“æ„">1.2.2Â è½¬æ¢åçš„NodeSchemaç»“æ„</a></li>
                <li>
                    <a href="#123%e8%bd%ac%e6%8d%a2%e7%bb%93%e6%9e%84%e5%89%8d%e5%90%8e%e5%af%b9%e6%af%94" aria-label="1.2.3Â è½¬æ¢ç»“æ„å‰åå¯¹æ¯”">1.2.3Â è½¬æ¢ç»“æ„å‰åå¯¹æ¯”</a></li></ul>
                </li>
                <li>
                    <a href="#13%e5%b7%a5%e4%bd%9c%e6%b5%81%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b%e5%88%86%e6%9e%90" aria-label="1.3Â å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ">1.3Â å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e6%89%a7%e8%a1%8c%e5%9b%be%e7%bb%86%e8%8a%82" aria-label="å·¥ä½œæµæ‰§è¡Œå›¾Â (ç»†èŠ‚)">å·¥ä½œæµæ‰§è¡Œå›¾Â (ç»†èŠ‚)</a></li></ul>
                    </ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e6%a0%a1%e9%aa%8c" aria-label="å·¥ä½œæµæ ¡éªŒ">å·¥ä½œæµæ ¡éªŒ</a><ul>
                        
                <li>
                    <a href="#21%e5%b7%a5%e4%bd%9c%e6%b5%81%e9%aa%8c%e8%af%81%e6%b5%81%e7%a8%8b" aria-label="2.1Â å·¥ä½œæµéªŒè¯æµç¨‹">2.1Â å·¥ä½œæµéªŒè¯æµç¨‹</a><ul>
                        
                <li>
                    <a href="#211%e6%a0%b8%e5%bf%83%e9%aa%8c%e8%af%81%e6%b5%81%e7%a8%8b" aria-label="2.1.1Â æ ¸å¿ƒéªŒè¯æµç¨‹">2.1.1Â æ ¸å¿ƒéªŒè¯æµç¨‹</a></li>
                <li>
                    <a href="#212%e5%ae%8c%e6%95%b4%e9%aa%8c%e8%af%81%e6%b5%81%e7%a8%8b" aria-label="2.1.2Â å®Œæ•´éªŒè¯æµç¨‹">2.1.2Â å®Œæ•´éªŒè¯æµç¨‹</a></li>
                <li>
                    <a href="#213%e5%b7%a5%e4%bd%9c%e6%b5%81%e9%aa%8c%e8%af%81%e6%b5%81%e7%a8%8b%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e6%80%bb%e7%bb%93" aria-label="2.1.3Â å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“">2.1.3Â å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>
  <div class="post-content"><h1 id="cozeå·¥ä½œæµ-qa">Cozeå·¥ä½œæµ-QA<a hidden class="anchor" aria-hidden="true" href="#cozeå·¥ä½œæµ-qa">#</a></h1>
<blockquote>
<p>å·¥ä½œæµå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§æ¿å—ï¼šå·¥ä½œæµç®¡ç†Â (å‰åç«¯äº¤äº’-ç”»å¸ƒå­˜å‚¨)ã€å·¥ä½œæµæ ¡éªŒã€å·¥ä½œæµæ‰§è¡Œ</p></blockquote>
<h2 id="å·¥ä½œæµç®¡ç†">å·¥ä½œæµç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#å·¥ä½œæµç®¡ç†">#</a></h2>
<blockquote>
<p>å¯¹äºå‰ç«¯æ¥è®²ï¼Œå·¥ä½œæµå°±æ˜¯ä¸€å¼ canvasç”»å¸ƒã€‚ç”¨æˆ·å¯ä»¥åœ¨ç”»å¸ƒä¸­ï¼Œåˆ›å»ºä¸åŒåŠŸèƒ½çš„èŠ‚ç‚¹ã€‚</p></blockquote>
<blockquote>
<p>èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šå¼€å§‹å’Œç»“æŸèŠ‚ç‚¹Â ï¼ˆé»˜è®¤ï¼‰ã€LLMèŠ‚ç‚¹ã€å­å·¥ä½œæµÂ (åµŒå¥—)ã€æ’ä»¶Â (å¤–éƒ¨å·¥å…·-ä¾‹å¦‚MCPã€OCR)ã€ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹Â (é€‰æ‹©ã€å¾ªç¯ã€åˆ†ç±»ã€æ‰¹å¤„ç†(å¹¶å‘)ã€å˜é‡èšåˆ)ã€æ•°æ®åº“èŠ‚ç‚¹(SQLã€CRUD)ã€çŸ¥è¯†åº“èŠ‚ç‚¹(RAGã€å¢åˆ ã€å˜é‡èµ‹å€¼)ã€å›¾åƒå¤„ç†èŠ‚ç‚¹ã€éŸ³è§†é¢‘å¤„ç†èŠ‚ç‚¹ã€ç»„ä»¶(JSONåºåˆ—åŒ–ã€HTTPè¯·æ±‚)ã€å®šæ—¶è§¦å‘å™¨èŠ‚ç‚¹(å®šæ—¶è§¦å‘ä»»åŠ¡)</p></blockquote>
<p>å·¥ä½œæµå¤§ä½“æ‰§è¡Œæµç¨‹å¦‚ä¸‹</p>
<pre class="mermaid">graph TD
    subgraph "å‰ç«¯Canvaså±‚"
        A[Canvasç”»å¸ƒ<br/>ç”¨æˆ·å¯è§†åŒ–é…ç½®] --> B[NodeèŠ‚ç‚¹<br/>vo.Nodeç»“æ„ä½“]
        A --> C[Edgeè¿æ¥<br/>èŠ‚ç‚¹é—´å…³ç³»]
        B --> D[èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿ<br/>è¡¨å•å½¢å¼ï¼Ÿ]
    end
    
    subgraph "éªŒè¯å±‚"
        E[Canvasç»“æ„éªŒè¯<br/>CanvasValidator] --> F{éªŒè¯é€šè¿‡?}
        F -->|å¤±è´¥| G[è¿”å›é”™è¯¯ä¿¡æ¯]
        G --> H[å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º]
    end
    
    subgraph "è½¬æ¢å±‚"
        I[åç«¯ä¿å­˜ï¼Œworkflowè¿è¡Œ<br/>CanvasToWorkflowSchema] --> J[NodeType -> èŠ‚ç‚¹Config<br/>é€šè¿‡NodeAdaptoræ¥å£]
        J --> K[å‰ç«¯schema -> åç«¯schema<br/>schema.NodeSchema]
    end
    
    subgraph "å®ä¾‹åŒ–å±‚"
        L[èŠ‚ç‚¹å®ä¾‹åŒ–<br/>NodeBuilderæ¥å£] --> M[NodeSchema.Configs<br/>å®ç°NodeBuilderæ¥å£]
        M --> N[åç«¯schema -> èŠ‚ç‚¹å®ä¾‹<br/>å…·ä½“èŠ‚ç‚¹å¯¹è±¡]
    end
    
    subgraph "æ‰§è¡Œå±‚"
        O[èŠ‚ç‚¹è¿è¡Œ<br/>InvokableNodeç­‰æ¥å£] --> P[ä¸šåŠ¡é€»è¾‘<br/>å…·ä½“æ‰§è¡Œé€»è¾‘]
        P --> Q[ç»“æœè¾“å‡º<br/>è¿”å›æ‰§è¡Œç»“æœ]
    end
    
    A --> E
    F -->|é€šè¿‡| I
    K --> L
    N --> O
    
    style A fill:#e3f2fd
    style E fill:#ffebee
    style I fill:#fff3e0
    style L fill:#e8f5e8
    style O fill:#f3e5f5
</pre>

<h3 id="11ç”»å¸ƒå’Œåç«¯ç»“æ„">1.1Â ç”»å¸ƒå’Œåç«¯ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#11ç”»å¸ƒå’Œåç«¯ç»“æ„">#</a></h3>
<p>å‰ç«¯çš„ç”»å¸ƒé‡‡ç”¨DSLÂ (JSON)Â å½¢å¼å­˜å‚¨ï¼Œæ¯æ¬¡æ›´æ–°ç”»å¸ƒéƒ½æ˜¯å°†DSLä¼ ç»™åç«¯ã€‚DSLçš„åç«¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«èŠ‚ç‚¹Â (node)ã€Â è¾¹Â (edge)ã€Â ç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Canvas</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Nodes</span>    <span class="p">[]</span><span class="o">*</span><span class="nx">Node</span> <span class="s">`json:&#34;nodes&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Edges</span>    <span class="p">[]</span><span class="o">*</span><span class="nx">Edge</span> <span class="s">`json:&#34;edges&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Versions</span> <span class="kt">any</span>     <span class="s">`json:&#34;versions&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="111èŠ‚ç‚¹æ•°æ®">1.1.1Â èŠ‚ç‚¹æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#111èŠ‚ç‚¹æ•°æ®">#</a></h4>
<p>ç”»å¸ƒä¸­çš„èŠ‚ç‚¹ä¼šè½¬æ¢ä¸ºåç«¯ä¸­Â <code>backend/domain/workflow/entity/vo/canvas.go</code>Â ä¸­çš„Â NodeÂ ç»“æ„ä½“ï¼ŒÂ åç«¯å­˜å‚¨çš„ç»“æ„ä½“å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Node å·¥ä½œæµèŠ‚ç‚¹çš„å®Œæ•´å®šä¹‰</span>
</span></span><span class="line"><span class="cl"><span class="c1">// èŠ‚ç‚¹æ˜¯å·¥ä½œæµçš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–æ“ä½œ</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Node</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨ç”»å¸ƒä¸­å®šä½å’Œå¼•ç”¨èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span>      <span class="kt">string</span>    <span class="s">`json:&#34;id&#34;`</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹ç±»å‹ï¼Œå†³å®šèŠ‚ç‚¹çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼ˆå¦‚LLMã€APIè°ƒç”¨ã€æ¡ä»¶åˆ¤æ–­ç­‰ï¼‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Type</span>    <span class="nx">BlockType</span> <span class="s">`json:&#34;type&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…å«å‰ç«¯æ˜¾ç¤ºç›¸å…³çš„é…ç½® (å‰ç«¯çš„ä¸€äº›extendInfo)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Meta</span>    <span class="kt">any</span>       <span class="s">`json:&#34;meta&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®ï¼ŒåŒ…å«è¾“å…¥è¾“å‡ºé…ç½®å’Œå…·ä½“å‚æ•°ï¼Œä¾‹å¦‚LLMçš„é…ç½®ã€MCPçš„é…ç½®ã€å¼‚å¸¸å¤„ç†</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Data</span>    <span class="o">*</span><span class="nx">Data</span>     <span class="s">`json:&#34;data&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºå¤åˆèŠ‚ç‚¹ï¼ˆå¦‚å¾ªç¯ã€æ¡ä»¶åˆ†æ”¯ï¼‰çš„åµŒå¥—ç»“æ„</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Blocks</span>  <span class="p">[]</span><span class="o">*</span><span class="nx">Node</span>   <span class="s">`json:&#34;blocks,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹å†…éƒ¨çš„è¿çº¿ï¼Œç”¨äºå¤æ‚èŠ‚ç‚¹çš„å†…éƒ¨é€»è¾‘è¿æ¥</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Edges</span>   <span class="p">[]</span><span class="o">*</span><span class="nx">Edge</span>   <span class="s">`json:&#34;edges,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ï¼Œç”¨äºèŠ‚ç‚¹å®šä¹‰çš„ç‰ˆæœ¬æ§åˆ¶</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Version</span> <span class="kt">string</span>    <span class="s">`json:&#34;version,omitempty&#34;`</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// çˆ¶èŠ‚ç‚¹å¼•ç”¨ï¼Œä¸åºåˆ—åŒ–åˆ°JSONï¼Œç”¨äºå†…å­˜ä¸­çš„æ ‘å½¢ç»“æ„å¯¼èˆª</span>
</span></span><span class="line"><span class="cl">	<span class="nx">parent</span> <span class="o">*</span><span class="nx">Node</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®<code>Data</code>å¦‚ä¸‹æ‰€ç¤º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Data</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„æ˜¾ç¤ºå…ƒæ•°æ®ï¼Œå¦‚æ ‡é¢˜ã€iconç­‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Meta</span>    <span class="o">*</span><span class="nx">NodeMeta</span> <span class="s">`json:&#34;nodeMeta,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„è¾“å‡ºå®šä¹‰ï¼Œå¯ä»¥æ˜¯ []*Variable æˆ– []*Param ç±»å‹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Outputs</span> <span class="p">[]</span><span class="kt">any</span>     <span class="s">`json:&#34;outputs,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹çš„è¾“å…¥é…ç½®ï¼ŒåŒ…å«æ‰€æœ‰è¾“å…¥å‚æ•°å’Œè®¾ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Inputs</span>  <span class="o">*</span><span class="nx">Inputs</span>   <span class="s">`json:&#34;inputs,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// èŠ‚ç‚¹åœ¨ç”»å¸ƒä¸Šçš„å°ºå¯¸ä¿¡æ¯ï¼Œç”¨äºå‰ç«¯æ˜¾ç¤º</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Size</span>    <span class="kt">any</span>       <span class="s">`json:&#34;size,omitempty&#34;`</span>     
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>èŠ‚ç‚¹çš„è¾“å…¥å‚æ•°Â <code>inputs</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Inputs èŠ‚ç‚¹è¾“å…¥é…ç½®çš„ç»¼åˆç»“æ„</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™æ˜¯ä¸€ä¸ªè”åˆç»“æ„ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„èŠ‚ç‚¹è¾“å…¥é…ç½®ï¼Œä¸åŒç±»å‹çš„èŠ‚ç‚¹ä½¿ç”¨ä¸åŒçš„å­—æ®µå­é›†</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Inputs</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é€šç”¨è¾“å…¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">InputParameters</span>    <span class="p">[]</span><span class="o">*</span><span class="nx">Param</span>        <span class="s">`json:&#34;inputParameters&#34;`</span>              <span class="c1">// èŠ‚ç‚¹çš„è¾“å…¥å‚æ•°åˆ—è¡¨ï¼Œå®šä¹‰èŠ‚ç‚¹éœ€è¦çš„æ•°æ®è¾“å…¥</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Content</span>            <span class="o">*</span><span class="nx">BlockInput</span>     <span class="s">`json:&#34;content&#34;`</span>                      <span class="c1">// èŠ‚ç‚¹çš„ä¸»è¦å†…å®¹è¾“å…¥ï¼Œé€šå¸¸ç”¨äºæ–‡æœ¬å¤„ç†æˆ–æç¤ºè¯</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TerminatePlan</span>      <span class="o">*</span><span class="nx">TerminatePlan</span>  <span class="s">`json:&#34;terminatePlan,omitempty&#34;`</span>      <span class="c1">// ç»ˆæ­¢è®¡åˆ’ï¼Œå®šä¹‰èŠ‚ç‚¹å®Œæˆåçš„è¡Œä¸º</span>
</span></span><span class="line"><span class="cl">	<span class="nx">StreamingOutput</span>    <span class="kt">bool</span>            <span class="s">`json:&#34;streamingOutput,omitempty&#34;`</span>    <span class="c1">// æ˜¯å¦å¯ç”¨æµå¼è¾“å‡ºï¼Œç”¨äºå®æ—¶è¿”å›å¤„ç†ç»“æœ</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CallTransferVoice</span>  <span class="kt">bool</span>            <span class="s">`json:&#34;callTransferVoice,omitempty&#34;`</span>  <span class="c1">// è¯­éŸ³é€šè¯è½¬æ¥è®¾ç½®ï¼Œç”¨äºè¯­éŸ³ç›¸å…³èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ChatHistoryWriting</span> <span class="kt">string</span>          <span class="s">`json:&#34;chatHistoryWriting,omitempty&#34;`</span> <span class="c1">// èŠå¤©å†å²è®°å½•å†™å…¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LLMParam</span>           <span class="kt">any</span>             <span class="s">`json:&#34;llmParam,omitempty&#34;`</span>           <span class="c1">// LLMå‚æ•°ï¼Œå¯èƒ½æ˜¯LLMParamã€IntentDetectorLLMParamæˆ–QALLMParamç±»å‹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">FCParam</span>            <span class="o">*</span><span class="nx">FCParam</span>        <span class="s">`json:&#34;fcParam,omitempty&#34;`</span>            <span class="c1">// åŠŸèƒ½è°ƒç”¨å‚æ•°ï¼Œç”¨äºé…ç½®å·¥ä½œæµã€æ’ä»¶æˆ–çŸ¥è¯†åº“çš„è°ƒç”¨</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SettingOnError</span>     <span class="o">*</span><span class="nx">SettingOnError</span> <span class="s">`json:&#34;settingOnError,omitempty&#34;`</span>     <span class="c1">// é”™è¯¯å¤„ç†é…ç½®ï¼Œå®šä¹‰èŠ‚ç‚¹å‡ºé”™æ—¶çš„å¤„ç†ç­–ç•¥</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¾ªç¯æ§åˆ¶ç›¸å…³</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LoopType</span>           <span class="nx">LoopType</span>    <span class="s">`json:&#34;loopType,omitempty&#34;`</span>           <span class="c1">// å¾ªç¯ç±»å‹ï¼šæ•°ç»„å¾ªç¯ã€è®¡æ•°å¾ªç¯æˆ–æ— é™å¾ªç¯</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LoopCount</span>          <span class="o">*</span><span class="nx">BlockInput</span> <span class="s">`json:&#34;loopCount,omitempty&#34;`</span>          <span class="c1">// å¾ªç¯æ¬¡æ•°ï¼Œç”¨äºè®¡æ•°å¾ªç¯</span>
</span></span><span class="line"><span class="cl">	<span class="nx">VariableParameters</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Param</span>    <span class="s">`json:&#34;variableParameters,omitempty&#34;`</span> <span class="c1">// å¾ªç¯å˜é‡å‚æ•°</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¡ä»¶åˆ†æ”¯ç›¸å…³</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Branches</span> <span class="p">[]</span><span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Condition</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Logic</span>      <span class="nx">LogicType</span>    <span class="s">`json:&#34;logic&#34;`</span>      <span class="c1">// æ¡ä»¶é€»è¾‘ï¼šANDæˆ–OR</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Conditions</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Condition</span> <span class="s">`json:&#34;conditions&#34;`</span> <span class="c1">// å…·ä½“çš„æ¡ä»¶åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="s">`json:&#34;condition&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;branches,omitempty&#34;`</span> <span class="c1">// åˆ†æ”¯æ¡ä»¶é…ç½®ï¼Œç”¨äºæ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰¹å¤„ç†é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">NodeBatchInfo</span> <span class="o">*</span><span class="nx">NodeBatch</span> <span class="s">`json:&#34;batch,omitempty&#34;`</span> <span class="c1">// èŠ‚ç‚¹æ‰¹å¤„ç†æ¨¡å¼é…ç½®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç‰¹å®šèŠ‚ç‚¹ç±»å‹çš„é…ç½®ï¼ˆä½¿ç”¨åµŒå…¥ç»“æ„ä½“å®ç°ç±»å‹å¤šæ€ï¼‰</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">TextProcessor</span>      <span class="c1">// æ–‡æœ¬å¤„ç†å™¨é…ç½®ï¼šæ‹¼æ¥ã€åˆ†å‰²ç­‰æ“ä½œ</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">SubWorkflow</span>        <span class="c1">// å­å·¥ä½œæµé…ç½®ï¼šè°ƒç”¨å…¶ä»–å·¥ä½œæµ</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">IntentDetector</span>     <span class="c1">// æ„å›¾æ£€æµ‹é…ç½®ï¼šè¯†åˆ«ç”¨æˆ·æ„å›¾</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">DatabaseNode</span>       <span class="c1">// æ•°æ®åº“æ“ä½œé…ç½®ï¼šå¢åˆ æ”¹æŸ¥</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">HttpRequestNode</span>    <span class="c1">// HTTPè¯·æ±‚é…ç½®ï¼šAPIè°ƒç”¨</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">KnowledgeIndexer</span>   <span class="c1">// çŸ¥è¯†åº“ç´¢å¼•é…ç½®ï¼šæ–‡æ¡£å¤„ç†å’Œç´¢å¼•</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">CodeRunner</span>         <span class="c1">// ä»£ç æ‰§è¡Œå™¨é…ç½®ï¼šè¿è¡Œè‡ªå®šä¹‰ä»£ç </span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">PluginAPIParam</span>     <span class="c1">// æ’ä»¶APIå‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">VariableAggregator</span> <span class="c1">// å˜é‡èšåˆå™¨é…ç½®ï¼šåˆå¹¶å¤šä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">VariableAssigner</span>   <span class="c1">// å˜é‡èµ‹å€¼å™¨é…ç½®ï¼šè®¾ç½®å˜é‡å€¼</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">QA</span>                 <span class="c1">// é—®ç­”èŠ‚ç‚¹é…ç½®ï¼šå¤„ç†é—®é¢˜å’Œç­”æ¡ˆ</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">Batch</span>              <span class="c1">// æ‰¹å¤„ç†é…ç½®ï¼šæ‰¹é‡å¤„ç†æ•°æ®</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">Comment</span>            <span class="c1">// æ³¨é‡ŠèŠ‚ç‚¹é…ç½®ï¼šæ·»åŠ è¯´æ˜æ–‡å­—</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">OutputSchema</span> <span class="kt">string</span> <span class="s">`json:&#34;outputSchema,omitempty&#34;`</span> <span class="c1">// è¾“å‡ºæ¨¡å¼å®šä¹‰ï¼Œæè¿°èŠ‚ç‚¹è¾“å‡ºæ•°æ®çš„ç»“æ„</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="112è¾¹æ•°æ®">1.1.2Â è¾¹æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#112è¾¹æ•°æ®">#</a></h4>
<p>è¾¹ä¸»è¦æ˜¯åŒ…å«è¾“å…¥èŠ‚ç‚¹ã€è¾“å‡ºèŠ‚ç‚¹çš„IDï¼Œè¿˜æœ‰è¾“å…¥çš„ç«¯å£å’Œè¾“å‡ºçš„ç«¯å£Â ï¼ˆè¾“å…¥è¾“å‡ºç«¯å£éƒ½æ˜¯åªå­˜åœ¨äº<code>ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹</code>ä¸­ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Edge å·¥ä½œæµè¿çº¿å®šä¹‰</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿çº¿å®šä¹‰äº†èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼Œç¡®å®šå·¥ä½œæµçš„æ‰§è¡Œé¡ºåºå’Œæ•°æ®æµå‘</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Edge</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æºèŠ‚ç‚¹IDï¼Œè¿çº¿çš„èµ·å§‹èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SourceNodeID</span> <span class="kt">string</span> <span class="s">`json:&#34;sourceNodeID&#34;`</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ç›®æ ‡èŠ‚ç‚¹IDï¼Œè¿çº¿çš„ç»ˆæ­¢èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TargetNodeID</span> <span class="kt">string</span> <span class="s">`json:&#34;targetNodeID&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æºç«¯å£IDï¼Œç”¨äºå¤šè¾“å‡ºç«¯å£çš„èŠ‚ç‚¹ï¼ŒæŒ‡å®šå…·ä½“çš„è¾“å‡ºç«¯å£</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SourcePortID</span> <span class="kt">string</span> <span class="s">`json:&#34;sourcePortID,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç›®æ ‡ç«¯å£IDï¼Œç”¨äºå¤šè¾“å…¥ç«¯å£çš„èŠ‚ç‚¹ï¼ŒæŒ‡å®šå…·ä½“çš„è¾“å…¥ç«¯å£</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TargetPortID</span> <span class="kt">string</span> <span class="s">`json:&#34;targetPortID,omitempty&#34;`</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="113å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹notetypellm">1.1.3Â å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹Â (NoteTypeLLM)<a hidden class="anchor" aria-hidden="true" href="#113å¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹notetypellm">#</a></h4>
<h5 id="llmèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º">LLMèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º<a hidden class="anchor" aria-hidden="true" href="#llmèŠ‚ç‚¹ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤º">#</a></h5>
<pre class="mermaid">classDiagram
    class Inputs {
        +Param[] inputParameters
        +SettingOnError settingOnError
        +NodeBatch nodeBatchInfo
        +any llmParam
        +LLM llmSpecificConfig
    }

    class LLM {
        +FCParam fcParam
    }

    class LLMParam {
        +Param[] parameters
    }

    class SimpleLLMParam {
        +string generationDiversity
        +int maxTokens
        +string modelName
        +int64 modelType
        +ResponseFormat responseFormat
        +string systemPrompt
        +float64 temperature
        +float64 topP
    }

    class Param {
        +string name
        +BlockInput input
        +BlockInput left
        +BlockInput right
        +BlockInput[] variables
    }

    class BlockInput {
        +VariableType type
        +AssistType assistType
        +any schema
        +BlockInputValue value
    }

    class BlockInputValue {
        +BlockInputValueType type
        +any content
        +any rawMeta
    }

    class BlockInputReference {
        +string blockID
        +string name
        +string[] path
        +RefSourceType source
    }

    class FCParam {
        +WorkflowFCParam workflowFCParam
        +PluginFCParam pluginFCParam
        +KnowledgeFCParam knowledgeFCParam
    }

    class SettingOnError {
        +ErrorHandlingStrategy strategy
        +string customMessage
    }

    class NodeBatch {
        +int batchSize
        +int concurrentSize
    }

    Inputs --> LLM : "contains"
    Inputs --> LLMParam : "llmParam as"
    Inputs --> SimpleLLMParam : "llmParam as"
    Inputs --> Param : "contains"
    Inputs --> SettingOnError : "contains"
    Inputs --> NodeBatch : "contains"
    
    LLM --> FCParam : "contains"
    LLMParam --> Param : "contains"
    Param --> BlockInput : "contains"
    BlockInput --> BlockInputValue : "contains"
    BlockInputValue --> BlockInputReference : "content as"

    note for Inputs "LLMèŠ‚ç‚¹çš„æ‰€æœ‰è¾“å…¥é…ç½®<br/>åŒ…å«é€šç”¨è¾“å…¥å’ŒLLMä¸“ç”¨é…ç½®"
    note for LLMParam "æ ‡å‡†LLMå‚æ•°åˆ—è¡¨<br/>æ¯ä¸ªå‚æ•°éƒ½æ˜¯Paramç±»å‹"
    note for SimpleLLMParam "ç®€åŒ–çš„LLMå‚æ•°ç»“æ„<br/>ç›´æ¥åŒ…å«æ‰€æœ‰LLMé…ç½®å­—æ®µ"
    note for FCParam "å‡½æ•°è°ƒç”¨èƒ½åŠ›é…ç½®<br/>LLMå¯è°ƒç”¨çš„å¤–éƒ¨å·¥å…·"
</pre>

<h5 id="llmå‚æ•°-simplellmparam">LLMå‚æ•°Â -Â <code>SimpleLLMParam</code><a hidden class="anchor" aria-hidden="true" href="#llmå‚æ•°-simplellmparam">#</a></h5>
<p><code>SimpleLLMParam</code>å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«å¤šæ ·æ€§ç¨‹åº¦ã€æœ€å¤§Tokenã€æ¨¡å‹åç§°ã€æ¨¡å‹ç±»å‹ã€å“åº”æ ¼å¼ã€ç³»ç»Ÿæç¤ºè¯ã€<code>Temperature</code>æ¸©åº¦ã€<code>TopP</code>Â æ ¸é‡‡æ ·å‚æ•°</p>
<p>ã€æ³¨æ„ã€‘<code>generationDiversity</code>å¤šæ ·æ€§ç¨‹åº¦Â æ˜¯é«˜å±‚çš„é¢„è®¾ç­–ç•¥ï¼ˆå¦‚&quot;åˆ›æ„/å¹³è¡¡/ç²¾ç¡®&quot;æ¨¡å¼ï¼‰ï¼Œè€ŒÂ <code>temperature</code>å’ŒÂ <code>topP</code>æ˜¯åº•å±‚çš„å…·ä½“ç®—æ³•å‚æ•°ï¼Œå‰è€…é€šè¿‡å†…ç½®çš„å‚æ•°ç»„åˆæ¥ç®€åŒ–é…ç½®ï¼Œåè€…åˆ™æä¾›ç²¾ç¡®çš„éšæœºæ€§æ§åˆ¶ï¼ˆtemperatureè°ƒèŠ‚æ¦‚ç‡åˆ†å¸ƒå¹³æ»‘åº¦ï¼ŒtopPé™åˆ¶å€™é€‰è¯æ±‡èŒƒå›´ï¼‰ã€‚</p>
<p>ç®€å•è¯´ï¼šgenerationDiversityÂ =Â &ldquo;æˆ‘è¦ä»€ä¹ˆé£æ ¼&rdquo;ï¼ŒtemperatureÂ =Â &ldquo;è¦å¤šéšæœº&rdquo;ï¼ŒtopPÂ =Â &ldquo;è€ƒè™‘å¤šå°‘è¯æ±‡&rdquo;ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// SimpleLLMParam ç®€åŒ–çš„å¤§è¯­è¨€æ¨¡å‹å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æä¾›ç›´æ¥çš„å­—æ®µæ˜ å°„æ–¹å¼é…ç½®LLMå‚æ•°ï¼Œé€‚ç”¨äºç®€å•çš„æ¨¡å‹è°ƒç”¨åœºæ™¯</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SimpleLLMParam</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// GenerationDiversity ç”Ÿæˆå¤šæ ·æ€§é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„å¤šæ ·æ€§ç¨‹åº¦ï¼Œå½±å“ç”Ÿæˆå†…å®¹çš„åˆ›æ–°æ€§</span>
</span></span><span class="line"><span class="cl">	<span class="nx">GenerationDiversity</span> <span class="kt">string</span> <span class="s">`json:&#34;generationDiversity&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// MaxTokens æœ€å¤§ç”Ÿæˆä»¤ç‰Œæ•°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é™åˆ¶æ¨¡å‹å•æ¬¡ç”Ÿæˆçš„æœ€å¤§tokenæ•°é‡ï¼Œæ§åˆ¶è¾“å‡ºé•¿åº¦</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxTokens</span> <span class="kt">int</span> <span class="s">`json:&#34;maxTokens&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ModelName æ¨¡å‹åç§°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æŒ‡å®šè¦ä½¿ç”¨çš„å…·ä½“æ¨¡å‹åç§°ï¼Œå¦‚gpt-3.5-turboã€gpt-4ç­‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ModelName</span> <span class="kt">string</span> <span class="s">`json:&#34;modelName&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ModelType æ¨¡å‹ç±»å‹æ ‡è¯†</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨äºåŒºåˆ†ä¸åŒç±»å‹çš„æ¨¡å‹ï¼Œå¦‚èŠå¤©æ¨¡å‹ã€è¡¥å…¨æ¨¡å‹ç­‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ModelType</span> <span class="kt">int64</span> <span class="s">`json:&#34;modelType&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ResponseFormat å“åº”æ ¼å¼é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æŒ‡å®šæ¨¡å‹è¾“å‡ºçš„æ ¼å¼ï¼Œæ”¯æŒæ–‡æœ¬ã€JSONã€Markdownç­‰æ ¼å¼</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ResponseFormat</span> <span class="nx">model</span><span class="p">.</span><span class="nx">ResponseFormat</span> <span class="s">`json:&#34;responseFormat&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// SystemPrompt ç³»ç»Ÿæç¤ºè¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰æ¨¡å‹çš„ç³»ç»Ÿçº§æŒ‡ä»¤ï¼Œè®¾å®šæ¨¡å‹çš„è§’è‰²å’Œè¡Œä¸ºè§„èŒƒ</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SystemPrompt</span> <span class="kt">string</span> <span class="s">`json:&#34;systemPrompt&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Temperature æ¸©åº¦å‚æ•°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ï¼ŒèŒƒå›´é€šå¸¸ä¸º0.0-1.0ï¼Œå€¼è¶Šé«˜è¾“å‡ºè¶Šéšæœº</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é€šè¿‡è°ƒæ•´softmaxæ¦‚ç‡åˆ†å¸ƒçš„å¹³æ»‘åº¦æ¥å½±å“è¯æ±‡é€‰æ‹©çš„ç¡®å®šæ€§</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Temperature</span> <span class="kt">float64</span> <span class="s">`json:&#34;temperature&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TopP æ ¸é‡‡æ ·å‚æ•°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ§åˆ¶æ¨¡å‹ç”Ÿæˆæ—¶è€ƒè™‘çš„è¯æ±‡æ¦‚ç‡è´¨é‡ï¼Œå½±å“è¾“å‡ºçš„å¤šæ ·æ€§å’Œè´¨é‡</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é€šè¿‡è®¾ç½®æ¦‚ç‡ç´¯ç§¯é˜ˆå€¼æ¥é™åˆ¶å€™é€‰è¯æ±‡çš„èŒƒå›´ï¼ŒèŒƒå›´é€šå¸¸ä¸º0.0-1.0</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TopP</span> <span class="kt">float64</span> <span class="s">`json:&#34;topP&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h5 id="llmä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°fcparam">LLMä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°Â <code>**FcParam**</code><a hidden class="anchor" aria-hidden="true" href="#llmä¸­çš„å‡½æ•°è°ƒç”¨å‚æ•°fcparam">#</a></h5>
<p>functionCallingÂ ï¼ˆå¤§è¯­è¨€æ¨¡å‹èŠ‚ç‚¹çš„â€œæŠ€èƒ½â€ï¼‰ä¸­éœ€è¦ç”¨åˆ°çš„å‚æ•°</p>
<pre class="mermaid">graph TD
    A[ç”¨æˆ·è¾“å…¥é—®é¢˜] --> B[LLMèŠ‚ç‚¹æ¥æ”¶]
    B --> C{LLMåˆ†ææ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·}
    
    C -->|éœ€è¦è°ƒç”¨| D[FCParam å·¥å…·é…ç½®]
    C -->|ä¸éœ€è¦| E[ç›´æ¥ç”Ÿæˆå›ç­”]
    
    D --> F[WorkflowFCParam<br/>å­å·¥ä½œæµè°ƒç”¨]
    D --> G[PluginFCParam<br/>æ’ä»¶APIè°ƒç”¨]  
    D --> H[KnowledgeFCParam<br/>çŸ¥è¯†åº“æ£€ç´¢]
    
    F --> F1[é…ç½®å¯è°ƒç”¨çš„å­å·¥ä½œæµåˆ—è¡¨]
    F --> F2[å®šä¹‰è¯·æ±‚/å“åº”å‚æ•°]
    F --> F3[æ‰§è¡Œå­å·¥ä½œæµ]
    
    G --> G1[é…ç½®å¯è°ƒç”¨çš„æ’ä»¶APIåˆ—è¡¨]
    G --> G2[å®šä¹‰APIå‚æ•°å’Œå“åº”æ ¼å¼]
    G --> G3[è°ƒç”¨ç¬¬ä¸‰æ–¹æ’ä»¶æœåŠ¡]
    
    H --> H1[é…ç½®çŸ¥è¯†åº“åˆ—è¡¨]
    H --> H2[è®¾ç½®æ£€ç´¢ç­–ç•¥<br/>TopK/MinScore/æœç´¢æ¨¡å¼]
    H --> H3[æ‰§è¡ŒçŸ¥è¯†åº“æ£€ç´¢]
    
    F3 --> I[å·¥å…·æ‰§è¡Œç»“æœ]
    G3 --> I
    H3 --> I
    
    I --> J[LLMæ•´åˆå·¥å…·ç»“æœ]
    J --> K[ç”Ÿæˆæœ€ç»ˆå›ç­”]
    E --> K
    
    K --> L[è¿”å›ç»™ç”¨æˆ·]
    
    style A fill:#e1f5fe
    style D fill:#fff3e0
    style F fill:#f3e5f5
    style G fill:#e8f5e8
    style H fill:#fce4ec
    style K fill:#e0f2f1
</pre>

<p>å‡½æ•°è°ƒç”¨å‚æ•°Â <code>FcParam</code>ä¸»è¦åŒ…å«ä¸‰ç§æ¨¡å¼ï¼šå­å·¥ä½œæµè°ƒç”¨ã€æ’ä»¶APIè°ƒç”¨ã€çŸ¥è¯†åº“æ£€ç´¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// FCParam å‡½æ•°è°ƒç”¨å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºé…ç½®å·¥ä½œæµä¸­ä¸åŒç±»å‹çš„å‡½æ•°è°ƒç”¨èƒ½åŠ›ï¼ŒåŒ…æ‹¬å­å·¥ä½œæµè°ƒç”¨ã€æ’ä»¶APIè°ƒç”¨å’ŒçŸ¥è¯†åº“æ£€ç´¢è°ƒç”¨</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">FCParam</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// WorkflowFCParam å·¥ä½œæµå‡½æ•°è°ƒç”¨å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½®å½“å‰å·¥ä½œæµå¯ä»¥è°ƒç”¨çš„å­å·¥ä½œæµåˆ—è¡¨åŠå…¶å‚æ•°è®¾ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">WorkflowFCParam</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// WorkflowList å¯è°ƒç”¨çš„å·¥ä½œæµåˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ¯ä¸ªå·¥ä½œæµé¡¹åŒ…å«å·¥ä½œæµæ ‡è¯†ã€ç‰ˆæœ¬ä¿¡æ¯å’Œå‡½æ•°è°ƒç”¨è®¾ç½®</span>
</span></span><span class="line"><span class="cl">		<span class="nx">WorkflowList</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// WorkflowID å·¥ä½œæµå”¯ä¸€æ ‡è¯†ç¬¦</span>
</span></span><span class="line"><span class="cl">			<span class="nx">WorkflowID</span> <span class="kt">string</span> <span class="s">`json:&#34;workflow_id&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// WorkflowVersion å·¥ä½œæµç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">			<span class="nx">WorkflowVersion</span> <span class="kt">string</span> <span class="s">`json:&#34;workflow_version&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// PluginID å…³è”çš„æ’ä»¶IDï¼ˆå¦‚æœå·¥ä½œæµåŸºäºæ’ä»¶ï¼‰</span>
</span></span><span class="line"><span class="cl">			<span class="nx">PluginID</span> <span class="kt">string</span> <span class="s">`json:&#34;plugin_id&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// PluginVersion æ’ä»¶ç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">			<span class="nx">PluginVersion</span> <span class="kt">string</span> <span class="s">`json:&#34;plugin_version&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// IsDraft æ˜¯å¦ä¸ºè‰ç¨¿ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">			<span class="nx">IsDraft</span> <span class="kt">bool</span> <span class="s">`json:&#34;is_draft&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// FCSetting å‡½æ•°è°ƒç”¨è®¾ç½®</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å®šä¹‰è°ƒç”¨è¯¥å·¥ä½œæµæ—¶çš„è¯·æ±‚å’Œå“åº”å‚æ•°ç»“æ„</span>
</span></span><span class="line"><span class="cl">			<span class="nx">FCSetting</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// RequestParameters è¯·æ±‚å‚æ•°åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// å®šä¹‰è°ƒç”¨å·¥ä½œæµæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°</span>
</span></span><span class="line"><span class="cl">				<span class="nx">RequestParameters</span> <span class="p">[]</span><span class="o">*</span><span class="nx">workflow</span><span class="p">.</span><span class="nx">APIParameter</span> <span class="s">`json:&#34;request_params&#34;`</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// ResponseParameters å“åº”å‚æ•°åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// å®šä¹‰å·¥ä½œæµæ‰§è¡Œå®Œæˆåè¿”å›çš„å‚æ•°</span>
</span></span><span class="line"><span class="cl">				<span class="nx">ResponseParameters</span> <span class="p">[]</span><span class="o">*</span><span class="nx">workflow</span><span class="p">.</span><span class="nx">APIParameter</span> <span class="s">`json:&#34;response_params&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="s">`json:&#34;fc_setting,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="s">`json:&#34;workflowList,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;workflowFCParam,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// PluginFCParam æ’ä»¶å‡½æ•°è°ƒç”¨å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½®å½“å‰å·¥ä½œæµå¯ä»¥è°ƒç”¨çš„æ’ä»¶APIåˆ—è¡¨åŠå…¶å‚æ•°è®¾ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PluginFCParam</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// PluginList å¯è°ƒç”¨çš„æ’ä»¶åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ¯ä¸ªæ’ä»¶é¡¹åŒ…å«æ’ä»¶æ ‡è¯†ã€APIä¿¡æ¯å’Œå‡½æ•°è°ƒç”¨è®¾ç½®</span>
</span></span><span class="line"><span class="cl">		<span class="nx">PluginList</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// PluginID æ’ä»¶å”¯ä¸€æ ‡è¯†ç¬¦</span>
</span></span><span class="line"><span class="cl">			<span class="nx">PluginID</span> <span class="kt">string</span> <span class="s">`json:&#34;plugin_id&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// ApiId APIæ¥å£å”¯ä¸€æ ‡è¯†ç¬¦</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ApiId</span> <span class="kt">string</span> <span class="s">`json:&#34;api_id&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// ApiName APIæ¥å£åç§°</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ApiName</span> <span class="kt">string</span> <span class="s">`json:&#34;api_name&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// PluginVersion æ’ä»¶ç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">			<span class="nx">PluginVersion</span> <span class="kt">string</span> <span class="s">`json:&#34;plugin_version&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// IsDraft æ˜¯å¦ä¸ºè‰ç¨¿ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">			<span class="nx">IsDraft</span> <span class="kt">bool</span> <span class="s">`json:&#34;is_draft&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// FCSetting å‡½æ•°è°ƒç”¨è®¾ç½®</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å®šä¹‰è°ƒç”¨è¯¥æ’ä»¶APIæ—¶çš„è¯·æ±‚å’Œå“åº”å‚æ•°ç»“æ„</span>
</span></span><span class="line"><span class="cl">			<span class="nx">FCSetting</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// RequestParameters è¯·æ±‚å‚æ•°åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// å®šä¹‰è°ƒç”¨æ’ä»¶APIæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°</span>
</span></span><span class="line"><span class="cl">				<span class="nx">RequestParameters</span> <span class="p">[]</span><span class="o">*</span><span class="nx">workflow</span><span class="p">.</span><span class="nx">APIParameter</span> <span class="s">`json:&#34;request_params&#34;`</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// ResponseParameters å“åº”å‚æ•°åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// å®šä¹‰æ’ä»¶APIæ‰§è¡Œå®Œæˆåè¿”å›çš„å‚æ•°</span>
</span></span><span class="line"><span class="cl">				<span class="nx">ResponseParameters</span> <span class="p">[]</span><span class="o">*</span><span class="nx">workflow</span><span class="p">.</span><span class="nx">APIParameter</span> <span class="s">`json:&#34;response_params&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="s">`json:&#34;fc_setting,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;pluginFCParam,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// KnowledgeFCParam çŸ¥è¯†åº“å‡½æ•°è°ƒç”¨å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½®å½“å‰å·¥ä½œæµçš„çŸ¥è¯†åº“æ£€ç´¢åŠŸèƒ½åŠå…¶å…¨å±€è®¾ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">KnowledgeFCParam</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// GlobalSetting çŸ¥è¯†åº“æ£€ç´¢å…¨å±€è®¾ç½®</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢çš„é€šç”¨é…ç½®å‚æ•°</span>
</span></span><span class="line"><span class="cl">		<span class="nx">GlobalSetting</span> <span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// SearchMode æœç´¢æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢ä½¿ç”¨çš„æœç´¢ç®—æ³•æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">			<span class="nx">SearchMode</span> <span class="kt">int64</span> <span class="s">`json:&#34;search_mode&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// TopK è¿”å›ç»“æœæ•°é‡</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢è¿”å›çš„æœ€å¤§ç»“æœæ•°é‡</span>
</span></span><span class="line"><span class="cl">			<span class="nx">TopK</span> <span class="kt">int64</span> <span class="s">`json:&#34;top_k&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// MinScore æœ€å°ç›¸ä¼¼åº¦åˆ†æ•°</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å®šä¹‰çŸ¥è¯†åº“æ£€ç´¢ç»“æœçš„æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl">			<span class="nx">MinScore</span> <span class="kt">float64</span> <span class="s">`json:&#34;min_score&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// UseNL2SQL æ˜¯å¦å¯ç”¨è‡ªç„¶è¯­è¨€è½¬SQLåŠŸèƒ½</span>
</span></span><span class="line"><span class="cl">			<span class="nx">UseNL2SQL</span> <span class="kt">bool</span> <span class="s">`json:&#34;use_nl2_sql&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// UseRewrite æ˜¯å¦å¯ç”¨æŸ¥è¯¢é‡å†™åŠŸèƒ½</span>
</span></span><span class="line"><span class="cl">			<span class="nx">UseRewrite</span> <span class="kt">bool</span> <span class="s">`json:&#34;use_rewrite&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// UseRerank æ˜¯å¦å¯ç”¨ç»“æœé‡æ’åºåŠŸèƒ½</span>
</span></span><span class="line"><span class="cl">			<span class="nx">UseRerank</span> <span class="kt">bool</span> <span class="s">`json:&#34;use_rerank&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// NoRecallReplyCustomizePrompt æ— å¬å›ç»“æœæ—¶çš„è‡ªå®šä¹‰å›å¤æç¤ºè¯</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NoRecallReplyCustomizePrompt</span> <span class="kt">string</span> <span class="s">`json:&#34;no_recall_reply_customize_prompt&#34;`</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// NoRecallReplyMode æ— å¬å›ç»“æœæ—¶çš„å›å¤æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NoRecallReplyMode</span> <span class="kt">int64</span> <span class="s">`json:&#34;no_recall_reply_mode&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="s">`json:&#34;global_setting,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// KnowledgeList å¯æ£€ç´¢çš„çŸ¥è¯†åº“åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰å½“å‰å·¥ä½œæµå¯ä»¥æ£€ç´¢çš„çŸ¥è¯†åº“é›†åˆ</span>
</span></span><span class="line"><span class="cl">		<span class="nx">KnowledgeList</span> <span class="p">[]</span><span class="o">*</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// ID çŸ¥è¯†åº“å”¯ä¸€æ ‡è¯†ç¬¦</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ID</span> <span class="kt">string</span> <span class="s">`json:&#34;id&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="s">`json:&#34;knowledgeList,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;knowledgeFCParam,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol>
<li>å­å·¥ä½œæµè°ƒç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;workflowFCParam&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;workflowList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;workflow_id&#34;</span><span class="p">:</span> <span class="s2">&#34;7509120431183544356&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;workflow_version&#34;</span><span class="p">:</span> <span class="s2">&#34;v0.0.1&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;plugin_id&#34;</span><span class="p">:</span> <span class="s2">&#34;7509121334769795126&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;is_draft&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;fc_setting&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;request_params&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">...</span><span class="p">],</span>  <span class="c1">// è°ƒç”¨å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nt">&#34;response_params&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">...</span><span class="p">]</span>  <span class="c1">// è¿”å›å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="2">
<li>æ’ä»¶APIè°ƒç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;pluginFCParam&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;pluginList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;plugin_id&#34;</span><span class="p">:</span> <span class="s2">&#34;7509353177339133952&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;api_id&#34;</span><span class="p">:</span> <span class="s2">&#34;7509353598782816256&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;api_name&#34;</span><span class="p">:</span> <span class="s2">&#34;å‘¨å…¬è§£æ¢¦&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;plugin_version&#34;</span><span class="p">:</span> <span class="s2">&#34;0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;fc_setting&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;request_params&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;desc&#34;</span><span class="p">:</span> <span class="s2">&#34;æŸ¥è¯¢è§£æ¢¦æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šæ¢¦è§è›‡&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;is_required&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;response_params&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="3">
<li>çŸ¥è¯†åº“æ£€ç´¢</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;knowledgeFCParam&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;knowledgeList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;7512369185624686592&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;æ—…æ¸¸æ™¯ç‚¹&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;global_setting&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;top_k&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nt">&#34;min_score&#34;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;search_mode&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;use_rerank&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;use_rewrite&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;use_nl2_sql&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;no_recall_reply_mode&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;no_recall_reply_customize_prompt&#34;</span><span class="p">:</span> <span class="s2">&#34;æŠ±æ­‰ï¼Œæ‚¨çš„é—®é¢˜è¶…å‡ºäº†æˆ‘çš„çŸ¥è¯†èŒƒå›´&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h4 id="114blockinputç»“æ„">1.1.4Â BlockInputç»“æ„<a hidden class="anchor" aria-hidden="true" href="#114blockinputç»“æ„">#</a></h4>
<p><code>BlockInput</code>æ˜¯å·¥ä½œæµç³»ç»Ÿä¸­çš„æ•°æ®ç»‘å®šæ ¸å¿ƒï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼šå¦‚ä½•åœ¨å·¥ä½œæµèŠ‚ç‚¹ä¹‹é—´ä¼ é€’å’Œé…ç½®æ•°æ®ã€‚<code>BlockInputÂ =Â &quot;è¿™ä¸ªè¾“å…¥æ¡†é‡Œæ”¾ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œæ¥&quot;</code></p>
<pre class="mermaid">graph TD
    A[BlockInput å—è¾“å…¥é…ç½®] --> B[Type: æ•°æ®ç±»å‹]
    A --> C[AssistType: è¾…åŠ©ç±»å‹]
    A --> D[Schema: ç»“æ„å®šä¹‰]
    A --> E[Value: è¾“å…¥å€¼é…ç½®]
    
    E --> F[BlockInputValue]
    F --> G[Type: å€¼ç±»å‹]
    F --> H[Content: å…·ä½“å†…å®¹]
    F --> I[RawMeta: å…ƒæ•°æ®]
    
    G --> G1[literal: å­—é¢å€¼]
    G --> G2[ref: èŠ‚ç‚¹å¼•ç”¨]
    G --> G3[object_ref: å¯¹è±¡å¼•ç”¨]
    
    H --> H1[é™æ€æ–‡æœ¬/æ•°å€¼]
    H --> H2[BlockInputReference]
    
    H2 --> J[BlockID: æºèŠ‚ç‚¹ID]
    H2 --> K[Name: å­—æ®µåç§°]
    H2 --> L[Path: è®¿é—®è·¯å¾„]
    H2 --> M[Source: å¼•ç”¨æºç±»å‹]
    
    M --> M1[block-output: èŠ‚ç‚¹è¾“å‡º]
    M --> M2[global_variable_app: åº”ç”¨å˜é‡]
    M --> M3[global_variable_system: ç³»ç»Ÿå˜é‡]
    M --> M4[global_variable_user: ç”¨æˆ·å˜é‡]
    
    N[å®é™…ä½¿ç”¨åœºæ™¯] --> N1[é™æ€é…ç½®: å›ºå®šå€¼]
    N --> N2[åŠ¨æ€ç»‘å®š: å¼•ç”¨å…¶ä»–èŠ‚ç‚¹]
    N --> N3[æ¨¡æ¿æ¸²æŸ“: å˜é‡æ›¿æ¢]
    N --> N4[å¤æ‚å¯¹è±¡: åµŒå¥—ç»“æ„]
    
    style A fill:#e1f5fe
    style F fill:#fff3e0
    style H2 fill:#f3e5f5
    style N fill:#e8f5e8
</pre>

<p><code>BlockInput</code>ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">BlockInput</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Type</span>       <span class="nx">VariableType</span>     <span class="c1">// æ•°æ®ç±»å‹ï¼šstringã€numberã€objectç­‰</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AssistType</span> <span class="nx">AssistType</span>       <span class="c1">// è¾…åŠ©ç±»å‹ï¼šæ›´å…·ä½“çš„ç±»å‹æè¿°</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Schema</span>     <span class="kt">any</span>              <span class="c1">// ç»“æ„å®šä¹‰ï¼šå¤æ‚å¯¹è±¡çš„å†…éƒ¨ç»“æ„</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Value</span>      <span class="o">*</span><span class="nx">BlockInputValue</span> <span class="c1">// å€¼é…ç½®ï¼šå…·ä½“çš„æ•°æ®æ¥æº</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¸‰ç§æ•°æ®æµæ¥æºï¼šå¸¸é‡<code>literal</code>ã€èŠ‚ç‚¹å¼•ç”¨<code>ref</code>ã€å¯¹è±¡å¼•ç”¨Â <code>ObjectÂ Ref</code></p>
<ol>
<li>å¸¸é‡<code>literal</code></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;value&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;literal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;content&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;rawMeta&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="2">
<li>èŠ‚ç‚¹å¼•ç”¨<code>ref</code>Â (æœ€å¸¸ç”¨çš„)</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;string&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="s">&#34;value&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;ref&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;blockID&#34;</span><span class="p">:</span> <span class="s">&#34;100001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;output&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;source&#34;</span><span class="p">:</span> <span class="s">&#34;block-output&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="3">
<li>Â å¯¹è±¡å¼•ç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;object&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;schema&#34;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;string&#34;</span><span class="p">}],</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;value&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;type&#34;</span><span class="p">:</span> <span class="s">&#34;object_ref&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;blockID&#34;</span><span class="p">:</span> <span class="s">&#34;100001&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;person&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;source&#34;</span><span class="p">:</span> <span class="s">&#34;block-output&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="115çŸ¥è¯†åº“èŠ‚ç‚¹rag">1.1.5Â çŸ¥è¯†åº“èŠ‚ç‚¹Â (RAG)<a hidden class="anchor" aria-hidden="true" href="#115çŸ¥è¯†åº“èŠ‚ç‚¹rag">#</a></h4>
<h5 id="ragå®Œæ•´æµç¨‹å›¾">RAGå®Œæ•´æµç¨‹å›¾<a hidden class="anchor" aria-hidden="true" href="#ragå®Œæ•´æµç¨‹å›¾">#</a></h5>
<p>ä¸€ä¸ªå®Œæ•´çš„RAGæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>æŸ¥è¯¢é‡å†™ä¼˜åŒ–Â ï¼ˆå°æ¨¡å‹ï¼‰-&gt;Â è‡ªç„¶è¯­è¨€è½¬SQLÂ ï¼ˆNL2SQLï¼‰-&gt;Â å‘é‡æ£€ç´¢Â (è¯­ä¹‰æœç´¢/æ··åˆæœç´¢/å…¨é‡æœç´¢)Â -&gt;Â ç›¸ä¼¼åº¦è¿‡æ»¤Â (æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼)Â -&gt;Â ç»“æœé‡æ’åºÂ (Rerank)Â -&gt;Â TopKç»“æœæˆªå–Â -&gt;Â æ„å»ºæ–°çš„ä¸Šä¸‹æ–‡æç¤ºè¯</p>
<pre class="mermaid">graph LR
    A[ç”¨æˆ·è¾“å…¥æŸ¥è¯¢] --> B[æŸ¥è¯¢é¢„å¤„ç†]
    
    B --> B1[UseRewrite: æŸ¥è¯¢é‡å†™]
    B1 --> B2[ä¼˜åŒ–æŸ¥è¯¢è¯­ä¹‰]
    B2 --> B3[UseNL2SQL: è‡ªç„¶è¯­è¨€è½¬SQL]
    
    B3 --> C[å‘é‡æ£€ç´¢é˜¶æ®µ]
    C --> C1[æ–‡æ¡£å‘é‡åŒ–]
    C --> C2[æŸ¥è¯¢å‘é‡åŒ–] 
    C1 --> C3[å‘é‡ç›¸ä¼¼åº¦è®¡ç®—]
    C2 --> C3
    
    C3 --> D[SearchMode: æœç´¢ç­–ç•¥]
    D --> D1[0: è¯­ä¹‰æœç´¢<br/>Semantic Search]
    D --> D2[1: æ··åˆæœç´¢<br/>Hybrid Search]
    D --> D3[20: å…¨æ–‡æœç´¢<br/>Full-text Search]
    
    D1 --> E[åˆæ­¥ç»“æœç­›é€‰]
    D2 --> E
    D3 --> E
    
    E --> E1[MinScore: ç›¸ä¼¼åº¦è¿‡æ»¤]
    E1 --> E2[è¿‡æ»¤ä½è´¨é‡ç»“æœ]
    
    E2 --> F[UseRerank: ç»“æœé‡æ’åº]
    F --> F1[æ·±åº¦è¯­ä¹‰åŒ¹é…]
    F1 --> F2[é‡æ–°æ’åºç»“æœ]
    
    F2 --> G[TopK: ç»“æœæˆªå–]
    G --> G1[é€‰æ‹©å‰Kä¸ªæœ€ä½³ç»“æœ]
    
    G1 --> H{æ˜¯å¦æœ‰åˆé€‚ç»“æœ?}
    H -->|æœ‰| I[æ„å»ºå¢å¼ºä¸Šä¸‹æ–‡]
    H -->|æ— | J[NoRecallReplyModeå¤„ç†]
    
    J --> J1[0: ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯]
    J --> J2[1: å…¶ä»–å¤„ç†æ¨¡å¼]
    J1 --> K[è¿”å›æ— ç»“æœå›å¤]
    J2 --> K
    
    I --> L[RAGç”Ÿæˆé˜¶æ®µ]
    L --> L1[ç»„åˆæŸ¥è¯¢+æ£€ç´¢å†…å®¹]
    L1 --> L2[LLMç”Ÿæˆå¢å¼ºå›ç­”]
    
    L2 --> M[è¿”å›æœ€ç»ˆç­”æ¡ˆ]
    K --> M
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style F fill:#fce4ec
    style L fill:#e0f2f1
</pre>

<h5 id="å‘é‡æ£€ç´¢è§„åˆ™">å‘é‡æ£€ç´¢è§„åˆ™<a hidden class="anchor" aria-hidden="true" href="#å‘é‡æ£€ç´¢è§„åˆ™">#</a></h5>
<pre class="mermaid">graph TD
    A[ç”¨æˆ·æŸ¥è¯¢] --> B{SearchModeé€‰æ‹©}
    
    B -->|0: è¯­ä¹‰æœç´¢| C[Semantic Search]
    B -->|1: æ··åˆæœç´¢| D[Hybrid Search]  
    B -->|20: å…¨æ–‡æœç´¢| E[Full-text Search]
    
    C --> C1[Step1: æŸ¥è¯¢å‘é‡åŒ–]
    C1 --> C2[Embedding Model]
    C2 --> C3[Query Vector]
    
    C3 --> C4[Step2: æ–‡æ¡£å‘é‡åŒ¹é…]
    C4 --> C5[å‘é‡æ•°æ®åº“]
    C5 --> C6[ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—]
    
    D --> D1[Step1: å‘é‡æœç´¢è·¯å¾„]
    D --> D2[Step2: å…³é”®è¯æœç´¢è·¯å¾„]
    
    D1 --> D3[Embeddingæ£€ç´¢]
    D2 --> D4[BM25ç®—æ³•]
    D3 --> D5[ç»“æœèåˆç®—æ³•]
    D4 --> D5
    
    E --> E1[Step1: åˆ†è¯å¤„ç†]
    E1 --> E2[åˆ†è¯å™¨]
    E2 --> E3[Step2: å€’æ’ç´¢å¼•]
    E3 --> E4[æœç´¢å¼•æ“]
    E4 --> E5[TF-IDFè¯„åˆ†]
    
    C6 --> F[è¯­ä¹‰ç†è§£å¼º]
    D5 --> G[å¹³è¡¡ç²¾ç¡®æ€§å’Œè¯­ä¹‰]
    E5 --> H[å…³é”®è¯ç²¾ç¡®åŒ¹é…]
    
    F --> I[æœ€ç»ˆæ£€ç´¢ç»“æœ]
    G --> I
    H --> I
    
    style C fill:#e1f5fe
    style D fill:#fff3e0
    style E fill:#f3e5f5
    style I fill:#e8f5e8
</pre>

<ol>
<li>
<p>è¯­ä¹‰æœç´¢Â ï¼ˆå‡†ï¼‰:Â ä½¿ç”¨Â EmbeddingÂ æ¨¡å‹è®¡ç®—å‘é‡ç›¸ä¼¼åº¦ï¼Œç†è§£æ·±å±‚è¯­ä¹‰ï¼Œå¤„ç†åŒä¹‰è¯å’Œæ¦‚å¿µåŒ¹é…ã€‚</p>
</li>
<li>
<p>æ··åˆæœç´¢Â ï¼ˆå…¨é¢ï¼‰:Â ç»“åˆå‘é‡æœç´¢Â +Â BM25Â å…³é”®è¯æœç´¢ï¼Œå¹³è¡¡è¯­ä¹‰ç†è§£å’Œç²¾ç¡®åŒ¹é…ã€‚</p>
</li>
<li>
<p>å…¨æ–‡æœç´¢Â ï¼ˆå¿«ï¼‰:Â ä¼ ç»Ÿçš„å€’æ’ç´¢å¼•å’ŒTF-IDFï¼Œç²¾ç¡®çš„å…³é”®è¯åŒ¹é…ï¼Œé€Ÿåº¦å¿«</p>
</li>
</ol>
<p>ã€ç®—æ³•è¯´æ˜ã€‘</p>
<ul>
<li>Embeddingå‘é‡æ£€ç´¢ï¼šå°†æ–‡æœ¬é€šè¿‡ç¼–ç å™¨è½¬ä¸ºå‘é‡å’ŒDBä¸­çš„å‘é‡è®¡ç®—cosç›¸ä¼¼åº¦æœ€åè¿”å›TopKçš„ç»“æœ</li>
</ul>
<pre class="mermaid">graph TD
    A[æ–‡æœ¬è¾“å…¥] --> B[Embeddingæ£€ç´¢æµç¨‹]
    
    B --> C[ç¬¬ä¸€é˜¶æ®µ: å‘é‡åŒ–]
    C --> C1[åˆ†è¯å’Œé¢„å¤„ç†]
    C1 --> C2[Transformerç¼–ç å™¨]
    C2 --> C3[æ± åŒ–æ“ä½œ]
    C3 --> C4[å½’ä¸€åŒ–å¤„ç†]
    C4 --> C5[ç”Ÿæˆå‘é‡è¡¨ç¤º]
    
    B --> D[ç¬¬äºŒé˜¶æ®µ: ç´¢å¼•æ„å»º]
    D --> D1[å‘é‡ç»´åº¦ä¼˜åŒ–]
    D1 --> D2[ç´¢å¼•ç»“æ„é€‰æ‹©]
    D2 --> D3[HNSW/IVF/LSH]
    D3 --> D4[åˆ†å¸ƒå¼å­˜å‚¨]
    
    B --> E[ç¬¬ä¸‰é˜¶æ®µ: ç›¸ä¼¼åº¦æ£€ç´¢]
    E --> E1[æŸ¥è¯¢å‘é‡åŒ–]
    E1 --> E2[è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢]
    E2 --> E3[ç›¸ä¼¼åº¦è®¡ç®—]
    E3 --> E4[TopKç»“æœè¿”å›]
    
    F[æŠ€æœ¯æ ˆ] --> F1[æ¨¡å‹: BERT/Sentence-BERT]
    F --> F2[å‘é‡DB: Pinecone/Milvus/ElasticSearch]
    F --> F3[ç›¸ä¼¼åº¦: ä½™å¼¦/ç‚¹ç§¯/æ¬§æ°]
    F --> F4[ç´¢å¼•: HNSW/IVF]
    
    style C fill:#e1f5fe
    style D fill:#fff3e0
    style E fill:#f3e5f5
    style F fill:#e8f5e8
</pre>

<ul>
<li>
<p>å€’æ’ç´¢å¼•ï¼šå°†æ–‡æ¡£åˆ‡åˆ†æˆç‹¬ç«‹çš„è¯æ±‡å•å…ƒï¼Œå»ºç«‹ä»è¯æ±‡åˆ°æ–‡æ¡£çš„æ˜ å°„ç´¢å¼•</p>
</li>
<li>
<p>TF-IDFÂ (è¯é¢‘-é€†æ–‡æ¡£é¢‘ç‡)ï¼šTFï¼ˆè¯é¢‘ï¼‰ï¼šÂ è®¡ç®—ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„è¯æ¬¡æ•°ï¼ŒÂ ç”¨äºè¡¡é‡è¯æ±‡çš„é‡è¦æ€§ã€‚IDFÂ ï¼ˆé€†æ–‡æ¡£é¢‘ç‡ï¼‰ï¼šè¡¡é‡è¯æ±‡åœ¨æ•´ä¸ªè¯­æ–™åº“ä¸­çš„é‡è¦æ€§ã€‚Â </p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">TF</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">è¯æ±‡tåœ¨æ–‡æ¡£dä¸­å‡ºç°çš„æ¬¡æ•°</span> <span class="o">/</span> <span class="n">æ–‡æ¡£dçš„æ€»è¯æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">IDF</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">æ–‡æ¡£æ€»æ•°</span> <span class="o">/</span> <span class="n">åŒ…å«è¯æ±‡tçš„æ–‡æ¡£æ•°</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">TF</span><span class="o">-</span><span class="n">IDF</span> <span class="o">=</span> <span class="n">sigmoid</span> <span class="p">(</span><span class="n">TF</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">IDF</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span></span></code></pre></div><p>ç¼ºç‚¹ï¼šä¸èƒ½è€ƒè™‘è¯æ±‡çš„ä½ç½®ï¼Œå¿½ç•¥äº†è¯æ±‡çš„ç›¸å…³æ€§ï¼›ä¸åˆ©äºç¨€ç–æ€§Â ï¼ˆçŸ­æ–‡æ¡£å¾ˆå¤šè¯æ±‡Â <code>TF-IDF=0</code>ï¼‰</p>
<ul>
<li>BM25Â ç®—æ³•ï¼šåœ¨Â <code>TF-IDF</code>Â (è¯é¢‘-é€†æ–‡æ¡£é¢‘ç‡)Â åŸºç¡€ä¸Šï¼Œè§£å†³äº†è¯é¢‘é¥±å’Œé—®é¢˜å’Œæ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–é—®é¢˜ã€‚</li>
</ul>
<h5 id="rerankè§„åˆ™">ReRankÂ è§„åˆ™<a hidden class="anchor" aria-hidden="true" href="#rerankè§„åˆ™">#</a></h5>
<p>Rerankå°±æ˜¯æ ¹æ®å¤šä¸ªæ£€ç´¢æ–¹å¼å¾—åˆ°çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œç„¶åæ ¹æ®RRFç®—æ³•é‡æ–°æ’åºçš„è¿‡ç¨‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RRF</span><span class="p">:</span> <span class="n">score</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">rank</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="c1"># é»˜è®¤ k = 60 </span>
</span></span></code></pre></div><p>rerankæ¨¡å‹çš„æ—¶åºå›¾</p>
<pre class="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant RS as æ£€ç´¢æœåŠ¡<br/>RetrieveService
    participant QR as æŸ¥è¯¢é‡å†™<br/>QueryRewriter
    participant VS as å‘é‡æ£€ç´¢<br/>VectorStore
    participant ES as å…¨æ–‡æ£€ç´¢<br/>ElasticSearch
    participant NL as NL2SQLæ£€ç´¢<br/>NL2SQLEngine
    participant RK as é‡æ’åºå™¨<br/>Reranker
    participant API as Rerank API<br/>VikingDB

    Note over User, API: 1. åˆå§‹åŒ–æ£€ç´¢è¯·æ±‚
    User->>RS: å‘èµ·æ£€ç´¢è¯·æ±‚<br/>(query, knowledgeIDs, strategy)
    RS->>RS: æ„å»ºæ£€ç´¢ä¸Šä¸‹æ–‡<br/>(RetrieveContext)

    Note over User, API: 2. æŸ¥è¯¢é‡å†™ (å¯é€‰)
    alt å¯ç”¨æŸ¥è¯¢é‡å†™ && æœ‰å¯¹è¯å†å²
        RS->>QR: åŸºäºå¯¹è¯å†å²é‡å†™æŸ¥è¯¢
        QR-->>RS: è¿”å›é‡å†™åçš„æŸ¥è¯¢
    end

    Note over User, API: 3. å¹¶è¡Œå¤šé€šé“æ£€ç´¢
    par å‘é‡æ£€ç´¢
        alt è¯­ä¹‰æ£€ç´¢ || æ··åˆæ£€ç´¢
            RS->>VS: å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
            VS->>VS: 1. æŸ¥è¯¢æ–‡æœ¬å‘é‡åŒ–
            VS->>VS: 2. è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
            VS->>VS: 3. è¿”å›TopKç›¸ä¼¼æ–‡æ¡£
            VS-->>RS: å‘é‡æ£€ç´¢ç»“æœ<br/>(score: 0.0-1.0)
        end
    and å…¨æ–‡æ£€ç´¢
        alt å…¨æ–‡æ£€ç´¢ || æ··åˆæ£€ç´¢
            RS->>ES: å…³é”®è¯åŒ¹é…æ£€ç´¢
            ES->>ES: 1. åˆ†è¯å’Œç´¢å¼•åŒ¹é…
            ES->>ES: 2. è®¡ç®—BM25åˆ†æ•°
            ES->>ES: 3. è¿”å›åŒ¹é…æ–‡æ¡£
            ES-->>RS: ESæ£€ç´¢ç»“æœ<br/>(score: BM25)
        end
    and NL2SQLæ£€ç´¢
        alt å¯ç”¨NL2SQL
            RS->>NL: è‡ªç„¶è¯­è¨€è½¬SQLæŸ¥è¯¢
            NL->>NL: 1. è§£ææŸ¥è¯¢æ„å›¾
            NL->>NL: 2. ç”ŸæˆSQLè¯­å¥
            NL->>NL: 3. æ‰§è¡Œç»“æ„åŒ–æŸ¥è¯¢
            NL-->>RS: NL2SQLç»“æœ<br/>(score: ç›¸å…³æ€§åˆ†æ•°)
        end
    end

    Note over User, API: 4. Reranké‡æ’åº
    RS->>RS: æ•´åˆå¤šé€šé“æ£€ç´¢ç»“æœ
    Note right of RS: æ ¹æ®æ£€ç´¢ç­–ç•¥æ”¶é›†ç»“æœ:<br/>- SearchTypeSemantic: ä»…å‘é‡ç»“æœ<br/>- SearchTypeFullText: ä»…ESç»“æœ<br/>- SearchTypeHybrid: å‘é‡+ESç»“æœ<br/>- å¦‚å¯ç”¨NL2SQL: é¢å¤–æ·»åŠ NL2SQLç»“æœ

    RS->>RK: è°ƒç”¨RerankæœåŠ¡
    Note right of RK: ä¼ å…¥å‚æ•°:<br/>- Query: åŸå§‹æŸ¥è¯¢æˆ–é‡å†™åæŸ¥è¯¢<br/>- Data: å¤šé€šé“æ£€ç´¢ç»“æœæ•°ç»„<br/>- TopN: æœ€ç»ˆè¿”å›æ•°é‡

    alt VikingDB Reranker (æ·±åº¦å­¦ä¹ æ¨¡å‹)
        RK->>RK: 1. æ‰å¹³åŒ–æ‰€æœ‰æ£€ç´¢ç»“æœ
        RK->>RK: 2. æ„é€ rerankè¯·æ±‚<br/>{query, content, title}
        RK->>API: HTTP POSTè¯·æ±‚<br/>/api/knowledge/service/rerank
        API->>API: 1. ä½¿ç”¨base-multilingual-rerankæ¨¡å‹
        API->>API: 2. è®¡ç®—query-documentç›¸å…³æ€§åˆ†æ•°
        API-->>RK: è¿”å›æ¯ä¸ªæ–‡æ¡£çš„æ–°åˆ†æ•°<br/>{scores: [0.8, 0.6, 0.9, ...]}
        RK->>RK: 3. æŒ‰æ–°åˆ†æ•°é™åºæ’åº
        RK->>RK: 4. æˆªå–TopNç»“æœ
    else RRF Reranker (æ’åèåˆç®—æ³•)
        RK->>RK: 1. ä¸ºæ¯ä¸ªé€šé“çš„ç»“æœæŒ‰æ’åè®¡ç®—åˆ†æ•°
        Note right of RK: RRFå…¬å¼: score = 1/(rank + k)<br/>å…¶ä¸­k=60ä¸ºé»˜è®¤å‚æ•°
        RK->>RK: 2. åŒä¸€æ–‡æ¡£å–æœ€é«˜åˆ†æ•°
        RK->>RK: 3. æŒ‰åˆ†æ•°é™åºæ’åº
        RK->>RK: 4. æˆªå–TopNç»“æœ
    end

    RK-->>RS: è¿”å›é‡æ’åºç»“æœ<br/>{sortedData, tokenUsage}

    Note over User, API: 5. ç»“æœè¿‡æ»¤ä¸å°è£…
    RS->>RS: 1. åº”ç”¨æœ€å°åˆ†æ•°é˜ˆå€¼è¿‡æ»¤<br/>(score < minScoreçš„æ–‡æ¡£è¢«ç§»é™¤)
    RS->>RS: 2. æ›´æ–°æ–‡æ¡£åˆ†æ•°ä¸ºrerankåˆ†æ•°
    RS->>RS: 3. å°è£…æœ€ç»ˆæ£€ç´¢ç»“æœ

    RS-->>User: è¿”å›æœ€ç»ˆæ£€ç´¢ç»“æœ<br/>(æŒ‰ç›¸å…³æ€§æ’åºçš„æ–‡æ¡£åˆ—è¡¨)
</pre>

<h5 id="çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„">çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#çŸ¥è¯†åº“èŠ‚ç‚¹ç»“æ„">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Knowledge çŸ¥è¯†åº“èŠ‚ç‚¹é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºé…ç½®ç‹¬ç«‹çš„çŸ¥è¯†åº“æ£€ç´¢èŠ‚ç‚¹ï¼Œå®šä¹‰æ•°æ®æºå‚æ•°å’Œå¤„ç†ç­–ç•¥</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸LLMèŠ‚ç‚¹ä¸­çš„KnowledgeFCParamä¸åŒï¼Œè¿™æ˜¯ä¸“é—¨çš„çŸ¥è¯†åº“æ£€ç´¢æ­¥éª¤</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Knowledge</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// DatasetParam æ•°æ®é›†å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰çŸ¥è¯†åº“çš„æ•°æ®æºé…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¯ä¸ªParamåŒ…å«å…·ä½“çš„æ•°æ®æºé…ç½®é¡¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">DatasetParam</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Param</span> <span class="s">`json:&#34;datasetParam,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// StrategyParam çŸ¥è¯†åº“å¤„ç†ç­–ç•¥å‚æ•°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰æ–‡æ¡£è§£æã€åˆ†å—ã€ç´¢å¼•ç­‰å„ä¸ªç¯èŠ‚çš„å¤„ç†ç­–ç•¥å’Œå‚æ•°</span>
</span></span><span class="line"><span class="cl">	<span class="nx">StrategyParam</span> <span class="nx">StrategyParam</span> <span class="s">`json:&#34;strategyParam,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// StrategyParam çŸ¥è¯†åº“å¤„ç†ç­–ç•¥å‚æ•°é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰çŸ¥è¯†åº“ä»æ–‡æ¡£è§£æåˆ°å‘é‡ç´¢å¼•çš„å®Œæ•´å¤„ç†æµç¨‹ç­–ç•¥</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">StrategyParam</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ParsingStrategy æ–‡æ¡£è§£æç­–ç•¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰å¦‚ä½•è§£æå’Œæå–ä¸åŒç±»å‹æ–‡æ¡£çš„å†…å®¹</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ParsingStrategy</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ParsingType è§£æç±»å‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰æ–‡æ¡£è§£æçš„æ–¹å¼ï¼Œå¦‚è‡ªåŠ¨è¯†åˆ«ã€æ‰‹åŠ¨æŒ‡å®šç­‰</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å¸¸è§å€¼ï¼šautoï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰ã€manualï¼ˆæ‰‹åŠ¨æŒ‡å®šï¼‰ã€customï¼ˆè‡ªå®šä¹‰ï¼‰</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ParsingType</span> <span class="kt">string</span> <span class="s">`json:&#34;parsingType,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ImageExtraction æ˜¯å¦æå–å›¾ç‰‡</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ§åˆ¶æ˜¯å¦ä»æ–‡æ¡£ä¸­æå–å›¾ç‰‡å†…å®¹è¿›è¡Œå¤„ç†</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// trueè¡¨ç¤ºæå–å›¾ç‰‡ï¼Œfalseè¡¨ç¤ºå¿½ç•¥å›¾ç‰‡å†…å®¹</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ImageExtraction</span> <span class="kt">bool</span> <span class="s">`json:&#34;imageExtraction&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// TableExtraction æ˜¯å¦æå–è¡¨æ ¼</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ§åˆ¶æ˜¯å¦ä»æ–‡æ¡£ä¸­æå–è¡¨æ ¼ç»“æ„å’Œæ•°æ®</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// trueè¡¨ç¤ºè§£æè¡¨æ ¼ç»“æ„ï¼Œfalseè¡¨ç¤ºå°†è¡¨æ ¼è§†ä¸ºæ™®é€šæ–‡æœ¬</span>
</span></span><span class="line"><span class="cl">		<span class="nx">TableExtraction</span> <span class="kt">bool</span> <span class="s">`json:&#34;tableExtraction&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ImageOcr æ˜¯å¦å¯ç”¨å›¾ç‰‡OCRè¯†åˆ«</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ§åˆ¶æ˜¯å¦å¯¹æå–çš„å›¾ç‰‡è¿›è¡Œå…‰å­¦å­—ç¬¦è¯†åˆ«</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// trueè¡¨ç¤ºå¯¹å›¾ç‰‡è¿›è¡ŒOCRæ–‡å­—è¯†åˆ«ï¼Œfalseè¡¨ç¤ºå¿½ç•¥å›¾ç‰‡ä¸­çš„æ–‡å­—</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ImageOcr</span> <span class="kt">bool</span> <span class="s">`json:&#34;imageOcr&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;parsingStrategy,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ChunkStrategy æ–‡æ¡£åˆ†å—ç­–ç•¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰å¦‚ä½•å°†é•¿æ–‡æ¡£åˆ‡åˆ†æˆé€‚åˆå‘é‡åŒ–çš„å°å—</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ChunkStrategy</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ChunkType åˆ†å—ç±»å‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰æ–‡æ¡£åˆ†å—çš„ç­–ç•¥ç±»å‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å¸¸è§å€¼ï¼šfixedï¼ˆå›ºå®šé•¿åº¦ï¼‰ã€semanticï¼ˆè¯­ä¹‰åˆ†å—ï¼‰ã€sentenceï¼ˆå¥å­åˆ†å—ï¼‰</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ChunkType</span> <span class="kt">string</span> <span class="s">`json:&#34;chunkType,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// SeparatorType åˆ†éš”ç¬¦ç±»å‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰ç”¨äºåˆ†å—çš„åˆ†éš”ç¬¦ç±»å‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å¸¸è§å€¼ï¼šautoï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼‰ã€newlineï¼ˆæ¢è¡Œç¬¦ï¼‰ã€paragraphï¼ˆæ®µè½ï¼‰ã€customï¼ˆè‡ªå®šä¹‰ï¼‰</span>
</span></span><span class="line"><span class="cl">		<span class="nx">SeparatorType</span> <span class="kt">string</span> <span class="s">`json:&#34;separatorType,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Separator è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å½“SeparatorTypeä¸ºcustomæ—¶ï¼ŒæŒ‡å®šå…·ä½“çš„åˆ†éš”ç¬¦å­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Separator</span> <span class="kt">string</span> <span class="s">`json:&#34;separator,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// MaxToken æœ€å¤§ä»¤ç‰Œæ•°</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰æ¯ä¸ªæ–‡æ¡£å—çš„æœ€å¤§tokenæ•°é‡ï¼Œæ§åˆ¶å—çš„å¤§å°</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// é€šå¸¸è®¾ç½®ä¸ºæ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£å¤§å°ï¼Œå¦‚512ã€1024ç­‰</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxToken</span> <span class="kt">int64</span> <span class="s">`json:&#34;maxToken,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Overlap é‡å æ¯”ä¾‹</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å®šä¹‰ç›¸é‚»æ–‡æ¡£å—ä¹‹é—´çš„é‡å æ¯”ä¾‹ï¼Œé¿å…è¯­ä¹‰ä¿¡æ¯åœ¨è¾¹ç•Œå¤„ä¸¢å¤±</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å–å€¼èŒƒå›´0.0-1.0ï¼Œå¸¸è§å€¼ä¸º0.1-0.2ï¼ˆ10%-20%é‡å ï¼‰</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Overlap</span> <span class="kt">float64</span> <span class="s">`json:&#34;overlap,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="s">`json:&#34;chunkStrategy,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// IndexStrategy ç´¢å¼•ç­–ç•¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰å‘é‡ç´¢å¼•çš„æ„å»ºç­–ç•¥ï¼Œå¦‚ç´¢å¼•ç±»å‹ã€å‚æ•°ç­‰</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å…·ä½“ç»“æ„ä¾èµ–äºä½¿ç”¨çš„å‘é‡æ•°æ®åº“ç±»å‹ï¼ˆå¦‚HNSWã€IVFç­‰ï¼‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">IndexStrategy</span> <span class="kt">any</span> <span class="s">`json:&#34;indexStrategy&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="12å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»å¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€">1.2Â å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»ï¼Ÿå¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#12å¦‚ä½•ä»ç”»å¸ƒè½¬æ¢ä¸ºåç«¯ç±»å¦‚ä½•è½¬æ¢ä¸ºæ‰§è¡Œæ€">#</a></h3>
<p>å‰ç«¯ä¼ å…¥ç”»å¸ƒçš„Â DSLè¯­è¨€ï¼ˆJSONï¼‰ç»™åç«¯ä¹‹åï¼Œä¼šè§£æä¸ºä¸Šæ–¹çš„åç«¯ç»“æ„ã€‚ç”»å¸ƒä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå˜æˆÂ <code>canvas.go</code>ä¸­çš„Â <code>Node</code>ç»“æ„ä½“ã€‚ä½†æ˜¯è½¬æ¢åçš„Â <code>Node</code>ç»“æ„ä½“åªæ˜¯ä¸€ä¸ªå­˜å‚¨æ€ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œå·¥ä½œæµè¿˜éœ€è¦å°†Â <code>Node</code>ç»“æ„ä½“ä»å­˜å‚¨æ€è½¬ä¸ºè¿è¡Œæ€ã€‚åç«¯Â schemaÂ çš„Â <code>NodeSchema</code>ç»“æ„ä½“å°±æ˜¯Â é’ˆå¯¹ç”¨äºè¡¨è¾¾å·¥ä½œæµçš„è¿è¡Œæ€çš„</p>
<h4 id="121è½¬æ¢æµç¨‹å›¾">1.2.1Â è½¬æ¢æµç¨‹å›¾<a hidden class="anchor" aria-hidden="true" href="#121è½¬æ¢æµç¨‹å›¾">#</a></h4>
<pre class="mermaid">graph TD
    A[Canvasç”»å¸ƒ] --> B[CanvasToWorkflowSchema]
    B --> C[ç§»é™¤å­¤ç«‹èŠ‚ç‚¹]
    C --> D[éå†Canvas Nodes]
    
    D --> E{èŠ‚ç‚¹ç±»å‹åˆ¤æ–­}
    E -->|å­å·¥ä½œæµ| F[toSubWorkflowNodeSchema]
    E -->|æ™®é€šèŠ‚ç‚¹| G[è·å–NodeAdaptor]
    
    G --> H[è°ƒç”¨Adaptor.Adaptæ–¹æ³•]
    H --> I{èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹?}
    I -->|æ˜¯| J[é€’å½’è½¬æ¢å­èŠ‚ç‚¹]
    I -->|å¦| K[è½¬æ¢è¾“å…¥è¾“å‡ºç±»å‹]
    
    J --> L[è®¾ç½®å±‚æ¬¡å…³ç³»]
    L --> K
    K --> M[è®¾ç½®å¼‚å¸¸å¤„ç†é…ç½®]
    M --> N[ç”ŸæˆNodeSchema]
    
    F --> N
    N --> O[æ”¶é›†æ‰€æœ‰NodeSchema]
    O --> P[è½¬æ¢è¿æ¥è¾¹]
    P --> Q[æ ‡å‡†åŒ–ç«¯å£]
    Q --> R[æ„å»ºåˆ†æ”¯ä¿¡æ¯]
    R --> S[WorkflowSchema]
    
    subgraph "NodeAdaptorè½¬æ¢ç»†èŠ‚"
        H1[è§£æèŠ‚ç‚¹é…ç½®] --> H2[è½¬æ¢è¾“å…¥å‚æ•°]
        H2 --> H3[è½¬æ¢è¾“å‡ºå®šä¹‰]
        H3 --> H4[è®¾ç½®èŠ‚ç‚¹ç‰¹å®šConfig]
        H4 --> H5[è°ƒç”¨SetInputsForNodeSchema]
        H5 --> H6[è°ƒç”¨SetOutputTypesForNodeSchema]
    end
    
    H --> H1
    
    subgraph "ç±»å‹è½¬æ¢ç»†èŠ‚"
        T1[CanvasBlockInputToTypeInfo] --> T2[è§£æåŸºç¡€ç±»å‹]
        T2 --> T3[å¤„ç†å¤æ‚å¯¹è±¡ç±»å‹]
        T3 --> T4[å¤„ç†æ•°ç»„ç±»å‹]
        T4 --> T5[å¤„ç†æ–‡ä»¶ç±»å‹]
        T5 --> T6[ç”ŸæˆTypeInfo]
        
        U1[CanvasBlockInputToFieldInfo] --> U2[åˆ†ææ•°æ®æ¥æº]
        U2 --> U3{æ¥æºç±»å‹}
        U3 -->|é™æ€å€¼| U4[åˆ›å»ºLiteralFieldInfo]
        U3 -->|èŠ‚ç‚¹å¼•ç”¨| U5[åˆ›å»ºReferenceFieldInfo]
        U3 -->|æ¨¡æ¿å­—ç¬¦ä¸²| U6[åˆ›å»ºTemplateFieldInfo]
        U4 --> U7[ç”ŸæˆFieldInfo]
        U5 --> U7
        U6 --> U7
    end
    
    K --> T1
    K --> U1
    
    style A fill:#e1f5fe
    style S fill:#c8e6c9
    style H fill:#fff3e0
    style N fill:#fce4ec
</pre>

<h4 id="122è½¬æ¢åçš„nodeschemaç»“æ„">1.2.2Â è½¬æ¢åçš„NodeSchemaç»“æ„<a hidden class="anchor" aria-hidden="true" href="#122è½¬æ¢åçš„nodeschemaç»“æ„">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// NodeSchema å·¥ä½œæµèŠ‚ç‚¹çš„ç»Ÿä¸€æè¿°å’Œé…ç½®ç»“æ„</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŒ…å«å®ä¾‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ˜¯Canvas Nodeè½¬æ¢åçš„åç«¯æ‰§è¡Œç»“æ„</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">NodeSchema</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Key èŠ‚ç‚¹åœ¨Einoå›¾ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// èŠ‚ç‚¹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦è¿™ä¸ªä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// - ä½¿ç”¨æ­¤KeyæŸ¥è¯¢å·¥ä½œæµçŠ¶æ€ä¸­å±äºå½“å‰èŠ‚ç‚¹çš„æ•°æ®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Key</span> <span class="nx">vo</span><span class="p">.</span><span class="nx">NodeKey</span> <span class="s">`json:&#34;key&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Name èŠ‚ç‚¹åœ¨Canvasç”»å¸ƒä¸ŠæŒ‡å®šçš„æ˜¾ç¤ºåç§°</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// èŠ‚ç‚¹å¯èƒ½ä¼šåœ¨Canvasä¸Šæ˜¾ç¤ºè¿™ä¸ªåç§°ä½œä¸ºè¾“å…¥/è¾“å‡ºçš„ä¸€éƒ¨åˆ†</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Type èŠ‚ç‚¹çš„ç±»å‹æ ‡è¯†</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å¯¹åº”entity.NodeTypeæšä¸¾ï¼Œå†³å®šèŠ‚ç‚¹çš„å…·ä½“è¡Œä¸ºå’ŒåŠŸèƒ½</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Type</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">NodeType</span> <span class="s">`json:&#34;type&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Configs èŠ‚ç‚¹ç‰¹å®šçš„é…ç½®ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¯ä¸ªèŠ‚ç‚¹ç±»å‹å®šä¹‰è‡ªå·±çš„é…ç½®ç»“æ„ä½“ï¼Œä¸åŒ…å«å­—æ®µæ˜ å°„æˆ–é™æ€å€¼ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è¿™äº›é…ç½®æ˜¯èŠ‚ç‚¹å®ç°çš„å†…éƒ¨é…ç½®ï¼Œä¸å·¥ä½œæµç¼–æ’æ— å…³</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®é™…ç±»å‹åº”è¯¥å®ç°ä¸¤ä¸ªæ¥å£ï¼š</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// - NodeAdaptor: æä¾›ä»vo.Nodeåˆ°NodeSchemaçš„è½¬æ¢</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// - NodeBuilder: æä¾›ä»NodeSchemaåˆ°å®é™…èŠ‚ç‚¹å®ä¾‹çš„å®ä¾‹åŒ–</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Configs</span> <span class="kt">any</span> <span class="s">`json:&#34;configs,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// InputTypes èŠ‚ç‚¹è¾“å…¥å­—æ®µçš„ç±»å‹ä¿¡æ¯æ˜ å°„</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é”®ä¸ºå­—æ®µåï¼Œå€¼ä¸ºå¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œç”¨äºç±»å‹æ£€æŸ¥å’ŒéªŒè¯</span>
</span></span><span class="line"><span class="cl">	<span class="nx">InputTypes</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">vo</span><span class="p">.</span><span class="nx">TypeInfo</span> <span class="s">`json:&#34;input_types,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// InputSources èŠ‚ç‚¹è¾“å…¥å­—æ®µçš„æ˜ å°„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰æ¯ä¸ªè¾“å…¥å­—æ®µçš„æ•°æ®æ¥æºï¼Œå¦‚æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¾“å‡ºæˆ–é™æ€å€¼</span>
</span></span><span class="line"><span class="cl">	<span class="nx">InputSources</span> <span class="p">[]</span><span class="o">*</span><span class="nx">vo</span><span class="p">.</span><span class="nx">FieldInfo</span> <span class="s">`json:&#34;input_sources,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// OutputTypes èŠ‚ç‚¹è¾“å‡ºå­—æ®µçš„ç±»å‹ä¿¡æ¯æ˜ å°„</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é”®ä¸ºå­—æ®µåï¼Œå€¼ä¸ºå¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œç”¨äºä¸‹æ¸¸èŠ‚ç‚¹çš„ç±»å‹æ¨å¯¼</span>
</span></span><span class="line"><span class="cl">	<span class="nx">OutputTypes</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">vo</span><span class="p">.</span><span class="nx">TypeInfo</span> <span class="s">`json:&#34;output_types,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// OutputSources èŠ‚ç‚¹è¾“å‡ºå­—æ®µçš„æ˜ å°„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ³¨æ„ï¼šä»…é€‚ç”¨äºå¤åˆèŠ‚ç‚¹ï¼Œå¦‚NodeTypeBatchæˆ–NodeTypeLoop</span>
</span></span><span class="line"><span class="cl">	<span class="nx">OutputSources</span> <span class="p">[]</span><span class="o">*</span><span class="nx">vo</span><span class="p">.</span><span class="nx">FieldInfo</span> <span class="s">`json:&#34;output_sources,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ExceptionConfigs èŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åŒ…å«è¶…æ—¶ã€é‡è¯•ã€é”™è¯¯å¤„ç†ç±»å‹ç­‰å¼‚å¸¸å¤„ç†ç›¸å…³è®¾ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ExceptionConfigs</span> <span class="o">*</span><span class="nx">ExceptionConfig</span> <span class="s">`json:&#34;exception_configs,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// StreamConfigs èŠ‚ç‚¹çš„æµå¼å¤„ç†ç‰¹æ€§é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®šä¹‰èŠ‚ç‚¹æ˜¯å¦æ”¯æŒæµå¼è¾“å…¥/è¾“å‡ºç­‰æµå¤„ç†èƒ½åŠ›</span>
</span></span><span class="line"><span class="cl">	<span class="nx">StreamConfigs</span> <span class="o">*</span><span class="nx">StreamConfig</span> <span class="s">`json:&#34;stream_configs,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// SubWorkflowBasic å­å·¥ä½œæµçš„åŸºæœ¬ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä»…å½“èŠ‚ç‚¹ç±»å‹ä¸ºNodeTypeSubWorkflowæ—¶ä½¿ç”¨</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SubWorkflowBasic</span> <span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">WorkflowBasic</span> <span class="s">`json:&#34;sub_workflow_basic,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// SubWorkflowSchema å­å·¥ä½œæµçš„å®Œæ•´Schemaä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä»…å½“èŠ‚ç‚¹ç±»å‹ä¸ºNodeTypeSubWorkflowæ—¶ä½¿ç”¨ï¼ŒåŒ…å«å­å·¥ä½œæµçš„å®Œæ•´å®šä¹‰</span>
</span></span><span class="line"><span class="cl">	<span class="nx">SubWorkflowSchema</span> <span class="o">*</span><span class="nx">WorkflowSchema</span> <span class="s">`json:&#34;sub_workflow_schema,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// FullSources èŠ‚ç‚¹è¾“å…¥å­—æ®µæ˜ å°„æ¥æºçš„å®Œæ•´ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚å­—æ®µæ˜¯å¦ä¸ºæµå¼å­—æ®µï¼Œæˆ–å­—æ®µæ˜¯å¦ä¸ºåŒ…å«å­å­—æ®µæ˜ å°„çš„å¯¹è±¡</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨äºéœ€è¦å¤„ç†æµå¼è¾“å…¥çš„èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åœ¨NodeMetaä¸­è®¾ç½®InputSourceAware = trueæ¥å¯ç”¨æ­¤åŠŸèƒ½</span>
</span></span><span class="line"><span class="cl">	<span class="nx">FullSources</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">SourceInfo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Lambda ç›´æ¥è®¾ç½®èŠ‚ç‚¹ä¸ºEino Lambda</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ³¨æ„ï¼šä¸å¯åºåˆ—åŒ–ï¼Œä»…ç”¨äºå†…éƒ¨æµ‹è¯•</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Lambda</span> <span class="o">*</span><span class="nx">compose</span><span class="p">.</span><span class="nx">Lambda</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="123è½¬æ¢ç»“æ„å‰åå¯¹æ¯”">1.2.3Â è½¬æ¢ç»“æ„å‰åå¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#123è½¬æ¢ç»“æ„å‰åå¯¹æ¯”">#</a></h4>
<pre class="mermaid">graph LR
    subgraph "å‰ç«¯Canvasç»“æ„"
        A[Canvasç”»å¸ƒ]
        A --> B[NodeèŠ‚ç‚¹]
        A --> C[Edgeè¿æ¥]
        
        B --> D[ID: string]
        B --> E[Type: string]
        B --> F[Dataé…ç½®]
        
        F --> G[Metaå…ƒæ•°æ®]
        F --> H[Inputsè¾“å…¥]
        F --> I[Outputsè¾“å‡º]
        
        H --> J[InputParameterså‚æ•°åˆ—è¡¨]
        H --> K[LLMParamæ¨¡å‹å‚æ•°]
        H --> L[SettingOnErroré”™è¯¯å¤„ç†]
        
        J --> M[Paramå‚æ•°]
        M --> N[Name: string]
        M --> O[Input: BlockInput]
        
        O --> P[Type: VariableType]
        O --> Q[Value: BlockInputValue]
        
        Q --> R[Type: literal/ref/object_ref]
        Q --> S[Content: any]
        
        I --> T[Variableå˜é‡]
        T --> U[Name: string]
        T --> V[Type: VariableType]
        T --> W[Schema: any]
    end
    
    subgraph "è½¬æ¢è¿‡ç¨‹"
        X[CanvasToWorkflowSchema] --> Y[NodeToNodeSchema]
        Y --> Z[NodeAdaptor.Adapt]
        Z --> AA[SetInputsForNodeSchema]
        Z --> BB[SetOutputTypesForNodeSchema]
        AA --> CC[CanvasBlockInputToTypeInfo]
        AA --> DD[CanvasBlockInputToFieldInfo]
        BB --> EE[CanvasVariableToTypeInfo]
    end
    
    subgraph "åç«¯NodeSchemaç»“æ„"
        FF[WorkflowSchemaå·¥ä½œæµ]
        FF --> GG[NodeSchemaèŠ‚ç‚¹]
        FF --> HH[Connectionè¿æ¥]
        FF --> II[Branchåˆ†æ”¯]
        
        GG --> JJ[Key: NodeKey]
        GG --> KK[Type: NodeTypeæšä¸¾]
        GG --> LL[Configs: èŠ‚ç‚¹é…ç½®]
        
        GG --> MM[InputTypesç±»å‹æ˜ å°„]
        GG --> NN[InputSourcesæ¥æºæ˜ å°„]
        GG --> OO[OutputTypesè¾“å‡ºç±»å‹]
        
        MM --> PP["map[string]*TypeInfo"]
        NN --> QQ["[]*FieldInfo"]
        OO --> RR["map[string]*TypeInfo"]
        
        QQ --> SS[FieldInfoå­—æ®µä¿¡æ¯]
        SS --> TT[Path: FieldPath]
        SS --> UU[Source: æ•°æ®æ¥æº]
        SS --> VV[Type: Literal/Reference/Template]
        
        PP --> WW[TypeInfoç±»å‹ä¿¡æ¯]
        WW --> XX[Type: DataTypeæšä¸¾]
        WW --> YY[Properties: å¯¹è±¡å±æ€§]
        WW --> ZZ[ElemTypeInfo: æ•°ç»„å…ƒç´ ç±»å‹]
        
        GG --> AAA[ExceptionConfigså¼‚å¸¸é…ç½®]
        AAA --> BBB[TimeoutMS: è¶…æ—¶æ—¶é—´]
        AAA --> CCC[MaxRetry: é‡è¯•æ¬¡æ•°]
        AAA --> DDD[ProcessType: å¤„ç†ç±»å‹]
    end
    
    A -.è½¬æ¢.-> FF
    B -.é€‚é…å™¨è½¬æ¢.-> GG
    C -.æ ‡å‡†åŒ–.-> HH
    O -.ç±»å‹è½¬æ¢.-> WW
    Q -.æ¥æºåˆ†æ.-> SS
    
    style A fill:#e3f2fd
    style FF fill:#e8f5e8
    style X fill:#fff3e0
    style Y fill:#fff3e0
    style Z fill:#fff3e0
</pre>

<p>ã€è½¬æ¢è¿‡ç¨‹ã€‘</p>
<p><code>canvas</code>åˆ°Â <code>NodeSchema</code>çš„è½¬æ¢è¿‡ç¨‹æ˜¯CozeÂ Studioå·¥ä½œæµç³»ç»Ÿä¸­çš„æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼Œå®ƒé€šè¿‡é€‚é…å™¨æ¨¡å¼å°†å‰ç«¯é¢å‘ç”¨æˆ·çš„å¯è§†åŒ–ç”»å¸ƒç»“æ„è½¬æ¢ä¸ºåç«¯é¢å‘æ‰§è¡Œçš„æ ‡å‡†åŒ–Â <code>Schema</code>ç»“æ„ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‰ç«¯çš„Â <code>Canvas</code>åŒ…å«äº†ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šæ‹–æ‹½é…ç½®çš„Â <code>Node</code>èŠ‚ç‚¹å’ŒÂ <code>Edge</code>è¿æ¥ï¼Œæ¯ä¸ª<code>Node</code>èŠ‚ç‚¹åŒ…å«å­—ç¬¦ä¸²ç±»å‹çš„<code>ID</code>å’Œ<code>Type</code>ã€ç”¨æˆ·é…ç½®çš„<code>Data</code>æ•°æ®ï¼ˆåŒ…æ‹¬è¾“å…¥å‚æ•°ã€è¾“å‡ºå®šä¹‰ã€å…ƒæ•°æ®ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®ä»¥çµæ´»çš„Â `anyÂ `ç±»å‹å’ŒåµŒå¥—ç»“æ„å­˜å‚¨ä»¥é€‚åº”å‰ç«¯çš„åŠ¨æ€é…ç½®éœ€æ±‚ï¼›è€Œè½¬æ¢åçš„<code>NodeSchema</code>åˆ™é‡‡ç”¨å¼ºç±»å‹çš„ç»“æ„åŒ–è®¾è®¡ï¼Œå°†<strong>èŠ‚ç‚¹ç±»å‹</strong>è½¬æ¢ä¸º<strong>æšä¸¾</strong>ã€å°†<strong>è¾“å…¥è¾“å‡º</strong>è½¬æ¢ä¸ºÂ <code>TypeInfo</code>å’Œ<code>FieldInfo</code>çš„æ˜ å°„å…³ç³»ã€å°†<strong>æ•°æ®æ¥æºåˆ†æ</strong>ä¸º<strong>å…·ä½“çš„å¼•ç”¨è·¯å¾„</strong>ï¼Œå¹¶æ·»åŠ äº†æ‰§è¡Œæ—¶éœ€è¦çš„Â <strong>å¼‚å¸¸å¤„ç†é…ç½®</strong>ã€<strong>æµå¼å¤„ç†é…ç½®</strong>ç­‰è¿è¡Œæ—¶ä¿¡æ¯ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¹‹æ‰€ä»¥å¿…è¦ï¼Œæ˜¯å› ä¸ºå‰ç«¯Canvaséœ€è¦ä¿æŒé«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§æ¥æ”¯æŒç”¨æˆ·çš„å„ç§é…ç½®æ“ä½œå’ŒUIäº¤äº’ï¼Œè€Œåç«¯æ‰§è¡Œå¼•æ“åˆ™éœ€è¦ä¸¥æ ¼çš„ç±»å‹å®‰å…¨ã€æ˜ç¡®çš„æ•°æ®æµå‘å’Œä¼˜åŒ–çš„æ‰§è¡Œæ€§èƒ½ï¼Œä¸¤è€…çš„è®¾è®¡ç›®æ ‡å’Œçº¦æŸæ¡ä»¶å®Œå…¨ä¸åŒï¼Œå› æ­¤éœ€è¦é€šè¿‡è¿™ä¸ªè½¬æ¢å±‚æ¥å®ç°å‰åç«¯çš„è§£è€¦ï¼ŒåŒæ—¶ç¡®ä¿ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šçš„æ¯ä¸€ä¸ªé…ç½®éƒ½èƒ½å‡†ç¡®æ— è¯¯åœ°è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„å·¥ä½œæµé€»è¾‘ï¼Œå¹¶ä¸”è¿™ç§è½¬æ¢è¿‡ç¨‹è¿˜æ”¯æŒå¤æ‚çš„èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚å­å·¥ä½œæµã€æ‰¹å¤„ç†èŠ‚ç‚¹ï¼‰ã€æ•°æ®ç±»å‹æ¨å¯¼ã€å­—æ®µæ˜ å°„åˆ†æç­‰é«˜çº§ç‰¹æ€§ï¼Œä¸ºæ•´ä¸ªå·¥ä½œæµç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’ŒåŠŸèƒ½æ‰©å±•æä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<h3 id="13å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ">1.3Â å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#13å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹åˆ†æ">#</a></h3>
<h5 id="å·¥ä½œæµæ‰§è¡Œå›¾ç»†èŠ‚">å·¥ä½œæµæ‰§è¡Œå›¾Â (ç»†èŠ‚)<a hidden class="anchor" aria-hidden="true" href="#å·¥ä½œæµæ‰§è¡Œå›¾ç»†èŠ‚">#</a></h5>
<pre class="mermaid">graph TD
    A[Canvasç”»å¸ƒ] --> B{ä¿å­˜/è¿è¡Œå·¥ä½œæµ}
    
    B --> C[ç”»å¸ƒç»“æ„éªŒè¯]
    C --> D[è¿æ¥å…³ç³»éªŒè¯]
    C --> E[é—­ç¯æ£€æµ‹]
    C --> F[èŠ‚ç‚¹é…ç½®éªŒè¯]
    C --> G[å˜é‡å¼•ç”¨éªŒè¯]
    C --> H[åµŒå¥—æµç¨‹éªŒè¯]
    C --> I[å…¨å±€å˜é‡éªŒè¯]
    C --> J[å­å·¥ä½œæµç»ˆæ­¢è®¡åˆ’éªŒè¯]
    
    D --> K{éªŒè¯é€šè¿‡?}
    E --> K
    F --> K
    G --> K
    H --> K
    I --> K
    J --> K
    
    K -->|å¦| L[è¿”å›éªŒè¯é”™è¯¯]
    L --> M[å‰ç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    
    K -->|æ˜¯| N[Canvasè½¬æ¢ä¸ºWorkflowSchema]
    N --> O[ç§»é™¤å­¤ç«‹èŠ‚ç‚¹]
    O --> P[éå†Canvas Nodes]
    
    P --> Q{èŠ‚ç‚¹ç±»å‹åˆ¤æ–­}
    Q -->|å­å·¥ä½œæµ| R[é€’å½’è§£æå­å·¥ä½œæµCanvas]
    Q -->|æ‰¹å¤„ç†èŠ‚ç‚¹| S[è§£ææ‰¹å¤„ç†æ¨¡å¼]
    Q -->|æ™®é€šèŠ‚ç‚¹| T[è·å–NodeAdaptor]
    
    R --> U[toSubWorkflowNodeSchema]
    S --> V[parseBatchModeç”Ÿæˆæ‰¹å¤„ç†ç»“æ„]
    T --> W[è°ƒç”¨Adaptor.Adaptæ–¹æ³•]
    
    U --> X[è®¾ç½®å¼‚å¸¸å¤„ç†é…ç½®]
    V --> X
    W --> X
    
    X --> Y{èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹?}
    Y -->|æ˜¯| Z[é€’å½’è½¬æ¢å­èŠ‚ç‚¹]
    Y -->|å¦| AA[è½¬æ¢è¾“å…¥è¾“å‡ºç±»å‹]
    
    Z --> BB[è®¾ç½®å±‚æ¬¡å…³ç³»æ˜ å°„]
    BB --> AA
    
    AA --> CC[SetInputsForNodeSchema]
    AA --> DD[SetOutputTypesForNodeSchema]
    
    CC --> EE[CanvasBlockInputToTypeInfo]
    CC --> FF[CanvasBlockInputToFieldInfo]
    DD --> GG[CanvasVariableToTypeInfo]
    
    EE --> HH[è§£æåŸºç¡€ç±»å‹]
    EE --> II[å¤„ç†å¤æ‚å¯¹è±¡ç±»å‹]
    EE --> JJ[å¤„ç†æ•°ç»„ç±»å‹]
    EE --> KK[å¤„ç†æ–‡ä»¶ç±»å‹]
    
    FF --> LL[åˆ†ææ•°æ®æ¥æº]
    LL --> MM{æ¥æºç±»å‹}
    MM -->|é™æ€å€¼| NN[åˆ›å»ºLiteralFieldInfo]
    MM -->|èŠ‚ç‚¹å¼•ç”¨| OO[åˆ›å»ºReferenceFieldInfo]
    MM -->|æ¨¡æ¿å­—ç¬¦ä¸²| PP[åˆ›å»ºTemplateFieldInfo]
    
    HH --> QQ[ç”ŸæˆNodeSchema]
    II --> QQ
    JJ --> QQ
    KK --> QQ
    NN --> QQ
    OO --> QQ
    PP --> QQ
    GG --> QQ
    
    QQ --> RR[æ”¶é›†æ‰€æœ‰NodeSchema]
    RR --> SS[è½¬æ¢è¿æ¥è¾¹EdgeToConnection]
    SS --> TT[æ ‡å‡†åŒ–ç«¯å£normalizePorts]
    TT --> UU[æ„å»ºåˆ†æ”¯ä¿¡æ¯BuildBranches]
    UU --> VV[ç”Ÿæˆå®Œæ•´WorkflowSchema]
    
    VV --> WW[èŠ‚ç‚¹å®ä¾‹åŒ–]
    WW --> XX[NodeBuilder.Build]
    XX --> YY[åˆ›å»ºå…·ä½“èŠ‚ç‚¹å®ä¾‹]
    YY --> ZZ[å·¥ä½œæµæ‰§è¡Œå¼•æ“]
    
    subgraph "éªŒè¯å™¨è¯¦ç»†åŠŸèƒ½"
        D1[ValidateConnections<br/>æ£€æŸ¥èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§]
        E1[DetectCycles<br/>æ£€æµ‹å·¥ä½œæµä¸­çš„å¾ªç¯ä¾èµ–]
        F1[èŠ‚ç‚¹é…ç½®éªŒè¯<br/>æ£€æŸ¥å¿…å¡«å­—æ®µå’Œå‚æ•°åˆæ³•æ€§]
        G1[CheckRefVariable<br/>éªŒè¯å˜é‡å¼•ç”¨çš„æœ‰æ•ˆæ€§]
        H1[ValidateNestedFlows<br/>æ£€æŸ¥æ‰¹å¤„ç†/å¾ªç¯åµŒå¥—é™åˆ¶]
        I1[CheckGlobalVariables<br/>éªŒè¯å…¨å±€å˜é‡ç±»å‹åŒ¹é…]
        J1[CheckSubWorkFlowTerminatePlan<br/>éªŒè¯å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥]
    end
    
    D -.-> D1
    E -.-> E1
    F -.-> F1
    G -.-> G1
    H -.-> H1
    I -.-> I1
    J -.-> J1
    
    subgraph "NodeAdaptorè½¬æ¢ç»†èŠ‚"
        W1[è§£æèŠ‚ç‚¹ç‰¹å®šé…ç½®] --> W2[è½¬æ¢è¾“å…¥å‚æ•°ç±»å‹]
        W2 --> W3[è½¬æ¢è¾“å‡ºå®šä¹‰ç±»å‹]
        W3 --> W4[è®¾ç½®èŠ‚ç‚¹å†…éƒ¨Config]
        W4 --> W5[è°ƒç”¨é€šç”¨ç±»å‹è½¬æ¢å‡½æ•°]
    end
    
    W -.-> W1
    
    subgraph "æ‰§è¡Œæ—¶èŠ‚ç‚¹ç±»å‹"
        YY1[InvokableNode<br/>æ™®é€šæ‰§è¡ŒèŠ‚ç‚¹]
        YY2[StreamableNode<br/>æµå¼å¤„ç†èŠ‚ç‚¹]
        YY3[TransformableNode<br/>æ•°æ®è½¬æ¢èŠ‚ç‚¹]
        YY4[CollectableNode<br/>æ•°æ®æ”¶é›†èŠ‚ç‚¹]
    end
    
    YY -.-> YY1
    YY -.-> YY2
    YY -.-> YY3
    YY -.-> YY4
    
    style A fill:#e3f2fd
    style C fill:#ffebee
    style K fill:#fff3e0
    style VV fill:#e8f5e8
    style ZZ fill:#f3e5f5
    style L fill:#ffcdd2
</pre>

<ul>
<li>
<p><strong>å‰ç«¯äº¤äº’å±‚</strong>ï¼šå‰ç«¯Â <code>Canvas</code>å±‚æ˜¯ç”¨æˆ·äº¤äº’çš„èµ·ç‚¹ï¼Œ<code>Canvas</code>ç”»å¸ƒæ‰¿è½½ç€ç”¨æˆ·çš„å¯è§†åŒ–é…ç½®ï¼Œå…¶ä¸­åŒ…å«Â <code>Node</code>ï¼ˆä»¥<code>vo.Node</code>ç»“æ„ä½“è¡¨ç¤ºï¼‰å’Œ<code>Edge</code>è¿æ¥å…³ç³»ï¼Œè¿™é‡Œçš„å…³é”®é—®é¢˜æ˜¯&quot;èŠ‚ç‚¹æ ·å¼ï¼šå“ªäº›å›ºå®šå­—æ®µï¼Ÿè¡¨å•å½¢å¼ï¼Ÿ&quot;ï¼Œå®é™…ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ ‡å‡†åŒ–çš„å…ƒæ•°æ®å®šä¹‰ï¼ˆå¦‚èŠ‚ç‚¹ç±»å‹ã€æ˜¾ç¤ºåç§°ã€å›¾æ ‡ç­‰å›ºå®šå­—æ®µï¼‰å’ŒåŠ¨æ€çš„é…ç½®è¡¨å•ï¼ˆæ ¹æ®èŠ‚ç‚¹ç±»å‹å±•ç¤ºä¸åŒçš„å‚æ•°é…ç½®ç•Œé¢ï¼‰ï¼Œå‰ç«¯<code>schema</code>é‡‡ç”¨çµæ´»çš„JSONç»“æ„æ¥é€‚åº”å„ç§èŠ‚ç‚¹ç±»å‹çš„é…ç½®éœ€æ±‚ã€‚</p>
</li>
<li>
<p><strong>éªŒè¯å±‚</strong>ï¼šéªŒè¯å±‚é€šè¿‡<code>CanvasValidator</code>å¯¹ç”»å¸ƒç»“æ„è¿›è¡Œå…¨é¢æ£€æŸ¥ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§ã€å¾ªç¯ä¾èµ–æ£€æµ‹ã€é…ç½®åˆæ³•æ€§éªŒè¯ç­‰å¤šä¸ªç»´åº¦ï¼Œç¡®ä¿åªæœ‰ç»“æ„æ­£ç¡®çš„å·¥ä½œæµæ‰èƒ½è¿›å…¥åç»­çš„è½¬æ¢å’Œæ‰§è¡Œé˜¶æ®µï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œç³»ç»Ÿä¼šè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½å’Œä¿®æ­£é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>è½¬æ¢å±‚</strong>ï¼šè½¬æ¢å±‚æ˜¯æ•´ä¸ªæ¶æ„çš„æ ¸å¿ƒæ¢çº½ï¼Œè´Ÿè´£&quot;åç«¯ä¿å­˜ï¼Œworkflowè¿è¡Œ&quot;çš„å…³é”®è½¬æ¢è¿‡ç¨‹ï¼Œé€šè¿‡<code>CanvasToWorkflowSchema</code>å‡½æ•°åè°ƒæ•´ä¸ªè½¬æ¢æµç¨‹ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯<code>NodeType</code>åˆ°èŠ‚ç‚¹<code>Config</code>çš„è½¬æ¢ï¼Œè¿™é€šè¿‡<code>NodeAdaptor</code>æ¥å£å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç±»å‹éƒ½æœ‰å¯¹åº”çš„é€‚é…å™¨è´Ÿè´£å°†å‰ç«¯çš„çµæ´»é…ç½®è½¬æ¢ä¸ºåç«¯çš„å¼ºç±»å‹<code>NodeSchema</code>ç»“æ„ï¼Œå®ç°äº†&quot;å‰ç«¯schemaÂ -&gt;Â åç«¯schema&quot;çš„æ ‡å‡†åŒ–è½¬æ¢ã€‚</p>
</li>
<li>
<p><strong>èŠ‚ç‚¹å®ä¾‹åŒ–å±‚</strong>ï¼šå®ä¾‹åŒ–å±‚é€šè¿‡<code>NodeBuilder</code>æ¥å£å°†æŠ½è±¡çš„<code>NodeSchema</code>è½¬æ¢ä¸ºå…·ä½“çš„å¯æ‰§è¡ŒèŠ‚ç‚¹å®ä¾‹ï¼Œè¿™é‡Œçš„å…³é”®æ˜¯<code>NodeSchema.Configs</code>å­—æ®µå¿…é¡»å®ç°<code>NodeBuilder</code>æ¥å£ï¼Œä»è€Œèƒ½å¤Ÿæ ¹æ®é…ç½®ä¿¡æ¯åˆ›å»ºå®é™…çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ç°äº†&quot;åç«¯schemaÂ -&gt;Â èŠ‚ç‚¹å®ä¾‹&quot;çš„æœ€ç»ˆè½¬æ¢ï¼Œä¸ºæ‰§è¡Œå±‚æä¾›äº†ç»Ÿä¸€çš„èŠ‚ç‚¹å®ä¾‹æ¥å£ã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡Œå±‚</strong>ï¼šæ‰§è¡Œå±‚æ˜¯æ•´ä¸ªæµç¨‹çš„æœ€ç»ˆç›®æ ‡ï¼ŒèŠ‚ç‚¹å®ä¾‹é€šè¿‡å®ç°<code>InvokableNode</code>ç­‰æ‰§è¡Œæ¥å£æ¥æä¾›å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¤„ç†èƒ½åŠ›ï¼Œå·¥ä½œæµå¼•æ“è´Ÿè´£æŒ‰ç…§æ—¢å®šçš„æ‰§è¡Œé¡ºåºè°ƒåº¦å„ä¸ªèŠ‚ç‚¹ï¼Œå¤„ç†æ•°æ®æµè½¬å’ŒçŠ¶æ€ç®¡ç†ï¼Œæœ€ç»ˆäº§ç”Ÿä¸šåŠ¡æ‰§è¡Œç»“æœå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</p>
</li>
</ul>
<h2 id="å·¥ä½œæµæ ¡éªŒ">å·¥ä½œæµæ ¡éªŒ<a hidden class="anchor" aria-hidden="true" href="#å·¥ä½œæµæ ¡éªŒ">#</a></h2>
<h3 id="21å·¥ä½œæµéªŒè¯æµç¨‹">2.1Â å·¥ä½œæµéªŒè¯æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#21å·¥ä½œæµéªŒè¯æµç¨‹">#</a></h3>
<h4 id="211æ ¸å¿ƒéªŒè¯æµç¨‹">2.1.1Â æ ¸å¿ƒéªŒè¯æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#211æ ¸å¿ƒéªŒè¯æµç¨‹">#</a></h4>
<pre class="mermaid">graph LR
    A[ç”»å¸ƒé¢„å¤„ç†] --> B[è¿æ¥éªŒè¯] --> C[å¾ªç¯æ£€æµ‹] --> D[åµŒå¥—éªŒè¯] --> E[å˜é‡æ£€æŸ¥] --> F[å…¨å±€å˜é‡] --> G[ç»ˆæ­¢ç­–ç•¥]
</pre>

<h4 id="212å®Œæ•´éªŒè¯æµç¨‹">2.1.2Â å®Œæ•´éªŒè¯æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#212å®Œæ•´éªŒè¯æµç¨‹">#</a></h4>
<pre class="mermaid">%% ç‚¹å‡» â€œç»˜å›¾â€ æŒ‰é’®å³å¯é¢„è§ˆ
graph LR
    A["1. ç”»å¸ƒé¢„å¤„ç†<br/>â€¢ JSONååºåˆ—åŒ–<br/>â€¢ æ¸…ç†å­¤ç«‹èŠ‚ç‚¹<br/>â€¢ åˆ›å»ºéªŒè¯å™¨å®ä¾‹"] --> H["2. è¿æ¥å…³ç³»éªŒè¯<br/>ValidateConnections"]
    H --> H1["â€¢ æ£€æŸ¥èŠ‚ç‚¹è¿æ¥å®Œæ•´æ€§<br/>â€¢ éªŒè¯ç«¯å£è¿æ¥æ­£ç¡®æ€§<br/>â€¢ æ£€æŸ¥åˆ†æ”¯èŠ‚ç‚¹å®Œæ•´æ€§"]
    H1 --> I{å‘ç°é—®é¢˜?}
    I -->|æ˜¯| Z["è¿”å›éªŒè¯é”™è¯¯"]
    I -->|å¦| J["3. å¾ªç¯ä¾èµ–æ£€æµ‹<br/>DetectCycles"]
    
    J --> J1["â€¢ æ„å»ºä¾èµ–å…³ç³»å›¾<br/>â€¢ DFSç®—æ³•æ£€æµ‹ç¯<br/>â€¢ æ ‡è¯†å¾ªç¯è·¯å¾„"]
    J1 --> K{å‘ç°å¾ªç¯?}
    K -->|æ˜¯| Z
    K -->|å¦| L["4. åµŒå¥—æµç¨‹éªŒè¯<br/>ValidateNestedFlows"]
    
    L --> L1["â€¢ æ£€æŸ¥æ‰¹å¤„ç†èŠ‚ç‚¹åµŒå¥—<br/>â€¢ éªŒè¯å¾ªç¯èŠ‚ç‚¹åµŒå¥—<br/>â€¢ é˜²æ­¢è¿‡æ·±åµŒå¥—"]
    L1 --> M{åµŒå¥—è¿è§„?}
    M -->|æ˜¯| Z
    M -->|å¦| N["5. å¼•ç”¨å˜é‡æ£€æŸ¥<br/>CheckRefVariable"]
    
    N --> N1["â€¢ éªŒè¯å˜é‡å¯è¾¾æ€§<br/>â€¢ æ£€æŸ¥å‚æ•°åè§„èŒƒ<br/>â€¢ éªŒè¯ä½œç”¨åŸŸæ­£ç¡®æ€§"]
    N1 --> O{å˜é‡å¼•ç”¨é”™è¯¯?}
    O -->|æ˜¯| Z
    O -->|å¦| P["6. å…¨å±€å˜é‡éªŒè¯<br/>CheckGlobalVariables"]
    
    P --> P1["â€¢ éªŒè¯å˜é‡ç±»å‹åŒ¹é…<br/>â€¢ æ£€æŸ¥æ•°ç»„å…ƒç´ ç±»å‹<br/>â€¢ éªŒè¯å˜é‡å£°æ˜"]
    P1 --> Q{å…¨å±€å˜é‡é”™è¯¯?}
    Q -->|æ˜¯| Z
    Q -->|å¦| R["7. å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥<br/>CheckSubWorkFlowTerminatePlanType"]
    
    R --> R1["â€¢ éªŒè¯ç»ˆæ­¢è®¡åˆ’é…ç½®<br/>â€¢ æ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§<br/>â€¢ éªŒè¯å­å·¥ä½œæµå­˜åœ¨æ€§"]
    R1 --> S{ç»ˆæ­¢ç­–ç•¥é”™è¯¯?}
    S -->|æ˜¯| Z
    S -->|å¦| T["ä¸»å·¥ä½œæµéªŒè¯å®Œæˆ"]
    
    T --> U["å­å·¥ä½œæµé€’å½’éªŒè¯"]
    U --> U1["â€¢ è§£æç”»å¸ƒè·å–å­å·¥ä½œæµ<br/>â€¢ ç­›é€‰é¡¹ç›®çº§å·¥ä½œæµ<br/>â€¢ æ‰¹é‡è·å–å·¥ä½œæµä¿¡æ¯"]
    U1 --> U2["å¯¹æ¯ä¸ªå­å·¥ä½œæµ<br/>é‡å¤éªŒè¯æµç¨‹"]
    U2 --> V["æ±‡æ€»æ‰€æœ‰éªŒè¯ç»“æœ"]
    
    V --> W["é”™è¯¯ä¿¡æ¯è½¬æ¢<br/>â€¢ Issue -> ValidateErrorData<br/>â€¢ èŠ‚ç‚¹é”™è¯¯/è·¯å¾„é”™è¯¯åˆ†ç±»"]
    W --> X["è¿”å›éªŒè¯ç»“æœ<br/>ValidateTreeResponse"]
    
    style A fill:#e1f5fe
    style H fill:#e8f5e8
    style J fill:#e8f5e8
    style L fill:#e8f5e8
    style N fill:#e8f5e8
    style P fill:#e8f5e8
    style R fill:#e8f5e8
    style U fill:#fff8e1
    style Z fill:#ffebee
</pre>

<h4 id="213å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“">2.1.3Â å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#213å·¥ä½œæµéªŒè¯æµç¨‹æŠ€æœ¯å®ç°æ€»ç»“">#</a></h4>
<p>CozeÂ StudioÂ çš„å·¥ä½œæµéªŒè¯é‡‡ç”¨<strong>åˆ†å±‚é€’è¿›å¼éªŒè¯æ¶æ„</strong>ï¼Œä»Â APIÂ å±‚çš„Â <code>ValidateTree</code>Â æ¥å£å¼€å§‹ï¼Œç»è¿‡åº”ç”¨æœåŠ¡å±‚çš„å‚æ•°é¢„å¤„ç†ï¼Œæœ€ç»ˆè°ƒç”¨é¢†åŸŸæœåŠ¡å±‚çš„æ ¸å¿ƒéªŒè¯å¼•æ“Â <code>validateWorkflowTree</code>ã€‚éªŒè¯æµç¨‹åŒ…å«ä¸ƒä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<p><strong>1.Â ç”»å¸ƒé¢„å¤„ç†é˜¶æ®µ</strong>Â -Â é¦–å…ˆå°†Â JSONÂ æ ¼å¼çš„ç”»å¸ƒç»“æ„ååºåˆ—åŒ–ä¸ºå†…å­˜å¯¹è±¡ï¼Œç„¶åè°ƒç”¨Â <code>adaptor.PruneIsolatedNodes</code>Â æ¸…ç†æ²¡æœ‰è¿æ¥å…³ç³»çš„å­¤ç«‹èŠ‚ç‚¹ï¼Œæœ€ååˆ›å»ºé…ç½®å®Œæ•´çš„Â <code>CanvasValidator</code>Â éªŒè¯å™¨å®ä¾‹å¹¶æ‰§è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ„å»ºèŠ‚ç‚¹é—´çš„è¿é€šå…³ç³»å›¾ã€‚</p>
<p><strong>2.Â è¿æ¥å…³ç³»éªŒè¯</strong>Â -Â <code>ValidateConnections</code>Â æ–¹æ³•é€šè¿‡éå†æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼Œæ„å»ºå‡ºåº¦æ˜ å°„è¡¨å’Œç«¯å£æ˜ å°„è¡¨æ¥å®ç°ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ£€æŸ¥å…¶è¾“å‡ºç«¯å£æ˜¯å¦æ­£ç¡®è¿æ¥ï¼Œç‰¹åˆ«æ˜¯åˆ†æ”¯èŠ‚ç‚¹ï¼ˆå¦‚æ¡ä»¶åˆ¤æ–­ã€é”™è¯¯å¤„ç†ï¼‰å¿…é¡»ç¡®ä¿æ‰€æœ‰æœŸæœ›çš„ç«¯å£éƒ½æœ‰è¿æ¥ã€‚ç®—æ³•ä¼šé€’å½’éªŒè¯åµŒå¥—èŠ‚ç‚¹çš„è¿æ¥å…³ç³»ï¼Œç¡®ä¿æ•°æ®æµçš„å®Œæ•´æ€§ã€‚</p>
<p><strong>3.Â å¾ªç¯ä¾èµ–æ£€æµ‹</strong>Â -Â <code>DetectCycles</code>Â ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ç®—æ³•å®ç°ã€‚é¦–å…ˆæ„å»ºåå‘ä¾èµ–å…³ç³»å›¾ï¼ˆ<code>controlSuccessors</code>ï¼‰ï¼Œç„¶åå¯¹æ¯ä¸ªæœªè®¿é—®çš„èŠ‚ç‚¹å¯åŠ¨Â DFSÂ éå†ã€‚åœ¨éå†è¿‡ç¨‹ä¸­ç»´æŠ¤å½“å‰è·¯å¾„æ ˆï¼Œå½“å‘ç°è·¯å¾„ä¸­å·²å­˜åœ¨çš„èŠ‚ç‚¹æ—¶ï¼Œå³æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–ï¼Œç®—æ³•ä¼šæå–å¹¶è¿”å›å®Œæ•´çš„å¾ªç¯è·¯å¾„ã€‚</p>
<p><strong>4.Â åµŒå¥—æµç¨‹éªŒè¯</strong>Â -Â <code>ValidateNestedFlows</code>Â é€šè¿‡æ£€æŸ¥å¯è¾¾æ€§åˆ†æç»“æœä¸­çš„Â <code>nestedReachability</code>Â ç»“æ„å®ç°ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ—¢æœ‰åµŒå¥—ç»“æ„ï¼Œåˆåœ¨å…¶åµŒå¥—ç»“æ„ä¸­è¿˜æœ‰æ›´æ·±å±‚çš„åµŒå¥—ï¼ˆå³Â <code>len(nestedReachableNodes.nestedReachability)Â &gt;Â 0</code>ï¼‰ï¼Œåˆ™åˆ¤å®šä¸ºè¿ååµŒå¥—è§„åˆ™ï¼Œé˜²æ­¢æ‰¹å¤„ç†å’Œå¾ªç¯èŠ‚ç‚¹çš„è¿‡åº¦åµŒå¥—å¯¼è‡´æ‰§è¡Œå¼‚å¸¸ã€‚</p>
<p><strong>5.Â å¼•ç”¨å˜é‡æ£€æŸ¥</strong>Â -Â <code>CheckRefVariable</code>Â é‡‡ç”¨é€’å½’ä½œç”¨åŸŸåˆ†æç®—æ³•ã€‚å®šä¹‰å†…éƒ¨å‡½æ•°Â <code>inputBlockVerify</code>Â è§£ææ¯ä¸ªè¾“å…¥å‚æ•°çš„å¼•ç”¨ä¿¡æ¯ï¼Œæ£€æŸ¥å¼•ç”¨çš„èŠ‚ç‚¹æ˜¯å¦åœ¨å½“å‰æˆ–çˆ¶çº§ä½œç”¨åŸŸçš„å¯è¾¾èŒƒå›´å†…ã€‚é€šè¿‡Â <code>combinedReachable</code>Â æ˜ å°„è¡¨åˆå¹¶å½“å‰å±‚çº§å’Œçˆ¶çº§å¯è¾¾èŠ‚ç‚¹ï¼Œå®ç°ä½œç”¨åŸŸç»§æ‰¿æœºåˆ¶ã€‚åŒæ—¶éªŒè¯å‚æ•°åç§°çš„è§„èŒƒæ€§ï¼ˆå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰ã€‚</p>
<p><strong>6.Â å…¨å±€å˜é‡éªŒè¯</strong>Â -Â <code>CheckGlobalVariables</code>Â é¦–å…ˆæ”¶é›†æ‰€æœ‰å˜é‡åˆ†é…èŠ‚ç‚¹ï¼ˆ<code>NodeTypeVariableAssigner</code>ï¼‰çš„å˜é‡å®šä¹‰ï¼Œç„¶åé€šè¿‡Â <code>VariablesMetaGetter</code>Â è·å–åº”ç”¨æˆ–æ™ºèƒ½ä½“çš„å˜é‡å…ƒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚éªŒè¯åŒ…æ‹¬åŸºç¡€ç±»å‹åŒ¹é…å’Œæ•°ç»„å…ƒç´ ç±»å‹çš„æ·±åº¦æ£€æŸ¥ï¼Œç¡®ä¿å·¥ä½œæµä¸­ä½¿ç”¨çš„å…¨å±€å˜é‡ä¸ç³»ç»Ÿå®šä¹‰ä¸€è‡´ã€‚</p>
<p><strong>7.Â å­å·¥ä½œæµç»ˆæ­¢ç­–ç•¥éªŒè¯</strong>Â -Â <code>CheckSubWorkFlowTerminatePlanType</code>Â é€šè¿‡é€’å½’æ”¶é›†æ‰€æœ‰å­å·¥ä½œæµèŠ‚ç‚¹ï¼Œåˆ†åˆ«è·å–è‰ç¨¿ç‰ˆæœ¬å’Œå·²å‘å¸ƒç‰ˆæœ¬çš„ç”»å¸ƒä¿¡æ¯ã€‚å¯¹æ¯ä¸ªå­å·¥ä½œæµï¼ŒæŸ¥æ‰¾å…¶ç»“æŸèŠ‚ç‚¹çš„ç»ˆæ­¢è®¡åˆ’é…ç½®ï¼Œä¸å½“å‰èŠ‚ç‚¹çš„ç»ˆæ­¢ç±»å‹è¿›è¡ŒåŒ¹é…éªŒè¯ï¼Œç¡®ä¿å­å·¥ä½œæµçš„è¾“å‡ºå¤„ç†ç­–ç•¥ä¸è°ƒç”¨æ–¹æœŸæœ›ä¸€è‡´ã€‚</p>
<p>æ•´ä¸ªéªŒè¯è¿‡ç¨‹é‡‡ç”¨<strong>å¿«é€Ÿå¤±è´¥ç­–ç•¥</strong>ï¼Œä»»ä½•æ­¥éª¤å‘ç°é—®é¢˜ç«‹å³è¿”å›é”™è¯¯ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒ<strong>é€’å½’å­å·¥ä½œæµéªŒè¯</strong>ï¼Œé€šè¿‡Â <code>getAllSubWorkflowIdentities</code>Â æå–æ‰€æœ‰å­å·¥ä½œæµæ ‡è¯†ï¼Œå¯¹æ¯ä¸ªå­å·¥ä½œæµé‡å¤æ‰§è¡Œå®Œæ•´çš„éªŒè¯æµç¨‹ï¼Œæœ€ç»ˆæ±‡æ€»æ‰€æœ‰éªŒè¯ç»“æœï¼Œç¡®ä¿æ•´ä¸ªå·¥ä½œæµæ ‘çš„ç»“æ„å®Œæ•´æ€§ã€é€»è¾‘æ­£ç¡®æ€§å’Œæ‰§è¡Œå®‰å…¨æ€§ã€‚</p>


  </div>



  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://swimmingliu.cn/tags/java/">Java</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://swimmingliu.cn/posts/job/leetcode-hot100-notes/">
    <span class="title">Next Â»</span>
    <br>
    <span>Leetcode Hot100 åˆ·é¢˜ç¬”è®°</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2023-2025 <a href="https://swimmingliu.cn/">SwimmingLiu&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <span>
        <a href="https://beian.miit.gov.cn/">æµ™ICPå¤‡2024056260å·</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>


  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>

